{"version":3,"file":"main.nodejs.js","mappings":"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CACL,SACA,QACA,YACA,UACA,UACA,WAEJC,WAAY,CACR,KACA,OACA,aACA,SACA,OACA,WACA,WACA,qBACA,eACA,eACA,eACA,aACA,OACA,SAGRC,eAAgB,CACZnnB,KAAM,iBACNinB,QAAS,CACL,iBAEJC,WAAY,IAEhBE,MAAO,CACHpnB,KAAM,QACNinB,QAAS,CACL,UACA,UAEJC,WAAY,CACR,OAGRG,WAAY,CACRrnB,KAAM,aACNinB,QAAS,CACL,iBAEJC,WAAY,CACR,eAGRI,wBAAyB,CACrBtnB,KAAM,0BACNinB,QAAS,CACL,qBACA,qBACA,uBAEJC,WAAY,CACR,qBAGRK,gBAAiB,CACbvnB,KAAM,kBACNinB,QAAS,CACL,UAEJC,WAAY,CACR,QAGRM,gBAAiB,CACbxnB,KAAM,kBACNinB,QAAS,CACL,UAEJC,WAAY,CACR,QAGRO,SAAU,CACNznB,KAAM,WACNinB,QAAS,CACL,oBAEJC,WAAY,IAEhBQ,UAAW,CACP1nB,KAAM,YACNinB,QAAS,CACL,QACA,QAEJC,WAAY,CACR,YAGRS,MAAO,CACH3nB,KAAM,QACNinB,QAAS,CACL,QACA,UAEJC,WAAY,CACR,WAGRU,KAAM,CACF5nB,KAAM,OACNinB,QAAS,CACL,QAEJC,WAAY,CACR,WAGRW,mBAAoB,CAChB7nB,KAAM,qBACNinB,QAAS,CACL,iBACA,oBACA,wBACA,4BACA,4BAEJC,WAAY,CACR,qBACA,uBACA,2BACA,iBACA,qBACA,yBACA,0BAGRY,YAAa,CACT9nB,KAAM,cACNinB,QAAS,CACL,sBAEJC,WAAY,CACR,cACA,oBAGRa,eAAgB,CACZ/nB,KAAM,iBACNinB,QAAS,GACTC,WAAY,CACR,aAGRc,OAAQ,CACJhoB,KAAM,SACNinB,QAAS,CACL,oBACA,eAEJC,WAAY,IAEhBe,WAAY,CACRjoB,KAAM,aACNinB,QAAS,CACL,kBAEJC,WAAY,IAEhBgB,QAAS,CACLloB,KAAM,UACNinB,QAAS,CACL,eACA,eAEJC,WAAY,IAEhBiB,YAAa,CACTnoB,KAAM,cACNinB,QAAS,CACL,iBACA,yBAE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","sources":["../../../common/node_modules/http-auth-utils/dist/index.js","../../../common/node_modules/http-auth-utils/dist/mechanisms/basic.js","../../../common/node_modules/http-auth-utils/dist/mechanisms/bearer.js","../../../common/node_modules/http-auth-utils/dist/mechanisms/digest.js","../../../common/node_modules/http-auth-utils/dist/utils.js","../node_modules/h264-sps-parser/dist/bitstream.js","../node_modules/h264-sps-parser/dist/index.js","../node_modules/h264-sps-parser/dist/vui.js","../node_modules/lru-cache/index.js","../node_modules/semver/classes/comparator.js","../node_modules/semver/classes/range.js","../node_modules/semver/classes/semver.js","../node_modules/semver/functions/clean.js","../node_modules/semver/functions/cmp.js","../node_modules/semver/functions/coerce.js","../node_modules/semver/functions/compare-build.js","../node_modules/semver/functions/compare-loose.js","../node_modules/semver/functions/compare.js","../node_modules/semver/functions/diff.js","../node_modules/semver/functions/eq.js","../node_modules/semver/functions/gt.js","../node_modules/semver/functions/gte.js","../node_modules/semver/functions/inc.js","../node_modules/semver/functions/lt.js","../node_modules/semver/functions/lte.js","../node_modules/semver/functions/major.js","../node_modules/semver/functions/minor.js","../node_modules/semver/functions/neq.js","../node_modules/semver/functions/parse.js","../node_modules/semver/functions/patch.js","../node_modules/semver/functions/prerelease.js","../node_modules/semver/functions/rcompare.js","../node_modules/semver/functions/rsort.js","../node_modules/semver/functions/satisfies.js","../node_modules/semver/functions/sort.js","../node_modules/semver/functions/valid.js","../node_modules/semver/index.js","../node_modules/semver/internal/constants.js","../node_modules/semver/internal/debug.js","../node_modules/semver/internal/identifiers.js","../node_modules/semver/internal/parse-options.js","../node_modules/semver/internal/re.js","../node_modules/semver/ranges/gtr.js","../node_modules/semver/ranges/intersects.js","../node_modules/semver/ranges/ltr.js","../node_modules/semver/ranges/max-satisfying.js","../node_modules/semver/ranges/min-satisfying.js","../node_modules/semver/ranges/min-version.js","../node_modules/semver/ranges/outside.js","../node_modules/semver/ranges/simplify.js","../node_modules/semver/ranges/subset.js","../node_modules/semver/ranges/to-comparators.js","../node_modules/semver/ranges/valid.js","../node_modules/yallist/iterator.js","../node_modules/yallist/yallist.js","../../../sdk/dist/src/index.js","../../../sdk/dist/src/storage-settings.js","../../../sdk/dist/types/gen/index.js","../../../common/src/autoenable-mixin-provider.ts","../../../common/src/clone-deep.ts","../../../common/src/deferred.ts","../../../common/src/ffmpeg-hardware-acceleration.ts","../../../common/src/ffmpeg-helpers.ts","../../../common/src/ffmpeg-mp4-parser-session.ts","../../../common/src/ffmpeg-rebroadcast.ts","../../../common/src/listen-cluster.ts","../../../common/src/media-helpers.ts","../../../common/src/promise-utils.ts","../../../common/src/read-stream.ts","../../../common/src/rtsp-server.ts","../../../common/src/sdp-utils.ts","../../../common/src/settings-mixin.ts","../../../common/src/sleep.ts","../../../common/src/stream-parser.ts","../src/file-rtsp-server.ts","../src/local-addresses.ts","../src/main.ts","../src/rebroadcast-mixin-token.ts","../src/rfc4571.ts","../src/rtsp-session.ts","../src/sps-resolution.ts","../src/stream-settings.ts","../src/transcode-settings.ts","../../../server/src/listen-zero.ts","../../../server/src/media-helpers.ts","../../../server/src/sleep.ts","../../../sdk/polyfill/realfs.js","../external node-commonjs \"child_process\"","../external node-commonjs \"crypto\"","../external node-commonjs \"dgram\"","../external node-commonjs \"events\"","../external node-commonjs \"fs\"","../external node-commonjs \"net\"","../external node-commonjs \"os\"","../external node-commonjs \"process\"","../external node-commonjs \"stream\"","../external node-commonjs \"tls\"","../external node-commonjs \"url\"","../../../common/node_modules/yerror/dist/index.mjs","../webpack/bootstrap","../webpack/runtime/define property getters","../webpack/runtime/hasOwnProperty shorthand","../webpack/runtime/make namespace object","../webpack/startup"],"sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.parseWWWAuthenticateHeader = parseWWWAuthenticateHeader;\nexports.parseAuthorizationHeader = parseAuthorizationHeader;\nexports.buildWWWAuthenticateHeader = buildWWWAuthenticateHeader;\nexports.buildAuthorizationHeader = buildAuthorizationHeader;\nObject.defineProperty(exports, \"BASIC\", {\n  enumerable: true,\n  get: function () {\n    return _basic.default;\n  }\n});\nObject.defineProperty(exports, \"DIGEST\", {\n  enumerable: true,\n  get: function () {\n    return _digest.default;\n  }\n});\nObject.defineProperty(exports, \"BEARER\", {\n  enumerable: true,\n  get: function () {\n    return _bearer.default;\n  }\n});\nexports.mechanisms = void 0;\n\nvar _yerror = _interopRequireDefault(require(\"yerror\"));\n\nvar _basic = _interopRequireDefault(require(\"./mechanisms/basic\"));\n\nvar _digest = _interopRequireDefault(require(\"./mechanisms/digest\"));\n\nvar _bearer = _interopRequireDefault(require(\"./mechanisms/bearer\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * @module http-auth-utils\n */\n\n/**\n * Natively supported authentication mechanisms.\n * @type {Array}\n */\nconst mechanisms = [_basic.default, _digest.default, _bearer.default];\n/**\n * Basic authentication mechanism.\n * @type {Object}\n * @see  {@link module:http-auth-utils/mechanisms/basic}\n */\n\nexports.mechanisms = mechanisms;\n_basic.default;\n/**\n * Digest authentication mechanism.\n * @type {Object}\n * @see  {@link module:http-auth-utils/mechanisms/digest}\n */\n\n_digest.default;\n/**\n * Bearer authentication mechanism.\n * @type {Object}\n * @see  {@link module:http-auth-utils/mechanisms/digest}\n */\n\n_bearer.default;\n\n/**\n * Parse HTTP WWW-Authenticate header contents.\n * @type {Function}\n * @param {string} header\n * The WWW-Authenticate header contents\n * @param {Array} [authMechanisms=[BASIC, DIGEST, BEARER]]\n * Allow providing custom authentication mechanisms.\n * @param {Object} [options]\n * Parsing options\n * @param {boolean} [options.strict=true]\n * Strictly detect the mechanism type (case sensitive)\n * @return {Object} Result of the contents parse.\n * @api public\n * @example\n * assert.deepEqual(\n *   parseWWWAuthenticateHeader('Basic realm=\"test\"'), {\n *     type: 'Basic',\n *     data: {\n *       realm: 'test'\n *     }\n *   }\n * );\n */\nfunction parseWWWAuthenticateHeader(header, authMechanisms = mechanisms, {\n  strict = true\n} = {\n  strict: true\n}) {\n  let result = null;\n  authMechanisms.some(authMechanism => {\n    if (0 === header.indexOf(authMechanism.type + ' ') || !strict && 0 === header.indexOf(authMechanism.type.toLowerCase() + ' ')) {\n      result = {\n        type: authMechanism.type,\n        data: authMechanism.parseWWWAuthenticateRest(header.substr(authMechanism.type.length + 1))\n      };\n      return true;\n    }\n\n    return false;\n  });\n\n  if (!result) {\n    throw new _yerror.default('E_UNKNOWN_AUTH_MECHANISM', header);\n  }\n\n  return result;\n}\n/**\n * Parse HTTP Authorization header contents.\n * @type {Function}\n * @param {string} header The Authorization header contents\n * @param {Array} [authMechanisms=[BASIC, DIGEST, BEARER]]\n * Allow custom authentication mechanisms.\n * @param {Object} [options]\n * Parsing options\n * @param {boolean} [options.strict=true]\n * Strictly detect the mechanism type (case sensitive)\n * @return {Object} Result of the contents parse.\n * @api public\n * @example\n * assert.deepEqual(\n *   parseAuthorizationHeader('Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ=='), {\n *     type: 'Basic',\n *     data: {\n *       hash: 'QWxhZGRpbjpvcGVuIHNlc2FtZQ=='\n *     }\n *   }\n * );\n */\n\n\nfunction parseAuthorizationHeader(header, authMechanisms = mechanisms, {\n  strict = true\n} = {\n  strict: true\n}) {\n  let result = null;\n  authMechanisms.some(function (authMechanism) {\n    if (0 === header.indexOf(authMechanism.type + ' ') || !strict && 0 === header.indexOf(authMechanism.type.toLowerCase() + ' ')) {\n      result = {\n        type: authMechanism.type,\n        data: authMechanism.parseAuthorizationRest(header.substr(authMechanism.type.length + 1))\n      };\n      return true;\n    }\n\n    return false;\n  });\n\n  if (result) {\n    return result;\n  }\n\n  throw new _yerror.default('E_UNKNOWN_AUTH_MECHANISM', header);\n}\n/**\n * Build HTTP WWW-Authenticate header value.\n * @type {Function}\n * @param {Object} authMechanism The mechanism to use\n * @param {Object}\n * The WWW-Authenticate header contents to base the value on.\n * @return {string} The header value.\n * @api public\n * @example\n * assert.deepEqual(\n *   buildWWWAuthenticateHeader(BASIC, {\n *     realm: 'test'\n *   }),\n *   'Basic realm=\"test\"'\n * );\n */\n\n\nfunction buildWWWAuthenticateHeader(authMechanism, data) {\n  return `${authMechanism.type} ${authMechanism.buildWWWAuthenticateRest(data)}`;\n}\n/**\n * Build HTTP Authorization header value.\n * @type {Function}\n * @param {Object} authMechanism The mechanism to use\n * @param {Object}\n * The Authorization header contents to base the value on.\n * @return {string} The header value.\n * @api public\n * @example\n * assert.deepEqual(\n *   buildAuthorizationHeader(BASIC, {\n *     realm: 'test'\n *   }),\n *   'Basic realm=\"test\"'\n * );\n */\n\n\nfunction buildAuthorizationHeader(authMechanism, data) {\n  return `${authMechanism.type} ${authMechanism.buildAuthorizationRest(data)}`;\n}\n//# sourceMappingURL=index.js.map","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _yerror = _interopRequireDefault(require(\"yerror\"));\n\nvar _utils = require(\"../utils\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * @module http-auth-utils/mechanisms/basic\n */\nconst REQUIRED_WWW_AUTHENTICATE_KEYS = ['realm'];\nconst AUTHORIZED_WWW_AUTHENTICATE_KEYS = REQUIRED_WWW_AUTHENTICATE_KEYS;\n\n/* Architecture Note #1.2: Basic mechanism\n\nSee the following [RFC](https://tools.ietf.org/html/rfc7617).\n\n*/\n\n/**\n * Basic authentication mechanism.\n * @type {Object}\n * @see http://tools.ietf.org/html/rfc2617#section-2\n */\nconst BASIC = {\n  /**\n   * The Basic auth mechanism prefix.\n   * @type {String}\n   */\n  type: 'Basic',\n\n  /**\n   * Parse the WWW Authenticate header rest.\n   * @param  {String} rest The header rest (string after the authentication mechanism prefix).\n   * @return {Object}      Object representing the result of the parse operation.\n   * @example\n   * assert.deepEqual(\n   *   BASIC.parseWWWAuthenticateRest('realm=\"perlinpinpin\"'), {\n   *     realm: 'perlinpinpin'\n   *   }\n   * );\n   * @api public\n   */\n  parseWWWAuthenticateRest: function parseWWWAuthenticateRest(rest) {\n    return (0, _utils.parseHTTPHeadersQuotedKeyValueSet)(rest, AUTHORIZED_WWW_AUTHENTICATE_KEYS, REQUIRED_WWW_AUTHENTICATE_KEYS);\n  },\n\n  /**\n   * Build the WWW Authenticate header rest.\n   * @param  {Object} data The content from wich to build the rest.\n   * @return {String}         The built rest.\n   * @example\n   * assert.equal(\n   *   BASIC.buildWWWAuthenticateRest({\n   *     realm: 'perlinpinpin'\n   *   }),\n   *   'realm=\"perlinpinpin\"'\n   * );\n   * @api public\n   */\n  buildWWWAuthenticateRest: function buildWWWAuthenticateRest(data) {\n    return (0, _utils.buildHTTPHeadersQuotedKeyValueSet)(data, AUTHORIZED_WWW_AUTHENTICATE_KEYS, REQUIRED_WWW_AUTHENTICATE_KEYS);\n  },\n\n  /**\n   * Parse the Authorization header rest.\n   * @param  {String} rest The header rest (string after the authentication mechanism prefix).)\n   * @return {Object}      Object representing the result of the parse operation {hash}.\n   * @example\n   * assert.deepEqual(\n   *   BASIC.parseAuthorizationRest('QWxpIEJhYmE6b3BlbiBzZXNhbWU='), {\n   *     hash: 'QWxpIEJhYmE6b3BlbiBzZXNhbWU=',\n   *     username: 'Ali Baba',\n   *     password: 'open sesame'\n   *   }\n   * );\n   * @api public\n   */\n  parseAuthorizationRest: function parseAuthorizationRest(rest) {\n    if (!rest) {\n      throw new _yerror.default('E_EMPTY_AUTH');\n    }\n\n    const {\n      username,\n      password\n    } = BASIC.decodeHash(rest);\n    return {\n      hash: rest,\n      username,\n      password\n    };\n  },\n\n  /**\n   * Build the Authorization header rest.\n   * @param  {Object} content The content from wich to build the rest.\n   * @return {String}         The rest built.\n   * @example\n   * assert.equal(\n   *   BASIC.buildAuthorizationRest({\n   *     hash: 'QWxpIEJhYmE6b3BlbiBzZXNhbWU='\n   *   }),\n   *   'QWxpIEJhYmE6b3BlbiBzZXNhbWU='\n   * );\n   * @api public\n   */\n  buildAuthorizationRest: function buildAuthorizationRest({\n    hash,\n    username,\n    password\n  }) {\n    if (username && password) {\n      return BASIC.computeHash({\n        username,\n        password\n      });\n    }\n\n    if (!hash) {\n      throw new _yerror.default('E_NO_HASH');\n    }\n\n    return hash;\n  },\n\n  /**\n   * Compute the Basic authentication hash from the given credentials.\n   * @param  {Object} credentials The credentials to encode {username, password}.\n   * @return {String}             The hash representing the credentials.\n   * @example\n   * assert.equal(\n   *   BASIC.computeHash({\n   *     username: 'Ali Baba',\n   *     password: 'open sesame'\n   *   }),\n   *   'QWxpIEJhYmE6b3BlbiBzZXNhbWU='\n   * );\n   * @api public\n   */\n  computeHash: function computeHash({\n    username,\n    password\n  }) {\n    return Buffer.from(username + ':' + password).toString('base64');\n  },\n\n  /**\n   * Decode the Basic hash and return the corresponding credentials.\n   * @param  {String} hash The hash.\n   * @return {Object}      Object representing the credentials {username, password}.\n   * @example\n   * assert.deepEqual(\n   *   BASIC.decodeHash('QWxpIEJhYmE6b3BlbiBzZXNhbWU='), {\n   *     username: 'Ali Baba',\n   *     password: 'open sesame'\n   *   }\n   * );\n   * @api public\n   */\n  decodeHash: function decodeHash(hash) {\n    const [username, ...passwordParts] = Buffer.from(hash, 'base64').toString().split(':');\n    return {\n      username,\n      password: passwordParts.join(':')\n    };\n  }\n};\nvar _default = BASIC;\nexports.default = _default;\n//# sourceMappingURL=basic.js.map","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _yerror = _interopRequireDefault(require(\"yerror\"));\n\nvar _utils = require(\"../utils\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * @module http-auth-utils/mechanisms/bearer\n */\nconst AUTHORIZED_ERROR_CODES = ['invalid_request', 'invalid_token', 'insufficient_scope'];\nconst REQUIRED_WWW_AUTHENTICATE_KEYS = ['realm'];\nconst AUTHORIZED_WWW_AUTHENTICATE_KEYS = [...REQUIRED_WWW_AUTHENTICATE_KEYS, 'scope', 'error', 'error_description'];\n\n/* Architecture Note #1.1: Bearer mechanism\n\nSee the following [RFC](https://tools.ietf.org/html/rfc6750).\n\n*/\n\n/**\n * Bearer authentication mechanism.\n * @type {Object}\n * @see https://tools.ietf.org/html/rfc6750#section-3\n */\nconst BEARER = {\n  /**\n   * The Bearer auth mechanism prefix.\n   * @type {String}\n   */\n  type: 'Bearer',\n\n  /**\n   * Parse the WWW Authenticate header rest.\n   * @param  {String} rest The header rest (string after the authentication mechanism prefix).\n   * @return {Object}      Object representing the result of the parse operation.\n   * @example\n   * assert.deepEqual(\n   *   BEARER.parseWWWAuthenticateRest(\n   *     'realm=\"testrealm@host.com\", ' +\n   *     'scope=\"openid profile email\"'\n   *   ), {\n   *     realm: 'testrealm@host.com',\n   *     scope: 'openid profile email',\n   *   }\n   * );\n   * @api public\n   */\n  parseWWWAuthenticateRest: function parseWWWAuthenticateRest(rest) {\n    return (0, _utils.parseHTTPHeadersQuotedKeyValueSet)(rest, AUTHORIZED_WWW_AUTHENTICATE_KEYS, []);\n  },\n\n  /**\n   * Build the WWW Authenticate header rest.\n   * @param  {Object} data The content from wich to build the rest.\n   * @return {String}         The built rest.\n   * @example\n   * assert.equal(\n   *   BEARER.buildWWWAuthenticateRest({\n   *     realm: 'testrealm@host.com',\n   *     error: 'invalid_request',\n   *     error_description: 'The access token expired',\n   *   }),\n   *   'realm=\"testrealm@host.com\", ' +\n   *   'error=\"invalid_request\", ' +\n   *   'error_description=\"The access token expired\"'\n   * );\n   * @api public\n   */\n  buildWWWAuthenticateRest: function buildWWWAuthenticateRest(data) {\n    if (data.error && -1 === AUTHORIZED_ERROR_CODES.indexOf(data.error)) {\n      throw new _yerror.default('E_INVALID_ERROR', data.error, AUTHORIZED_ERROR_CODES);\n    }\n\n    return (0, _utils.buildHTTPHeadersQuotedKeyValueSet)(data, AUTHORIZED_WWW_AUTHENTICATE_KEYS, []);\n  },\n\n  /**\n   * Parse the Authorization header rest.\n   * @param  {String} rest The header rest (string after the authentication mechanism prefix).)\n   * @return {Object}      Object representing the result of the parse operation {hash}.\n   * @example\n   * assert.deepEqual(\n   *   BEARER.parseAuthorizationRest('mF_9.B5f-4.1JqM'), {\n   *     hash: 'mF_9.B5f-4.1JqM',\n   *   }\n   * );\n   * @api public\n   */\n  parseAuthorizationRest: function parseAuthorizationRest(rest) {\n    if (!rest) {\n      throw new _yerror.default('E_EMPTY_AUTH');\n    }\n\n    return {\n      hash: rest\n    };\n  },\n\n  /**\n   * Build the Authorization header rest.\n   * @param  {Object} content The content from wich to build the rest.\n   * @return {String}         The rest built.\n   * @example\n   * assert.equal(\n   *   BEARER.buildAuthorizationRest({\n   *     hash: 'mF_9.B5f-4.1JqM'\n   *   }),\n   *   'mF_9.B5f-4.1JqM=='\n   * );\n   * @api public\n   */\n  buildAuthorizationRest: function buildAuthorizationRest({\n    hash\n  }) {\n    if (!hash) {\n      throw new _yerror.default('E_NO_HASH');\n    }\n\n    return hash;\n  }\n};\nvar _default = BEARER;\nexports.default = _default;\n//# sourceMappingURL=bearer.js.map","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _utils = require(\"../utils\");\n\nvar _crypto = _interopRequireDefault(require(\"crypto\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * @module http-auth-utils/mechanisms/digest\n */\nconst REQUIRED_WWW_AUTHENTICATE_KEYS = ['realm', 'nonce'];\nconst AUTHORIZED_WWW_AUTHENTICATE_KEYS = [...REQUIRED_WWW_AUTHENTICATE_KEYS, 'domain', 'opaque', 'stale', 'algorithm', 'qop'];\nconst REQUIRED_AUTHORIZATION_KEYS = ['username', 'realm', 'nonce', 'uri', 'response'];\nconst AUTHORIZED_AUTHORIZATION_KEYS = [...REQUIRED_AUTHORIZATION_KEYS, 'algorithm', 'cnonce', 'opaque', 'qop', 'nc'];\n\n/* Architecture Note #1.3: Digest mechanism\n\nSee the following [RFC](https://tools.ietf.org/html/rfc2617).\n\n*/\n\n/**\n * Digest authentication mechanism.\n * @type {Object}\n * @see http://tools.ietf.org/html/rfc2617#section-3\n * @see http://tools.ietf.org/html/rfc2069#section-2\n */\nconst DIGEST = {\n  /**\n   * The Digest auth mechanism prefix.\n   * @type {String}\n   */\n  type: 'Digest',\n\n  /**\n   * Parse the WWW Authenticate header rest.\n   * @param  {String} rest The header rest (string after the authentication mechanism prefix).\n   * @return {Object}      Object representing the result of the parse operation.\n   * @example\n   * assert.deepEqual(\n   *   DIGEST.parseWWWAuthenticateRest(\n   *     'realm=\"testrealm@host.com\", ' +\n   *     'qop=\"auth, auth-int\", ' +\n   *     'nonce=\"dcd98b7102dd2f0e8b11d0f600bfb0c093\", ' +\n   *     'opaque=\"5ccc069c403ebaf9f0171e9517f40e41\"'\n   *   ), {\n   *     realm: 'testrealm@host.com',\n   *     qop: 'auth, auth-int',\n   *     nonce: 'dcd98b7102dd2f0e8b11d0f600bfb0c093',\n   *     opaque: '5ccc069c403ebaf9f0171e9517f40e41'\n   *   }\n   * );\n   * @api public\n   */\n  parseWWWAuthenticateRest: function parseWWWAuthenticateRest(rest) {\n    return (0, _utils.parseHTTPHeadersQuotedKeyValueSet)(rest, AUTHORIZED_WWW_AUTHENTICATE_KEYS, REQUIRED_WWW_AUTHENTICATE_KEYS);\n  },\n\n  /**\n   * Build the WWW Authenticate header rest.\n   * @param  {Object} data The content from wich to build the rest.\n   * @return {String}         The built rest.\n   * @example\n   * assert.equal(\n   *   DIGEST.buildWWWAuthenticateRest({\n   *     realm: 'testrealm@host.com',\n   *     qop: 'auth, auth-int',\n   *     nonce: 'dcd98b7102dd2f0e8b11d0f600bfb0c093',\n   *     opaque: '5ccc069c403ebaf9f0171e9517f40e41'\n   *   }),\n   *   'realm=\"testrealm@host.com\", ' +\n   *   'qop=\"auth, auth-int\", ' +\n   *   'nonce=\"dcd98b7102dd2f0e8b11d0f600bfb0c093\", ' +\n   *   'opaque=\"5ccc069c403ebaf9f0171e9517f40e41\"'\n   * );\n   * @api public\n   */\n  buildWWWAuthenticateRest: function buildWWWAuthenticateRest(data) {\n    return (0, _utils.buildHTTPHeadersQuotedKeyValueSet)(data, AUTHORIZED_WWW_AUTHENTICATE_KEYS, REQUIRED_WWW_AUTHENTICATE_KEYS);\n  },\n\n  /**\n   * Parse the Authorization header rest.\n   * @param  {String} rest The header rest (string after the authentication mechanism prefix).)\n   * @return {Object}      Object representing the result of the parse operation {hash}.\n   * @example\n   * assert.deepEqual(\n   *   DIGEST.parseAuthorizationRest(\n   *     'username=\"Mufasa\",' +\n   *     'realm=\"testrealm@host.com\",' +\n   *     'nonce=\"dcd98b7102dd2f0e8b11d0f600bfb0c093\",' +\n   *     'uri=\"/dir/index.html\",' +\n   *     'qop=\"auth\",' +\n   *     'nc=\"00000001\",' +\n   *     'cnonce=\"0a4f113b\",' +\n   *     'response=\"6629fae49393a05397450978507c4ef1\",' +\n   *     'opaque=\"5ccc069c403ebaf9f0171e9517f40e41\"'\n   *   ), {\n   *     username: \"Mufasa\",\n   *     realm: 'testrealm@host.com',\n   *     nonce: \"dcd98b7102dd2f0e8b11d0f600bfb0c093\",\n   *     uri: \"/dir/index.html\",\n   *     qop: 'auth',\n   *     nc: '00000001',\n   *     cnonce: \"0a4f113b\",\n   *     response: \"6629fae49393a05397450978507c4ef1\",\n   *     opaque: \"5ccc069c403ebaf9f0171e9517f40e41\"\n   *   }\n   * );\n   * @api public\n   */\n  parseAuthorizationRest: function parseAuthorizationRest(rest) {\n    return (0, _utils.parseHTTPHeadersQuotedKeyValueSet)(rest, AUTHORIZED_AUTHORIZATION_KEYS, REQUIRED_AUTHORIZATION_KEYS);\n  },\n\n  /**\n   * Build the Authorization header rest.\n   * @param  {Object} data The content from wich to build the rest.\n   * @return {String}         The rest built.\n   * @example\n   * assert.equal(\n   *   DIGEST.buildAuthorizationRest({\n   *     username: \"Mufasa\",\n   *     realm: 'testrealm@host.com',\n   *     nonce: \"dcd98b7102dd2f0e8b11d0f600bfb0c093\",\n   *     uri: \"/dir/index.html\",\n   *     qop: 'auth',\n   *     nc: '00000001',\n   *     cnonce: \"0a4f113b\",\n   *     response: \"6629fae49393a05397450978507c4ef1\",\n   *     opaque: \"5ccc069c403ebaf9f0171e9517f40e41\"\n   *   }),\n   *   'username=\"Mufasa\", ' +\n   *   'realm=\"testrealm@host.com\", ' +\n   *   'nonce=\"dcd98b7102dd2f0e8b11d0f600bfb0c093\", ' +\n   *   'uri=\"/dir/index.html\", ' +\n   *   'response=\"6629fae49393a05397450978507c4ef1\", ' +\n   *   'cnonce=\"0a4f113b\", ' +\n   *   'opaque=\"5ccc069c403ebaf9f0171e9517f40e41\", ' +\n   *   'qop=\"auth\", ' +\n   *   'nc=\"00000001\"'\n   * );\n   * @api public\n   */\n  buildAuthorizationRest: function buildAuthorizationRest(data) {\n    return (0, _utils.buildHTTPHeadersQuotedKeyValueSet)(data, AUTHORIZED_AUTHORIZATION_KEYS, REQUIRED_AUTHORIZATION_KEYS);\n  },\n\n  /**\n   * Compute the Digest authentication hash from the given credentials.\n   * @param  {Object} data The credentials to encode and other encoding details.\n   * @return {String}             The hash representing the credentials.\n   * @example\n   * assert.equal(\n   *   DIGEST.computeHash({\n   *     username: 'Mufasa',\n   *     realm: 'testrealm@host.com',\n   *     password: 'Circle Of Life',\n   *     method: 'GET',\n   *     uri: '/dir/index.html',\n   *     nonce: 'dcd98b7102dd2f0e8b11d0f600bfb0c093',\n   *     nc: '00000001',\n   *     cnonce: '0a4f113b',\n   *     qop: 'auth',\n   *     algorithm: 'md5'\n   *   }),\n   *   '6629fae49393a05397450978507c4ef1'\n   * );\n   * @api public\n   */\n  computeHash: function computeHash(data) {\n    const ha1 = data.ha1 || _computeHash(data.algorithm, [data.username, data.realm, data.password].join(':'));\n\n    const ha2 = _computeHash(data.algorithm, [data.method, data.uri].join(':'));\n\n    return _computeHash(data.algorithm, [ha1, data.nonce, data.nc, data.cnonce, data.qop, ha2].join(':'));\n  }\n};\n\nfunction _computeHash(algorithm, str) {\n  const hashsum = _crypto.default.createHash(algorithm);\n\n  hashsum.update(str);\n  return hashsum.digest('hex');\n}\n\nvar _default = DIGEST;\nexports.default = _default;\n//# sourceMappingURL=digest.js.map","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.parseHTTPHeadersQuotedKeyValueSet = parseHTTPHeadersQuotedKeyValueSet;\nexports.buildHTTPHeadersQuotedKeyValueSet = buildHTTPHeadersQuotedKeyValueSet;\n\nvar _yerror = _interopRequireDefault(require(\"yerror\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst QUOTE = '\"';\nconst EQUAL = '=';\nconst SEPARATOR = ', ';\n/*\n * Regular expression for matching the key-value pairs\n * \\w+     = The key\n * =       = The equal sign\n * \".*?\"   = Value option 1: A double-quoted value (using the non-greedy *? to stop at the first doublequote)\n * [^\",]+  = Value option 2: A string without commas or double-quotes\n * (?=,|$) = Zero-width (as in not captured) positive lookahead assertion.\n *           The previous match will only be valid if it's followed by a \" literal\n *           or the end of the string\n */\n\nconst KEYVALUE_REGEXP = /\\w+=(\".*?\"|[^\",]+)(?=,|$)/g; // FIXME: Create a real parser\n\nfunction parseHTTPHeadersQuotedKeyValueSet(contents, authorizedKeys, requiredKeys = []) {\n  const matches = contents.trim().match(KEYVALUE_REGEXP);\n  if (!matches) throw new _yerror.default('E_MALFORMED_QUOTEDKEYVALUE', contents);\n  const data = matches.map((part, partPosition) => {\n    const pair = part.split(EQUAL);\n\n    if (2 !== pair.length) {\n      throw new _yerror.default('E_MALFORMED_QUOTEDKEYVALUE', partPosition, part, pair.length);\n    }\n\n    return pair;\n  }).reduce(function (parsedValues, [name, value], valuePosition) {\n    if (-1 === authorizedKeys.indexOf(name)) {\n      throw new _yerror.default('E_UNAUTHORIZED_KEY', valuePosition, name);\n    }\n    /*\n     * Regular expression for stripping paired starting and ending double quotes off the value:\n     * ^      = The beginning of the string\n     * \"      = The first double quote\n     * .+     = One or more characters of any kind\n     * (?=\"$) = Zero-width (as in not captured) positive lookahead assertion.\n     *          The previous match will only be valid if it's followed by a \" literal\n     *          or the end of the string\n     * \"      = The ending double quote\n     * $      = The end of the string\n     */\n\n\n    parsedValues[name] = value.replace(/^\"(.+(?=\"$))\"$/, '$1');\n    return parsedValues;\n  }, {});\n\n  _checkRequiredKeys(requiredKeys, data);\n\n  return data;\n}\n\nfunction buildHTTPHeadersQuotedKeyValueSet(data, authorizedKeys, requiredKeys = []) {\n  _checkRequiredKeys(requiredKeys, data);\n\n  return authorizedKeys.reduce(function (contents, key) {\n    if (data[key]) {\n      return contents + (contents ? SEPARATOR : '') + key + EQUAL + QUOTE + data[key] + QUOTE;\n    }\n\n    return contents;\n  }, '');\n}\n\nfunction _checkRequiredKeys(requiredKeys, data) {\n  requiredKeys.forEach(name => {\n    if ('undefined' === typeof data[name]) {\n      throw new _yerror.default('E_REQUIRED_KEY', name);\n    }\n  });\n}\n//# sourceMappingURL=utils.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction ExpGolomInit(view, bitoffset) {\r\n    let bit = 0;\r\n    let byteoffset = bitoffset >> 3;\r\n    let skip = bitoffset & 7;\r\n    let zeros = -1;\r\n    let byt = view.getUint8(byteoffset) << skip;\r\n    do {\r\n        bit = byt & 0x80;\r\n        byt <<= 1;\r\n        zeros++;\r\n        skip++;\r\n        if (skip === 8) {\r\n            skip = 0;\r\n            byteoffset++;\r\n            byt = view.getUint8(byteoffset);\r\n        }\r\n    } while (!bit);\r\n    return { zeros, skip, byt, byteoffset };\r\n}\r\nconst shift16 = 2 ** 16;\r\nclass Bitstream {\r\n    constructor(view) {\r\n        this.view = view;\r\n        this.bitoffset = 0;\r\n    }\r\n    ExpGolomb() {\r\n        const { view } = this;\r\n        let { zeros, skip, byt, byteoffset, } = ExpGolomInit(view, this.bitoffset);\r\n        let code = 1;\r\n        while (zeros > 0) {\r\n            code = (code << 1) | ((byt & 0x80) >>> 7);\r\n            byt <<= 1;\r\n            skip++;\r\n            zeros--;\r\n            if (skip === 8) {\r\n                skip = 0;\r\n                byteoffset++;\r\n                byt = view.getUint8(byteoffset);\r\n            }\r\n        }\r\n        this.bitoffset = (byteoffset << 3) | skip;\r\n        return code - 1;\r\n    }\r\n    SignedExpGolomb() {\r\n        const code = this.ExpGolomb();\r\n        return code & 1 ? (code + 1) >>> 1 : -(code >>> 1);\r\n    }\r\n    readBit() {\r\n        const skip = this.bitoffset & 7;\r\n        const byteoffset = this.bitoffset >> 3;\r\n        this.bitoffset++;\r\n        return ((this.view.getUint8(byteoffset) >>> (7 - skip)) & 1);\r\n    }\r\n    readByte() {\r\n        const skip = this.bitoffset & 7;\r\n        const byteoffset = this.bitoffset >>> 3;\r\n        this.bitoffset += 8;\r\n        const high = this.view.getUint8(byteoffset);\r\n        if (skip === 0)\r\n            return high;\r\n        const low = this.view.getUint8(byteoffset + 1);\r\n        return (high << skip) | (low >>> (8 - skip));\r\n    }\r\n    readNibble() {\r\n        const skip = this.bitoffset & 7;\r\n        const byteoffset = this.bitoffset >> 3;\r\n        this.bitoffset += 4;\r\n        const high = this.view.getUint8(byteoffset);\r\n        if (skip === 0)\r\n            return high >>> 4;\r\n        if (skip <= 4)\r\n            return (high >>> (4 - skip)) & 0xf;\r\n        const low = this.view.getUint8(byteoffset + 1);\r\n        return ((high << (skip - 4)) | (low >>> (12 - skip))) & 0xf;\r\n    }\r\n    read5() {\r\n        const skip = this.bitoffset & 7;\r\n        const byteoffset = this.bitoffset >> 3;\r\n        this.bitoffset += 5;\r\n        const high = this.view.getUint8(byteoffset);\r\n        if (skip === 0)\r\n            return high >>> 3;\r\n        if (skip <= 3)\r\n            return (high >>> (3 - skip)) & 0x1f;\r\n        const low = this.view.getUint8(byteoffset + 1);\r\n        return ((high << (skip - 3)) | (low >>> (11 - skip))) & 0x1f;\r\n    }\r\n    readWord() {\r\n        const skip = this.bitoffset & 7;\r\n        const byteoffset = this.bitoffset >>> 3;\r\n        this.bitoffset += 32;\r\n        const { view } = this;\r\n        const tmp = (view.getUint16(byteoffset) * shift16) +\r\n            view.getUint16(byteoffset + 2);\r\n        if (skip === 0)\r\n            return tmp;\r\n        return (tmp * (2 ** skip)) + (view.getUint8(byteoffset + 4) >>> (8 - skip));\r\n    }\r\n    more_rbsp_data() {\r\n        const skip = this.bitoffset & 7;\r\n        let byteoffset = this.bitoffset >> 3;\r\n        const l = this.view.byteLength;\r\n        if (byteoffset >= l)\r\n            return false;\r\n        let byte = (this.view.getUint8(byteoffset) << skip) & 0xff;\r\n        let found_bit = byte > 0;\r\n        if (found_bit && !Number.isInteger(Math.log2(byte)))\r\n            return true;\r\n        while (++byteoffset < l) {\r\n            byte = this.view.getUint8(byteoffset);\r\n            const has_bit = byte > 0;\r\n            if (found_bit && has_bit)\r\n                return true;\r\n            if (has_bit && !Number.isInteger(Math.log2(byte)))\r\n                return true;\r\n            found_bit = found_bit || has_bit;\r\n        }\r\n        return false;\r\n    }\r\n}\r\nexports.Bitstream = Bitstream;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst bitstream_1 = require(\"./bitstream\");\r\nexports.Bitstream = bitstream_1.Bitstream;\r\nconst vui_1 = require(\"./vui\");\r\nfunction scaling_list(stream, sizeOfScalingList, use_default, i) {\r\n    let lastScale = 8;\r\n    let nextScale = 8;\r\n    const scalingList = [];\r\n    for (let j = 0; j < sizeOfScalingList; j++) {\r\n        if (nextScale !== 0) {\r\n            const deltaScale = stream.SignedExpGolomb();\r\n            nextScale = (lastScale + deltaScale + 256) % 256;\r\n            use_default[i] = +(j === 0 && nextScale === 0);\r\n        }\r\n        if (nextScale) {\r\n            lastScale = nextScale;\r\n        }\r\n        scalingList[j] = lastScale;\r\n    }\r\n    return scalingList;\r\n}\r\nfunction getFrameCropping(flag, stream) {\r\n    if (!flag)\r\n        return { left: 0, right: 0, top: 0, bottom: 0 };\r\n    const left = stream.ExpGolomb();\r\n    const right = stream.ExpGolomb();\r\n    const top = stream.ExpGolomb();\r\n    const bottom = stream.ExpGolomb();\r\n    return { left, right, top, bottom };\r\n}\r\nfunction parse(nalu) {\r\n    if ((nalu[0] & 0x1F) !== 7)\r\n        throw new Error(\"Not an SPS unit\");\r\n    const stream = new bitstream_1.Bitstream(new DataView(nalu.buffer, nalu.byteOffset + 4));\r\n    const profile_idc = nalu[1];\r\n    const profile_compatibility = nalu[2];\r\n    const level_idc = nalu[3];\r\n    const sps_id = stream.ExpGolomb();\r\n    let chroma_format_idc = 1;\r\n    let bit_depth_luma = 0;\r\n    let bit_depth_chroma = 0;\r\n    let color_plane_flag = 0;\r\n    let qpprime_y_zero_transform_bypass_flag = 0;\r\n    let seq_scaling_matrix_present_flag = 0;\r\n    const scaling_list_4x4 = [];\r\n    const scaling_list_8x8 = [];\r\n    const use_default_scaling_matrix_4x4_flag = [];\r\n    const use_default_scaling_matrix_8x8_flag = [];\r\n    if (profile_idc === 100 || profile_idc === 110 ||\r\n        profile_idc === 122 || profile_idc === 244 || profile_idc === 44 ||\r\n        profile_idc === 83 || profile_idc === 86 || profile_idc === 118 ||\r\n        profile_idc === 128 || profile_idc === 138 || profile_idc === 139 ||\r\n        profile_idc === 134 || profile_idc === 135) {\r\n        chroma_format_idc = stream.ExpGolomb();\r\n        let limit = 8;\r\n        if (chroma_format_idc === 3) {\r\n            limit = 12;\r\n            color_plane_flag = stream.readBit();\r\n        }\r\n        bit_depth_luma = stream.ExpGolomb() + 8;\r\n        bit_depth_chroma = stream.ExpGolomb() + 8;\r\n        qpprime_y_zero_transform_bypass_flag = stream.readBit();\r\n        seq_scaling_matrix_present_flag = stream.readBit();\r\n        if (seq_scaling_matrix_present_flag) {\r\n            let i = 0;\r\n            for (; i < 6; i++) {\r\n                if (stream.readBit()) { //seq_scaling_list_present_flag\r\n                    scaling_list_4x4.push(scaling_list(stream, 16, use_default_scaling_matrix_4x4_flag, i));\r\n                }\r\n            }\r\n            for (; i < limit; i++) {\r\n                if (stream.readBit()) { //seq_scaling_list_present_flag\r\n                    scaling_list_8x8.push(scaling_list(stream, 64, use_default_scaling_matrix_8x8_flag, i - 6));\r\n                }\r\n            }\r\n        }\r\n    }\r\n    const log2_max_frame_num = stream.ExpGolomb() + 4;\r\n    const pic_order_cnt_type = stream.ExpGolomb();\r\n    let delta_pic_order_always_zero_flag = 0;\r\n    let offset_for_non_ref_pic = 0;\r\n    let offset_for_top_to_bottom_field = 0;\r\n    const offset_for_ref_frame = [];\r\n    let log2_max_pic_order_cnt_lsb = 0;\r\n    if (pic_order_cnt_type === 0) {\r\n        log2_max_pic_order_cnt_lsb = stream.ExpGolomb() + 4;\r\n    }\r\n    else if (pic_order_cnt_type === 1) {\r\n        delta_pic_order_always_zero_flag = stream.readBit();\r\n        offset_for_non_ref_pic = stream.SignedExpGolomb();\r\n        offset_for_top_to_bottom_field = stream.SignedExpGolomb();\r\n        const num_ref_frames_in_pic_order_cnt_cycle = stream.ExpGolomb();\r\n        for (let i = 0; i < num_ref_frames_in_pic_order_cnt_cycle; i++) {\r\n            offset_for_ref_frame.push(stream.SignedExpGolomb());\r\n        }\r\n    }\r\n    const max_num_ref_frames = stream.ExpGolomb();\r\n    const gaps_in_frame_num_value_allowed_flag = stream.readBit();\r\n    const pic_width_in_mbs = stream.ExpGolomb() + 1;\r\n    const pic_height_in_map_units = stream.ExpGolomb() + 1;\r\n    const frame_mbs_only_flag = stream.readBit();\r\n    let mb_adaptive_frame_field_flag = 0;\r\n    if (!frame_mbs_only_flag) {\r\n        mb_adaptive_frame_field_flag = stream.readBit();\r\n    }\r\n    const direct_8x8_inference_flag = stream.readBit();\r\n    const frame_cropping_flag = stream.readBit();\r\n    const frame_cropping = getFrameCropping(frame_cropping_flag, stream);\r\n    const vui_parameters_present_flag = stream.readBit();\r\n    const vui_parameters = vui_1.getVUIParams(vui_parameters_present_flag, stream);\r\n    return {\r\n        sps_id,\r\n        profile_compatibility,\r\n        profile_idc,\r\n        level_idc,\r\n        chroma_format_idc,\r\n        bit_depth_luma,\r\n        bit_depth_chroma,\r\n        color_plane_flag,\r\n        qpprime_y_zero_transform_bypass_flag,\r\n        seq_scaling_matrix_present_flag,\r\n        seq_scaling_matrix: scaling_list_4x4,\r\n        log2_max_frame_num,\r\n        pic_order_cnt_type,\r\n        delta_pic_order_always_zero_flag,\r\n        offset_for_non_ref_pic,\r\n        offset_for_top_to_bottom_field,\r\n        offset_for_ref_frame,\r\n        log2_max_pic_order_cnt_lsb,\r\n        max_num_ref_frames,\r\n        gaps_in_frame_num_value_allowed_flag,\r\n        pic_width_in_mbs,\r\n        pic_height_in_map_units,\r\n        frame_mbs_only_flag,\r\n        mb_adaptive_frame_field_flag,\r\n        direct_8x8_inference_flag,\r\n        frame_cropping_flag,\r\n        frame_cropping,\r\n        vui_parameters_present_flag,\r\n        vui_parameters,\r\n    };\r\n}\r\nexports.parse = parse;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction hrd_parameters(hrd, stream) {\r\n    const cpb_cnt_minus1 = stream.ExpGolomb();\r\n    hrd.cpb_cnt = cpb_cnt_minus1 + 1;\r\n    hrd.bit_rate_scale = stream.readNibble();\r\n    hrd.cpb_size_scale = stream.readNibble();\r\n    for (let i = 0; i <= cpb_cnt_minus1; i++) {\r\n        hrd.bit_rate_value[i] = stream.ExpGolomb() + 1;\r\n        hrd.cpb_size_value[i] = stream.ExpGolomb() + 1;\r\n        hrd.cbr_flag[i] = stream.readBit();\r\n    }\r\n    hrd.initial_cpb_removal_delay_length = stream.read5() + 1;\r\n    hrd.cpb_removal_delay_length = stream.read5() + 1;\r\n    hrd.dpb_output_delay_length = stream.read5() + 1;\r\n    hrd.time_offset_length = stream.read5();\r\n}\r\nfunction getVUIParams(flag, stream) {\r\n    const vp = {\r\n        aspect_ratio_info_present_flag: 0,\r\n        aspect_ratio_idc: 0,\r\n        sar_width: 0,\r\n        sar_height: 0,\r\n        overscan_info_present_flag: 0,\r\n        overscan_appropriate_flag: 0,\r\n        video_signal_type_present_flag: 0,\r\n        video_format: 0,\r\n        video_full_range_flag: 0,\r\n        colour_description_present_flag: 0,\r\n        colour_primaries: 0,\r\n        transfer_characteristics: 0,\r\n        matrix_coefficients: 0,\r\n        chroma_loc_info_present_flag: 0,\r\n        chroma_sample_loc_type_top_field: 0,\r\n        chroma_sample_loc_type_bottom_field: 0,\r\n        timing_info_present_flag: 0,\r\n        num_units_in_tick: 0,\r\n        time_scale: 0,\r\n        fixed_frame_rate_flag: 0,\r\n        nal_hrd_parameters_present_flag: 0,\r\n        vcl_hrd_parameters_present_flag: 0,\r\n        hrd_params: {\r\n            cpb_cnt: 0,\r\n            bit_rate_scale: 0,\r\n            cpb_size_scale: 0,\r\n            bit_rate_value: [],\r\n            cpb_size_value: [],\r\n            cbr_flag: [],\r\n            initial_cpb_removal_delay_length: 0,\r\n            cpb_removal_delay_length: 0,\r\n            dpb_output_delay_length: 0,\r\n            time_offset_length: 0,\r\n        },\r\n        low_delay_hrd_flag: 0,\r\n        pic_struct_present_flag: 0,\r\n        bitstream_restriction_flag: 0,\r\n        motion_vectors_over_pic_boundaries_flag: 0,\r\n        max_bytes_per_pic_denom: 0,\r\n        max_bits_per_mb_denom: 0,\r\n        log2_max_mv_length_horizontal: 0,\r\n        log2_max_mv_length_vertical: 0,\r\n        num_reorder_frames: 0,\r\n        max_dec_frame_buffering: 0,\r\n    };\r\n    if (!flag)\r\n        return vp;\r\n    vp.aspect_ratio_info_present_flag = stream.readBit();\r\n    if (vp.aspect_ratio_info_present_flag) {\r\n        vp.aspect_ratio_idc = stream.ExpGolomb();\r\n        if (vp.aspect_ratio_idc === 255) { // Extended_SAR\r\n            vp.sar_width = stream.readByte();\r\n            vp.sar_height = stream.readByte();\r\n        }\r\n    }\r\n    vp.overscan_info_present_flag = stream.readBit();\r\n    if (vp.overscan_info_present_flag) {\r\n        vp.overscan_appropriate_flag = stream.readBit();\r\n    }\r\n    vp.video_signal_type_present_flag = stream.readBit();\r\n    if (vp.video_signal_type_present_flag) {\r\n        vp.video_format = (stream.readBit() << 2) |\r\n            (stream.readBit() << 1) |\r\n            stream.readBit();\r\n        vp.video_full_range_flag = stream.readBit();\r\n        vp.colour_description_present_flag = stream.readBit();\r\n        if (vp.colour_description_present_flag) {\r\n            vp.colour_primaries = stream.readByte();\r\n            vp.transfer_characteristics = stream.readByte();\r\n            vp.matrix_coefficients = stream.readByte();\r\n        }\r\n    }\r\n    vp.chroma_loc_info_present_flag = stream.readBit();\r\n    if (vp.chroma_loc_info_present_flag) {\r\n        vp.chroma_sample_loc_type_top_field = stream.ExpGolomb();\r\n        vp.chroma_sample_loc_type_bottom_field = stream.ExpGolomb();\r\n    }\r\n    vp.timing_info_present_flag = stream.readBit();\r\n    if (vp.timing_info_present_flag) {\r\n        vp.num_units_in_tick = stream.readWord();\r\n        vp.time_scale = stream.readWord();\r\n        vp.fixed_frame_rate_flag = stream.readBit();\r\n    }\r\n    vp.nal_hrd_parameters_present_flag = stream.readBit();\r\n    if (vp.nal_hrd_parameters_present_flag) {\r\n        hrd_parameters(vp.hrd_params, stream);\r\n    }\r\n    vp.vcl_hrd_parameters_present_flag = stream.readBit();\r\n    if (vp.vcl_hrd_parameters_present_flag) {\r\n        hrd_parameters(vp.hrd_params, stream);\r\n    }\r\n    if (vp.nal_hrd_parameters_present_flag || vp.vcl_hrd_parameters_present_flag) {\r\n        vp.low_delay_hrd_flag = stream.readBit();\r\n    }\r\n    vp.pic_struct_present_flag = stream.readBit();\r\n    vp.bitstream_restriction_flag = stream.readBit();\r\n    if (vp.bitstream_restriction_flag) {\r\n        vp.motion_vectors_over_pic_boundaries_flag = stream.readBit();\r\n        vp.max_bytes_per_pic_denom = stream.ExpGolomb();\r\n        vp.max_bits_per_mb_denom = stream.ExpGolomb();\r\n        vp.log2_max_mv_length_horizontal = stream.ExpGolomb();\r\n        vp.log2_max_mv_length_vertical = stream.ExpGolomb();\r\n        vp.num_reorder_frames = stream.ExpGolomb();\r\n        vp.max_dec_frame_buffering = stream.ExpGolomb();\r\n    }\r\n    return vp;\r\n}\r\nexports.getVUIParams = getVUIParams;\r\n","'use strict'\n\n// A linked list to keep track of recently-used-ness\nconst Yallist = require('yallist')\n\nconst MAX = Symbol('max')\nconst LENGTH = Symbol('length')\nconst LENGTH_CALCULATOR = Symbol('lengthCalculator')\nconst ALLOW_STALE = Symbol('allowStale')\nconst MAX_AGE = Symbol('maxAge')\nconst DISPOSE = Symbol('dispose')\nconst NO_DISPOSE_ON_SET = Symbol('noDisposeOnSet')\nconst LRU_LIST = Symbol('lruList')\nconst CACHE = Symbol('cache')\nconst UPDATE_AGE_ON_GET = Symbol('updateAgeOnGet')\n\nconst naiveLength = () => 1\n\n// lruList is a yallist where the head is the youngest\n// item, and the tail is the oldest.  the list contains the Hit\n// objects as the entries.\n// Each Hit object has a reference to its Yallist.Node.  This\n// never changes.\n//\n// cache is a Map (or PseudoMap) that matches the keys to\n// the Yallist.Node object.\nclass LRUCache {\n  constructor (options) {\n    if (typeof options === 'number')\n      options = { max: options }\n\n    if (!options)\n      options = {}\n\n    if (options.max && (typeof options.max !== 'number' || options.max < 0))\n      throw new TypeError('max must be a non-negative number')\n    // Kind of weird to have a default max of Infinity, but oh well.\n    const max = this[MAX] = options.max || Infinity\n\n    const lc = options.length || naiveLength\n    this[LENGTH_CALCULATOR] = (typeof lc !== 'function') ? naiveLength : lc\n    this[ALLOW_STALE] = options.stale || false\n    if (options.maxAge && typeof options.maxAge !== 'number')\n      throw new TypeError('maxAge must be a number')\n    this[MAX_AGE] = options.maxAge || 0\n    this[DISPOSE] = options.dispose\n    this[NO_DISPOSE_ON_SET] = options.noDisposeOnSet || false\n    this[UPDATE_AGE_ON_GET] = options.updateAgeOnGet || false\n    this.reset()\n  }\n\n  // resize the cache when the max changes.\n  set max (mL) {\n    if (typeof mL !== 'number' || mL < 0)\n      throw new TypeError('max must be a non-negative number')\n\n    this[MAX] = mL || Infinity\n    trim(this)\n  }\n  get max () {\n    return this[MAX]\n  }\n\n  set allowStale (allowStale) {\n    this[ALLOW_STALE] = !!allowStale\n  }\n  get allowStale () {\n    return this[ALLOW_STALE]\n  }\n\n  set maxAge (mA) {\n    if (typeof mA !== 'number')\n      throw new TypeError('maxAge must be a non-negative number')\n\n    this[MAX_AGE] = mA\n    trim(this)\n  }\n  get maxAge () {\n    return this[MAX_AGE]\n  }\n\n  // resize the cache when the lengthCalculator changes.\n  set lengthCalculator (lC) {\n    if (typeof lC !== 'function')\n      lC = naiveLength\n\n    if (lC !== this[LENGTH_CALCULATOR]) {\n      this[LENGTH_CALCULATOR] = lC\n      this[LENGTH] = 0\n      this[LRU_LIST].forEach(hit => {\n        hit.length = this[LENGTH_CALCULATOR](hit.value, hit.key)\n        this[LENGTH] += hit.length\n      })\n    }\n    trim(this)\n  }\n  get lengthCalculator () { return this[LENGTH_CALCULATOR] }\n\n  get length () { return this[LENGTH] }\n  get itemCount () { return this[LRU_LIST].length }\n\n  rforEach (fn, thisp) {\n    thisp = thisp || this\n    for (let walker = this[LRU_LIST].tail; walker !== null;) {\n      const prev = walker.prev\n      forEachStep(this, fn, walker, thisp)\n      walker = prev\n    }\n  }\n\n  forEach (fn, thisp) {\n    thisp = thisp || this\n    for (let walker = this[LRU_LIST].head; walker !== null;) {\n      const next = walker.next\n      forEachStep(this, fn, walker, thisp)\n      walker = next\n    }\n  }\n\n  keys () {\n    return this[LRU_LIST].toArray().map(k => k.key)\n  }\n\n  values () {\n    return this[LRU_LIST].toArray().map(k => k.value)\n  }\n\n  reset () {\n    if (this[DISPOSE] &&\n        this[LRU_LIST] &&\n        this[LRU_LIST].length) {\n      this[LRU_LIST].forEach(hit => this[DISPOSE](hit.key, hit.value))\n    }\n\n    this[CACHE] = new Map() // hash of items by key\n    this[LRU_LIST] = new Yallist() // list of items in order of use recency\n    this[LENGTH] = 0 // length of items in the list\n  }\n\n  dump () {\n    return this[LRU_LIST].map(hit =>\n      isStale(this, hit) ? false : {\n        k: hit.key,\n        v: hit.value,\n        e: hit.now + (hit.maxAge || 0)\n      }).toArray().filter(h => h)\n  }\n\n  dumpLru () {\n    return this[LRU_LIST]\n  }\n\n  set (key, value, maxAge) {\n    maxAge = maxAge || this[MAX_AGE]\n\n    if (maxAge && typeof maxAge !== 'number')\n      throw new TypeError('maxAge must be a number')\n\n    const now = maxAge ? Date.now() : 0\n    const len = this[LENGTH_CALCULATOR](value, key)\n\n    if (this[CACHE].has(key)) {\n      if (len > this[MAX]) {\n        del(this, this[CACHE].get(key))\n        return false\n      }\n\n      const node = this[CACHE].get(key)\n      const item = node.value\n\n      // dispose of the old one before overwriting\n      // split out into 2 ifs for better coverage tracking\n      if (this[DISPOSE]) {\n        if (!this[NO_DISPOSE_ON_SET])\n          this[DISPOSE](key, item.value)\n      }\n\n      item.now = now\n      item.maxAge = maxAge\n      item.value = value\n      this[LENGTH] += len - item.length\n      item.length = len\n      this.get(key)\n      trim(this)\n      return true\n    }\n\n    const hit = new Entry(key, value, len, now, maxAge)\n\n    // oversized objects fall out of cache automatically.\n    if (hit.length > this[MAX]) {\n      if (this[DISPOSE])\n        this[DISPOSE](key, value)\n\n      return false\n    }\n\n    this[LENGTH] += hit.length\n    this[LRU_LIST].unshift(hit)\n    this[CACHE].set(key, this[LRU_LIST].head)\n    trim(this)\n    return true\n  }\n\n  has (key) {\n    if (!this[CACHE].has(key)) return false\n    const hit = this[CACHE].get(key).value\n    return !isStale(this, hit)\n  }\n\n  get (key) {\n    return get(this, key, true)\n  }\n\n  peek (key) {\n    return get(this, key, false)\n  }\n\n  pop () {\n    const node = this[LRU_LIST].tail\n    if (!node)\n      return null\n\n    del(this, node)\n    return node.value\n  }\n\n  del (key) {\n    del(this, this[CACHE].get(key))\n  }\n\n  load (arr) {\n    // reset the cache\n    this.reset()\n\n    const now = Date.now()\n    // A previous serialized cache has the most recent items first\n    for (let l = arr.length - 1; l >= 0; l--) {\n      const hit = arr[l]\n      const expiresAt = hit.e || 0\n      if (expiresAt === 0)\n        // the item was created without expiration in a non aged cache\n        this.set(hit.k, hit.v)\n      else {\n        const maxAge = expiresAt - now\n        // dont add already expired items\n        if (maxAge > 0) {\n          this.set(hit.k, hit.v, maxAge)\n        }\n      }\n    }\n  }\n\n  prune () {\n    this[CACHE].forEach((value, key) => get(this, key, false))\n  }\n}\n\nconst get = (self, key, doUse) => {\n  const node = self[CACHE].get(key)\n  if (node) {\n    const hit = node.value\n    if (isStale(self, hit)) {\n      del(self, node)\n      if (!self[ALLOW_STALE])\n        return undefined\n    } else {\n      if (doUse) {\n        if (self[UPDATE_AGE_ON_GET])\n          node.value.now = Date.now()\n        self[LRU_LIST].unshiftNode(node)\n      }\n    }\n    return hit.value\n  }\n}\n\nconst isStale = (self, hit) => {\n  if (!hit || (!hit.maxAge && !self[MAX_AGE]))\n    return false\n\n  const diff = Date.now() - hit.now\n  return hit.maxAge ? diff > hit.maxAge\n    : self[MAX_AGE] && (diff > self[MAX_AGE])\n}\n\nconst trim = self => {\n  if (self[LENGTH] > self[MAX]) {\n    for (let walker = self[LRU_LIST].tail;\n      self[LENGTH] > self[MAX] && walker !== null;) {\n      // We know that we're about to delete this one, and also\n      // what the next least recently used key will be, so just\n      // go ahead and set it now.\n      const prev = walker.prev\n      del(self, walker)\n      walker = prev\n    }\n  }\n}\n\nconst del = (self, node) => {\n  if (node) {\n    const hit = node.value\n    if (self[DISPOSE])\n      self[DISPOSE](hit.key, hit.value)\n\n    self[LENGTH] -= hit.length\n    self[CACHE].delete(hit.key)\n    self[LRU_LIST].removeNode(node)\n  }\n}\n\nclass Entry {\n  constructor (key, value, length, now, maxAge) {\n    this.key = key\n    this.value = value\n    this.length = length\n    this.now = now\n    this.maxAge = maxAge || 0\n  }\n}\n\nconst forEachStep = (self, fn, node, thisp) => {\n  let hit = node.value\n  if (isStale(self, hit)) {\n    del(self, node)\n    if (!self[ALLOW_STALE])\n      hit = undefined\n  }\n  if (hit)\n    fn.call(thisp, hit.value, hit.key, self)\n}\n\nmodule.exports = LRUCache\n","const ANY = Symbol('SemVer ANY')\n// hoisted class for cyclic dependency\nclass Comparator {\n  static get ANY () {\n    return ANY\n  }\n\n  constructor (comp, options) {\n    options = parseOptions(options)\n\n    if (comp instanceof Comparator) {\n      if (comp.loose === !!options.loose) {\n        return comp\n      } else {\n        comp = comp.value\n      }\n    }\n\n    debug('comparator', comp, options)\n    this.options = options\n    this.loose = !!options.loose\n    this.parse(comp)\n\n    if (this.semver === ANY) {\n      this.value = ''\n    } else {\n      this.value = this.operator + this.semver.version\n    }\n\n    debug('comp', this)\n  }\n\n  parse (comp) {\n    const r = this.options.loose ? re[t.COMPARATORLOOSE] : re[t.COMPARATOR]\n    const m = comp.match(r)\n\n    if (!m) {\n      throw new TypeError(`Invalid comparator: ${comp}`)\n    }\n\n    this.operator = m[1] !== undefined ? m[1] : ''\n    if (this.operator === '=') {\n      this.operator = ''\n    }\n\n    // if it literally is just '>' or '' then allow anything.\n    if (!m[2]) {\n      this.semver = ANY\n    } else {\n      this.semver = new SemVer(m[2], this.options.loose)\n    }\n  }\n\n  toString () {\n    return this.value\n  }\n\n  test (version) {\n    debug('Comparator.test', version, this.options.loose)\n\n    if (this.semver === ANY || version === ANY) {\n      return true\n    }\n\n    if (typeof version === 'string') {\n      try {\n        version = new SemVer(version, this.options)\n      } catch (er) {\n        return false\n      }\n    }\n\n    return cmp(version, this.operator, this.semver, this.options)\n  }\n\n  intersects (comp, options) {\n    if (!(comp instanceof Comparator)) {\n      throw new TypeError('a Comparator is required')\n    }\n\n    if (!options || typeof options !== 'object') {\n      options = {\n        loose: !!options,\n        includePrerelease: false,\n      }\n    }\n\n    if (this.operator === '') {\n      if (this.value === '') {\n        return true\n      }\n      return new Range(comp.value, options).test(this.value)\n    } else if (comp.operator === '') {\n      if (comp.value === '') {\n        return true\n      }\n      return new Range(this.value, options).test(comp.semver)\n    }\n\n    const sameDirectionIncreasing =\n      (this.operator === '>=' || this.operator === '>') &&\n      (comp.operator === '>=' || comp.operator === '>')\n    const sameDirectionDecreasing =\n      (this.operator === '<=' || this.operator === '<') &&\n      (comp.operator === '<=' || comp.operator === '<')\n    const sameSemVer = this.semver.version === comp.semver.version\n    const differentDirectionsInclusive =\n      (this.operator === '>=' || this.operator === '<=') &&\n      (comp.operator === '>=' || comp.operator === '<=')\n    const oppositeDirectionsLessThan =\n      cmp(this.semver, '<', comp.semver, options) &&\n      (this.operator === '>=' || this.operator === '>') &&\n        (comp.operator === '<=' || comp.operator === '<')\n    const oppositeDirectionsGreaterThan =\n      cmp(this.semver, '>', comp.semver, options) &&\n      (this.operator === '<=' || this.operator === '<') &&\n        (comp.operator === '>=' || comp.operator === '>')\n\n    return (\n      sameDirectionIncreasing ||\n      sameDirectionDecreasing ||\n      (sameSemVer && differentDirectionsInclusive) ||\n      oppositeDirectionsLessThan ||\n      oppositeDirectionsGreaterThan\n    )\n  }\n}\n\nmodule.exports = Comparator\n\nconst parseOptions = require('../internal/parse-options')\nconst { re, t } = require('../internal/re')\nconst cmp = require('../functions/cmp')\nconst debug = require('../internal/debug')\nconst SemVer = require('./semver')\nconst Range = require('./range')\n","// hoisted class for cyclic dependency\nclass Range {\n  constructor (range, options) {\n    options = parseOptions(options)\n\n    if (range instanceof Range) {\n      if (\n        range.loose === !!options.loose &&\n        range.includePrerelease === !!options.includePrerelease\n      ) {\n        return range\n      } else {\n        return new Range(range.raw, options)\n      }\n    }\n\n    if (range instanceof Comparator) {\n      // just put it in the set and return\n      this.raw = range.value\n      this.set = [[range]]\n      this.format()\n      return this\n    }\n\n    this.options = options\n    this.loose = !!options.loose\n    this.includePrerelease = !!options.includePrerelease\n\n    // First, split based on boolean or ||\n    this.raw = range\n    this.set = range\n      .split('||')\n      // map the range to a 2d array of comparators\n      .map(r => this.parseRange(r.trim()))\n      // throw out any comparator lists that are empty\n      // this generally means that it was not a valid range, which is allowed\n      // in loose mode, but will still throw if the WHOLE range is invalid.\n      .filter(c => c.length)\n\n    if (!this.set.length) {\n      throw new TypeError(`Invalid SemVer Range: ${range}`)\n    }\n\n    // if we have any that are not the null set, throw out null sets.\n    if (this.set.length > 1) {\n      // keep the first one, in case they're all null sets\n      const first = this.set[0]\n      this.set = this.set.filter(c => !isNullSet(c[0]))\n      if (this.set.length === 0) {\n        this.set = [first]\n      } else if (this.set.length > 1) {\n        // if we have any that are *, then the range is just *\n        for (const c of this.set) {\n          if (c.length === 1 && isAny(c[0])) {\n            this.set = [c]\n            break\n          }\n        }\n      }\n    }\n\n    this.format()\n  }\n\n  format () {\n    this.range = this.set\n      .map((comps) => {\n        return comps.join(' ').trim()\n      })\n      .join('||')\n      .trim()\n    return this.range\n  }\n\n  toString () {\n    return this.range\n  }\n\n  parseRange (range) {\n    range = range.trim()\n\n    // memoize range parsing for performance.\n    // this is a very hot path, and fully deterministic.\n    const memoOpts = Object.keys(this.options).join(',')\n    const memoKey = `parseRange:${memoOpts}:${range}`\n    const cached = cache.get(memoKey)\n    if (cached) {\n      return cached\n    }\n\n    const loose = this.options.loose\n    // `1.2.3 - 1.2.4` => `>=1.2.3 <=1.2.4`\n    const hr = loose ? re[t.HYPHENRANGELOOSE] : re[t.HYPHENRANGE]\n    range = range.replace(hr, hyphenReplace(this.options.includePrerelease))\n    debug('hyphen replace', range)\n    // `> 1.2.3 < 1.2.5` => `>1.2.3 <1.2.5`\n    range = range.replace(re[t.COMPARATORTRIM], comparatorTrimReplace)\n    debug('comparator trim', range)\n\n    // `~ 1.2.3` => `~1.2.3`\n    range = range.replace(re[t.TILDETRIM], tildeTrimReplace)\n\n    // `^ 1.2.3` => `^1.2.3`\n    range = range.replace(re[t.CARETTRIM], caretTrimReplace)\n\n    // normalize spaces\n    range = range.split(/\\s+/).join(' ')\n\n    // At this point, the range is completely trimmed and\n    // ready to be split into comparators.\n\n    let rangeList = range\n      .split(' ')\n      .map(comp => parseComparator(comp, this.options))\n      .join(' ')\n      .split(/\\s+/)\n      // >=0.0.0 is equivalent to *\n      .map(comp => replaceGTE0(comp, this.options))\n\n    if (loose) {\n      // in loose mode, throw out any that are not valid comparators\n      rangeList = rangeList.filter(comp => {\n        debug('loose invalid filter', comp, this.options)\n        return !!comp.match(re[t.COMPARATORLOOSE])\n      })\n    }\n    debug('range list', rangeList)\n\n    // if any comparators are the null set, then replace with JUST null set\n    // if more than one comparator, remove any * comparators\n    // also, don't include the same comparator more than once\n    const rangeMap = new Map()\n    const comparators = rangeList.map(comp => new Comparator(comp, this.options))\n    for (const comp of comparators) {\n      if (isNullSet(comp)) {\n        return [comp]\n      }\n      rangeMap.set(comp.value, comp)\n    }\n    if (rangeMap.size > 1 && rangeMap.has('')) {\n      rangeMap.delete('')\n    }\n\n    const result = [...rangeMap.values()]\n    cache.set(memoKey, result)\n    return result\n  }\n\n  intersects (range, options) {\n    if (!(range instanceof Range)) {\n      throw new TypeError('a Range is required')\n    }\n\n    return this.set.some((thisComparators) => {\n      return (\n        isSatisfiable(thisComparators, options) &&\n        range.set.some((rangeComparators) => {\n          return (\n            isSatisfiable(rangeComparators, options) &&\n            thisComparators.every((thisComparator) => {\n              return rangeComparators.every((rangeComparator) => {\n                return thisComparator.intersects(rangeComparator, options)\n              })\n            })\n          )\n        })\n      )\n    })\n  }\n\n  // if ANY of the sets match ALL of its comparators, then pass\n  test (version) {\n    if (!version) {\n      return false\n    }\n\n    if (typeof version === 'string') {\n      try {\n        version = new SemVer(version, this.options)\n      } catch (er) {\n        return false\n      }\n    }\n\n    for (let i = 0; i < this.set.length; i++) {\n      if (testSet(this.set[i], version, this.options)) {\n        return true\n      }\n    }\n    return false\n  }\n}\nmodule.exports = Range\n\nconst LRU = require('lru-cache')\nconst cache = new LRU({ max: 1000 })\n\nconst parseOptions = require('../internal/parse-options')\nconst Comparator = require('./comparator')\nconst debug = require('../internal/debug')\nconst SemVer = require('./semver')\nconst {\n  re,\n  t,\n  comparatorTrimReplace,\n  tildeTrimReplace,\n  caretTrimReplace,\n} = require('../internal/re')\n\nconst isNullSet = c => c.value === '<0.0.0-0'\nconst isAny = c => c.value === ''\n\n// take a set of comparators and determine whether there\n// exists a version which can satisfy it\nconst isSatisfiable = (comparators, options) => {\n  let result = true\n  const remainingComparators = comparators.slice()\n  let testComparator = remainingComparators.pop()\n\n  while (result && remainingComparators.length) {\n    result = remainingComparators.every((otherComparator) => {\n      return testComparator.intersects(otherComparator, options)\n    })\n\n    testComparator = remainingComparators.pop()\n  }\n\n  return result\n}\n\n// comprised of xranges, tildes, stars, and gtlt's at this point.\n// already replaced the hyphen ranges\n// turn into a set of JUST comparators.\nconst parseComparator = (comp, options) => {\n  debug('comp', comp, options)\n  comp = replaceCarets(comp, options)\n  debug('caret', comp)\n  comp = replaceTildes(comp, options)\n  debug('tildes', comp)\n  comp = replaceXRanges(comp, options)\n  debug('xrange', comp)\n  comp = replaceStars(comp, options)\n  debug('stars', comp)\n  return comp\n}\n\nconst isX = id => !id || id.toLowerCase() === 'x' || id === '*'\n\n// ~, ~> --> * (any, kinda silly)\n// ~2, ~2.x, ~2.x.x, ~>2, ~>2.x ~>2.x.x --> >=2.0.0 <3.0.0-0\n// ~2.0, ~2.0.x, ~>2.0, ~>2.0.x --> >=2.0.0 <2.1.0-0\n// ~1.2, ~1.2.x, ~>1.2, ~>1.2.x --> >=1.2.0 <1.3.0-0\n// ~1.2.3, ~>1.2.3 --> >=1.2.3 <1.3.0-0\n// ~1.2.0, ~>1.2.0 --> >=1.2.0 <1.3.0-0\nconst replaceTildes = (comp, options) =>\n  comp.trim().split(/\\s+/).map((c) => {\n    return replaceTilde(c, options)\n  }).join(' ')\n\nconst replaceTilde = (comp, options) => {\n  const r = options.loose ? re[t.TILDELOOSE] : re[t.TILDE]\n  return comp.replace(r, (_, M, m, p, pr) => {\n    debug('tilde', comp, _, M, m, p, pr)\n    let ret\n\n    if (isX(M)) {\n      ret = ''\n    } else if (isX(m)) {\n      ret = `>=${M}.0.0 <${+M + 1}.0.0-0`\n    } else if (isX(p)) {\n      // ~1.2 == >=1.2.0 <1.3.0-0\n      ret = `>=${M}.${m}.0 <${M}.${+m + 1}.0-0`\n    } else if (pr) {\n      debug('replaceTilde pr', pr)\n      ret = `>=${M}.${m}.${p}-${pr\n      } <${M}.${+m + 1}.0-0`\n    } else {\n      // ~1.2.3 == >=1.2.3 <1.3.0-0\n      ret = `>=${M}.${m}.${p\n      } <${M}.${+m + 1}.0-0`\n    }\n\n    debug('tilde return', ret)\n    return ret\n  })\n}\n\n// ^ --> * (any, kinda silly)\n// ^2, ^2.x, ^2.x.x --> >=2.0.0 <3.0.0-0\n// ^2.0, ^2.0.x --> >=2.0.0 <3.0.0-0\n// ^1.2, ^1.2.x --> >=1.2.0 <2.0.0-0\n// ^1.2.3 --> >=1.2.3 <2.0.0-0\n// ^1.2.0 --> >=1.2.0 <2.0.0-0\nconst replaceCarets = (comp, options) =>\n  comp.trim().split(/\\s+/).map((c) => {\n    return replaceCaret(c, options)\n  }).join(' ')\n\nconst replaceCaret = (comp, options) => {\n  debug('caret', comp, options)\n  const r = options.loose ? re[t.CARETLOOSE] : re[t.CARET]\n  const z = options.includePrerelease ? '-0' : ''\n  return comp.replace(r, (_, M, m, p, pr) => {\n    debug('caret', comp, _, M, m, p, pr)\n    let ret\n\n    if (isX(M)) {\n      ret = ''\n    } else if (isX(m)) {\n      ret = `>=${M}.0.0${z} <${+M + 1}.0.0-0`\n    } else if (isX(p)) {\n      if (M === '0') {\n        ret = `>=${M}.${m}.0${z} <${M}.${+m + 1}.0-0`\n      } else {\n        ret = `>=${M}.${m}.0${z} <${+M + 1}.0.0-0`\n      }\n    } else if (pr) {\n      debug('replaceCaret pr', pr)\n      if (M === '0') {\n        if (m === '0') {\n          ret = `>=${M}.${m}.${p}-${pr\n          } <${M}.${m}.${+p + 1}-0`\n        } else {\n          ret = `>=${M}.${m}.${p}-${pr\n          } <${M}.${+m + 1}.0-0`\n        }\n      } else {\n        ret = `>=${M}.${m}.${p}-${pr\n        } <${+M + 1}.0.0-0`\n      }\n    } else {\n      debug('no pr')\n      if (M === '0') {\n        if (m === '0') {\n          ret = `>=${M}.${m}.${p\n          }${z} <${M}.${m}.${+p + 1}-0`\n        } else {\n          ret = `>=${M}.${m}.${p\n          }${z} <${M}.${+m + 1}.0-0`\n        }\n      } else {\n        ret = `>=${M}.${m}.${p\n        } <${+M + 1}.0.0-0`\n      }\n    }\n\n    debug('caret return', ret)\n    return ret\n  })\n}\n\nconst replaceXRanges = (comp, options) => {\n  debug('replaceXRanges', comp, options)\n  return comp.split(/\\s+/).map((c) => {\n    return replaceXRange(c, options)\n  }).join(' ')\n}\n\nconst replaceXRange = (comp, options) => {\n  comp = comp.trim()\n  const r = options.loose ? re[t.XRANGELOOSE] : re[t.XRANGE]\n  return comp.replace(r, (ret, gtlt, M, m, p, pr) => {\n    debug('xRange', comp, ret, gtlt, M, m, p, pr)\n    const xM = isX(M)\n    const xm = xM || isX(m)\n    const xp = xm || isX(p)\n    const anyX = xp\n\n    if (gtlt === '=' && anyX) {\n      gtlt = ''\n    }\n\n    // if we're including prereleases in the match, then we need\n    // to fix this to -0, the lowest possible prerelease value\n    pr = options.includePrerelease ? '-0' : ''\n\n    if (xM) {\n      if (gtlt === '>' || gtlt === '<') {\n        // nothing is allowed\n        ret = '<0.0.0-0'\n      } else {\n        // nothing is forbidden\n        ret = '*'\n      }\n    } else if (gtlt && anyX) {\n      // we know patch is an x, because we have any x at all.\n      // replace X with 0\n      if (xm) {\n        m = 0\n      }\n      p = 0\n\n      if (gtlt === '>') {\n        // >1 => >=2.0.0\n        // >1.2 => >=1.3.0\n        gtlt = '>='\n        if (xm) {\n          M = +M + 1\n          m = 0\n          p = 0\n        } else {\n          m = +m + 1\n          p = 0\n        }\n      } else if (gtlt === '<=') {\n        // <=0.7.x is actually <0.8.0, since any 0.7.x should\n        // pass.  Similarly, <=7.x is actually <8.0.0, etc.\n        gtlt = '<'\n        if (xm) {\n          M = +M + 1\n        } else {\n          m = +m + 1\n        }\n      }\n\n      if (gtlt === '<') {\n        pr = '-0'\n      }\n\n      ret = `${gtlt + M}.${m}.${p}${pr}`\n    } else if (xm) {\n      ret = `>=${M}.0.0${pr} <${+M + 1}.0.0-0`\n    } else if (xp) {\n      ret = `>=${M}.${m}.0${pr\n      } <${M}.${+m + 1}.0-0`\n    }\n\n    debug('xRange return', ret)\n\n    return ret\n  })\n}\n\n// Because * is AND-ed with everything else in the comparator,\n// and '' means \"any version\", just remove the *s entirely.\nconst replaceStars = (comp, options) => {\n  debug('replaceStars', comp, options)\n  // Looseness is ignored here.  star is always as loose as it gets!\n  return comp.trim().replace(re[t.STAR], '')\n}\n\nconst replaceGTE0 = (comp, options) => {\n  debug('replaceGTE0', comp, options)\n  return comp.trim()\n    .replace(re[options.includePrerelease ? t.GTE0PRE : t.GTE0], '')\n}\n\n// This function is passed to string.replace(re[t.HYPHENRANGE])\n// M, m, patch, prerelease, build\n// 1.2 - 3.4.5 => >=1.2.0 <=3.4.5\n// 1.2.3 - 3.4 => >=1.2.0 <3.5.0-0 Any 3.4.x will do\n// 1.2 - 3.4 => >=1.2.0 <3.5.0-0\nconst hyphenReplace = incPr => ($0,\n  from, fM, fm, fp, fpr, fb,\n  to, tM, tm, tp, tpr, tb) => {\n  if (isX(fM)) {\n    from = ''\n  } else if (isX(fm)) {\n    from = `>=${fM}.0.0${incPr ? '-0' : ''}`\n  } else if (isX(fp)) {\n    from = `>=${fM}.${fm}.0${incPr ? '-0' : ''}`\n  } else if (fpr) {\n    from = `>=${from}`\n  } else {\n    from = `>=${from}${incPr ? '-0' : ''}`\n  }\n\n  if (isX(tM)) {\n    to = ''\n  } else if (isX(tm)) {\n    to = `<${+tM + 1}.0.0-0`\n  } else if (isX(tp)) {\n    to = `<${tM}.${+tm + 1}.0-0`\n  } else if (tpr) {\n    to = `<=${tM}.${tm}.${tp}-${tpr}`\n  } else if (incPr) {\n    to = `<${tM}.${tm}.${+tp + 1}-0`\n  } else {\n    to = `<=${to}`\n  }\n\n  return (`${from} ${to}`).trim()\n}\n\nconst testSet = (set, version, options) => {\n  for (let i = 0; i < set.length; i++) {\n    if (!set[i].test(version)) {\n      return false\n    }\n  }\n\n  if (version.prerelease.length && !options.includePrerelease) {\n    // Find the set of versions that are allowed to have prereleases\n    // For example, ^1.2.3-pr.1 desugars to >=1.2.3-pr.1 <2.0.0\n    // That should allow `1.2.3-pr.2` to pass.\n    // However, `1.2.4-alpha.notready` should NOT be allowed,\n    // even though it's within the range set by the comparators.\n    for (let i = 0; i < set.length; i++) {\n      debug(set[i].semver)\n      if (set[i].semver === Comparator.ANY) {\n        continue\n      }\n\n      if (set[i].semver.prerelease.length > 0) {\n        const allowed = set[i].semver\n        if (allowed.major === version.major &&\n            allowed.minor === version.minor &&\n            allowed.patch === version.patch) {\n          return true\n        }\n      }\n    }\n\n    // Version has a -pre, but it's not one of the ones we like.\n    return false\n  }\n\n  return true\n}\n","const debug = require('../internal/debug')\nconst { MAX_LENGTH, MAX_SAFE_INTEGER } = require('../internal/constants')\nconst { re, t } = require('../internal/re')\n\nconst parseOptions = require('../internal/parse-options')\nconst { compareIdentifiers } = require('../internal/identifiers')\nclass SemVer {\n  constructor (version, options) {\n    options = parseOptions(options)\n\n    if (version instanceof SemVer) {\n      if (version.loose === !!options.loose &&\n          version.includePrerelease === !!options.includePrerelease) {\n        return version\n      } else {\n        version = version.version\n      }\n    } else if (typeof version !== 'string') {\n      throw new TypeError(`Invalid Version: ${version}`)\n    }\n\n    if (version.length > MAX_LENGTH) {\n      throw new TypeError(\n        `version is longer than ${MAX_LENGTH} characters`\n      )\n    }\n\n    debug('SemVer', version, options)\n    this.options = options\n    this.loose = !!options.loose\n    // this isn't actually relevant for versions, but keep it so that we\n    // don't run into trouble passing this.options around.\n    this.includePrerelease = !!options.includePrerelease\n\n    const m = version.trim().match(options.loose ? re[t.LOOSE] : re[t.FULL])\n\n    if (!m) {\n      throw new TypeError(`Invalid Version: ${version}`)\n    }\n\n    this.raw = version\n\n    // these are actually numbers\n    this.major = +m[1]\n    this.minor = +m[2]\n    this.patch = +m[3]\n\n    if (this.major > MAX_SAFE_INTEGER || this.major < 0) {\n      throw new TypeError('Invalid major version')\n    }\n\n    if (this.minor > MAX_SAFE_INTEGER || this.minor < 0) {\n      throw new TypeError('Invalid minor version')\n    }\n\n    if (this.patch > MAX_SAFE_INTEGER || this.patch < 0) {\n      throw new TypeError('Invalid patch version')\n    }\n\n    // numberify any prerelease numeric ids\n    if (!m[4]) {\n      this.prerelease = []\n    } else {\n      this.prerelease = m[4].split('.').map((id) => {\n        if (/^[0-9]+$/.test(id)) {\n          const num = +id\n          if (num >= 0 && num < MAX_SAFE_INTEGER) {\n            return num\n          }\n        }\n        return id\n      })\n    }\n\n    this.build = m[5] ? m[5].split('.') : []\n    this.format()\n  }\n\n  format () {\n    this.version = `${this.major}.${this.minor}.${this.patch}`\n    if (this.prerelease.length) {\n      this.version += `-${this.prerelease.join('.')}`\n    }\n    return this.version\n  }\n\n  toString () {\n    return this.version\n  }\n\n  compare (other) {\n    debug('SemVer.compare', this.version, this.options, other)\n    if (!(other instanceof SemVer)) {\n      if (typeof other === 'string' && other === this.version) {\n        return 0\n      }\n      other = new SemVer(other, this.options)\n    }\n\n    if (other.version === this.version) {\n      return 0\n    }\n\n    return this.compareMain(other) || this.comparePre(other)\n  }\n\n  compareMain (other) {\n    if (!(other instanceof SemVer)) {\n      other = new SemVer(other, this.options)\n    }\n\n    return (\n      compareIdentifiers(this.major, other.major) ||\n      compareIdentifiers(this.minor, other.minor) ||\n      compareIdentifiers(this.patch, other.patch)\n    )\n  }\n\n  comparePre (other) {\n    if (!(other instanceof SemVer)) {\n      other = new SemVer(other, this.options)\n    }\n\n    // NOT having a prerelease is > having one\n    if (this.prerelease.length && !other.prerelease.length) {\n      return -1\n    } else if (!this.prerelease.length && other.prerelease.length) {\n      return 1\n    } else if (!this.prerelease.length && !other.prerelease.length) {\n      return 0\n    }\n\n    let i = 0\n    do {\n      const a = this.prerelease[i]\n      const b = other.prerelease[i]\n      debug('prerelease compare', i, a, b)\n      if (a === undefined && b === undefined) {\n        return 0\n      } else if (b === undefined) {\n        return 1\n      } else if (a === undefined) {\n        return -1\n      } else if (a === b) {\n        continue\n      } else {\n        return compareIdentifiers(a, b)\n      }\n    } while (++i)\n  }\n\n  compareBuild (other) {\n    if (!(other instanceof SemVer)) {\n      other = new SemVer(other, this.options)\n    }\n\n    let i = 0\n    do {\n      const a = this.build[i]\n      const b = other.build[i]\n      debug('prerelease compare', i, a, b)\n      if (a === undefined && b === undefined) {\n        return 0\n      } else if (b === undefined) {\n        return 1\n      } else if (a === undefined) {\n        return -1\n      } else if (a === b) {\n        continue\n      } else {\n        return compareIdentifiers(a, b)\n      }\n    } while (++i)\n  }\n\n  // preminor will bump the version up to the next minor release, and immediately\n  // down to pre-release. premajor and prepatch work the same way.\n  inc (release, identifier) {\n    switch (release) {\n      case 'premajor':\n        this.prerelease.length = 0\n        this.patch = 0\n        this.minor = 0\n        this.major++\n        this.inc('pre', identifier)\n        break\n      case 'preminor':\n        this.prerelease.length = 0\n        this.patch = 0\n        this.minor++\n        this.inc('pre', identifier)\n        break\n      case 'prepatch':\n        // If this is already a prerelease, it will bump to the next version\n        // drop any prereleases that might already exist, since they are not\n        // relevant at this point.\n        this.prerelease.length = 0\n        this.inc('patch', identifier)\n        this.inc('pre', identifier)\n        break\n      // If the input is a non-prerelease version, this acts the same as\n      // prepatch.\n      case 'prerelease':\n        if (this.prerelease.length === 0) {\n          this.inc('patch', identifier)\n        }\n        this.inc('pre', identifier)\n        break\n\n      case 'major':\n        // If this is a pre-major version, bump up to the same major version.\n        // Otherwise increment major.\n        // 1.0.0-5 bumps to 1.0.0\n        // 1.1.0 bumps to 2.0.0\n        if (\n          this.minor !== 0 ||\n          this.patch !== 0 ||\n          this.prerelease.length === 0\n        ) {\n          this.major++\n        }\n        this.minor = 0\n        this.patch = 0\n        this.prerelease = []\n        break\n      case 'minor':\n        // If this is a pre-minor version, bump up to the same minor version.\n        // Otherwise increment minor.\n        // 1.2.0-5 bumps to 1.2.0\n        // 1.2.1 bumps to 1.3.0\n        if (this.patch !== 0 || this.prerelease.length === 0) {\n          this.minor++\n        }\n        this.patch = 0\n        this.prerelease = []\n        break\n      case 'patch':\n        // If this is not a pre-release version, it will increment the patch.\n        // If it is a pre-release it will bump up to the same patch version.\n        // 1.2.0-5 patches to 1.2.0\n        // 1.2.0 patches to 1.2.1\n        if (this.prerelease.length === 0) {\n          this.patch++\n        }\n        this.prerelease = []\n        break\n      // This probably shouldn't be used publicly.\n      // 1.0.0 'pre' would become 1.0.0-0 which is the wrong direction.\n      case 'pre':\n        if (this.prerelease.length === 0) {\n          this.prerelease = [0]\n        } else {\n          let i = this.prerelease.length\n          while (--i >= 0) {\n            if (typeof this.prerelease[i] === 'number') {\n              this.prerelease[i]++\n              i = -2\n            }\n          }\n          if (i === -1) {\n            // didn't increment anything\n            this.prerelease.push(0)\n          }\n        }\n        if (identifier) {\n          // 1.2.0-beta.1 bumps to 1.2.0-beta.2,\n          // 1.2.0-beta.fooblz or 1.2.0-beta bumps to 1.2.0-beta.0\n          if (compareIdentifiers(this.prerelease[0], identifier) === 0) {\n            if (isNaN(this.prerelease[1])) {\n              this.prerelease = [identifier, 0]\n            }\n          } else {\n            this.prerelease = [identifier, 0]\n          }\n        }\n        break\n\n      default:\n        throw new Error(`invalid increment argument: ${release}`)\n    }\n    this.format()\n    this.raw = this.version\n    return this\n  }\n}\n\nmodule.exports = SemVer\n","const parse = require('./parse')\nconst clean = (version, options) => {\n  const s = parse(version.trim().replace(/^[=v]+/, ''), options)\n  return s ? s.version : null\n}\nmodule.exports = clean\n","const eq = require('./eq')\nconst neq = require('./neq')\nconst gt = require('./gt')\nconst gte = require('./gte')\nconst lt = require('./lt')\nconst lte = require('./lte')\n\nconst cmp = (a, op, b, loose) => {\n  switch (op) {\n    case '===':\n      if (typeof a === 'object') {\n        a = a.version\n      }\n      if (typeof b === 'object') {\n        b = b.version\n      }\n      return a === b\n\n    case '!==':\n      if (typeof a === 'object') {\n        a = a.version\n      }\n      if (typeof b === 'object') {\n        b = b.version\n      }\n      return a !== b\n\n    case '':\n    case '=':\n    case '==':\n      return eq(a, b, loose)\n\n    case '!=':\n      return neq(a, b, loose)\n\n    case '>':\n      return gt(a, b, loose)\n\n    case '>=':\n      return gte(a, b, loose)\n\n    case '<':\n      return lt(a, b, loose)\n\n    case '<=':\n      return lte(a, b, loose)\n\n    default:\n      throw new TypeError(`Invalid operator: ${op}`)\n  }\n}\nmodule.exports = cmp\n","const SemVer = require('../classes/semver')\nconst parse = require('./parse')\nconst { re, t } = require('../internal/re')\n\nconst coerce = (version, options) => {\n  if (version instanceof SemVer) {\n    return version\n  }\n\n  if (typeof version === 'number') {\n    version = String(version)\n  }\n\n  if (typeof version !== 'string') {\n    return null\n  }\n\n  options = options || {}\n\n  let match = null\n  if (!options.rtl) {\n    match = version.match(re[t.COERCE])\n  } else {\n    // Find the right-most coercible string that does not share\n    // a terminus with a more left-ward coercible string.\n    // Eg, '1.2.3.4' wants to coerce '2.3.4', not '3.4' or '4'\n    //\n    // Walk through the string checking with a /g regexp\n    // Manually set the index so as to pick up overlapping matches.\n    // Stop when we get a match that ends at the string end, since no\n    // coercible string can be more right-ward without the same terminus.\n    let next\n    while ((next = re[t.COERCERTL].exec(version)) &&\n        (!match || match.index + match[0].length !== version.length)\n    ) {\n      if (!match ||\n            next.index + next[0].length !== match.index + match[0].length) {\n        match = next\n      }\n      re[t.COERCERTL].lastIndex = next.index + next[1].length + next[2].length\n    }\n    // leave it in a clean state\n    re[t.COERCERTL].lastIndex = -1\n  }\n\n  if (match === null) {\n    return null\n  }\n\n  return parse(`${match[2]}.${match[3] || '0'}.${match[4] || '0'}`, options)\n}\nmodule.exports = coerce\n","const SemVer = require('../classes/semver')\nconst compareBuild = (a, b, loose) => {\n  const versionA = new SemVer(a, loose)\n  const versionB = new SemVer(b, loose)\n  return versionA.compare(versionB) || versionA.compareBuild(versionB)\n}\nmodule.exports = compareBuild\n","const compare = require('./compare')\nconst compareLoose = (a, b) => compare(a, b, true)\nmodule.exports = compareLoose\n","const SemVer = require('../classes/semver')\nconst compare = (a, b, loose) =>\n  new SemVer(a, loose).compare(new SemVer(b, loose))\n\nmodule.exports = compare\n","const parse = require('./parse')\nconst eq = require('./eq')\n\nconst diff = (version1, version2) => {\n  if (eq(version1, version2)) {\n    return null\n  } else {\n    const v1 = parse(version1)\n    const v2 = parse(version2)\n    const hasPre = v1.prerelease.length || v2.prerelease.length\n    const prefix = hasPre ? 'pre' : ''\n    const defaultResult = hasPre ? 'prerelease' : ''\n    for (const key in v1) {\n      if (key === 'major' || key === 'minor' || key === 'patch') {\n        if (v1[key] !== v2[key]) {\n          return prefix + key\n        }\n      }\n    }\n    return defaultResult // may be undefined\n  }\n}\nmodule.exports = diff\n","const compare = require('./compare')\nconst eq = (a, b, loose) => compare(a, b, loose) === 0\nmodule.exports = eq\n","const compare = require('./compare')\nconst gt = (a, b, loose) => compare(a, b, loose) > 0\nmodule.exports = gt\n","const compare = require('./compare')\nconst gte = (a, b, loose) => compare(a, b, loose) >= 0\nmodule.exports = gte\n","const SemVer = require('../classes/semver')\n\nconst inc = (version, release, options, identifier) => {\n  if (typeof (options) === 'string') {\n    identifier = options\n    options = undefined\n  }\n\n  try {\n    return new SemVer(\n      version instanceof SemVer ? version.version : version,\n      options\n    ).inc(release, identifier).version\n  } catch (er) {\n    return null\n  }\n}\nmodule.exports = inc\n","const compare = require('./compare')\nconst lt = (a, b, loose) => compare(a, b, loose) < 0\nmodule.exports = lt\n","const compare = require('./compare')\nconst lte = (a, b, loose) => compare(a, b, loose) <= 0\nmodule.exports = lte\n","const SemVer = require('../classes/semver')\nconst major = (a, loose) => new SemVer(a, loose).major\nmodule.exports = major\n","const SemVer = require('../classes/semver')\nconst minor = (a, loose) => new SemVer(a, loose).minor\nmodule.exports = minor\n","const compare = require('./compare')\nconst neq = (a, b, loose) => compare(a, b, loose) !== 0\nmodule.exports = neq\n","const { MAX_LENGTH } = require('../internal/constants')\nconst { re, t } = require('../internal/re')\nconst SemVer = require('../classes/semver')\n\nconst parseOptions = require('../internal/parse-options')\nconst parse = (version, options) => {\n  options = parseOptions(options)\n\n  if (version instanceof SemVer) {\n    return version\n  }\n\n  if (typeof version !== 'string') {\n    return null\n  }\n\n  if (version.length > MAX_LENGTH) {\n    return null\n  }\n\n  const r = options.loose ? re[t.LOOSE] : re[t.FULL]\n  if (!r.test(version)) {\n    return null\n  }\n\n  try {\n    return new SemVer(version, options)\n  } catch (er) {\n    return null\n  }\n}\n\nmodule.exports = parse\n","const SemVer = require('../classes/semver')\nconst patch = (a, loose) => new SemVer(a, loose).patch\nmodule.exports = patch\n","const parse = require('./parse')\nconst prerelease = (version, options) => {\n  const parsed = parse(version, options)\n  return (parsed && parsed.prerelease.length) ? parsed.prerelease : null\n}\nmodule.exports = prerelease\n","const compare = require('./compare')\nconst rcompare = (a, b, loose) => compare(b, a, loose)\nmodule.exports = rcompare\n","const compareBuild = require('./compare-build')\nconst rsort = (list, loose) => list.sort((a, b) => compareBuild(b, a, loose))\nmodule.exports = rsort\n","const Range = require('../classes/range')\nconst satisfies = (version, range, options) => {\n  try {\n    range = new Range(range, options)\n  } catch (er) {\n    return false\n  }\n  return range.test(version)\n}\nmodule.exports = satisfies\n","const compareBuild = require('./compare-build')\nconst sort = (list, loose) => list.sort((a, b) => compareBuild(a, b, loose))\nmodule.exports = sort\n","const parse = require('./parse')\nconst valid = (version, options) => {\n  const v = parse(version, options)\n  return v ? v.version : null\n}\nmodule.exports = valid\n","// just pre-load all the stuff that index.js lazily exports\nconst internalRe = require('./internal/re')\nmodule.exports = {\n  re: internalRe.re,\n  src: internalRe.src,\n  tokens: internalRe.t,\n  SEMVER_SPEC_VERSION: require('./internal/constants').SEMVER_SPEC_VERSION,\n  SemVer: require('./classes/semver'),\n  compareIdentifiers: require('./internal/identifiers').compareIdentifiers,\n  rcompareIdentifiers: require('./internal/identifiers').rcompareIdentifiers,\n  parse: require('./functions/parse'),\n  valid: require('./functions/valid'),\n  clean: require('./functions/clean'),\n  inc: require('./functions/inc'),\n  diff: require('./functions/diff'),\n  major: require('./functions/major'),\n  minor: require('./functions/minor'),\n  patch: require('./functions/patch'),\n  prerelease: require('./functions/prerelease'),\n  compare: require('./functions/compare'),\n  rcompare: require('./functions/rcompare'),\n  compareLoose: require('./functions/compare-loose'),\n  compareBuild: require('./functions/compare-build'),\n  sort: require('./functions/sort'),\n  rsort: require('./functions/rsort'),\n  gt: require('./functions/gt'),\n  lt: require('./functions/lt'),\n  eq: require('./functions/eq'),\n  neq: require('./functions/neq'),\n  gte: require('./functions/gte'),\n  lte: require('./functions/lte'),\n  cmp: require('./functions/cmp'),\n  coerce: require('./functions/coerce'),\n  Comparator: require('./classes/comparator'),\n  Range: require('./classes/range'),\n  satisfies: require('./functions/satisfies'),\n  toComparators: require('./ranges/to-comparators'),\n  maxSatisfying: require('./ranges/max-satisfying'),\n  minSatisfying: require('./ranges/min-satisfying'),\n  minVersion: require('./ranges/min-version'),\n  validRange: require('./ranges/valid'),\n  outside: require('./ranges/outside'),\n  gtr: require('./ranges/gtr'),\n  ltr: require('./ranges/ltr'),\n  intersects: require('./ranges/intersects'),\n  simplifyRange: require('./ranges/simplify'),\n  subset: require('./ranges/subset'),\n}\n","// Note: this is the semver.org version of the spec that it implements\n// Not necessarily the package version of this code.\nconst SEMVER_SPEC_VERSION = '2.0.0'\n\nconst MAX_LENGTH = 256\nconst MAX_SAFE_INTEGER = Number.MAX_SAFE_INTEGER ||\n/* istanbul ignore next */ 9007199254740991\n\n// Max safe segment length for coercion.\nconst MAX_SAFE_COMPONENT_LENGTH = 16\n\nmodule.exports = {\n  SEMVER_SPEC_VERSION,\n  MAX_LENGTH,\n  MAX_SAFE_INTEGER,\n  MAX_SAFE_COMPONENT_LENGTH,\n}\n","const debug = (\n  typeof process === 'object' &&\n  process.env &&\n  process.env.NODE_DEBUG &&\n  /\\bsemver\\b/i.test(process.env.NODE_DEBUG)\n) ? (...args) => console.error('SEMVER', ...args)\n  : () => {}\n\nmodule.exports = debug\n","const numeric = /^[0-9]+$/\nconst compareIdentifiers = (a, b) => {\n  const anum = numeric.test(a)\n  const bnum = numeric.test(b)\n\n  if (anum && bnum) {\n    a = +a\n    b = +b\n  }\n\n  return a === b ? 0\n    : (anum && !bnum) ? -1\n    : (bnum && !anum) ? 1\n    : a < b ? -1\n    : 1\n}\n\nconst rcompareIdentifiers = (a, b) => compareIdentifiers(b, a)\n\nmodule.exports = {\n  compareIdentifiers,\n  rcompareIdentifiers,\n}\n","// parse out just the options we care about so we always get a consistent\n// obj with keys in a consistent order.\nconst opts = ['includePrerelease', 'loose', 'rtl']\nconst parseOptions = options =>\n  !options ? {}\n  : typeof options !== 'object' ? { loose: true }\n  : opts.filter(k => options[k]).reduce((o, k) => {\n    o[k] = true\n    return o\n  }, {})\nmodule.exports = parseOptions\n","const { MAX_SAFE_COMPONENT_LENGTH } = require('./constants')\nconst debug = require('./debug')\nexports = module.exports = {}\n\n// The actual regexps go on exports.re\nconst re = exports.re = []\nconst src = exports.src = []\nconst t = exports.t = {}\nlet R = 0\n\nconst createToken = (name, value, isGlobal) => {\n  const index = R++\n  debug(name, index, value)\n  t[name] = index\n  src[index] = value\n  re[index] = new RegExp(value, isGlobal ? 'g' : undefined)\n}\n\n// The following Regular Expressions can be used for tokenizing,\n// validating, and parsing SemVer version strings.\n\n// ## Numeric Identifier\n// A single `0`, or a non-zero digit followed by zero or more digits.\n\ncreateToken('NUMERICIDENTIFIER', '0|[1-9]\\\\d*')\ncreateToken('NUMERICIDENTIFIERLOOSE', '[0-9]+')\n\n// ## Non-numeric Identifier\n// Zero or more digits, followed by a letter or hyphen, and then zero or\n// more letters, digits, or hyphens.\n\ncreateToken('NONNUMERICIDENTIFIER', '\\\\d*[a-zA-Z-][a-zA-Z0-9-]*')\n\n// ## Main Version\n// Three dot-separated numeric identifiers.\n\ncreateToken('MAINVERSION', `(${src[t.NUMERICIDENTIFIER]})\\\\.` +\n                   `(${src[t.NUMERICIDENTIFIER]})\\\\.` +\n                   `(${src[t.NUMERICIDENTIFIER]})`)\n\ncreateToken('MAINVERSIONLOOSE', `(${src[t.NUMERICIDENTIFIERLOOSE]})\\\\.` +\n                        `(${src[t.NUMERICIDENTIFIERLOOSE]})\\\\.` +\n                        `(${src[t.NUMERICIDENTIFIERLOOSE]})`)\n\n// ## Pre-release Version Identifier\n// A numeric identifier, or a non-numeric identifier.\n\ncreateToken('PRERELEASEIDENTIFIER', `(?:${src[t.NUMERICIDENTIFIER]\n}|${src[t.NONNUMERICIDENTIFIER]})`)\n\ncreateToken('PRERELEASEIDENTIFIERLOOSE', `(?:${src[t.NUMERICIDENTIFIERLOOSE]\n}|${src[t.NONNUMERICIDENTIFIER]})`)\n\n// ## Pre-release Version\n// Hyphen, followed by one or more dot-separated pre-release version\n// identifiers.\n\ncreateToken('PRERELEASE', `(?:-(${src[t.PRERELEASEIDENTIFIER]\n}(?:\\\\.${src[t.PRERELEASEIDENTIFIER]})*))`)\n\ncreateToken('PRERELEASELOOSE', `(?:-?(${src[t.PRERELEASEIDENTIFIERLOOSE]\n}(?:\\\\.${src[t.PRERELEASEIDENTIFIERLOOSE]})*))`)\n\n// ## Build Metadata Identifier\n// Any combination of digits, letters, or hyphens.\n\ncreateToken('BUILDIDENTIFIER', '[0-9A-Za-z-]+')\n\n// ## Build Metadata\n// Plus sign, followed by one or more period-separated build metadata\n// identifiers.\n\ncreateToken('BUILD', `(?:\\\\+(${src[t.BUILDIDENTIFIER]\n}(?:\\\\.${src[t.BUILDIDENTIFIER]})*))`)\n\n// ## Full Version String\n// A main version, followed optionally by a pre-release version and\n// build metadata.\n\n// Note that the only major, minor, patch, and pre-release sections of\n// the version string are capturing groups.  The build metadata is not a\n// capturing group, because it should not ever be used in version\n// comparison.\n\ncreateToken('FULLPLAIN', `v?${src[t.MAINVERSION]\n}${src[t.PRERELEASE]}?${\n  src[t.BUILD]}?`)\n\ncreateToken('FULL', `^${src[t.FULLPLAIN]}$`)\n\n// like full, but allows v1.2.3 and =1.2.3, which people do sometimes.\n// also, 1.0.0alpha1 (prerelease without the hyphen) which is pretty\n// common in the npm registry.\ncreateToken('LOOSEPLAIN', `[v=\\\\s]*${src[t.MAINVERSIONLOOSE]\n}${src[t.PRERELEASELOOSE]}?${\n  src[t.BUILD]}?`)\n\ncreateToken('LOOSE', `^${src[t.LOOSEPLAIN]}$`)\n\ncreateToken('GTLT', '((?:<|>)?=?)')\n\n// Something like \"2.*\" or \"1.2.x\".\n// Note that \"x.x\" is a valid xRange identifer, meaning \"any version\"\n// Only the first item is strictly required.\ncreateToken('XRANGEIDENTIFIERLOOSE', `${src[t.NUMERICIDENTIFIERLOOSE]}|x|X|\\\\*`)\ncreateToken('XRANGEIDENTIFIER', `${src[t.NUMERICIDENTIFIER]}|x|X|\\\\*`)\n\ncreateToken('XRANGEPLAIN', `[v=\\\\s]*(${src[t.XRANGEIDENTIFIER]})` +\n                   `(?:\\\\.(${src[t.XRANGEIDENTIFIER]})` +\n                   `(?:\\\\.(${src[t.XRANGEIDENTIFIER]})` +\n                   `(?:${src[t.PRERELEASE]})?${\n                     src[t.BUILD]}?` +\n                   `)?)?`)\n\ncreateToken('XRANGEPLAINLOOSE', `[v=\\\\s]*(${src[t.XRANGEIDENTIFIERLOOSE]})` +\n                        `(?:\\\\.(${src[t.XRANGEIDENTIFIERLOOSE]})` +\n                        `(?:\\\\.(${src[t.XRANGEIDENTIFIERLOOSE]})` +\n                        `(?:${src[t.PRERELEASELOOSE]})?${\n                          src[t.BUILD]}?` +\n                        `)?)?`)\n\ncreateToken('XRANGE', `^${src[t.GTLT]}\\\\s*${src[t.XRANGEPLAIN]}$`)\ncreateToken('XRANGELOOSE', `^${src[t.GTLT]}\\\\s*${src[t.XRANGEPLAINLOOSE]}$`)\n\n// Coercion.\n// Extract anything that could conceivably be a part of a valid semver\ncreateToken('COERCE', `${'(^|[^\\\\d])' +\n              '(\\\\d{1,'}${MAX_SAFE_COMPONENT_LENGTH}})` +\n              `(?:\\\\.(\\\\d{1,${MAX_SAFE_COMPONENT_LENGTH}}))?` +\n              `(?:\\\\.(\\\\d{1,${MAX_SAFE_COMPONENT_LENGTH}}))?` +\n              `(?:$|[^\\\\d])`)\ncreateToken('COERCERTL', src[t.COERCE], true)\n\n// Tilde ranges.\n// Meaning is \"reasonably at or greater than\"\ncreateToken('LONETILDE', '(?:~>?)')\n\ncreateToken('TILDETRIM', `(\\\\s*)${src[t.LONETILDE]}\\\\s+`, true)\nexports.tildeTrimReplace = '$1~'\n\ncreateToken('TILDE', `^${src[t.LONETILDE]}${src[t.XRANGEPLAIN]}$`)\ncreateToken('TILDELOOSE', `^${src[t.LONETILDE]}${src[t.XRANGEPLAINLOOSE]}$`)\n\n// Caret ranges.\n// Meaning is \"at least and backwards compatible with\"\ncreateToken('LONECARET', '(?:\\\\^)')\n\ncreateToken('CARETTRIM', `(\\\\s*)${src[t.LONECARET]}\\\\s+`, true)\nexports.caretTrimReplace = '$1^'\n\ncreateToken('CARET', `^${src[t.LONECARET]}${src[t.XRANGEPLAIN]}$`)\ncreateToken('CARETLOOSE', `^${src[t.LONECARET]}${src[t.XRANGEPLAINLOOSE]}$`)\n\n// A simple gt/lt/eq thing, or just \"\" to indicate \"any version\"\ncreateToken('COMPARATORLOOSE', `^${src[t.GTLT]}\\\\s*(${src[t.LOOSEPLAIN]})$|^$`)\ncreateToken('COMPARATOR', `^${src[t.GTLT]}\\\\s*(${src[t.FULLPLAIN]})$|^$`)\n\n// An expression to strip any whitespace between the gtlt and the thing\n// it modifies, so that `> 1.2.3` ==> `>1.2.3`\ncreateToken('COMPARATORTRIM', `(\\\\s*)${src[t.GTLT]\n}\\\\s*(${src[t.LOOSEPLAIN]}|${src[t.XRANGEPLAIN]})`, true)\nexports.comparatorTrimReplace = '$1$2$3'\n\n// Something like `1.2.3 - 1.2.4`\n// Note that these all use the loose form, because they'll be\n// checked against either the strict or loose comparator form\n// later.\ncreateToken('HYPHENRANGE', `^\\\\s*(${src[t.XRANGEPLAIN]})` +\n                   `\\\\s+-\\\\s+` +\n                   `(${src[t.XRANGEPLAIN]})` +\n                   `\\\\s*$`)\n\ncreateToken('HYPHENRANGELOOSE', `^\\\\s*(${src[t.XRANGEPLAINLOOSE]})` +\n                        `\\\\s+-\\\\s+` +\n                        `(${src[t.XRANGEPLAINLOOSE]})` +\n                        `\\\\s*$`)\n\n// Star ranges basically just allow anything at all.\ncreateToken('STAR', '(<|>)?=?\\\\s*\\\\*')\n// >=0.0.0 is like a star\ncreateToken('GTE0', '^\\\\s*>=\\\\s*0\\\\.0\\\\.0\\\\s*$')\ncreateToken('GTE0PRE', '^\\\\s*>=\\\\s*0\\\\.0\\\\.0-0\\\\s*$')\n","// Determine if version is greater than all the versions possible in the range.\nconst outside = require('./outside')\nconst gtr = (version, range, options) => outside(version, range, '>', options)\nmodule.exports = gtr\n","const Range = require('../classes/range')\nconst intersects = (r1, r2, options) => {\n  r1 = new Range(r1, options)\n  r2 = new Range(r2, options)\n  return r1.intersects(r2)\n}\nmodule.exports = intersects\n","const outside = require('./outside')\n// Determine if version is less than all the versions possible in the range\nconst ltr = (version, range, options) => outside(version, range, '<', options)\nmodule.exports = ltr\n","const SemVer = require('../classes/semver')\nconst Range = require('../classes/range')\n\nconst maxSatisfying = (versions, range, options) => {\n  let max = null\n  let maxSV = null\n  let rangeObj = null\n  try {\n    rangeObj = new Range(range, options)\n  } catch (er) {\n    return null\n  }\n  versions.forEach((v) => {\n    if (rangeObj.test(v)) {\n      // satisfies(v, range, options)\n      if (!max || maxSV.compare(v) === -1) {\n        // compare(max, v, true)\n        max = v\n        maxSV = new SemVer(max, options)\n      }\n    }\n  })\n  return max\n}\nmodule.exports = maxSatisfying\n","const SemVer = require('../classes/semver')\nconst Range = require('../classes/range')\nconst minSatisfying = (versions, range, options) => {\n  let min = null\n  let minSV = null\n  let rangeObj = null\n  try {\n    rangeObj = new Range(range, options)\n  } catch (er) {\n    return null\n  }\n  versions.forEach((v) => {\n    if (rangeObj.test(v)) {\n      // satisfies(v, range, options)\n      if (!min || minSV.compare(v) === 1) {\n        // compare(min, v, true)\n        min = v\n        minSV = new SemVer(min, options)\n      }\n    }\n  })\n  return min\n}\nmodule.exports = minSatisfying\n","const SemVer = require('../classes/semver')\nconst Range = require('../classes/range')\nconst gt = require('../functions/gt')\n\nconst minVersion = (range, loose) => {\n  range = new Range(range, loose)\n\n  let minver = new SemVer('0.0.0')\n  if (range.test(minver)) {\n    return minver\n  }\n\n  minver = new SemVer('0.0.0-0')\n  if (range.test(minver)) {\n    return minver\n  }\n\n  minver = null\n  for (let i = 0; i < range.set.length; ++i) {\n    const comparators = range.set[i]\n\n    let setMin = null\n    comparators.forEach((comparator) => {\n      // Clone to avoid manipulating the comparator's semver object.\n      const compver = new SemVer(comparator.semver.version)\n      switch (comparator.operator) {\n        case '>':\n          if (compver.prerelease.length === 0) {\n            compver.patch++\n          } else {\n            compver.prerelease.push(0)\n          }\n          compver.raw = compver.format()\n          /* fallthrough */\n        case '':\n        case '>=':\n          if (!setMin || gt(compver, setMin)) {\n            setMin = compver\n          }\n          break\n        case '<':\n        case '<=':\n          /* Ignore maximum versions */\n          break\n        /* istanbul ignore next */\n        default:\n          throw new Error(`Unexpected operation: ${comparator.operator}`)\n      }\n    })\n    if (setMin && (!minver || gt(minver, setMin))) {\n      minver = setMin\n    }\n  }\n\n  if (minver && range.test(minver)) {\n    return minver\n  }\n\n  return null\n}\nmodule.exports = minVersion\n","const SemVer = require('../classes/semver')\nconst Comparator = require('../classes/comparator')\nconst { ANY } = Comparator\nconst Range = require('../classes/range')\nconst satisfies = require('../functions/satisfies')\nconst gt = require('../functions/gt')\nconst lt = require('../functions/lt')\nconst lte = require('../functions/lte')\nconst gte = require('../functions/gte')\n\nconst outside = (version, range, hilo, options) => {\n  version = new SemVer(version, options)\n  range = new Range(range, options)\n\n  let gtfn, ltefn, ltfn, comp, ecomp\n  switch (hilo) {\n    case '>':\n      gtfn = gt\n      ltefn = lte\n      ltfn = lt\n      comp = '>'\n      ecomp = '>='\n      break\n    case '<':\n      gtfn = lt\n      ltefn = gte\n      ltfn = gt\n      comp = '<'\n      ecomp = '<='\n      break\n    default:\n      throw new TypeError('Must provide a hilo val of \"<\" or \">\"')\n  }\n\n  // If it satisfies the range it is not outside\n  if (satisfies(version, range, options)) {\n    return false\n  }\n\n  // From now on, variable terms are as if we're in \"gtr\" mode.\n  // but note that everything is flipped for the \"ltr\" function.\n\n  for (let i = 0; i < range.set.length; ++i) {\n    const comparators = range.set[i]\n\n    let high = null\n    let low = null\n\n    comparators.forEach((comparator) => {\n      if (comparator.semver === ANY) {\n        comparator = new Comparator('>=0.0.0')\n      }\n      high = high || comparator\n      low = low || comparator\n      if (gtfn(comparator.semver, high.semver, options)) {\n        high = comparator\n      } else if (ltfn(comparator.semver, low.semver, options)) {\n        low = comparator\n      }\n    })\n\n    // If the edge version comparator has a operator then our version\n    // isn't outside it\n    if (high.operator === comp || high.operator === ecomp) {\n      return false\n    }\n\n    // If the lowest version comparator has an operator and our version\n    // is less than it then it isn't higher than the range\n    if ((!low.operator || low.operator === comp) &&\n        ltefn(version, low.semver)) {\n      return false\n    } else if (low.operator === ecomp && ltfn(version, low.semver)) {\n      return false\n    }\n  }\n  return true\n}\n\nmodule.exports = outside\n","// given a set of versions and a range, create a \"simplified\" range\n// that includes the same versions that the original range does\n// If the original range is shorter than the simplified one, return that.\nconst satisfies = require('../functions/satisfies.js')\nconst compare = require('../functions/compare.js')\nmodule.exports = (versions, range, options) => {\n  const set = []\n  let first = null\n  let prev = null\n  const v = versions.sort((a, b) => compare(a, b, options))\n  for (const version of v) {\n    const included = satisfies(version, range, options)\n    if (included) {\n      prev = version\n      if (!first) {\n        first = version\n      }\n    } else {\n      if (prev) {\n        set.push([first, prev])\n      }\n      prev = null\n      first = null\n    }\n  }\n  if (first) {\n    set.push([first, null])\n  }\n\n  const ranges = []\n  for (const [min, max] of set) {\n    if (min === max) {\n      ranges.push(min)\n    } else if (!max && min === v[0]) {\n      ranges.push('*')\n    } else if (!max) {\n      ranges.push(`>=${min}`)\n    } else if (min === v[0]) {\n      ranges.push(`<=${max}`)\n    } else {\n      ranges.push(`${min} - ${max}`)\n    }\n  }\n  const simplified = ranges.join(' || ')\n  const original = typeof range.raw === 'string' ? range.raw : String(range)\n  return simplified.length < original.length ? simplified : range\n}\n","const Range = require('../classes/range.js')\nconst Comparator = require('../classes/comparator.js')\nconst { ANY } = Comparator\nconst satisfies = require('../functions/satisfies.js')\nconst compare = require('../functions/compare.js')\n\n// Complex range `r1 || r2 || ...` is a subset of `R1 || R2 || ...` iff:\n// - Every simple range `r1, r2, ...` is a null set, OR\n// - Every simple range `r1, r2, ...` which is not a null set is a subset of\n//   some `R1, R2, ...`\n//\n// Simple range `c1 c2 ...` is a subset of simple range `C1 C2 ...` iff:\n// - If c is only the ANY comparator\n//   - If C is only the ANY comparator, return true\n//   - Else if in prerelease mode, return false\n//   - else replace c with `[>=0.0.0]`\n// - If C is only the ANY comparator\n//   - if in prerelease mode, return true\n//   - else replace C with `[>=0.0.0]`\n// - Let EQ be the set of = comparators in c\n// - If EQ is more than one, return true (null set)\n// - Let GT be the highest > or >= comparator in c\n// - Let LT be the lowest < or <= comparator in c\n// - If GT and LT, and GT.semver > LT.semver, return true (null set)\n// - If any C is a = range, and GT or LT are set, return false\n// - If EQ\n//   - If GT, and EQ does not satisfy GT, return true (null set)\n//   - If LT, and EQ does not satisfy LT, return true (null set)\n//   - If EQ satisfies every C, return true\n//   - Else return false\n// - If GT\n//   - If GT.semver is lower than any > or >= comp in C, return false\n//   - If GT is >=, and GT.semver does not satisfy every C, return false\n//   - If GT.semver has a prerelease, and not in prerelease mode\n//     - If no C has a prerelease and the GT.semver tuple, return false\n// - If LT\n//   - If LT.semver is greater than any < or <= comp in C, return false\n//   - If LT is <=, and LT.semver does not satisfy every C, return false\n//   - If GT.semver has a prerelease, and not in prerelease mode\n//     - If no C has a prerelease and the LT.semver tuple, return false\n// - Else return true\n\nconst subset = (sub, dom, options = {}) => {\n  if (sub === dom) {\n    return true\n  }\n\n  sub = new Range(sub, options)\n  dom = new Range(dom, options)\n  let sawNonNull = false\n\n  OUTER: for (const simpleSub of sub.set) {\n    for (const simpleDom of dom.set) {\n      const isSub = simpleSubset(simpleSub, simpleDom, options)\n      sawNonNull = sawNonNull || isSub !== null\n      if (isSub) {\n        continue OUTER\n      }\n    }\n    // the null set is a subset of everything, but null simple ranges in\n    // a complex range should be ignored.  so if we saw a non-null range,\n    // then we know this isn't a subset, but if EVERY simple range was null,\n    // then it is a subset.\n    if (sawNonNull) {\n      return false\n    }\n  }\n  return true\n}\n\nconst simpleSubset = (sub, dom, options) => {\n  if (sub === dom) {\n    return true\n  }\n\n  if (sub.length === 1 && sub[0].semver === ANY) {\n    if (dom.length === 1 && dom[0].semver === ANY) {\n      return true\n    } else if (options.includePrerelease) {\n      sub = [new Comparator('>=0.0.0-0')]\n    } else {\n      sub = [new Comparator('>=0.0.0')]\n    }\n  }\n\n  if (dom.length === 1 && dom[0].semver === ANY) {\n    if (options.includePrerelease) {\n      return true\n    } else {\n      dom = [new Comparator('>=0.0.0')]\n    }\n  }\n\n  const eqSet = new Set()\n  let gt, lt\n  for (const c of sub) {\n    if (c.operator === '>' || c.operator === '>=') {\n      gt = higherGT(gt, c, options)\n    } else if (c.operator === '<' || c.operator === '<=') {\n      lt = lowerLT(lt, c, options)\n    } else {\n      eqSet.add(c.semver)\n    }\n  }\n\n  if (eqSet.size > 1) {\n    return null\n  }\n\n  let gtltComp\n  if (gt && lt) {\n    gtltComp = compare(gt.semver, lt.semver, options)\n    if (gtltComp > 0) {\n      return null\n    } else if (gtltComp === 0 && (gt.operator !== '>=' || lt.operator !== '<=')) {\n      return null\n    }\n  }\n\n  // will iterate one or zero times\n  for (const eq of eqSet) {\n    if (gt && !satisfies(eq, String(gt), options)) {\n      return null\n    }\n\n    if (lt && !satisfies(eq, String(lt), options)) {\n      return null\n    }\n\n    for (const c of dom) {\n      if (!satisfies(eq, String(c), options)) {\n        return false\n      }\n    }\n\n    return true\n  }\n\n  let higher, lower\n  let hasDomLT, hasDomGT\n  // if the subset has a prerelease, we need a comparator in the superset\n  // with the same tuple and a prerelease, or it's not a subset\n  let needDomLTPre = lt &&\n    !options.includePrerelease &&\n    lt.semver.prerelease.length ? lt.semver : false\n  let needDomGTPre = gt &&\n    !options.includePrerelease &&\n    gt.semver.prerelease.length ? gt.semver : false\n  // exception: <1.2.3-0 is the same as <1.2.3\n  if (needDomLTPre && needDomLTPre.prerelease.length === 1 &&\n      lt.operator === '<' && needDomLTPre.prerelease[0] === 0) {\n    needDomLTPre = false\n  }\n\n  for (const c of dom) {\n    hasDomGT = hasDomGT || c.operator === '>' || c.operator === '>='\n    hasDomLT = hasDomLT || c.operator === '<' || c.operator === '<='\n    if (gt) {\n      if (needDomGTPre) {\n        if (c.semver.prerelease && c.semver.prerelease.length &&\n            c.semver.major === needDomGTPre.major &&\n            c.semver.minor === needDomGTPre.minor &&\n            c.semver.patch === needDomGTPre.patch) {\n          needDomGTPre = false\n        }\n      }\n      if (c.operator === '>' || c.operator === '>=') {\n        higher = higherGT(gt, c, options)\n        if (higher === c && higher !== gt) {\n          return false\n        }\n      } else if (gt.operator === '>=' && !satisfies(gt.semver, String(c), options)) {\n        return false\n      }\n    }\n    if (lt) {\n      if (needDomLTPre) {\n        if (c.semver.prerelease && c.semver.prerelease.length &&\n            c.semver.major === needDomLTPre.major &&\n            c.semver.minor === needDomLTPre.minor &&\n            c.semver.patch === needDomLTPre.patch) {\n          needDomLTPre = false\n        }\n      }\n      if (c.operator === '<' || c.operator === '<=') {\n        lower = lowerLT(lt, c, options)\n        if (lower === c && lower !== lt) {\n          return false\n        }\n      } else if (lt.operator === '<=' && !satisfies(lt.semver, String(c), options)) {\n        return false\n      }\n    }\n    if (!c.operator && (lt || gt) && gtltComp !== 0) {\n      return false\n    }\n  }\n\n  // if there was a < or >, and nothing in the dom, then must be false\n  // UNLESS it was limited by another range in the other direction.\n  // Eg, >1.0.0 <1.0.1 is still a subset of <2.0.0\n  if (gt && hasDomLT && !lt && gtltComp !== 0) {\n    return false\n  }\n\n  if (lt && hasDomGT && !gt && gtltComp !== 0) {\n    return false\n  }\n\n  // we needed a prerelease range in a specific tuple, but didn't get one\n  // then this isn't a subset.  eg >=1.2.3-pre is not a subset of >=1.0.0,\n  // because it includes prereleases in the 1.2.3 tuple\n  if (needDomGTPre || needDomLTPre) {\n    return false\n  }\n\n  return true\n}\n\n// >=1.2.3 is lower than >1.2.3\nconst higherGT = (a, b, options) => {\n  if (!a) {\n    return b\n  }\n  const comp = compare(a.semver, b.semver, options)\n  return comp > 0 ? a\n    : comp < 0 ? b\n    : b.operator === '>' && a.operator === '>=' ? b\n    : a\n}\n\n// <=1.2.3 is higher than <1.2.3\nconst lowerLT = (a, b, options) => {\n  if (!a) {\n    return b\n  }\n  const comp = compare(a.semver, b.semver, options)\n  return comp < 0 ? a\n    : comp > 0 ? b\n    : b.operator === '<' && a.operator === '<=' ? b\n    : a\n}\n\nmodule.exports = subset\n","const Range = require('../classes/range')\n\n// Mostly just for testing and legacy API reasons\nconst toComparators = (range, options) =>\n  new Range(range, options).set\n    .map(comp => comp.map(c => c.value).join(' ').trim().split(' '))\n\nmodule.exports = toComparators\n","const Range = require('../classes/range')\nconst validRange = (range, options) => {\n  try {\n    // Return '*' instead of '' so that truthiness works.\n    // This will throw if it's invalid anyway\n    return new Range(range, options).range || '*'\n  } catch (er) {\n    return null\n  }\n}\nmodule.exports = validRange\n","'use strict'\nmodule.exports = function (Yallist) {\n  Yallist.prototype[Symbol.iterator] = function* () {\n    for (let walker = this.head; walker; walker = walker.next) {\n      yield walker.value\n    }\n  }\n}\n","'use strict'\nmodule.exports = Yallist\n\nYallist.Node = Node\nYallist.create = Yallist\n\nfunction Yallist (list) {\n  var self = this\n  if (!(self instanceof Yallist)) {\n    self = new Yallist()\n  }\n\n  self.tail = null\n  self.head = null\n  self.length = 0\n\n  if (list && typeof list.forEach === 'function') {\n    list.forEach(function (item) {\n      self.push(item)\n    })\n  } else if (arguments.length > 0) {\n    for (var i = 0, l = arguments.length; i < l; i++) {\n      self.push(arguments[i])\n    }\n  }\n\n  return self\n}\n\nYallist.prototype.removeNode = function (node) {\n  if (node.list !== this) {\n    throw new Error('removing node which does not belong to this list')\n  }\n\n  var next = node.next\n  var prev = node.prev\n\n  if (next) {\n    next.prev = prev\n  }\n\n  if (prev) {\n    prev.next = next\n  }\n\n  if (node === this.head) {\n    this.head = next\n  }\n  if (node === this.tail) {\n    this.tail = prev\n  }\n\n  node.list.length--\n  node.next = null\n  node.prev = null\n  node.list = null\n\n  return next\n}\n\nYallist.prototype.unshiftNode = function (node) {\n  if (node === this.head) {\n    return\n  }\n\n  if (node.list) {\n    node.list.removeNode(node)\n  }\n\n  var head = this.head\n  node.list = this\n  node.next = head\n  if (head) {\n    head.prev = node\n  }\n\n  this.head = node\n  if (!this.tail) {\n    this.tail = node\n  }\n  this.length++\n}\n\nYallist.prototype.pushNode = function (node) {\n  if (node === this.tail) {\n    return\n  }\n\n  if (node.list) {\n    node.list.removeNode(node)\n  }\n\n  var tail = this.tail\n  node.list = this\n  node.prev = tail\n  if (tail) {\n    tail.next = node\n  }\n\n  this.tail = node\n  if (!this.head) {\n    this.head = node\n  }\n  this.length++\n}\n\nYallist.prototype.push = function () {\n  for (var i = 0, l = arguments.length; i < l; i++) {\n    push(this, arguments[i])\n  }\n  return this.length\n}\n\nYallist.prototype.unshift = function () {\n  for (var i = 0, l = arguments.length; i < l; i++) {\n    unshift(this, arguments[i])\n  }\n  return this.length\n}\n\nYallist.prototype.pop = function () {\n  if (!this.tail) {\n    return undefined\n  }\n\n  var res = this.tail.value\n  this.tail = this.tail.prev\n  if (this.tail) {\n    this.tail.next = null\n  } else {\n    this.head = null\n  }\n  this.length--\n  return res\n}\n\nYallist.prototype.shift = function () {\n  if (!this.head) {\n    return undefined\n  }\n\n  var res = this.head.value\n  this.head = this.head.next\n  if (this.head) {\n    this.head.prev = null\n  } else {\n    this.tail = null\n  }\n  this.length--\n  return res\n}\n\nYallist.prototype.forEach = function (fn, thisp) {\n  thisp = thisp || this\n  for (var walker = this.head, i = 0; walker !== null; i++) {\n    fn.call(thisp, walker.value, i, this)\n    walker = walker.next\n  }\n}\n\nYallist.prototype.forEachReverse = function (fn, thisp) {\n  thisp = thisp || this\n  for (var walker = this.tail, i = this.length - 1; walker !== null; i--) {\n    fn.call(thisp, walker.value, i, this)\n    walker = walker.prev\n  }\n}\n\nYallist.prototype.get = function (n) {\n  for (var i = 0, walker = this.head; walker !== null && i < n; i++) {\n    // abort out of the list early if we hit a cycle\n    walker = walker.next\n  }\n  if (i === n && walker !== null) {\n    return walker.value\n  }\n}\n\nYallist.prototype.getReverse = function (n) {\n  for (var i = 0, walker = this.tail; walker !== null && i < n; i++) {\n    // abort out of the list early if we hit a cycle\n    walker = walker.prev\n  }\n  if (i === n && walker !== null) {\n    return walker.value\n  }\n}\n\nYallist.prototype.map = function (fn, thisp) {\n  thisp = thisp || this\n  var res = new Yallist()\n  for (var walker = this.head; walker !== null;) {\n    res.push(fn.call(thisp, walker.value, this))\n    walker = walker.next\n  }\n  return res\n}\n\nYallist.prototype.mapReverse = function (fn, thisp) {\n  thisp = thisp || this\n  var res = new Yallist()\n  for (var walker = this.tail; walker !== null;) {\n    res.push(fn.call(thisp, walker.value, this))\n    walker = walker.prev\n  }\n  return res\n}\n\nYallist.prototype.reduce = function (fn, initial) {\n  var acc\n  var walker = this.head\n  if (arguments.length > 1) {\n    acc = initial\n  } else if (this.head) {\n    walker = this.head.next\n    acc = this.head.value\n  } else {\n    throw new TypeError('Reduce of empty list with no initial value')\n  }\n\n  for (var i = 0; walker !== null; i++) {\n    acc = fn(acc, walker.value, i)\n    walker = walker.next\n  }\n\n  return acc\n}\n\nYallist.prototype.reduceReverse = function (fn, initial) {\n  var acc\n  var walker = this.tail\n  if (arguments.length > 1) {\n    acc = initial\n  } else if (this.tail) {\n    walker = this.tail.prev\n    acc = this.tail.value\n  } else {\n    throw new TypeError('Reduce of empty list with no initial value')\n  }\n\n  for (var i = this.length - 1; walker !== null; i--) {\n    acc = fn(acc, walker.value, i)\n    walker = walker.prev\n  }\n\n  return acc\n}\n\nYallist.prototype.toArray = function () {\n  var arr = new Array(this.length)\n  for (var i = 0, walker = this.head; walker !== null; i++) {\n    arr[i] = walker.value\n    walker = walker.next\n  }\n  return arr\n}\n\nYallist.prototype.toArrayReverse = function () {\n  var arr = new Array(this.length)\n  for (var i = 0, walker = this.tail; walker !== null; i++) {\n    arr[i] = walker.value\n    walker = walker.prev\n  }\n  return arr\n}\n\nYallist.prototype.slice = function (from, to) {\n  to = to || this.length\n  if (to < 0) {\n    to += this.length\n  }\n  from = from || 0\n  if (from < 0) {\n    from += this.length\n  }\n  var ret = new Yallist()\n  if (to < from || to < 0) {\n    return ret\n  }\n  if (from < 0) {\n    from = 0\n  }\n  if (to > this.length) {\n    to = this.length\n  }\n  for (var i = 0, walker = this.head; walker !== null && i < from; i++) {\n    walker = walker.next\n  }\n  for (; walker !== null && i < to; i++, walker = walker.next) {\n    ret.push(walker.value)\n  }\n  return ret\n}\n\nYallist.prototype.sliceReverse = function (from, to) {\n  to = to || this.length\n  if (to < 0) {\n    to += this.length\n  }\n  from = from || 0\n  if (from < 0) {\n    from += this.length\n  }\n  var ret = new Yallist()\n  if (to < from || to < 0) {\n    return ret\n  }\n  if (from < 0) {\n    from = 0\n  }\n  if (to > this.length) {\n    to = this.length\n  }\n  for (var i = this.length, walker = this.tail; walker !== null && i > to; i--) {\n    walker = walker.prev\n  }\n  for (; walker !== null && i > from; i--, walker = walker.prev) {\n    ret.push(walker.value)\n  }\n  return ret\n}\n\nYallist.prototype.splice = function (start, deleteCount, ...nodes) {\n  if (start > this.length) {\n    start = this.length - 1\n  }\n  if (start < 0) {\n    start = this.length + start;\n  }\n\n  for (var i = 0, walker = this.head; walker !== null && i < start; i++) {\n    walker = walker.next\n  }\n\n  var ret = []\n  for (var i = 0; walker && i < deleteCount; i++) {\n    ret.push(walker.value)\n    walker = this.removeNode(walker)\n  }\n  if (walker === null) {\n    walker = this.tail\n  }\n\n  if (walker !== this.head && walker !== this.tail) {\n    walker = walker.prev\n  }\n\n  for (var i = 0; i < nodes.length; i++) {\n    walker = insert(this, walker, nodes[i])\n  }\n  return ret;\n}\n\nYallist.prototype.reverse = function () {\n  var head = this.head\n  var tail = this.tail\n  for (var walker = head; walker !== null; walker = walker.prev) {\n    var p = walker.prev\n    walker.prev = walker.next\n    walker.next = p\n  }\n  this.head = tail\n  this.tail = head\n  return this\n}\n\nfunction insert (self, node, value) {\n  var inserted = node === self.head ?\n    new Node(value, null, node, self) :\n    new Node(value, node, node.next, self)\n\n  if (inserted.next === null) {\n    self.tail = inserted\n  }\n  if (inserted.prev === null) {\n    self.head = inserted\n  }\n\n  self.length++\n\n  return inserted\n}\n\nfunction push (self, item) {\n  self.tail = new Node(item, self.tail, null, self)\n  if (!self.head) {\n    self.head = self.tail\n  }\n  self.length++\n}\n\nfunction unshift (self, item) {\n  self.head = new Node(item, null, self.head, self)\n  if (!self.tail) {\n    self.tail = self.head\n  }\n  self.length++\n}\n\nfunction Node (value, prev, next, list) {\n  if (!(this instanceof Node)) {\n    return new Node(value, prev, next, list)\n  }\n\n  this.list = list\n  this.value = value\n\n  if (prev) {\n    prev.next = this\n    this.prev = prev\n  } else {\n    this.prev = null\n  }\n\n  if (next) {\n    next.prev = this\n    this.next = next\n  } else {\n    this.next = null\n  }\n}\n\ntry {\n  // add if support for Symbol.iterator is present\n  require('./iterator.js')(Yallist)\n} catch (er) {}\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.MixinDeviceBase = exports.ScryptedDeviceBase = void 0;\n__exportStar(require(\"../types/gen/index\"), exports);\nconst index_1 = require(\"../types/gen/index\");\n/**\n * @category Core Reference\n */\nclass ScryptedDeviceBase extends index_1.DeviceBase {\n    constructor(nativeId) {\n        super();\n        this.nativeId = nativeId;\n    }\n    get storage() {\n        if (!this._storage) {\n            this._storage = deviceManager.getDeviceStorage(this.nativeId);\n        }\n        return this._storage;\n    }\n    get log() {\n        if (!this._log) {\n            this._log = deviceManager.getDeviceLogger(this.nativeId);\n        }\n        return this._log;\n    }\n    get console() {\n        if (!this._console) {\n            this._console = deviceManager.getDeviceConsole(this.nativeId);\n        }\n        return this._console;\n    }\n    async createMediaObject(data, mimeType) {\n        return mediaManager.createMediaObject(data, mimeType, {\n            sourceId: this.id,\n        });\n    }\n    getMediaObjectConsole(mediaObject) {\n        if (typeof mediaObject.sourceId !== 'string')\n            return this.console;\n        return deviceManager.getMixinConsole(mediaObject.sourceId, this.nativeId);\n    }\n    _lazyLoadDeviceState() {\n        if (!this._deviceState) {\n            if (this.nativeId) {\n                this._deviceState = deviceManager.getDeviceState(this.nativeId);\n            }\n            else {\n                this._deviceState = deviceManager.getDeviceState();\n            }\n        }\n    }\n    /**\n     * Fire an event for this device.\n     */\n    onDeviceEvent(eventInterface, eventData) {\n        return deviceManager.onDeviceEvent(this.nativeId, eventInterface, eventData);\n    }\n}\nexports.ScryptedDeviceBase = ScryptedDeviceBase;\n/**\n * @category Mixin Reference\n */\nclass MixinDeviceBase extends index_1.DeviceBase {\n    constructor(options) {\n        super();\n        this._listeners = new Set();\n        this.nativeId = systemManager.getDeviceById(this.id)?.nativeId;\n        this.mixinDevice = options.mixinDevice;\n        this.mixinDeviceInterfaces = options.mixinDeviceInterfaces;\n        this.mixinStorageSuffix = options.mixinStorageSuffix;\n        this._deviceState = options.mixinDeviceState;\n        // 8-11-2022\n        // RpcProxy will trap all properties, and the following check/hack will determine\n        // if the device state came from another node worker thread.\n        // This should ultimately be removed at some point in the future.\n        if (this._deviceState.__rpcproxy_traps_all_properties && deviceManager.createDeviceState && typeof this._deviceState.id === 'string') {\n            this._deviceState = deviceManager.createDeviceState(this._deviceState.id, this._deviceState.setState);\n        }\n        this.mixinProviderNativeId = options.mixinProviderNativeId;\n    }\n    get storage() {\n        if (!this._storage) {\n            const mixinStorageSuffix = this.mixinStorageSuffix;\n            const mixinStorageKey = this.id + (mixinStorageSuffix ? ':' + mixinStorageSuffix : '');\n            this._storage = deviceManager.getMixinStorage(mixinStorageKey, this.mixinProviderNativeId);\n        }\n        return this._storage;\n    }\n    get console() {\n        if (!this._console) {\n            if (deviceManager.getMixinConsole)\n                this._console = deviceManager.getMixinConsole(this.id, this.mixinProviderNativeId);\n            else\n                this._console = deviceManager.getDeviceConsole(this.mixinProviderNativeId);\n        }\n        return this._console;\n    }\n    async createMediaObject(data, mimeType) {\n        return mediaManager.createMediaObject(data, mimeType, {\n            sourceId: this.id,\n        });\n    }\n    getMediaObjectConsole(mediaObject) {\n        if (typeof mediaObject.sourceId !== 'string')\n            return this.console;\n        return deviceManager.getMixinConsole(mediaObject.sourceId, this.mixinProviderNativeId);\n    }\n    /**\n     * Fire an event for this device.\n     */\n    onDeviceEvent(eventInterface, eventData) {\n        return deviceManager.onMixinEvent(this.id, this, eventInterface, eventData);\n    }\n    _lazyLoadDeviceState() {\n    }\n    manageListener(listener) {\n        this._listeners.add(listener);\n    }\n    release() {\n        for (const l of this._listeners) {\n            l.removeListener();\n        }\n    }\n}\nexports.MixinDeviceBase = MixinDeviceBase;\n(function () {\n    function _createGetState(state) {\n        return function () {\n            this._lazyLoadDeviceState();\n            return this._deviceState?.[state];\n        };\n    }\n    function _createSetState(state) {\n        return function (value) {\n            this._lazyLoadDeviceState();\n            if (!this._deviceState)\n                console.warn('device state is unavailable. the device must be discovered with deviceManager.onDeviceDiscovered or deviceManager.onDevicesChanged before the state can be set.');\n            else\n                this._deviceState[state] = value;\n        };\n    }\n    for (const field of Object.values(index_1.ScryptedInterfaceProperty)) {\n        if (field === index_1.ScryptedInterfaceProperty.nativeId)\n            continue;\n        Object.defineProperty(ScryptedDeviceBase.prototype, field, {\n            set: _createSetState(field),\n            get: _createGetState(field),\n        });\n        Object.defineProperty(MixinDeviceBase.prototype, field, {\n            set: _createSetState(field),\n            get: _createGetState(field),\n        });\n    }\n})();\nlet sdk = {};\ntry {\n    let runtimeAPI;\n    try {\n        runtimeAPI = pluginRuntimeAPI;\n    }\n    catch (e) {\n    }\n    sdk = Object.assign(sdk, {\n        log: deviceManager.getDeviceLogger(undefined),\n        deviceManager,\n        endpointManager,\n        mediaManager,\n        systemManager,\n        pluginHostAPI,\n        ...runtimeAPI,\n    });\n    try {\n        systemManager.setScryptedInterfaceDescriptors?.(index_1.TYPES_VERSION, index_1.ScryptedInterfaceDescriptors)?.catch(() => { });\n    }\n    catch (e) {\n    }\n}\ncatch (e) {\n    console.error('sdk initialization error, import @scrypted/types or use @scrypted/client instead', e);\n}\nexports.default = sdk;\n//# sourceMappingURL=index.js.map","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.StorageSettings = void 0;\nconst _1 = __importStar(require(\".\"));\nconst { systemManager } = _1.default;\nfunction parseValue(value, setting, readDefaultValue, rawDevice) {\n    const type = setting.multiple ? 'array' : setting.type;\n    if (type === 'boolean') {\n        if (value === 'true')\n            return true;\n        if (value === 'false')\n            return false;\n        return readDefaultValue() || false;\n    }\n    if (type === 'number') {\n        return parseFloat(value) || readDefaultValue() || 0;\n    }\n    if (type === 'integer') {\n        return parseInt(value) || readDefaultValue() || 0;\n    }\n    if (type === 'array') {\n        try {\n            return JSON.parse(value);\n        }\n        catch (e) {\n            return readDefaultValue() || [];\n        }\n    }\n    if (type === 'device') {\n        if (rawDevice)\n            return value;\n        return systemManager.getDeviceById(value) || systemManager.getDeviceById(readDefaultValue());\n    }\n    // string type, so check if it is json.\n    if (value && setting.json) {\n        try {\n            return JSON.parse(value);\n        }\n        catch (e) {\n            return readDefaultValue();\n        }\n    }\n    return value || readDefaultValue();\n}\nclass StorageSettings {\n    constructor(device, settings) {\n        this.device = device;\n        this.settings = settings;\n        this.values = {};\n        this.hasValue = {};\n        for (const key of Object.keys(settings)) {\n            const setting = settings[key];\n            const rawGet = () => this.getItem(key);\n            let get;\n            if (setting.type !== 'clippath') {\n                get = rawGet;\n            }\n            else {\n                // maybe need a mapPut. clippath is the only complex type at the moment.\n                get = () => {\n                    try {\n                        return JSON.parse(rawGet());\n                    }\n                    catch (e) {\n                    }\n                };\n            }\n            Object.defineProperty(this.values, key, {\n                get,\n                set: value => this.putSetting(key, value),\n                enumerable: true,\n            });\n            Object.defineProperty(this.hasValue, key, {\n                get: () => this.device.storage.getItem(key) != null,\n                enumerable: true,\n            });\n        }\n    }\n    get keys() {\n        const ret = {};\n        for (const key of Object.keys(this.settings)) {\n            ret[key] = key;\n        }\n        return ret;\n    }\n    async getSettings() {\n        const onGet = await this.options?.onGet?.();\n        const ret = [];\n        for (const [key, setting] of Object.entries(this.settings)) {\n            let s = Object.assign({}, setting);\n            if (onGet?.[key])\n                s = Object.assign(s, onGet[key]);\n            if (s.onGet)\n                s = Object.assign(s, await s.onGet());\n            if (s.hide || await this.options?.hide?.[key]?.())\n                continue;\n            s.key = key;\n            s.value = this.getItemInternal(key, s, true);\n            ret.push(s);\n            delete s.onPut;\n            delete s.onGet;\n            delete s.mapPut;\n            delete s.mapGet;\n        }\n        return ret;\n    }\n    async putSetting(key, value) {\n        const setting = this.settings[key];\n        let oldValue;\n        if (setting)\n            oldValue = this.getItemInternal(key, setting);\n        return this.putSettingInternal(setting, oldValue, key, value);\n    }\n    putSettingInternal(setting, oldValue, key, value) {\n        if (!setting?.noStore) {\n            if (setting?.mapPut)\n                value = setting.mapPut(oldValue, value);\n            if (typeof value === 'object')\n                this.device.storage.setItem(key, JSON.stringify(value));\n            else\n                this.device.storage.setItem(key, value?.toString());\n        }\n        setting?.onPut?.(oldValue, value);\n        this.device.onDeviceEvent(_1.ScryptedInterface.Settings, undefined);\n    }\n    getItemInternal(key, setting, rawDevice) {\n        if (!setting)\n            return this.device.storage.getItem(key);\n        const readDefaultValue = () => {\n            if (setting.persistedDefaultValue) {\n                this.putSettingInternal(setting, undefined, key, setting.persistedDefaultValue);\n                return setting.persistedDefaultValue;\n            }\n            return setting.defaultValue;\n        };\n        const ret = parseValue(this.device.storage.getItem(key), setting, readDefaultValue, rawDevice);\n        return setting.mapGet ? setting.mapGet(ret) : ret;\n    }\n    getItem(key) {\n        return this.getItemInternal(key, this.settings[key]);\n    }\n}\nexports.StorageSettings = StorageSettings;\n//# sourceMappingURL=storage-settings.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ScryptedMimeTypes = exports.ScryptedInterface = exports.MediaPlayerState = exports.SecuritySystemObstruction = exports.SecuritySystemMode = exports.AirQuality = exports.ChargeState = exports.LockState = exports.PanTiltZoomMovement = exports.ThermostatMode = exports.TemperatureUnit = exports.FanMode = exports.HumidityMode = exports.ScryptedDeviceType = exports.ScryptedInterfaceDescriptors = exports.ScryptedInterfaceMethod = exports.ScryptedInterfaceProperty = exports.DeviceBase = exports.TYPES_VERSION = void 0;\nexports.TYPES_VERSION = \"0.2.78\";\nclass DeviceBase {\n}\nexports.DeviceBase = DeviceBase;\nvar ScryptedInterfaceProperty;\n(function (ScryptedInterfaceProperty) {\n    ScryptedInterfaceProperty[\"id\"] = \"id\";\n    ScryptedInterfaceProperty[\"info\"] = \"info\";\n    ScryptedInterfaceProperty[\"interfaces\"] = \"interfaces\";\n    ScryptedInterfaceProperty[\"mixins\"] = \"mixins\";\n    ScryptedInterfaceProperty[\"name\"] = \"name\";\n    ScryptedInterfaceProperty[\"nativeId\"] = \"nativeId\";\n    ScryptedInterfaceProperty[\"pluginId\"] = \"pluginId\";\n    ScryptedInterfaceProperty[\"providedInterfaces\"] = \"providedInterfaces\";\n    ScryptedInterfaceProperty[\"providedName\"] = \"providedName\";\n    ScryptedInterfaceProperty[\"providedRoom\"] = \"providedRoom\";\n    ScryptedInterfaceProperty[\"providedType\"] = \"providedType\";\n    ScryptedInterfaceProperty[\"providerId\"] = \"providerId\";\n    ScryptedInterfaceProperty[\"room\"] = \"room\";\n    ScryptedInterfaceProperty[\"type\"] = \"type\";\n    ScryptedInterfaceProperty[\"on\"] = \"on\";\n    ScryptedInterfaceProperty[\"brightness\"] = \"brightness\";\n    ScryptedInterfaceProperty[\"colorTemperature\"] = \"colorTemperature\";\n    ScryptedInterfaceProperty[\"rgb\"] = \"rgb\";\n    ScryptedInterfaceProperty[\"hsv\"] = \"hsv\";\n    ScryptedInterfaceProperty[\"running\"] = \"running\";\n    ScryptedInterfaceProperty[\"paused\"] = \"paused\";\n    ScryptedInterfaceProperty[\"docked\"] = \"docked\";\n    ScryptedInterfaceProperty[\"temperatureSetting\"] = \"temperatureSetting\";\n    ScryptedInterfaceProperty[\"thermostatActiveMode\"] = \"thermostatActiveMode\";\n    ScryptedInterfaceProperty[\"thermostatAvailableModes\"] = \"thermostatAvailableModes\";\n    ScryptedInterfaceProperty[\"thermostatMode\"] = \"thermostatMode\";\n    ScryptedInterfaceProperty[\"thermostatSetpoint\"] = \"thermostatSetpoint\";\n    ScryptedInterfaceProperty[\"thermostatSetpointHigh\"] = \"thermostatSetpointHigh\";\n    ScryptedInterfaceProperty[\"thermostatSetpointLow\"] = \"thermostatSetpointLow\";\n    ScryptedInterfaceProperty[\"temperature\"] = \"temperature\";\n    ScryptedInterfaceProperty[\"temperatureUnit\"] = \"temperatureUnit\";\n    ScryptedInterfaceProperty[\"humidity\"] = \"humidity\";\n    ScryptedInterfaceProperty[\"ptzCapabilities\"] = \"ptzCapabilities\";\n    ScryptedInterfaceProperty[\"lockState\"] = \"lockState\";\n    ScryptedInterfaceProperty[\"entryOpen\"] = \"entryOpen\";\n    ScryptedInterfaceProperty[\"batteryLevel\"] = \"batteryLevel\";\n    ScryptedInterfaceProperty[\"chargeState\"] = \"chargeState\";\n    ScryptedInterfaceProperty[\"online\"] = \"online\";\n    ScryptedInterfaceProperty[\"fromMimeType\"] = \"fromMimeType\";\n    ScryptedInterfaceProperty[\"toMimeType\"] = \"toMimeType\";\n    ScryptedInterfaceProperty[\"binaryState\"] = \"binaryState\";\n    ScryptedInterfaceProperty[\"tampered\"] = \"tampered\";\n    ScryptedInterfaceProperty[\"powerDetected\"] = \"powerDetected\";\n    ScryptedInterfaceProperty[\"audioDetected\"] = \"audioDetected\";\n    ScryptedInterfaceProperty[\"motionDetected\"] = \"motionDetected\";\n    ScryptedInterfaceProperty[\"ambientLight\"] = \"ambientLight\";\n    ScryptedInterfaceProperty[\"occupied\"] = \"occupied\";\n    ScryptedInterfaceProperty[\"flooded\"] = \"flooded\";\n    ScryptedInterfaceProperty[\"ultraviolet\"] = \"ultraviolet\";\n    ScryptedInterfaceProperty[\"luminance\"] = \"luminance\";\n    ScryptedInterfaceProperty[\"position\"] = \"position\";\n    ScryptedInterfaceProperty[\"securitySystemState\"] = \"securitySystemState\";\n    ScryptedInterfaceProperty[\"pm10Density\"] = \"pm10Density\";\n    ScryptedInterfaceProperty[\"pm25Density\"] = \"pm25Density\";\n    ScryptedInterfaceProperty[\"vocDensity\"] = \"vocDensity\";\n    ScryptedInterfaceProperty[\"noxDensity\"] = \"noxDensity\";\n    ScryptedInterfaceProperty[\"co2ppm\"] = \"co2ppm\";\n    ScryptedInterfaceProperty[\"airQuality\"] = \"airQuality\";\n    ScryptedInterfaceProperty[\"humiditySetting\"] = \"humiditySetting\";\n    ScryptedInterfaceProperty[\"fan\"] = \"fan\";\n    ScryptedInterfaceProperty[\"applicationInfo\"] = \"applicationInfo\";\n})(ScryptedInterfaceProperty = exports.ScryptedInterfaceProperty || (exports.ScryptedInterfaceProperty = {}));\nvar ScryptedInterfaceMethod;\n(function (ScryptedInterfaceMethod) {\n    ScryptedInterfaceMethod[\"listen\"] = \"listen\";\n    ScryptedInterfaceMethod[\"probe\"] = \"probe\";\n    ScryptedInterfaceMethod[\"setMixins\"] = \"setMixins\";\n    ScryptedInterfaceMethod[\"setName\"] = \"setName\";\n    ScryptedInterfaceMethod[\"setRoom\"] = \"setRoom\";\n    ScryptedInterfaceMethod[\"setType\"] = \"setType\";\n    ScryptedInterfaceMethod[\"getPluginJson\"] = \"getPluginJson\";\n    ScryptedInterfaceMethod[\"turnOff\"] = \"turnOff\";\n    ScryptedInterfaceMethod[\"turnOn\"] = \"turnOn\";\n    ScryptedInterfaceMethod[\"setBrightness\"] = \"setBrightness\";\n    ScryptedInterfaceMethod[\"getTemperatureMaxK\"] = \"getTemperatureMaxK\";\n    ScryptedInterfaceMethod[\"getTemperatureMinK\"] = \"getTemperatureMinK\";\n    ScryptedInterfaceMethod[\"setColorTemperature\"] = \"setColorTemperature\";\n    ScryptedInterfaceMethod[\"setRgb\"] = \"setRgb\";\n    ScryptedInterfaceMethod[\"setHsv\"] = \"setHsv\";\n    ScryptedInterfaceMethod[\"sendNotification\"] = \"sendNotification\";\n    ScryptedInterfaceMethod[\"start\"] = \"start\";\n    ScryptedInterfaceMethod[\"stop\"] = \"stop\";\n    ScryptedInterfaceMethod[\"pause\"] = \"pause\";\n    ScryptedInterfaceMethod[\"resume\"] = \"resume\";\n    ScryptedInterfaceMethod[\"dock\"] = \"dock\";\n    ScryptedInterfaceMethod[\"setTemperature\"] = \"setTemperature\";\n    ScryptedInterfaceMethod[\"setThermostatMode\"] = \"setThermostatMode\";\n    ScryptedInterfaceMethod[\"setThermostatSetpoint\"] = \"setThermostatSetpoint\";\n    ScryptedInterfaceMethod[\"setThermostatSetpointHigh\"] = \"setThermostatSetpointHigh\";\n    ScryptedInterfaceMethod[\"setThermostatSetpointLow\"] = \"setThermostatSetpointLow\";\n    ScryptedInterfaceMethod[\"setTemperatureUnit\"] = \"setTemperatureUnit\";\n    ScryptedInterfaceMethod[\"getPictureOptions\"] = \"getPictureOptions\";\n    ScryptedInterfaceMethod[\"takePicture\"] = \"takePicture\";\n    ScryptedInterfaceMethod[\"getAudioStream\"] = \"getAudioStream\";\n    ScryptedInterfaceMethod[\"startDisplay\"] = \"startDisplay\";\n    ScryptedInterfaceMethod[\"stopDisplay\"] = \"stopDisplay\";\n    ScryptedInterfaceMethod[\"getVideoStream\"] = \"getVideoStream\";\n    ScryptedInterfaceMethod[\"getVideoStreamOptions\"] = \"getVideoStreamOptions\";\n    ScryptedInterfaceMethod[\"getRecordingStream\"] = \"getRecordingStream\";\n    ScryptedInterfaceMethod[\"getRecordingStreamCurrentTime\"] = \"getRecordingStreamCurrentTime\";\n    ScryptedInterfaceMethod[\"getRecordingStreamOptions\"] = \"getRecordingStreamOptions\";\n    ScryptedInterfaceMethod[\"getRecordingStreamThumbnail\"] = \"getRecordingStreamThumbnail\";\n    ScryptedInterfaceMethod[\"ptzCommand\"] = \"ptzCommand\";\n    ScryptedInterfaceMethod[\"getRecordedEvents\"] = \"getRecordedEvents\";\n    ScryptedInterfaceMethod[\"getVideoClip\"] = \"getVideoClip\";\n    ScryptedInterfaceMethod[\"getVideoClipThumbnail\"] = \"getVideoClipThumbnail\";\n    ScryptedInterfaceMethod[\"getVideoClips\"] = \"getVideoClips\";\n    ScryptedInterfaceMethod[\"removeVideoClips\"] = \"removeVideoClips\";\n    ScryptedInterfaceMethod[\"setVideoStreamOptions\"] = \"setVideoStreamOptions\";\n    ScryptedInterfaceMethod[\"startIntercom\"] = \"startIntercom\";\n    ScryptedInterfaceMethod[\"stopIntercom\"] = \"stopIntercom\";\n    ScryptedInterfaceMethod[\"lock\"] = \"lock\";\n    ScryptedInterfaceMethod[\"unlock\"] = \"unlock\";\n    ScryptedInterfaceMethod[\"addPassword\"] = \"addPassword\";\n    ScryptedInterfaceMethod[\"getPasswords\"] = \"getPasswords\";\n    ScryptedInterfaceMethod[\"removePassword\"] = \"removePassword\";\n    ScryptedInterfaceMethod[\"activate\"] = \"activate\";\n    ScryptedInterfaceMethod[\"deactivate\"] = \"deactivate\";\n    ScryptedInterfaceMethod[\"isReversible\"] = \"isReversible\";\n    ScryptedInterfaceMethod[\"closeEntry\"] = \"closeEntry\";\n    ScryptedInterfaceMethod[\"openEntry\"] = \"openEntry\";\n    ScryptedInterfaceMethod[\"getDevice\"] = \"getDevice\";\n    ScryptedInterfaceMethod[\"releaseDevice\"] = \"releaseDevice\";\n    ScryptedInterfaceMethod[\"adoptDevice\"] = \"adoptDevice\";\n    ScryptedInterfaceMethod[\"discoverDevices\"] = \"discoverDevices\";\n    ScryptedInterfaceMethod[\"createDevice\"] = \"createDevice\";\n    ScryptedInterfaceMethod[\"getCreateDeviceSettings\"] = \"getCreateDeviceSettings\";\n    ScryptedInterfaceMethod[\"getRefreshFrequency\"] = \"getRefreshFrequency\";\n    ScryptedInterfaceMethod[\"refresh\"] = \"refresh\";\n    ScryptedInterfaceMethod[\"getMediaStatus\"] = \"getMediaStatus\";\n    ScryptedInterfaceMethod[\"load\"] = \"load\";\n    ScryptedInterfaceMethod[\"seek\"] = \"seek\";\n    ScryptedInterfaceMethod[\"skipNext\"] = \"skipNext\";\n    ScryptedInterfaceMethod[\"skipPrevious\"] = \"skipPrevious\";\n    ScryptedInterfaceMethod[\"convert\"] = \"convert\";\n    ScryptedInterfaceMethod[\"getSettings\"] = \"getSettings\";\n    ScryptedInterfaceMethod[\"putSetting\"] = \"putSetting\";\n    ScryptedInterfaceMethod[\"armSecuritySystem\"] = \"armSecuritySystem\";\n    ScryptedInterfaceMethod[\"disarmSecuritySystem\"] = \"disarmSecuritySystem\";\n    ScryptedInterfaceMethod[\"getReadmeMarkdown\"] = \"getReadmeMarkdown\";\n    ScryptedInterfaceMethod[\"getOauthUrl\"] = \"getOauthUrl\";\n    ScryptedInterfaceMethod[\"onOauthCallback\"] = \"onOauthCallback\";\n    ScryptedInterfaceMethod[\"canMixin\"] = \"canMixin\";\n    ScryptedInterfaceMethod[\"getMixin\"] = \"getMixin\";\n    ScryptedInterfaceMethod[\"releaseMixin\"] = \"releaseMixin\";\n    ScryptedInterfaceMethod[\"onRequest\"] = \"onRequest\";\n    ScryptedInterfaceMethod[\"onConnection\"] = \"onConnection\";\n    ScryptedInterfaceMethod[\"onPush\"] = \"onPush\";\n    ScryptedInterfaceMethod[\"run\"] = \"run\";\n    ScryptedInterfaceMethod[\"eval\"] = \"eval\";\n    ScryptedInterfaceMethod[\"loadScripts\"] = \"loadScripts\";\n    ScryptedInterfaceMethod[\"saveScript\"] = \"saveScript\";\n    ScryptedInterfaceMethod[\"trackObjects\"] = \"trackObjects\";\n    ScryptedInterfaceMethod[\"getDetectionInput\"] = \"getDetectionInput\";\n    ScryptedInterfaceMethod[\"getObjectTypes\"] = \"getObjectTypes\";\n    ScryptedInterfaceMethod[\"detectObjects\"] = \"detectObjects\";\n    ScryptedInterfaceMethod[\"generateObjectDetections\"] = \"generateObjectDetections\";\n    ScryptedInterfaceMethod[\"getDetectionModel\"] = \"getDetectionModel\";\n    ScryptedInterfaceMethod[\"setHumidity\"] = \"setHumidity\";\n    ScryptedInterfaceMethod[\"setFan\"] = \"setFan\";\n    ScryptedInterfaceMethod[\"startRTCSignalingSession\"] = \"startRTCSignalingSession\";\n    ScryptedInterfaceMethod[\"createRTCSignalingSession\"] = \"createRTCSignalingSession\";\n    ScryptedInterfaceMethod[\"getScryptedUserAccessControl\"] = \"getScryptedUserAccessControl\";\n    ScryptedInterfaceMethod[\"generateVideoFrames\"] = \"generateVideoFrames\";\n})(ScryptedInterfaceMethod = exports.ScryptedInterfaceMethod || (exports.ScryptedInterfaceMethod = {}));\nexports.ScryptedInterfaceDescriptors = {\n    ScryptedDevice: {\n        name: 'ScryptedDevice',\n        methods: [\n            'listen',\n            'probe',\n            'setMixins',\n            'setName',\n            'setRoom',\n            'setType'\n        ],\n        properties: [\n            'id',\n            'info',\n            'interfaces',\n            'mixins',\n            'name',\n            'nativeId',\n            'pluginId',\n            'providedInterfaces',\n            'providedName',\n            'providedRoom',\n            'providedType',\n            'providerId',\n            'room',\n            'type'\n        ]\n    },\n    ScryptedPlugin: {\n        name: 'ScryptedPlugin',\n        methods: [\n            'getPluginJson'\n        ],\n        properties: []\n    },\n    OnOff: {\n        name: 'OnOff',\n        methods: [\n            'turnOff',\n            'turnOn'\n        ],\n        properties: [\n            'on'\n        ]\n    },\n    Brightness: {\n        name: 'Brightness',\n        methods: [\n            'setBrightness'\n        ],\n        properties: [\n            'brightness'\n        ]\n    },\n    ColorSettingTemperature: {\n        name: 'ColorSettingTemperature',\n        methods: [\n            'getTemperatureMaxK',\n            'getTemperatureMinK',\n            'setColorTemperature'\n        ],\n        properties: [\n            'colorTemperature'\n        ]\n    },\n    ColorSettingRgb: {\n        name: 'ColorSettingRgb',\n        methods: [\n            'setRgb'\n        ],\n        properties: [\n            'rgb'\n        ]\n    },\n    ColorSettingHsv: {\n        name: 'ColorSettingHsv',\n        methods: [\n            'setHsv'\n        ],\n        properties: [\n            'hsv'\n        ]\n    },\n    Notifier: {\n        name: 'Notifier',\n        methods: [\n            'sendNotification'\n        ],\n        properties: []\n    },\n    StartStop: {\n        name: 'StartStop',\n        methods: [\n            'start',\n            'stop'\n        ],\n        properties: [\n            'running'\n        ]\n    },\n    Pause: {\n        name: 'Pause',\n        methods: [\n            'pause',\n            'resume'\n        ],\n        properties: [\n            'paused'\n        ]\n    },\n    Dock: {\n        name: 'Dock',\n        methods: [\n            'dock'\n        ],\n        properties: [\n            'docked'\n        ]\n    },\n    TemperatureSetting: {\n        name: 'TemperatureSetting',\n        methods: [\n            'setTemperature',\n            'setThermostatMode',\n            'setThermostatSetpoint',\n            'setThermostatSetpointHigh',\n            'setThermostatSetpointLow'\n        ],\n        properties: [\n            'temperatureSetting',\n            'thermostatActiveMode',\n            'thermostatAvailableModes',\n            'thermostatMode',\n            'thermostatSetpoint',\n            'thermostatSetpointHigh',\n            'thermostatSetpointLow'\n        ]\n    },\n    Thermometer: {\n        name: 'Thermometer',\n        methods: [\n            'setTemperatureUnit'\n        ],\n        properties: [\n            'temperature',\n            'temperatureUnit'\n        ]\n    },\n    HumiditySensor: {\n        name: 'HumiditySensor',\n        methods: [],\n        properties: [\n            'humidity'\n        ]\n    },\n    Camera: {\n        name: 'Camera',\n        methods: [\n            'getPictureOptions',\n            'takePicture'\n        ],\n        properties: []\n    },\n    Microphone: {\n        name: 'Microphone',\n        methods: [\n            'getAudioStream'\n        ],\n        properties: []\n    },\n    Display: {\n        name: 'Display',\n        methods: [\n            'startDisplay',\n            'stopDisplay'\n        ],\n        properties: []\n    },\n    VideoCamera: {\n        name: 'VideoCamera',\n        methods: [\n            'getVideoStream',\n            'getVideoStreamOptions'\n        ],\n        properties: []\n    },\n    VideoRecorder: {\n        name: 'VideoRecorder',\n        methods: [\n            'getRecordingStream',\n            'getRecordingStreamCurrentTime',\n            'getRecordingStreamOptions',\n            'getRecordingStreamThumbnail'\n        ],\n        properties: []\n    },\n    PanTiltZoom: {\n        name: 'PanTiltZoom',\n        methods: [\n            'ptzCommand'\n        ],\n        properties: [\n            'ptzCapabilities'\n        ]\n    },\n    EventRecorder: {\n        name: 'EventRecorder',\n        methods: [\n            'getRecordedEvents'\n        ],\n        properties: []\n    },\n    VideoClips: {\n        name: 'VideoClips',\n        methods: [\n            'getVideoClip',\n            'getVideoClipThumbnail',\n            'getVideoClips',\n            'removeVideoClips'\n        ],\n        properties: []\n    },\n    VideoCameraConfiguration: {\n        name: 'VideoCameraConfiguration',\n        methods: [\n            'setVideoStreamOptions'\n        ],\n        properties: []\n    },\n    Intercom: {\n        name: 'Intercom',\n        methods: [\n            'startIntercom',\n            'stopIntercom'\n        ],\n        properties: []\n    },\n    Lock: {\n        name: 'Lock',\n        methods: [\n            'lock',\n            'unlock'\n        ],\n        properties: [\n            'lockState'\n        ]\n    },\n    PasswordStore: {\n        name: 'PasswordStore',\n        methods: [\n            'addPassword',\n            'getPasswords',\n            'removePassword'\n        ],\n        properties: []\n    },\n    Scene: {\n        name: 'Scene',\n        methods: [\n            'activate',\n            'deactivate',\n            'isReversible'\n        ],\n        properties: []\n    },\n    Entry: {\n        name: 'Entry',\n        methods: [\n            'closeEntry',\n            'openEntry'\n        ],\n        properties: []\n    },\n    EntrySensor: {\n        name: 'EntrySensor',\n        methods: [],\n        properties: [\n            'entryOpen'\n        ]\n    },\n    DeviceProvider: {\n        name: 'DeviceProvider',\n        methods: [\n            'getDevice',\n            'releaseDevice'\n        ],\n        properties: []\n    },\n    DeviceDiscovery: {\n        name: 'DeviceDiscovery',\n        methods: [\n            'adoptDevice',\n            'discoverDevices'\n        ],\n        properties: []\n    },\n    DeviceCreator: {\n        name: 'DeviceCreator',\n        methods: [\n            'createDevice',\n            'getCreateDeviceSettings'\n        ],\n        properties: []\n    },\n    Battery: {\n        name: 'Battery',\n        methods: [],\n        properties: [\n            'batteryLevel'\n        ]\n    },\n    Charger: {\n        name: 'Charger',\n        methods: [],\n        properties: [\n            'chargeState'\n        ]\n    },\n    Refresh: {\n        name: 'Refresh',\n        methods: [\n            'getRefreshFrequency',\n            'refresh'\n        ],\n        properties: []\n    },\n    MediaPlayer: {\n        name: 'MediaPlayer',\n        methods: [\n            'getMediaStatus',\n            'load',\n            'seek',\n            'skipNext',\n            'skipPrevious'\n        ],\n        properties: []\n    },\n    Online: {\n        name: 'Online',\n        methods: [],\n        properties: [\n            'online'\n        ]\n    },\n    BufferConverter: {\n        name: 'BufferConverter',\n        methods: [\n            'convert'\n        ],\n        properties: [\n            'fromMimeType',\n            'toMimeType'\n        ]\n    },\n    Settings: {\n        name: 'Settings',\n        methods: [\n            'getSettings',\n            'putSetting'\n        ],\n        properties: []\n    },\n    BinarySensor: {\n        name: 'BinarySensor',\n        methods: [],\n        properties: [\n            'binaryState'\n        ]\n    },\n    TamperSensor: {\n        name: 'TamperSensor',\n        methods: [],\n        properties: [\n            'tampered'\n        ]\n    },\n    PowerSensor: {\n        name: 'PowerSensor',\n        methods: [],\n        properties: [\n            'powerDetected'\n        ]\n    },\n    AudioSensor: {\n        name: 'AudioSensor',\n        methods: [],\n        properties: [\n            'audioDetected'\n        ]\n    },\n    MotionSensor: {\n        name: 'MotionSensor',\n        methods: [],\n        properties: [\n            'motionDetected'\n        ]\n    },\n    AmbientLightSensor: {\n        name: 'AmbientLightSensor',\n        methods: [],\n        properties: [\n            'ambientLight'\n        ]\n    },\n    OccupancySensor: {\n        name: 'OccupancySensor',\n        methods: [],\n        properties: [\n            'occupied'\n        ]\n    },\n    FloodSensor: {\n        name: 'FloodSensor',\n        methods: [],\n        properties: [\n            'flooded'\n        ]\n    },\n    UltravioletSensor: {\n        name: 'UltravioletSensor',\n        methods: [],\n        properties: [\n            'ultraviolet'\n        ]\n    },\n    LuminanceSensor: {\n        name: 'LuminanceSensor',\n        methods: [],\n        properties: [\n            'luminance'\n        ]\n    },\n    PositionSensor: {\n        name: 'PositionSensor',\n        methods: [],\n        properties: [\n            'position'\n        ]\n    },\n    SecuritySystem: {\n        name: 'SecuritySystem',\n        methods: [\n            'armSecuritySystem',\n            'disarmSecuritySystem'\n        ],\n        properties: [\n            'securitySystemState'\n        ]\n    },\n    PM10Sensor: {\n        name: 'PM10Sensor',\n        methods: [],\n        properties: [\n            'pm10Density'\n        ]\n    },\n    PM25Sensor: {\n        name: 'PM25Sensor',\n        methods: [],\n        properties: [\n            'pm25Density'\n        ]\n    },\n    VOCSensor: {\n        name: 'VOCSensor',\n        methods: [],\n        properties: [\n            'vocDensity'\n        ]\n    },\n    NOXSensor: {\n        name: 'NOXSensor',\n        methods: [],\n        properties: [\n            'noxDensity'\n        ]\n    },\n    CO2Sensor: {\n        name: 'CO2Sensor',\n        methods: [],\n        properties: [\n            'co2ppm'\n        ]\n    },\n    AirQualitySensor: {\n        name: 'AirQualitySensor',\n        methods: [],\n        properties: [\n            'airQuality'\n        ]\n    },\n    Readme: {\n        name: 'Readme',\n        methods: [\n            'getReadmeMarkdown'\n        ],\n        properties: []\n    },\n    OauthClient: {\n        name: 'OauthClient',\n        methods: [\n            'getOauthUrl',\n            'onOauthCallback'\n        ],\n        properties: []\n    },\n    MixinProvider: {\n        name: 'MixinProvider',\n        methods: [\n            'canMixin',\n            'getMixin',\n            'releaseMixin'\n        ],\n        properties: []\n    },\n    HttpRequestHandler: {\n        name: 'HttpRequestHandler',\n        methods: [\n            'onRequest'\n        ],\n        properties: []\n    },\n    EngineIOHandler: {\n        name: 'EngineIOHandler',\n        methods: [\n            'onConnection'\n        ],\n        properties: []\n    },\n    PushHandler: {\n        name: 'PushHandler',\n        methods: [\n            'onPush'\n        ],\n        properties: []\n    },\n    Program: {\n        name: 'Program',\n        methods: [\n            'run'\n        ],\n        properties: []\n    },\n    Scriptable: {\n        name: 'Scriptable',\n        methods: [\n            'eval',\n            'loadScripts',\n            'saveScript'\n        ],\n        properties: []\n    },\n    ObjectTracker: {\n        name: 'ObjectTracker',\n        methods: [\n            'trackObjects'\n        ],\n        properties: []\n    },\n    ObjectDetector: {\n        name: 'ObjectDetector',\n        methods: [\n            'getDetectionInput',\n            'getObjectTypes'\n        ],\n        properties: []\n    },\n    ObjectDetection: {\n        name: 'ObjectDetection',\n        methods: [\n            'detectObjects',\n            'generateObjectDetections',\n            'getDetectionModel'\n        ],\n        properties: []\n    },\n    HumiditySetting: {\n        name: 'HumiditySetting',\n        methods: [\n            'setHumidity'\n        ],\n        properties: [\n            'humiditySetting'\n        ]\n    },\n    Fan: {\n        name: 'Fan',\n        methods: [\n            'setFan'\n        ],\n        properties: [\n            'fan'\n        ]\n    },\n    RTCSignalingChannel: {\n        name: 'RTCSignalingChannel',\n        methods: [\n            'startRTCSignalingSession'\n        ],\n        properties: []\n    },\n    RTCSignalingClient: {\n        name: 'RTCSignalingClient',\n        methods: [\n            'createRTCSignalingSession'\n        ],\n        properties: []\n    },\n    LauncherApplication: {\n        name: 'LauncherApplication',\n        methods: [],\n        properties: [\n            'applicationInfo'\n        ]\n    },\n    ScryptedUser: {\n        name: 'ScryptedUser',\n        methods: [\n            'getScryptedUserAccessControl'\n        ],\n        properties: []\n    },\n    VideoFrameGenerator: {\n        name: 'VideoFrameGenerator',\n        methods: [\n            'generateVideoFrames'\n        ],\n        properties: []\n    }\n};\n/**\n * @category Core Reference\n */\nvar ScryptedDeviceType;\n(function (ScryptedDeviceType) {\n    ScryptedDeviceType[\"Builtin\"] = \"Builtin\";\n    ScryptedDeviceType[\"Camera\"] = \"Camera\";\n    ScryptedDeviceType[\"Fan\"] = \"Fan\";\n    ScryptedDeviceType[\"Light\"] = \"Light\";\n    ScryptedDeviceType[\"Switch\"] = \"Switch\";\n    ScryptedDeviceType[\"Outlet\"] = \"Outlet\";\n    ScryptedDeviceType[\"Sensor\"] = \"Sensor\";\n    ScryptedDeviceType[\"Scene\"] = \"Scene\";\n    ScryptedDeviceType[\"Program\"] = \"Program\";\n    ScryptedDeviceType[\"Automation\"] = \"Automation\";\n    ScryptedDeviceType[\"Vacuum\"] = \"Vacuum\";\n    ScryptedDeviceType[\"Notifier\"] = \"Notifier\";\n    ScryptedDeviceType[\"Thermostat\"] = \"Thermostat\";\n    ScryptedDeviceType[\"Lock\"] = \"Lock\";\n    ScryptedDeviceType[\"PasswordControl\"] = \"PasswordControl\";\n    /**\n     * Displays have audio and video output.\n     */\n    ScryptedDeviceType[\"Display\"] = \"Display\";\n    /**\n     * Smart Displays have two way audio and video.\n     */\n    ScryptedDeviceType[\"SmartDisplay\"] = \"SmartDisplay\";\n    ScryptedDeviceType[\"Speaker\"] = \"Speaker\";\n    /**\n     * Smart Speakers have two way audio.\n     */\n    ScryptedDeviceType[\"SmartSpeaker\"] = \"SmartSpeaker\";\n    ScryptedDeviceType[\"Event\"] = \"Event\";\n    ScryptedDeviceType[\"Entry\"] = \"Entry\";\n    ScryptedDeviceType[\"Garage\"] = \"Garage\";\n    ScryptedDeviceType[\"DeviceProvider\"] = \"DeviceProvider\";\n    ScryptedDeviceType[\"DataSource\"] = \"DataSource\";\n    ScryptedDeviceType[\"API\"] = \"API\";\n    ScryptedDeviceType[\"Doorbell\"] = \"Doorbell\";\n    ScryptedDeviceType[\"Irrigation\"] = \"Irrigation\";\n    ScryptedDeviceType[\"Valve\"] = \"Valve\";\n    ScryptedDeviceType[\"Person\"] = \"Person\";\n    ScryptedDeviceType[\"SecuritySystem\"] = \"SecuritySystem\";\n    ScryptedDeviceType[\"WindowCovering\"] = \"WindowCovering\";\n    ScryptedDeviceType[\"Siren\"] = \"Siren\";\n    ScryptedDeviceType[\"Unknown\"] = \"Unknown\";\n})(ScryptedDeviceType = exports.ScryptedDeviceType || (exports.ScryptedDeviceType = {}));\nvar HumidityMode;\n(function (HumidityMode) {\n    HumidityMode[\"Humidify\"] = \"Humidify\";\n    HumidityMode[\"Dehumidify\"] = \"Dehumidify\";\n    HumidityMode[\"Auto\"] = \"Auto\";\n    HumidityMode[\"Off\"] = \"Off\";\n})(HumidityMode = exports.HumidityMode || (exports.HumidityMode = {}));\nvar FanMode;\n(function (FanMode) {\n    FanMode[\"Auto\"] = \"Auto\";\n    FanMode[\"Manual\"] = \"Manual\";\n})(FanMode = exports.FanMode || (exports.FanMode = {}));\nvar TemperatureUnit;\n(function (TemperatureUnit) {\n    TemperatureUnit[\"C\"] = \"C\";\n    TemperatureUnit[\"F\"] = \"F\";\n})(TemperatureUnit = exports.TemperatureUnit || (exports.TemperatureUnit = {}));\nvar ThermostatMode;\n(function (ThermostatMode) {\n    ThermostatMode[\"Off\"] = \"Off\";\n    ThermostatMode[\"Cool\"] = \"Cool\";\n    ThermostatMode[\"Heat\"] = \"Heat\";\n    ThermostatMode[\"HeatCool\"] = \"HeatCool\";\n    ThermostatMode[\"Auto\"] = \"Auto\";\n    ThermostatMode[\"FanOnly\"] = \"FanOnly\";\n    ThermostatMode[\"Purifier\"] = \"Purifier\";\n    ThermostatMode[\"Eco\"] = \"Eco\";\n    ThermostatMode[\"Dry\"] = \"Dry\";\n    ThermostatMode[\"On\"] = \"On\";\n})(ThermostatMode = exports.ThermostatMode || (exports.ThermostatMode = {}));\nvar PanTiltZoomMovement;\n(function (PanTiltZoomMovement) {\n    PanTiltZoomMovement[\"Absolute\"] = \"Absolute\";\n    PanTiltZoomMovement[\"Relative\"] = \"Relative\";\n})(PanTiltZoomMovement = exports.PanTiltZoomMovement || (exports.PanTiltZoomMovement = {}));\nvar LockState;\n(function (LockState) {\n    LockState[\"Locked\"] = \"Locked\";\n    LockState[\"Unlocked\"] = \"Unlocked\";\n    LockState[\"Jammed\"] = \"Jammed\";\n})(LockState = exports.LockState || (exports.LockState = {}));\nvar ChargeState;\n(function (ChargeState) {\n    ChargeState[\"Trickle\"] = \"trickle\";\n    ChargeState[\"Charging\"] = \"charging\";\n    ChargeState[\"NotCharging\"] = \"not-charging\";\n})(ChargeState = exports.ChargeState || (exports.ChargeState = {}));\nvar AirQuality;\n(function (AirQuality) {\n    AirQuality[\"Unknown\"] = \"Unknown\";\n    AirQuality[\"Excellent\"] = \"Excellent\";\n    AirQuality[\"Good\"] = \"Good\";\n    AirQuality[\"Fair\"] = \"Fair\";\n    AirQuality[\"Inferior\"] = \"Inferior\";\n    AirQuality[\"Poor\"] = \"Poor\";\n})(AirQuality = exports.AirQuality || (exports.AirQuality = {}));\nvar SecuritySystemMode;\n(function (SecuritySystemMode) {\n    SecuritySystemMode[\"Disarmed\"] = \"Disarmed\";\n    SecuritySystemMode[\"HomeArmed\"] = \"HomeArmed\";\n    SecuritySystemMode[\"AwayArmed\"] = \"AwayArmed\";\n    SecuritySystemMode[\"NightArmed\"] = \"NightArmed\";\n})(SecuritySystemMode = exports.SecuritySystemMode || (exports.SecuritySystemMode = {}));\nvar SecuritySystemObstruction;\n(function (SecuritySystemObstruction) {\n    SecuritySystemObstruction[\"Sensor\"] = \"Sensor\";\n    SecuritySystemObstruction[\"Occupied\"] = \"Occupied\";\n    SecuritySystemObstruction[\"Time\"] = \"Time\";\n    SecuritySystemObstruction[\"Error\"] = \"Error\";\n})(SecuritySystemObstruction = exports.SecuritySystemObstruction || (exports.SecuritySystemObstruction = {}));\nvar MediaPlayerState;\n(function (MediaPlayerState) {\n    MediaPlayerState[\"Idle\"] = \"Idle\";\n    MediaPlayerState[\"Playing\"] = \"Playing\";\n    MediaPlayerState[\"Paused\"] = \"Paused\";\n    MediaPlayerState[\"Buffering\"] = \"Buffering\";\n})(MediaPlayerState = exports.MediaPlayerState || (exports.MediaPlayerState = {}));\nvar ScryptedInterface;\n(function (ScryptedInterface) {\n    ScryptedInterface[\"ScryptedDevice\"] = \"ScryptedDevice\";\n    ScryptedInterface[\"ScryptedPlugin\"] = \"ScryptedPlugin\";\n    ScryptedInterface[\"OnOff\"] = \"OnOff\";\n    ScryptedInterface[\"Brightness\"] = \"Brightness\";\n    ScryptedInterface[\"ColorSettingTemperature\"] = \"ColorSettingTemperature\";\n    ScryptedInterface[\"ColorSettingRgb\"] = \"ColorSettingRgb\";\n    ScryptedInterface[\"ColorSettingHsv\"] = \"ColorSettingHsv\";\n    ScryptedInterface[\"Notifier\"] = \"Notifier\";\n    ScryptedInterface[\"StartStop\"] = \"StartStop\";\n    ScryptedInterface[\"Pause\"] = \"Pause\";\n    ScryptedInterface[\"Dock\"] = \"Dock\";\n    ScryptedInterface[\"TemperatureSetting\"] = \"TemperatureSetting\";\n    ScryptedInterface[\"Thermometer\"] = \"Thermometer\";\n    ScryptedInterface[\"HumiditySensor\"] = \"HumiditySensor\";\n    ScryptedInterface[\"Camera\"] = \"Camera\";\n    ScryptedInterface[\"Microphone\"] = \"Microphone\";\n    ScryptedInterface[\"Display\"] = \"Display\";\n    ScryptedInterface[\"VideoCamera\"] = \"VideoCamera\";\n    ScryptedInterface[\"VideoRecorder\"] = \"VideoRecorder\";\n    ScryptedInterface[\"PanTiltZoom\"] = \"PanTiltZoom\";\n    ScryptedInterface[\"EventRecorder\"] = \"EventRecorder\";\n    ScryptedInterface[\"VideoClips\"] = \"VideoClips\";\n    ScryptedInterface[\"VideoCameraConfiguration\"] = \"VideoCameraConfiguration\";\n    ScryptedInterface[\"Intercom\"] = \"Intercom\";\n    ScryptedInterface[\"Lock\"] = \"Lock\";\n    ScryptedInterface[\"PasswordStore\"] = \"PasswordStore\";\n    ScryptedInterface[\"Scene\"] = \"Scene\";\n    ScryptedInterface[\"Entry\"] = \"Entry\";\n    ScryptedInterface[\"EntrySensor\"] = \"EntrySensor\";\n    ScryptedInterface[\"DeviceProvider\"] = \"DeviceProvider\";\n    ScryptedInterface[\"DeviceDiscovery\"] = \"DeviceDiscovery\";\n    ScryptedInterface[\"DeviceCreator\"] = \"DeviceCreator\";\n    ScryptedInterface[\"Battery\"] = \"Battery\";\n    ScryptedInterface[\"Charger\"] = \"Charger\";\n    ScryptedInterface[\"Refresh\"] = \"Refresh\";\n    ScryptedInterface[\"MediaPlayer\"] = \"MediaPlayer\";\n    ScryptedInterface[\"Online\"] = \"Online\";\n    ScryptedInterface[\"BufferConverter\"] = \"BufferConverter\";\n    ScryptedInterface[\"Settings\"] = \"Settings\";\n    ScryptedInterface[\"BinarySensor\"] = \"BinarySensor\";\n    ScryptedInterface[\"TamperSensor\"] = \"TamperSensor\";\n    ScryptedInterface[\"PowerSensor\"] = \"PowerSensor\";\n    ScryptedInterface[\"AudioSensor\"] = \"AudioSensor\";\n    ScryptedInterface[\"MotionSensor\"] = \"MotionSensor\";\n    ScryptedInterface[\"AmbientLightSensor\"] = \"AmbientLightSensor\";\n    ScryptedInterface[\"OccupancySensor\"] = \"OccupancySensor\";\n    ScryptedInterface[\"FloodSensor\"] = \"FloodSensor\";\n    ScryptedInterface[\"UltravioletSensor\"] = \"UltravioletSensor\";\n    ScryptedInterface[\"LuminanceSensor\"] = \"LuminanceSensor\";\n    ScryptedInterface[\"PositionSensor\"] = \"PositionSensor\";\n    ScryptedInterface[\"SecuritySystem\"] = \"SecuritySystem\";\n    ScryptedInterface[\"PM10Sensor\"] = \"PM10Sensor\";\n    ScryptedInterface[\"PM25Sensor\"] = \"PM25Sensor\";\n    ScryptedInterface[\"VOCSensor\"] = \"VOCSensor\";\n    ScryptedInterface[\"NOXSensor\"] = \"NOXSensor\";\n    ScryptedInterface[\"CO2Sensor\"] = \"CO2Sensor\";\n    ScryptedInterface[\"AirQualitySensor\"] = \"AirQualitySensor\";\n    ScryptedInterface[\"Readme\"] = \"Readme\";\n    ScryptedInterface[\"OauthClient\"] = \"OauthClient\";\n    ScryptedInterface[\"MixinProvider\"] = \"MixinProvider\";\n    ScryptedInterface[\"HttpRequestHandler\"] = \"HttpRequestHandler\";\n    ScryptedInterface[\"EngineIOHandler\"] = \"EngineIOHandler\";\n    ScryptedInterface[\"PushHandler\"] = \"PushHandler\";\n    ScryptedInterface[\"Program\"] = \"Program\";\n    ScryptedInterface[\"Scriptable\"] = \"Scriptable\";\n    ScryptedInterface[\"ObjectTracker\"] = \"ObjectTracker\";\n    ScryptedInterface[\"ObjectDetector\"] = \"ObjectDetector\";\n    ScryptedInterface[\"ObjectDetection\"] = \"ObjectDetection\";\n    ScryptedInterface[\"HumiditySetting\"] = \"HumiditySetting\";\n    ScryptedInterface[\"Fan\"] = \"Fan\";\n    ScryptedInterface[\"RTCSignalingChannel\"] = \"RTCSignalingChannel\";\n    ScryptedInterface[\"RTCSignalingClient\"] = \"RTCSignalingClient\";\n    ScryptedInterface[\"LauncherApplication\"] = \"LauncherApplication\";\n    ScryptedInterface[\"ScryptedUser\"] = \"ScryptedUser\";\n    ScryptedInterface[\"VideoFrameGenerator\"] = \"VideoFrameGenerator\";\n})(ScryptedInterface = exports.ScryptedInterface || (exports.ScryptedInterface = {}));\nvar ScryptedMimeTypes;\n(function (ScryptedMimeTypes) {\n    ScryptedMimeTypes[\"Url\"] = \"text/x-uri\";\n    ScryptedMimeTypes[\"InsecureLocalUrl\"] = \"text/x-insecure-local-uri\";\n    ScryptedMimeTypes[\"LocalUrl\"] = \"text/x-local-uri\";\n    ScryptedMimeTypes[\"PushEndpoint\"] = \"text/x-push-endpoint\";\n    ScryptedMimeTypes[\"SchemePrefix\"] = \"x-scrypted/x-scrypted-scheme-\";\n    ScryptedMimeTypes[\"MediaStreamUrl\"] = \"text/x-media-url\";\n    ScryptedMimeTypes[\"MediaObject\"] = \"x-scrypted/x-scrypted-media-object\";\n    ScryptedMimeTypes[\"RequestMediaObject\"] = \"x-scrypted/x-scrypted-request-media-object\";\n    ScryptedMimeTypes[\"RequestMediaStream\"] = \"x-scrypted/x-scrypted-request-stream\";\n    ScryptedMimeTypes[\"MediaStreamFeedback\"] = \"x-scrypted/x-media-stream-feedback\";\n    ScryptedMimeTypes[\"FFmpegInput\"] = \"x-scrypted/x-ffmpeg-input\";\n    ScryptedMimeTypes[\"FFmpegTranscodeStream\"] = \"x-scrypted/x-ffmpeg-transcode-stream\";\n    ScryptedMimeTypes[\"RTCSignalingChannel\"] = \"x-scrypted/x-scrypted-rtc-signaling-channel\";\n    ScryptedMimeTypes[\"RTCSignalingSession\"] = \"x-scrypted/x-scrypted-rtc-signaling-session\";\n    ScryptedMimeTypes[\"RTCConnectionManagement\"] = \"x-scrypted/x-scrypted-rtc-connection-management\";\n    ScryptedMimeTypes[\"Image\"] = \"x-scrypted/x-scrypted-image\";\n})(ScryptedMimeTypes = exports.ScryptedMimeTypes || (exports.ScryptedMimeTypes = {}));\n//# sourceMappingURL=index.js.map","import { ScryptedDevice, ScryptedDeviceBase, ScryptedDeviceType, ScryptedInterface } from \"@scrypted/sdk\";\nimport sdk from \"@scrypted/sdk\";\n\nconst { systemManager } = sdk;\n\nconst autoIncludeToken = 'v4';\n\nexport abstract class AutoenableMixinProvider extends ScryptedDeviceBase {\n    hasEnabledMixin: { [id: string]: string } = {};\n    pluginsComponent: Promise<any>;\n    unshiftMixin = false;\n\n    constructor(nativeId?: string) {\n        super(nativeId);\n\n        try {\n            this.hasEnabledMixin = JSON.parse(this.storage.getItem('hasEnabledMixin'));\n        }\n        catch (e) {\n            this.hasEnabledMixin = {};\n        }\n\n        this.pluginsComponent = systemManager.getComponent('plugins');\n\n        // watch for descriptor changes.\n        systemManager.listen(async (eventSource, eventDetails, eventData) => {\n            if (eventDetails.eventInterface !== ScryptedInterface.ScryptedDevice || eventDetails.property)\n                return;\n\n            this.maybeEnableMixin(eventSource);\n        });\n\n        for (const id of Object.keys(systemManager.getSystemState())) {\n            const device = systemManager.getDeviceById(id);\n            this.maybeEnableMixin(device);\n        }\n    }\n\n    async shouldEnableMixin(device: ScryptedDevice) {\n        return true;\n    }\n\n    async maybeEnableMixin(device: ScryptedDevice) {\n        if (!device || device.mixins?.includes(this.id))\n            return;\n\n        if (this.hasEnabledMixin[device.id] === autoIncludeToken)\n            return;\n\n        const match = await this.canMixin(device.type, device.interfaces);\n        if (!match)\n            return;\n\n        if (!await this.shouldEnableMixin(device))\n            return;\n\n        this.log.i('auto enabling mixin for ' + device.name)\n        const mixins = (device.mixins || []).slice();\n        if (this.unshiftMixin)\n            mixins.unshift(this.id);\n        else\n            mixins.push(this.id);\n        const plugins = await this.pluginsComponent;\n        await plugins.setMixins(device.id, mixins);\n        this.setHasEnabledMixin(device.id);\n    }\n\n    setHasEnabledMixin(id: string) {\n        if (this.hasEnabledMixin[id] === autoIncludeToken)\n            return;\n        this.hasEnabledMixin[id] = autoIncludeToken;\n        this.storage.setItem('hasEnabledMixin', JSON.stringify(this.hasEnabledMixin));\n    }\n\n    abstract canMixin(type: ScryptedDeviceType, interfaces: string[]): Promise<string[]>;\n}\n","export function cloneDeep(o: any) {\n    if (!o)\n        return;\n    return JSON.parse(JSON.stringify(o));\n}\n","export class Deferred<T> {\n    finished = false;\n    resolve!: (value: T|PromiseLike<T>) => void;\n    reject!: (error: Error) => void;\n    promise: Promise<T> = new Promise((resolve, reject) => {\n        this.resolve = v => {\n            this.finished = true;\n            resolve(v);\n        };\n        this.reject = e => {\n            this.finished = true;\n            reject(e);\n        };\n    });\n}\n","import os from 'os';\n\nconst PI_MODEL_NO = [\n    // https://www.raspberrypi.org/documentation/hardware/raspberrypi/\n    'BCM2708',\n    'BCM2709',\n    'BCM2710',\n    'BCM2835', // Raspberry Pi 1 and Zero\n    'BCM2836', // Raspberry Pi 2\n    'BCM2837', // Raspberry Pi 3 (and later Raspberry Pi 2)\n    'BCM2837B0', // Raspberry Pi 3B+ and 3A+\n    'BCM2711' // Raspberry Pi 4B\n];\n\nfunction isPi(model: string) {\n    return PI_MODEL_NO.indexOf(model) > -1;\n}\n\nexport function isRaspberryPi() {\n    let cpuInfo: string;\n    try {\n        cpuInfo = require('realfs').readFileSync('/proc/cpuinfo', { encoding: 'utf8' });\n    }\n    catch (e) {\n        // if this fails, this is probably not a pi\n        return false;\n    }\n\n    const model = cpuInfo\n        .split('\\n')\n        .map(line => line.replace(/\\t/g, ''))\n        .filter(line => line.length > 0)\n        .map(line => line.split(':'))\n        .map(pair => pair.map(entry => entry.trim()))\n        .filter(pair => pair[0] === 'Hardware')\n\n    if (!model || model.length == 0) {\n        return false;\n    }\n\n    const number = model[0][1];\n    return isPi(number);\n}\n\nexport type CodecArgs = { [type: string]: string[] };\n\nconst V4L2 = 'Video4Linux (Docker compatible)';\n\nexport function getH264DecoderArgs(): CodecArgs {\n    if (isRaspberryPi()) {\n        const ret: CodecArgs = {};\n        // ret['Raspberry Pi MMAL'] = ['-c:v', 'h264_mmal'];\n        // ret[V4L2] = ['-c:v', 'h264_v4l2m2m'];\n        return ret;\n    }\n    else if (os.platform() === 'darwin') {\n        return {\n            // specifying videotoolbox seems to cause issues with multiple? unclear why.\n            // the ffmpeg process tears down, yet it seems like something is not disposed.\n            'VideoToolbox': ['-hwaccel', 'auto']\n        }\n    }\n\n    const ret: CodecArgs = {\n        'Nvidia CUDA': [\n            '-vsync', '0', '-hwaccel', 'cuda', '-hwaccel_output_format', 'nv12',\n        ],\n        'Nvidia CUVID': [\n            '-vsync', '0', '-hwaccel', 'cuvid', '-c:v', 'h264_cuvid', '-hwaccel_output_format', 'nv12',\n        ],\n    };\n\n    if (isRaspberryPi()) {\n        ret['Raspberry Pi'] = ['-c:v', 'h264_mmal'];\n        ret[V4L2] = ['-c:v', 'h264_v4l2m2m'];\n    }\n    else if (os.platform() === 'linux') {\n        ret[V4L2] = ['-c:v', 'h264_v4l2m2m'];\n    }\n    else if (os.platform() === 'win32') {\n        ret['Intel QuickSync'] = ['-c:v', 'h264_qsv'];\n    }\n    else {\n        return {};\n    }\n\n    return ret;\n}\n\nconst LIBX264_ENCODER_TITLE = 'libx264 (Software)';\n\nexport function getH264EncoderArgs() {\n    const encoders: { [type: string]: string } = {};\n\n    encoders['Copy Video, Transcode Audio'] = 'copy';\n\n\n    if (isRaspberryPi()) {\n        // encoders['Raspberry Pi OMX'] = 'h264_omx';\n        // encoders[V4L2] = 'h264_v4l2m2m';\n    }\n    else if (os.platform() === 'darwin') {\n        encoders['VideoToolbox'] = 'h264_videotoolbox';\n    }\n    else if (os.platform() === 'win32') {\n        // h264_amf h264_nvenc h264_qsv\n        encoders['Intel QuickSync'] = 'h264_qsv';\n        encoders['AMD'] = 'h264_amf';\n        encoders['Nvidia'] = 'h264_nvenc';\n    }\n    else if (os.platform() === 'linux') {\n        // h264_v4l2m2m h264_vaapi nvenc_h264\n        encoders['V4L2'] = 'h264_v4l2m2m';\n        encoders['VAAPI'] = 'h264_vaapi';\n        encoders['Nvidia'] = 'h264_nvenc';\n    }\n\n    const encoderArgs: CodecArgs = {};\n    for (const [name, encoder] of Object.entries(encoders)) {\n        encoderArgs[name] = [\n            '-c:v',\n            encoder,\n        ]\n    }\n\n    if (isRaspberryPi()) {\n        encoderArgs['Raspberry Pi'] = [\n            '-pix_fmt', 'yuv420p', '-c:v', 'h264_v4l2m2m',\n        ]\n    }\n\n    encoderArgs[LIBX264_ENCODER_TITLE] = getDebugModeH264EncoderArgs();\n\n    return encoderArgs;\n}\n\nexport function getDebugModeH264EncoderArgs() {\n    return [\n        \"-c:v\", \"libx264\",\n        // consider using yuv420 as that is simpler?\n        // https://trac.ffmpeg.org/wiki/Encode/H.264\n        '-pix_fmt', 'yuvj420p',\n        // this seems to force constrained baseline? even if the\n        // profile is explicitly set?\n        '-preset', 'ultrafast',\n        // this seems to be very picky about bitrate and fails easy.\n        // '-tune', 'zerolatency',\n        \"-bf\", \"0\",\n    ];\n}\n","export function addVideoFilterArguments(videoArgs: string[], videoFilter: string, filterName = 'unfilteredRecording') {\n    const filterIndex = videoArgs.findIndex(f => f === '-filter_complex');\n    if (filterIndex !== undefined && filterIndex !== -1)\n        videoArgs[filterIndex + 1] = videoArgs[filterIndex + 1] + `[${filterName}] ; [${filterName}] ${videoFilter}`;\n    else\n        videoArgs.push('-filter_complex', videoFilter);\n}\n","import child_process from 'child_process';\nimport { ChildProcess } from 'child_process';\nimport sdk from \"@scrypted/sdk\";\nimport { ffmpegLogInitialOutput, safePrintFFmpegArguments } from './media-helpers';\nimport { Readable } from 'stream';\nimport { readLength } from './read-stream';\n\nconst { mediaManager } = sdk;\n\nexport async function* parseFragmentedMP4(readable: Readable): AsyncGenerator<MP4Atom> {\n    while (true) {\n        const header = await readLength(readable, 8);\n        const length = header.readInt32BE(0) - 8;\n        const type = header.slice(4).toString();\n        const data = await readLength(readable, length);\n\n        yield {\n            header,\n            length,\n            type,\n            data,\n        };\n    }\n}\n\nexport interface MP4Atom {\n    header: Buffer;\n    length: number;\n    type: string;\n    data: Buffer;\n}\n\nexport const FFMPEG_FRAGMENTED_MP4_OUTPUT_ARGS = [\n    '-movflags', 'frag_keyframe+empty_moov+default_base_moof+skip_sidx+skip_trailer',\n    '-f', 'mp4',\n];\n\nexport interface FFmpegFragmentedMP4Session {\n    cp: ChildProcess;\n    generator: AsyncGenerator<MP4Atom>;\n}\n\nexport async function startFFMPegFragmentedMP4Session(inputArguments: string[], audioOutputArgs: string[], videoOutputArgs: string[], console: Console): Promise<FFmpegFragmentedMP4Session> {\n    const args = inputArguments.slice();\n    args.push(\n        ...videoOutputArgs,\n        ...audioOutputArgs,\n        ...FFMPEG_FRAGMENTED_MP4_OUTPUT_ARGS,\n        'pipe:3',\n    );\n\n    args.unshift('-hide_banner');\n    safePrintFFmpegArguments(console, args);\n\n    const cp = child_process.spawn(await mediaManager.getFFmpegPath(), args, {\n        stdio: ['pipe', 'pipe', 'pipe', 'pipe',]\n    });\n\n    ffmpegLogInitialOutput(console, cp);\n\n    return {\n        cp,\n        generator: parseFragmentedMP4(cp.stdio[3] as Readable),\n    };\n}\n","import sdk, { FFmpegInput, RequestMediaStreamOptions, ResponseMediaStreamOptions } from \"@scrypted/sdk\";\nimport child_process, { ChildProcess, StdioOptions } from 'child_process';\nimport { EventEmitter } from 'events';\nimport { Server } from 'net';\nimport { Duplex } from 'stream';\nimport { cloneDeep } from './clone-deep';\nimport { listenZeroSingleClient } from './listen-cluster';\nimport { ffmpegLogInitialOutput, safeKillFFmpeg, safePrintFFmpegArguments } from './media-helpers';\nimport { StreamChunk, StreamParser } from './stream-parser';\n\nconst { mediaManager } = sdk;\n\nexport interface ParserSession<T extends string> {\n    parserSpecific?: any;\n    sdp: Promise<Buffer[]>;\n    resetActivityTimer?: () => void,\n    negotiateMediaStream(requestMediaStream: RequestMediaStreamOptions): ResponseMediaStreamOptions;\n    inputAudioCodec?: string;\n    inputVideoCodec?: string;\n    inputVideoResolution?: {\n        width: number,\n        height: number,\n    },\n    start(): void;\n    kill(error?: Error): void;\n    killed: Promise<void>;\n    isActive: boolean;\n\n    emit(container: T, chunk: StreamChunk): this;\n    on(container: T, callback: (chunk: StreamChunk) => void): this;\n    removeListener(event: T | 'killed', callback: any): this;\n    once(event: T | 'killed', listener: (...args: any[]) => void): this;\n}\n\nexport interface ParserOptions<T extends string> {\n    parsers: { [container in T]?: StreamParser };\n    timeout?: number;\n    console: Console;\n    storage?: Storage;\n}\n\nexport async function parseResolution(cp: ChildProcess) {\n    return new Promise<string[]>((resolve, reject) => {\n        cp.on('exit', () => reject(new Error('ffmpeg exited while waiting to parse stream resolution')));\n        const parser = (data: Buffer) => {\n            const stdout = data.toString();\n            const res = /(([0-9]{2,5})x([0-9]{2,5}))/.exec(stdout);\n            if (res) {\n                cp.stdout.removeListener('data', parser);\n                cp.stderr.removeListener('data', parser);\n                resolve(res);\n            }\n        };\n        cp.stdout.on('data', parser);\n        cp.stderr.on('data', parser);\n    });\n}\n\nasync function parseInputToken(cp: ChildProcess, token: string) {\n    return new Promise<string>((resolve, reject) => {\n        cp.on('exit', () => reject(new Error('ffmpeg exited while waiting to parse stream information: ' + token)));\n        const parser = (data: Buffer) => {\n            const stdout: string = data.toString().split('Output ')[0];\n            const idx = stdout.lastIndexOf(`${token}: `);\n            if (idx !== -1) {\n                const check = stdout.substring(idx + token.length + 1).trim();\n                let next = check.indexOf(' ');\n                const next2 = check.indexOf(',');\n                if (next !== -1 && next2 < next)\n                    next = next2;\n                if (next !== -1) {\n                    cp.stdout.removeListener('data', parser);\n                    cp.stderr.removeListener('data', parser);\n                    resolve(check.substring(0, next));\n                }\n            }\n        };\n        cp.stdout.on('data', parser);\n        cp.stderr.on('data', parser);\n    });\n}\n\nexport async function parseVideoCodec(cp: ChildProcess) {\n    return parseInputToken(cp, 'Video');\n}\n\nexport async function parseAudioCodec(cp: ChildProcess) {\n    return parseInputToken(cp, 'Audio');\n}\n\nexport function setupActivityTimer(container: string, kill: (error?: Error) => void, events: {\n    once(event: 'killed', callback: () => void): void,\n}, timeout: number) {\n    let dataTimeout: NodeJS.Timeout;\n\n    function dataKill() {\n        const str = 'timeout waiting for data, killing parser session';\n        console.error(str, container);\n        kill(new Error(str));\n    }\n\n    let lastTime = Date.now();\n    function resetActivityTimer() {\n        lastTime = Date.now();\n    }\n\n    function clearActivityTimer() {\n        clearInterval(dataTimeout);\n    }\n\n    if (timeout) {\n        dataTimeout = setInterval(() => {\n            if (Date.now() > lastTime + timeout) {\n                clearInterval(dataTimeout);\n                dataTimeout = undefined;\n                dataKill();\n            }\n        }, timeout);\n    }\n\n    events.once('killed', () => clearInterval(dataTimeout));\n\n    resetActivityTimer();\n    return {\n        resetActivityTimer,\n        clearActivityTimer,\n    }\n}\n\n\nexport async function startParserSession<T extends string>(ffmpegInput: FFmpegInput, options: ParserOptions<T>): Promise<ParserSession<T>> {\n    const { console } = options;\n\n    let isActive = true;\n    const events = new EventEmitter();\n    // need this to prevent kill from throwing due to uncaught Error during cleanup\n    events.on('error', e => console.error('rebroadcast error', e));\n\n    let inputAudioCodec: string;\n    let inputVideoCodec: string;\n    let inputVideoResolution: string[];\n\n    let sessionKilled: any;\n    const killed = new Promise<void>(resolve => {\n        sessionKilled = resolve;\n    });\n\n    function kill(error?: Error) {\n        if (isActive) {\n            events.emit('killed');\n            events.emit('error', error || new Error('killed'));\n        }\n        isActive = false;\n        sessionKilled();\n        safeKillFFmpeg(cp);\n    }\n\n\n    const args = ffmpegInput.inputArguments.slice();\n\n    let needSdp = false;\n\n    const ensureActive = (killed: () => void) => {\n        if (!isActive) {\n            killed();\n            throw new Error('parser session was killed killed before ffmpeg connected');\n        }\n        events.on('killed', killed);\n    }\n\n    // first see how many pipes are needed, and prep them for the child process\n    const stdio: StdioOptions = ['pipe', 'pipe', 'pipe']\n    let pipeCount = 3;\n    const startParsers: (() => void)[] = [];\n    for (const container of Object.keys(options.parsers)) {\n        const parser: StreamParser = options.parsers[container as T];\n\n        if (parser.tcpProtocol) {\n            const tcp = await listenZeroSingleClient();\n            const url = new URL(parser.tcpProtocol);\n            url.port = tcp.port.toString();\n            args.push(\n                ...parser.outputArguments,\n                url.toString(),\n            );\n\n            const { resetActivityTimer } = setupActivityTimer(container, kill, events, options?.timeout);\n\n            startParsers.push(async () => {\n                const socket = await tcp.clientPromise;\n                try {\n                    ensureActive(() => socket.destroy());\n\n                    for await (const chunk of parser.parse(socket, parseInt(inputVideoResolution?.[2]), parseInt(inputVideoResolution?.[3]))) {\n                        events.emit(container, chunk);\n                        resetActivityTimer();\n                    }\n                }\n                catch (e) {\n                    console.error('rebroadcast parse error', e);\n                    kill(e);\n                }\n            });\n        }\n        else {\n            args.push(\n                ...parser.outputArguments,\n                `pipe:${pipeCount++}`,\n            );\n            stdio.push('pipe');\n        }\n    }\n\n    if (needSdp) {\n        args.push('-sdp_file', `pipe:${pipeCount++}`);\n        stdio.push('pipe');\n    }\n\n    // start ffmpeg process with child process pipes\n    args.unshift('-hide_banner');\n    safePrintFFmpegArguments(console, args);\n    const cp = child_process.spawn(await mediaManager.getFFmpegPath(), args, {\n        stdio,\n    });\n    ffmpegLogInitialOutput(console, cp, undefined, options?.storage);\n    cp.on('exit', () => kill(new Error('ffmpeg exited')));\n\n    let sdp: Promise<Buffer[]>;\n    if (needSdp) {\n        sdp = new Promise<Buffer[]>(resolve => {\n            const ret: Buffer[] = [];\n            cp.stdio[pipeCount - 1].on('data', buffer => {\n                ret.push(buffer);\n                resolve(ret);\n            });\n        })\n    }\n    else {\n        sdp = Promise.resolve([]);\n    }\n\n    // now parse the created pipes\n    const start = () => {\n        for (const p of startParsers) {\n            p();\n        }\n\n        let pipeIndex = 0;\n        Object.keys(options.parsers).forEach(async (container) => {\n            const parser: StreamParser = options.parsers[container as T];\n            if (!parser.parse || parser.tcpProtocol)\n                return;\n            const pipe = cp.stdio[3 + pipeIndex];\n            pipeIndex++;\n\n            try {\n                const { resetActivityTimer } = setupActivityTimer(container, kill, events, options?.timeout);\n\n                for await (const chunk of parser.parse(pipe as any, parseInt(inputVideoResolution?.[2]), parseInt(inputVideoResolution?.[3]))) {\n                    events.emit(container, chunk);\n                    resetActivityTimer();\n                }\n            }\n            catch (e) {\n                console.error('rebroadcast parse error', e);\n                kill(e);\n            }\n        });\n    };\n\n    // tbh parsing stdout is super sketchy way of doing this.\n    parseAudioCodec(cp).then(result => inputAudioCodec = result);\n    parseResolution(cp).then(result => inputVideoResolution = result);\n    await parseVideoCodec(cp).then(result => inputVideoCodec = result);\n\n    return {\n        start,\n        sdp,\n        get inputAudioCodec() {\n            return inputAudioCodec;\n        },\n        get inputVideoCodec() {\n            return inputVideoCodec;\n        },\n        get inputVideoResolution() {\n            return {\n                width: parseInt(inputVideoResolution?.[2]),\n                height: parseInt(inputVideoResolution?.[3]),\n            }\n        },\n        get isActive() { return isActive },\n        kill(error?: Error) {\n            kill(error);\n        },\n        killed,\n        negotiateMediaStream: () => {\n            const ret: ResponseMediaStreamOptions = cloneDeep(ffmpegInput.mediaStreamOptions) || {\n                id: undefined,\n                name: undefined,\n            };\n\n            if (!ret.video)\n                ret.video = {};\n\n            ret.video.codec = inputVideoCodec;\n\n            // reported codecs may be wrong/cached/etc, so before blindly copying the audio codec info,\n            // verify what was found.\n            if (ret?.audio?.codec === inputAudioCodec) {\n                ret.audio = ffmpegInput?.mediaStreamOptions?.audio;\n            }\n            else {\n                ret.audio = {\n                    codec: inputAudioCodec,\n                }\n            }\n\n            return ret;\n        },\n        emit(container: T, chunk: StreamChunk) {\n            events.emit(container, chunk);\n            return this;\n        },\n        on(event: string, cb: any) {\n            events.on(event, cb);\n            return this;\n        },\n        once(event: any, cb: any) {\n            events.once(event, cb);\n            return this;\n        },\n        removeListener(event, cb) {\n            events.removeListener(event, cb);\n            return this;\n        }\n    };\n}\n\nexport interface Rebroadcaster {\n    server: Server;\n    port: number;\n    url: string;\n    clients: number;\n}\n\nexport interface RebroadcastSessionCleanup {\n    (): void;\n}\n\nexport interface RebroadcasterConnection {\n    writeData: (data: StreamChunk) => number;\n    destroy: () => void;\n}\n\nexport interface RebroadcasterOptions {\n    connect?: (connection: RebroadcasterConnection) => RebroadcastSessionCleanup | undefined;\n    console?: Console;\n    idle?: {\n        timeout: number,\n        callback: () => void,\n    },\n}\n\nexport function handleRebroadcasterClient(socket: Duplex, options?: RebroadcasterOptions) {\n    const firstWriteData = (data: StreamChunk) => {\n        if (data.startStream) {\n            socket.write(data.startStream)\n        }\n        connection.writeData = writeData;\n        return writeData(data);\n    }\n    const writeData = (data: StreamChunk) => {\n        for (const chunk of data.chunks) {\n            socket.write(chunk);\n        }\n\n        return socket.writableLength;\n    };\n\n    const destroy = () => {\n        const cb = cleanupCallback;\n        cleanupCallback = undefined;\n        socket.destroy();\n        cb?.();\n    }\n\n    const connection: RebroadcasterConnection = {\n        writeData: firstWriteData,\n        destroy,\n    };\n\n    let cleanupCallback = options?.connect(connection);\n\n    socket.once('close', () => {\n        destroy();\n    });\n    socket.on('error', e => options?.console?.log('client stream ended'));\n}\n","import net from 'net';\nimport { once } from 'events';\nimport dgram, { SocketType } from 'dgram';\n\nexport async function closeQuiet(socket: dgram.Socket | net.Server) {\n    if (!socket)\n        return;\n    try {\n        await new Promise((r, f) => {\n            try {\n                socket.close(r);\n            }\n            catch (e) {\n                f(e);\n            }\n        });\n    }\n    catch (e) {\n    }\n}\n\nexport async function bindUdp(server: dgram.Socket, usePort: number, address?: string) {\n    server.bind(usePort, address);\n    await once(server, 'listening');\n    const port = server.address().port;\n    return {\n        port,\n        url: `udp://127.0.0.1:${port}`,\n    }\n}\n\nexport async function bindZero(server: dgram.Socket) {\n    return bindUdp(server, 0);\n}\n\nexport async function createBindZero(socketType?: SocketType) {\n    return createBindUdp(0, socketType);\n}\n\nexport async function reserveUdpPort() {\n    const udp = await createBindZero();\n    await new Promise(resolve => udp.server.close(() => resolve(undefined)));\n    return udp.port;\n}\n\nexport async function createBindUdp(usePort: number, socketType?: SocketType) {\n    const server = dgram.createSocket(socketType || 'udp4');\n    const { port, url } = await bindUdp(server, usePort);\n    return {\n        server,\n        port,\n        url,\n    };\n}\n\nexport async function bind(server: dgram.Socket, port: number) {\n    server.bind(port);\n    await once(server, 'listening');\n    return {\n        port,\n        url: `udp://127.0.0.1:${port}`,\n    }\n}\n\nexport { listenZero, listenZeroSingleClient, ListenZeroSingleClientTimeoutError } from \"@scrypted/server/src/listen-zero\";\n","export * from '@scrypted/server/src/media-helpers';\n","export interface RefreshPromise<T> {\n    promise: Promise<T>;\n    cacheDuration: number;\n}\n\nexport function singletonPromise<T>(rp: undefined | RefreshPromise<T>, method: () => Promise<T>, cacheDuration = 0) {\n    if (rp?.promise)\n        return rp;\n\n    const promise = method();\n    if (!rp) {\n        rp = {\n            promise,\n            cacheDuration,\n        }\n    }\n    else {\n        rp.promise = promise;\n    }\n    promise.finally(() => setTimeout(() => rp.promise = undefined, rp.cacheDuration));\n    return rp;\n}\n\nexport class TimeoutError<T> extends Error {\n    constructor(public promise: Promise<T>) {\n        super('Operation Timed Out');\n    }\n}\n\nexport function timeoutPromise<T>(timeout: number, promise: Promise<T>): Promise<T> {\n    return new Promise<T>((resolve, reject) => {\n        const t = setTimeout(() => reject(new TimeoutError(promise)), timeout);\n\n        promise\n            .then(v => {\n                clearTimeout(t);\n                resolve(v);\n            })\n            .catch(e => {\n                clearTimeout(t);\n                reject(e);\n            });\n    })\n}\n\nexport function timeoutFunction<T>(timeout: number, f: (isTimedOut: () => boolean) => Promise<T>): Promise<T> {\n    return new Promise<T>((resolve, reject) => {\n        let isTimedOut = false;\n        const promise = f(() => isTimedOut);\n\n        const t = setTimeout(() => {\n            isTimedOut = true;\n            reject(new TimeoutError(promise));\n        }, timeout);\n\n        promise\n            .then(v => {\n                clearTimeout(t);\n                resolve(v);\n            })\n            .catch(e => {\n                clearTimeout(t);\n                reject(e);\n            });\n    })\n}\n\nexport function createPromiseDebouncer<T>() {\n    let current: Promise<T>;\n\n    return (func: () => Promise<T>): Promise<T> => {\n        if (!current)\n            current = func().finally(() => current = undefined);\n        return current;\n    }\n}\n\nexport function createMapPromiseDebouncer<T>() {\n    const map = new Map<string, Promise<T>>();\n\n    return (key: any, func: () => Promise<T>): Promise<T> => {\n        const keyStr = JSON.stringify(key);\n        let value = map.get(keyStr);\n        if (!value) {\n            value = func().finally(() => map.delete(keyStr));\n            map.set(keyStr, value);\n        }\n        return value;\n    }\n}\n","import { Readable } from 'stream';\nimport { once } from 'events';\n\nexport async function read16BELengthLoop(readable: Readable, options: {\n  headerLength: number;\n  offset?: number;\n  // optionally skip a header, and pause loop parsing until calee resumes.\n  skipHeader?: (header: Buffer, resumeRead: () => void) => boolean;\n  callback: (header: Buffer, data: Buffer) => void;\n}) {\n  let error: Error;\n  const { skipHeader, callback } = options;\n  const offset = options.offset || 0;\n  const headerLength = options.headerLength || 2;\n\n  readable.on('error', e => error = e);\n\n  let header: Buffer;\n  let length: number;\n  let skipCount = 0;\n  let readCount = 0;\n  \n  const resumeRead = () => {\n    readCount++;\n    read();\n  }\n\n  const read = () => {\n    while (true) {\n      if (skipCount !== readCount)\n        return;\n      if (!header) {\n        header = readable.read(headerLength);\n        if (!header)\n          return;\n        if (skipHeader?.(header, resumeRead)) {\n          skipCount++;\n          header = undefined;\n          continue;\n        }\n        length = header.readUInt16BE(offset);\n      }\n      else {\n        const data = readable.read(length);\n        if (!data)\n          return;\n        callback(header, data);\n        header = undefined;\n      }\n    }\n  };\n\n  read();\n  readable.on('readable', read);\n\n  await once(readable, 'end');\n  throw new Error('stream ended');\n}\n\nexport class StreamEndError extends Error {\n  constructor() {\n    super()\n  }\n}\n\nexport async function readLength(readable: Readable, length: number): Promise<Buffer> {\n  if (readable.readableEnded || readable.destroyed)\n    throw new Error(\"stream ended\");\n\n  if (!length) {\n    return Buffer.alloc(0);\n  }\n\n  {\n    const ret = readable.read(length);\n    if (ret) {\n      return ret;\n    }\n  }\n\n  return new Promise((resolve, reject) => {\n    const r = () => {\n      const ret = readable.read(length);\n      if (ret) {\n        cleanup();\n        resolve(ret);\n        return;\n      }\n\n      if (readable.readableEnded || readable.destroyed)\n        reject(new Error(\"stream ended during read\"));\n    };\n\n    const e = () => {\n      cleanup();\n      reject(new StreamEndError())\n    };\n\n    const cleanup = () => {\n      readable.removeListener('readable', r);\n      readable.removeListener('end', e);\n    }\n\n    readable.on('readable', r);\n    readable.on('end', e);\n  });\n}\n\nconst CHARCODE_NEWLINE = '\\n'.charCodeAt(0);\n\nexport async function readUntil(readable: Readable, charCode: number) {\n  const data = [];\n  let count = 0;\n  while (true) {\n    const buffer = await readLength(readable, 1);\n    if (!buffer)\n      throw new Error(\"end of stream\");\n    if (buffer[0] === charCode)\n      break;\n    data[count++] = buffer[0];\n  }\n  return Buffer.from(data).toString();\n}\n\nexport async function readLine(readable: Readable) {\n  return readUntil(readable, CHARCODE_NEWLINE);\n}\n\nexport async function readString(readable: Readable | Promise<Readable>) {\n  let data = '';\n  readable = await readable;\n  readable.on('data', buffer => {\n    data += buffer.toString();\n  });\n  readable.resume();\n  await once(readable, 'end')\n  return data;\n}\n","import crypto, { randomBytes } from 'crypto';\nimport dgram from 'dgram';\nimport { once } from 'events';\nimport { BASIC } from 'http-auth-utils/dist/index';\nimport { parseHTTPHeadersQuotedKeyValueSet } from 'http-auth-utils/dist/utils';\nimport net from 'net';\nimport { Duplex, Readable, Writable } from 'stream';\nimport tls from 'tls';\nimport { Deferred } from './deferred';\nimport { closeQuiet, createBindUdp, createBindZero, listenZeroSingleClient } from './listen-cluster';\nimport { timeoutPromise } from './promise-utils';\nimport { readLength, readLine } from './read-stream';\nimport { MSection, parseSdp } from './sdp-utils';\nimport { sleep } from './sleep';\nimport { StreamChunk, StreamParser, StreamParserOptions } from './stream-parser';\nimport { URL } from 'url';\n\nconst REQUIRED_WWW_AUTHENTICATE_KEYS = ['realm', 'nonce'];\n\ntype DigestWWWAuthenticateData = {\n    realm: string;\n    domain?: string;\n    nonce: string;\n    opaque?: string;\n    stale?: 'true' | 'false';\n    algorithm?: 'MD5' | 'MD5-sess' | 'token';\n    qop?: 'auth' | 'auth-int' | string;\n};\n\nexport const RTSP_FRAME_MAGIC = 36;\n\nexport interface Headers {\n    [header: string]: string\n}\n\nexport interface RtspStreamParser extends StreamParser {\n    sdp: Promise<string>;\n}\n\nexport async function readMessage(client: Readable): Promise<string[]> {\n    let currentHeaders: string[] = [];\n    while (true) {\n        let line = await readLine(client);\n        line = line.trim();\n        if (!line)\n            return currentHeaders;\n        currentHeaders.push(line);\n    }\n}\n\n\nexport async function readBody(client: Readable, response: Headers) {\n    const cl = parseInt(response['content-length']);\n    if (cl)\n        return readLength(client, cl)\n}\n\n\nexport function writeMessage(client: Writable, messageLine: string, body: Buffer, headers: Headers, console?: Console) {\n    let message = messageLine !== undefined ? `${messageLine}\\r\\n` : '';\n    if (body)\n        headers['Content-Length'] = body.length.toString();\n    for (const [key, value] of Object.entries(headers)) {\n        message += `${key}: ${value}\\r\\n`;\n    }\n    message += '\\r\\n';\n    client.write(message);\n    console?.log('rtsp outgoing message\\n', message);\n    console?.log();\n    if (body)\n        client.write(body);\n}\n\n// https://yumichan.net/video-processing/video-compression/introduction-to-h264-nal-unit/\n\nexport const H264_NAL_TYPE_RESERVED0 = 0;\nexport const H264_NAL_TYPE_RESERVED30 = 30;\nexport const H264_NAL_TYPE_RESERVED31 = 31;\n\nexport const H264_NAL_TYPE_IDR = 5;\nexport const H264_NAL_TYPE_SEI = 6;\nexport const H264_NAL_TYPE_SPS = 7;\nexport const H264_NAL_TYPE_PPS = 8;\n// aggregate NAL Unit\nexport const H264_NAL_TYPE_STAP_A = 24;\nexport const H264_NAL_TYPE_STAP_B = 25;\n// fragmented NAL Unit (need to match against first)\nexport const H264_NAL_TYPE_FU_A = 28;\nexport const H264_NAL_TYPE_FU_B = 29;\n\nexport const H264_NAL_TYPE_MTAP16 = 26;\nexport const H264_NAL_TYPE_MTAP32 = 27;\n\nexport function findH264NaluType(streamChunk: StreamChunk, naluType: number) {\n    if (streamChunk.type !== 'h264')\n        return;\n    return findH264NaluTypeInNalu(streamChunk.chunks[streamChunk.chunks.length - 1].subarray(12), naluType);\n}\n\nexport function findH264NaluTypeInNalu(nalu: Buffer, naluType: number) {\n    const checkNaluType = nalu[0] & 0x1f;\n    if (checkNaluType === H264_NAL_TYPE_STAP_A) {\n        let pos = 1;\n        while (pos < nalu.length) {\n            const naluLength = nalu.readUInt16BE(pos);\n            pos += 2;\n            const stapaType = nalu[pos] & 0x1f;\n            if (stapaType === naluType)\n                return nalu.subarray(pos, pos + naluLength);\n            pos += naluLength;\n        }\n    }\n    else if (checkNaluType === H264_NAL_TYPE_FU_A) {\n        const fuaType = nalu[1] & 0x1f;\n        const isFuStart = !!(nalu[1] & 0x80);\n\n        if (fuaType === naluType && isFuStart)\n            return nalu.subarray(1);\n    }\n    else if (checkNaluType === naluType) {\n        return nalu;\n    }\n    return;\n}\n\nexport function getNaluTypes(streamChunk: StreamChunk) {\n    if (streamChunk.type !== 'h264')\n        return new Set<number>();\n    return getNaluTypesInNalu(streamChunk.chunks[streamChunk.chunks.length - 1].subarray(12))\n}\n\nexport function getNaluFragmentInformation(nalu: Buffer) {\n    const naluType = nalu[0] & 0x1f;\n    const fua = naluType === H264_NAL_TYPE_FU_A;\n    return {\n        fua,\n        fuaStart: fua && !!(nalu[1] & 0x80),\n        fuaEnd: fua && !!(nalu[1] & 0x40),\n    }\n}\n\nexport function getNaluTypesInNalu(nalu: Buffer, fuaRequireStart = false, fuaRequireEnd = false) {\n    const ret = new Set<number>();\n    const naluType = nalu[0] & 0x1f;\n    if (naluType === H264_NAL_TYPE_STAP_A) {\n        ret.add(H264_NAL_TYPE_STAP_A);\n        let pos = 1;\n        while (pos < nalu.length) {\n            const naluLength = nalu.readUInt16BE(pos);\n            pos += 2;\n            const stapaType = nalu[pos] & 0x1f;\n            ret.add(stapaType);\n            pos += naluLength;\n        }\n    }\n    else if (naluType === H264_NAL_TYPE_FU_A) {\n        ret.add(H264_NAL_TYPE_FU_A);\n        const fuaType = nalu[1] & 0x1f;\n        if (fuaRequireStart) {\n            const isFuStart = !!(nalu[1] & 0x80);\n            if (isFuStart)\n                ret.add(fuaType);\n        }\n        else if (fuaRequireEnd) {\n            const isFuEnd = !!(nalu[1] & 0x40);\n            if (isFuEnd)\n                ret.add(fuaType);\n        }\n        else {\n            ret.add(fuaType);\n        }\n    }\n    else {\n        ret.add(naluType);\n    }\n\n    return ret;\n}\n\nexport function createRtspParser(options?: StreamParserOptions): RtspStreamParser {\n    let resolve: any;\n\n    return {\n        container: 'rtsp',\n        tcpProtocol: 'rtsp://127.0.0.1/' + randomBytes(8).toString('hex'),\n        inputArguments: [\n            '-rtsp_transport',\n            'tcp',\n        ],\n        outputArguments: [\n            '-rtsp_transport',\n            'tcp',\n            ...(options?.vcodec || []),\n            ...(options?.acodec || []),\n            '-f', 'rtsp',\n        ],\n        findSyncFrame(streamChunks: StreamChunk[]) {\n            let foundIndex: number;\n            let nonVideo: {\n                [codec: string]: StreamChunk,\n            } = {};\n\n            const createSyncFrame = () => {\n                const ret = streamChunks.slice(foundIndex);\n                // for (const nv of Object.values(nonVideo)) {\n                //     ret.unshift(nv);\n                // }\n                return ret;\n            }\n\n            for (let prebufferIndex = 0; prebufferIndex < streamChunks.length; prebufferIndex++) {\n                const streamChunk = streamChunks[prebufferIndex];\n                if (streamChunk.type !== 'h264') {\n                    nonVideo[streamChunk.type] = streamChunk;\n                    continue;\n                }\n\n                if (findH264NaluType(streamChunk, H264_NAL_TYPE_SPS))\n                    foundIndex = prebufferIndex;\n            }\n\n            if (foundIndex !== undefined)\n                return createSyncFrame();\n\n            nonVideo = {};\n            // some streams don't contain codec info, so find an idr frame instead.\n            for (let prebufferIndex = 0; prebufferIndex < streamChunks.length; prebufferIndex++) {\n                const streamChunk = streamChunks[prebufferIndex];\n                if (streamChunk.type !== 'h264') {\n                    nonVideo[streamChunk.type] = streamChunk;\n                    continue;\n                }\n                if (findH264NaluType(streamChunk, H264_NAL_TYPE_IDR))\n                    foundIndex = prebufferIndex;\n            }\n\n            if (foundIndex !== undefined)\n                return createSyncFrame();\n\n            // oh well!\n        },\n        sdp: new Promise<string>(r => resolve = r),\n        async *parse(duplex, width, height) {\n            const server = new RtspServer(duplex);\n            await server.handleSetup();\n            resolve(server.sdp);\n            for await (const { type, rtcp, header, packet } of server.handleRecord()) {\n                yield {\n                    chunks: [header, packet],\n                    type: `${rtcp ? 'rtcp-' : ''}${type}`,\n                    width,\n                    height,\n                }\n            }\n        }\n    }\n}\n\nexport function parseHeaders(headers: string[]): Headers {\n    const ret: any = {};\n    for (const header of headers.slice(1)) {\n        const index = header.indexOf(':');\n        let value = '';\n        if (index !== -1)\n            value = header.substring(index + 1).trim();\n        const key = header.substring(0, index).toLowerCase();\n        ret[key] = value;\n    }\n    return ret;\n}\n\nexport function getFirstAuthenticateHeader(headers: string[]): string {\n    for (const header of headers.slice(1)) {\n        const index = header.indexOf(':');\n        let value = '';\n        if (index !== -1)\n            value = header.substring(index + 1).trim();\n        const key = header.substring(0, index).toLowerCase();\n        if (key === 'www-authenticate')\n            return value;\n    }\n}\n\nexport function parseSemicolonDelimited(value: string) {\n    const dict: { [key: string]: string } = {};\n    for (const part of value.split(';')) {\n        const [key, value] = part.split('=', 2);\n        dict[key] = value;\n    }\n\n    return dict;\n}\n\nexport interface RtspStatus {\n    line: string,\n    code: number,\n    version: string,\n    reason: string,\n}\n\nexport interface RtspServerResponse {\n    headers: Headers;\n    body: Buffer;\n    status: RtspStatus;\n}\n\nexport class RtspStatusError extends Error {\n    constructor(public status: RtspStatus) {\n        super(`RTSP Error: ${status.line}`);\n    }\n}\n\nexport class RtspBase {\n    client: net.Socket;\n    console?: Console;\n\n    constructor() {\n    }\n\n    write(messageLine: string, headers: Headers, body?: Buffer) {\n        writeMessage(this.client, messageLine, body, headers, this.console);\n    }\n\n    async readMessage(): Promise<string[]> {\n        const message = await readMessage(this.client);\n        this.console?.log('rtsp incoming message\\n', message.join('\\n'));\n        this.console?.log();\n        return message;\n    }\n}\n\nconst quote = (str: string): string => `\"${str.replace(/\"/g, '\\\\\"')}\"`;\n\nexport interface RtspClientSetupOptions {\n    type: 'tcp' | 'udp';\n    path?: string;\n    onRtp: (rtspHeader: Buffer, rtp: Buffer) => void;\n}\n\nexport interface RtspClientTcpSetupOptions extends RtspClientSetupOptions {\n    type: 'tcp';\n    port: number;\n}\n\nexport interface RtspClientUdpSetupOptions extends RtspClientSetupOptions {\n    type: 'udp';\n    dgram?: dgram.Socket;\n}\n\n// probably only works with scrypted rtsp server.\nexport class RtspClient extends RtspBase {\n    cseq = 0;\n    session: string;\n    wwwAuthenticate: string;\n    requestTimeout: number;\n    needKeepAlive = false;\n    setupOptions = new Map<number, RtspClientTcpSetupOptions>();\n    issuedTeardown = false;\n    hasGetParameter = true;\n\n    constructor(public url: string) {\n        super();\n        const u = new URL(url);\n        const port = parseInt(u.port) || 554;\n        if (url.startsWith('rtsps')) {\n            this.client = tls.connect({\n                rejectUnauthorized: false,\n                port,\n                host: u.hostname,\n            })\n        }\n        else {\n            this.client = net.connect(port, u.hostname);\n        }\n        this.client.on('error', e => {\n            this.console?.log('client error', e);\n        });\n    }\n\n    async safeTeardown() {\n        // issue a teardown to upstream to close gracefully\n        if (this.issuedTeardown)\n            return;\n        this.issuedTeardown = true;\n        try {\n            this.writeTeardown();\n            await sleep(500);\n        }\n        catch (e) {\n        }\n        finally {\n            // will trigger after teardown returns\n            this.client.destroy();\n        }\n    }\n\n    writeRequest(method: string, headers?: Headers, path?: string, body?: Buffer) {\n        headers = headers || {};\n\n        let fullUrl = this.url;\n        if (path) {\n            // a=control may be a full or \"relative\" url.\n            if (path.includes('rtsp://') || path.includes('rtsps://')) {\n                fullUrl = path;\n            }\n            else {\n                // strangely, relative RTSP urls do not behave like expected from an HTTP-ish server.\n                // ffmpeg will happily suffix path segments after query strings:\n                // SETUP rtsp://localhost:5554/cam/realmonitor?channel=1&subtype=0/trackID=0 RTSP/1.0\n                fullUrl += (fullUrl.endsWith('/') ? '' : '/') + path;\n            }\n        }\n\n        const sanitized = new URL(fullUrl);\n        sanitized.username = '';\n        sanitized.password = '';\n\n        const line = `${method} ${sanitized} RTSP/1.0`;\n        const cseq = this.cseq++;\n        headers['CSeq'] = cseq.toString();\n        headers['User-Agent'] = 'Scrypted';\n\n        if (this.wwwAuthenticate)\n            headers['Authorization'] = this.createAuthorizationHeader(method, new URL(fullUrl));\n\n        if (this.session)\n            headers['Session'] = this.session;\n\n        this.write(line, headers, body);\n    }\n\n    async handleDataPayload(header: Buffer) {\n        // todo: fix this, because calling teardown outside of the read loop causes this.\n        if (header[0] !== RTSP_FRAME_MAGIC)\n            throw new Error('RTSP Client received invalid frame magic. This may be a bug in your camera firmware. If this error persists, switch your RTSP Parser to FFmpeg or Scrypted (UDP): ' + header.toString());\n\n        const channel = header.readUInt8(1);\n        const length = header.readUInt16BE(2);\n        const data = await readLength(this.client, length);\n\n        const options = this.setupOptions.get(channel);\n        options?.onRtp?.(header, data);\n    }\n\n    async readDataPayload() {\n        const header = await readLength(this.client, 4);\n        return this.handleDataPayload(header);\n    }\n\n    createBadHeader(header: Buffer) {\n        return new Error('RTSP Client received invalid frame magic. This may be a bug in your camera firmware. If this error persists, switch your RTSP Parser to FFmpeg or Scrypted (UDP): ' + header.toString());\n    }\n\n    async readLoopLegacy() {\n        try {\n            while (true) {\n                if (this.needKeepAlive) {\n                    this.needKeepAlive = false;\n                    if (this.hasGetParameter)\n                        await this.getParameter();\n                    else\n                        await this.options();\n                }\n                await this.readDataPayload();\n            }\n        }\n        catch (e) {\n            this.client.destroy(e);\n            throw e;\n        }\n    }\n\n    async readLoop() {\n        const deferred = new Deferred<void>();\n\n        let header: Buffer;\n        let channel: number;\n        let length: number;\n\n        const read = async () => {\n            if (this.needKeepAlive) {\n                this.needKeepAlive = false;\n                if (this.hasGetParameter)\n                    this.writeGetParameter();\n                else\n                    this.writeOptions();\n            }\n\n            try {\n                while (true) {\n                    // get header if needed\n                    if (!header) {\n                        header = this.client.read(4);\n\n                        if (!header)\n                            return;\n\n                        // validate header once.\n                        if (header[0] !== RTSP_FRAME_MAGIC) {\n                            if (header.toString() !== 'RTSP')\n                                throw this.createBadHeader(header);\n\n                            this.client.unshift(header);\n                            header = undefined;\n\n                            // remove the listener to operate in pull mode.\n                            this.client.removeListener('readable', read);\n\n                            // do what with this?\n                            const message = await super.readMessage();\n                            const body = await this.readBody(parseHeaders(message));\n\n                            // readd the listener to operate in streaming mode.\n                            this.client.on('readable', read);\n\n                            continue;\n                        }\n\n                        channel = header.readUInt8(1);\n                        length = header.readUInt16BE(2);\n                    }\n\n                    const data = this.client.read(length);\n                    if (!data)\n                        return;\n\n                    const h = header;\n                    header = undefined;\n                    const options = this.setupOptions.get(channel);\n                    options?.onRtp?.(h, data);\n                }\n            }\n            catch (e) {\n                deferred.reject(e);\n                this.client.destroy();\n            }\n        };\n\n        read();\n        this.client.on('readable', read);\n\n        await Promise.all([once(this.client, 'end')]);\n    }\n\n    // rtsp over tcp will actually interleave RTSP request/responses\n    // within the RTSP data stream. The only way to tell if it's a request/response\n    // is to see if the header + data starts with RTSP/1.0 message line.\n    // Or RTSP, if looking at only the header bytes. Then grab the response out.\n    async readMessage(): Promise<string[]> {\n        while (true) {\n            const header = await readLength(this.client, 4);\n            if (header[0] !== RTSP_FRAME_MAGIC) {\n                if (header.toString() === 'RTSP') {\n                    this.client.unshift(header);\n                    const message = await super.readMessage();\n                    return message;\n                }\n                throw this.createBadHeader(header);\n            }\n\n            await this.handleDataPayload(header);\n        }\n    }\n\n    createAuthorizationHeader(method: string, url: URL) {\n        if (!this.wwwAuthenticate)\n            throw new Error('no WWW-Authenticate found');\n\n        if (this.wwwAuthenticate.includes('Basic')) {\n            const hash = BASIC.computeHash(url);\n            return `Basic ${hash}`;\n        }\n\n        // hikvision sends out of spec 'random' name and value parameter,\n        // which causes the digest auth lib to fail. so, need to parse the header\n        // manually with a relax set of authorized parameters.\n        // https://github.com/koush/scrypted/issues/344#issuecomment-1223627956\n        // https://github.com/nfroidure/http-auth-utils/blob/7532d21a419ad098d1240c9e1b55855020df5d7f/src/mechanisms/digest.ts#L97\n        // const wwwAuth = DIGEST.parseWWWAuthenticateRest(this.wwwAuthenticate);\n        const wwwAuth = parseHTTPHeadersQuotedKeyValueSet(\n            this.wwwAuthenticate,\n            // the parser will call indexOf to see if the key is authorized. monkey patch this call.\n            // https://github.com/nfroidure/http-auth-utils/blob/17186d3eefb86535916d044c7f59a340bc765603/src/utils.ts#L43\n            {\n                indexOf: () => 0,\n            } as any,\n            REQUIRED_WWW_AUTHENTICATE_KEYS,\n        ) as DigestWWWAuthenticateData;\n\n        const authedUrl = new URL(this.url);\n        const username = decodeURIComponent(authedUrl.username);\n        const password = decodeURIComponent(authedUrl.password);\n\n        const strippedUrl = new URL(url.toString());\n        strippedUrl.username = '';\n        strippedUrl.password = '';\n\n        const ha1 = crypto.createHash('md5').update(`${username}:${wwwAuth.realm}:${password}`).digest('hex');\n        const ha2 = crypto.createHash('md5').update(`${method}:${strippedUrl}`).digest('hex');\n        const hash = crypto.createHash('md5').update(`${ha1}:${wwwAuth.nonce}:${ha2}`).digest('hex');\n\n        const params = {\n            username,\n            realm: wwwAuth.realm,\n            nonce: wwwAuth.nonce,\n            uri: strippedUrl.toString(),\n            algorithm: 'MD5',\n            response: hash,\n        };\n\n        const paramsString = Object.entries(params).map(([key, value]) => `${key}=${value && quote(value)}`).join(', ');\n        return `Digest ${paramsString}`;\n    }\n\n    async readBody(response: Headers) {\n        return readBody(this.client, response);\n    }\n\n    async request(method: string, headers?: Headers, path?: string, body?: Buffer, authenticating?: boolean): Promise<RtspServerResponse> {\n        this.writeRequest(method, headers, path, body);\n\n        const message = this.requestTimeout ? await timeoutPromise(this.requestTimeout, this.readMessage()) : await this.readMessage();\n        const statusLine = message[0];\n        const [version, codeString, reason] = statusLine.split(' ', 3);\n        const code = parseInt(codeString);\n        const response = parseHeaders(message);\n\n        const status = {\n            line: statusLine,\n            code,\n            version,\n            reason,\n        };\n\n        if (code !== 200 && !response['www-authenticate'])\n            throw new RtspStatusError(status);\n\n        // it seems that the first www-authenticate header should be used, as latter ones that are\n        // offered are not actually valid? weird issue seen on tp-link that offers both DIGEST and BASIC.\n        const wwwAuthenticate = getFirstAuthenticateHeader(message) || response['www-authenticate']\n        if (wwwAuthenticate) {\n            if (authenticating)\n                throw new Error('auth failed');\n\n            this.wwwAuthenticate = wwwAuthenticate;\n\n            return this.request(method, headers, path, body, true);\n        }\n        return {\n            headers: response,\n            body: await this.readBody(response),\n            status,\n        }\n    }\n\n    async options() {\n        const headers: Headers = {};\n        const ret = await this.request('OPTIONS', headers);\n        const publicHeader = ret.headers['public'];\n        if (publicHeader)\n            this.hasGetParameter = publicHeader.toLowerCase().includes('get_parameter');\n        return ret;\n    }\n\n    writeOptions() {\n        return this.writeRequest('OPTIONS');\n    }\n\n    async getParameter() {\n        return this.request('GET_PARAMETER');\n    }\n\n    writeGetParameter() {\n        return this.writeRequest('GET_PARAMETER');\n    }\n\n    async describe(headers?: Headers) {\n        return this.request('DESCRIBE', {\n            ...(headers || {}),\n            Accept: 'application/sdp',\n        });\n    }\n\n    async setup(options: RtspClientTcpSetupOptions | RtspClientUdpSetupOptions) {\n        const protocol = options.type === 'udp' ? '' : '/TCP';\n        const client = options.type === 'udp' ? 'client_port' : 'interleaved';\n        let port: number;\n        if (options.type === 'tcp') {\n            port = options.port;\n        }\n        else {\n            if (!options.dgram) {\n                const udp = await createBindZero();\n                options.dgram = udp.server;\n                this.client.on('close', () => closeQuiet(udp.server));\n            }\n            port = options.dgram.address().port;\n            options.dgram.on('message', data => options.onRtp(undefined, data));\n        }\n        const headers: any = {\n            Transport: `RTP/AVP${protocol};unicast;${client}=${port}-${port + 1}`,\n        };\n        const response = await this.request('SETUP', headers, options.path);\n        let interleaved: {\n            begin: number;\n            end: number;\n        };\n        if (response.headers.session) {\n            const sessionDict = parseSemicolonDelimited(response.headers.session);\n            let timeout = parseInt(sessionDict['timeout']);\n            if (timeout) {\n                // if a timeout is requested, need to keep the session alive with periodic refresh.\n                // one suggestion is calling OPTIONS, but apparently GET_PARAMETER is more reliable.\n                // https://stackoverflow.com/a/39818378\n                let interval = (timeout - 5) * 1000;\n                let timer = setInterval(() => this.needKeepAlive = true, interval);\n                this.client.once('close', () => clearInterval(timer));\n            }\n\n            this.session = response.headers.session.split(';')[0];\n        }\n        if (response.headers.transport) {\n            const match = response.headers.transport.match(/.*?interleaved=([0-9]+)-([0-9]+)/);\n            if (match) {\n                const [_, begin, end] = match;\n                if (begin && end) {\n                    interleaved = {\n                        begin: parseInt(begin),\n                        end: parseInt(end),\n                    };\n                }\n            }\n        }\n        if (options.type === 'tcp')\n            this.setupOptions.set(interleaved ? interleaved.begin : port, options);\n        return Object.assign({ interleaved, options }, response);\n    }\n\n    async play(headers: Headers = {}, start = '0.000') {\n        headers['Range'] = `npt=${start}-`;\n        return this.request('PLAY', headers);\n    }\n\n    writePlay(start: string = '0.000') {\n        const headers: any = {\n            Range: `npt=${start}-`,\n        };\n        return this.writeRequest('PLAY', headers);\n    }\n\n    writeRtpPayload(header: Buffer, rtp: Buffer) {\n        this.client.write(header);\n        return this.client.write(Buffer.from(rtp));\n    }\n\n    send(rtp: Buffer, channel: number) {\n        const header = Buffer.alloc(4);\n        header.writeUInt8(RTSP_FRAME_MAGIC, 0);\n        header.writeUInt8(channel, 1);\n        header.writeUInt16BE(rtp.length, 2);\n\n        return this.writeRtpPayload(header, rtp);\n    }\n\n    async pause() {\n        return this.request('PAUSE');\n    }\n\n    async teardown() {\n        try {\n            // todo: fix this, because calling teardown outside of the read loop causes this.\n            return await this.request('TEARDOWN');\n        }\n        finally {\n            this.client.destroy();\n        }\n    }\n\n    writeTeardown() {\n        this.writeRequest('TEARDOWN');\n    }\n}\n\nexport interface RtspTrack {\n    protocol: 'tcp' | 'udp';\n    destination: number;\n    codec: string;\n    control: string;\n    rtp?: dgram.Socket;\n    rtcp?: dgram.Socket;\n}\n\nexport class RtspServer {\n    session: string;\n    console: Console;\n    setupTracks: {\n        [trackId: string]: RtspTrack;\n    } = {};\n\n    constructor(public client: Duplex, public sdp?: string, public udp?: boolean, public checkRequest?: (method: string, url: string, headers: Headers, rawMessage: string[]) => Promise<boolean>) {\n        this.session = randomBytes(4).toString('hex');\n        if (sdp)\n            sdp = sdp.trim();\n\n        if (client instanceof net.Socket)\n            client.setNoDelay(true);\n    }\n\n    async handleSetup(methods = ['play', 'record', 'teardown']) {\n        let currentHeaders: string[] = [];\n        while (true) {\n            let line = await readLine(this.client);\n            line = line.trim();\n            if (!line) {\n                const method = await this.headers(currentHeaders);\n                if (methods.includes(method))\n                    return method;\n                currentHeaders = [];\n                continue;\n            }\n            currentHeaders.push(line);\n        }\n    }\n\n    async handlePlayback() {\n        return this.handleSetup();\n    }\n\n    async handleTeardown() {\n        return this.handleSetup();\n    }\n\n    async *handleRecord(): AsyncGenerator<{\n        type: string,\n        rtcp: boolean,\n        header: Buffer,\n        packet: Buffer,\n    }> {\n        while (true) {\n            const header = await readLength(this.client, 4);\n            // can this even happen? since the RTSP request method isn't a fixed\n            // value like the \"RTSP\" in the RTSP response, I don't think so?\n            if (header[0] !== RTSP_FRAME_MAGIC)\n                throw new Error('RTSP Server expected frame magic but received: ' + header.toString());\n            const length = header.readUInt16BE(2);\n            const packet = await readLength(this.client, length);\n            const id = header.readUInt8(1);\n            const destination = id - (id % 2);\n            const track = Object.values(this.setupTracks).find(track => track.destination === destination);\n            if (!track)\n                throw new Error('RSTP Server received unknown channel: ' + id);\n\n            yield {\n                type: track.codec,\n                rtcp: id % 2 === 1,\n                header,\n                packet,\n            }\n        }\n    }\n\n    writeRtpPayload(header: Buffer, rtp: Buffer) {\n        this.client.write(header);\n        return this.client.write(Buffer.from(rtp));\n    }\n\n    send(rtp: Buffer, channel: number) {\n        const header = Buffer.alloc(4);\n        header.writeUInt8(36, 0);\n        header.writeUInt8(channel, 1);\n        header.writeUInt16BE(rtp.length, 2);\n\n        return this.writeRtpPayload(header, rtp);\n    }\n\n    sendUdp(udp: dgram.Socket, port: number, packet: Buffer) {\n        // todo: support non local host?\n        udp.send(packet, port, '127.0.0.1');\n    }\n\n    sendTrack(trackId: string, packet: Buffer, rtcp: boolean) {\n        const track = this.setupTracks[trackId];\n        if (!track) {\n            this.console?.warn('RTSP Server track not found:', trackId);\n            return true;\n        }\n\n        if (track.protocol === 'udp') {\n            if (!this.udp)\n                this.console?.warn('RTSP Server UDP socket not available.');\n            else\n                this.sendUdp(rtcp ? track.rtcp : track.rtp, track.destination, packet);\n            return true;\n        }\n\n        return this.send(packet, rtcp ? track.destination + 1 : track.destination);\n    }\n\n    availableOptions = ['DESCRIBE', 'OPTIONS', 'PAUSE', 'PLAY', 'SETUP', 'TEARDOWN', 'ANNOUNCE', 'RECORD', 'GET_PARAMETER'];\n    options(url: string, requestHeaders: Headers) {\n        const headers: Headers = {};\n        headers['Public'] = this.availableOptions.join(', ');\n\n        this.respond(200, 'OK', requestHeaders, headers);\n    }\n\n    async get_parameter(url: string, requestHeaders: Headers) {\n        const headers: Headers = {};\n        this.respond(200, 'OK', requestHeaders, headers);\n    }\n\n    describe(url: string, requestHeaders: Headers) {\n        const headers: Headers = {};\n        headers['Content-Base'] = url;\n        headers['Content-Type'] = 'application/sdp';\n        this.respond(200, 'OK', requestHeaders, headers, Buffer.from(this.sdp))\n    }\n\n    setupInterleaved(msection: MSection, low: number, high: number) {\n        this.setupTracks[msection.control] = {\n            control: msection.control,\n            protocol: 'tcp',\n            destination: low,\n            codec: msection.codec,\n        }\n    }\n\n\n    resolveInterleaved?: (msection: MSection) => [number, number];\n\n    // todo: use the sdp itself to determine the audio/video track ids so\n    // rewriting is not necessary.\n    async setup(url: string, requestHeaders: Headers) {\n        const headers: Headers = {};\n        let transport = requestHeaders['transport'];\n        headers['Session'] = this.session;\n        const parsedSdp = parseSdp(this.sdp);\n        const msection = parsedSdp.msections.find(msection => url.endsWith(msection.control));\n        if (!msection) {\n            this.respond(404, 'Not Found', requestHeaders, headers);\n            return;\n        }\n\n        if (transport.includes('TCP')) {\n            if (this.resolveInterleaved) {\n                const [low, high] = this.resolveInterleaved(msection);\n                this.setupInterleaved(msection, low, high);\n                transport = `RTP/AVP/TCP;unicast;interleaved=${low}-${high}`;\n            }\n            else {\n                const match = transport.match(/.*?interleaved=([0-9]+)-([0-9]+)/);\n                if (match) {\n                    const low = parseInt(match[1]);\n                    const high = parseInt(match[2]);\n                    this.setupInterleaved(msection, low, high);\n                }\n            }\n        }\n        else {\n            if (!this.udp) {\n                this.respond(461, 'Unsupported Transport', requestHeaders, {});\n                return;\n            }\n            const match = transport.match(/.*?client_port=([0-9]+)-([0-9]+)/);\n            const [_, rtp, rtcp] = match;\n\n            const rtpServer = await createBindZero();\n            const rtcpServer = await createBindUdp(rtpServer.port + 1);\n            this.client.on('close', () => closeQuiet(rtpServer.server));\n            this.client.on('close', () => closeQuiet(rtcpServer.server));\n            this.setupTracks[msection.control] = {\n                control: msection.control,\n                protocol: 'udp',\n                destination: parseInt(rtp),\n                codec: msection.codec,\n                rtp: rtpServer.server,\n                rtcp: rtcpServer.server,\n            }\n            transport = transport.replace('RTP/AVP/UDP', 'RTP/AVP').replace('RTP/AVP', 'RTP/AVP/UDP');\n            transport += `;server_port=${rtpServer.port}-${rtcpServer.port}`;\n        }\n        headers['Transport'] = transport;\n        this.respond(200, 'OK', requestHeaders, headers)\n    }\n\n    play(url: string, requestHeaders: Headers) {\n        const headers: Headers = {};\n        const rtpInfos = Object.values(this.setupTracks).map(track => `url=${url}/${track.control}`);\n        // seq/rtptime was causing issues with gstreamer. commented out.\n        const rtpInfo = rtpInfos.join(','); // + ';seq=0;rtptime=0';\n        headers['RTP-Info'] = rtpInfo;\n        headers['Range'] = 'npt=now-';\n        headers['Session'] = this.session;\n        this.respond(200, 'OK', requestHeaders, headers);\n    }\n\n    async announce(url: string, requestHeaders: Headers) {\n        const contentLength = parseInt(requestHeaders['content-length']);\n        const sdpBuffer = await readLength(this.client, contentLength);\n        this.sdp = sdpBuffer.toString();\n        const headers: Headers = {};\n        headers['Session'] = this.session;\n\n        this.respond(200, 'OK', requestHeaders, headers);\n    }\n\n    async record(url: string, requestHeaders: Headers) {\n        const headers: Headers = {};\n        headers['Session'] = this.session;\n        this.respond(200, 'OK', requestHeaders, headers);\n    }\n\n    async teardown(url: string, requestHeaders: Headers) {\n        const headers: Headers = {};\n        headers['Session'] = this.session;\n        this.respond(200, 'OK', requestHeaders, headers);\n        this.client.destroy();\n    }\n\n    async headers(headers: string[]) {\n        this.console?.log('request headers', headers.join('\\n'));\n\n        let [method, url] = headers[0].split(' ', 2);\n        method = method.toLowerCase();\n        const requestHeaders = parseHeaders(headers);\n        if (this.checkRequest) {\n            let allow: boolean;\n            try {\n                allow = await this.checkRequest(method, url, requestHeaders, headers)\n            }\n            catch (e) {\n                this.console?.error('error checking request', e);\n            }\n            if (!allow) {\n                this.respond(400, 'Bad Request', requestHeaders, {});\n                this.client.destroy();\n                throw new Error('check request failed');\n            }\n        }\n\n        const thisAny = this as any;\n        if (!thisAny[method] || !this.availableOptions.includes(method.toUpperCase())) {\n            this.respond(400, 'Bad Request', requestHeaders, {});\n            return;\n        }\n\n        await thisAny[method](url, requestHeaders);\n        return method;\n    }\n\n    respond(code: number, message: string, requestHeaders: Headers, headers: Headers, buffer?: Buffer) {\n        let response = `RTSP/1.0 ${code} ${message}\\r\\n`;\n        if (requestHeaders['cseq'])\n            headers['CSeq'] = requestHeaders['cseq'];\n        if (buffer)\n            headers['Content-Length'] = buffer.length.toString();\n        for (const [key, value] of Object.entries(headers)) {\n            response += `${key}: ${value}\\r\\n`;\n        }\n        this.console?.log('response headers', response);\n        response += '\\r\\n';\n        this.client.write(response);\n        if (buffer) {\n            this.client.write(buffer);\n            this.console?.log('response body', buffer.toString());\n        }\n    }\n\n    destroy() {\n        this.client.destroy();\n        for (const track of Object.values(this.setupTracks)) {\n            closeQuiet(track.rtp);\n            closeQuiet(track.rtcp);\n        }\n    }\n}\n\nexport async function listenSingleRtspClient<T extends RtspServer>(options?: {\n    hostname?: string,\n    pathToken?: string,\n    createServer?(duplex: Duplex): T,\n}) {\n    const pathToken = options?.pathToken || crypto.randomBytes(8).toString('hex');\n    let { url, clientPromise, server } = await listenZeroSingleClient(options?.hostname);\n\n    const rtspServerPath = '/' + pathToken;\n    url = url.replace('tcp:', 'rtsp:') + rtspServerPath;\n\n    const rtspServerPromise = clientPromise.then(client => {\n        const createServer = options?.createServer || (duplex => new RtspServer(duplex));\n\n        const rtspServer = createServer(client);\n        rtspServer.checkRequest = async (method, url, headers, message) => {\n            rtspServer.checkRequest = undefined;\n            const u = new URL(url);\n            return u.pathname === rtspServerPath;\n        };\n        return rtspServer as T;\n    });\n\n    return {\n        url,\n        rtspServerPromise,\n        server,\n    }\n}\n","// todo: move this to ring.\nexport function replacePorts(sdp: string, audioPort: number, videoPort: number) {\n    let outputSdp = sdp\n        .replace(/c=IN .*/, `c=IN IP4 127.0.0.1`)\n        .replace(/m=audio \\d+/, `m=audio ${audioPort}`)\n        .replace(/m=video \\d+/, `m=video ${videoPort}`);\n    return outputSdp;\n}\n\nexport function replaceSectionPort(sdp: string, section: string, port: number) {\n    const regex = new RegExp(`m=${section} \\\\d+`)\n    let outputSdp = sdp\n        .replace(/c=IN .*/, `c=IN IP4 127.0.0.1`)\n        .replace(regex, `m=${section} ${port}`);\n    return outputSdp;\n}\n\nexport function addTrackControls(sdp: string) {\n    let lines = sdp.split('\\n').map(line => line.trim());\n    lines = lines.filter(line => !line.includes('a=control:'));\n    let trackCount = 0;\n    for (let i = 0; i < lines.length; i++) {\n        const line = lines[i];\n        if (!line.startsWith('m='))\n            continue;\n        lines.splice(i + 1, 0, 'a=control:trackID=' + trackCount);\n        trackCount++;\n    }\n    return lines.join('\\r\\n')\n}\n\n// todo: move this to webrtc\n// this is an sdp corresponding to what is requested from webrtc.\n// h264 baseline and opus are required codecs that all webrtc implementations must provide.\nexport function createSdpInput(audioPort: number, videoPort: number, sdp: string) {\n    // replace all IPs\n    let outputSdp = sdp\n        .replace(/c=IN .*/, `c=IN IP4 127.0.0.1`)\n        .replace(/m=audio \\d+/, `m=audio ${audioPort}`)\n        .replace(/m=video \\d+/, `m=video ${videoPort}`);\n\n    // filter all ice and rtcp mux info\n    let lines = outputSdp.split('\\n').map(line => line.trim());\n    lines = lines\n        .filter(line => !line.includes('a=rtcp-mux'))\n        .filter(line => !line.includes('a=candidate'))\n        .filter(line => !line.includes('a=ice'));\n\n    outputSdp = lines.join('\\r\\n');\n\n    outputSdp = addTrackControls(outputSdp);\n\n    // only include the m sections.\n    outputSdp = outputSdp.split('m=')\n        .slice(1)\n        .map(line => 'm=' + line)\n        .join('');\n    return outputSdp;\n}\n\n// todo: move this to webrtc\nexport function findFmtp(sdp: string, codec: string) {\n    let lines = sdp.split('\\n').map(line => line.trim());\n\n    const re = new RegExp(`a=rtpmap:(\\\\d+) ${codec}`);\n    const rtpmaps = lines.map(line => line.match(re)).filter(match => !!match);\n    return rtpmaps.map(match => {\n        const payloadType = parseInt(match[1]);\n        const fmtpPrefix = `a=fmtp:${payloadType} `;\n        const fmtp = lines.find(line => line.startsWith(fmtpPrefix))?.substring(fmtpPrefix.length);\n        return {\n            payloadType,\n            fmtp,\n        }\n    })\n}\n\nfunction getSections(sdp: string) {\n    const sections = ('\\n' + sdp).split('\\nm=');\n    return sections;\n}\n\nexport function findTrackByType(sdp: string, type: string, directions: TrackDirection[] = ['recvonly', 'sendrecv']) {\n    const sections = getSections(sdp).filter(track => track.startsWith(type));\n\n    for (const section of sections) {\n        const returnTrack = () => {\n            const lines = section.split('\\n').map(line => line.trim());\n            const controlString = 'a=control:';\n            const control = lines.find(line => line.startsWith(controlString));\n            return {\n                section: 'm=' + section,\n                trackId: control.substring(controlString.length),\n            };\n        }\n\n        for (const dir of directions) {\n            if (section.includes(`a=${dir}`)) {\n                return returnTrack();\n            }\n        }\n\n        // some sdp do not advertise a media flow direction. i think recvonly is the default?\n        if ((directions.includes('recvonly'))\n            && !section.includes('sendonly')\n            && !section.includes('inactive')) {\n            return returnTrack();\n        }\n    }\n}\n\ntype TrackDirection = 'sendonly' | 'sendrecv' | 'recvonly' | 'inactive';\n\nexport function findTracksByType(sdp: string, directions: TrackDirection[] = ['recvonly', 'sendrecv']) {\n    return {\n        audio: findTrackByType(sdp, 'audio', directions)?.trackId,\n        video: findTrackByType(sdp, 'video', directions)?.trackId,\n    };\n}\n\nexport function parseMLinePayloadTypes(mline: string) {\n    const payloadTypes: number[] = [];\n    for (const pt of mline.split(' ').slice(3) || []) {\n        payloadTypes.push(parseInt(pt));\n    }\n    return payloadTypes;\n}\n\nexport function parseMLine(mline: string) {\n    // 'm=audio 0 RTP/AVP 96'\n    const split = mline.split(' ');\n    const type = split[0].substring(2);\n    return {\n        type,\n        port: parseInt(split[1]),\n        protocol: split[2],\n        payloadTypes: parseMLinePayloadTypes(mline),\n    }\n}\n\nconst afmtp = 'a=fmtp';\nexport function parseFmtp(msection: string[]) {\n    return msection.filter(line => line.startsWith(afmtp))\n        .map(fmtpLine => {\n            const firstSpace = fmtpLine.indexOf(' ');\n            if (firstSpace === -1)\n                return;\n            const fmtp = fmtpLine.substring(0, firstSpace);\n            const paramLine = fmtpLine.substring(firstSpace + 1);\n            const payloadType = parseInt(fmtp.split(':')[1]);\n\n            if (!fmtp || !paramLine || Number.isNaN( payloadType )) {\n                return;\n            }\n\n            const parameters: {\n                [key: string]: string;\n            } = {};\n\n            paramLine.split(';').map(param => param.trim()).forEach(param => {\n                const [key, ...value] = param.split('=');\n                parameters[key] = value.join('=');\n            });\n            return {\n                payloadType,\n                parameters,\n            }\n        })\n        .filter(fmtp => !!fmtp);\n}\n\nexport type MSection = ReturnType<typeof parseMSection>;\n\nexport function parseRtpMap(mlineType: string, rtpmap: string) {\n    const match = rtpmap?.match(/a=rtpmap:([\\d]+) (.*?)\\/([\\d]+)/);\n\n    rtpmap = rtpmap?.toLowerCase();\n\n    let codec: string;\n    if (rtpmap?.includes('mpeg4')) {\n        codec = 'aac';\n    }\n    else if (rtpmap?.includes('opus')) {\n        codec = 'opus';\n    }\n    else if (rtpmap?.includes('pcma')) {\n        codec = 'pcm_alaw';\n    }\n    else if (rtpmap?.includes('pcmu')) {\n        codec = 'pcm_ulaw';\n    }\n    else if (rtpmap?.includes('pcm')) {\n        codec = 'pcm';\n    }\n    else if (rtpmap?.includes('h264')) {\n        codec = 'h264';\n    }\n    else if (rtpmap?.includes('h265')) {\n        codec = 'h265';\n    }\n    else if (!rtpmap && mlineType === 'audio') {\n        // ffmpeg seems to omit the rtpmap type for pcm alaw when creating sdp?\n        // is this the default?\n        codec = 'pcm_alaw';\n    }\n\n    return {\n        line: rtpmap,\n        codec,\n        rawCodec: match?.[2],\n        clock: parseInt(match?.[3]),\n        payloadType: parseInt(match?.[1]),\n    }\n}\n\nconst acontrol = 'a=control:';\nconst artpmap = 'a=rtpmap:';\nexport function parseMSection(msection: string[]) {\n    const control = msection.find(line => line.startsWith(acontrol))?.substring(acontrol.length);\n    const rtpmapFirst = msection.find(line => line.startsWith(artpmap));\n    const mline = parseMLine(msection[0]);\n\n    let codec = parseRtpMap(mline.type, rtpmapFirst).codec;\n\n    const rtpmaps = msection.filter(line => line.startsWith(artpmap)).map(line => parseRtpMap(mline.type, line));\n\n    let direction: string;\n    for (const checkDirection of ['sendonly', 'sendrecv', 'recvonly', 'inactive']) {\n        const found = msection.find(line => line === 'a=' + checkDirection);\n        if (found) {\n            direction = checkDirection;\n            break;\n        }\n    }\n\n    const ret = {\n        ...mline,\n        fmtp: parseFmtp(msection),\n        lines: msection,\n        rtpmaps,\n        contents: msection.join('\\r\\n'),\n        control,\n        codec,\n        direction,\n        toSdp: () => {\n            return ret.lines.join('\\r\\n');\n        }\n    }\n\n    return ret;\n}\n\nexport type ParsedSdp = ReturnType<typeof parseSdp>;\n\nexport function parseSdp(sdp: string) {\n    const lines = sdp.split('\\n').map(line => line.trim());\n    const header: string[] = [];\n    const msections: string[][] = [];\n    let msection: string[];\n\n    for (const line of lines) {\n        if (line.startsWith('m=')) {\n            if (msection) {\n                msections.push(msection);\n            }\n            msection = [];\n        }\n\n        if (msection) {\n            msection.push(line);\n        }\n        else {\n            header.push(line);\n        }\n    }\n\n    if (msection)\n        msections.push(msection);\n\n    const ret = {\n        header: {\n            lines: header,\n            contents: header.join('\\r\\n'),\n        },\n        msections: msections.map(parseMSection),\n        toSdp: () => {\n            return [...ret.header.lines, ...ret.msections.map(msection => msection.lines).flat()].join('\\r\\n');\n        }\n    }\n\n    return ret;\n}\n\nexport function getSpsPps(\n    section: {\n        fmtp: {\n            payloadType: number;\n            parameters: {\n                [key: string]: string;\n            };\n        }[]\n    }\n) {\n    const spspps = section?.fmtp?.[0]?.parameters?.['sprop-parameter-sets']?.split(',');\n    // empty sprop-parameter-sets is apparently a thing:\n    //     a=fmtp:96 profile-level-id=420029; packetization-mode=1; sprop-parameter-sets=\n    if (spspps?.length !== 2) {\n        return {\n            sps: undefined,\n            pps: undefined,\n        };\n    }\n\n    const [sps, pps] = spspps;\n\n    return {\n        sps: Buffer.from(sps, 'base64'),\n        pps: Buffer.from(pps, 'base64'),\n    }\n}\n","import { Settings, Setting, MixinDeviceBase, ScryptedInterface, SettingValue, MixinDeviceOptions } from \"@scrypted/sdk\";\nimport sdk from \"@scrypted/sdk\";\n\nconst { deviceManager } = sdk;\n\nexport interface SettingsMixinDeviceOptions<T> extends MixinDeviceOptions<T & Settings> {\n    group: string;\n    groupKey: string;\n}\n\nexport abstract class SettingsMixinDeviceBase<T> extends MixinDeviceBase<T & Settings> implements Settings {\n    settingsGroup: string;\n    settingsGroupKey: string;\n\n    constructor(options: SettingsMixinDeviceOptions<T>) {\n        super(options);\n\n        this.settingsGroup = options.group;\n        this.settingsGroupKey = options.groupKey;\n        process.nextTick(() => deviceManager.onMixinEvent(this.id, this, ScryptedInterface.Settings, null));\n    }\n\n    abstract getMixinSettings(): Promise<Setting[]>;\n    abstract putMixinSetting(key: string, value: SettingValue): Promise<boolean|void>;\n\n    async getSettings(): Promise<Setting[]> {\n        const settingsPromise = this.mixinDeviceInterfaces.includes(ScryptedInterface.Settings) ? this.mixinDevice.getSettings() : undefined;\n        const mixinSettingsPromise = this.getMixinSettings();\n        const allSettings: Setting[] = [];\n\n        try {\n            const settings = (await settingsPromise) || [];\n            allSettings.push(...settings);\n        }\n        catch (e) {\n            const name = this.name;\n            const description = `${name} Extension settings failed to load.`;\n            this.console.error(description, e)\n            allSettings.push({\n                key: Math.random().toString(),\n                title: name,\n                value: 'Settings Error',\n                group: 'Errors',\n                description,\n                readonly: true,\n            });\n        }\n\n        try {\n            const mixinSettings = (await mixinSettingsPromise) || [];\n            for (const setting of mixinSettings) {\n                setting.group = setting.group || this.settingsGroup;\n                setting.key = this.settingsGroupKey + ':' + setting.key;\n            }\n            allSettings.push(...mixinSettings);\n        }\n        catch (e) {\n            const name = deviceManager.getDeviceState(this.mixinProviderNativeId).name;\n            const description = `${name} Extension settings failed to load.`;\n            this.console.error(description, e)\n            allSettings.push({\n                key: Math.random().toString(),\n                title: name,\n                value: 'Settings Error',\n                group: 'Errors',\n                description,\n                readonly: true,\n            });\n        }\n\n        return allSettings;\n    }\n\n    async putSetting(key: string, value: SettingValue) {\n        const prefix = this.settingsGroupKey + ':';\n        if (!key?.startsWith(prefix)) {\n            return this.mixinDevice.putSetting(key, value);\n        }\n\n        if (!await this.putMixinSetting(key.substring(prefix.length), value))\n            deviceManager.onMixinEvent(this.id, this, ScryptedInterface.Settings, null);\n    }\n\n    async release() {\n        await deviceManager.onMixinEvent(this.id, this, ScryptedInterface.Settings, null);\n    }\n}\n","export * from \"@scrypted/server/src/sleep\"","import { Socket as DatagramSocket } from \"dgram\";\nimport { once } from \"events\";\nimport { Duplex } from \"stream\";\nimport { FFMPEG_FRAGMENTED_MP4_OUTPUT_ARGS, MP4Atom, parseFragmentedMP4 } from \"./ffmpeg-mp4-parser-session\";\nimport { readLength } from \"./read-stream\";\n\nexport interface StreamParser {\n    container: string;\n    inputArguments?: string[];\n    outputArguments: string[];\n    tcpProtocol?: string;\n    parse?: (duplex: Duplex, width: number, height: number) => AsyncGenerator<StreamChunk>;\n    findSyncFrame(streamChunks: StreamChunk[]): StreamChunk[];\n}\n\nfunction findSyncFrame(streamChunks: StreamChunk[]): StreamChunk[] {\n    return streamChunks;\n}\n\nexport interface StreamParserOptions {\n    acodec?: string[];\n    vcodec?: string[];\n}\n\nexport interface StreamChunk {\n    startStream?: Buffer;\n    chunks: Buffer[];\n    type?: string;\n    width?: number;\n    height?: number;\n}\n\n// function checkTsPacket(pkt: Buffer) {\n//     const pid = ((pkt[1] & 0x1F) << 8) | pkt[2];\n//     if (pid == 256) {\n//         // found video stream\n//         if ((pkt[3] & 0x20) && (pkt[4] > 0)) {\n//             // have AF\n//             if (pkt[5] & 0x40) {\n//                 // found keyframe\n//                 console.log('keyframe');\n//             }\n//         }\n//     }\n// }\n\nfunction createLengthParser(length: number, verify?: (concat: Buffer) => void) {\n    async function* parse(socket: Duplex): AsyncGenerator<StreamChunk> {\n        let pending: Buffer[] = [];\n        let pendingSize = 0;\n        while (true) {\n            const data: Buffer = socket.read();\n            if (!data) {\n                await once(socket, 'readable');\n                continue;\n            }\n            pending.push(data);\n            pendingSize += data.length;\n            if (pendingSize < length)\n                continue;\n\n            const concat = Buffer.concat(pending);\n\n            verify?.(concat);\n\n            const remaining = concat.length % length;\n            const left = concat.slice(0, concat.length - remaining);\n            const right = concat.slice(concat.length - remaining);\n            pending = [right];\n            pendingSize = right.length;\n\n            yield {\n                chunks: [left],\n            };\n        }\n    }\n\n    return parse;\n}\n\nexport function createDgramParser() {\n    async function* parse(socket: DatagramSocket, width: number, height: number, type: string) {\n        while (true) {\n            const [buffer] = await once(socket, 'message');\n            yield {\n                chunks: [buffer],\n                type,\n            }\n        }\n    };\n    return parse;\n}\n\nexport function createMpegTsParser(options?: StreamParserOptions): StreamParser {\n    return {\n        container: 'mpegts',\n        outputArguments: [\n            ...(options?.vcodec || []),\n            ...(options?.acodec || []),\n            '-f', 'mpegts',\n        ],\n        parse: createLengthParser(188, concat => {\n            if (concat[0] != 0x47) {\n                throw new Error('Invalid sync byte in mpeg-ts packet. Terminating stream.')\n            }\n        }),\n        findSyncFrame(streamChunks): StreamChunk[] {\n            for (let prebufferIndex = 0; prebufferIndex < streamChunks.length; prebufferIndex++) {\n                const streamChunk = streamChunks[prebufferIndex];\n\n                for (let chunkIndex = 0; chunkIndex < streamChunk.chunks.length; chunkIndex++) {\n                    const chunk = streamChunk.chunks[chunkIndex];\n\n                    let offset = 0;\n                    while (offset + 188 < chunk.length) {\n                        const pkt = chunk.subarray(offset, offset + 188);\n                        const pid = ((pkt[1] & 0x1F) << 8) | pkt[2];\n                        if (pid == 256) {\n                            // found video stream\n                            if ((pkt[3] & 0x20) && (pkt[4] > 0)) {\n                                // have AF\n                                if (pkt[5] & 0x40) {\n                                    // we found the sync frame, but also need to send the pat and pmt\n                                    // which might be at the start of this chunk before the keyframe.\n                                    // yolo!\n                                    return streamChunks.slice(prebufferIndex);\n                                    // const chunks = streamChunk.chunks.slice(chunkIndex + 1);\n                                    // const take = chunk.subarray(offset);\n                                    // chunks.unshift(take);\n\n                                    // const remainingChunks = streamChunks.slice(prebufferIndex + 1);\n                                    // const ret = Object.assign({}, streamChunk);\n                                    // ret.chunks = chunks;\n                                    // return [\n                                    //     ret,\n                                    //     ...remainingChunks\n                                    // ];\n                                }\n                            }\n                        }\n\n                        offset += 188;\n                    }\n\n                }\n            }\n\n            return findSyncFrame(streamChunks);\n        }\n    }\n}\n\nexport async function* parseMp4StreamChunks(parser: AsyncGenerator<MP4Atom>) {\n    let ftyp: MP4Atom;\n    let moov: MP4Atom;\n    let startStream: Buffer;\n    for await (const atom of parser) {\n        if (!ftyp) {\n            ftyp = atom;\n        }\n        else if (!moov) {\n            moov = atom;\n        }\n\n        yield {\n            startStream,\n            chunks: [atom.header, atom.data],\n            type: atom.type,\n        };\n\n        if (ftyp && moov && !startStream) {\n            startStream = Buffer.concat([ftyp.header, ftyp.data, moov.header, moov.data])\n        }\n    }\n}\n\nexport function createFragmentedMp4Parser(options?: StreamParserOptions): StreamParser {\n    return {\n        container: 'mp4',\n        outputArguments: [\n            ...(options?.vcodec || []),\n            ...(options?.acodec || []),\n            ...FFMPEG_FRAGMENTED_MP4_OUTPUT_ARGS,\n        ],\n        async *parse(socket: Duplex): AsyncGenerator<StreamChunk> {\n            const parser = parseFragmentedMP4(socket);\n            yield* parseMp4StreamChunks(parser);\n        },\n        findSyncFrame,\n    }\n}\n\nexport interface RawVideoParserOptions {\n    size: {\n        width: number,\n        height: number\n    };\n    everyNFrames?: number;\n    pixelFormat?: RawVideoPixelFormat;\n}\n\nexport interface RawVideoPixelFormat {\n    name: string;\n    computeLength: (width: number, height: number) => number;\n}\n\nexport const PIXEL_FORMAT_YUV420P: RawVideoPixelFormat = {\n    name: 'yuv420p',\n    computeLength: (width, height) => width * height * 1.5,\n}\n\nexport const PIXEL_FORMAT_RGB24: RawVideoPixelFormat = {\n    name: 'rgb24',\n    computeLength: (width, height) => width * height * 3,\n}\n\nexport function createRawVideoParser(options: RawVideoParserOptions): StreamParser {\n    const pixelFormat = options?.pixelFormat || PIXEL_FORMAT_YUV420P;\n    let filter: string;\n    const { size, everyNFrames } = options;\n    if (size) {\n        filter = `scale=${size.width}:${size.height}`;\n    }\n    if (everyNFrames && everyNFrames > 1) {\n        if (filter)\n            filter += ',';\n        else\n            filter = '';\n        filter = filter + `select=not(mod(n\\\\,${everyNFrames}))`\n    }\n\n    const inputArguments: string[] = [];\n    if (options.size)\n        inputArguments.push('-s', `${options.size.width}x${options.size.height}`);\n\n    inputArguments.push('-pix_fmt', pixelFormat.name);\n    return {\n        inputArguments,\n        container: 'rawvideo',\n        outputArguments: [\n            '-s', `${options.size.width}x${options.size.height}`,\n            '-an',\n            '-vcodec', 'rawvideo',\n            '-pix_fmt', pixelFormat.name,\n            '-f', 'rawvideo',\n        ],\n        async *parse(socket: Duplex, width: number, height: number): AsyncGenerator<StreamChunk> {\n            width = size?.width || width;\n            height = size?.height || height\n\n            if (!width || !height)\n                throw new Error(\"error parsing rawvideo, unknown width and height\");\n\n            const toRead = pixelFormat.computeLength(width, height);\n            while (true) {\n                const buffer = await readLength(socket, toRead);\n                yield {\n                    chunks: [buffer],\n                    width,\n                    height,\n                }\n            }\n        },\n        findSyncFrame,\n    }\n}","import { Deferred } from \"@scrypted/common/src/deferred\";\nimport { Headers, RtspServer } from \"@scrypted/common/src/rtsp-server\";\nimport fs from 'fs';\nimport { format } from \"path\";\nimport { Duplex } from \"stream\";\n\n// non standard extension that dumps the rtp payload to a file.\nexport class FileRtspServer extends RtspServer {\n    writeStream: fs.WriteStream;\n    segmentBytesWritten = 0;\n    writeConsole: Console;\n\n    constructor(client: Duplex, sdp?: string, checkRequest?: (method: string, url: string, headers: Headers, rawMessage: string[]) => Promise<boolean>) {\n        super(client, sdp, undefined, checkRequest);\n\n        this.client.on('close', () => {\n            if (this.writeStream)\n                this.writeConsole?.log('RTSP WRITE client closed.');\n            this.cleanup();\n        });\n\n        this.availableOptions.push('WRITE', \"WRITESIZE\");\n    }\n\n    cleanup() {\n        const ws = this.writeStream;\n        if (!ws)\n            return;\n        this.writeStream = undefined;\n        ws?.end(() => ws?.destroy());\n    }\n\n    async write(url: string, requestHeaders: Headers) {\n        const file = requestHeaders['x-scrypted-rtsp-file'];\n\n        if (!file)\n            return this.respond(400, 'Bad Request', requestHeaders, {});\n\n        const truncate = requestHeaders['x-scrypted-rtsp-file-truncate'];\n\n        // this.writeConsole?.log('RTSP WRITE file', file);\n\n        // truncation preparation must happen before cleanup.\n        let truncateWriteStream: fs.WriteStream;\n        if (truncate) {\n            try {\n                const d = new Deferred<number>();\n                fs.open(truncate, 'w', (e, fd) => {\n                    if (e)\n                        d.reject(e);\n                    else\n                        d.resolve(fd);\n                });\n                const fd = await d.promise;\n                try {\n                    await fs.promises.rename(truncate, file);\n                    truncateWriteStream = fs.createWriteStream(undefined, {\n                        fd,\n                    })\n                    // this.writeConsole?.log('truncating', truncate);\n                }\n                catch (e) {\n                    throw e;\n                }\n            }\n            catch (e) {\n                this.writeConsole?.error('RTSP WRITE error during truncate file', truncate, e);\n            }\n        }\n\n        // everything after this point must be sync due to cleanup potentially causing dangling state.\n        this.cleanup();\n        this.segmentBytesWritten = 0;\n\n        this.writeStream = truncateWriteStream || fs.createWriteStream(file);\n        this.writeStream.on('error', e => {\n            this.writeConsole?.error('RTSP WRITE error', e);\n        });\n        this.respond(200, 'OK', requestHeaders, {});\n    }\n\n    writesize(url: string, requestHeaders: Headers) {\n        this.respond(200, 'OK', requestHeaders, {\n            'x-scrypted-rtsp-file-size': this.segmentBytesWritten.toString(),\n        });\n    }\n\n    writeRtpPayload(header: Buffer, rtp: Buffer): boolean {\n        if (!this.writeStream)\n            return super.writeRtpPayload(header, rtp);\n\n        this.segmentBytesWritten += header.length + rtp.length;\n        this.writeStream.write(header);\n        return this.writeStream.write(rtp);\n    }\n}","import sdk from '@scrypted/sdk';\n\nexport async function getUrlLocalAdresses(console: Console, url: string) {\n    let urls: string[];\n    try {\n        const addresses = await sdk.endpointManager.getLocalAddresses();\n        if (addresses) {\n            const [address] = addresses;\n            if (address) {\n                const u = new URL(url);\n                u.hostname = address;\n                url = u.toString();\n            }\n            urls = addresses.map(address => {\n                const u = new URL(url);\n                u.hostname = address;\n                return u.toString();\n            });\n        }\n    }\n    catch (e) {\n        console.warn('Error determining external addresses. Is Scrypted Server Address configured?', e);\n    }\n    return urls;\n}\n","\nimport { AutoenableMixinProvider } from '@scrypted/common/src/autoenable-mixin-provider';\nimport { getDebugModeH264EncoderArgs, getH264EncoderArgs } from '@scrypted/common/src/ffmpeg-hardware-acceleration';\nimport { addVideoFilterArguments } from '@scrypted/common/src/ffmpeg-helpers';\nimport { handleRebroadcasterClient, ParserOptions, ParserSession, startParserSession } from '@scrypted/common/src/ffmpeg-rebroadcast';\nimport { closeQuiet, listenZeroSingleClient, ListenZeroSingleClientTimeoutError } from '@scrypted/common/src/listen-cluster';\nimport { readLength } from '@scrypted/common/src/read-stream';\nimport { createRtspParser, findH264NaluType, getNaluTypes, H264_NAL_TYPE_FU_B, H264_NAL_TYPE_IDR, H264_NAL_TYPE_MTAP16, H264_NAL_TYPE_MTAP32, H264_NAL_TYPE_RESERVED0, H264_NAL_TYPE_RESERVED30, H264_NAL_TYPE_RESERVED31, H264_NAL_TYPE_SEI, H264_NAL_TYPE_STAP_B, listenSingleRtspClient, RtspServer, RtspTrack } from '@scrypted/common/src/rtsp-server';\nimport { addTrackControls, parseSdp } from '@scrypted/common/src/sdp-utils';\nimport { SettingsMixinDeviceBase, SettingsMixinDeviceOptions } from \"@scrypted/common/src/settings-mixin\";\nimport { sleep } from '@scrypted/common/src/sleep';\nimport { createFragmentedMp4Parser, createMpegTsParser, StreamChunk, StreamParser } from '@scrypted/common/src/stream-parser';\nimport sdk, { BufferConverter, DeviceProvider, DeviceState, EventListenerRegister, FFmpegInput, H264Info, MediaObject, MediaStreamDestination, MediaStreamOptions, MixinProvider, RequestMediaStreamOptions, ResponseMediaStreamOptions, ScryptedDevice, ScryptedDeviceType, ScryptedInterface, ScryptedMimeTypes, Setting, Settings, SettingValue, VideoCamera, VideoCameraConfiguration } from '@scrypted/sdk';\nimport { StorageSettings } from '@scrypted/sdk/storage-settings';\nimport crypto from 'crypto';\nimport { once } from 'events';\nimport net, { AddressInfo } from 'net';\nimport semver from 'semver';\nimport { Duplex } from 'stream';\nimport { Worker } from 'worker_threads';\nimport { FileRtspServer } from './file-rtsp-server';\nimport { getUrlLocalAdresses } from './local-addresses';\nimport { REBROADCAST_MIXIN_INTERFACE_TOKEN } from './rebroadcast-mixin-token';\nimport { connectRFC4571Parser, startRFC4571Parser } from './rfc4571';\nimport { RtspSessionParserSpecific, startRtspSession } from './rtsp-session';\nimport { createStreamSettings } from './stream-settings';\nimport { getTranscodeMixinProviderId, TranscodeMixinProvider, TRANSCODE_MIXIN_PROVIDER_NATIVE_ID } from './transcode-settings';\n\nconst { mediaManager, log, systemManager, deviceManager } = sdk;\n\nconst prebufferDurationMs = 10000;\nconst DEFAULT_AUDIO = 'Default';\nconst AAC_AUDIO = 'AAC or No Audio';\nconst AAC_AUDIO_DESCRIPTION = `${AAC_AUDIO} (Copy)`;\nconst COMPATIBLE_AUDIO = 'Compatible Audio'\nconst COMPATIBLE_AUDIO_DESCRIPTION = `${COMPATIBLE_AUDIO} (Copy)`;\nconst TRANSCODE_AUDIO = 'Other Audio';\nconst TRANSCODE_AUDIO_DESCRIPTION = `${TRANSCODE_AUDIO} (Transcode)`;\nconst COMPATIBLE_AUDIO_CODECS = ['aac', 'mp3', 'mp2', 'opus'];\nconst DEFAULT_FFMPEG_INPUT_ARGUMENTS = '-fflags +genpts';\n\nconst SCRYPTED_PARSER_TCP = 'Scrypted (TCP)';\nconst SCRYPTED_PARSER_UDP = 'Scrypted (UDP)';\nconst FFMPEG_PARSER_TCP = 'FFmpeg (TCP)';\nconst FFMPEG_PARSER_UDP = 'FFmpeg (UDP)';\nconst STRING_DEFAULT = 'Default';\n\nconst VALID_AUDIO_CONFIGS = [\n  AAC_AUDIO,\n  COMPATIBLE_AUDIO,\n  TRANSCODE_AUDIO,\n];\n\ninterface PrebufferStreamChunk extends StreamChunk {\n  time?: number;\n}\n\ntype Prebuffers<T extends string> = {\n  [key in T]: PrebufferStreamChunk[];\n}\n\ntype PrebufferParsers = 'mpegts' | 'mp4' | 'rtsp';\nconst PrebufferParserValues: PrebufferParsers[] = ['mpegts', 'mp4', 'rtsp'];\n\nfunction hasOddities(h264Info: H264Info) {\n  const h264Oddities = h264Info.fuab\n    || h264Info.mtap16\n    || h264Info.mtap32\n    || h264Info.sei\n    || h264Info.stapb\n    || h264Info.reserved0\n    || h264Info.reserved30\n    || h264Info.reserved31;\n  return h264Oddities;\n}\n\nclass PrebufferSession {\n\n  parserSessionPromise: Promise<ParserSession<PrebufferParsers>>;\n  parserSession: ParserSession<PrebufferParsers>;\n  prebuffers: Prebuffers<PrebufferParsers> = {\n    mp4: [],\n    mpegts: [],\n    rtsp: [],\n  };\n  parsers: { [container: string]: StreamParser };\n  sdp: Promise<string>;\n  usingScryptedParser = false;\n  usingScryptedUdpParser = false;\n\n  audioDisabled = false;\n\n  mixinDevice: VideoCamera;\n  console: Console;\n  storage: Storage;\n\n  activeClients = 0;\n  inactivityTimeout: NodeJS.Timeout;\n  audioConfigurationKey: string;\n  ffmpegInputArgumentsKey: string;\n  lastDetectedAudioCodecKey: string;\n  lastH264ProbeKey: string;\n  rebroadcastModeKey: string;\n  rtspParserKey: string;\n  rtspServerPath: string;\n  rtspServerMutedPath: string;\n\n  constructor(public mixin: PrebufferMixin, public advertisedMediaStreamOptions: ResponseMediaStreamOptions, public stopInactive: boolean) {\n    this.storage = mixin.storage;\n    this.console = mixin.console;\n    this.mixinDevice = mixin.mixinDevice;\n    this.audioConfigurationKey = 'audioConfiguration-' + this.streamId;\n    this.ffmpegInputArgumentsKey = 'ffmpegInputArguments-' + this.streamId;\n    this.rebroadcastModeKey = 'rebroadcastMode-' + this.streamId;\n    this.lastDetectedAudioCodecKey = 'lastDetectedAudioCodec-' + this.streamId;\n    this.lastH264ProbeKey = 'lastH264Probe-' + this.streamId;\n    this.rtspParserKey = 'rtspParser-' + this.streamId;\n    const rtspServerPathKey = 'rtspServerPathKey-' + this.streamId;\n    const rtspServerMutedPathKey = 'rtspServerMutedPathKey-' + this.streamId;\n\n    this.rtspServerPath = this.storage.getItem(rtspServerPathKey);\n    if (!this.rtspServerPath) {\n      this.rtspServerPath = crypto.randomBytes(8).toString('hex');\n      this.storage.setItem(rtspServerPathKey, this.rtspServerPath);\n    }\n\n    this.rtspServerMutedPath = this.storage.getItem(rtspServerMutedPathKey);\n    if (!this.rtspServerMutedPath) {\n      this.rtspServerMutedPath = crypto.randomBytes(8).toString('hex');\n      this.storage.setItem(rtspServerMutedPathKey, this.rtspServerMutedPath);\n    }\n  }\n\n  get canPrebuffer() {\n    return this.advertisedMediaStreamOptions.container !== 'rawvideo' && this.advertisedMediaStreamOptions.container !== 'ffmpeg';\n  }\n\n  getLastH264Probe(): H264Info {\n    const str = this.storage.getItem(this.lastH264ProbeKey);\n    if (!str) {\n      return {};\n    }\n\n    try {\n      return JSON.parse(str);\n    }\n    catch (e) {\n      return {};\n    }\n  }\n\n  getLastH264Oddities() {\n    return hasOddities(this.getLastH264Probe());\n  }\n\n  getDetectedIdrInterval() {\n    const durations: number[] = [];\n    if (this.prebuffers.mp4.length) {\n      let last: number;\n\n      for (const chunk of this.prebuffers.mp4) {\n        if (chunk.type === 'mdat') {\n          if (last)\n            durations.push(chunk.time - last);\n          last = chunk.time;\n        }\n      }\n    }\n    else if (this.prebuffers.rtsp.length) {\n      let last: number;\n\n      for (const chunk of this.prebuffers.rtsp) {\n        if (findH264NaluType(chunk, H264_NAL_TYPE_IDR)) {\n          if (last)\n            durations.push(chunk.time - last);\n          last = chunk.time;\n        }\n      }\n    }\n\n    if (!durations.length)\n      return;\n\n    const total = durations.reduce((prev, current) => prev + current, 0);\n    return total / durations.length;\n  }\n\n  get streamId() {\n    return this.advertisedMediaStreamOptions.id;\n  }\n\n  get streamName() {\n    return this.advertisedMediaStreamOptions.name || `Stream ${this.streamId}`;\n  }\n\n  clearPrebuffers() {\n    for (const prebuffer of PrebufferParserValues) {\n      this.prebuffers[prebuffer] = [];\n    }\n  }\n\n  release() {\n    this.clearPrebuffers();\n    this.parserSessionPromise?.then(parserSession => {\n      this.console.log('prebuffer session released');\n      parserSession.kill(new Error('rebroadcast disabled'));\n      this.clearPrebuffers();\n    });\n  }\n\n  ensurePrebufferSession() {\n    if (this.parserSessionPromise || this.mixin.released)\n      return;\n    this.console.log(this.streamName, 'prebuffer session started');\n    this.parserSessionPromise = this.startPrebufferSession();\n    this.parserSessionPromise.catch(e => this.parserSessionPromise = undefined);\n    this.parserSessionPromise.then(pso => pso.killed.finally(() => this.parserSessionPromise = undefined));\n  }\n\n  getAudioConfig(): {\n    isUsingDefaultAudioConfig: boolean,\n    aacAudio: boolean,\n    compatibleAudio: boolean,\n    reencodeAudio: boolean,\n  } {\n    let audioConfig = this.storage.getItem(this.audioConfigurationKey) || '';\n    if (!VALID_AUDIO_CONFIGS.find(config => audioConfig.startsWith(config)))\n      audioConfig = '';\n    const aacAudio = audioConfig.indexOf(AAC_AUDIO) !== -1;\n    const compatibleAudio = audioConfig.indexOf(COMPATIBLE_AUDIO) !== -1;\n    // reencode audio will be used if explicitly set.\n    const reencodeAudio = audioConfig.indexOf(TRANSCODE_AUDIO) !== -1;\n    return {\n      isUsingDefaultAudioConfig: !(aacAudio || compatibleAudio || reencodeAudio),\n      aacAudio,\n      compatibleAudio,\n      reencodeAudio,\n    }\n  }\n\n  canUseRtspParser(mediaStreamOptions: MediaStreamOptions) {\n    return mediaStreamOptions?.container?.startsWith('rtsp');\n  }\n\n  getParser(rtspMode: boolean, mediaStreamOptions: MediaStreamOptions) {\n    let parser: string;\n    const rtspParser = this.storage.getItem(this.rtspParserKey);\n\n    if (!this.canUseRtspParser(mediaStreamOptions)) {\n      parser = STRING_DEFAULT;\n    }\n    else {\n\n      if (rtspParser === FFMPEG_PARSER_TCP)\n        parser = FFMPEG_PARSER_TCP;\n      if (rtspParser === FFMPEG_PARSER_UDP)\n        parser = FFMPEG_PARSER_UDP;\n\n      // scrypted parser can only be used in rtsp mode.\n      if (rtspMode && !parser) {\n        if (!rtspParser || rtspParser === STRING_DEFAULT)\n          parser = SCRYPTED_PARSER_TCP;\n        if (rtspParser === SCRYPTED_PARSER_TCP)\n          parser = SCRYPTED_PARSER_TCP;\n        if (rtspParser === SCRYPTED_PARSER_UDP)\n          parser = SCRYPTED_PARSER_UDP;\n      }\n\n      // bad config, fall back to ffmpeg tcp parsing.\n      if (!parser)\n        parser = FFMPEG_PARSER_TCP;\n    }\n\n    return {\n      parser,\n      isDefault: !rtspParser || rtspParser === 'Default',\n    }\n  }\n\n  getRebroadcastContainer() {\n    let mode = this.storage.getItem(this.rebroadcastModeKey) || 'Default';\n    if (mode === 'Default')\n      mode = 'RTSP';\n    const rtspMode = mode?.startsWith('RTSP');\n\n    return {\n      rtspMode: mode?.startsWith('RTSP'),\n      muxingMp4: !rtspMode,\n    };\n  }\n\n  async getMixinSettings(): Promise<Setting[]> {\n    const settings: Setting[] = [];\n\n    const session = this.parserSession;\n\n    let total = 0;\n    let start = 0;\n    const { muxingMp4, rtspMode } = this.getRebroadcastContainer();\n    for (const prebuffer of (muxingMp4 ? this.prebuffers.mp4 : this.prebuffers.rtsp)) {\n      start = start || prebuffer.time;\n      for (const chunk of prebuffer.chunks) {\n        total += chunk.byteLength;\n      }\n    }\n    const elapsed = Date.now() - start;\n    const bitrate = Math.round(total / elapsed * 8);\n\n    const group = \"Streams\";\n    const subgroup = `Stream: ${this.streamName}`;\n\n    settings.push(\n      {\n        title: 'Rebroadcast Container',\n        group,\n        subgroup,\n        description: `The container format to use when rebroadcasting. The default mode for this camera is RTSP.`,\n        placeholder: 'RTSP',\n        choices: [\n          STRING_DEFAULT,\n          'MPEG-TS',\n          'RTSP',\n        ],\n        key: this.rebroadcastModeKey,\n        value: this.storage.getItem(this.rebroadcastModeKey) || STRING_DEFAULT,\n      }\n    );\n\n    const addFFmpegAudioSettings = () => {\n      settings.push(\n        {\n          title: 'Audio Codec Transcoding',\n          group,\n          subgroup,\n          description: 'Configuring your camera to output Opus, PCM, or AAC is recommended.',\n          type: 'string',\n          key: this.audioConfigurationKey,\n          value: this.storage.getItem(this.audioConfigurationKey) || DEFAULT_AUDIO,\n          choices: [\n            DEFAULT_AUDIO,\n            AAC_AUDIO_DESCRIPTION,\n            COMPATIBLE_AUDIO_DESCRIPTION,\n            TRANSCODE_AUDIO_DESCRIPTION,\n          ],\n        },\n      );\n    };\n\n    const addFFmpegInputSettings = () => {\n      settings.push(\n        {\n          title: 'FFmpeg Input Arguments Prefix',\n          group,\n          subgroup,\n          description: 'Optional/Advanced: Additional input arguments to pass to the ffmpeg command. These will be placed before the input arguments.',\n          key: this.ffmpegInputArgumentsKey,\n          value: this.storage.getItem(this.ffmpegInputArgumentsKey),\n          placeholder: DEFAULT_FFMPEG_INPUT_ARGUMENTS,\n          choices: [\n            DEFAULT_FFMPEG_INPUT_ARGUMENTS,\n            '-use_wallclock_as_timestamps 1',\n            '-v verbose',\n          ],\n          combobox: true,\n        },\n      )\n    }\n\n    let usingFFmpeg = muxingMp4;\n\n    if (this.canUseRtspParser(this.advertisedMediaStreamOptions)) {\n      const canUseScryptedParser = rtspMode;\n      const defaultValue = canUseScryptedParser && !this.getLastH264Oddities() ?\n        SCRYPTED_PARSER_TCP : FFMPEG_PARSER_TCP;\n\n      const scryptedOptions = canUseScryptedParser ? [\n        SCRYPTED_PARSER_TCP,\n        SCRYPTED_PARSER_UDP,\n      ] : [];\n\n      const currentParser = this.storage.getItem(this.rtspParserKey) || STRING_DEFAULT;\n\n      settings.push(\n        {\n          key: this.rtspParserKey,\n          group,\n          subgroup,\n          title: 'RTSP Parser',\n          description: `The RTSP Parser used to read the stream. The default is \"${defaultValue}\" for this container.`,\n          value: currentParser,\n          choices: [\n            STRING_DEFAULT,\n            ...scryptedOptions,\n            FFMPEG_PARSER_TCP,\n            FFMPEG_PARSER_UDP,\n          ],\n        }\n      );\n\n      if (!(currentParser === STRING_DEFAULT ? defaultValue : currentParser).includes('Scrypted')) {\n        usingFFmpeg = true;\n      }\n    }\n\n    if (muxingMp4) {\n      addFFmpegAudioSettings();\n    }\n    if (usingFFmpeg) {\n      addFFmpegInputSettings();\n    }\n\n    const addOddities = () => {\n      settings.push(\n        {\n          key: 'detectedOddities',\n          group,\n          subgroup,\n          title: 'Detected H264 Oddities',\n          readonly: true,\n          value: JSON.stringify(this.getLastH264Probe()),\n          description: 'Cameras with oddities in the H264 video stream may not function correctly with Scrypted RTSP Parsers or Senders.',\n        }\n      )\n    };\n\n    if (session) {\n      const resolution = session.inputVideoResolution?.width && session.inputVideoResolution?.height\n        ? `${session.inputVideoResolution?.width}x${session.inputVideoResolution?.height}`\n        : 'unknown';\n\n      const idrInterval = this.getDetectedIdrInterval();\n      settings.push(\n        {\n          key: 'detectedResolution',\n          group,\n          subgroup,\n          title: 'Detected Resolution and Bitrate',\n          readonly: true,\n          value: `${resolution} @ ${bitrate || \"unknown\"} Kb/s`,\n          description: 'Configuring your camera to 1920x1080, 2000Kb/S, Variable Bit Rate, is recommended.',\n        },\n        {\n          key: 'detectedCodec',\n          group,\n          subgroup,\n          title: 'Detected Video/Audio Codecs',\n          readonly: true,\n          value: (session?.inputVideoCodec?.toString() || 'unknown') + '/' + (session?.inputAudioCodec?.toString() || 'unknown'),\n          description: 'Configuring your camera to H264 video and Opus, PCM, or AAC audio is recommended.'\n        },\n        {\n          key: 'detectedKeyframe',\n          group,\n          subgroup,\n          title: 'Detected Keyframe Interval',\n          description: \"Configuring your camera to 4 seconds is recommended (IDR aka Frame Interval = FPS * 4 seconds).\",\n          readonly: true,\n          value: (idrInterval || 0) / 1000 || 'unknown',\n        },\n      );\n      addOddities();\n    }\n    else {\n      settings.push(\n        {\n          title: 'Status',\n          group,\n          subgroup,\n          key: 'status',\n          description: 'Rebroadcast is currently idle and will be started automatically on demand.',\n          value: 'Idle',\n          readonly: true,\n        },\n      );\n      addOddities();\n    }\n\n    if (rtspMode) {\n      settings.push({\n        group,\n        subgroup,\n        key: 'rtspRebroadcastUrl',\n        title: 'RTSP Rebroadcast Url',\n        description: 'The RTSP URL of the rebroadcast stream. Substitute localhost as appropriate.',\n        readonly: true,\n        value: `rtsp://localhost:${this.mixin.streamSettings.storageSettings.values.rebroadcastPort}/${this.rtspServerPath}`,\n      });\n      settings.push({\n        group,\n        subgroup,\n        key: 'rtspRebroadcastMutedUrl',\n        title: 'RTSP Rebroadcast Url (Muted)',\n        description: 'The RTSP URL of the muted rebroadcast stream. Substitute localhost as appropriate.',\n        readonly: true,\n        value: `rtsp://localhost:${this.mixin.streamSettings.storageSettings.values.rebroadcastPort}/${this.rtspServerMutedPath}`,\n      });\n    }\n\n    return settings;\n  }\n\n  async startPrebufferSession() {\n    this.clearPrebuffers();\n\n    let mso: ResponseMediaStreamOptions;\n    try {\n      mso = (await this.mixinDevice.getVideoStreamOptions()).find(o => o.id === this.streamId);\n    }\n    catch (e) {\n    }\n\n    // audio codecs are determined by probing the camera to see what it reports.\n    // if the camera does not specify a codec, rebroadcast will force audio off\n    // to determine the codec without causing a parse failure.\n    // camera may explicity request that its audio stream be muted via a null.\n    // respect that setting.\n    const audioSoftMuted = mso?.audio === null;\n    const advertisedAudioCodec = mso?.audio?.codec;\n\n    const { isUsingDefaultAudioConfig, aacAudio, compatibleAudio, reencodeAudio } = this.getAudioConfig();\n\n    const { rtspMode, muxingMp4 } = this.getRebroadcastContainer();\n\n    let detectedAudioCodec = this.storage.getItem(this.lastDetectedAudioCodecKey) || undefined;\n    if (detectedAudioCodec === 'null')\n      detectedAudioCodec = null;\n\n    // only need to probe the audio under specific circumstances.\n    // rtsp only mode (ie, no mp4 mux) does not need probing.\n    let probingAudioCodec = false;\n    if (muxingMp4\n      && !audioSoftMuted\n      && !advertisedAudioCodec\n      && isUsingDefaultAudioConfig\n      && detectedAudioCodec === undefined) {\n      this.console.warn('Camera did not report an audio codec, muting the audio stream and probing the codec.');\n      probingAudioCodec = true;\n    }\n\n    // the assumed audio codec is the detected codec first and the reported codec otherwise.\n    const assumedAudioCodec = detectedAudioCodec === undefined\n      ? advertisedAudioCodec?.toLowerCase()\n      : detectedAudioCodec?.toLowerCase();\n\n\n    // after probing the audio codec is complete, alert the user with appropriate instructions.\n    // assume the codec is user configurable unless the camera explictly reports otherwise.\n    const audioIncompatible = !COMPATIBLE_AUDIO_CODECS.includes(assumedAudioCodec);\n    if (muxingMp4 && !probingAudioCodec && mso?.userConfigurable !== false && !audioSoftMuted) {\n      if (audioIncompatible) {\n        // show an alert that rebroadcast needs an explicit setting by the user.\n        if (isUsingDefaultAudioConfig) {\n          log.a(`${this.mixin.name} is using the ${assumedAudioCodec} audio codec. Configuring your Camera to use Opus, PCM, or AAC audio is recommended. If this is not possible, Select 'Transcode Audio' in the camera stream's Rebroadcast settings to suppress this alert.`);\n        }\n        this.console.warn('Configure your camera to output Opus, PCM, or AAC audio. Suboptimal audio codec in use:', assumedAudioCodec);\n      }\n      else if (!audioSoftMuted && isUsingDefaultAudioConfig && advertisedAudioCodec === undefined && detectedAudioCodec !== undefined) {\n        // handling compatible codecs that were unspecified...\n        // if (detectedAudioCodec === 'aac') {\n        //   log.a(`${this.mixin.name} did not report a codec and ${detectedAudioCodec} was found during probe. Select '${AAC_AUDIO}' in the camera stream's Rebroadcast settings to suppress this alert and improve startup time.`);\n        // }\n        // else {\n        //   log.a(`${this.mixin.name} did not report a codec and ${detectedAudioCodec} was found during probe. Select '${COMPATIBLE_AUDIO}' in the camera stream's Rebroadcast settings to suppress this alert and improve startup time.`);\n        // }\n      }\n    }\n\n    // aac needs to have the adts header stripped for mpegts and mp4.\n    // use this filter sparingly as it prevents ffmpeg from starting on a mismatch.\n    // however, not using it on an aac stream also prevents ffmpeg from parsing.\n    // so only use it when the detected or probe codec reports aac.\n    const aacFilters = ['-bsf:a', 'aac_adtstoasc'];\n    // compatible audio like mp3, mp2, opus can be muxed without issue.\n    const compatibleFilters = [];\n\n    this.audioDisabled = false;\n    let acodec: string[];\n\n    const detectedNoAudio = detectedAudioCodec === null;\n\n    // if the camera reports audio is incompatible and the user can't do anything about it\n    // enable transcoding by default. however, still allow the user to change the settings\n    // in case something changed.\n    let mustTranscode = false;\n    if (muxingMp4 && !probingAudioCodec && isUsingDefaultAudioConfig && audioIncompatible) {\n      if (mso?.userConfigurable === false)\n        this.console.log('camera reports it is not user configurable. transcoding due to incompatible codec', assumedAudioCodec);\n      else\n        this.console.log('camera audio transcoding due to incompatible codec. configure the camera to use a compatible codec if possible.');\n      mustTranscode = true;\n    }\n\n    if (audioSoftMuted || probingAudioCodec) {\n      // no audio? explicitly disable it.\n      acodec = ['-an'];\n      this.audioDisabled = true;\n    }\n    else if (reencodeAudio || mustTranscode) {\n      acodec = [\n        '-bsf:a', 'aac_adtstoasc',\n        '-acodec', 'aac',\n        '-ar', `32k`,\n        '-b:a', `32k`,\n        '-ac', `1`,\n        '-profile:a', 'aac_low',\n        '-flags', '+global_header',\n      ];\n    }\n    else if (aacAudio || detectedNoAudio) {\n      // NOTE: If there is no audio track, the aac filters will still work fine without complaints\n      // from ffmpeg. This is why AAC and No Audio can be grouped into a single setting.\n      // This is preferred, because failure and recovery is preferable to\n      // permanently muting camera audio due to erroneous detection.\n      acodec = [\n        '-acodec',\n        'copy',\n      ];\n      acodec.push(...aacFilters);\n    }\n    else if (compatibleAudio) {\n      acodec = [\n        '-acodec',\n        'copy',\n      ];\n      acodec.push(...compatibleFilters);\n    }\n    else {\n      acodec = [\n        '-acodec',\n        'copy',\n      ];\n\n      const filters = assumedAudioCodec === 'aac' ? aacFilters : compatibleFilters;\n\n      acodec.push(...filters);\n    }\n\n    const vcodec = [\n      '-vcodec', 'copy',\n      // 3/6/2022\n      // Add SPS/PPS to all keyframes. Not all cameras do this!\n      // This isn't really necessary for a few reasons:\n      // MPEG-TS and MP4 will automatically do this, since there's no out of band\n      // way to get the SPS/PPS.\n      // RTSP mode may send the SPS/PPS out of band via the sdp, and then may not have\n      // SPS/PPS in the bit stream.\n      // Adding this argument isn't strictly necessary, but it normalizes the bitstream\n      // so consumers that expect the SPS/PPS will have it. Ran into an issue where\n      // the HomeKit plugin was blasting RTP packets out from RTSP mode,\n      // but the bitstream had no SPS/PPS information, resulting in the video never loading\n      // in the Home app.\n      // 3/7/2022\n      // I believe this is causing errors in recordings and possibly streaming as well\n      // for some users. This may need to be a homekit specific transcoding argument.\n      // '-bsf:v', 'dump_extra',\n    ];\n\n    const rbo: ParserOptions<PrebufferParsers> = {\n      console: this.console,\n      timeout: 60000,\n      parsers: {\n      },\n    };\n    this.parsers = rbo.parsers;\n\n    this.console.log('rebroadcast mode:', rtspMode ? 'rtsp' : 'mpegts');\n    if (!rtspMode) {\n      rbo.parsers.mpegts = createMpegTsParser({\n        vcodec,\n        acodec,\n      });\n    }\n    else {\n      const parser = createRtspParser({\n        vcodec,\n        // the rtsp parser should always stream copy unless audio is soft muted.\n        acodec: audioSoftMuted ? acodec : ['-acodec', 'copy'],\n      });\n      this.sdp = parser.sdp;\n      rbo.parsers.rtsp = parser;\n    }\n\n    if (muxingMp4) {\n      rbo.parsers.mp4 = createFragmentedMp4Parser({\n        vcodec,\n        acodec,\n      });\n    }\n\n    const mo = await this.mixinDevice.getVideoStream(mso);\n    const isRfc4571 = mo.mimeType === 'x-scrypted/x-rfc4571';\n\n    let session: ParserSession<PrebufferParsers>;\n    let sessionMso: ResponseMediaStreamOptions;\n\n    // before launching the parser session, clear out the last detected codec.\n    // an erroneous cached codec could cause ffmpeg to fail to start.\n    this.storage.removeItem(this.lastDetectedAudioCodecKey);\n    this.usingScryptedParser = false;\n\n    const h264Oddities = this.getLastH264Oddities();\n\n    if (rtspMode && isRfc4571) {\n      this.usingScryptedParser = true;\n      this.console.log('bypassing ffmpeg: using scrypted rfc4571 parser')\n      const json = await mediaManager.convertMediaObjectToJSON<any>(mo, 'x-scrypted/x-rfc4571');\n      const { url, sdp, mediaStreamOptions } = json;\n\n      session = startRFC4571Parser(this.console, connectRFC4571Parser(url), sdp, mediaStreamOptions, rbo);\n      this.sdp = session.sdp.then(buffers => Buffer.concat(buffers).toString());\n    }\n    else {\n      const moBuffer = await mediaManager.convertMediaObjectToBuffer(mo, ScryptedMimeTypes.FFmpegInput);\n      const ffmpegInput = JSON.parse(moBuffer.toString()) as FFmpegInput;\n      sessionMso = ffmpegInput.mediaStreamOptions || this.advertisedMediaStreamOptions;\n\n      let { parser, isDefault } = this.getParser(rtspMode, sessionMso);\n      this.usingScryptedParser = parser === SCRYPTED_PARSER_TCP || parser === SCRYPTED_PARSER_UDP;\n      this.usingScryptedUdpParser = parser === SCRYPTED_PARSER_UDP;\n\n      // prefer ffmpeg if this is a prebuffered stream.\n      if (isDefault\n        && this.usingScryptedParser\n        && h264Oddities\n        && !this.stopInactive\n        && sessionMso.tool !== 'scrypted') {\n        this.console.warn('H264 oddities were detected in prebuffered video stream, the Default Scrypted RTSP Parser will not be used. Falling back to FFmpeg. This can be overriden by setting the RTSP Parser to Scrypted.');\n        this.usingScryptedParser = false;\n        parser = FFMPEG_PARSER_TCP;\n      }\n\n      if (this.usingScryptedParser) {\n        session = await startRtspSession(this.console, ffmpegInput.url, ffmpegInput.mediaStreamOptions, {\n          useUdp: parser === SCRYPTED_PARSER_UDP,\n          audioSoftMuted,\n          rtspRequestTimeout: 10000,\n        });\n        this.sdp = session.sdp.then(buffers => Buffer.concat(buffers).toString());\n      }\n      else {\n        if (parser === FFMPEG_PARSER_UDP)\n          ffmpegInput.inputArguments = ['-rtsp_transport', 'udp', '-i', ffmpegInput.url];\n        else if (parser === FFMPEG_PARSER_TCP)\n          ffmpegInput.inputArguments = ['-rtsp_transport', 'tcp', '-i', ffmpegInput.url];\n        // create missing pts from dts so mpegts and mp4 muxing does not fail\n        const extraInputArguments = this.storage.getItem(this.ffmpegInputArgumentsKey) || DEFAULT_FFMPEG_INPUT_ARGUMENTS;\n        ffmpegInput.inputArguments.unshift(...extraInputArguments.split(' '));\n        session = await startParserSession(ffmpegInput, rbo);\n      }\n    }\n\n    if (this.usingScryptedParser) {\n      // watch the stream for 10 seconds to see if an weird nalu is encountered.\n      // if one is found and using scrypted parser as default, will need to restart rebroadcast to prevent\n      // downstream issues.\n      const h264Probe: H264Info = {};\n      let reportedOddity = false;\n      const oddityProbe = (chunk: StreamChunk) => {\n        if (chunk.type !== 'h264')\n          return;\n\n        const types = getNaluTypes(chunk);\n        h264Probe.fuab ||= types.has(H264_NAL_TYPE_FU_B);\n        h264Probe.stapb ||= types.has(H264_NAL_TYPE_STAP_B);\n        h264Probe.mtap16 ||= types.has(H264_NAL_TYPE_MTAP16);\n        h264Probe.mtap32 ||= types.has(H264_NAL_TYPE_MTAP32);\n        h264Probe.sei ||= types.has(H264_NAL_TYPE_SEI);\n        h264Probe.reserved0 ||= types.has(H264_NAL_TYPE_RESERVED0);\n        h264Probe.reserved30 ||= types.has(H264_NAL_TYPE_RESERVED30);\n        h264Probe.reserved31 ||= types.has(H264_NAL_TYPE_RESERVED31);\n        const oddity = hasOddities(h264Probe);\n        if (oddity && !reportedOddity) {\n          reportedOddity = true;\n          let { isDefault } = this.getParser(rtspMode, sessionMso);\n          this.console.warn('H264 oddity detected.');\n          if (!isDefault) {\n            this.console.warn('If there are issues streaming, consider using the Default parser.');\n            return;\n          }\n\n          if (sessionMso.tool === 'scrypted') {\n            this.console.warn('Stream tool is marked safe as \"scrypted\", ignoring oddity. If there are issues streaming, consider switching to FFmpeg parser.');\n            return;\n          }\n\n          // don't restart the stream if it is not a prebuffered stream.\n          // allow this specific request to continue, and possibly fail.\n          // the next time the stream is requested, ffmpeg will be used.\n          if (!this.stopInactive) {\n            this.console.warn('Oddity in prebuffered stream. Restarting rebroadcast to use FFmpeg instead.');\n            session.kill(new Error('restarting due to H264 oddity detection'));\n            this.storage.setItem(this.lastH264ProbeKey, JSON.stringify(h264Probe));\n            removeOddityProbe();\n            this.startPrebufferSession();\n            return;\n          }\n\n          // this.console.warn('Oddity in non prebuffered stream. Next restart will use FFmpeg instead.');\n        }\n      }\n      const removeOddityProbe = () => session.removeListener('rtsp', oddityProbe);\n      session.killed.finally(() => clearTimeout(oddityTimeout));\n      session.on('rtsp', oddityProbe);\n      const oddityTimeout = setTimeout(() => {\n        removeOddityProbe();\n        this.storage.setItem(this.lastH264ProbeKey, JSON.stringify(h264Probe));\n      }, h264Oddities ? 60000 : 10000);\n    }\n\n    // complain to the user about the codec if necessary. upstream may send a audio\n    // stream but report none exists (to request muting).\n    if (!audioSoftMuted && advertisedAudioCodec && session.inputAudioCodec !== undefined\n      && session.inputAudioCodec !== advertisedAudioCodec) {\n      this.console.warn('Audio codec plugin reported vs detected mismatch', advertisedAudioCodec, detectedAudioCodec);\n    }\n\n    const advertisedVideoCodec = mso?.video?.codec;\n    if (advertisedVideoCodec && session.inputVideoCodec !== undefined\n      && session.inputVideoCodec !== advertisedVideoCodec) {\n      this.console.warn('Video codec plugin reported vs detected mismatch', advertisedVideoCodec, session.inputVideoCodec);\n    }\n\n    if (!session.inputAudioCodec) {\n      this.console.log('No audio stream detected.');\n    }\n    else if (!COMPATIBLE_AUDIO_CODECS.includes(session.inputAudioCodec?.toLowerCase())) {\n      this.console.log('Detected audio codec is not mp4/mpegts compatible.', session.inputAudioCodec);\n    }\n    else {\n      this.console.log('Detected audio codec is mp4/mpegts compatible.', session.inputAudioCodec);\n    }\n\n    // set/update the detected codec, set it to null if no audio was found.\n    this.storage.setItem(this.lastDetectedAudioCodecKey, session.inputAudioCodec || 'null');\n\n    if (session.inputVideoCodec !== 'h264') {\n      this.console.error(`Video codec is not h264. If there are errors, try changing your camera's encoder output.`);\n    }\n\n    if (probingAudioCodec) {\n      this.console.warn('Audio probe complete, ending rebroadcast session and restarting with detected codecs.');\n      session.kill(new Error('audio probe completed, restarting'));\n      return this.startPrebufferSession();\n    }\n\n    this.parserSession = session;\n    session.killed.finally(() => {\n      if (this.parserSession === session)\n        this.parserSession = undefined;\n    });\n    session.killed.finally(() => clearTimeout(this.inactivityTimeout));\n\n    // settings ui refresh\n    deviceManager.onMixinEvent(this.mixin.id, this.mixin, ScryptedInterface.Settings, undefined);\n\n    // cloud streams need a periodic token refresh.\n    if (sessionMso?.refreshAt) {\n      let mso = sessionMso;\n      let refreshTimeout: NodeJS.Timeout;\n\n      const refreshStream = async () => {\n        if (!session.isActive)\n          return;\n        const mo = await this.mixinDevice.getVideoStream(mso);\n        const moBuffer = await mediaManager.convertMediaObjectToBuffer(mo, ScryptedMimeTypes.FFmpegInput);\n        const ffmpegInput = JSON.parse(moBuffer.toString()) as FFmpegInput;\n        mso = ffmpegInput.mediaStreamOptions;\n\n        scheduleRefresh(mso);\n      };\n\n      const scheduleRefresh = (refreshMso: ResponseMediaStreamOptions) => {\n        const when = refreshMso.refreshAt - Date.now() - 30000;\n        this.console.log('refreshing media stream in', when);\n        refreshTimeout = setTimeout(refreshStream, when);\n      }\n\n      scheduleRefresh(mso);\n      session.killed.finally(() => clearTimeout(refreshTimeout));\n    }\n\n    for (const container of PrebufferParserValues) {\n      let shifts = 0;\n      let prebufferContainer: PrebufferStreamChunk[] = this.prebuffers[container];\n\n      session.on(container, (chunk: PrebufferStreamChunk) => {\n        const now = Date.now();\n\n        chunk.time = now;\n        prebufferContainer.push(chunk);\n\n        while (prebufferContainer.length && prebufferContainer[0].time < now - prebufferDurationMs) {\n          prebufferContainer.shift();\n          shifts++;\n        }\n\n        if (shifts > 100000) {\n          prebufferContainer = prebufferContainer.slice();\n          this.prebuffers[container] = prebufferContainer;\n          shifts = 0;\n        }\n      });\n    }\n\n    session.start();\n    return session;\n  }\n\n  printActiveClients() {\n    this.console.log(this.streamName, 'active rebroadcast clients:', this.activeClients);\n  }\n\n  inactivityCheck(session: ParserSession<PrebufferParsers>, resetTimeout: boolean) {\n    if (this.activeClients)\n      return;\n\n    if (!this.stopInactive) {\n      return;\n    }\n\n    // passive clients should not reset timeouts.\n    if (this.inactivityTimeout && !resetTimeout)\n      return;\n\n    clearTimeout(this.inactivityTimeout)\n    this.inactivityTimeout = setTimeout(() => {\n      this.inactivityTimeout = undefined;\n      if (this.activeClients) {\n        this.console.log('inactivity timeout found active clients.');\n        return;\n      }\n      this.console.log(this.streamName, 'terminating rebroadcast due to inactivity');\n      session.kill(new Error('stream inactivity'));\n    }, 10000);\n  }\n\n  async handleRebroadcasterClient(options: {\n    findSyncFrame: boolean,\n    isActiveClient: boolean,\n    container: PrebufferParsers,\n    session: ParserSession<PrebufferParsers>,\n    socketPromise: Promise<Duplex>,\n    requestedPrebuffer: number,\n    filter?: (chunk: StreamChunk, prebuffer: boolean) => StreamChunk,\n  }) {\n    const { isActiveClient, container, session, socketPromise, requestedPrebuffer } = options;\n    this.console.log('sending prebuffer', requestedPrebuffer);\n\n    let socket: Duplex;\n\n    try {\n      socket = await socketPromise;\n    }\n    catch (e) {\n      // in case the client never connects, do an inactivity check.\n      this.inactivityCheck(session, false);\n      if (e instanceof ListenZeroSingleClientTimeoutError)\n        this.console.warn('client connection timed out');\n      else\n        this.console.error('client connection error', e);\n      return;\n    }\n\n    if (isActiveClient) {\n      this.activeClients++;\n      this.printActiveClients();\n    }\n\n    socket.once('close', () => {\n      if (isActiveClient) {\n        this.activeClients--;\n        this.printActiveClients();\n      }\n      this.inactivityCheck(session, isActiveClient);\n    });\n\n    handleRebroadcasterClient(socket, {\n      // console: this.console,\n      connect: (connection) => {\n        const now = Date.now();\n\n        const safeWriteData = (chunk: StreamChunk, prebuffer?: boolean) => {\n          if (options.filter) {\n            chunk = options.filter(chunk, prebuffer);\n            if (!chunk)\n              return;\n          }\n          const buffered = connection.writeData(chunk);\n          if (buffered > 100000000) {\n            this.console.log('more than 100MB has been buffered, did downstream die? killing connection.', this.streamName);\n            cleanup();\n          }\n        }\n\n        const cleanup = () => {\n          session.removeListener(container, safeWriteData);\n          session.removeListener('killed', cleanup);\n          connection.destroy();\n        }\n\n        session.on(container, safeWriteData);\n        session.once('killed', cleanup);\n\n        const prebufferContainer: PrebufferStreamChunk[] = this.prebuffers[container];\n        // if the requested container or the source container is not rtsp, use an exact seek.\n        // this works better when the requested container is mp4, and rtsp is the source.\n        // if starting on a sync frame, ffmpeg will skip the first segment while initializing\n        // on live sources like rtsp. the buffer before the sync frame stream will be enough\n        // for ffmpeg to analyze and start up in time for the sync frame.\n        // may be worth considering playing with a few other things to avoid this:\n        // mpeg-ts as a container (would need to write a muxer)\n        // specifying the buffer before the sync frame with probesize.\n        // If h264 oddities are detected, assume ffmpeg will be used.\n        if (container !== 'rtsp' || !options.findSyncFrame || this.getLastH264Oddities()) {\n          for (const chunk of prebufferContainer) {\n            if (chunk.time < now - requestedPrebuffer)\n              continue;\n\n            safeWriteData(chunk, true);\n          }\n        }\n        else {\n          const parser = this.parsers[container];\n          const filtered = prebufferContainer.filter(pb => pb.time >= now - requestedPrebuffer);\n          let availablePrebuffers = parser.findSyncFrame(filtered);\n          if (!availablePrebuffers) {\n            this.console.warn('Unable to find sync frame in rtsp prebuffer.');\n            availablePrebuffers = [];\n          }\n          else {\n            this.console.log('Found sync frame in rtsp prebuffer.');\n          }\n          for (const prebuffer of availablePrebuffers) {\n            safeWriteData(prebuffer, true);\n          }\n        }\n\n        return cleanup;\n      }\n    })\n  }\n\n  async getVideoStream(findSyncFrame: boolean, options?: RequestMediaStreamOptions) {\n    if (options?.refresh === false && !this.parserSessionPromise)\n      throw new Error('Stream is currently unavailable and will not be started for this request. RequestMediaStreamOptions.refresh === false');\n\n    const startedParserSession = !this.parserSessionPromise;\n\n    this.ensurePrebufferSession();\n\n    const session = await this.parserSessionPromise;\n\n    let requestedPrebuffer = options?.prebuffer;\n    // if no prebuffer was requested, try to find a sync frame in the prebuffer.\n    // also do this if this request initiated the prebuffer: so, an explicit request for 0 prebuffer\n    // will still send the initial sync frame in the stream start. it may otherwise be missed\n    // if some time passes between the initial stream request and the actual pulling of the stream.\n    if (requestedPrebuffer == null || startedParserSession) {\n      // prebuffer search for remote streaming should be even more conservative than local network.\n      const defaultPrebuffer = options?.destination === 'remote' ? 2000 : 4000;\n      // try to gaurantee a sync frame, but don't search too much prebuffer to make it happen.\n      requestedPrebuffer = Math.min(defaultPrebuffer, this.getDetectedIdrInterval() || defaultPrebuffer);;\n    }\n\n    const { rtspMode, muxingMp4 } = this.getRebroadcastContainer();\n    const defaultContainer = rtspMode ? 'rtsp' : 'mpegts';\n\n    let container: PrebufferParsers = this.parsers[options?.container] ? options?.container as PrebufferParsers : defaultContainer;\n\n    const mediaStreamOptions: ResponseMediaStreamOptions = session.negotiateMediaStream(options);\n    let sdp = await this.sdp;\n    if (!mediaStreamOptions.video?.h264Info && this.usingScryptedParser) {\n      mediaStreamOptions.video ||= {};\n      mediaStreamOptions.video.h264Info = this.getLastH264Probe();\n    }\n\n    let socketPromise: Promise<Duplex>;\n    let url: string;\n    let urls: string[];\n    let filter: (chunk: StreamChunk, prebuffer: boolean) => StreamChunk;\n    let interleavePassthrough = false;\n    const interleavedMap = new Map<string, number>();\n    const serverPortMap = new Map<string, RtspTrack>();\n    let server: FileRtspServer;\n\n    if (container === 'rtsp') {\n      const parsedSdp = parseSdp(sdp);\n      const videoSection = parsedSdp.msections.find(msection => msection.codec && msection.codec === mediaStreamOptions.video?.codec) || parsedSdp.msections.find(msection => msection.type === 'video');\n      let audioSection = parsedSdp.msections.find(msection => msection.codec && msection.codec === mediaStreamOptions.audio?.codec) || parsedSdp.msections.find(msection => msection.type === 'audio');\n      if (mediaStreamOptions.audio === null)\n        audioSection = undefined;\n      parsedSdp.msections = parsedSdp.msections.filter(msection => msection === videoSection || msection === audioSection);\n      const filterPrebufferAudio = options?.prebuffer === undefined;\n      const videoCodec = parsedSdp.msections.find(msection => msection.type === 'video')?.codec;\n      sdp = parsedSdp.toSdp();\n      filter = (chunk, prebuffer) => {\n        // if no prebuffer is explicitly requested, don't send prebuffer audio\n        if (prebuffer && filterPrebufferAudio && chunk.type !== videoCodec)\n          return;\n\n        const channel = interleavedMap.get(chunk.type);\n        if (!interleavePassthrough) {\n          if (channel == undefined) {\n            const udp = serverPortMap.get(chunk.type);\n            if (udp)\n              server.sendTrack(udp.control, chunk.chunks[1], chunk.type.startsWith('rtcp-'));\n            return;\n          }\n\n          const chunks = chunk.chunks.slice();\n          const header = Buffer.from(chunks[0]);\n          header.writeUInt8(channel, 1);\n          chunks[0] = header;\n          chunk = {\n            startStream: chunk.startStream,\n            chunks,\n          }\n        }\n        else if (channel === undefined) {\n          return;\n        }\n\n        if (server.writeStream) {\n          server.writeRtpPayload(chunk.chunks[0], chunk.chunks[1]);\n          return;\n        }\n\n        return chunk;\n      }\n\n      const hostname = options?.route === 'internal' ? undefined : '0.0.0.0';\n\n      const clientPromise = await listenSingleRtspClient({\n        hostname,\n        createServer: duplex => {\n          sdp = addTrackControls(sdp);\n          server = new FileRtspServer(duplex, sdp);\n          server.writeConsole = this.console;\n          return server;\n        }\n      });\n\n      socketPromise = clientPromise.rtspServerPromise.then(async server => {\n        if (session.parserSpecific) {\n          const parserSpecific = session.parserSpecific as RtspSessionParserSpecific;\n          server.resolveInterleaved = msection => {\n            const channel = parserSpecific.interleaved.get(msection.codec);\n            return [channel, channel + 1];\n          }\n        }\n        // server.console = this.console;\n        await server.handlePlayback();\n        server.handleTeardown().catch(() => {}).finally(() => server.client.destroy());\n        for (const track of Object.values(server.setupTracks)) {\n          if (track.protocol === 'udp') {\n            serverPortMap.set(track.codec, track);\n            serverPortMap.set(`rtcp-${track.codec}`, track);\n            continue;\n          }\n          interleavedMap.set(track.codec, track.destination);\n          interleavedMap.set(`rtcp-${track.codec}`, track.destination + 1);\n        }\n\n        interleavePassthrough = session.parserSpecific && serverPortMap.size === 0;\n        return server.client;\n      })\n\n      url = clientPromise.url;\n      if (hostname) {\n        urls = await getUrlLocalAdresses(this.console, url);\n      }\n    }\n    else {\n      const client = await listenZeroSingleClient();\n      socketPromise = client.clientPromise;\n      url = client.url;\n    }\n\n    mediaStreamOptions.sdp = sdp;\n\n    const isActiveClient = options?.refresh !== false;\n\n    this.handleRebroadcasterClient({\n      findSyncFrame,\n      isActiveClient,\n      container,\n      requestedPrebuffer,\n      socketPromise,\n      session,\n      filter,\n    });\n\n    mediaStreamOptions.prebuffer = requestedPrebuffer;\n\n    const { reencodeAudio } = this.getAudioConfig();\n\n    if (this.audioDisabled) {\n      mediaStreamOptions.audio = null;\n    }\n    else if (reencodeAudio && muxingMp4) {\n      mediaStreamOptions.audio = {\n        codec: 'aac',\n        encoder: 'aac',\n        profile: 'aac_low',\n      }\n    }\n\n    if (session.inputVideoResolution?.width && session.inputVideoResolution?.height) {\n      // this may be an audio only request.\n      if (mediaStreamOptions.video)\n        Object.assign(mediaStreamOptions.video, session.inputVideoResolution);\n    }\n\n    const now = Date.now();\n    let available = 0;\n    const prebufferContainer: PrebufferStreamChunk[] = this.prebuffers[container];\n    for (const prebuffer of prebufferContainer) {\n      if (prebuffer.time < now - requestedPrebuffer)\n        continue;\n      for (const chunk of prebuffer.chunks) {\n        available += chunk.length;\n      }\n    }\n    mediaStreamOptions.prebufferBytes = available;\n\n    const length = Math.max(500000, available).toString();\n\n    const inputArguments = [\n      '-analyzeduration', '0', '-probesize', length,\n    ];\n    if (!this.usingScryptedUdpParser)\n      inputArguments.push('-reorder_queue_size', '0');\n\n    const ffmpegInput: FFmpegInput = {\n      url,\n      urls,\n      container,\n      inputArguments: [\n        ...inputArguments,\n        ...(this.parsers[container].inputArguments || []),\n        '-f', this.parsers[container].container,\n        '-i', url,\n      ],\n      mediaStreamOptions,\n    }\n\n    return ffmpegInput;\n  }\n}\n\nclass PrebufferMixin extends SettingsMixinDeviceBase<VideoCamera> implements VideoCamera, Settings {\n  released = false;\n  sessions = new Map<string, PrebufferSession>();\n  streamSettings = createStreamSettings(this);\n  rtspServer: net.Server;\n  settingsListener: EventListenerRegister;\n\n  constructor(public getTranscodeStorageSettings: () => Promise<any>, options: SettingsMixinDeviceOptions<VideoCamera & VideoCameraConfiguration>) {\n    super(options);\n\n    this.delayStart();\n\n    this.startRtspServer();\n\n    this.settingsListener = systemManager.listenDevice(this.id, ScryptedInterface.Settings, () => this.ensurePrebufferSessions());\n  }\n\n  startRtspServer() {\n    closeQuiet(this.rtspServer);\n\n    this.rtspServer = new net.Server(async (client) => {\n      this.console.log('external rtsp client', client.localAddress, client.localPort);\n\n      let prebufferSession: PrebufferSession;\n\n      const server = new RtspServer(client, undefined, false, async (method, url, headers, rawMessage) => {\n        server.checkRequest = undefined;\n\n        const u = new URL(url);\n\n        for (const session of this.sessions.values()) {\n          if (u.pathname === '/' + session.rtspServerPath) {\n            server.console = session.console;\n            prebufferSession = session;\n            prebufferSession.ensurePrebufferSession();\n            await prebufferSession.parserSessionPromise;\n            server.sdp = await prebufferSession.sdp;\n            return true;\n          }\n          if (u.pathname === '/' + session.rtspServerMutedPath) {\n            server.console = session.console;\n            prebufferSession = session;\n            prebufferSession.ensurePrebufferSession();\n            await prebufferSession.parserSessionPromise;\n            const sdp = parseSdp(await prebufferSession.sdp);\n            sdp.msections = sdp.msections.filter(msection => msection.type === 'video');\n            server.sdp = sdp.toSdp();\n            return true;\n          }\n        }\n\n        return false;\n      });\n\n      this.console.log('RTSP Rebroadcast connection started.')\n      server.console = this.console;\n\n      try {\n        await server.handlePlayback();\n        const map = new Map<string, string>();\n        for (const [id, track] of Object.entries(server.setupTracks)) {\n          map.set(track.codec, id);\n        }\n        const session = await prebufferSession.parserSessionPromise;\n\n        const requestedPrebuffer = Math.max(4000, prebufferSession.getDetectedIdrInterval() || 4000);;\n\n        prebufferSession.handleRebroadcasterClient({\n          findSyncFrame: true,\n          isActiveClient: true,\n          container: 'rtsp',\n          session,\n          socketPromise: Promise.resolve(client),\n          requestedPrebuffer,\n          filter: (chunk, prebuffer) => {\n            const track = map.get(chunk.type);\n            if (track)\n              server.sendTrack(track, chunk.chunks[1], false);\n            return undefined;\n          }\n        });\n\n        await server.handleTeardown();\n      }\n      catch (e) {\n        client.destroy();\n      }\n      this.console.log('RTSP Rebroadcast connection finished.')\n    });\n\n    this.rtspServer.listen(this.streamSettings.storageSettings.values.rebroadcastPort || 0);\n\n    once(this.rtspServer, 'listening').then(() => {\n      const port = (this.rtspServer.address() as AddressInfo).port;\n      this.streamSettings.storageSettings.values.rebroadcastPort = port;\n    })\n  }\n\n  delayStart() {\n    this.console.log('prebuffer sessions starting in 5 seconds');\n    // to prevent noisy startup/reload/shutdown, delay the prebuffer starting.\n    setTimeout(() => this.ensurePrebufferSessions(), 5000);\n  }\n\n  async getVideoStream(options?: RequestMediaStreamOptions): Promise<MediaObject> {\n    if (options?.route === 'direct')\n      return this.mixinDevice.getVideoStream(options);\n\n    await this.ensurePrebufferSessions();\n\n    let id = options?.id;\n    if (!this.sessions.has(id))\n      id = undefined;\n    let h264EncoderArguments: string[];\n    let videoFilterArguments: string;\n    let destinationVideoBitrate: number;\n\n    const transcodingEnabled = this.mixins?.includes(getTranscodeMixinProviderId());\n\n    const msos = await this.mixinDevice.getVideoStreamOptions();\n    let result: {\n      stream: ResponseMediaStreamOptions,\n      isDefault: boolean,\n      title: string;\n    };\n\n    const transcodeStorageSettings = await this.getTranscodeStorageSettings();\n    const defaultLocalBitrate = 2000000;\n    const defaultLowResolutionBitrate = 512000;\n    if (!id) {\n      switch (options?.destination) {\n        case 'medium-resolution':\n        case 'remote':\n          result = this.streamSettings.getRemoteStream(msos);\n          destinationVideoBitrate = transcodeStorageSettings.remoteStreamingBitrate;\n          break;\n        case 'low-resolution':\n          result = this.streamSettings.getLowResolutionStream(msos);\n          destinationVideoBitrate = defaultLowResolutionBitrate;\n          break;\n        case 'local-recorder':\n          result = this.streamSettings.getRecordingStream(msos);\n          destinationVideoBitrate = defaultLocalBitrate;\n          break;\n        case 'remote-recorder':\n          result = this.streamSettings.getRemoteRecordingStream(msos);\n          destinationVideoBitrate = defaultLocalBitrate;\n          break;\n        case 'local':\n          result = this.streamSettings.getDefaultStream(msos);\n          destinationVideoBitrate = defaultLocalBitrate;\n          break;\n        default:\n          const width = options?.video?.width;\n          const height = options?.video?.height;\n          const max = Math.max(width, height);\n          if (max) {\n            if (max > 1280) {\n              result = this.streamSettings.getDefaultStream(msos);\n              destinationVideoBitrate = defaultLocalBitrate;\n            }\n            else if (max > 720) {\n              result = this.streamSettings.getRemoteStream(msos);\n              destinationVideoBitrate = transcodeStorageSettings.remoteStreamingBitrate;\n            }\n            else {\n              result = this.streamSettings.getLowResolutionStream(msos);\n              destinationVideoBitrate = defaultLowResolutionBitrate;\n            }\n          }\n          else {\n            result = this.streamSettings.getDefaultStream(msos);\n            destinationVideoBitrate = defaultLocalBitrate;\n          }\n          break;\n      }\n\n      id = result.stream.id;\n      this.console.log('Selected stream', result.stream.name);\n      // transcoding video should never happen transparently since it is CPU intensive.\n      // encourage users at every step to configure proper codecs.\n      // for this reason, do not automatically supply h264 encoder arguments\n      // even if h264 is requested, to force a visible failure.\n      if (transcodingEnabled && this.streamSettings.storageSettings.values.transcodeStreams?.includes(result.title)) {\n        h264EncoderArguments = transcodeStorageSettings.h264EncoderArguments?.split(' ');\n        if (this.streamSettings.storageSettings.values.videoFilterArguments)\n          videoFilterArguments = this.streamSettings.storageSettings.values.videoFilterArguments;\n      }\n    }\n\n    let session = this.sessions.get(id);\n    let ffmpegInput: FFmpegInput;\n    if (!session.canPrebuffer) {\n      this.console.log('Source container can not be prebuffered. Using a direct media stream.');\n      session = undefined;\n    }\n    if (!session) {\n      const mo = await this.mixinDevice.getVideoStream(options);\n      if (!transcodingEnabled)\n        return mo;\n      ffmpegInput = await mediaManager.convertMediaObjectToJSON(mo, ScryptedMimeTypes.FFmpegInput);\n    }\n    else {\n      // ffmpeg probing works better if the stream does NOT start on a sync frame. the pre-sps/pps data is used\n      // as part of the stream analysis, and sync frame is immediately used. otherwise the sync frame is\n      // read and tossed during rtsp analysis.\n      // if ffmpeg is not in used (ie, not transcoding or implicitly rtsp),\n      // trust that downstream is not using ffmpeg and start with a sync frame.\n      const findSyncFrame = !transcodingEnabled\n        && (!options?.container || options?.container === 'rtsp')\n        && options?.tool !== 'ffmpeg';\n      ffmpegInput = await session.getVideoStream(findSyncFrame, options);\n    }\n\n    ffmpegInput.h264EncoderArguments = h264EncoderArguments;\n    ffmpegInput.destinationVideoBitrate = destinationVideoBitrate;\n\n    if (transcodingEnabled && this.streamSettings.storageSettings.values.missingCodecParameters) {\n      if (!ffmpegInput.mediaStreamOptions)\n        ffmpegInput.mediaStreamOptions = { id };\n      ffmpegInput.mediaStreamOptions.oobCodecParameters = true;\n    }\n\n    if (ffmpegInput.h264FilterArguments && videoFilterArguments)\n      addVideoFilterArguments(ffmpegInput.h264FilterArguments, videoFilterArguments)\n    else if (videoFilterArguments)\n      ffmpegInput.h264FilterArguments = ['-filter_complex', videoFilterArguments];\n\n    if (transcodingEnabled)\n      ffmpegInput.videoDecoderArguments = this.streamSettings.storageSettings.values.videoDecoderArguments?.split(' ');\n    return mediaManager.createFFmpegMediaObject(ffmpegInput, {\n      sourceId: this.id,\n    });\n  }\n\n  async ensurePrebufferSessions() {\n    const msos = await this.mixinDevice.getVideoStreamOptions();\n    const enabled = this.getPrebufferedStreams(msos);\n    const enabledIds = enabled ? enabled.map(mso => mso.id) : [undefined];\n    const ids = msos?.map(mso => mso.id) || [undefined];\n\n    if (this.storage.getItem('warnedCloud') !== 'true') {\n      const cloud = msos?.find(mso => mso.source === 'cloud');\n      if (cloud) {\n        this.storage.setItem('warnedCloud', 'true');\n        log.a(`${this.name} is a cloud camera. Prebuffering maintains a persistent stream and will not enabled by default. You must enable the Prebuffer stream manually.`)\n      }\n    }\n\n    const isBatteryPowered = this.mixinDeviceInterfaces.includes(ScryptedInterface.Battery);\n\n    if (!enabledIds.length)\n      this.online = true;\n\n    let active = 0;\n\n    // figure out the default stream and streams that may have been removed due to\n    // a config change.\n    const toRemove = new Set(this.sessions.keys());\n    toRemove.delete(undefined);\n    this.sessions.delete(undefined);\n\n    for (const id of ids) {\n      toRemove.delete(id);\n\n      let session = this.sessions.get(id);\n\n      if (session)\n        continue;\n\n      const mso = msos?.find(mso => mso.id === id);\n      if (mso?.prebuffer) {\n        log.a(`Prebuffer is already available on ${this.name}. If this is a grouped device, disable the Rebroadcast extension.`)\n      }\n      const name = mso?.name;\n      const enabled = enabledIds.includes(id);\n      const stopInactive = (isBatteryPowered && !mso.allowBatteryPrebuffer) || !enabled;\n      session = new PrebufferSession(this, mso, stopInactive);\n      this.sessions.set(id, session);\n\n      if (isBatteryPowered && !mso.allowBatteryPrebuffer) {\n        this.console.log('camera is battery powered, prebuffering and rebroadcasting will only work on demand.');\n        continue;\n      }\n\n      if (!enabled) {\n        this.console.log('stream', name, 'will be rebroadcast on demand.');\n        continue;\n      }\n\n      (async () => {\n        while (this.sessions.get(id) === session && !this.released) {\n          session.ensurePrebufferSession();\n          let wasActive = false;\n          try {\n            this.console.log('prebuffer session starting');\n            const ps = await session.parserSessionPromise;\n            this.console.log('prebuffer session started');\n            active++;\n            wasActive = true;\n            this.online = !!active;\n            await ps.killed;\n            this.console.error('prebuffer session ended');\n          }\n          catch (e) {\n            this.console.error('prebuffer session ended with error', e);\n          }\n          finally {\n            if (wasActive)\n              active--;\n            wasActive = false;\n            this.online = !!active;\n          }\n          this.console.log('restarting prebuffer session in 5 seconds');\n          await new Promise(resolve => setTimeout(resolve, 5000));\n        }\n        this.console.log('exiting prebuffer session (released or restarted with new configuration)');\n      })();\n    }\n\n    if (!this.sessions.has(undefined)) {\n      const defaultStreamName = this.streamSettings.storageSettings.values.defaultStream;\n      let defaultSession = this.sessions.get(msos?.find(mso => mso.name === defaultStreamName)?.id);\n      if (!defaultSession)\n        defaultSession = this.sessions.get(msos?.find(mso => mso.id === enabledIds[0])?.id);\n      if (!defaultSession)\n        defaultSession = this.sessions.get(msos?.find(mso => mso.id === ids?.[0])?.id);\n\n      if (defaultSession) {\n        this.sessions.set(undefined, defaultSession);\n        // this.console.log('Default Stream:', defaultSession.advertisedMediaStreamOptions.id, defaultSession.advertisedMediaStreamOptions.name);\n      }\n      else {\n        this.console.warn('Unable to find Default Stream?');\n      }\n    }\n\n    if (toRemove.size) {\n      this.console.log('Removing sessions due to config change', [...toRemove]);\n      for (const id of toRemove) {\n        const session = this.sessions.get(id);\n        this.sessions.delete(id);\n        session.release();\n      }\n    }\n  }\n\n  async getMixinSettings(): Promise<Setting[]> {\n    const settings: Setting[] = [];\n\n    settings.push(...await this.streamSettings.storageSettings.getSettings());\n\n    for (const session of new Set([...this.sessions.values()])) {\n      if (!session)\n        continue;\n      try {\n        settings.push(...await session.getMixinSettings());\n      }\n      catch (e) {\n        this.console.error('error in prebuffer session getMixinSettings', e);\n      }\n    }\n\n    return settings;\n  }\n\n  async putMixinSetting(key: string, value: SettingValue): Promise<void> {\n    if (this.streamSettings.storageSettings.settings[key])\n      await this.streamSettings.storageSettings.putSetting(key, value);\n    else\n      this.storage.setItem(key, value?.toString() || '');\n\n    // no prebuffer change necessary if the setting is a transcoding hint.\n    if (this.streamSettings.storageSettings.settings[key]?.group === 'Transcoding')\n      return;\n\n    const sessions = this.sessions;\n    this.sessions = new Map();\n\n    // kill and reinitiate the prebuffers.\n    for (const session of sessions.values()) {\n      session?.parserSessionPromise?.then(session => session.kill(new Error('rebroadcast settings changed')));\n    }\n    this.ensurePrebufferSessions();\n  }\n\n  getPrebufferedStreams(msos?: ResponseMediaStreamOptions[]) {\n    return this.streamSettings.getPrebufferedStreams(msos);\n  }\n\n  async getVideoStreamOptions(): Promise<ResponseMediaStreamOptions[]> {\n    const ret: ResponseMediaStreamOptions[] = await this.mixinDevice.getVideoStreamOptions() || [];\n    let enabledStreams = this.getPrebufferedStreams(ret);\n\n    const map = new Map<MediaStreamDestination, string>();\n    map.set('local', this.streamSettings.getDefaultStream(ret)?.stream?.id);\n    map.set('remote', this.streamSettings.getRemoteStream(ret)?.stream?.id);\n    map.set('medium-resolution', this.streamSettings.getRemoteRecordingStream(ret)?.stream?.id);\n    map.set('remote-recorder', this.streamSettings.getRemoteRecordingStream(ret)?.stream?.id);\n    map.set('local-recorder', this.streamSettings.getRecordingStream(ret)?.stream?.id);\n    map.set('low-resolution', this.streamSettings.getLowResolutionStream(ret)?.stream?.id);\n\n    for (const mso of ret) {\n      const session = this.sessions.get(mso.id);\n      if (session?.parserSession || enabledStreams.includes(mso))\n        mso.prebuffer = prebufferDurationMs;\n      if (session && !mso.video?.h264Info) {\n        mso.video ||= {};\n        mso.video.h264Info = session.getLastH264Probe();\n      }\n      if (!mso.destinations) {\n        mso.destinations = [];\n        for (const [k, v] of map.entries()) {\n          if (v === mso.id)\n            mso.destinations.push(k);\n        }\n      }\n    }\n\n    return ret;\n  }\n\n  async release() {\n    this.settingsListener.removeListener();\n    this.online = true;\n    super.release();\n    this.console.log('prebuffer session releasing if started');\n    this.released = true;\n    for (const session of this.sessions.values()) {\n      session?.release();\n    }\n  }\n}\n\nfunction millisUntilMidnight() {\n  var midnight = new Date();\n  midnight.setHours(24);\n  midnight.setMinutes(0);\n  midnight.setSeconds(0);\n  midnight.setMilliseconds(0);\n  return (midnight.getTime() - new Date().getTime());\n}\n\nexport class RebroadcastPlugin extends AutoenableMixinProvider implements MixinProvider, BufferConverter, Settings, DeviceProvider {\n  // no longer in use, but kept for future use.\n  storageSettings = new StorageSettings(this, {});\n  transcodeStorageSettings = new StorageSettings(this, {\n    remoteStreamingBitrate: {\n      title: 'Remote Streaming Bitrate',\n      type: 'number',\n      defaultValue: 1000000,\n      description: 'The bitrate to use when remote streaming. This setting will only be used when transcoding or adaptive bitrate is enabled on a camera.',\n      onPut() {\n        sdk.deviceManager.onDeviceEvent('transcode', ScryptedInterface.Settings, undefined);\n      },\n    },\n    h264EncoderArguments: {\n      title: 'H264 Encoder Arguments',\n      description: 'FFmpeg arguments used to encode h264 video. This is not camera specific and is used to setup the hardware accelerated encoder on your Scrypted server. This setting will only be used when transcoding is enabled on a camera.',\n      choices: Object.keys(getH264EncoderArgs()),\n      defaultValue: getDebugModeH264EncoderArgs().join(' '),\n      combobox: true,\n      mapPut: (oldValue, newValue) => getH264EncoderArgs()[newValue]?.join(' ') || newValue || getDebugModeH264EncoderArgs().join(' '),\n      onPut() {\n        sdk.deviceManager.onDeviceEvent('transcode', ScryptedInterface.Settings, undefined);\n      },\n    }\n  });\n  currentMixins = new Map<PrebufferMixin, {\n    worker: Worker,\n    id: string,\n  }>();\n\n  constructor(nativeId?: string) {\n    super(nativeId);\n\n    this.fromMimeType = 'x-scrypted/x-rfc4571';\n    this.toMimeType = ScryptedMimeTypes.FFmpegInput;\n\n    // trigger the prebuffer. do this on next tick\n    // to allow the mixins to spin up from this provider.\n    process.nextTick(() => {\n      for (const id of Object.keys(systemManager.getSystemState())) {\n        const device = systemManager.getDeviceById<VideoCamera>(id);\n        if (!device.mixins?.includes(this.id))\n          continue;\n        try {\n          device.getVideoStreamOptions();\n        }\n        catch (e) {\n          this.console.error('error triggering prebuffer', device.name, e);\n        }\n      }\n    });\n\n    // schedule restarts at 2am\n    const midnight = millisUntilMidnight();\n    const twoAM = midnight + 2 * 60 * 60 * 1000;\n    this.log.i(`Rebroadcaster scheduled for restart at 2AM: ${Math.round(twoAM / 1000 / 60)} minutes`)\n    setTimeout(() => deviceManager.requestRestart(), twoAM);\n\n    process.nextTick(() => {\n      deviceManager.onDeviceDiscovered({\n        nativeId: TRANSCODE_MIXIN_PROVIDER_NATIVE_ID,\n        name: 'Transcoding',\n        interfaces: [\n          \"SystemSettings\",\n          ScryptedInterface.Settings,\n          ScryptedInterface.MixinProvider,\n        ],\n        type: ScryptedDeviceType.API,\n      });\n    });\n  }\n\n  async releaseDevice(id: string, nativeId: string): Promise<void> {\n  }\n\n  async getDevice(nativeId: string) {\n    if (nativeId === TRANSCODE_MIXIN_PROVIDER_NATIVE_ID)\n      return new TranscodeMixinProvider(this);\n  }\n\n  getSettings(): Promise<Setting[]> {\n    return this.storageSettings.getSettings();\n  }\n\n  putSetting(key: string, value: SettingValue): Promise<void> {\n    return this.storageSettings.putSetting(key, value);\n  }\n\n\n  async convert(data: Buffer, fromMimeType: string, toMimeType: string): Promise<Buffer> {\n    const json = JSON.parse(data.toString());\n    const { url, sdp } = json;\n\n    const parsedSdp = parseSdp(sdp);\n    const trackLookups = new Map<number, string>();\n    for (const msection of parsedSdp.msections) {\n      for (const pt of msection.payloadTypes) {\n        trackLookups.set(pt, msection.control);\n      }\n    }\n\n    const u = new URL(url);\n    if (!u.protocol.startsWith('tcp'))\n      throw new Error('rfc4751 url must be tcp');\n    const { clientPromise, url: clientUrl } = await listenZeroSingleClient();\n    const ffmpeg: FFmpegInput = {\n      url: clientUrl,\n      inputArguments: [\n        \"-rtsp_transport\", \"tcp\",\n        '-i', clientUrl.replace('tcp', 'rtsp'),\n      ]\n    };\n\n    clientPromise.then(async (client) => {\n      const rtsp = new RtspServer(client, sdp);\n      rtsp.console = this.console;\n      await rtsp.handlePlayback();\n      const socket = net.connect(parseInt(u.port), u.hostname);\n\n      client.on('close', () => {\n        socket.destroy();\n      });\n      socket.on('close', () => {\n        client.destroy();\n      })\n\n      while (true) {\n        const header = await readLength(socket, 2);\n        const length = header.readInt16BE(0);\n        const data = await readLength(socket, length);\n        const pt = data[1] & 0x7f;\n        const track = trackLookups.get(pt);\n        if (!track) {\n          client.destroy();\n          socket.destroy();\n          throw new Error('unknown payload type ' + pt);\n        }\n        rtsp.sendTrack(track, data, false);\n      }\n    });\n\n    return Buffer.from(JSON.stringify(ffmpeg));\n  }\n\n  async shouldEnableMixin(device: ScryptedDevice): Promise<boolean> {\n    return device.type === ScryptedDeviceType.Camera || device.type === ScryptedDeviceType.Doorbell;\n  }\n\n  async canMixin(type: ScryptedDeviceType, interfaces: string[]): Promise<string[]> {\n    if (!interfaces.includes(ScryptedInterface.VideoCamera))\n      return null;\n    const ret = [ScryptedInterface.VideoCamera, ScryptedInterface.Settings, ScryptedInterface.Online, REBROADCAST_MIXIN_INTERFACE_TOKEN];\n    return ret;\n  }\n\n  async getMixin(mixinDevice: any, mixinDeviceInterfaces: ScryptedInterface[], mixinDeviceState: DeviceState) {\n    this.setHasEnabledMixin(mixinDeviceState.id);\n\n    // 8-11-2022\n    // old scrypted had a bug where mixin device state was not exposing properties like id correctly\n    // across rpc boundaries.\n    let fork = false;\n    try {\n      const info = await systemManager.getComponent('info');\n      const version = await info.getVersion();\n      fork = semver.gte(version, '0.2.5');\n    }\n    catch (e) {\n    }\n\n    const { id } = mixinDeviceState;\n\n    if (fork && sdk.fork && typeof mixinDeviceState.id === 'string') {\n      const forked = sdk.fork<RebroadcastPluginFork>();\n      const { worker } = forked;\n\n      try {\n        const result = await forked.result;\n        const mixin = await result.newPrebufferMixin(async () => this.transcodeStorageSettings.values, mixinDevice, mixinDeviceInterfaces, mixinDeviceState);\n        this.currentMixins.set(mixin, {\n          worker,\n          id,\n        });\n        return mixin;\n      }\n      catch (e) {\n        throw e;\n      }\n    }\n    else {\n      const ret = await newPrebufferMixin(async () => this.transcodeStorageSettings.values, mixinDevice, mixinDeviceInterfaces, mixinDeviceState);\n      this.currentMixins.set(ret, {\n        worker: undefined,\n        id,\n      });\n      return ret;\n    }\n  }\n\n  async releaseMixin(id: string, mixinDevice: PrebufferMixin) {\n    const worker = this.currentMixins.get(mixinDevice)?.worker;\n    this.currentMixins.delete(mixinDevice);\n    await mixinDevice.release().catch(() => { });\n    await sleep(1000);\n    worker?.terminate();\n  }\n}\n\nasync function newPrebufferMixin(getTranscodeStorageSettings: () => Promise<any>, mixinDevice: any, mixinDeviceInterfaces: ScryptedInterface[], mixinDeviceState: DeviceState) {\n  return new PrebufferMixin(getTranscodeStorageSettings, {\n    mixinDevice,\n    mixinDeviceState,\n    mixinProviderNativeId: undefined,\n    mixinDeviceInterfaces,\n    group: \"Streams\",\n    groupKey: \"prebuffer\",\n  })\n}\n\nclass RebroadcastPluginFork {\n  newPrebufferMixin = newPrebufferMixin;\n}\n\nexport async function fork() {\n  return new RebroadcastPluginFork();\n}\n\nexport default RebroadcastPlugin;\n","export const REBROADCAST_MIXIN_INTERFACE_TOKEN = 'mixin:@scrypted/prebuffer-mixin';\n","import { cloneDeep } from \"@scrypted/common/src/clone-deep\";\nimport { ParserOptions, ParserSession, setupActivityTimer } from \"@scrypted/common/src/ffmpeg-rebroadcast\";\nimport { read16BELengthLoop } from \"@scrypted/common/src/read-stream\";\nimport { findH264NaluType, H264_NAL_TYPE_SPS, RTSP_FRAME_MAGIC } from \"@scrypted/common/src/rtsp-server\";\nimport { parseSdp } from \"@scrypted/common/src/sdp-utils\";\nimport { sleep } from \"@scrypted/common/src/sleep\";\nimport { StreamChunk } from \"@scrypted/common/src/stream-parser\";\nimport { MediaStreamOptions, ResponseMediaStreamOptions } from \"@scrypted/sdk\";\nimport { parse as spsParse } from \"h264-sps-parser\";\nimport net from 'net';\nimport { EventEmitter, Readable } from \"stream\";\nimport { getSpsResolution } from \"./sps-resolution\";\n\nexport function negotiateMediaStream(sdp: string, mediaStreamOptions: MediaStreamOptions, inputVideoCodec: string, inputAudioCodec: string, requestMediaStream: MediaStreamOptions) {\n    const parsedSdp = parseSdp(sdp);\n    const ret: ResponseMediaStreamOptions = cloneDeep(mediaStreamOptions) || {\n        id: undefined,\n        name: undefined,\n    };\n\n    // if the source doesn't provide a video codec, dummy one up\n    if (ret.video === undefined)\n        ret.video = {};\n\n    // the requests does not want video\n    if (requestMediaStream?.video === null)\n        ret.video = null;\n\n    if (ret.video)\n        ret.video.codec = inputVideoCodec;\n\n    // some rtsp like unifi offer alternate audio tracks (aac and opus).\n    if (requestMediaStream?.audio?.codec && requestMediaStream?.audio?.codec !== inputAudioCodec) {\n        const alternateAudio = parsedSdp.msections.find(msection => msection.type === 'audio' && msection.codec === requestMediaStream?.audio?.codec);\n        if (alternateAudio) {\n            ret.audio = {\n                codec: requestMediaStream?.audio?.codec,\n            };\n\n            return ret;\n        }\n    }\n\n    // reported codecs may be wrong/cached/etc, so before blindly copying the audio codec info,\n    // verify what was found.\n    if (ret?.audio?.codec === inputAudioCodec) {\n        ret.audio = mediaStreamOptions?.audio;\n    }\n    else {\n        ret.audio = {\n            codec: inputAudioCodec,\n        }\n    }\n\n    return ret;\n}\n\nexport function connectRFC4571Parser(url: string) {\n    const u = new URL(url);\n    if (!u.protocol.startsWith('tcp'))\n        throw new Error('rfc4751 url must be tcp');\n\n    const socket = net.connect(parseInt(u.port), u.hostname);\n    return socket;\n}\n\nexport function startRFC4571Parser(console: Console, socket: Readable, sdp: string, mediaStreamOptions: ResponseMediaStreamOptions, options?: ParserOptions<\"rtsp\">): ParserSession<\"rtsp\"> {\n    let isActive = true;\n    const events = new EventEmitter();\n    // need this to prevent kill from throwing due to uncaught Error during cleanup\n    events.on('error', e => console.error('rebroadcast error', e));\n\n    const parsedSdp = parseSdp(sdp);\n    const audioSection = parsedSdp.msections.find(msection => msection.type === 'audio');\n    const videoSection = parsedSdp.msections.find(msection => msection.type === 'video');\n    const audioPt = audioSection?.payloadTypes?.[0];\n    const videoPt = videoSection?.payloadTypes?.[0];\n\n    const inputAudioCodec = audioSection?.codec;\n    const inputVideoCodec = videoSection.codec;\n\n    let sessionKilled: any;\n    const killed = new Promise<void>(resolve => {\n        sessionKilled = resolve;\n    });\n\n    const kill = (error?: Error) => {\n        if (isActive) {\n            events.emit('killed');\n            events.emit('error', error || new Error('killed'));\n        }\n        isActive = false;\n        sessionKilled();\n        socket.destroy();\n    };\n\n    socket.on('close', () => {\n        kill(new Error('rfc4751 socket closed'));\n    });\n    socket.on('error', e => {\n        kill(e);\n    });\n\n    const { resetActivityTimer } = setupActivityTimer('rtsp', kill, events, options?.timeout);\n\n    let inputVideoResolution: {\n        width: number;\n        height: number;\n    };\n\n    const sprop = videoSection\n        ?.fmtp?.[0]?.parameters?.['sprop-parameter-sets'];\n    const sdpSps = sprop?.split(',')?.[0];\n    // const sdpPps = sprop?.split(',')?.[1];\n\n    if (sdpSps) {\n        try {\n            const sps = Buffer.from(sdpSps, 'base64');\n            const parsedSps = spsParse(sps);\n            inputVideoResolution = getSpsResolution(parsedSps);\n            console.log('parsed sdp sps', parsedSps);\n        }\n        catch (e) {\n            console.warn('sdp sps parsing failed');\n        }\n    }\n\n    const start = () => {\n        // don't start parsing until next tick, to prevent missed packets.\n        read16BELengthLoop(socket, {\n            headerLength: 2,\n            skipHeader: undefined,\n            callback: (header, data) => {\n                let type: string;\n                const pt = data[1] & 0x7f;\n\n                const prefix = Buffer.alloc(2);\n                prefix[0] = RTSP_FRAME_MAGIC;\n                if (pt === audioPt) {\n                    prefix[1] = 0;\n                }\n                else if (pt === videoPt) {\n                    prefix[1] = 2;\n                }\n                header = Buffer.concat([prefix, header]);\n\n                if (pt === audioPt)\n                    type = inputAudioCodec;\n                else if (pt === videoPt)\n                    type = inputVideoCodec;\n\n                const chunk: StreamChunk = {\n                    chunks: [header, data],\n                    type,\n                };\n\n                if (!inputVideoResolution) {\n                    const sps = findH264NaluType(chunk, H264_NAL_TYPE_SPS);\n                    if (sps) {\n                        try {\n                            const parsedSps = spsParse(sps);\n                            inputVideoResolution = getSpsResolution(parsedSps);\n                            console.log(inputVideoResolution);\n                            console.log('parsed bitstream sps', parsedSps);\n                        }\n                        catch (e) {\n                            console.warn('sps parsing failed');\n                            inputVideoResolution = {\n                                width: NaN,\n                                height: NaN,\n                            }\n                        }\n                    }\n                }\n\n                events.emit('rtsp', chunk);\n                resetActivityTimer();\n            }\n        })\n            .catch(e => {\n                throw e;\n            })\n            .finally(() => {\n                kill(new Error('parser exited'));\n            });\n    };\n\n\n\n    return {\n        start,\n        sdp: Promise.resolve([Buffer.from(sdp)]),\n        inputAudioCodec,\n        inputVideoCodec,\n        get inputVideoResolution() {\n            return inputVideoResolution;\n        },\n        get isActive() { return isActive },\n        kill(error?: Error) {\n            kill(error);\n        },\n        killed,\n        resetActivityTimer,\n        negotiateMediaStream: (requestMediaStream) => {\n            return negotiateMediaStream(sdp, mediaStreamOptions, inputVideoCodec, inputAudioCodec, requestMediaStream);\n        },\n        emit(container: 'rtsp', chunk: StreamChunk) {\n            events.emit(container, chunk);\n            return this;\n        },\n        on(event: string, cb: any) {\n            events.on(event, cb);\n            return this;\n        },\n        once(event: any, cb: any) {\n            events.once(event, cb);\n            return this;\n        },\n        removeListener(event, cb) {\n            events.removeListener(event, cb);\n            return this;\n        }\n    }\n}\n","import { ParserSession, setupActivityTimer } from \"@scrypted/common/src/ffmpeg-rebroadcast\";\nimport { closeQuiet, createBindZero } from \"@scrypted/common/src/listen-cluster\";\nimport { findH264NaluType, H264_NAL_TYPE_SPS, parseSemicolonDelimited, RtspClient, RtspClientUdpSetupOptions, RTSP_FRAME_MAGIC } from \"@scrypted/common/src/rtsp-server\";\nimport { parseSdp } from \"@scrypted/common/src/sdp-utils\";\nimport { StreamChunk } from \"@scrypted/common/src/stream-parser\";\nimport { ResponseMediaStreamOptions } from \"@scrypted/sdk\";\nimport dgram from 'dgram';\nimport { parse as spsParse } from \"h264-sps-parser\";\nimport { EventEmitter } from \"stream\";\nimport { negotiateMediaStream } from \"./rfc4571\";\nimport { getSpsResolution } from \"./sps-resolution\";\n\nexport type RtspChannelCodecMapping = { [key: number]: string };\n\nexport interface RtspSessionParserSpecific {\n    interleaved: Map<string, number>;\n}\n\nexport async function startRtspSession(console: Console, url: string, mediaStreamOptions: ResponseMediaStreamOptions, options: {\n    useUdp: boolean,\n    audioSoftMuted: boolean,\n    rtspRequestTimeout: number,\n}): Promise<ParserSession<\"rtsp\">> {\n    let isActive = true;\n    const events = new EventEmitter();\n    // need this to prevent kill from throwing due to uncaught Error during cleanup\n    events.on('error', e => console.error('rebroadcast error', e));\n\n    let servers: dgram.Socket[] = [];\n    const rtspClient = new RtspClient(url);\n    rtspClient.console = console;\n    rtspClient.requestTimeout = options.rtspRequestTimeout;\n\n    const cleanupSockets = () => {\n        for (const server of servers) {\n            closeQuiet(server);\n        }\n        rtspClient.safeTeardown();\n    }\n\n    let sessionKilled: any;\n    const killed = new Promise<void>(resolve => {\n        sessionKilled = resolve;\n    });\n\n    const kill = (error?: Error) => {\n        if (isActive) {\n            events.emit('killed');\n            events.emit('error', error || new Error('killed'));\n        }\n        isActive = false;\n        sessionKilled();\n        cleanupSockets();\n    };\n\n    rtspClient.client.on('close', () => {\n        kill(new Error('rtsp socket closed'));\n    });\n    rtspClient.client.on('error', e => {\n        kill(e);\n    });\n\n    const { resetActivityTimer } = setupActivityTimer('rtsp', kill, events, options?.rtspRequestTimeout);\n\n    try {\n        await rtspClient.options();\n        const sdpResponse = await rtspClient.describe();\n        const contentBase = sdpResponse.headers['content-base'];\n        if (contentBase) {\n            const url = new URL(contentBase, rtspClient.url);\n            const existing = new URL(rtspClient.url);\n            for (const p of existing.searchParams) {\n                url.searchParams.append(p[0], p[1]);\n            }\n            url.username = existing.username;\n            url.password = existing.password;\n            rtspClient.url = url.toString();\n        }\n        let sdp = sdpResponse.body.toString().trim();\n        console.log('sdp', sdp);\n\n        const parsedSdp = parseSdp(sdp);\n        let channel = 0;\n        const mapping: RtspChannelCodecMapping = {};\n        let udpSessionTimeout: number;\n        const { useUdp } = options;\n        const checkUdpSessionTimeout = (headers: { [key: string]: string }) => {\n            if (useUdp && headers.session && !udpSessionTimeout) {\n                const sessionDict = parseSemicolonDelimited(headers.session);\n                udpSessionTimeout = parseInt(sessionDict['timeout']);\n            }\n        }\n\n        let parserSpecific: RtspSessionParserSpecific;\n        if (!useUdp) {\n            parserSpecific = {\n                interleaved: new Map(),\n            }\n        }\n\n        const doSetup = async (control: string, codec: string) => {\n            let udp: dgram.Socket;\n            if (useUdp) {\n                const rtspChannel = channel;\n\n                const setup: RtspClientUdpSetupOptions = {\n                    path: control,\n                    type: 'udp',\n                    onRtp: (header, data) => {\n                        const prefix = Buffer.alloc(4);\n                        prefix.writeUInt8(RTSP_FRAME_MAGIC, 0);\n                        prefix.writeUInt8(rtspChannel, 1);\n                        prefix.writeUInt16BE(data.length, 2);\n                        const chunk: StreamChunk = {\n                            chunks: [prefix, data],\n                            type: codec,\n                        };\n                        events.emit('rtsp', chunk);\n                        resetActivityTimer?.();\n                    },\n                };\n                const setupResult = await rtspClient.setup(setup);\n                udp = setup.dgram;\n                checkUdpSessionTimeout(setupResult.headers);\n\n                const punch = Buffer.alloc(1);\n                const transport = setupResult.headers['transport'];\n                const match = transport.match(/.*?server_port=([0-9]+)-([0-9]+)/);\n                const [_, rtp, rtcp] = match;\n                const rtpPort = parseInt(rtp);\n                // have seen some servers return a server_port 0. should watch for bad data in any case.\n                if (rtpPort) {\n                    const { hostname } = new URL(rtspClient.url);\n                    udp.send(punch, rtpPort, hostname)\n                }\n                mapping[channel] = codec;\n            }\n            else {\n                const setupResult = await rtspClient.setup({\n                    path: control,\n                    type: 'tcp',\n                    port: channel,\n                    onRtp: (header, data) => {\n                        const chunk: StreamChunk = {\n                            chunks: [header, data],\n                            type: codec,\n                        };\n                        events.emit('rtsp', chunk);\n                        resetActivityTimer?.();\n                    },\n                });\n\n                const resultChannel = setupResult.interleaved ? setupResult.interleaved.begin : channel;\n                mapping[resultChannel] = codec;\n                parserSpecific.interleaved.set(codec, resultChannel);\n            }\n\n            channel += 2;\n        }\n\n        let setupVideoSection = false;\n\n        parsedSdp.msections = parsedSdp.msections.filter(section => {\n            if (section.type === 'video') {\n                if (setupVideoSection) {\n                    console.warn('additional video section found. skipping.');\n                    return false;\n                }\n                setupVideoSection = true;\n            }\n            else if (section.type !== 'audio') {\n                console.warn('unknown section', section.type);\n                return false;\n            }\n            else if (options.audioSoftMuted) {\n                return false;\n            }\n            return true;\n        });\n\n        for (const section of parsedSdp.msections) {\n            await doSetup(section.control, section.codec)\n        }\n\n        // sdp may contain multiple audio/video sections. take only the first video section.\n        sdp = [...parsedSdp.header.lines, ...parsedSdp.msections.map(msection => msection.lines).flat()].join('\\r\\n');\n\n        // don't start parsing until next tick when this function returns to allow\n        // event handlers to be set prior to parsing.\n        const start = async () => {\n            try {\n                await rtspClient.play();\n                rtspClient.console = undefined;\n                await rtspClient.readLoop();\n            }\n            catch (e) {\n                kill(e);\n            }\n            finally {\n                kill(new Error('rtsp read loop exited'));\n            }\n        };\n\n        // this return block is intentional, to ensure that the remaining code happens sync.\n        return (() => {\n            const audioSection = parsedSdp.msections.find(msection => msection.type === 'audio');\n            const videoSection = parsedSdp.msections.find(msection => msection.type === 'video');\n\n            if (!videoSection)\n                throw new Error('SDP does not contain a video section!');\n\n            const inputAudioCodec = audioSection?.codec;\n            const inputVideoCodec = videoSection.codec;\n\n\n            let inputVideoResolution: {\n                width: number;\n                height: number;\n            };\n\n            const probeStart = Date.now();\n            const probe = (chunk: StreamChunk) => {\n                if (Date.now() - probeStart > 6000)\n                    events.removeListener('rtsp', probe);\n                const sps = findH264NaluType(chunk, H264_NAL_TYPE_SPS);\n                if (sps) {\n                    try {\n                        const parsedSps = spsParse(sps);\n                        inputVideoResolution = getSpsResolution(parsedSps);\n                        // console.log(inputVideoResolution);\n                        console.log('parsed bitstream sps', inputVideoResolution);\n                    }\n                    catch (e) {\n                        console.warn('sps parsing failed');\n                        inputVideoResolution = {\n                            width: NaN,\n                            height: NaN,\n                        }\n                    }\n                    events.removeListener('rtsp', probe);\n                }\n            }\n\n            if (!inputVideoResolution)\n                events.on('rtsp', probe);\n\n            const sprop = videoSection\n                ?.fmtp?.[0]?.parameters?.['sprop-parameter-sets'];\n            const sdpSps = sprop?.split(',')?.[0];\n            // const sdpPps = sprop?.split(',')?.[1];\n\n            if (sdpSps) {\n                try {\n                    const sps = Buffer.from(sdpSps, 'base64');\n                    const parsedSps = spsParse(sps);\n                    inputVideoResolution = getSpsResolution(parsedSps);\n                    console.log('parsed sdp sps', inputVideoResolution);\n                }\n                catch (e) {\n                    console.warn('sdp sps parsing failed');\n                }\n            }\n\n            return {\n                parserSpecific,\n                start,\n                sdp: Promise.resolve([Buffer.from(sdp)]),\n                inputAudioCodec,\n                inputVideoCodec,\n                get inputVideoResolution() {\n                    return inputVideoResolution;\n                },\n                get isActive() { return isActive },\n                kill(error?: Error) {\n                    kill(error);\n                },\n                killed,\n                resetActivityTimer,\n                negotiateMediaStream: (requestMediaStream) => {\n                    return negotiateMediaStream(sdp, mediaStreamOptions, inputVideoCodec, inputAudioCodec, requestMediaStream);\n                },\n                emit(container: 'rtsp', chunk: StreamChunk) {\n                    events.emit(container, chunk);\n                    return this;\n                },\n                on(event: string, cb: any) {\n                    events.on(event, cb);\n                    return this;\n                },\n                once(event: any, cb: any) {\n                    events.once(event, cb);\n                    return this;\n                },\n                removeListener(event, cb) {\n                    events.removeListener(event, cb);\n                    return this;\n                }\n            }\n        })();\n    }\n    catch (e) {\n        cleanupSockets();\n        throw e;\n    }\n}\n","import { SPSInfo } from \"h264-sps-parser\";\n\nexport function getSpsResolution(sps: SPSInfo) {\n    let SubWidthC: number;\n    let SubHeightC: number;\n\n    if (sps.chroma_format_idc == 0 && sps.color_plane_flag == 0) { //monochrome\n        SubWidthC = SubHeightC = 0;\n    }\n    else if (sps.chroma_format_idc == 1 && sps.color_plane_flag == 0) { //4:2:0 \n        SubWidthC = SubHeightC = 2;\n    }\n    else if (sps.chroma_format_idc == 2 && sps.color_plane_flag == 0) { //4:2:2 \n        SubWidthC = 2;\n        SubHeightC = 1;\n    }\n    else if (sps.chroma_format_idc == 3) { //4:4:4\n        if (sps.color_plane_flag == 0) {\n            SubWidthC = SubHeightC = 1;\n        }\n        else if (sps.color_plane_flag == 1) {\n            SubWidthC = SubHeightC = 0;\n        }\n    }\n\n    let PicWidthInMbs = sps.pic_width_in_mbs;\n\n    let PicHeightInMapUnits = sps.pic_height_in_map_units;\n    let FrameHeightInMbs = (2 - sps.frame_mbs_only_flag) * PicHeightInMapUnits;\n\n    let crop_left = 0;\n    let crop_right = 0;\n    let crop_top = 0;\n    let crop_bottom = 0;\n\n    if (sps.frame_cropping_flag) {\n        crop_left = sps.frame_cropping.left;\n        crop_right = sps.frame_cropping.right;\n        crop_top = sps.frame_cropping.top;\n        crop_bottom = sps.frame_cropping.bottom;\n    }\n\n    let width = PicWidthInMbs * 16 - SubWidthC * (crop_left + crop_right);\n    let height = FrameHeightInMbs * 16 - SubHeightC * (2 - sps.frame_mbs_only_flag) * (crop_top + crop_bottom);\n\n    return {\n        width,\n        height,\n    };\n}","import { getH264DecoderArgs } from \"@scrypted/common/src/ffmpeg-hardware-acceleration\";\nimport { StorageSetting, StorageSettings } from \"@scrypted/sdk/storage-settings\";\nimport { MixinDeviceBase, ResponseMediaStreamOptions, VideoCamera } from \"@scrypted/sdk\";\nimport { getTranscodeMixinProviderId } from \"./transcode-settings\";\n\nexport type StreamStorageSetting = StorageSetting & {\n    prefersPrebuffer: boolean,\n    preferredResolution: number,\n};\nexport type StreamStorageSettingsDict<T extends string> = { [key in T]: StreamStorageSetting };\n\n\nfunction getStreamTypes<T extends string>(storageSettings: StreamStorageSettingsDict<T>) {\n    return storageSettings;\n}\n\nfunction pickBestStream(msos: ResponseMediaStreamOptions[], resolution: number) {\n    if (!msos)\n        return;\n\n    let best: ResponseMediaStreamOptions;\n    let bestScore: number;\n    for (const mso of msos) {\n        const score = Math.abs(mso.video?.width * mso.video?.height - resolution);\n        if (!best || score < bestScore) {\n            best = mso;\n            bestScore = score;\n            if (Number.isNaN(bestScore))\n                bestScore = Number.MAX_SAFE_INTEGER;\n        }\n    }\n\n    return best;\n}\n\nexport function createStreamSettings(device: MixinDeviceBase<VideoCamera>) {\n    const subgroup = \"Manage\";\n\n    const streamTypes = getStreamTypes({\n        defaultStream: {\n            subgroup,\n            title: 'Local Stream',\n            description: 'The media stream to use when streaming on your local network. This stream should be prebuffered. Recommended resolution: 1920x1080 to 4K.',\n            hide: true,\n            prefersPrebuffer: false,\n            preferredResolution: 3840 * 2160,\n        },\n        remoteStream: {\n            subgroup,\n            title: 'Remote (Medium Resolution) Stream',\n            description: 'The media stream to use when streaming from outside your local network. Selecting a low birate stream is recommended. Recommended resolution: 1280x720.',\n            hide: true,\n            prefersPrebuffer: false,\n            preferredResolution: 1280 * 720,\n        },\n        lowResolutionStream: {\n            subgroup,\n            title: 'Low Resolution Stream',\n            description: 'The media stream to use for low resolution output, such as Apple Watch and Video Analysis. Recommended resolution: 480x360.',\n            hide: true,\n            prefersPrebuffer: false,\n            preferredResolution: 480 * 360,\n        },\n        recordingStream: {\n            subgroup,\n            title: 'Local Recording Stream',\n            description: 'The media stream to use when recording to local storage such as an NVR. Recommended resolution: 1920x1080 to 4K.',\n            hide: true,\n            // will be automatically prebuferred when in use, but doesn't really need it.\n            prefersPrebuffer: false,\n            preferredResolution: 3840 * 2160,\n        },\n        remoteRecordingStream: {\n            subgroup,\n            title: 'Remote Recording Stream',\n            description: 'The media stream to use when recording to cloud storage such as HomeKit Secure Video clips in iCloud. This stream should be prebuffered. Recommended resolution: 1280x720.',\n            hide: true,\n            prefersPrebuffer: true,\n            preferredResolution: 2560 * 1440,\n        },\n    });\n\n    const storageSettings = new StorageSettings(device, {\n        enabledStreams: {\n            subgroup,\n            title: 'Prebuffered Streams',\n            description: 'Prebuffering maintains an active connection to the stream and improves load times. Prebuffer also retains the recent video for capturing motion events with HomeKit Secure video. Enabling Prebuffer is not recommended on Cloud cameras.',\n            multiple: true,\n            hide: false,\n        },\n        ...streamTypes,\n        rebroadcastPort: {\n            subgroup,\n            title: 'Rebroadcast Port',\n            description: 'The port of the RTSP server that will rebroadcast your streams.',\n            type: 'number',\n            hide: false,\n        },\n        transcodeStreams: {\n            group: 'Transcoding',\n            title: 'Transcode Streams',\n            description: 'The media streams to transcode. Transcoding audio and video is not recommended and should only be used when necessary. The Rebroadcast Plugin manages the system-wide Transcode settings. See the Rebroadcast Readme for optimal configuration.',\n            multiple: true,\n            choices: Object.values(streamTypes).map(st => st.title),\n            hide: true,\n        },\n        videoDecoderArguments: {\n            group: 'Transcoding',\n            title: 'Video Decoder Arguments',\n            description: 'FFmpeg arguments used to decode input video when transcoding a stream.',\n            placeholder: '-hwaccel auto',\n            choices: Object.keys(getH264DecoderArgs()),\n            combobox: true,\n            mapPut: (oldValue, newValue) => getH264DecoderArgs()[newValue]?.join(' ') || newValue || '',\n            hide: true,\n        },\n        videoFilterArguments: {\n            group: 'Transcoding',\n            title: 'Video Filter Arguments',\n            description: 'FFmpeg arguments used to filter input video when transcoding a stream. This can be used to crops, scale, rotates, etc.',\n            placeholder: 'transpose=1',\n            hide: true,\n        },\n        // 3/6/2022\n        // Ran into an issue where the RTSP source had SPS/PPS in the SDP,\n        // and none in the bitstream. Codec copy will not add SPS/PPS before IDR frames\n        // unless this flag is used.\n        // 3/7/2022\n        // This flag was enabled by default, but I believe this is causing issues with some users.\n        // Make it a setting.\n        missingCodecParameters: {\n            group: 'Transcoding',\n            title: 'Out of Band Codec Parameters',\n            description: 'Some cameras do not include H264 codec parameters in the stream and this causes live streaming to always fail (but recordings may be working). This is a inexpensive video filter and does not perform a transcode. Enable this setting only as necessary.',\n            type: 'boolean',\n            hide: true,\n        },\n    });\n\n    function getDefaultPrebufferedStreams(msos: ResponseMediaStreamOptions[]) {\n        if (!msos)\n            return;\n\n        const local = getMediaStream(storageSettings.keys.defaultStream, msos);\n        const remoteRecording = getMediaStream(storageSettings.keys.remoteRecordingStream, msos);\n\n        if (!local?.stream || local.stream.source === 'cloud')\n            return [];\n\n        if (local.stream.id === remoteRecording.stream.id)\n            return [local.stream];\n        return [local.stream, remoteRecording.stream];\n    }\n\n    function getPrebufferedStreams(msos: ResponseMediaStreamOptions[]) {\n        if (!msos)\n            return;\n\n        if (!storageSettings.hasValue.enabledStreams)\n            return getDefaultPrebufferedStreams(msos);\n\n        return msos.filter(mso => storageSettings.values.enabledStreams.includes(mso.name));\n    }\n\n\n    function getDefaultMediaStream(v: StreamStorageSetting, msos: ResponseMediaStreamOptions[]) {\n        return pickBestStream(msos, v.preferredResolution);\n    }\n\n    function getMediaStream(key: string, msos: ResponseMediaStreamOptions[]) {\n        const v: StreamStorageSetting = storageSettings.settings[key];\n        const value = storageSettings.values[key];\n        let isDefault = value === 'Default';\n        let stream = msos?.find(mso => mso.name === value);\n        if (isDefault || !stream) {\n            isDefault = true;\n            stream = getDefaultMediaStream(v, msos);\n        }\n        return {\n            title: streamTypes[key].title,\n            isDefault,\n            stream,\n        };\n    };\n\n    function createStreamOptions(v: StreamStorageSetting, msos: ResponseMediaStreamOptions[]) {\n        const choices = [\n            'Default',\n            ...msos.map(mso => mso.name),\n        ];\n        const defaultValue = getDefaultMediaStream(v, msos).name;\n\n        const streamOptions = {\n            defaultValue: 'Default',\n            description: v.description + ` The default for this stream is ${defaultValue}.`,\n            choices,\n            hide: false,\n        };\n        return streamOptions;\n    }\n\n    storageSettings.options = {\n        onGet: async () => {\n            let enabledStreams: StorageSetting;\n\n            const hideTranscode = device.mixins?.includes(getTranscodeMixinProviderId()) ? {\n                hide: false,\n            } : {};\n            const hideTranscodes = {\n                transcodeStreams: hideTranscode,\n                missingCodecParameters: hideTranscode,\n                videoDecoderArguments: hideTranscode,\n                videoFilterArguments: hideTranscode,\n            };\n\n            try {\n                const msos = await device.mixinDevice.getVideoStreamOptions();\n\n                enabledStreams = {\n                    defaultValue: getDefaultPrebufferedStreams(msos)?.map(mso => mso.name || mso.id),\n                    choices: msos.map((mso, index) => mso.name || mso.id),\n                    hide: false,\n                };\n\n                if (msos?.length > 1) {\n                    return {\n                        enabledStreams,\n                        defaultStream: createStreamOptions(streamTypes.defaultStream, msos),\n                        remoteStream: createStreamOptions(streamTypes.remoteStream, msos),\n                        lowResolutionStream: createStreamOptions(streamTypes.lowResolutionStream, msos),\n                        recordingStream: createStreamOptions(streamTypes.recordingStream, msos),\n                        remoteRecordingStream: createStreamOptions(streamTypes.remoteRecordingStream, msos),\n                        ...hideTranscodes,\n                    }\n                }\n                else {\n                    return {\n                        enabledStreams,\n                        ...hideTranscodes,\n                    }\n                }\n            }\n            catch (e) {\n                device.console.error('error retrieving getVideoStreamOptions', e);\n            }\n\n            return {\n                ...hideTranscodes,\n            }\n        }\n    }\n\n    return {\n        getDefaultPrebufferedStreams,\n        getPrebufferedStreams,\n        getDefaultStream: (msos: ResponseMediaStreamOptions[]) => getMediaStream(storageSettings.keys.defaultStream, msos),\n        getRemoteStream: (msos: ResponseMediaStreamOptions[]) => getMediaStream(storageSettings.keys.remoteStream, msos),\n        getLowResolutionStream: (msos: ResponseMediaStreamOptions[]) => getMediaStream(storageSettings.keys.lowResolutionStream, msos),\n        getRecordingStream: (msos: ResponseMediaStreamOptions[]) => getMediaStream(storageSettings.keys.recordingStream, msos),\n        getRemoteRecordingStream: (msos: ResponseMediaStreamOptions[]) => getMediaStream(storageSettings.keys.remoteRecordingStream, msos),\n        storageSettings,\n    };\n}\n","import sdk, { MixinProvider, ScryptedDeviceBase, ScryptedDeviceType, ScryptedInterface, Setting, Settings, SettingValue } from \"@scrypted/sdk\";\nimport { RebroadcastPlugin } from \"./main\";\nimport { REBROADCAST_MIXIN_INTERFACE_TOKEN } from \"./rebroadcast-mixin-token\";\nconst { deviceManager } = sdk;\n\nexport const TRANSCODE_MIXIN_PROVIDER_NATIVE_ID = 'transcode';\n\nexport function getTranscodeMixinProviderId() {\n    if (!deviceManager.getNativeIds().includes(TRANSCODE_MIXIN_PROVIDER_NATIVE_ID))\n        return;\n    const transcodeMixin = deviceManager.getDeviceState(TRANSCODE_MIXIN_PROVIDER_NATIVE_ID);\n    return transcodeMixin?.id;\n}\n\nexport class TranscodeMixinProvider extends ScryptedDeviceBase implements MixinProvider, Settings {\n    constructor(public plugin: RebroadcastPlugin) {\n        super(TRANSCODE_MIXIN_PROVIDER_NATIVE_ID);\n    }\n\n    getSettings(): Promise<Setting[]> {\n        return this.plugin.transcodeStorageSettings.getSettings();\n    }\n\n    putSetting(key: string, value: SettingValue): Promise<void> {\n        return this.plugin.transcodeStorageSettings.putSetting(key, value);\n    }\n\n    async canMixin(type: ScryptedDeviceType, interfaces: string[]): Promise<string[]> {\n        if (!interfaces.includes(REBROADCAST_MIXIN_INTERFACE_TOKEN))\n            return;\n        return [\n            ScryptedInterface.Settings,\n        ];\n    }\n\n    invalidateSettings(id: string) {\n        process.nextTick(async () => {\n            for (const [mixin, v] of this.plugin.currentMixins.entries()) {\n                if (v.id === id)\n                    mixin?.onDeviceEvent(ScryptedInterface.Settings, undefined)\n            }\n        });\n    }\n\n    async getMixin(mixinDevice: any, mixinDeviceInterfaces: ScryptedInterface[], mixinDeviceState: { [key: string]: any; }): Promise<any> {\n        this.invalidateSettings(mixinDeviceState.id);\n        return mixinDevice;\n    }\n\n    async releaseMixin(id: string, mixinDevice: any): Promise<void> {\n        this.invalidateSettings(id);\n    }\n}\n","import { once } from 'events';\nimport net from 'net';\n\nexport class ListenZeroSingleClientTimeoutError extends Error {\n    constructor() {\n        super('timeout waiting for client')\n    }\n}\n\nexport async function listenZero(server: net.Server, hostname?: string) {\n    server.listen(0, hostname);\n    await once(server, 'listening');\n    return (server.address() as net.AddressInfo).port;\n}\n\nexport async function listenZeroSingleClient(hostname?: string) {\n    const server = new net.Server();\n    const port = await listenZero(server, hostname);\n\n    const clientPromise = new Promise<net.Socket>((resolve, reject) => {\n        const timeout = setTimeout(() => {\n            server.close();\n            reject(new ListenZeroSingleClientTimeoutError());\n        }, 30000)\n        server.on('connection', client => {\n            server.close();\n            clearTimeout(timeout);\n\n            resolve(client);\n        });\n    });\n\n    clientPromise.catch(() => { });\n\n    let host = hostname;\n    if (!host || host === '0.0.0.0')\n        host = '127.0.0.1';\n\n    return {\n        server,\n        url: `tcp://${host}:${port}`,\n        host,\n        port,\n        clientPromise,\n    }\n}\n","import { ChildProcess } from \"child_process\";\nimport process from 'process';\n\nconst filtered = [\n    'decode_slice_header error',\n    'no frame!',\n    'non-existing PPS',\n];\n\nexport function safeKillFFmpeg(cp: ChildProcess) {\n    if (!cp)\n        return;\n    // this will allow ffmpeg to send rtsp TEARDOWN etc\n    try {\n        cp.stdin.write('q\\n');\n    }\n    catch (e) {\n    }\n    setTimeout(() => {\n        cp.kill();\n        setTimeout(() => {\n            cp.kill('SIGKILL');\n        }, 2000);\n    }, 2000);\n}\n\nexport function ffmpegLogInitialOutput(console: Console, cp: ChildProcess, forever?: boolean, storage?: Storage) {\n    if (!console)\n        return;\n\n    const SCRYPTED_FFMPEG_NOISY = !!process.env.SCRYPTED_FFMPEG_NOISY || !!storage?.getItem('SCRYPTED_FFMPEG_NOISY');\n\n    function logger(log: (str: string) => void): (buffer: Buffer) => void {\n        const ret = (buffer: Buffer) => {\n            const str = buffer.toString();\n\n            for (const filter of filtered) {\n                if (str.indexOf(filter) !== -1)\n                    return;\n            }\n\n            if (!SCRYPTED_FFMPEG_NOISY && !forever && (str.indexOf('frame=') !== -1 || str.indexOf('size=') !== -1)) {\n                log(str);\n                log('video/audio detected, discarding further input');\n                cp.stdout.removeListener('data', ret);\n                cp.stderr.removeListener('data', ret);\n                return;\n            }\n\n            log(str);\n        }\n\n        return ret;\n    };\n    cp.stdout?.on('data', logger(console.log));\n    cp.stderr?.on('data', logger(console.error));\n    cp.on('exit', () => console.log('ffmpeg exited'));\n}\n\nexport function safePrintFFmpegArguments(console: Console, args: string[]) {\n    if (!console)\n        return;\n    const ret = [];\n    let redactNext = false;\n    for (const arg of args) {\n        try {\n            if (redactNext) {\n                const url = new URL(arg);\n                ret.push(`${url.protocol}[REDACTED]`)\n            }\n            else {\n                ret.push(arg);\n            }\n        }\n        catch (e) {\n            ret.push(arg);\n        }\n\n        // input arguments may contain passwords.\n        redactNext = arg === '-i';\n    }\n\n    console.log(ret.join(' '));\n}\n","export async function sleep(ms: number) {\n    await new Promise(resolve => setTimeout(resolve, ms));\n}\n","const realfs = __non_webpack_require__('realfs'); module.exports = realfs;","module.exports = require(\"child_process\");","module.exports = require(\"crypto\");","module.exports = require(\"dgram\");","module.exports = require(\"events\");","module.exports = require(\"fs\");","module.exports = require(\"net\");","module.exports = require(\"os\");","module.exports = require(\"process\");","module.exports = require(\"stream\");","module.exports = require(\"tls\");","module.exports = require(\"url\");","function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (typeof call === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _wrapNativeSuper(Class) { var _cache = typeof Map === \"function\" ? new Map() : undefined; _wrapNativeSuper = function _wrapNativeSuper(Class) { if (Class === null || !_isNativeFunction(Class)) return Class; if (typeof Class !== \"function\") { throw new TypeError(\"Super expression must either be null or a function\"); } if (typeof _cache !== \"undefined\") { if (_cache.has(Class)) return _cache.get(Class); _cache.set(Class, Wrapper); } function Wrapper() { return _construct(Class, arguments, _getPrototypeOf(this).constructor); } Wrapper.prototype = Object.create(Class.prototype, { constructor: { value: Wrapper, enumerable: false, writable: true, configurable: true } }); return _setPrototypeOf(Wrapper, Class); }; return _wrapNativeSuper(Class); }\n\nfunction _construct(Parent, args, Class) { if (_isNativeReflectConstruct()) { _construct = Reflect.construct; } else { _construct = function _construct(Parent, args, Class) { var a = [null]; a.push.apply(a, args); var Constructor = Function.bind.apply(Parent, a); var instance = new Constructor(); if (Class) _setPrototypeOf(instance, Class.prototype); return instance; }; } return _construct.apply(null, arguments); }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _isNativeFunction(fn) { return Function.toString.call(fn).indexOf(\"[native code]\") !== -1; }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nimport os from 'os';\n\nlet YError = function (_Error) {\n  _inherits(YError, _Error);\n\n  function YError(wrappedErrors, errorCode, ...params) {\n    var _this;\n\n    _classCallCheck(this, YError);\n\n    if (!(wrappedErrors instanceof Array)) {\n      params = ('undefined' === typeof errorCode ? [] : [errorCode]).concat(params);\n      errorCode = wrappedErrors;\n      wrappedErrors = [];\n    }\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(YError).call(this, errorCode));\n    _this.code = errorCode || 'E_UNEXPECTED';\n    _this.params = params;\n    _this.wrappedErrors = wrappedErrors;\n    _this.name = _this.toString();\n\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(_assertThisInitialized(_this), _this.constructor);\n    }\n\n    return _this;\n  }\n\n  _createClass(YError, [{\n    key: \"toString\",\n    value: function toString() {\n      return (this.wrappedErrors.length ? this.wrappedErrors[this.wrappedErrors.length - 1].stack + os.EOL : '') + this.constructor.name + ': ' + this.code + ' (' + this.params.join(', ') + ')';\n    }\n  }]);\n\n  return YError;\n}(_wrapNativeSuper(Error));\n\nYError.wrap = function yerrorWrap(err, errorCode, ...params) {\n  let yError = null;\n\n  const wrappedErrorIsACode = _looksLikeAYErrorCode(err.message);\n\n  const wrappedErrors = (err.wrappedErrors || []).concat(err);\n\n  if (!errorCode) {\n    if (wrappedErrorIsACode) {\n      errorCode = err.message;\n    } else {\n      errorCode = 'E_UNEXPECTED';\n    }\n  }\n\n  if (err.message && !wrappedErrorIsACode) {\n    params.push(err.message);\n  }\n\n  yError = new YError(wrappedErrors, errorCode, ...params);\n  return yError;\n};\n\nYError.cast = function yerrorCast(err, ...params) {\n  if (_looksLikeAYError(err)) {\n    return err;\n  }\n\n  return YError.wrap.apply(YError, [err].concat(params));\n};\n\nYError.bump = function yerrorBump(err, ...params) {\n  if (_looksLikeAYError(err)) {\n    return YError.wrap.apply(YError, [err, err.code].concat(err.params));\n  }\n\n  return YError.wrap.apply(YError, [err].concat(params));\n};\n\nfunction _looksLikeAYError(err) {\n  return err instanceof YError || err.constructor && err.constructor.name && err.constructor.name.endsWith('Error') && 'string' === typeof err.code && _looksLikeAYErrorCode(err.code) && err.params && err.params instanceof Array;\n}\n\nfunction _looksLikeAYErrorCode(str) {\n  return /^([A-Z0-9_]+)$/.test(str);\n}\n\nexport default YError;\n//# sourceMappingURL=index.mjs.map","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(6360);\n"],"names":["Object","defineProperty","exports","value","parseWWWAuthenticateHeader","header","authMechanisms","mechanisms","strict","result","some","authMechanism","indexOf","type","toLowerCase","data","parseWWWAuthenticateRest","substr","length","_yerror","default","parseAuthorizationHeader","parseAuthorizationRest","buildWWWAuthenticateHeader","buildWWWAuthenticateRest","buildAuthorizationHeader","buildAuthorizationRest","enumerable","get","_basic","_digest","_bearer","_interopRequireDefault","obj","__esModule","_utils","REQUIRED_WWW_AUTHENTICATE_KEYS","AUTHORIZED_WWW_AUTHENTICATE_KEYS","BASIC","rest","parseHTTPHeadersQuotedKeyValueSet","buildHTTPHeadersQuotedKeyValueSet","username","password","decodeHash","hash","computeHash","Buffer","from","toString","passwordParts","split","join","_default","AUTHORIZED_ERROR_CODES","error","_crypto","REQUIRED_AUTHORIZATION_KEYS","AUTHORIZED_AUTHORIZATION_KEYS","_computeHash","algorithm","str","hashsum","createHash","update","digest","ha1","realm","ha2","method","uri","nonce","nc","cnonce","qop","contents","authorizedKeys","requiredKeys","matches","trim","match","KEYVALUE_REGEXP","map","part","partPosition","pair","reduce","parsedValues","name","valuePosition","replace","_checkRequiredKeys","key","forEach","Bitstream","constructor","view","this","bitoffset","ExpGolomb","zeros","skip","byt","byteoffset","bit","getUint8","ExpGolomInit","code","SignedExpGolomb","readBit","readByte","high","readNibble","read5","readWord","tmp","getUint16","more_rbsp_data","l","byteLength","byte","found_bit","Number","isInteger","Math","log2","has_bit","bitstream_1","vui_1","scaling_list","stream","sizeOfScalingList","use_default","i","lastScale","nextScale","scalingList","j","parse","nalu","Error","DataView","buffer","byteOffset","profile_idc","profile_compatibility","level_idc","sps_id","chroma_format_idc","bit_depth_luma","bit_depth_chroma","color_plane_flag","qpprime_y_zero_transform_bypass_flag","seq_scaling_matrix_present_flag","scaling_list_4x4","scaling_list_8x8","use_default_scaling_matrix_4x4_flag","use_default_scaling_matrix_8x8_flag","limit","push","log2_max_frame_num","pic_order_cnt_type","delta_pic_order_always_zero_flag","offset_for_non_ref_pic","offset_for_top_to_bottom_field","offset_for_ref_frame","log2_max_pic_order_cnt_lsb","num_ref_frames_in_pic_order_cnt_cycle","max_num_ref_frames","gaps_in_frame_num_value_allowed_flag","pic_width_in_mbs","pic_height_in_map_units","frame_mbs_only_flag","mb_adaptive_frame_field_flag","direct_8x8_inference_flag","frame_cropping_flag","frame_cropping","flag","left","right","top","bottom","getFrameCropping","vui_parameters_present_flag","seq_scaling_matrix","vui_parameters","getVUIParams","hrd_parameters","hrd","cpb_cnt_minus1","cpb_cnt","bit_rate_scale","cpb_size_scale","bit_rate_value","cpb_size_value","cbr_flag","initial_cpb_removal_delay_length","cpb_removal_delay_length","dpb_output_delay_length","time_offset_length","vp","aspect_ratio_info_present_flag","aspect_ratio_idc","sar_width","sar_height","overscan_info_present_flag","overscan_appropriate_flag","video_signal_type_present_flag","video_format","video_full_range_flag","colour_description_present_flag","colour_primaries","transfer_characteristics","matrix_coefficients","chroma_loc_info_present_flag","chroma_sample_loc_type_top_field","chroma_sample_loc_type_bottom_field","timing_info_present_flag","num_units_in_tick","time_scale","fixed_frame_rate_flag","nal_hrd_parameters_present_flag","vcl_hrd_parameters_present_flag","hrd_params","low_delay_hrd_flag","pic_struct_present_flag","bitstream_restriction_flag","motion_vectors_over_pic_boundaries_flag","max_bytes_per_pic_denom","max_bits_per_mb_denom","log2_max_mv_length_horizontal","log2_max_mv_length_vertical","num_reorder_frames","max_dec_frame_buffering","Yallist","MAX","Symbol","LENGTH","LENGTH_CALCULATOR","ALLOW_STALE","MAX_AGE","DISPOSE","NO_DISPOSE_ON_SET","LRU_LIST","CACHE","UPDATE_AGE_ON_GET","naiveLength","self","doUse","node","hit","isStale","del","now","Date","unshiftNode","maxAge","diff","walker","tail","prev","delete","removeNode","Entry","forEachStep","fn","thisp","undefined","call","module","options","max","TypeError","Infinity","lc","stale","dispose","noDisposeOnSet","updateAgeOnGet","reset","mL","allowStale","mA","lengthCalculator","lC","itemCount","rforEach","head","next","keys","toArray","k","values","Map","dump","v","e","filter","h","dumpLru","set","len","has","item","unshift","peek","pop","load","arr","expiresAt","prune","ANY","Comparator","comp","parseOptions","loose","debug","semver","operator","version","r","re","t","COMPARATORLOOSE","COMPARATOR","m","SemVer","test","er","cmp","intersects","includePrerelease","Range","sameDirectionIncreasing","sameDirectionDecreasing","sameSemVer","differentDirectionsInclusive","oppositeDirectionsLessThan","oppositeDirectionsGreaterThan","range","raw","format","parseRange","c","first","isNullSet","isAny","comps","memoKey","cached","cache","hr","HYPHENRANGELOOSE","HYPHENRANGE","hyphenReplace","COMPARATORTRIM","comparatorTrimReplace","rangeList","TILDETRIM","tildeTrimReplace","CARETTRIM","caretTrimReplace","parseComparator","replaceGTE0","rangeMap","comparators","size","thisComparators","isSatisfiable","rangeComparators","every","thisComparator","rangeComparator","testSet","remainingComparators","slice","testComparator","otherComparator","replaceCarets","replaceTildes","replaceXRanges","replaceStars","isX","id","replaceTilde","TILDELOOSE","TILDE","_","M","p","pr","ret","replaceCaret","CARETLOOSE","CARET","z","replaceXRange","XRANGELOOSE","XRANGE","gtlt","xM","xm","xp","anyX","STAR","GTE0PRE","GTE0","incPr","$0","fM","fm","fp","fpr","fb","to","tM","tm","tp","tpr","tb","prerelease","allowed","major","minor","patch","MAX_LENGTH","MAX_SAFE_INTEGER","compareIdentifiers","LOOSE","FULL","num","build","compare","other","compareMain","comparePre","a","b","compareBuild","inc","release","identifier","isNaN","s","eq","neq","gt","gte","lt","lte","op","String","rtl","COERCERTL","exec","index","lastIndex","COERCE","versionA","versionB","version1","version2","v1","v2","hasPre","prefix","defaultResult","parsed","list","sort","internalRe","src","tokens","SEMVER_SPEC_VERSION","rcompareIdentifiers","valid","clean","rcompare","compareLoose","rsort","coerce","satisfies","toComparators","maxSatisfying","minSatisfying","minVersion","validRange","outside","gtr","ltr","simplifyRange","subset","MAX_SAFE_COMPONENT_LENGTH","process","env","NODE_DEBUG","args","console","numeric","anum","bnum","opts","o","R","createToken","isGlobal","RegExp","NUMERICIDENTIFIER","NUMERICIDENTIFIERLOOSE","NONNUMERICIDENTIFIER","PRERELEASEIDENTIFIER","PRERELEASEIDENTIFIERLOOSE","BUILDIDENTIFIER","MAINVERSION","PRERELEASE","BUILD","FULLPLAIN","MAINVERSIONLOOSE","PRERELEASELOOSE","LOOSEPLAIN","XRANGEIDENTIFIER","XRANGEIDENTIFIERLOOSE","GTLT","XRANGEPLAIN","XRANGEPLAINLOOSE","LONETILDE","LONECARET","r1","r2","versions","maxSV","rangeObj","min","minSV","minver","setMin","comparator","compver","hilo","gtfn","ltefn","ltfn","ecomp","low","ranges","simplified","original","simpleSubset","sub","dom","eqSet","Set","gtltComp","higher","lower","hasDomLT","hasDomGT","higherGT","lowerLT","add","needDomLTPre","needDomGTPre","sawNonNull","OUTER","simpleSub","simpleDom","isSub","prototype","iterator","arguments","insert","inserted","Node","create","pushNode","res","shift","forEachReverse","n","getReverse","mapReverse","initial","acc","reduceReverse","Array","toArrayReverse","sliceReverse","splice","start","deleteCount","nodes","reverse","__createBinding","k2","desc","getOwnPropertyDescriptor","writable","configurable","__exportStar","hasOwnProperty","MixinDeviceBase","ScryptedDeviceBase","index_1","DeviceBase","nativeId","super","storage","_storage","deviceManager","getDeviceStorage","log","_log","getDeviceLogger","_console","getDeviceConsole","async","mimeType","mediaManager","createMediaObject","sourceId","getMediaObjectConsole","mediaObject","getMixinConsole","_lazyLoadDeviceState","_deviceState","getDeviceState","onDeviceEvent","eventInterface","eventData","_listeners","systemManager","getDeviceById","mixinDevice","mixinDeviceInterfaces","mixinStorageSuffix","mixinDeviceState","__rpcproxy_traps_all_properties","createDeviceState","setState","mixinProviderNativeId","mixinStorageKey","getMixinStorage","onMixinEvent","manageListener","listener","removeListener","_createGetState","state","_createSetState","warn","field","ScryptedInterfaceProperty","sdk","runtimeAPI","pluginRuntimeAPI","assign","endpointManager","pluginHostAPI","setScryptedInterfaceDescriptors","TYPES_VERSION","ScryptedInterfaceDescriptors","catch","__setModuleDefault","__importStar","mod","StorageSettings","_1","device","settings","hasValue","setting","rawGet","getItem","JSON","putSetting","onGet","entries","hide","getItemInternal","onPut","mapPut","mapGet","oldValue","putSettingInternal","noStore","setItem","stringify","ScryptedInterface","Settings","rawDevice","readDefaultValue","multiple","parseFloat","parseInt","json","parseValue","persistedDefaultValue","defaultValue","ScryptedMimeTypes","MediaPlayerState","SecuritySystemObstruction","SecuritySystemMode","AirQuality","ChargeState","LockState","PanTiltZoomMovement","ThermostatMode","TemperatureUnit","FanMode","HumidityMode","ScryptedDeviceType","ScryptedInterfaceMethod","ScryptedDevice","methods","properties","ScryptedPlugin","OnOff","Brightness","ColorSettingTemperature","ColorSettingRgb","ColorSettingHsv","Notifier","StartStop","Pause","Dock","TemperatureSetting","Thermometer","HumiditySensor","Camera","Microphone","Display","VideoCamera","VideoRecorder","PanTiltZoom","EventRecorder","VideoClips","VideoCameraConfiguration","Intercom","Lock","PasswordStore","Scene","EntrySensor","DeviceProvider","DeviceDiscovery","DeviceCreator","Battery","Charger","Refresh","MediaPlayer","Online","BufferConverter","BinarySensor","TamperSensor","PowerSensor","AudioSensor","MotionSensor","AmbientLightSensor","OccupancySensor","FloodSensor","UltravioletSensor","LuminanceSensor","PositionSensor","SecuritySystem","PM10Sensor","PM25Sensor","VOCSensor","NOXSensor","CO2Sensor","AirQualitySensor","Readme","OauthClient","MixinProvider","HttpRequestHandler","EngineIOHandler","PushHandler","Program","Scriptable","ObjectTracker","ObjectDetector","ObjectDetection","HumiditySetting","Fan","RTCSignalingChannel","RTCSignalingClient","LauncherApplication","ScryptedUser","VideoFrameGenerator","autoIncludeToken","AutoenableMixinProvider","hasEnabledMixin","unshiftMixin","pluginsComponent","getComponent","listen","eventSource","eventDetails","property","maybeEnableMixin","getSystemState","mixins","includes","canMixin","interfaces","shouldEnableMixin","plugins","setMixins","setHasEnabledMixin","finished","promise","Promise","resolve","reject","PI_MODEL_NO","isRaspberryPi","cpuInfo","encoding","model","line","entry","isPi","V4L2","platform","getDebugModeH264EncoderArgs","encoders","encoderArgs","encoder","videoArgs","videoFilter","filterName","filterIndex","findIndex","f","parseFragmentedMP4","readable","readLength","readInt32BE","FFMPEG_FRAGMENTED_MP4_OUTPUT_ARGS","inputArguments","audioOutputArgs","videoOutputArgs","safePrintFFmpegArguments","cp","spawn","getFFmpegPath","stdio","ffmpegLogInitialOutput","generator","parseResolution","on","parser","stdout","stderr","parseInputToken","token","idx","lastIndexOf","check","substring","next2","parseVideoCodec","parseAudioCodec","setupActivityTimer","container","kill","events","timeout","dataTimeout","lastTime","resetActivityTimer","setInterval","clearInterval","dataKill","once","clearActivityTimer","ffmpegInput","isActive","EventEmitter","inputAudioCodec","inputVideoCodec","inputVideoResolution","sessionKilled","killed","emit","safeKillFFmpeg","ensureActive","pipeCount","startParsers","parsers","tcpProtocol","tcp","listenZeroSingleClient","url","URL","port","outputArguments","socket","clientPromise","destroy","chunk","sdp","then","pipeIndex","pipe","width","height","negotiateMediaStream","cloneDeep","mediaStreamOptions","video","codec","audio","event","cb","writeData","chunks","write","writableLength","cleanupCallback","connection","startStream","connect","bindUdp","server","usePort","address","bind","createBindZero","socketType","createBindUdp","createSocket","close","udp","listenZero","ListenZeroSingleClientTimeoutError","rp","cacheDuration","finally","setTimeout","TimeoutError","clearTimeout","isTimedOut","current","func","keyStr","skipHeader","callback","offset","headerLength","skipCount","readCount","resumeRead","read","readUInt16BE","StreamEndError","readableEnded","destroyed","alloc","cleanup","CHARCODE_NEWLINE","charCodeAt","readUntil","charCode","count","resume","readMessage","client","currentHeaders","readLine","readBody","response","cl","writeMessage","messageLine","body","headers","message","findH264NaluType","streamChunk","naluType","findH264NaluTypeInNalu","subarray","checkNaluType","H264_NAL_TYPE_STAP_A","pos","naluLength","H264_NAL_TYPE_FU_A","fuaType","isFuStart","getNaluTypesInNalu","fuaRequireStart","fuaRequireEnd","stapaType","parseHeaders","getFirstAuthenticateHeader","parseSemicolonDelimited","dict","RTSP_FRAME_MAGIC","H264_NAL_TYPE_RESERVED0","H264_NAL_TYPE_RESERVED30","H264_NAL_TYPE_RESERVED31","H264_NAL_TYPE_IDR","H264_NAL_TYPE_SEI","H264_NAL_TYPE_SPS","H264_NAL_TYPE_PPS","H264_NAL_TYPE_STAP_B","H264_NAL_TYPE_FU_B","H264_NAL_TYPE_MTAP16","H264_NAL_TYPE_MTAP32","fua","fuaStart","fuaEnd","randomBytes","vcodec","acodec","findSyncFrame","streamChunks","foundIndex","nonVideo","createSyncFrame","prebufferIndex","duplex","RtspServer","handleSetup","rtcp","packet","handleRecord","RtspStatusError","status","RtspBase","cseq","needKeepAlive","setupOptions","issuedTeardown","hasGetParameter","u","startsWith","rejectUnauthorized","host","hostname","writeTeardown","sleep","writeRequest","path","fullUrl","endsWith","sanitized","wwwAuthenticate","createAuthorizationHeader","session","channel","readUInt8","onRtp","handleDataPayload","createBadHeader","getParameter","readDataPayload","deferred","Deferred","writeGetParameter","writeOptions","all","wwwAuth","authedUrl","decodeURIComponent","strippedUrl","params","authenticating","requestTimeout","timeoutPromise","statusLine","codeString","reason","request","publicHeader","Accept","protocol","dgram","closeQuiet","Transport","interleaved","sessionDict","timer","transport","begin","end","writePlay","writeRtpPayload","rtp","send","writeUInt8","writeUInt16BE","checkRequest","setupTracks","availableOptions","Socket","setNoDelay","destination","track","find","sendUdp","sendTrack","trackId","requestHeaders","respond","describe","setupInterleaved","msection","control","parseSdp","msections","resolveInterleaved","rtpServer","rtcpServer","play","rtpInfo","contentLength","sdpBuffer","allow","toUpperCase","pathToken","rtspServerPath","rtspServerPromise","rtspServer","createServer","pathname","addTrackControls","lines","trackCount","findTrackByType","directions","sections","getSections","section","returnTrack","controlString","dir","parseMLinePayloadTypes","mline","payloadTypes","pt","parseMLine","audioPort","videoPort","regex","outputSdp","payloadType","fmtpPrefix","fmtp","parseFmtp","fmtpLine","firstSpace","paramLine","parameters","param","parseRtpMap","mlineType","rtpmap","rawCodec","clock","acontrol","artpmap","parseMSection","rtpmapFirst","rtpmaps","direction","checkDirection","toSdp","flat","spspps","sps","pps","SettingsMixinDeviceBase","settingsGroup","group","settingsGroupKey","groupKey","nextTick","settingsPromise","getSettings","mixinSettingsPromise","getMixinSettings","allSettings","description","random","title","readonly","mixinSettings","putMixinSetting","parseMp4StreamChunks","ftyp","moov","atom","concat","verify","pending","pendingSize","remaining","chunkIndex","pkt","PIXEL_FORMAT_YUV420P","computeLength","PIXEL_FORMAT_RGB24","pixelFormat","everyNFrames","toRead","FileRtspServer","segmentBytesWritten","writeStream","writeConsole","ws","file","truncate","truncateWriteStream","d","open","fd","promises","rename","createWriteStream","writesize","urls","addresses","getLocalAddresses","DEFAULT_AUDIO","AAC_AUDIO","AAC_AUDIO_DESCRIPTION","COMPATIBLE_AUDIO","TRANSCODE_AUDIO","COMPATIBLE_AUDIO_CODECS","DEFAULT_FFMPEG_INPUT_ARGUMENTS","SCRYPTED_PARSER_TCP","SCRYPTED_PARSER_UDP","FFMPEG_PARSER_TCP","FFMPEG_PARSER_UDP","STRING_DEFAULT","VALID_AUDIO_CONFIGS","PrebufferParserValues","hasOddities","h264Info","fuab","mtap16","mtap32","sei","stapb","reserved0","reserved30","reserved31","PrebufferSession","mixin","advertisedMediaStreamOptions","stopInactive","prebuffers","mp4","mpegts","rtsp","usingScryptedParser","usingScryptedUdpParser","audioDisabled","activeClients","audioConfigurationKey","streamId","ffmpegInputArgumentsKey","rebroadcastModeKey","lastDetectedAudioCodecKey","lastH264ProbeKey","rtspParserKey","rtspServerPathKey","rtspServerMutedPathKey","rtspServerMutedPath","canPrebuffer","getLastH264Probe","getLastH264Oddities","getDetectedIdrInterval","durations","last","time","streamName","clearPrebuffers","prebuffer","parserSessionPromise","parserSession","ensurePrebufferSession","released","startPrebufferSession","pso","getAudioConfig","audioConfig","config","aacAudio","compatibleAudio","reencodeAudio","isUsingDefaultAudioConfig","canUseRtspParser","getParser","rtspMode","rtspParser","isDefault","getRebroadcastContainer","mode","muxingMp4","total","elapsed","bitrate","round","subgroup","placeholder","choices","addFFmpegAudioSettings","addFFmpegInputSettings","combobox","usingFFmpeg","canUseScryptedParser","scryptedOptions","currentParser","addOddities","resolution","idrInterval","streamSettings","storageSettings","rebroadcastPort","mso","getVideoStreamOptions","audioSoftMuted","advertisedAudioCodec","detectedAudioCodec","probingAudioCodec","assumedAudioCodec","audioIncompatible","userConfigurable","aacFilters","compatibleFilters","detectedNoAudio","mustTranscode","filters","rbo","createRtspParser","createMpegTsParser","createFragmentedMp4Parser","mo","getVideoStream","isRfc4571","sessionMso","removeItem","h264Oddities","convertMediaObjectToJSON","startRFC4571Parser","connectRFC4571Parser","buffers","moBuffer","convertMediaObjectToBuffer","FFmpegInput","tool","startRtspSession","useUdp","rtspRequestTimeout","extraInputArguments","startParserSession","h264Probe","reportedOddity","oddityProbe","types","getNaluTypes","removeOddityProbe","oddityTimeout","advertisedVideoCodec","inactivityTimeout","refreshAt","refreshTimeout","refreshStream","scheduleRefresh","refreshMso","when","shifts","prebufferContainer","printActiveClients","inactivityCheck","resetTimeout","isActiveClient","socketPromise","requestedPrebuffer","handleRebroadcasterClient","safeWriteData","filtered","pb","availablePrebuffers","refresh","startedParserSession","defaultPrebuffer","defaultContainer","interleavePassthrough","interleavedMap","serverPortMap","parsedSdp","videoSection","audioSection","filterPrebufferAudio","videoCodec","route","listenSingleRtspClient","parserSpecific","handlePlayback","handleTeardown","getUrlLocalAdresses","profile","available","prebufferBytes","PrebufferMixin","getTranscodeStorageSettings","sessions","createStreamSettings","delayStart","startRtspServer","settingsListener","listenDevice","ensurePrebufferSessions","Server","prebufferSession","localAddress","localPort","rawMessage","h264EncoderArguments","videoFilterArguments","destinationVideoBitrate","transcodingEnabled","getTranscodeMixinProviderId","msos","transcodeStorageSettings","defaultLocalBitrate","defaultLowResolutionBitrate","getRemoteStream","remoteStreamingBitrate","getLowResolutionStream","getRecordingStream","getRemoteRecordingStream","getDefaultStream","transcodeStreams","missingCodecParameters","oobCodecParameters","h264FilterArguments","addVideoFilterArguments","videoDecoderArguments","createFFmpegMediaObject","enabled","getPrebufferedStreams","enabledIds","ids","cloud","source","isBatteryPowered","online","active","toRemove","allowBatteryPrebuffer","wasActive","ps","defaultStreamName","defaultStream","defaultSession","enabledStreams","destinations","RebroadcastPlugin","getH264EncoderArgs","newValue","currentMixins","fromMimeType","toMimeType","twoAM","midnight","setHours","setMinutes","setSeconds","setMilliseconds","getTime","millisUntilMidnight","requestRestart","onDeviceDiscovered","TRANSCODE_MIXIN_PROVIDER_NATIVE_ID","API","TranscodeMixinProvider","trackLookups","clientUrl","ffmpeg","readInt16BE","Doorbell","REBROADCAST_MIXIN_INTERFACE_TOKEN","fork","info","getVersion","newPrebufferMixin","worker","forked","terminate","RebroadcastPluginFork","requestMediaStream","audioPt","videoPt","sprop","sdpSps","parsedSps","getSpsResolution","read16BELengthLoop","NaN","servers","rtspClient","RtspClient","cleanupSockets","safeTeardown","sdpResponse","contentBase","existing","searchParams","append","mapping","udpSessionTimeout","checkUdpSessionTimeout","doSetup","rtspChannel","setup","setupResult","punch","rtpPort","resultChannel","setupVideoSection","readLoop","probeStart","probe","SubWidthC","SubHeightC","PicWidthInMbs","PicHeightInMapUnits","FrameHeightInMbs","crop_left","crop_right","crop_top","crop_bottom","streamTypes","prefersPrebuffer","preferredResolution","remoteStream","lowResolutionStream","recordingStream","remoteRecordingStream","st","getH264DecoderArgs","getDefaultPrebufferedStreams","local","getMediaStream","remoteRecording","getDefaultMediaStream","best","bestScore","score","abs","pickBestStream","createStreamOptions","hideTranscode","hideTranscodes","getNativeIds","plugin","invalidateSettings","stdin","forever","SCRYPTED_FFMPEG_NOISY","logger","redactNext","arg","ms","realfs","require","_defineProperties","target","props","descriptor","_assertThisInitialized","ReferenceError","_wrapNativeSuper","Class","_cache","Function","Wrapper","_construct","_getPrototypeOf","_setPrototypeOf","Parent","_isNativeReflectConstruct","Reflect","construct","apply","instance","sham","Proxy","Boolean","valueOf","setPrototypeOf","__proto__","getPrototypeOf","YError","_Error","wrappedErrors","errorCode","_this","Constructor","_classCallCheck","captureStackTrace","protoProps","staticProps","subClass","superClass","_inherits","stack","_looksLikeAYError","err","_looksLikeAYErrorCode","wrap","yError","wrappedErrorIsACode","cast","bump","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","definition","prop","toStringTag","__webpack_exports__"],"sourceRoot":""}