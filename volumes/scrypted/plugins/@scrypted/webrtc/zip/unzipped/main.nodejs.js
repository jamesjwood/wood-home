/*! For license information please see main.nodejs.js.LICENSE.txt */
(()=>{var __webpack_modules__={6002:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseWWWAuthenticateHeader=function(e,t=c,{strict:r=!0}={strict:!0}){let n=null;if(t.some((t=>(0===e.indexOf(t.type+" ")||!r&&0===e.indexOf(t.type.toLowerCase()+" "))&&(n={type:t.type,data:t.parseWWWAuthenticateRest(e.substr(t.type.length+1))},!0))),!n)throw new i.default("E_UNKNOWN_AUTH_MECHANISM",e);return n},t.parseAuthorizationHeader=function(e,t=c,{strict:r=!0}={strict:!0}){let n=null;if(t.some((function(t){return(0===e.indexOf(t.type+" ")||!r&&0===e.indexOf(t.type.toLowerCase()+" "))&&(n={type:t.type,data:t.parseAuthorizationRest(e.substr(t.type.length+1))},!0)})),n)return n;throw new i.default("E_UNKNOWN_AUTH_MECHANISM",e)},t.buildWWWAuthenticateHeader=function(e,t){return`${e.type} ${e.buildWWWAuthenticateRest(t)}`},t.buildAuthorizationHeader=function(e,t){return`${e.type} ${e.buildAuthorizationRest(t)}`},Object.defineProperty(t,"BASIC",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"DIGEST",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"BEARER",{enumerable:!0,get:function(){return o.default}}),t.mechanisms=void 0;var i=a(r(8257)),n=a(r(6750)),s=a(r(3107)),o=a(r(736));function a(e){return e&&e.__esModule?e:{default:e}}const c=[n.default,s.default,o.default];t.mechanisms=c,n.default,s.default,o.default},6750:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,n=(i=r(8257))&&i.__esModule?i:{default:i},s=r(9358);const o=["realm"],a=o,c={type:"Basic",parseWWWAuthenticateRest:function(e){return(0,s.parseHTTPHeadersQuotedKeyValueSet)(e,a,o)},buildWWWAuthenticateRest:function(e){return(0,s.buildHTTPHeadersQuotedKeyValueSet)(e,a,o)},parseAuthorizationRest:function(e){if(!e)throw new n.default("E_EMPTY_AUTH");const{username:t,password:r}=c.decodeHash(e);return{hash:e,username:t,password:r}},buildAuthorizationRest:function({hash:e,username:t,password:r}){if(t&&r)return c.computeHash({username:t,password:r});if(!e)throw new n.default("E_NO_HASH");return e},computeHash:function({username:e,password:t}){return Buffer.from(e+":"+t).toString("base64")},decodeHash:function(e){const[t,...r]=Buffer.from(e,"base64").toString().split(":");return{username:t,password:r.join(":")}}};var u=c;t.default=u},736:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,n=(i=r(8257))&&i.__esModule?i:{default:i},s=r(9358);const o=["invalid_request","invalid_token","insufficient_scope"],a=["realm","scope","error","error_description"];var c={type:"Bearer",parseWWWAuthenticateRest:function(e){return(0,s.parseHTTPHeadersQuotedKeyValueSet)(e,a,[])},buildWWWAuthenticateRest:function(e){if(e.error&&-1===o.indexOf(e.error))throw new n.default("E_INVALID_ERROR",e.error,o);return(0,s.buildHTTPHeadersQuotedKeyValueSet)(e,a,[])},parseAuthorizationRest:function(e){if(!e)throw new n.default("E_EMPTY_AUTH");return{hash:e}},buildAuthorizationRest:function({hash:e}){if(!e)throw new n.default("E_NO_HASH");return e}};t.default=c},3107:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,n=r(9358),s=(i=r(6113))&&i.__esModule?i:{default:i};const o=["realm","nonce"],a=[...o,"domain","opaque","stale","algorithm","qop"],c=["username","realm","nonce","uri","response"],u=[...c,"algorithm","cnonce","opaque","qop","nc"];function h(e,t){const r=s.default.createHash(e);return r.update(t),r.digest("hex")}var d={type:"Digest",parseWWWAuthenticateRest:function(e){return(0,n.parseHTTPHeadersQuotedKeyValueSet)(e,a,o)},buildWWWAuthenticateRest:function(e){return(0,n.buildHTTPHeadersQuotedKeyValueSet)(e,a,o)},parseAuthorizationRest:function(e){return(0,n.parseHTTPHeadersQuotedKeyValueSet)(e,u,c)},buildAuthorizationRest:function(e){return(0,n.buildHTTPHeadersQuotedKeyValueSet)(e,u,c)},computeHash:function(e){const t=e.ha1||h(e.algorithm,[e.username,e.realm,e.password].join(":")),r=h(e.algorithm,[e.method,e.uri].join(":"));return h(e.algorithm,[t,e.nonce,e.nc,e.cnonce,e.qop,r].join(":"))}};t.default=d},9358:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseHTTPHeadersQuotedKeyValueSet=function(e,t,r=[]){const i=e.trim().match(s);if(!i)throw new n.default("E_MALFORMED_QUOTEDKEYVALUE",e);const a=i.map(((e,t)=>{const r=e.split("=");if(2!==r.length)throw new n.default("E_MALFORMED_QUOTEDKEYVALUE",t,e,r.length);return r})).reduce((function(e,[r,i],s){if(-1===t.indexOf(r))throw new n.default("E_UNAUTHORIZED_KEY",s,r);return e[r]=i.replace(/^"(.+(?="$))"$/,"$1"),e}),{});return o(r,a),a},t.buildHTTPHeadersQuotedKeyValueSet=function(e,t,r=[]){return o(r,e),t.reduce((function(t,r){return e[r]?t+(t?", ":"")+r+'="'+e[r]+'"':t}),"")};var i,n=(i=r(8257))&&i.__esModule?i:{default:i};const s=/\w+=(".*?"|[^",]+)(?=,|$)/g;function o(e,t){e.forEach((e=>{if(void 0===t[e])throw new n.default("E_REQUIRED_KEY",e)}))}},8691:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(3837),n=r(8549);var s,o;!function(e){e[e.UNIVERSAL=0]="UNIVERSAL",e[e.APPLICATION=64]="APPLICATION",e[e.CONTEXT_SPECIFIC=128]="CONTEXT_SPECIFIC",e[e.PRIVATE=192]="PRIVATE"}(s=t.Class||(t.Class={})),function(e){e[e.NONE=0]="NONE",e[e.BOOLEAN=1]="BOOLEAN",e[e.INTEGER=2]="INTEGER",e[e.BITSTRING=3]="BITSTRING",e[e.OCTETSTRING=4]="OCTETSTRING",e[e.NULL=5]="NULL",e[e.OID=6]="OID",e[e.ENUMERATED=10]="ENUMERATED",e[e.UTF8=12]="UTF8",e[e.SEQUENCE=16]="SEQUENCE",e[e.SET=17]="SET",e[e.NUMERICSTRING=18]="NUMERICSTRING",e[e.PRINTABLESTRING=19]="PRINTABLESTRING",e[e.T61STRING=20]="T61STRING",e[e.IA5STRING=22]="IA5STRING",e[e.UTCTIME=23]="UTCTIME",e[e.GENERALIZEDTIME=24]="GENERALIZEDTIME",e[e.GENERALSTRING=27]="GENERALSTRING"}(o=t.Tag||(t.Tag={}));class a{constructor(e,t){this.buf=e,this.bitLen=t}at(e){if(e<0||e>=this.bitLen||!Number.isInteger(e))return 0;const t=Math.floor(e/8),r=7-e%8;return this.buf[t]>>r&1}rightAlign(){const e=8-this.bitLen%8;if(8===e||0===this.buf.length)return this.buf;const t=Buffer.alloc(this.buf.length);t[0]=this.buf[0]>>e;for(let r=1;r<this.buf.length;r++)t[r]=this.buf[r-1]<<8-e,t[r]|=this.buf[r]>>e;return t}}t.BitString=a;class c{static Bool(e){const t=new c(s.UNIVERSAL,o.BOOLEAN,Buffer.from([e?255:0]));return t._value=e,t}static parseBool(e){if(!(e instanceof Buffer)||1!==e.length)throw new Error("ASN1 syntax error: invalid boolean");switch(e[0]){case 0:return!1;case 255:return!0;default:throw new Error("ASN1 syntax error: invalid boolean")}}static Integer(e){if(e instanceof Buffer){const t=new c(s.UNIVERSAL,o.INTEGER,e);return t._value=e.toString("hex"),t}if(!Number.isSafeInteger(e))throw new Error("ASN1 syntax error: invalid integer");let t;if(e>=-128&&e<128)t=Buffer.alloc(1),t.writeInt8(e,0);else if(e>=-32768&&e<32768)t=Buffer.alloc(2),t.writeIntBE(e,0,2);else if(e>=-8388608&&e<8388608)t=Buffer.alloc(3),t.writeIntBE(e,0,3);else if(e>=-2147483648&&e<2147483648)t=Buffer.alloc(4),t.writeIntBE(e,0,4);else if(e>=-549755813888&&e<549755813888)t=Buffer.alloc(5),t.writeIntBE(e,0,5);else{if(!(e>=-0x800000000000&&e<0x800000000000))throw new Error("ASN1 syntax error: invalid Integer");t=Buffer.alloc(6),t.writeIntBE(e,0,6)}const r=new c(s.UNIVERSAL,o.INTEGER,t);return r._value=e,r}static parseInteger(e){if(!(e instanceof Buffer)||0===e.length)throw new Error("ASN1 syntax error: invalid Integer");return e.length>6?e.toString("hex"):e.readIntBE(0,e.length)}static parseIntegerNum(e){const t=c.parseInteger(e);if("number"!=typeof t)throw new Error("ASN1 syntax error: invalid Integer number");return t}static parseIntegerStr(e){const t=c.parseInteger(e);return"number"==typeof t?t.toString(16):t}static BitString(e){e instanceof Buffer&&(e=new a(e,8*e.length));const t=8*e.buf.length-e.bitLen,r=Buffer.alloc(e.buf.length+1);return r.writeInt8(t,0),e.buf.copy(r,1),new c(s.UNIVERSAL,o.BITSTRING,r)}static parseBitString(e){if(!(e instanceof Buffer)||0===e.length)throw new Error("ASN1 syntax error: invalid BitString");const t=e[0];if(t>7||1===e.length&&t>0||0!=(e[e.length-1]&(1<<e[0])-1))throw new Error("ASN1 syntax error: invalid padding bits in BIT STRING");return new a(e.slice(1),8*(e.length-1)-t)}static Null(){const e=new c(s.UNIVERSAL,o.NULL,Buffer.alloc(0));return e._value=null,e}static parseNull(e){if(!(e instanceof Buffer)||0!==e.length)throw new Error("ASN1 syntax error: invalid null");return null}static OID(e){const t=e.split(".");if(0===t.length)throw new Error("ASN1 syntax error: invalid Object Identifier");const r=[];r.push(40*d(t[0])+d(t[1]));const i=[];for(let e=2;e<t.length;++e){let n=d(t[e]);for(i.length=0,i.push(127&n);n>127;)n>>>=7,i.unshift(127&n|128);r.push(...i)}const n=new c(s.UNIVERSAL,o.OID,Buffer.from(r));return n._value=e,n}static parseOID(e){if(!(e instanceof Buffer)||0===e.length)throw new Error("ASN1 syntax error: invalid OID");let t=Math.floor(e[0]/40)+"."+e[0]%40,r=0;for(let i=1;i<e.length;i++)e[i]>=128?(r+=127&e[i],r<<=7):(t+="."+(r+e[i]),r=0);return t}static UTF8(e){const t=new c(s.UNIVERSAL,o.UTF8,Buffer.from(e,"utf8"));return t._value=e,t}static parseUTF8(e){if(!(e instanceof Buffer))throw new Error("parse ASN1 error: invalid Buffer");return e.toString("utf8")}static NumericString(e){if(!u(e))throw new Error("ASN1 syntax error: invalid NumericString");const t=new c(s.UNIVERSAL,o.NUMERICSTRING,Buffer.from(e,"utf8"));return t._value=e,t}static parseNumericString(e){if(!(e instanceof Buffer))throw new Error("parse ASN1 error: invalid Buffer");const t=e.toString("utf8");if(!u(t))throw new Error("ASN1 syntax error: invalid NumericString");return t}static PrintableString(e){const t=new c(s.UNIVERSAL,o.PRINTABLESTRING,Buffer.from(e,"utf8"));return t._value=e,t}static parsePrintableString(e){if(!(e instanceof Buffer))throw new Error("parse ASN1 error: invalid Buffer");return e.toString("utf8")}static IA5String(e){if(!h(e))throw new Error("ASN1 syntax error: invalid IA5String");const t=new c(s.UNIVERSAL,o.IA5STRING,Buffer.from(e,"utf8"));return t._value=e,t}static parseIA5String(e){if(!(e instanceof Buffer))throw new Error("parse ASN1 error: invalid Buffer");const t=e.toString("utf8");if(!h(t))throw new Error("ASN1 syntax error: invalid IA5String");return t}static T61String(e){const t=new c(s.UNIVERSAL,o.T61STRING,Buffer.from(e,"utf8"));return t._value=e,t}static parseT61String(e){if(!(e instanceof Buffer))throw new Error("parse ASN1 error: invalid Buffer");return e.toString("utf8")}static GeneralString(e){const t=new c(s.UNIVERSAL,o.GENERALSTRING,Buffer.from(e,"utf8"));return t._value=e,t}static parseGeneralString(e){if(!(e instanceof Buffer))throw new Error("parse ASN1 error: invalid Buffer");return e.toString("utf8")}static UTCTime(e){let t="";const r=[];r.push((""+e.getUTCFullYear()).substr(2)),r.push(""+(e.getUTCMonth()+1)),r.push(""+e.getUTCDate()),r.push(""+e.getUTCHours()),r.push(""+e.getUTCMinutes()),r.push(""+e.getUTCSeconds());for(const e of r)e.length<2&&(t+="0"),t+=e;t+="Z";const i=new c(s.UNIVERSAL,o.UTCTIME,Buffer.from(t,"utf8"));return i._value=e,i}static parseUTCTime(e){if(!(e instanceof Buffer)||0===e.length)throw new Error("ASN1 syntax error: invalid UTC Time");const t=e.toString("utf8"),r=new Date;let i=d(t.substr(0,2));i=i>=50?1900+i:2e3+i;const n=d(t.substr(2,2))-1,s=d(t.substr(4,2)),o=d(t.substr(6,2)),a=d(t.substr(8,2));let c=0,u=0,h="";if(t.length>11&&(u=10,h=t.charAt(u),"+"!==h&&"-"!==h&&(c=d(t.substr(10,2)),u+=2)),r.setUTCFullYear(i,n,s),r.setUTCHours(o,a,c,0),u>0&&(h=t.charAt(u),"+"===h||"-"===h)){let e=60*d(t.substr(u+1,2))+d(t.substr(u+4,2));e*=6e4,"+"===h?r.setTime(+r-e):r.setTime(+r+e)}return r}static GeneralizedTime(e){let t="";const r=[];r.push(""+e.getUTCFullYear()),r.push(""+(e.getUTCMonth()+1)),r.push(""+e.getUTCDate()),r.push(""+e.getUTCHours()),r.push(""+e.getUTCMinutes()),r.push(""+e.getUTCSeconds());for(const e of r)e.length<2&&(t+="0"),t+=e;t+="Z";const i=new c(s.UNIVERSAL,o.GENERALIZEDTIME,Buffer.from(t,"utf8"));return i._value=e,i}static parseGeneralizedTime(e){if(!(e instanceof Buffer)||0===e.length)throw new Error("ASN1 syntax error: invalid Generalized Time");const t=e.toString("utf8"),r=new Date,i=d(t.substr(0,4)),n=d(t.substr(4,2))-1,s=d(t.substr(6,2)),o=d(t.substr(8,2)),a=d(t.substr(10,2)),c=d(t.substr(12,2));let u=0,h=0,l=!1;"Z"===t.charAt(t.length-1)&&(l=!0);const f=t.length-5,p=t.charAt(f);if("+"===p||"-"===p){h=60*d(t.substr(f+1,2))+d(t.substr(f+4,2)),h*=6e4,"+"===p&&(h*=-1),l=!0}return"."===t.charAt(14)&&(u=1e3*parseFloat(t.substr(14))),l?(r.setUTCFullYear(i,n,s),r.setUTCHours(o,a,c,u),r.setTime(+r+h)):(r.setFullYear(i,n,s),r.setHours(o,a,c,u)),r}static parseTime(e,t){switch(e){case o.UTCTIME:return c.parseUTCTime(t);case o.GENERALIZEDTIME:return c.parseGeneralizedTime(t);default:throw new Error("Invalid ASN1 time tag")}}static Set(e){const t=new c(s.UNIVERSAL,o.SET,Buffer.concat(e.map((e=>e.toDER()))));return t._value=e,t}static Seq(e){const t=new c(s.UNIVERSAL,o.SEQUENCE,Buffer.concat(e.map((e=>e.toDER()))));return t._value=e,t}static Spec(e,t,r=!0){const i=Array.isArray(t)?Buffer.concat(t.map((e=>e.toDER()))):t.toDER();Array.isArray(t)&&(r=!0);const n=new c(s.CONTEXT_SPECIFIC,e,i,r);return n._value=t,n}static fromDER(e,t=!1){return c._fromDER(new n.BufferVisitor(e),t)}static parseDER(e,t,r){const i=c._fromDER(new n.BufferVisitor(e),!1);if(i.class!==t&&i.tag!==r)throw new Error(`invalid ASN.1 DER for class ${t} and tag ${r}`);return i}static parseDERWithTemplate(e,t){const r=c._fromDER(new n.BufferVisitor(e),!0),i={},s=r.validate(t,i);if(null!=s)throw s.data=r,s;return i}static _parseCompound(e,t){const r=[],i=e.length,s=new n.BufferVisitor(e);let o=0;for(;o<i;){const e=s.end;r.push(c._fromDER(s,t)),o+=s.end-e}return r}static _fromDER(e,t){if(!(e.buf instanceof Buffer)||0===e.length)throw new Error("ASN1 syntax error: invalid Generalized Time");e.mustWalk(1,"Too few bytes to read ASN.1 tag.");const r=e.start,i=e.buf[r],n=192&i,s=31&i,a=function(e){e.mustWalk(1,"Too few bytes to read ASN.1 value length.");const t=e.buf[e.start];if(0==(128&t))return t;const r=127&t;return e.mustWalk(r,"Too few bytes to read ASN.1 value length."),e.buf.readUIntBE(e.start,r)}(e);if(e.mustHas(a),0!==a&&s===o.NULL)throw new Error("invalid value length or NULL tag.");e.mustWalk(a);const u=32==(32&i),h=new c(n,s,e.buf.slice(e.start,e.end),u);return u&&t&&(h._value=c._parseCompound(h.bytes,t)),h._der=e.buf.slice(r,e.end),h}constructor(e,t,r,i=!1){this.class=e,this.tag=t,this.bytes=r,this.isCompound=i||t===o.SEQUENCE||t===o.SET,this._value=void 0,this._der=null}get value(){return void 0===this._value&&(this._value=this.valueOf()),this._value}get DER(){return null==this._der&&(this._der=this.toDER()),this._der}mustCompound(e="asn1 object value is not compound"){if(!this.isCompound||!Array.isArray(this.value)){const t=new Error(e);throw t.data=this.toJSON(),t}return this.value}equals(e){return e instanceof c&&(this.class===e.class&&this.tag===e.tag&&this.isCompound===e.isCompound&&!!this.bytes.equals(e.bytes))}toDER(){let e=this.class|this.tag;this.isCompound&&(e|=32);const t=function(e){if(e<=127)return 0;if(e<=255)return 1;if(e<=65535)return 2;if(e<=16777215)return 3;if(e<=4294967295)return 4;if(e<=0xffffffffff)return 5;if(e<=0xffffffffffff)return 6;throw new Error("invalid value length")}(this.bytes.length),r=Buffer.allocUnsafe(2+t+this.bytes.length);return r.writeInt8(e,0),0===t?(r.writeUInt8(this.bytes.length,1),this.bytes.copy(r,2)):(r.writeUInt8(128|t,1),r.writeUIntBE(this.bytes.length,2,t),this.bytes.copy(r,2+t)),r}valueOf(){if(this.isCompound)return c._parseCompound(this.bytes,!1);if(this.class!==s.UNIVERSAL)return this.bytes;switch(this.tag){case o.BOOLEAN:return c.parseBool(this.bytes);case o.INTEGER:return c.parseInteger(this.bytes);case o.BITSTRING:return c.parseBitString(this.bytes);case o.NULL:return c.parseNull(this.bytes);case o.OID:return c.parseOID(this.bytes);case o.UTF8:return c.parseUTF8(this.bytes);case o.NUMERICSTRING:return c.parseNumericString(this.bytes);case o.PRINTABLESTRING:return c.parsePrintableString(this.bytes);case o.T61STRING:return c.parseT61String(this.bytes);case o.IA5STRING:return c.parseIA5String(this.bytes);case o.GENERALSTRING:return c.parseGeneralString(this.bytes);case o.UTCTIME:return c.parseUTCTime(this.bytes);case o.GENERALIZEDTIME:return c.parseGeneralizedTime(this.bytes);default:return this.bytes}}validate(e,t={}){if(this.class!==e.class)return new Error(`ASN.1 object validate failure for ${e.name} : error class ${s[this.class]}`);if(!(Array.isArray(e.tag)?e.tag:[e.tag]).includes(this.tag))return new Error(`ASN.1 object validate failure for ${e.name}: error tag ${o[this.tag]}`);if(null!=e.capture&&(t[e.capture]=this),Array.isArray(e.value)){const r=this.mustCompound(`${e.name} need compound ASN1 value`);for(let i=0,n=0;i<e.value.length;i++)if(null!=r[n]){const s=r[n].validate(e.value[i],t);if(null==s)n++;else if(!0!==e.value[i].optional)return s}else if(!0!==e.value[i].optional)return new Error(`ASN.1 object validate failure for ${e.value[i].name}: not exists`)}else if(null!=e.value){const r=this.tag===o.BITSTRING?this.bytes.slice(1):this.bytes;return c.fromDER(r).validate(e.value,t)}return null}toJSON(){let e=this.value;return Array.isArray(e)&&(e=e.map((e=>e.toJSON()))),{class:s[this.class],tag:this.class===s.UNIVERSAL?o[this.tag]:this.tag,value:e}}[i.inspect.custom](e,t){return t.depth<=2&&(t.depth=10),`<${this.constructor.name} ${i.inspect(this.toJSON(),t)}>`}}function u(e){for(const t of e){const e=t.charCodeAt(0);if(32!==e&&(e<48||e>57))return!1}return!0}function h(e){for(const t of e)if(t.charCodeAt(0)>=128)return!1;return!0}function d(e,t=10){const r=parseInt(e,t);if(Number.isNaN(r))throw new Error(`Invalid numeric string "${e}" in radix ${t}.`);return r}t.ASN1=c},8549:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BufferVisitor=class{constructor(e,t=0,r=0){this.start=t,this.end=r>t?r:t,this.buf=e}get length(){return this.buf.length}reset(e=0,t=0){return this.start=e,t>=this.start?this.end=t:this.end<this.start&&(this.end=this.start),this}walk(e){return this.start=this.end,this.end+=e,this}mustHas(e,t="Too few bytes to parse."){const r=this.end+e;if(r>this.buf.length){const e=new Error(t);throw e.available=this.buf.length,e.requested=r,e}return this.walk(0),this}mustWalk(e,t){return this.mustHas(e,t),this.walk(e),this}}},5894:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(8549);t.BufferVisitor=i.BufferVisitor;var n=r(2178);t.PEM=n.PEM;var s=r(8691);t.ASN1=s.ASN1,t.Class=s.Class,t.Tag=s.Tag,t.BitString=s.BitString},2178:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(3837),n="-----BEGIN ",s="-----END ",o="-----",a="Proc-Type";class c{static parse(e){const t=[],r=e.toString("utf8").split("\n").map((e=>e.trim())).filter((e=>""!==e&&!e.startsWith("#")));for(;r.length>0;)t.push(u(r));if(0===t.length)throw new Error("PEM: no block");return t}constructor(e,t){this.type=e,this.body=t,this.headers=Object.create(null)}get procType(){return this.getHeader(a)}getHeader(e){const t=this.headers[e];return null==t?"":t}setHeader(e,t){if(e.includes(":"))throw new Error("pem: cannot encode a header key that contains a colon");if(""===e||""===t)throw new Error("pem: invalid header key or value");this.headers[e]=t}toString(){let e=n+this.type+o+"\n";const t=Object.keys(this.headers);if(t.length>0){const r=this.procType;""!==r&&(e+=`Proc-Type: ${r}\n`),t.sort();for(const r of t)r!==a&&(e+=`${r}: ${this.headers[r]}\n`);e+="\n"}const r=this.body.toString("base64");let i=0;for(;i<r.length;)e+=r.slice(i,i+64)+"\n",i+=64;return e+=s+this.type+o+"\n",e}toBuffer(){return Buffer.from(this.toString(),"utf8")}valueOf(){return this.body}toJSON(){return{type:this.type,body:this.body,headers:this.headers}}[i.inspect.custom](e,t){return`<${this.constructor.name} ${i.inspect(this.toJSON(),t)}>`}}function u(e){let t=e.shift();if(null==t||!t.startsWith(n)||!t.endsWith(o))throw new Error("pem: invalid BEGIN line");const r=t.slice(n.length,t.length-o.length);if(""===r)throw new Error("pem: invalid type");const i=[];for(t=e.shift();null!=t&&t.includes(": ");){const r=t.split(": ");if(2!==r.length||""===r[0]||""===r[1])throw new Error("pem: invalid Header line");i.push(r),t=e.shift()}let a="";for(;null!=t&&!t.startsWith(s);)a+=t,t=e.shift();if(null==t||t!==`-----END ${r}-----`)throw new Error("pem: invalid END line");const u=new c(r,Buffer.from(a,"base64"));if(""===a||u.body.toString("base64")!==a)throw new Error("pem: invalid base64 body");for(const e of i)u.setHeader(e[0],e[1]);return u}t.PEM=c},8323:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(1808);t.bytesFromIP=function(e){switch(i.isIP(e)){case 4:return Buffer.from(e.split(".").map((e=>parseInt(e,10))));case 6:const t=e.split(":"),r=Buffer.alloc(16);let i=0;""===t[t.length-1]&&(t[t.length-1]="0");for(let e=0;e<t.length;e++)""!==t[e]?(r.writeUInt16BE(parseInt(t[e],16),i),i+=2):e+1<t.length&&""!==t[e+1]&&(i=16-2*(t.length-e-1));return r;default:return null}},t.bytesToIP=function(e){switch(e.length){case 4:return[e[0],e[1],e[2],e[3]].join(".");case 16:const t=[];let r=-1,i=0,n=-1,s=0;for(let o=0;o<e.length;o+=2){const a=e[o]<<8|e[o+1];0===a?(i++,-1===r&&(r=t.length),i>s&&(s=i,n=r)):(r=-1,i=0),t.push(a.toString(16))}if(s>0){let e="";const r=t.slice(n+s);t.length=n,0===t.length&&(e+=":"),0===r.length&&(e+=":"),t.push(e,...r)}return t.join(":");default:return""}};const n=Object.create(null),s=/^[0-9.]+$/;function o(e,t){n[e]=t,n[t]=e}t.getOID=function(e){return s.test(e)&&""!==n[e]?e:null==n[e]?"":n[e]},t.getOIDName=function(e){return s.test(e)||""===n[e]?null==n[e]?e:n[e]:e},o("1.2.840.113549.1.1.1","rsaEncryption"),o("1.2.840.113549.1.1.4","md5WithRsaEncryption"),o("1.2.840.113549.1.1.5","sha1WithRsaEncryption"),o("1.2.840.113549.1.1.8","mgf1"),o("1.2.840.113549.1.1.10","RSASSA-PSS"),o("1.2.840.113549.1.1.11","sha256WithRsaEncryption"),o("1.2.840.113549.1.1.12","sha384WithRsaEncryption"),o("1.2.840.113549.1.1.13","sha512WithRsaEncryption"),o("1.2.840.10045.2.1","ecEncryption"),o("1.2.840.10045.4.1","ecdsaWithSha1"),o("1.2.840.10045.4.3.2","ecdsaWithSha256"),o("1.2.840.10045.4.3.3","ecdsaWithSha384"),o("1.2.840.10045.4.3.4","ecdsaWithSha512"),o("1.2.840.10040.4.3","dsaWithSha1"),o("2.16.840.1.101.3.4.3.2","dsaWithSha256"),o("1.3.14.3.2.7","desCBC"),o("1.3.14.3.2.26","sha1"),o("2.16.840.1.101.3.4.2.1","sha256"),o("2.16.840.1.101.3.4.2.2","sha384"),o("2.16.840.1.101.3.4.2.3","sha512"),o("1.2.840.113549.2.5","md5"),o("1.3.101.110","X25519"),o("1.3.101.111","X448"),o("1.3.101.112","Ed25519"),o("1.3.101.113","Ed448"),o("1.2.840.113549.1.7.1","data"),o("1.2.840.113549.1.7.2","signedData"),o("1.2.840.113549.1.7.3","envelopedData"),o("1.2.840.113549.1.7.4","signedAndEnvelopedData"),o("1.2.840.113549.1.7.5","digestedData"),o("1.2.840.113549.1.7.6","encryptedData"),o("1.2.840.113549.1.9.1","emailAddress"),o("1.2.840.113549.1.9.2","unstructuredName"),o("1.2.840.113549.1.9.3","contentType"),o("1.2.840.113549.1.9.4","messageDigest"),o("1.2.840.113549.1.9.5","signingTime"),o("1.2.840.113549.1.9.6","counterSignature"),o("1.2.840.113549.1.9.7","challengePassword"),o("1.2.840.113549.1.9.8","unstructuredAddress"),o("1.2.840.113549.1.9.14","extensionRequest"),o("1.2.840.113549.1.9.20","friendlyName"),o("1.2.840.113549.1.9.21","localKeyId"),o("1.2.840.113549.1.9.22.1","x509Certificate"),o("1.2.840.113549.1.12.10.1.1","keyBag"),o("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag"),o("1.2.840.113549.1.12.10.1.3","certBag"),o("1.2.840.113549.1.12.10.1.4","crlBag"),o("1.2.840.113549.1.12.10.1.5","secretBag"),o("1.2.840.113549.1.12.10.1.6","safeContentsBag"),o("1.2.840.113549.1.5.13","pkcs5PBES2"),o("1.2.840.113549.1.5.12","pkcs5PBKDF2"),o("1.2.840.113549.2.7","hmacWithSha1"),o("1.2.840.113549.2.9","hmacWithSha256"),o("1.2.840.113549.2.10","hmacWithSha384"),o("1.2.840.113549.2.11","hmacWithSha512"),o("1.2.840.113549.3.7","3desCBC"),o("2.16.840.1.101.3.4.1.2","aesCBC128"),o("2.16.840.1.101.3.4.1.42","aesCBC256"),o("2.5.4.3","commonName"),o("2.5.4.5","serialName"),o("2.5.4.6","countryName"),o("2.5.4.7","localityName"),o("2.5.4.8","stateOrProvinceName"),o("2.5.4.10","organizationName"),o("2.5.4.11","organizationalUnitName"),o("2.5.4.15","businessCategory"),o("2.16.840.1.113730.1.1","nsCertType"),o("2.5.29.2","keyAttributes"),o("2.5.29.4","keyUsageRestriction"),o("2.5.29.6","subtreesConstraint"),o("2.5.29.9","subjectDirectoryAttributes"),o("2.5.29.14","subjectKeyIdentifier"),o("2.5.29.15","keyUsage"),o("2.5.29.16","privateKeyUsagePeriod"),o("2.5.29.17","subjectAltName"),o("2.5.29.18","issuerAltName"),o("2.5.29.19","basicConstraints"),o("2.5.29.20","cRLNumber"),o("2.5.29.21","cRLReason"),o("2.5.29.22","expirationDate"),o("2.5.29.23","instructionCode"),o("2.5.29.24","invalidityDate"),o("2.5.29.27","deltaCRLIndicator"),o("2.5.29.28","issuingDistributionPoint"),o("2.5.29.29","certificateIssuer"),o("2.5.29.30","nameConstraints"),o("2.5.29.31","cRLDistributionPoints"),o("2.5.29.32","certificatePolicies"),o("2.5.29.33","policyMappings"),o("2.5.29.35","authorityKeyIdentifier"),o("2.5.29.36","policyConstraints"),o("2.5.29.37","extKeyUsage"),o("2.5.29.46","freshestCRL"),o("2.5.29.54","inhibitAnyPolicy"),o("1.3.6.1.4.1.311.60.2.1.2","jurisdictionST"),o("1.3.6.1.4.1.311.60.2.1.3","jurisdictionC"),o("1.3.6.1.4.1.11129.2.4.2","timestampList"),o("1.3.6.1.5.5.7.1.1","authorityInfoAccess"),o("1.3.6.1.5.5.7.3.1","serverAuth"),o("1.3.6.1.5.5.7.3.2","clientAuth"),o("1.3.6.1.5.5.7.3.3","codeSigning"),o("1.3.6.1.5.5.7.3.4","emailProtection"),o("1.3.6.1.5.5.7.3.8","timeStamping"),o("1.3.6.1.5.5.7.48.1","authorityInfoAccessOcsp"),o("1.3.6.1.5.5.7.48.2","authorityInfoAccessIssuers")},8644:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(8323);t.bytesFromIP=i.bytesFromIP,t.bytesToIP=i.bytesToIP,t.getOID=i.getOID,t.getOIDName=i.getOIDName;var n=r(8931);t.PublicKey=n.PublicKey,t.PrivateKey=n.PrivateKey,t.RSAPublicKey=n.RSAPublicKey,t.RSAPrivateKey=n.RSAPrivateKey;var s=r(1679);t.Certificate=s.Certificate,t.DistinguishedName=s.DistinguishedName},8931:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(3837),n=r(6113),s=r(9698),o=r(5894),a=r(8323);t.publicKeyValidator={name:"PublicKeyInfo",class:o.Class.UNIVERSAL,tag:o.Tag.SEQUENCE,capture:"publicKeyInfo",value:[{name:"PublicKeyInfo.AlgorithmIdentifier",class:o.Class.UNIVERSAL,tag:o.Tag.SEQUENCE,value:[{name:"PublicKeyAlgorithmIdentifier.algorithm",class:o.Class.UNIVERSAL,tag:o.Tag.OID,capture:"publicKeyOID"}]},{name:"PublicKeyInfo.PublicKey",class:o.Class.UNIVERSAL,tag:o.Tag.BITSTRING,capture:"publicKey"}]},t.privateKeyValidator={name:"PrivateKeyInfo",class:o.Class.UNIVERSAL,tag:o.Tag.SEQUENCE,capture:"privateKeyInfo",value:[{name:"PrivateKeyInfo.Version",class:o.Class.UNIVERSAL,tag:o.Tag.INTEGER,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.AlgorithmIdentifier",class:o.Class.UNIVERSAL,tag:o.Tag.SEQUENCE,value:[{name:"PrivateKeyAlgorithmIdentifier.algorithm",class:o.Class.UNIVERSAL,tag:o.Tag.OID,capture:"privateKeyOID"}]},{name:"PrivateKeyInfo.PrivateKey",class:o.Class.UNIVERSAL,tag:o.Tag.OCTETSTRING,capture:"privateKey"}]};const c={name:"RSAPublicKey",class:o.Class.UNIVERSAL,tag:o.Tag.SEQUENCE,value:[{name:"RSAPublicKey.modulus",class:o.Class.UNIVERSAL,tag:o.Tag.INTEGER,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",class:o.Class.UNIVERSAL,tag:o.Tag.INTEGER,capture:"publicKeyExponent"}]},u={name:"RSAPrivateKey",class:o.Class.UNIVERSAL,tag:o.Tag.SEQUENCE,value:[{name:"RSAPrivateKey.version",class:o.Class.UNIVERSAL,tag:o.Tag.INTEGER,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",class:o.Class.UNIVERSAL,tag:o.Tag.INTEGER,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",class:o.Class.UNIVERSAL,tag:o.Tag.INTEGER,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",class:o.Class.UNIVERSAL,tag:o.Tag.INTEGER,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",class:o.Class.UNIVERSAL,tag:o.Tag.INTEGER,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",class:o.Class.UNIVERSAL,tag:o.Tag.INTEGER,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",class:o.Class.UNIVERSAL,tag:o.Tag.INTEGER,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",class:o.Class.UNIVERSAL,tag:o.Tag.INTEGER,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",class:o.Class.UNIVERSAL,tag:o.Tag.INTEGER,capture:"privateKeyCoefficient"}]},h=[a.getOID("X25519"),a.getOID("X448"),a.getOID("Ed25519"),a.getOID("Ed448")];class d{constructor(e){const r={},i=e.validate(t.publicKeyValidator,r);if(null!=i)throw new Error("Cannot read X.509 public key: "+i.message);this.oid=o.ASN1.parseOID(r.publicKeyOID.bytes),this.algo=a.getOIDName(this.oid),this._pkcs8=e,this._keyRaw=o.ASN1.parseBitString(r.publicKey.bytes).buf,this._finalKey=this._keyRaw,this._finalPEM=""}static fromPEM(e){const t=o.PEM.parse(e)[0];if(t.procType.includes("ENCRYPTED"))throw new Error("Could not convert public key from PEM, PEM is encrypted.");const r=o.ASN1.fromDER(t.body,!0);switch(t.type){case"PUBLIC KEY":return new d(r);case"RSA PUBLIC KEY":const e=o.ASN1.Seq([o.ASN1.Seq([o.ASN1.OID(a.getOID("rsaEncryption")),o.ASN1.Null()]),o.ASN1.BitString(r.DER)]);return new d(e);default:throw new Error("Could not convert public key from PEM, recommend PKCS#8 PEM")}}static addVerifier(e,t){if(""===(e=a.getOID(e)))throw new Error(`Invalid object identifier: ${e}`);if(null!=d._verifiers[e])throw new Error(`Verifier ${e} exists`);d._verifiers[e]=t}get keyRaw(){return this._finalKey}verify(e,t,r){const i=d._verifiers[this.oid];if(null!=i){const s=n.createHash(r).update(e).digest();return i.call(this,s,t)}const s=n.createVerify(r);return s.update(e),s.verify(this.toPEM(),t)}getFingerprint(e,t="PublicKey"){let r;switch(t){case"PublicKeyInfo":r=this._pkcs8.DER;break;case"PublicKey":r=this._keyRaw;break;default:throw new Error(`Unknown fingerprint type "${t}".`)}const i=n.createHash(e);return i.update(r),i.digest()}toASN1(){return this._pkcs8}toDER(){return this._pkcs8.DER}toPEM(){return""===this._finalPEM&&(this._finalPEM=new o.PEM("PUBLIC KEY",this._pkcs8.DER).toString()),this._finalPEM}toJSON(){return{oid:this.oid,algo:this.algo,publicKey:this._keyRaw}}[i.inspect.custom](e,t){return`<${this.constructor.name} ${i.inspect(this.toJSON(),t)}>`}}d._verifiers=Object.create(null),t.PublicKey=d;class l{constructor(e){const r=Object.create(null),i=e.validate(t.privateKeyValidator,r);if(null!=i)throw new Error("Cannot read X.509 private key: "+i.message);if(this.version=o.ASN1.parseIntegerNum(r.privateKeyVersion.bytes)+1,this.oid=o.ASN1.parseOID(r.privateKeyOID.bytes),this.algo=a.getOIDName(this.oid),this._pkcs8=e,this._keyRaw=r.privateKey.bytes,this._publicKeyRaw=null,this._finalKey=this._keyRaw,this._finalPEM="",h.includes(this.oid))if(this._finalKey=this._keyRaw=o.ASN1.parseDER(this._keyRaw,o.Class.UNIVERSAL,o.Tag.OCTETSTRING).bytes,"1.3.101.112"===this.oid){const e=s.sign.keyPair.fromSeed(this._keyRaw);this._publicKeyRaw=Buffer.from(e.publicKey),this._finalKey=Buffer.from(e.secretKey)}else if(2===this.version)for(const t of e.mustCompound())t.class===o.Class.CONTEXT_SPECIFIC&&1===t.tag&&(this._publicKeyRaw=o.ASN1.parseBitString(t.bytes).buf,this._finalKey=Buffer.concat([this._keyRaw,this._publicKeyRaw]))}static fromPEM(e){const t=o.PEM.parse(e)[0];if(t.procType.includes("ENCRYPTED"))throw new Error("Could not convert private key from PEM, PEM is encrypted.");let r=o.ASN1.fromDER(t.body,!0);switch(t.type){case"PRIVATE KEY":return new l(r);case"RSA PRIVATE KEY":return r=o.ASN1.Seq([r.value[0],o.ASN1.Seq([o.ASN1.OID(a.getOID("rsaEncryption")),o.ASN1.Null()]),new o.ASN1(o.Class.UNIVERSAL,o.Tag.OCTETSTRING,r.DER)]),new l(r);default:throw new Error("Could not convert private key from PEM, recommend PKCS#8 PEM")}}static addSigner(e,t){if(""===(e=a.getOID(e)))throw new Error(`Invalid object identifier: ${e}`);if(null!=l._signers[e])throw new Error(`Signer ${e} exists`);l._signers[e]=t}get keyRaw(){return this._finalKey}get publicKeyRaw(){return this._publicKeyRaw}sign(e,t){const r=l._signers[this.oid];if(null!=r){const i=n.createHash(t).update(e).digest();return r.call(this,i)}const i=n.createSign(t);return i.update(e),i.sign(this.toPEM())}toASN1(){return this._pkcs8}toDER(){return this._pkcs8.DER}toPEM(){return""===this._finalPEM&&(this._finalPEM=new o.PEM("PRIVATE KEY",this._pkcs8.DER).toString()),this._finalPEM}toJSON(){return{version:this.version,oid:this.oid,algo:this.algo,privateKey:this._keyRaw,publicKey:this._publicKeyRaw}}[i.inspect.custom](e,t){return`<${this.constructor.name} ${i.inspect(this.toJSON(),t)}>`}}l._signers=Object.create(null),t.PrivateKey=l;class f extends d{static fromPublicKey(e){return new f(e.toASN1())}constructor(e){if(super(e),a.getOID(this.oid)!==a.getOID("rsaEncryption"))throw new Error(`Invalid RSA public key, unknown OID: ${this.oid}`);const t=Object.create(null);this._pkcs1=o.ASN1.fromDER(this._keyRaw,!0);const r=this._pkcs1.validate(c,t);if(null!=r)throw new Error("Cannot read RSA public key: "+r.message);this.modulus=o.ASN1.parseIntegerStr(t.publicKeyModulus.bytes),this.exponent=o.ASN1.parseIntegerNum(t.publicKeyExponent.bytes)}toASN1(){return this._pkcs1}toDER(){return this._keyRaw}toPEM(){return""===this._finalPEM&&(this._finalPEM=new o.PEM("RSA PUBLIC KEY",this._keyRaw).toString()),this._finalPEM}toPublicKeyPEM(){return new o.PEM("PUBLIC KEY",this._pkcs8.DER).toString()}toJSON(){return{oid:this.oid,algo:this.algo,modulus:y(this.modulus),exponent:this.exponent}}[i.inspect.custom](e,t){return`<${this.constructor.name} ${i.inspect(this.toJSON(),t)}>`}}t.RSAPublicKey=f;class p extends l{static fromPrivateKey(e){return new p(e.toASN1())}constructor(e){if(super(e),a.getOID(this.oid)!==a.getOID("rsaEncryption"))throw new Error(`Invalid RSA private key, unknown OID: ${this.oid}`);const t=Object.create(null);this._pkcs1=o.ASN1.fromDER(this._keyRaw,!0);const r=this._pkcs1.validate(u,t);if(null!=r)throw new Error("Cannot read RSA private key: "+r.message);this.publicExponent=o.ASN1.parseIntegerNum(t.privateKeyPublicExponent.bytes),this.privateExponent=o.ASN1.parseIntegerStr(t.privateKeyPrivateExponent.bytes),this.modulus=o.ASN1.parseIntegerStr(t.privateKeyModulus.bytes),this.prime1=o.ASN1.parseIntegerStr(t.privateKeyPrime1.bytes),this.prime2=o.ASN1.parseIntegerStr(t.privateKeyPrime2.bytes),this.exponent1=o.ASN1.parseIntegerStr(t.privateKeyExponent1.bytes),this.exponent2=o.ASN1.parseIntegerStr(t.privateKeyExponent2.bytes),this.coefficient=o.ASN1.parseIntegerStr(t.privateKeyCoefficient.bytes)}toASN1(){return this._pkcs1}toDER(){return this._keyRaw}toPEM(){return""===this._finalPEM&&(this._finalPEM=new o.PEM("RSA PRIVATE KEY",this._keyRaw).toString()),this._finalPEM}toPrivateKeyPEM(){return new o.PEM("PRIVATE KEY",this._pkcs8.DER).toString()}toJSON(){return{version:this.version,oid:this.oid,algo:this.algo,publicExponent:this.publicExponent,privateExponent:y(this.privateExponent),modulus:y(this.modulus),prime1:y(this.prime1),prime2:y(this.prime2),exponent1:y(this.exponent1),exponent2:y(this.exponent2),coefficient:y(this.coefficient)}}[i.inspect.custom](e,t){return`<${this.constructor.name} ${i.inspect(this.toJSON(),t)}>`}}function y(e){return e.length%8!=0&&e.startsWith("00")?e.slice(2):e}t.RSAPrivateKey=p,d.addVerifier(a.getOID("Ed25519"),(function(e,t){return s.sign.detached.verify(e,t,this.keyRaw)})),l.addSigner(a.getOID("Ed25519"),(function(e){const t=this.keyRaw;if(64!==t.length)throw new Error("Invalid signing key.");return Buffer.from(s.sign.detached(e,t))}))},1679:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(3837),n=r(6113),s=r(5894),o=r(8323),a=r(8931),c=Object.create(null);c.CN=o.getOID("commonName"),c.commonName="CN",c.C=o.getOID("countryName"),c.countryName="C",c.L=o.getOID("localityName"),c.localityName="L",c.ST=o.getOID("stateOrProvinceName"),c.stateOrProvinceName="ST",c.O=o.getOID("organizationName"),c.organizationName="O",c.OU=o.getOID("organizationalUnitName"),c.organizationalUnitName="OU",c.E=o.getOID("emailAddress"),c.emailAddress="E";const u={name:"Certificate",class:s.Class.UNIVERSAL,tag:s.Tag.SEQUENCE,value:[{name:"Certificate.TBSCertificate",class:s.Class.UNIVERSAL,tag:s.Tag.SEQUENCE,capture:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",class:s.Class.CONTEXT_SPECIFIC,tag:s.Tag.NONE,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",class:s.Class.UNIVERSAL,tag:s.Tag.INTEGER,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",class:s.Class.UNIVERSAL,tag:s.Tag.INTEGER,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",class:s.Class.UNIVERSAL,tag:s.Tag.SEQUENCE,value:[{name:"Certificate.TBSCertificate.signature.algorithm",class:s.Class.UNIVERSAL,tag:s.Tag.OID,capture:"certinfoSignatureOID"},{name:"Certificate.TBSCertificate.signature.parameters",class:s.Class.UNIVERSAL,tag:s.Tag.OCTETSTRING,optional:!0,capture:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",class:s.Class.UNIVERSAL,tag:s.Tag.SEQUENCE,capture:"certIssuer"},{name:"Certificate.TBSCertificate.validity",class:s.Class.UNIVERSAL,tag:s.Tag.SEQUENCE,value:[{name:"Certificate.TBSCertificate.validity.notBefore",class:s.Class.UNIVERSAL,tag:[s.Tag.UTCTIME,s.Tag.GENERALIZEDTIME],capture:"certValidityNotBefore"},{name:"Certificate.TBSCertificate.validity.notAfter",class:s.Class.UNIVERSAL,tag:[s.Tag.UTCTIME,s.Tag.GENERALIZEDTIME],capture:"certValidityNotAfter"}]},{name:"Certificate.TBSCertificate.subject",class:s.Class.UNIVERSAL,tag:s.Tag.SEQUENCE,capture:"certSubject"},a.publicKeyValidator,{name:"Certificate.TBSCertificate.issuerUniqueID",class:s.Class.CONTEXT_SPECIFIC,tag:s.Tag.BOOLEAN,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",class:s.Class.UNIVERSAL,tag:s.Tag.BITSTRING,capture:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",class:s.Class.CONTEXT_SPECIFIC,tag:s.Tag.INTEGER,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",class:s.Class.UNIVERSAL,tag:s.Tag.BITSTRING,capture:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",class:s.Class.CONTEXT_SPECIFIC,tag:s.Tag.BITSTRING,capture:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",class:s.Class.UNIVERSAL,tag:s.Tag.SEQUENCE,value:[{name:"Certificate.signatureAlgorithm.algorithm",class:s.Class.UNIVERSAL,tag:s.Tag.OID,capture:"certSignatureOID"},{name:"Certificate.TBSCertificate.signature.parameters",class:s.Class.UNIVERSAL,tag:s.Tag.OCTETSTRING,optional:!0,capture:"certSignatureParams"}]},{name:"Certificate.signatureValue",class:s.Class.UNIVERSAL,tag:s.Tag.BITSTRING,capture:"certSignature"}]};class h{constructor(){this.attributes=[],this.uniqueId=null}get commonName(){return this.getFieldValue("commonName")}get organizationName(){return this.getFieldValue("organizationName")}get organizationalUnitName(){return this.getFieldValue("organizationalUnitName")}get countryName(){return this.getFieldValue("countryName")}get localityName(){return this.getFieldValue("localityName")}get serialName(){return this.getFieldValue("serialName")}getHash(){const e=n.createHash("sha1");for(const t of this.attributes)e.update(t.oid),e.update(t.value);return e.digest()}getField(e){for(const t of this.attributes)if(e===t.oid||e===t.name||e===t.shortName)return t;return null}addField(e){g([e]),this.attributes.push(e)}setAttrs(e){g(e),this.attributes=e}toJSON(){const e={};for(const t of this.attributes){const r=t.shortName;"string"==typeof r&&""!==r&&(e[r]=t.value)}return e.uniqueId=this.uniqueId,e.attributes=this.attributes,e}getFieldValue(e){const t=this.getField(e);return null!=t?t.value:""}}t.DistinguishedName=h;class d{static fromPEMs(e){const t=[],r=s.PEM.parse(e);for(const e of r){if("CERTIFICATE"!==e.type&&"X509 CERTIFICATE"!==e.type&&"TRUSTED CERTIFICATE"!==e.type)throw new Error("Could not convert certificate from PEM: invalid type");if(e.procType.includes("ENCRYPTED"))throw new Error("Could not convert certificate from PEM: PEM is encrypted.");const r=s.ASN1.fromDER(e.body);t.push(new d(r))}if(0===t.length)throw new Error("No Certificate");return t}static fromPEM(e){return d.fromPEMs(e)[0]}constructor(e){const t=Object.create(null),r=e.validate(u,t);if(null!=r)throw new Error("Cannot read X.509 certificate: "+r.message);if(this.raw=e.DER,this.version=null==t.certVersion?0:s.ASN1.parseIntegerNum(t.certVersion.bytes)+1,this.serialNumber=s.ASN1.parseIntegerStr(t.certSerialNumber.bytes),this.signatureOID=s.ASN1.parseOID(t.certSignatureOID.bytes),this.signatureAlgorithm=o.getOIDName(this.signatureOID),this.infoSignatureOID=s.ASN1.parseOID(t.certinfoSignatureOID.bytes),this.signature=s.ASN1.parseBitString(t.certSignature.bytes).buf,this.validFrom=s.ASN1.parseTime(t.certValidityNotBefore.tag,t.certValidityNotBefore.bytes),this.validTo=s.ASN1.parseTime(t.certValidityNotAfter.tag,t.certValidityNotAfter.bytes),this.issuer=new h,this.issuer.setAttrs(b(t.certIssuer)),null!=t.certIssuerUniqueId&&(this.issuer.uniqueId=s.ASN1.parseBitString(t.certIssuerUniqueId.bytes)),this.subject=new h,this.subject.setAttrs(b(t.certSubject)),null!=t.certSubjectUniqueId&&(this.subject.uniqueId=s.ASN1.parseBitString(t.certSubjectUniqueId.bytes)),this.extensions=[],this.subjectKeyIdentifier="",this.authorityKeyIdentifier="",this.ocspServer="",this.issuingCertificateURL="",this.isCA=!1,this.maxPathLen=-1,this.basicConstraintsValid=!1,this.keyUsage=0,this.dnsNames=[],this.emailAddresses=[],this.ipAddresses=[],this.uris=[],null!=t.certExtensions){this.extensions=function(e){const t=[];for(const r of e.mustCompound())for(const e of r.mustCompound())t.push(l(e));return t}(t.certExtensions);for(const e of this.extensions)if("string"==typeof e.subjectKeyIdentifier&&(this.subjectKeyIdentifier=e.subjectKeyIdentifier),"string"==typeof e.authorityKeyIdentifier&&(this.authorityKeyIdentifier=e.authorityKeyIdentifier),"string"==typeof e.authorityInfoAccessOcsp&&(this.ocspServer=e.authorityInfoAccessOcsp),"string"==typeof e.authorityInfoAccessIssuers&&(this.issuingCertificateURL=e.authorityInfoAccessIssuers),"boolean"==typeof e.basicConstraintsValid&&(this.isCA=e.isCA,this.maxPathLen=e.maxPathLen,this.basicConstraintsValid=e.basicConstraintsValid),"number"==typeof e.keyUsage&&(this.keyUsage=e.keyUsage),Array.isArray(e.altNames))for(const t of e.altNames)null!=t.dnsName&&this.dnsNames.push(t.dnsName),null!=t.email&&this.emailAddresses.push(t.email),null!=t.ip&&this.ipAddresses.push(t.ip),null!=t.uri&&this.uris.push(t.uri)}this.publicKey=new a.PublicKey(t.publicKeyInfo),this.publicKeyRaw=this.publicKey.toDER(),this.tbsCertificate=t.tbsCertificate}getExtension(e,t=""){for(const r of this.extensions)if(e===r.oid||e===r.name)return""===t?r:r[t];return null}checkSignature(e){if(3===this.version&&!this.basicConstraintsValid||this.basicConstraintsValid&&!this.isCA)return new Error("The parent constraint violation error");if(!0!==this.getExtension("keyUsage","keyCertSign"))return new Error("The parent constraint violation error");if(!e.isIssuer(this))return new Error("The parent certificate did not issue the given child certificate");const t=function(e){switch(o.getOIDName(e)){case"sha1WithRsaEncryption":case"ecdsaWithSha1":case"dsaWithSha1":return"sha1";case"md5WithRsaEncryption":return"md5";case"sha256WithRsaEncryption":case"RSASSA-PSS":case"ecdsaWithSha256":case"dsaWithSha256":return"sha256";case"sha384WithRsaEncryption":case"ecdsaWithSha384":return"sha384";case"sha512WithRsaEncryption":case"ecdsaWithSha512":return"sha512";default:return""}}(e.signatureOID);if(""===t)return new Error("Unknown child signature OID.");return!1===this.publicKey.verify(e.tbsCertificate.DER,e.signature,t)?new Error("Child signature not matched"):null}isIssuer(e){return this.issuer.getHash().equals(e.subject.getHash())}verifySubjectKeyIdentifier(){return this.publicKey.getFingerprint("sha1","PublicKey").toString("hex")===this.subjectKeyIdentifier}toJSON(){const e={};for(const t of Object.keys(this))e[t]=v(this[t]);return delete e.tbsCertificate,e}[i.inspect.custom](e,t){return t.depth<=2&&(t.depth=10),`<${this.constructor.name} ${i.inspect(this.toJSON(),t)}>`}}function l(e){const t={};switch(t.oid=s.ASN1.parseOID(e.value[0].bytes),t.critical=!1,e.value[1].tag===s.Tag.BOOLEAN?(t.critical=s.ASN1.parseBool(e.value[1].bytes),t.value=e.value[2].bytes):t.value=e.value[1].bytes,t.name=o.getOIDName(t.oid),t.name){case"keyUsage":!function(e){const t=s.ASN1.parseBitString(s.ASN1.fromDER(e.value).bytes);let r=0,i=0;e.keyUsage=0;for(let r=0;r<9;r++)0!==t.at(r)&&(e.keyUsage|=1<<r);t.buf.length>0&&(r=t.buf[0],i=t.buf.length>1?t.buf[1]:0);e.digitalSignature=128==(128&r),e.nonRepudiation=64==(64&r),e.keyEncipherment=32==(32&r),e.dataEncipherment=16==(16&r),e.keyAgreement=8==(8&r),e.keyCertSign=4==(4&r),e.cRLSign=2==(2&r),e.encipherOnly=1==(1&r),e.decipherOnly=128==(128&i)}(t);break;case"basicConstraints":!function(e){const t=s.ASN1.fromDER(e.value).mustCompound();t.length>0&&t[0].tag===s.Tag.BOOLEAN?e.isCA=s.ASN1.parseBool(t[0].bytes):e.isCA=!1;let r=null;t.length>0&&t[0].tag===s.Tag.INTEGER?r=t[0].bytes:t.length>1&&(r=t[1].bytes);e.maxPathLen=null!==r?s.ASN1.parseInteger(r):-1;e.basicConstraintsValid=!0}(t);break;case"extKeyUsage":!function(e){const t=s.ASN1.fromDER(e.value).mustCompound();for(const r of t)e[o.getOIDName(s.ASN1.parseOID(r.bytes))]=!0}(t);break;case"nsCertType":!function(e){const t=s.ASN1.parseBitString(s.ASN1.fromDER(e.value).bytes);let r=0;t.buf.length>0&&(r=t.buf[0]);e.client=128==(128&r),e.server=64==(64&r),e.email=32==(32&r),e.objsign=16==(16&r),e.reserved=8==(8&r),e.sslCA=4==(4&r),e.emailCA=2==(2&r),e.objCA=1==(1&r)}(t);break;case"subjectAltName":case"issuerAltName":f(t);break;case"subjectKeyIdentifier":!function(e){const t=s.ASN1.parseDERWithTemplate(e.value,p);e.subjectKeyIdentifier=t.subjectKeyIdentifier.bytes.toString("hex")}(t);break;case"authorityKeyIdentifier":!function(e){const t=s.ASN1.parseDERWithTemplate(e.value,y);e.authorityKeyIdentifier=t.authorityKeyIdentifier.bytes.toString("hex")}(t);break;case"authorityInfoAccess":!function(e){const t=s.ASN1.parseDERWithTemplate(e.value,m);null!=t.authorityInfoAccessOcsp&&(e.authorityInfoAccessOcsp=t.authorityInfoAccessOcsp.bytes.toString());null!=t.authorityInfoAccessIssuers&&(e.authorityInfoAccessIssuers=t.authorityInfoAccessIssuers.bytes.toString())}(t)}return t}function f(e){e.altNames=[];const t=s.ASN1.fromDER(e.value).mustCompound();for(const r of t){const t={tag:r.tag,value:r.bytes};switch(e.altNames.push(t),r.tag){case 1:t.email=r.bytes.toString();break;case 2:t.dnsName=r.bytes.toString();break;case 6:t.uri=r.bytes.toString();break;case 7:t.ip=o.bytesToIP(r.bytes);break;case 8:t.oid=s.ASN1.parseOID(r.bytes)}}}t.Certificate=d;const p={name:"subjectKeyIdentifier",class:s.Class.UNIVERSAL,tag:s.Tag.OCTETSTRING,capture:"subjectKeyIdentifier"};const y={name:"authorityKeyIdentifier",class:s.Class.UNIVERSAL,tag:s.Tag.SEQUENCE,value:[{name:"authorityKeyIdentifier.value",class:s.Class.CONTEXT_SPECIFIC,tag:s.Tag.NONE,capture:"authorityKeyIdentifier"}]};const m={name:"authorityInfoAccess",class:s.Class.UNIVERSAL,tag:s.Tag.SEQUENCE,value:[{name:"authorityInfoAccess.authorityInfoAccessOcsp",class:s.Class.UNIVERSAL,tag:s.Tag.SEQUENCE,optional:!0,value:[{name:"authorityInfoAccess.authorityInfoAccessOcsp.oid",class:s.Class.UNIVERSAL,tag:s.Tag.OID},{name:"authorityInfoAccess.authorityInfoAccessOcsp.value",class:s.Class.CONTEXT_SPECIFIC,tag:s.Tag.OID,capture:"authorityInfoAccessOcsp"}]},{name:"authorityInfoAccess.authorityInfoAccessIssuers",class:s.Class.UNIVERSAL,tag:s.Tag.SEQUENCE,optional:!0,value:[{name:"authorityInfoAccess.authorityInfoAccessIssuers.oid",class:s.Class.UNIVERSAL,tag:s.Tag.OID},{name:"authorityInfoAccess.authorityInfoAccessIssuers.value",class:s.Class.CONTEXT_SPECIFIC,tag:s.Tag.OID,capture:"authorityInfoAccessIssuers"}]}]};function g(e){for(const t of e){if(null!=t.name&&""!==t.name||(null!=t.oid&&(t.name=o.getOIDName(t.oid)),""===t.name&&null!=t.shortName&&(t.name=o.getOIDName(c[t.shortName]))),null==t.oid||""===t.oid){if(""===t.name)throw new Error("Attribute oid not specified.");t.oid=o.getOID(t.name)}if(null!=t.shortName&&""!==t.shortName||(t.shortName=null==c[t.name]?"":c[t.name]),null==t.value)throw new Error("Attribute value not specified.")}}function b(e){const t=[];for(const i of e.mustCompound())for(const e of i.mustCompound()){const i=e.mustCompound(),n={};n.oid=s.ASN1.parseOID(i[0].bytes),n.value=i[1].value,n.valueTag=i[1].tag,n.name=o.getOIDName(n.oid),n.shortName=(r=n.name,null==c[r]?"":c[r]),t.push(n)}var r;return t}function v(e){return null==e||e instanceof Buffer||"function"!=typeof e.toJSON?e:e.toJSON()}},509:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.LEB128=t.SignedLEB128=t.UnsignedLEB128=void 0,function(e){e[e.LOWER_7=127]="LOWER_7",e[e.UPPER_1=128]="UPPER_1"}(r||(r={}));const i=e=>Number.isSafeInteger(e);class n{static decode(e,t=0){const i=this.$scanForNullBytes(e,t);let n=0,s=0;for(let o=0;o<=i-t;o++){n|=(e[t+o]&r.LOWER_7)<<s,s+=7}return n}static encode(e){if(this.check(e),e<0)throw new Error(`An unsigned number must NOT be negative, ${e} is!`);let t=[],i=e;do{let e=i&r.LOWER_7;i>>=7,i&&(e|=r.UPPER_1),t.push(e)}while(i);return Uint8Array.from(t)}static check(e){if(!i(e))throw new Error(`${e} is not a safe integer!`)}static $scanForNullBytes(e,t=0){let i=t,n=0;do{if(i>=e.byteLength)throw new Error("This is not a LEB128-encoded Uint8Array, no ending found!");n=e.slice(i,i+1)[0],i++}while(n&r.UPPER_1);return i-1}static getLength(e,t=0){return this.$scanForNullBytes(e,t)-t}}t.UnsignedLEB128=n;class s{static $ceil7mul(e){let t=e;for(;t%7;)t++;return t}static check(e){if(!i(e))throw new Error(`${e} is not a safe integer!`)}static encode(e){if(this.check(e),e>=0)throw new Error(`A signed number must be negative, ${e} isn't!`);const t=Math.ceil(Math.log2(-e));return n.encode((1<<this.$ceil7mul(t))+e)}static decode(e,t=0){const r=n.decode(e,t);return-((1<<Math.ceil(Math.log2(r)))-r)}}t.SignedLEB128=s;class o{}t.LEB128=o,o.encode=e=>(e>=0?n:s).encode(e),o.decode=(e,t=0,r=!1)=>(r?s:n).decode(e,t)},1750:(e,t,r)=>{"use strict";r.d(t,{YQ:()=>F,lW:()=>g,zc:()=>V,te:()=>l,A6:()=>h,Cz:()=>m,Vs:()=>H,qw:()=>q,gZ:()=>n,xg:()=>z,Ve:()=>j,cN:()=>i,VU:()=>v,_K:()=>a,fi:()=>c});var i,n,s=r(295);!function(e){e[e.Sequence=0]="Sequence",e[e.Set=1]="Set",e[e.Choice=2]="Choice"}(i||(i={})),function(e){e[e.Any=1]="Any",e[e.Boolean=2]="Boolean",e[e.OctetString=3]="OctetString",e[e.BitString=4]="BitString",e[e.Integer=5]="Integer",e[e.Enumerated=6]="Enumerated",e[e.ObjectIdentifier=7]="ObjectIdentifier",e[e.Utf8String=8]="Utf8String",e[e.BmpString=9]="BmpString",e[e.UniversalString=10]="UniversalString",e[e.NumericString=11]="NumericString",e[e.PrintableString=12]="PrintableString",e[e.TeletexString=13]="TeletexString",e[e.VideotexString=14]="VideotexString",e[e.IA5String=15]="IA5String",e[e.GraphicString=16]="GraphicString",e[e.VisibleString=17]="VisibleString",e[e.GeneralString=18]="GeneralString",e[e.CharacterString=19]="CharacterString",e[e.UTCTime=20]="UTCTime",e[e.GeneralizedTime=21]="GeneralizedTime",e[e.DATE=22]="DATE",e[e.TimeOfDay=23]="TimeOfDay",e[e.DateTime=24]="DateTime",e[e.Duration=25]="Duration",e[e.TIME=26]="TIME",e[e.Null=27]="Null"}(n||(n={}));var o=r(9715);class a{constructor(e,t=0){if(this.unusedBits=0,this.value=new ArrayBuffer(0),e)if("number"==typeof e)this.fromNumber(e);else{if(!o.vJ.isBufferSource(e))throw TypeError("Unsupported type of 'params' argument for BitString");this.unusedBits=t,this.value=o.vJ.toArrayBuffer(e)}}fromASN(e){if(!(e instanceof s.BitString))throw new TypeError("Argument 'asn' is not instance of ASN.1 BitString");return this.unusedBits=e.valueBlock.unusedBits,this.value=e.valueBlock.valueHex,this}toASN(){return new s.BitString({unusedBits:this.unusedBits,valueHex:this.value})}toSchema(e){return new s.BitString({name:e})}toNumber(){let e="";const t=new Uint8Array(this.value);for(const r of t)e+=r.toString(2).padStart(8,"0");return e=e.split("").reverse().join(""),this.unusedBits&&(e=e.slice(this.unusedBits).padStart(this.unusedBits,"0")),parseInt(e,2)}fromNumber(e){let t=e.toString(2);const r=t.length+7>>3;this.unusedBits=(r<<3)-t.length;const i=new Uint8Array(r);t=t.padStart(r<<3,"0").split("").reverse().join("");let n=0;for(;n<r;)i[n]=parseInt(t.slice(n<<3,8+(n<<3)),2),n++;this.value=i.buffer}}class c{constructor(e){"number"==typeof e?this.buffer=new ArrayBuffer(e):o.vJ.isBufferSource(e)?this.buffer=o.vJ.toArrayBuffer(e):Array.isArray(e)?this.buffer=new Uint8Array(e):this.buffer=new ArrayBuffer(0)}get byteLength(){return this.buffer.byteLength}get byteOffset(){return 0}fromASN(e){if(!(e instanceof s.OctetString))throw new TypeError("Argument 'asn' is not instance of ASN.1 OctetString");return this.buffer=e.valueBlock.valueHex,this}toASN(){return new s.OctetString({valueHex:this.buffer})}toSchema(e){return new s.OctetString({name:e})}}const u={fromASN:e=>e instanceof s.Null?null:e.valueBeforeDecodeView,toASN:e=>{if(null===e)return new s.Null;const t=s.fromBER(e);if(t.result.error)throw new Error(t.result.error);return t.result}},h={fromASN:e=>e.valueBlock.valueHexView.byteLength>=4?e.valueBlock.toString():e.valueBlock.valueDec,toASN:e=>new s.Integer({value:+e})},d={fromASN:e=>e.valueBlock.valueDec,toASN:e=>new s.Enumerated({value:e})},l={fromASN:e=>e.valueBlock.valueHexView,toASN:e=>new s.Integer({valueHex:e})},f={fromASN:e=>e.valueBlock.valueHexView,toASN:e=>new s.BitString({valueHex:e})},p={fromASN:e=>e.valueBlock.toString(),toASN:e=>new s.ObjectIdentifier({value:e})},y={fromASN:e=>e.valueBlock.value,toASN:e=>new s.Boolean({value:e})},m={fromASN:e=>e.valueBlock.valueHexView,toASN:e=>new s.OctetString({valueHex:e})},g={fromASN:e=>new c(e.getValue()),toASN:e=>e.toASN()};function b(e){return{fromASN:e=>e.valueBlock.value,toASN:t=>new e({value:t})}}const v=b(s.Utf8String),w=b(s.BmpString),S=b(s.UniversalString),_=b(s.NumericString),A=b(s.PrintableString),E=b(s.TeletexString),C=b(s.VideotexString),k=b(s.IA5String),T=b(s.GraphicString),P=b(s.VisibleString),I=b(s.GeneralString),R=b(s.CharacterString),x={fromASN:e=>e.toDate(),toASN:e=>new s.UTCTime({valueDate:e})},B={fromASN:e=>e.toDate(),toASN:e=>new s.GeneralizedTime({valueDate:e})},O={fromASN:()=>null,toASN:()=>new s.Null};function M(e){switch(e){case n.Any:return u;case n.BitString:return f;case n.BmpString:return w;case n.Boolean:return y;case n.CharacterString:return R;case n.Enumerated:return d;case n.GeneralString:return I;case n.GeneralizedTime:return B;case n.GraphicString:return T;case n.IA5String:return k;case n.Integer:return h;case n.Null:return O;case n.NumericString:return _;case n.ObjectIdentifier:return p;case n.OctetString:return m;case n.PrintableString:return A;case n.TeletexString:return E;case n.UTCTime:return x;case n.UniversalString:return S;case n.Utf8String:return v;case n.VideotexString:return C;case n.VisibleString:return P;default:return null}}function N(e){return"function"==typeof e&&e.prototype?!(!e.prototype.toASN||!e.prototype.fromASN)||N(e.prototype):!!(e&&"object"==typeof e&&"toASN"in e&&"fromASN"in e)}function D(e){var t;if(e){const r=Object.getPrototypeOf(e);return(null===(t=null==r?void 0:r.prototype)||void 0===t?void 0:t.constructor)===Array||D(r)}return!1}function L(e,t){if(!e||!t)return!1;if(e.byteLength!==t.byteLength)return!1;const r=new Uint8Array(e),i=new Uint8Array(t);for(let t=0;t<e.byteLength;t++)if(r[t]!==i[t])return!1;return!0}const U=new class{constructor(){this.items=new WeakMap}has(e){return this.items.has(e)}get(e,t=!1){const r=this.items.get(e);if(!r)throw new Error(`Cannot get schema for '${e.prototype.constructor.name}' target`);if(t&&!r.schema)throw new Error(`Schema '${e.prototype.constructor.name}' doesn't contain ASN.1 schema. Call 'AsnSchemaStorage.cache'.`);return r}cache(e){const t=this.get(e);t.schema||(t.schema=this.create(e,!0))}createDefault(e){const t={type:i.Sequence,items:{}},r=this.findParentSchema(e);return r&&(Object.assign(t,r),t.items=Object.assign({},t.items,r.items)),t}create(e,t){const r=this.items.get(e)||this.createDefault(e),o=[];for(const e in r.items){const a=r.items[e],c=t?e:"";let u;if("number"==typeof a.type){const e=n[a.type],t=s[e];if(!t)throw new Error(`Cannot get ASN1 class by name '${e}'`);u=new t({name:c})}else if(N(a.type)){u=(new a.type).toSchema(c)}else if(a.optional){this.get(a.type).type===i.Choice?u=new s.Any({name:c}):(u=this.create(a.type,!1),u.name=c)}else u=new s.Any({name:c});const h=!!a.optional||void 0!==a.defaultValue;if(a.repeated){u.name="";u=new("set"===a.repeated?s.Set:s.Sequence)({name:"",value:[new s.Repeated({name:c,value:u})]})}if(null!==a.context&&void 0!==a.context)if(a.implicit)if("number"==typeof a.type||N(a.type)){const e=a.repeated?s.Constructed:s.Primitive;o.push(new e({name:c,optional:h,idBlock:{tagClass:3,tagNumber:a.context}}))}else{this.cache(a.type);const e=!!a.repeated;let t=e?u:this.get(a.type,!0).schema;t="valueBlock"in t?t.valueBlock.value:t.value,o.push(new s.Constructed({name:e?"":c,optional:h,idBlock:{tagClass:3,tagNumber:a.context},value:t}))}else o.push(new s.Constructed({optional:h,idBlock:{tagClass:3,tagNumber:a.context},value:[u]}));else u.optional=h,o.push(u)}switch(r.type){case i.Sequence:return new s.Sequence({value:o,name:""});case i.Set:return new s.Set({value:o,name:""});case i.Choice:return new s.Choice({value:o,name:""});default:throw new Error("Unsupported ASN1 type in use")}}set(e,t){return this.items.set(e,t),this}findParentSchema(e){const t=Object.getPrototypeOf(e);if(t){return this.items.get(t)||this.findParentSchema(t)}return null}},j=e=>t=>{let r;U.has(t)?r=U.get(t):(r=U.createDefault(t),U.set(t,r)),Object.assign(r,e)},q=e=>(t,r)=>{let i;U.has(t.constructor)?i=U.get(t.constructor):(i=U.createDefault(t.constructor),U.set(t.constructor,i));const n=Object.assign({},e);if("number"==typeof n.type&&!n.converter){const i=M(e.type);if(!i)throw new Error(`Cannot get default converter for property '${r}' of ${t.constructor.name}`);n.converter=i}i.items[r]=n};class K extends Error{constructor(){super(...arguments),this.schemas=[]}}class H{static parse(e,t){const r=s.fromBER(e);if(r.result.error)throw new Error(r.result.error);return this.fromASN(r.result,t)}static fromASN(e,t){var r;try{if(N(t)){return(new t).fromASN(e)}const o=U.get(t);U.cache(t);let a=o.schema;if(e.constructor===s.Constructed&&o.type!==i.Choice){a=new s.Constructed({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:o.schema.valueBlock.value});for(const t in o.items)delete e[t]}const c=s.compareSchema({},e,a);if(!c.verified)throw new K(`Data does not match to ${t.name} ASN1 schema. ${c.result.error}`);const u=new t;if(D(t)){if(!("value"in e.valueBlock)||!Array.isArray(e.valueBlock.value))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");const r=o.itemType;if("number"==typeof r){const i=M(r);if(!i)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);return t.from(e.valueBlock.value,(e=>i.fromASN(e)))}return t.from(e.valueBlock.value,(e=>this.fromASN(e,r)))}for(const e in o.items){const t=c.result[e];if(!t)continue;const i=o.items[e],a=i.type;if("number"==typeof a||N(a)){const o=null!==(r=i.converter)&&void 0!==r?r:N(a)?new a:null;if(!o)throw new Error("Converter is empty");if(i.repeated)if(i.implicit){const r=new("sequence"===i.repeated?s.Sequence:s.Set);r.valueBlock=t.valueBlock;const n=s.fromBER(r.toBER(!1));if(-1===n.offset)throw new Error(`Cannot parse the child item. ${n.result.error}`);if(!("value"in n.result.valueBlock)||!Array.isArray(n.result.valueBlock.value))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");const a=n.result.valueBlock.value;u[e]=Array.from(a,(e=>o.fromASN(e)))}else u[e]=Array.from(t,(e=>o.fromASN(e)));else{let r=t;if(i.implicit){let e;if(N(a))e=(new a).toSchema("");else{const t=n[a],r=s[t];if(!r)throw new Error(`Cannot get '${t}' class from asn1js module`);e=new r}e.valueBlock=r.valueBlock,r=s.fromBER(e.toBER(!1)).result}u[e]=o.fromASN(r)}}else if(i.repeated){if(!Array.isArray(t))throw new Error("Cannot get list of items from the ASN.1 parsed value. ASN.1 value should be iterable.");u[e]=Array.from(t,(e=>this.fromASN(e,a)))}else u[e]=this.fromASN(t,a)}return u}catch(e){throw e instanceof K&&e.schemas.push(t.name),e}}}class z{static serialize(e){return e instanceof s.BaseBlock?e.toBER(!1):this.toASN(e).toBER(!1)}static toASN(e){if(e&&"object"==typeof e&&N(e))return e.toASN();if(!e||"object"!=typeof e)throw new TypeError("Parameter 1 should be type of Object.");const t=e.constructor,r=U.get(t);U.cache(t);let n,o=[];if(r.itemType){if(!Array.isArray(e))throw new TypeError("Parameter 1 should be type of Array.");if("number"==typeof r.itemType){const i=M(r.itemType);if(!i)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);o=e.map((e=>i.toASN(e)))}else o=e.map((e=>this.toAsnItem({type:r.itemType},"[]",t,e)))}else for(const i in r.items){const n=r.items[i],a=e[i];if(void 0===a||n.defaultValue===a||"object"==typeof n.defaultValue&&"object"==typeof a&&L(this.serialize(n.defaultValue),this.serialize(a)))continue;const c=z.toAsnItem(n,i,t,a);if("number"==typeof n.context)if(n.implicit)if(n.repeated||"number"!=typeof n.type&&!N(n.type))o.push(new s.Constructed({optional:n.optional,idBlock:{tagClass:3,tagNumber:n.context},value:c.valueBlock.value}));else{const e={};e.valueHex=c instanceof s.Null?c.valueBeforeDecodeView:c.valueBlock.toBER(),o.push(new s.Primitive({optional:n.optional,idBlock:{tagClass:3,tagNumber:n.context},...e}))}else o.push(new s.Constructed({optional:n.optional,idBlock:{tagClass:3,tagNumber:n.context},value:[c]}));else n.repeated?o=o.concat(c):o.push(c)}switch(r.type){case i.Sequence:n=new s.Sequence({value:o});break;case i.Set:n=new s.Set({value:o});break;case i.Choice:if(!o[0])throw new Error(`Schema '${t.name}' has wrong data. Choice cannot be empty.`);n=o[0]}return n}static toAsnItem(e,t,r,i){let o;if("number"==typeof e.type){const a=e.converter;if(!a)throw new Error(`Property '${t}' doesn't have converter for type ${n[e.type]} in schema '${r.name}'`);if(e.repeated){if(!Array.isArray(i))throw new TypeError("Parameter 'objProp' should be type of Array.");const t=Array.from(i,(e=>a.toASN(e)));o=new("sequence"===e.repeated?s.Sequence:s.Set)({value:t})}else o=a.toASN(i)}else if(e.repeated){if(!Array.isArray(i))throw new TypeError("Parameter 'objProp' should be type of Array.");const t=Array.from(i,(e=>this.toASN(e)));o=new("sequence"===e.repeated?s.Sequence:s.Set)({value:t})}else o=this.toASN(i);return o}}class F extends Array{constructor(e=[]){if("number"==typeof e)super(e);else{super();for(const t of e)this.push(t)}}}class V{static serialize(e){return z.serialize(e)}static parse(e,t){return H.parse(e,t)}static toString(e){const t=o.vJ.isBufferSource(e)?o.vJ.toArrayBuffer(e):V.serialize(e),r=s.fromBER(t);if(-1===r.offset)throw new Error(`Cannot decode ASN.1 data. ${r.result.error}`);return r.result.toString()}}},4058:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Crypto:()=>ur,CryptoKey:()=>G});var i,n=r(9715),s=r(1750),o=r(1443);class a extends Error{constructor(e,t){super(t?`${e}. See the inner exception for more details.`:e),this.message=e,this.innerError=t}}class c extends a{constructor(e,t,r){super(t,r),this.schema=e}}class u extends c{constructor(e,t,r){super(e,`JSON doesn't match to '${e.target.name}' schema. ${t}`,r)}}class h extends a{}class d extends a{constructor(e,t,r){super(`Cannot serialize by '${e}' schema. ${t}`,r),this.schemaName=e}}class l extends u{constructor(e,t,r={}){super(e,"Some keys doesn't match to schema"),this.keys=t,this.errors=r}}function f(e,t){if(!function(e,t){switch(t){case i.Boolean:return"boolean"==typeof e;case i.Number:return"number"==typeof e;case i.String:return"string"==typeof e}return!0}(e,t))throw new TypeError(`Value must be ${i[t]}`)}function p(e){return e&&e.prototype?!(!e.prototype.toJSON||!e.prototype.fromJSON)||p(e.prototype):!!(e&&e.toJSON&&e.fromJSON)}!function(e){e[e.Any=0]="Any",e[e.Boolean=1]="Boolean",e[e.Number=2]="Number",e[e.String=3]="String"}(i||(i={}));const y="default",m=new class{constructor(){this.items=new Map}has(e){return this.items.has(e)||!!this.findParentSchema(e)}get(e){const t=this.items.get(e)||this.findParentSchema(e);if(!t)throw new Error("Cannot get schema for current target");return t}create(e){const t={names:{}},r=this.findParentSchema(e);if(r){Object.assign(t,r),t.names={};for(const e in r.names)t.names[e]=Object.assign({},r.names[e])}return t.target=e,t}set(e,t){return this.items.set(e,t),this}findParentSchema(e){const t=e.__proto__;if(t){return this.items.get(t)||this.findParentSchema(t)}return null}};class g{constructor(e){this.pattern=new RegExp(e)}validate(e){const t=new RegExp(this.pattern.source,this.pattern.flags);if("string"!=typeof e)throw new h("Incoming value must be string");if(!t.exec(e))throw new h(`Value doesn't match to pattern '${t.toString()}'`)}}class b{constructor(e=Number.MIN_VALUE,t=Number.MAX_VALUE){this.min=e,this.max=t}validate(e){if(f(e,i.Number),!(this.min<=e&&e<=this.max)){const e=this.min===Number.MIN_VALUE?"MIN":this.min,t=this.max===Number.MAX_VALUE?"MAX":this.max;throw new h(`Value doesn't match to diapason [${e},${t}]`)}}}class v{constructor(e=Number.MIN_VALUE,t=Number.MAX_VALUE){this.min=e,this.max=t}validate(e){if(f(e,i.Number),!(this.min<e&&e<this.max)){const e=this.min===Number.MIN_VALUE?"MIN":this.min,t=this.max===Number.MAX_VALUE?"MAX":this.max;throw new h(`Value doesn't match to diapason (${e},${t})`)}}}class w{constructor(e,t,r){this.length=e,this.minLength=t,this.maxLength=r}validate(e){if(void 0===this.length){if(void 0!==this.minLength&&e.length<this.minLength)throw new h(`Value length must be more than ${this.minLength}.`);if(void 0!==this.maxLength&&e.length>this.maxLength)throw new h(`Value length must be less than ${this.maxLength}.`)}else if(e.length!==this.length)throw new h(`Value length must be exactly ${this.length}.`)}}class S{constructor(e){this.enumeration=e}validate(e){if(f(e,i.String),!this.enumeration.includes(e))throw new h(`Value must be one of ${this.enumeration.map((e=>`'${e}'`)).join(", ")}`)}}class _{static checkValues(e,t){const r=Array.isArray(e)?e:[e];for(const i of r)for(const r of t.validations)r instanceof w&&t.repeated?r.validate(e):r.validate(i)}static checkTypes(e,t){if(t.repeated&&!Array.isArray(e))throw new TypeError("Value must be Array");if("number"==typeof t.type){const r=Array.isArray(e)?e:[e];for(const e of r)f(e,t.type)}}static getSchemaByName(e,t="default"){return{...e.names.default,...e.names[t]}}}class A extends _{static serialize(e,t,r,i){const n=this.toJSON(e,t);return JSON.stringify(n,r,i)}static toJSON(e,t={}){let r,i=t.targetSchema;const n=t.schemaName||y;if(p(e))return e.toJSON();if(Array.isArray(e)){r=[];for(const i of e)r.push(this.toJSON(i,t))}else if("object"==typeof e){if(i&&!m.has(i))throw new a("Cannot get schema for `targetSchema` param");if(i=i||e.constructor,m.has(i)){const t=m.get(i);r={};const s=this.getSchemaByName(t,n);for(const o in s)try{const t=s[o],a=e[o];let c;if(t.optional&&void 0===a||void 0!==t.defaultValue&&a===t.defaultValue)continue;if(!t.optional&&void 0===a)throw new d(i.name,`Property '${o}' is required.`);c="number"==typeof t.type?t.converter?t.repeated?a.map((r=>t.converter.toJSON(r,e))):t.converter.toJSON(a,e):a:t.repeated?a.map((e=>this.toJSON(e,{schemaName:n}))):this.toJSON(a,{schemaName:n}),this.checkTypes(c,t),this.checkValues(c,t),r[t.name||o]=c}catch(e){throw e instanceof d?e:new d(t.target.name,`Property '${o}' is wrong. ${e.message}`,e)}}else{r={};for(const t in e)r[t]=this.toJSON(e[t],{schemaName:n})}}else r=e;return r}}class E extends _{static parse(e,t){const r=JSON.parse(e);return this.fromJSON(r,t)}static fromJSON(e,t){const r=t.targetSchema,i=t.schemaName||y,n=new r;if(p(n))return n.fromJSON(e);const s=m.get(r),o=this.getSchemaByName(s,i),a={};t.strictProperty&&!Array.isArray(e)&&E.checkStrictProperty(e,o,s);for(const r in o)try{const a=o[r],c=a.name||r,h=e[c];if(void 0===h&&(a.optional||void 0!==a.defaultValue))continue;if(!a.optional&&void 0===h)throw new u(s,`Property '${c}' is required.`);if(this.checkTypes(h,a),this.checkValues(h,a),"number"==typeof a.type)a.converter?a.repeated?n[r]=h.map((e=>a.converter.fromJSON(e,n))):n[r]=a.converter.fromJSON(h,n):n[r]=h;else{const e={...t,targetSchema:a.type,schemaName:i};a.repeated?n[r]=h.map((t=>this.fromJSON(t,e))):n[r]=this.fromJSON(h,e)}}catch(e){if(e instanceof u||(e=new u(s,`Property '${r}' is wrong. ${e.message}`,e)),!t.strictAllKeys)throw e;a[r]=e}const c=Object.keys(a);if(c.length)throw new l(s,c,a);return n}static checkStrictProperty(e,t,r){const i=Object.keys(e),n=Object.keys(t),s=[];for(const e of i)-1===n.indexOf(e)&&s.push(e);if(s.length)throw new l(r,s)}}const C=(e={})=>(t,r)=>{const n=`Cannot set type for ${r} property of ${t.constructor.name} schema`;let s;m.has(t.constructor)?(s=m.get(t.constructor),s.target!==t.constructor&&(s=m.create(t.constructor),m.set(t.constructor,s))):(s=m.create(t.constructor),m.set(t.constructor,s));const o={type:i.Any,validations:[]},a=Object.assign(o,e);if(a.validations=function(e){const t=[];return e.pattern&&t.push(new g(e.pattern)),e.type!==i.Number&&e.type!==i.Any||(void 0===e.minInclusive&&void 0===e.maxInclusive||t.push(new b(e.minInclusive,e.maxInclusive)),void 0===e.minExclusive&&void 0===e.maxExclusive||t.push(new v(e.minExclusive,e.maxExclusive)),void 0!==e.enumeration&&t.push(new S(e.enumeration))),(e.type===i.String||e.repeated||e.type===i.Any)&&(void 0===e.length&&void 0===e.minLength&&void 0===e.maxLength||t.push(new w(e.length,e.minLength,e.maxLength))),t}(a),"number"!=typeof a.type&&!m.has(a.type)&&!p(a.type))throw new Error(`${n}. Assigning type doesn't have schema.`);let c;c=Array.isArray(e.schema)?e.schema:[e.schema||y];for(const e of c){s.names[e]||(s.names[e]={});s.names[e][r]=a}};var k=r(295);class T extends Error{}class P extends T{}class I extends T{constructor(e){super("Unsupported operation: "+(e?`${e}`:""))}}class R extends T{}class x extends T{constructor(e){super(`${e}: Missing required property`)}}class B{async digest(...e){return this.checkDigest.apply(this,e),this.onDigest.apply(this,e)}checkDigest(e,t){this.checkAlgorithmName(e)}async onDigest(e,t){throw new I("digest")}async generateKey(...e){return this.checkGenerateKey.apply(this,e),this.onGenerateKey.apply(this,e)}checkGenerateKey(e,t,r,...i){if(this.checkAlgorithmName(e),this.checkGenerateKeyParams(e),!r||!r.length)throw new TypeError("Usages cannot be empty when creating a key.");let n;n=Array.isArray(this.usages)?this.usages:this.usages.privateKey.concat(this.usages.publicKey),this.checkKeyUsages(r,n)}checkGenerateKeyParams(e){}async onGenerateKey(e,t,r,...i){throw new I("generateKey")}async sign(...e){return this.checkSign.apply(this,e),this.onSign.apply(this,e)}checkSign(e,t,r,...i){this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(t,"sign")}async onSign(e,t,r,...i){throw new I("sign")}async verify(...e){return this.checkVerify.apply(this,e),this.onVerify.apply(this,e)}checkVerify(e,t,r,i,...n){this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(t,"verify")}async onVerify(e,t,r,i,...n){throw new I("verify")}async encrypt(...e){return this.checkEncrypt.apply(this,e),this.onEncrypt.apply(this,e)}checkEncrypt(e,t,r,i={},...n){this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(t,i.keyUsage?"encrypt":void 0)}async onEncrypt(e,t,r,...i){throw new I("encrypt")}async decrypt(...e){return this.checkDecrypt.apply(this,e),this.onDecrypt.apply(this,e)}checkDecrypt(e,t,r,i={},...n){this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(t,i.keyUsage?"decrypt":void 0)}async onDecrypt(e,t,r,...i){throw new I("decrypt")}async deriveBits(...e){return this.checkDeriveBits.apply(this,e),this.onDeriveBits.apply(this,e)}checkDeriveBits(e,t,r,i={},...n){if(this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(t,i.keyUsage?"deriveBits":void 0),r%8!=0)throw new R("length: Is not multiple of 8")}async onDeriveBits(e,t,r,...i){throw new I("deriveBits")}async exportKey(...e){return this.checkExportKey.apply(this,e),this.onExportKey.apply(this,e)}checkExportKey(e,t,...r){if(this.checkKeyFormat(e),this.checkCryptoKey(t),!t.extractable)throw new T("key: Is not extractable")}async onExportKey(e,t,...r){throw new I("exportKey")}async importKey(...e){return this.checkImportKey.apply(this,e),this.onImportKey.apply(this,e)}checkImportKey(e,t,r,i,n,...s){this.checkKeyFormat(e),this.checkKeyData(e,t),this.checkAlgorithmName(r),this.checkImportParams(r),Array.isArray(this.usages)&&this.checkKeyUsages(n,this.usages)}async onImportKey(e,t,r,i,n,...s){throw new I("importKey")}checkAlgorithmName(e){if(e.name.toLowerCase()!==this.name.toLowerCase())throw new P("Unrecognized name")}checkAlgorithmParams(e){}checkDerivedKeyParams(e){}checkKeyUsages(e,t){for(const r of e)if(-1===t.indexOf(r))throw new TypeError("Cannot create a key using the specified key usages")}checkCryptoKey(e,t){if(this.checkAlgorithmName(e.algorithm),t&&-1===e.usages.indexOf(t))throw new T("key does not match that of operation")}checkRequiredProperty(e,t){if(!(t in e))throw new x(t)}checkHashAlgorithm(e,t){for(const r of t)if(r.toLowerCase()===e.name.toLowerCase())return;throw new R(`hash: Must be one of ${t.join(", ")}`)}checkImportParams(e){}checkKeyFormat(e){switch(e){case"raw":case"pkcs8":case"spki":case"jwk":break;default:throw new TypeError("format: Is invalid value. Must be 'jwk', 'raw', 'spki', or 'pkcs8'")}}checkKeyData(e,t){if(!t)throw new TypeError("keyData: Cannot be empty on empty on key importing");if("jwk"===e){if("object"!=typeof(r=t)||!("kty"in r))throw new TypeError("keyData: Is not JsonWebToken")}else if(!n.vJ.isBufferSource(t))throw new TypeError("keyData: Is not ArrayBufferView or ArrayBuffer");var r}prepareData(e){return n.vJ.toArrayBuffer(e)}}class O extends B{checkGenerateKeyParams(e){if(this.checkRequiredProperty(e,"length"),"number"!=typeof e.length)throw new TypeError("length: Is not of type Number");switch(e.length){case 128:case 192:case 256:break;default:throw new TypeError("length: Must be 128, 192, or 256")}}checkDerivedKeyParams(e){this.checkGenerateKeyParams(e)}}class M extends O{constructor(){super(...arguments),this.name="AES-CBC",this.usages=["encrypt","decrypt","wrapKey","unwrapKey"]}checkAlgorithmParams(e){if(this.checkRequiredProperty(e,"iv"),!(e.iv instanceof ArrayBuffer||ArrayBuffer.isView(e.iv)))throw new TypeError("iv: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(16!==e.iv.byteLength)throw new TypeError("iv: Must have length 16 bytes")}}class N extends O{constructor(){super(...arguments),this.name="AES-CMAC",this.usages=["sign","verify"]}checkAlgorithmParams(e){if(this.checkRequiredProperty(e,"length"),"number"!=typeof e.length)throw new TypeError("length: Is not a Number");if(e.length<1)throw new R("length: Must be more than 0")}}class D extends O{constructor(){super(...arguments),this.name="AES-CTR",this.usages=["encrypt","decrypt","wrapKey","unwrapKey"]}checkAlgorithmParams(e){if(this.checkRequiredProperty(e,"counter"),!(e.counter instanceof ArrayBuffer||ArrayBuffer.isView(e.counter)))throw new TypeError("counter: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(16!==e.counter.byteLength)throw new TypeError("iv: Must have length 16 bytes");if(this.checkRequiredProperty(e,"length"),"number"!=typeof e.length)throw new TypeError("length: Is not a Number");if(e.length<1)throw new R("length: Must be more than 0")}}class L extends O{constructor(){super(...arguments),this.name="AES-ECB",this.usages=["encrypt","decrypt","wrapKey","unwrapKey"]}}class U extends O{constructor(){super(...arguments),this.name="AES-GCM",this.usages=["encrypt","decrypt","wrapKey","unwrapKey"]}checkAlgorithmParams(e){if(this.checkRequiredProperty(e,"iv"),!(e.iv instanceof ArrayBuffer||ArrayBuffer.isView(e.iv)))throw new TypeError("iv: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(e.iv.byteLength<1)throw new R("iv: Must have length more than 0 and less than 2^64 - 1");switch("tagLength"in e||(e.tagLength=128),e.tagLength){case 32:case 64:case 96:case 104:case 112:case 120:case 128:break;default:throw new R("tagLength: Must be one of 32, 64, 96, 104, 112, 120 or 128")}}}class j extends O{constructor(){super(...arguments),this.name="AES-KW",this.usages=["wrapKey","unwrapKey"]}}class q extends B{constructor(){super(...arguments),this.usages=["encrypt","decrypt","wrapKey","unwrapKey"]}checkAlgorithmParams(e){if(this.ivSize){if(this.checkRequiredProperty(e,"iv"),!(e.iv instanceof ArrayBuffer||ArrayBuffer.isView(e.iv)))throw new TypeError("iv: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(e.iv.byteLength!==this.ivSize)throw new TypeError(`iv: Must have length ${this.ivSize} bytes`)}}checkGenerateKeyParams(e){if(this.checkRequiredProperty(e,"length"),"number"!=typeof e.length)throw new TypeError("length: Is not of type Number");if(e.length!==this.keySizeBits)throw new R(`algorithm.length: Must be ${this.keySizeBits}`)}checkDerivedKeyParams(e){this.checkGenerateKeyParams(e)}}class K extends B{constructor(){super(...arguments),this.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"]}checkGenerateKeyParams(e){if(this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms),this.checkRequiredProperty(e,"publicExponent"),!(e.publicExponent&&e.publicExponent instanceof Uint8Array))throw new TypeError("publicExponent: Missing or not a Uint8Array");const t=n.ep.ToBase64(e.publicExponent);if("Aw=="!==t&&"AQAB"!==t)throw new TypeError("publicExponent: Must be [3] or [1,0,1]");if(this.checkRequiredProperty(e,"modulusLength"),e.modulusLength%8||e.modulusLength<256||e.modulusLength>16384)throw new TypeError("The modulus length must be a multiple of 8 bits and >= 256 and <= 16384")}checkImportParams(e){this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms)}}class H extends K{constructor(){super(...arguments),this.name="RSASSA-PKCS1-v1_5",this.usages={privateKey:["sign"],publicKey:["verify"]}}}class z extends K{constructor(){super(...arguments),this.name="RSA-PSS",this.usages={privateKey:["sign"],publicKey:["verify"]}}checkAlgorithmParams(e){if(this.checkRequiredProperty(e,"saltLength"),"number"!=typeof e.saltLength)throw new TypeError("saltLength: Is not a Number");if(e.saltLength<0)throw new RangeError("saltLength: Must be positive number")}}class F extends K{constructor(){super(...arguments),this.name="RSA-OAEP",this.usages={privateKey:["decrypt","unwrapKey"],publicKey:["encrypt","wrapKey"]}}checkAlgorithmParams(e){if(e.label&&!(e.label instanceof ArrayBuffer||ArrayBuffer.isView(e.label)))throw new TypeError("label: Is not of type '(ArrayBuffer or ArrayBufferView)'")}}class V extends B{checkGenerateKeyParams(e){this.checkRequiredProperty(e,"namedCurve"),this.checkNamedCurve(e.namedCurve)}checkNamedCurve(e){for(const t of this.namedCurves)if(t.toLowerCase()===e.toLowerCase())return;throw new R(`namedCurve: Must be one of ${this.namedCurves.join(", ")}`)}}class $ extends V{constructor(){super(...arguments),this.name="ECDSA",this.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],this.usages={privateKey:["sign"],publicKey:["verify"]},this.namedCurves=["P-256","P-384","P-521","K-256"]}checkAlgorithmParams(e){this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms)}}const W=["secret","private","public"];class G{static create(e,t,r,i){const n=new this;return n.algorithm=e,n.type=t,n.extractable=r,n.usages=i,n}static isKeyType(e){return-1!==W.indexOf(e)}get[Symbol.toStringTag](){return"CryptoKey"}}class J extends V{constructor(){super(...arguments),this.name="ECDH",this.usages={privateKey:["deriveBits","deriveKey"],publicKey:[]},this.namedCurves=["P-256","P-384","P-521","K-256"]}checkAlgorithmParams(e){if(this.checkRequiredProperty(e,"public"),!(e.public instanceof G))throw new TypeError("public: Is not a CryptoKey");if("public"!==e.public.type)throw new R("public: Is not a public key");if(e.public.algorithm.name!==this.name)throw new R(`public: Is not ${this.name} key`)}}class Y extends J{constructor(){super(...arguments),this.name="ECDH-ES",this.namedCurves=["X25519","X448"]}}class Z extends V{constructor(){super(...arguments),this.name="EdDSA",this.usages={privateKey:["sign"],publicKey:["verify"]},this.namedCurves=["Ed25519","Ed448"]}}let X=class{constructor(e){e&&(this.value=e)}};(0,o.__decorate)([(0,s.qw)({type:s.gZ.ObjectIdentifier})],X.prototype,"value",void 0),X=(0,o.__decorate)([(0,s.Ve)({type:s.cN.Choice})],X);class Q{constructor(e){Object.assign(this,e)}}(0,o.__decorate)([(0,s.qw)({type:s.gZ.ObjectIdentifier})],Q.prototype,"algorithm",void 0),(0,o.__decorate)([(0,s.qw)({type:s.gZ.Any,optional:!0})],Q.prototype,"parameters",void 0);class ee{constructor(){this.version=0,this.privateKeyAlgorithm=new Q,this.privateKey=new ArrayBuffer(0)}}(0,o.__decorate)([(0,s.qw)({type:s.gZ.Integer})],ee.prototype,"version",void 0),(0,o.__decorate)([(0,s.qw)({type:Q})],ee.prototype,"privateKeyAlgorithm",void 0),(0,o.__decorate)([(0,s.qw)({type:s.gZ.OctetString})],ee.prototype,"privateKey",void 0),(0,o.__decorate)([(0,s.qw)({type:s.gZ.Any,optional:!0})],ee.prototype,"attributes",void 0);class te{constructor(){this.publicKeyAlgorithm=new Q,this.publicKey=new ArrayBuffer(0)}}(0,o.__decorate)([(0,s.qw)({type:Q})],te.prototype,"publicKeyAlgorithm",void 0),(0,o.__decorate)([(0,s.qw)({type:s.gZ.BitString})],te.prototype,"publicKey",void 0);const re={fromJSON:e=>n.ep.FromBase64Url(e),toJSON:e=>n.ep.ToBase64Url(new Uint8Array(e))},ie={fromASN:e=>{const t=e.valueBlock.valueHex;return new Uint8Array(t)[0]?e.valueBlock.valueHex:e.valueBlock.valueHex.slice(1)},toASN:e=>{const t=new Uint8Array(e)[0]>127?(0,n.$e)(new Uint8Array([0]).buffer,e):e;return new k.Integer({valueHex:t})}};class ne{constructor(){this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0)}}(0,o.__decorate)([(0,s.qw)({type:s.gZ.Integer,converter:s.A6})],ne.prototype,"version",void 0),(0,o.__decorate)([(0,s.qw)({type:s.gZ.Integer,converter:ie}),C({name:"n",converter:re})],ne.prototype,"modulus",void 0),(0,o.__decorate)([(0,s.qw)({type:s.gZ.Integer,converter:ie}),C({name:"e",converter:re})],ne.prototype,"publicExponent",void 0),(0,o.__decorate)([(0,s.qw)({type:s.gZ.Integer,converter:ie}),C({name:"d",converter:re})],ne.prototype,"privateExponent",void 0),(0,o.__decorate)([(0,s.qw)({type:s.gZ.Integer,converter:ie}),C({name:"p",converter:re})],ne.prototype,"prime1",void 0),(0,o.__decorate)([(0,s.qw)({type:s.gZ.Integer,converter:ie}),C({name:"q",converter:re})],ne.prototype,"prime2",void 0),(0,o.__decorate)([(0,s.qw)({type:s.gZ.Integer,converter:ie}),C({name:"dp",converter:re})],ne.prototype,"exponent1",void 0),(0,o.__decorate)([(0,s.qw)({type:s.gZ.Integer,converter:ie}),C({name:"dq",converter:re})],ne.prototype,"exponent2",void 0),(0,o.__decorate)([(0,s.qw)({type:s.gZ.Integer,converter:ie}),C({name:"qi",converter:re})],ne.prototype,"coefficient",void 0),(0,o.__decorate)([(0,s.qw)({type:s.gZ.Any,optional:!0})],ne.prototype,"otherPrimeInfos",void 0);class se{constructor(){this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0)}}(0,o.__decorate)([(0,s.qw)({type:s.gZ.Integer,converter:ie}),C({name:"n",converter:re})],se.prototype,"modulus",void 0),(0,o.__decorate)([(0,s.qw)({type:s.gZ.Integer,converter:ie}),C({name:"e",converter:re})],se.prototype,"publicExponent",void 0);let oe=class{constructor(e){this.value=new ArrayBuffer(0),e&&(this.value=e)}toJSON(){let e=new Uint8Array(this.value);if(4!==e[0])throw new T("Wrong ECPoint. Current version supports only Uncompressed (0x04) point");e=new Uint8Array(this.value.slice(1));const t=e.length/2;return{x:n.ep.ToBase64Url(e.buffer.slice(0,0+t)),y:n.ep.ToBase64Url(e.buffer.slice(0+t,0+t+t))}}fromJSON(e){if(!("x"in e))throw new Error("x: Missing required property");if(!("y"in e))throw new Error("y: Missing required property");const t=n.ep.FromBase64Url(e.x),r=n.ep.FromBase64Url(e.y),i=(0,n.$e)(new Uint8Array([4]).buffer,t,r);return this.value=new Uint8Array(i).buffer,this}};(0,o.__decorate)([(0,s.qw)({type:s.gZ.OctetString})],oe.prototype,"value",void 0),oe=(0,o.__decorate)([(0,s.Ve)({type:s.cN.Choice})],oe);class ae{constructor(){this.version=1,this.privateKey=new ArrayBuffer(0)}fromJSON(e){if(!("d"in e))throw new Error("d: Missing required property");if(this.privateKey=n.ep.FromBase64Url(e.d),"x"in e){const t=new oe;t.fromJSON(e),this.publicKey=s.xg.toASN(t).valueBlock.valueHex}return this}toJSON(){const e={};return e.d=n.ep.ToBase64Url(this.privateKey),this.publicKey&&Object.assign(e,new oe(this.publicKey).toJSON()),e}}(0,o.__decorate)([(0,s.qw)({type:s.gZ.Integer,converter:s.A6})],ae.prototype,"version",void 0),(0,o.__decorate)([(0,s.qw)({type:s.gZ.OctetString})],ae.prototype,"privateKey",void 0),(0,o.__decorate)([(0,s.qw)({context:0,type:s.gZ.Any,optional:!0})],ae.prototype,"parameters",void 0),(0,o.__decorate)([(0,s.qw)({context:1,type:s.gZ.BitString,optional:!0})],ae.prototype,"publicKey",void 0);const ce={fromASN:e=>{const t=new Uint8Array(e.valueBlock.valueHex);return 0===t[0]?t.buffer.slice(1):t.buffer},toASN:e=>{const t=new Uint8Array(e);if(t[0]>127){const e=new Uint8Array(t.length+1);return e.set(t,1),new k.Integer({valueHex:e.buffer})}return new k.Integer({valueHex:e})}};var ue=Object.freeze({__proto__:null,AsnIntegerWithoutPaddingConverter:ce});class he{static decodePoint(e,t){const r=n.vJ.toUint8Array(e);if(0===r.length||4!==r[0])throw new Error("Only uncompressed point format supported");const i=(r.length-1)/2;if(i!==Math.ceil(t/8))throw new Error("Point does not match field size");return{x:r.slice(1,i+1),y:r.slice(i+1,i+1+i)}}static encodePoint(e,t){const r=Math.ceil(t/8);if(e.x.byteLength!==r||e.y.byteLength!==r)throw new Error("X,Y coordinates don't match point size criteria");const i=n.vJ.toUint8Array(e.x),s=n.vJ.toUint8Array(e.y),o=new Uint8Array(2*r+1);return o[0]=4,o.set(i,1),o.set(s,r+1),o}static getSize(e){return Math.ceil(e/8)}static encodeSignature(e,t){const r=this.getSize(t),i=n.vJ.toUint8Array(e.r),s=n.vJ.toUint8Array(e.s),o=new Uint8Array(2*r);return o.set(this.padStart(i,r)),o.set(this.padStart(s,r),r),o}static decodeSignature(e,t){const r=this.getSize(t),i=n.vJ.toUint8Array(e);if(i.length!==2*r)throw new Error("Incorrect size of the signature");const s=i.slice(0,r),o=i.slice(r);return{r:this.trimStart(s),s:this.trimStart(o)}}static trimStart(e){let t=0;for(;t<e.length-1&&0===e[t];)t++;return 0===t?e:e.slice(t,e.length)}static padStart(e,t){if(t===e.length)return e;const r=new Uint8Array(t);return r.set(e,t-e.length),r}}class de{constructor(){this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0)}static fromWebCryptoSignature(e){const t=e.byteLength/2,r=he.decodeSignature(e,8*t),i=new de;return i.r=n.vJ.toArrayBuffer(r.r),i.s=n.vJ.toArrayBuffer(r.s),i}toWebCryptoSignature(e){null!=e||(e=8*Math.max(this.r.byteLength,this.s.byteLength));return he.encodeSignature(this,e).buffer}}(0,o.__decorate)([(0,s.qw)({type:s.gZ.Integer,converter:ce})],de.prototype,"r",void 0),(0,o.__decorate)([(0,s.qw)({type:s.gZ.Integer,converter:ce})],de.prototype,"s",void 0);class le extends ee{}(0,o.__decorate)([(0,s.qw)({context:1,implicit:!0,type:s.gZ.BitString,optional:!0})],le.prototype,"publicKey",void 0);let fe=class{constructor(){this.value=new ArrayBuffer(0)}fromJSON(e){if(!e.d)throw new Error("d: Missing required property");return this.value=n.ep.FromBase64Url(e.d),this}toJSON(){return{d:n.ep.ToBase64Url(this.value)}}};(0,o.__decorate)([(0,s.qw)({type:s.gZ.OctetString})],fe.prototype,"value",void 0),fe=(0,o.__decorate)([(0,s.Ve)({type:s.cN.Choice})],fe);let pe=class{constructor(e){this.value=new ArrayBuffer(0),e&&(this.value=e)}toJSON(){return{x:n.ep.ToBase64Url(this.value)}}fromJSON(e){if(!("x"in e))throw new Error("x: Missing required property");return this.value=n.ep.FromBase64Url(e.x),this}};(0,o.__decorate)([(0,s.qw)({type:s.gZ.BitString})],pe.prototype,"value",void 0),pe=(0,o.__decorate)([(0,s.Ve)({type:s.cN.Choice})],pe);let ye=class{};(0,o.__decorate)([(0,s.qw)({type:s.gZ.OctetString}),C({type:i.String,converter:re})],ye.prototype,"d",void 0),ye=(0,o.__decorate)([(0,s.Ve)({type:s.cN.Choice})],ye);const me="1.2.840.10045.3.1.7",ge="1.3.132.0",be="1.3.132.0.34",ve="1.3.132.0.35",we="1.3.132.0.10",Se="1.3.36.3.3.2.8.1.1",_e=`${Se}.1`,Ae=`${Se}.2`,Ee=`${Se}.3`,Ce=`${Se}.4`,ke=`${Se}.5`,Te=`${Se}.6`,Pe=`${Se}.7`,Ie=`${Se}.8`,Re=`${Se}.9`,xe=`${Se}.10`,Be=`${Se}.11`,Oe=`${Se}.12`,Me=`${Se}.13`,Ne=`${Se}.14`;var De=Object.freeze({__proto__:null,converters:ue,get ObjectIdentifier(){return X},AlgorithmIdentifier:Q,PrivateKeyInfo:ee,PublicKeyInfo:te,RsaPrivateKey:ne,RsaPublicKey:se,EcPrivateKey:ae,get EcPublicKey(){return oe},EcDsaSignature:de,OneAsymmetricKey:le,get EdPrivateKey(){return fe},get EdPublicKey(){return pe},get CurvePrivateKey(){return ye},idSecp256r1:me,idEllipticCurve:ge,idSecp384r1:be,idSecp521r1:ve,idSecp256k1:we,idVersionOne:Se,idBrainpoolP160r1:_e,idBrainpoolP160t1:Ae,idBrainpoolP192r1:Ee,idBrainpoolP192t1:Ce,idBrainpoolP224r1:ke,idBrainpoolP224t1:Te,idBrainpoolP256r1:Pe,idBrainpoolP256t1:Ie,idBrainpoolP320r1:Re,idBrainpoolP320t1:xe,idBrainpoolP384r1:Be,idBrainpoolP384t1:Oe,idBrainpoolP512r1:Me,idBrainpoolP512t1:Ne,idX25519:"1.3.101.110",idX448:"1.3.101.111",idEd25519:"1.3.101.112",idEd448:"1.3.101.113"});class Le{constructor(){}static register(e){const t=new X;t.value=e.id;const r=s.zc.serialize(t);this.items.push({...e,raw:r}),this.names.push(e.name)}static find(e){e=e.toUpperCase();for(const t of this.items)if(t.name.toUpperCase()===e||t.id.toUpperCase()===e)return t;return null}static get(e){const t=this.find(e);if(!t)throw new Error(`Unsupported EC named curve '${e}'`);return t}}Le.items=[],Le.names=[],Le.register({name:"P-256",id:me,size:256}),Le.register({name:"P-384",id:be,size:384}),Le.register({name:"P-521",id:ve,size:521}),Le.register({name:"K-256",id:we,size:256}),Le.register({name:"brainpoolP160r1",id:_e,size:160}),Le.register({name:"brainpoolP160t1",id:Ae,size:160}),Le.register({name:"brainpoolP192r1",id:Ee,size:192}),Le.register({name:"brainpoolP192t1",id:Ce,size:192}),Le.register({name:"brainpoolP224r1",id:ke,size:224}),Le.register({name:"brainpoolP224t1",id:Te,size:224}),Le.register({name:"brainpoolP256r1",id:Pe,size:256}),Le.register({name:"brainpoolP256t1",id:Ie,size:256}),Le.register({name:"brainpoolP320r1",id:Re,size:320}),Le.register({name:"brainpoolP320t1",id:xe,size:320}),Le.register({name:"brainpoolP384r1",id:Be,size:384}),Le.register({name:"brainpoolP384t1",id:Oe,size:384}),Le.register({name:"brainpoolP512r1",id:Me,size:512}),Le.register({name:"brainpoolP512t1",id:Ne,size:512});class Ue extends B{constructor(){super(...arguments),this.name="HMAC",this.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],this.usages=["sign","verify"]}getDefaultLength(e){switch(e.toUpperCase()){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":return 512;default:throw new Error(`Unknown algorithm name '${e}'`)}}checkGenerateKeyParams(e){if(this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms),"length"in e){if("number"!=typeof e.length)throw new TypeError("length: Is not a Number");if(e.length<1)throw new RangeError("length: Number is out of range")}}checkImportParams(e){this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms)}}class je extends B{constructor(){super(...arguments),this.name="PBKDF2",this.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],this.usages=["deriveBits","deriveKey"]}checkAlgorithmParams(e){if(this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms),this.checkRequiredProperty(e,"salt"),!(e.salt instanceof ArrayBuffer||ArrayBuffer.isView(e.salt)))throw new TypeError("salt: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(this.checkRequiredProperty(e,"iterations"),"number"!=typeof e.iterations)throw new TypeError("iterations: Is not a Number");if(e.iterations<1)throw new TypeError("iterations: Is less than 1")}checkImportKey(e,t,r,i,n,...s){if(super.checkImportKey(e,t,r,i,n),i)throw new SyntaxError("extractable: Must be 'false'")}}class qe extends B{constructor(){super(...arguments),this.name="HKDF",this.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],this.usages=["deriveKey","deriveBits"]}checkAlgorithmParams(e){if(this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms),this.checkRequiredProperty(e,"salt"),!n.vJ.isBufferSource(e.salt))throw new TypeError("salt: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(this.checkRequiredProperty(e,"info"),!n.vJ.isBufferSource(e.info))throw new TypeError("salt: Is not of type '(ArrayBuffer or ArrayBufferView)'")}checkImportKey(e,t,r,i,n,...s){if(super.checkImportKey(e,t,r,i,n),i)throw new SyntaxError("extractable: Must be 'false'")}}class Ke extends B{constructor(){super(...arguments),this.usages=[],this.defaultLength=0}digest(...e){return e[0]={length:this.defaultLength,...e[0]},super.digest.apply(this,e)}checkDigest(e,t){super.checkDigest(e,t);const r=e.length||0;if("number"!=typeof r)throw new TypeError("length: Is not a Number");if(r<0)throw new TypeError("length: Is negative")}}class He extends Ke{constructor(){super(...arguments),this.name="shake128",this.defaultLength=16}}class ze extends Ke{constructor(){super(...arguments),this.name="shake256",this.defaultLength=32}}class Fe{get[Symbol.toStringTag](){return"Crypto"}randomUUID(){const e=this.getRandomValues(new Uint8Array(16));e[6]=15&e[6]|64,e[8]=63&e[8]|128;const t=n.ep.ToHex(e).toLowerCase();return`${t.substring(0,8)}-${t.substring(8,12)}-${t.substring(12,16)}-${t.substring(16)}`}}class Ve{constructor(){this.items={}}get(e){return this.items[e.toLowerCase()]||null}set(e){this.items[e.name.toLowerCase()]=e}removeAt(e){const t=this.get(e.toLowerCase());return t&&delete this.items[e],t}has(e){return!!this.get(e)}get length(){return Object.keys(this.items).length}get algorithms(){const e=[];for(const t in this.items){const r=this.items[t];e.push(r.name)}return e.sort()}}class $e{constructor(){this.providers=new Ve}static isHashedAlgorithm(e){return!!(e&&"object"==typeof e&&"name"in e&&"hash"in e)}get[Symbol.toStringTag](){return"SubtleCrypto"}async digest(...e){this.checkRequiredArguments(e,2,"digest");const[t,r,...i]=e,s=this.prepareAlgorithm(t),o=n.vJ.toArrayBuffer(r),a=this.getProvider(s.name);return await a.digest(s,o,...i)}async generateKey(...e){this.checkRequiredArguments(e,3,"generateKey");const[t,r,i,...n]=e,s=this.prepareAlgorithm(t),o=this.getProvider(s.name);return await o.generateKey({...s,name:o.name},r,i,...n)}async sign(...e){this.checkRequiredArguments(e,3,"sign");const[t,r,i,...s]=e;this.checkCryptoKey(r);const o=this.prepareAlgorithm(t),a=n.vJ.toArrayBuffer(i),c=this.getProvider(o.name);return await c.sign({...o,name:c.name},r,a,...s)}async verify(...e){this.checkRequiredArguments(e,4,"verify");const[t,r,i,s,...o]=e;this.checkCryptoKey(r);const a=this.prepareAlgorithm(t),c=n.vJ.toArrayBuffer(s),u=n.vJ.toArrayBuffer(i),h=this.getProvider(a.name);return await h.verify({...a,name:h.name},r,u,c,...o)}async encrypt(...e){this.checkRequiredArguments(e,3,"encrypt");const[t,r,i,...s]=e;this.checkCryptoKey(r);const o=this.prepareAlgorithm(t),a=n.vJ.toArrayBuffer(i),c=this.getProvider(o.name);return await c.encrypt({...o,name:c.name},r,a,{keyUsage:!0},...s)}async decrypt(...e){this.checkRequiredArguments(e,3,"decrypt");const[t,r,i,...s]=e;this.checkCryptoKey(r);const o=this.prepareAlgorithm(t),a=n.vJ.toArrayBuffer(i),c=this.getProvider(o.name);return await c.decrypt({...o,name:c.name},r,a,{keyUsage:!0},...s)}async deriveBits(...e){this.checkRequiredArguments(e,3,"deriveBits");const[t,r,i,...n]=e;this.checkCryptoKey(r);const s=this.prepareAlgorithm(t),o=this.getProvider(s.name);return await o.deriveBits({...s,name:o.name},r,i,{keyUsage:!0},...n)}async deriveKey(...e){this.checkRequiredArguments(e,5,"deriveKey");const[t,r,i,n,s,...o]=e,a=this.prepareAlgorithm(i);this.getProvider(a.name).checkDerivedKeyParams(a);const c=this.prepareAlgorithm(t),u=this.getProvider(c.name);u.checkCryptoKey(r,"deriveKey");const h=await u.deriveBits({...c,name:u.name},r,i.length||512,{keyUsage:!1},...o);return this.importKey("raw",h,i,n,s,...o)}async exportKey(...e){this.checkRequiredArguments(e,2,"exportKey");const[t,r,...i]=e;this.checkCryptoKey(r);const n=this.getProvider(r.algorithm.name);return await n.exportKey(t,r,...i)}async importKey(...e){this.checkRequiredArguments(e,5,"importKey");const[t,r,i,s,o,...a]=e,c=this.prepareAlgorithm(i),u=this.getProvider(c.name);if(-1!==["pkcs8","spki","raw"].indexOf(t)){const e=n.vJ.toArrayBuffer(r);return u.importKey(t,e,{...c,name:u.name},s,o,...a)}if(!r.kty)throw new TypeError("keyData: Is not JSON");return u.importKey(t,r,{...c,name:u.name},s,o,...a)}async wrapKey(e,t,r,i,...s){let o=await this.exportKey(e,t,...s);if("jwk"===e){const e=JSON.stringify(o);o=n.ep.FromUtf8String(e)}const a=this.prepareAlgorithm(i),c=n.vJ.toArrayBuffer(o),u=this.getProvider(a.name);return u.encrypt({...a,name:u.name},r,c,{keyUsage:!1},...s)}async unwrapKey(e,t,r,i,s,o,a,...c){const u=this.prepareAlgorithm(i),h=n.vJ.toArrayBuffer(t),d=this.getProvider(u.name);let l=await d.decrypt({...u,name:d.name},r,h,{keyUsage:!1},...c);if("jwk"===e)try{l=JSON.parse(n.ep.ToUtf8String(l))}catch(e){const t=new TypeError("wrappedKey: Is not a JSON");throw t.internal=e,t}return this.importKey(e,l,s,o,a,...c)}checkRequiredArguments(e,t,r){if(e.length<t)throw new TypeError(`Failed to execute '${r}' on 'SubtleCrypto': ${t} arguments required, but only ${e.length} present`)}prepareAlgorithm(e){if("string"==typeof e)return{name:e};if($e.isHashedAlgorithm(e)){const t={...e};return t.hash=this.prepareAlgorithm(e.hash),t}return{...e}}getProvider(e){const t=this.providers.get(e);if(!t)throw new P("Unrecognized name");return t}checkCryptoKey(e){if(!(e instanceof G))throw new TypeError("Key is not of type 'CryptoKey'")}}var We=r(6113),Ge=r.n(We),Je=r(7282);const Ye={fromJSON:e=>Buffer.from(n.ep.FromBase64Url(e)),toJSON:e=>n.ep.ToBase64Url(e)};class Ze extends G{constructor(){super(...arguments),this.data=Buffer.alloc(0),this.algorithm={name:""},this.extractable=!1,this.type="secret",this.usages=[],this.kty="oct",this.alg=""}}(0,o.__decorate)([C({name:"ext",type:i.Boolean,optional:!0})],Ze.prototype,"extractable",void 0),(0,o.__decorate)([C({name:"key_ops",type:i.String,repeated:!0,optional:!0})],Ze.prototype,"usages",void 0),(0,o.__decorate)([C({type:i.String})],Ze.prototype,"kty",void 0),(0,o.__decorate)([C({type:i.String,optional:!0})],Ze.prototype,"alg",void 0);class Xe extends Ze{constructor(){super(...arguments),this.kty="oct",this.type="secret"}}class Qe extends Ze{}class et extends Xe{get alg(){switch(this.algorithm.name.toUpperCase()){case"AES-CBC":return`A${this.algorithm.length}CBC`;case"AES-CTR":return`A${this.algorithm.length}CTR`;case"AES-GCM":return`A${this.algorithm.length}GCM`;case"AES-KW":return`A${this.algorithm.length}KW`;case"AES-CMAC":return`A${this.algorithm.length}CMAC`;case"AES-ECB":return`A${this.algorithm.length}ECB`;default:throw new P("Unsupported algorithm name")}}set alg(e){}}(0,o.__decorate)([C({name:"k",converter:Ye})],et.prototype,"data",void 0);const tt=new WeakMap;function rt(e){const t=tt.get(e);if(!t)throw new R("Cannot get CryptoKey from secure storage");return t}function it(e){const t=G.create(e.algorithm,e.type,e.extractable,e.usages);return Object.freeze(t),tt.set(t,e),t}class nt{static async generateKey(e,t,r){const i=new et;return i.algorithm=e,i.extractable=t,i.usages=r,i.data=Ge().randomBytes(e.length>>3),i}static async exportKey(e,t){if(!(t instanceof et))throw new Error("key: Is not AesCryptoKey");switch(e.toLowerCase()){case"jwk":return A.toJSON(t);case"raw":return new Uint8Array(t.data).buffer;default:throw new R("format: Must be 'jwk' or 'raw'")}}static async importKey(e,t,r,i,n){let s;switch(e.toLowerCase()){case"jwk":s=E.fromJSON(t,{targetSchema:et});break;case"raw":s=new et,s.data=Buffer.from(t);break;default:throw new R("format: Must be 'jwk' or 'raw'")}switch(s.algorithm=r,s.algorithm.length=s.data.length<<3,s.extractable=i,s.usages=n,s.algorithm.length){case 128:case 192:case 256:break;default:throw new R("keyData: Is wrong key length")}return s}static async encrypt(e,t,r){switch(e.name.toUpperCase()){case"AES-CBC":return this.encryptAesCBC(e,t,Buffer.from(r));case"AES-CTR":return this.encryptAesCTR(e,t,Buffer.from(r));case"AES-GCM":return this.encryptAesGCM(e,t,Buffer.from(r));case"AES-KW":return this.encryptAesKW(e,t,Buffer.from(r));case"AES-ECB":return this.encryptAesECB(e,t,Buffer.from(r));default:throw new R("algorithm: Is not recognized")}}static async decrypt(e,t,r){if(!(t instanceof et))throw new Error("key: Is not AesCryptoKey");switch(e.name.toUpperCase()){case"AES-CBC":return this.decryptAesCBC(e,t,Buffer.from(r));case"AES-CTR":return this.decryptAesCTR(e,t,Buffer.from(r));case"AES-GCM":return this.decryptAesGCM(e,t,Buffer.from(r));case"AES-KW":return this.decryptAesKW(e,t,Buffer.from(r));case"AES-ECB":return this.decryptAesECB(e,t,Buffer.from(r));default:throw new R("algorithm: Is not recognized")}}static async encryptAesCBC(e,t,r){const i=Ge().createCipheriv(`aes-${t.algorithm.length}-cbc`,t.data,new Uint8Array(e.iv));let n=i.update(r);n=Buffer.concat([n,i.final()]);return new Uint8Array(n).buffer}static async decryptAesCBC(e,t,r){const i=Ge().createDecipheriv(`aes-${t.algorithm.length}-cbc`,t.data,new Uint8Array(e.iv));let n=i.update(r);return n=Buffer.concat([n,i.final()]),new Uint8Array(n).buffer}static async encryptAesCTR(e,t,r){const i=Ge().createCipheriv(`aes-${t.algorithm.length}-ctr`,t.data,Buffer.from(e.counter));let n=i.update(r);n=Buffer.concat([n,i.final()]);return new Uint8Array(n).buffer}static async decryptAesCTR(e,t,r){const i=Ge().createDecipheriv(`aes-${t.algorithm.length}-ctr`,t.data,new Uint8Array(e.counter));let n=i.update(r);return n=Buffer.concat([n,i.final()]),new Uint8Array(n).buffer}static async encryptAesGCM(e,t,r){const i=Ge().createCipheriv(`aes-${t.algorithm.length}-gcm`,t.data,Buffer.from(e.iv),{authTagLength:(e.tagLength||128)>>3});e.additionalData&&i.setAAD(Buffer.from(e.additionalData));let n=i.update(r);n=Buffer.concat([n,i.final(),i.getAuthTag()]);return new Uint8Array(n).buffer}static async decryptAesGCM(e,t,r){const i=Ge().createDecipheriv(`aes-${t.algorithm.length}-gcm`,t.data,new Uint8Array(e.iv)),n=(e.tagLength||128)>>3,s=r.slice(0,r.length-n),o=r.slice(r.length-n);e.additionalData&&i.setAAD(Buffer.from(e.additionalData)),i.setAuthTag(o);let a=i.update(s);return a=Buffer.concat([a,i.final()]),new Uint8Array(a).buffer}static async encryptAesKW(e,t,r){const i=Ge().createCipheriv(`id-aes${t.algorithm.length}-wrap`,t.data,this.AES_KW_IV);let n=i.update(r);return n=Buffer.concat([n,i.final()]),new Uint8Array(n).buffer}static async decryptAesKW(e,t,r){const i=Ge().createDecipheriv(`id-aes${t.algorithm.length}-wrap`,t.data,this.AES_KW_IV);let n=i.update(r);return n=Buffer.concat([n,i.final()]),new Uint8Array(n).buffer}static async encryptAesECB(e,t,r){const i=Ge().createCipheriv(`aes-${t.algorithm.length}-ecb`,t.data,new Uint8Array(0));let n=i.update(r);n=Buffer.concat([n,i.final()]);return new Uint8Array(n).buffer}static async decryptAesECB(e,t,r){const i=Ge().createDecipheriv(`aes-${t.algorithm.length}-ecb`,t.data,new Uint8Array(0));let n=i.update(r);return n=Buffer.concat([n,i.final()]),new Uint8Array(n).buffer}}nt.AES_KW_IV=Buffer.from("A6A6A6A6A6A6A6A6","hex");class st extends M{async onGenerateKey(e,t,r){return it(await nt.generateKey({name:this.name,length:e.length},t,r))}async onEncrypt(e,t,r){return nt.encrypt(e,rt(t),new Uint8Array(r))}async onDecrypt(e,t,r){return nt.decrypt(e,rt(t),new Uint8Array(r))}async onExportKey(e,t){return nt.exportKey(e,rt(t))}async onImportKey(e,t,r,i,n){return it(await nt.importKey(e,t,{name:r.name},i,n))}checkCryptoKey(e,t){if(super.checkCryptoKey(e,t),!(rt(e)instanceof et))throw new TypeError("key: Is not a AesCryptoKey")}}const ot=Buffer.from([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),at=Buffer.from([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,135]),ct=16;function ut(e){const t=Buffer.alloc(e.length),r=e.length-1;for(let i=0;i<r;i++)t[i]=e[i]<<1,128&e[i+1]&&(t[i]+=1);return t[r]=e[r]<<1,t}function ht(e,t){const r=Math.min(e.length,t.length),i=Buffer.alloc(r);for(let n=0;n<r;n++)i[n]=e[n]^t[n];return i}function dt(e,t){const r=We.createCipheriv("aes"+(e.length<<3),e,ot),i=r.update(t);return r.final(),i}function lt(e,t){const r=Buffer.alloc(ct),i=t*ct,n=i+ct;return e.copy(r,0,i,n),r}function ft(e,t){const r=function(e){const t=dt(e,ot);let r=ut(t);128&t[0]&&(r=ht(r,at));let i=ut(r);return 128&r[0]&&(i=ht(i,at)),{subkey1:r,subkey2:i}}(e);let i,n,s=Math.ceil(t.length/ct);0===s?(s=1,i=!1):i=t.length%ct==0;const o=s-1;n=i?ht(lt(t,o),r.subkey1):ht(function(e,t){const r=Buffer.alloc(ct),i=t*ct,n=e.length;return r.fill(0),e.copy(r,0,i,n),r[n-i]=128,r}(t,o),r.subkey2);let a,c=ot;for(let r=0;r<o;r++)a=ht(c,lt(t,r)),c=dt(e,a);return a=ht(n,c),dt(e,a)}class pt extends N{async onGenerateKey(e,t,r){return it(await nt.generateKey({name:this.name,length:e.length},t,r))}async onSign(e,t,r){const i=ft(rt(t).data,Buffer.from(r));return new Uint8Array(i).buffer}async onVerify(e,t,r,i){const n=await this.sign(e,t,i);return 0===Buffer.from(r).compare(Buffer.from(n))}async onExportKey(e,t){return nt.exportKey(e,rt(t))}async onImportKey(e,t,r,i,n){return it(await nt.importKey(e,t,{name:r.name},i,n))}checkCryptoKey(e,t){if(super.checkCryptoKey(e,t),!(rt(e)instanceof et))throw new TypeError("key: Is not a AesCryptoKey")}}class yt extends D{async onGenerateKey(e,t,r){return it(await nt.generateKey({name:this.name,length:e.length},t,r))}async onEncrypt(e,t,r){return nt.encrypt(e,rt(t),new Uint8Array(r))}async onDecrypt(e,t,r){return nt.decrypt(e,rt(t),new Uint8Array(r))}async onExportKey(e,t){return nt.exportKey(e,rt(t))}async onImportKey(e,t,r,i,n){return it(await nt.importKey(e,t,{name:r.name},i,n))}checkCryptoKey(e,t){if(super.checkCryptoKey(e,t),!(rt(e)instanceof et))throw new TypeError("key: Is not a AesCryptoKey")}}class mt extends U{async onGenerateKey(e,t,r){return it(await nt.generateKey({name:this.name,length:e.length},t,r))}async onEncrypt(e,t,r){return nt.encrypt(e,rt(t),new Uint8Array(r))}async onDecrypt(e,t,r){return nt.decrypt(e,rt(t),new Uint8Array(r))}async onExportKey(e,t){return nt.exportKey(e,rt(t))}async onImportKey(e,t,r,i,n){return it(await nt.importKey(e,t,{name:r.name},i,n))}checkCryptoKey(e,t){if(super.checkCryptoKey(e,t),!(rt(e)instanceof et))throw new TypeError("key: Is not a AesCryptoKey")}}class gt extends j{async onGenerateKey(e,t,r){return it(await nt.generateKey({name:this.name,length:e.length},t,r))}async onExportKey(e,t){return nt.exportKey(e,rt(t))}async onImportKey(e,t,r,i,n){return it(await nt.importKey(e,t,{name:r.name},i,n))}async onEncrypt(e,t,r){return nt.encrypt(e,rt(t),new Uint8Array(r))}async onDecrypt(e,t,r){return nt.decrypt(e,rt(t),new Uint8Array(r))}checkCryptoKey(e,t){if(super.checkCryptoKey(e,t),!(rt(e)instanceof et))throw new TypeError("key: Is not a AesCryptoKey")}}class bt extends L{async onGenerateKey(e,t,r){return it(await nt.generateKey({name:this.name,length:e.length},t,r))}async onEncrypt(e,t,r){return nt.encrypt(e,rt(t),new Uint8Array(r))}async onDecrypt(e,t,r){return nt.decrypt(e,rt(t),new Uint8Array(r))}async onExportKey(e,t){return nt.exportKey(e,rt(t))}async onImportKey(e,t,r,i,n){return it(await nt.importKey(e,t,{name:r.name},i,n))}checkCryptoKey(e,t){if(super.checkCryptoKey(e,t),!(rt(e)instanceof et))throw new TypeError("key: Is not a AesCryptoKey")}}class vt extends Xe{get alg(){switch(this.algorithm.name.toUpperCase()){case"DES-CBC":return"DES-CBC";case"DES-EDE3-CBC":return"3DES-CBC";default:throw new P("Unsupported algorithm name")}}set alg(e){}}(0,o.__decorate)([C({name:"k",converter:Ye})],vt.prototype,"data",void 0);class wt{static async generateKey(e,t,r){const i=new vt;return i.algorithm=e,i.extractable=t,i.usages=r,i.data=Ge().randomBytes(e.length>>3),i}static async exportKey(e,t){switch(e.toLowerCase()){case"jwk":return A.toJSON(t);case"raw":return new Uint8Array(t.data).buffer;default:throw new R("format: Must be 'jwk' or 'raw'")}}static async importKey(e,t,r,i,n){let s;switch(e.toLowerCase()){case"jwk":s=E.fromJSON(t,{targetSchema:vt});break;case"raw":s=new vt,s.data=Buffer.from(t);break;default:throw new R("format: Must be 'jwk' or 'raw'")}return s.algorithm=r,s.extractable=i,s.usages=n,s}static async encrypt(e,t,r){switch(e.name.toUpperCase()){case"DES-CBC":return this.encryptDesCBC(e,t,Buffer.from(r));case"DES-EDE3-CBC":return this.encryptDesEDE3CBC(e,t,Buffer.from(r));default:throw new R("algorithm: Is not recognized")}}static async decrypt(e,t,r){if(!(t instanceof vt))throw new Error("key: Is not DesCryptoKey");switch(e.name.toUpperCase()){case"DES-CBC":return this.decryptDesCBC(e,t,Buffer.from(r));case"DES-EDE3-CBC":return this.decryptDesEDE3CBC(e,t,Buffer.from(r));default:throw new R("algorithm: Is not recognized")}}static async encryptDesCBC(e,t,r){const i=Ge().createCipheriv("des-cbc",t.data,new Uint8Array(e.iv));let n=i.update(r);n=Buffer.concat([n,i.final()]);return new Uint8Array(n).buffer}static async decryptDesCBC(e,t,r){const i=Ge().createDecipheriv("des-cbc",t.data,new Uint8Array(e.iv));let n=i.update(r);return n=Buffer.concat([n,i.final()]),new Uint8Array(n).buffer}static async encryptDesEDE3CBC(e,t,r){const i=Ge().createCipheriv("des-ede3-cbc",t.data,Buffer.from(e.iv));let n=i.update(r);n=Buffer.concat([n,i.final()]);return new Uint8Array(n).buffer}static async decryptDesEDE3CBC(e,t,r){const i=Ge().createDecipheriv("des-ede3-cbc",t.data,new Uint8Array(e.iv));let n=i.update(r);return n=Buffer.concat([n,i.final()]),new Uint8Array(n).buffer}}class St extends q{constructor(){super(...arguments),this.keySizeBits=64,this.ivSize=8,this.name="DES-CBC"}async onGenerateKey(e,t,r){return it(await wt.generateKey({name:this.name,length:this.keySizeBits},t,r))}async onEncrypt(e,t,r){return wt.encrypt(e,rt(t),new Uint8Array(r))}async onDecrypt(e,t,r){return wt.decrypt(e,rt(t),new Uint8Array(r))}async onExportKey(e,t){return wt.exportKey(e,rt(t))}async onImportKey(e,t,r,i,n){const s=await wt.importKey(e,t,{name:this.name,length:this.keySizeBits},i,n);if(s.data.length!==this.keySizeBits>>3)throw new R("keyData: Wrong key size");return it(s)}checkCryptoKey(e,t){if(super.checkCryptoKey(e,t),!(rt(e)instanceof vt))throw new TypeError("key: Is not a DesCryptoKey")}}class _t extends q{constructor(){super(...arguments),this.keySizeBits=192,this.ivSize=8,this.name="DES-EDE3-CBC"}async onGenerateKey(e,t,r){return it(await wt.generateKey({name:this.name,length:this.keySizeBits},t,r))}async onEncrypt(e,t,r){return wt.encrypt(e,rt(t),new Uint8Array(r))}async onDecrypt(e,t,r){return wt.decrypt(e,rt(t),new Uint8Array(r))}async onExportKey(e,t){return wt.exportKey(e,rt(t))}async onImportKey(e,t,r,i,n){const s=await wt.importKey(e,t,{name:this.name,length:this.keySizeBits},i,n);if(s.data.length!==this.keySizeBits>>3)throw new R("keyData: Wrong key size");return it(s)}checkCryptoKey(e,t){if(super.checkCryptoKey(e,t),!(rt(e)instanceof vt))throw new TypeError("key: Is not a DesCryptoKey")}}function At(e){switch(e.name.toUpperCase()){case"RSA-OAEP":{const t=/(\d+)$/.exec(e.hash.name)[1];return"RSA-OAEP"+("1"!==t?`-${t}`:"")}case"RSASSA-PKCS1-V1_5":return`RS${/(\d+)$/.exec(e.hash.name)[1]}`;case"RSA-PSS":return`PS${/(\d+)$/.exec(e.hash.name)[1]}`;case"RSA-PKCS1":return"RS1";default:throw new R("algorithm: Is not recognized")}}class Et extends Qe{constructor(){super(...arguments),this.type="private"}getKey(){const e=s.Vs.parse(this.data,De.PrivateKeyInfo);return s.Vs.parse(e.privateKey,De.RsaPrivateKey)}toJSON(){const e=this.getKey(),t={kty:"RSA",alg:At(this.algorithm),key_ops:this.usages,ext:this.extractable};return Object.assign(t,A.toJSON(e))}fromJSON(e){const t=E.fromJSON(e,{targetSchema:De.RsaPrivateKey}),r=new De.PrivateKeyInfo;r.privateKeyAlgorithm.algorithm="1.2.840.113549.1.1.1",r.privateKeyAlgorithm.parameters=null,r.privateKey=s.xg.serialize(t),this.data=Buffer.from(s.xg.serialize(r))}}class Ct extends Qe{constructor(){super(...arguments),this.type="public"}getKey(){const e=s.Vs.parse(this.data,De.PublicKeyInfo);return s.Vs.parse(e.publicKey,De.RsaPublicKey)}toJSON(){const e=this.getKey(),t={kty:"RSA",alg:At(this.algorithm),key_ops:this.usages,ext:this.extractable};return Object.assign(t,A.toJSON(e))}fromJSON(e){const t=E.fromJSON(e,{targetSchema:De.RsaPublicKey}),r=new De.PublicKeyInfo;r.publicKeyAlgorithm.algorithm="1.2.840.113549.1.1.1",r.publicKeyAlgorithm.parameters=null,r.publicKey=s.xg.serialize(t),this.data=Buffer.from(s.xg.serialize(r))}}class kt{static async generateKey(e,t,r){const i=new Et;i.algorithm=e,i.extractable=t,i.usages=r.filter((e=>-1!==this.privateKeyUsages.indexOf(e)));const n=new Ct;n.algorithm=e,n.extractable=!0,n.usages=r.filter((e=>-1!==this.publicKeyUsages.indexOf(e)));const s=Buffer.concat([Buffer.alloc(4-e.publicExponent.byteLength,0),Buffer.from(e.publicExponent)]).readInt32BE(0),o=Ge().generateKeyPairSync("rsa",{modulusLength:e.modulusLength,publicExponent:s,publicKeyEncoding:{format:"der",type:"spki"},privateKeyEncoding:{format:"der",type:"pkcs8"}});i.data=o.privateKey,n.data=o.publicKey;return{privateKey:i,publicKey:n}}static async exportKey(e,t){switch(e.toLowerCase()){case"jwk":return A.toJSON(t);case"pkcs8":case"spki":return new Uint8Array(t.data).buffer;default:throw new R("format: Must be 'jwk', 'pkcs8' or 'spki'")}}static async importKey(e,t,r,i,n){switch(e.toLowerCase()){case"jwk":if(t.d){const e=E.fromJSON(t,{targetSchema:De.RsaPrivateKey});return this.importPrivateKey(e,r,i,n)}{const e=E.fromJSON(t,{targetSchema:De.RsaPublicKey});return this.importPublicKey(e,r,i,n)}case"spki":{const e=s.Vs.parse(new Uint8Array(t),De.PublicKeyInfo),o=s.Vs.parse(e.publicKey,De.RsaPublicKey);return this.importPublicKey(o,r,i,n)}case"pkcs8":{const e=s.Vs.parse(new Uint8Array(t),De.PrivateKeyInfo),o=s.Vs.parse(e.privateKey,De.RsaPrivateKey);return this.importPrivateKey(o,r,i,n)}default:throw new R("format: Must be 'jwk', 'pkcs8' or 'spki'")}}static async sign(e,t,r){switch(e.name.toUpperCase()){case"RSA-PSS":case"RSASSA-PKCS1-V1_5":return this.signRsa(e,t,r);default:throw new R("algorithm: Is not recognized")}}static async verify(e,t,r,i){switch(e.name.toUpperCase()){case"RSA-PSS":case"RSASSA-PKCS1-V1_5":return this.verifySSA(e,t,i,r);default:throw new R("algorithm: Is not recognized")}}static async encrypt(e,t,r){if("RSA-OAEP"===e.name.toUpperCase())return this.encryptOAEP(e,t,r);throw new R("algorithm: Is not recognized")}static async decrypt(e,t,r){if("RSA-OAEP"===e.name.toUpperCase())return this.decryptOAEP(e,t,r);throw new R("algorithm: Is not recognized")}static importPrivateKey(e,t,r,i){const n=new De.PrivateKeyInfo;n.privateKeyAlgorithm.algorithm="1.2.840.113549.1.1.1",n.privateKeyAlgorithm.parameters=null,n.privateKey=s.xg.serialize(e);const o=new Et;return o.data=Buffer.from(s.xg.serialize(n)),o.algorithm=Object.assign({},t),o.algorithm.publicExponent=new Uint8Array(e.publicExponent),o.algorithm.modulusLength=e.modulus.byteLength<<3,o.extractable=r,o.usages=i,o}static importPublicKey(e,t,r,i){const n=new De.PublicKeyInfo;n.publicKeyAlgorithm.algorithm="1.2.840.113549.1.1.1",n.publicKeyAlgorithm.parameters=null,n.publicKey=s.xg.serialize(e);const o=new Ct;return o.data=Buffer.from(s.xg.serialize(n)),o.algorithm=Object.assign({},t),o.algorithm.publicExponent=new Uint8Array(e.publicExponent),o.algorithm.modulusLength=e.modulus.byteLength<<3,o.extractable=r,o.usages=i,o}static getCryptoAlgorithm(e){switch(e.hash.name.toUpperCase()){case"SHA-1":return"RSA-SHA1";case"SHA-256":return"RSA-SHA256";case"SHA-384":return"RSA-SHA384";case"SHA-512":return"RSA-SHA512";case"SHA3-256":return"RSA-SHA3-256";case"SHA3-384":return"RSA-SHA3-384";case"SHA3-512":return"RSA-SHA3-512";default:throw new R("algorithm.hash: Is not recognized")}}static signRsa(e,t,r){const i=this.getCryptoAlgorithm(t.algorithm),n=Ge().createSign(i);n.update(Buffer.from(r)),t.pem||(t.pem=`-----BEGIN PRIVATE KEY-----\n${t.data.toString("base64")}\n-----END PRIVATE KEY-----`);const s={key:t.pem};"RSA-PSS"===e.name.toUpperCase()&&(s.padding=Ge().constants.RSA_PKCS1_PSS_PADDING,s.saltLength=e.saltLength);const o=n.sign(s);return new Uint8Array(o).buffer}static verifySSA(e,t,r,i){const n=this.getCryptoAlgorithm(t.algorithm),s=Ge().createVerify(n);s.update(Buffer.from(r)),t.pem||(t.pem=`-----BEGIN PUBLIC KEY-----\n${t.data.toString("base64")}\n-----END PUBLIC KEY-----`);const o={key:t.pem};"RSA-PSS"===e.name.toUpperCase()&&(o.padding=Ge().constants.RSA_PKCS1_PSS_PADDING,o.saltLength=e.saltLength);return s.verify(o,i)}static encryptOAEP(e,t,r){const i={key:`-----BEGIN PUBLIC KEY-----\n${t.data.toString("base64")}\n-----END PUBLIC KEY-----`,padding:Ge().constants.RSA_PKCS1_OAEP_PADDING};return e.label,new Uint8Array(Ge().publicEncrypt(i,r)).buffer}static decryptOAEP(e,t,r){const i={key:`-----BEGIN PRIVATE KEY-----\n${t.data.toString("base64")}\n-----END PRIVATE KEY-----`,padding:Ge().constants.RSA_PKCS1_OAEP_PADDING};return e.label,new Uint8Array(Ge().privateDecrypt(i,r)).buffer}}kt.publicKeyUsages=["verify","encrypt","wrapKey"],kt.privateKeyUsages=["sign","decrypt","unwrapKey"];class Tt extends H{constructor(){super(...arguments),this.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512","shake128","shake256","SHA3-256","SHA3-384","SHA3-512"]}async onGenerateKey(e,t,r){const i=await kt.generateKey({...e,name:this.name},t,r);return{privateKey:it(i.privateKey),publicKey:it(i.publicKey)}}async onSign(e,t,r){return kt.sign(e,rt(t),new Uint8Array(r))}async onVerify(e,t,r,i){return kt.verify(e,rt(t),new Uint8Array(r),new Uint8Array(i))}async onExportKey(e,t){return kt.exportKey(e,rt(t))}async onImportKey(e,t,r,i,n){return it(await kt.importKey(e,t,{...r,name:this.name},i,n))}checkCryptoKey(e,t){super.checkCryptoKey(e,t);const r=rt(e);if(!(r instanceof Et||r instanceof Ct))throw new TypeError("key: Is not RSA CryptoKey")}}class Pt extends z{constructor(){super(...arguments),this.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512","shake128","shake256","SHA3-256","SHA3-384","SHA3-512"]}async onGenerateKey(e,t,r){const i=await kt.generateKey({...e,name:this.name},t,r);return{privateKey:it(i.privateKey),publicKey:it(i.publicKey)}}async onSign(e,t,r){return kt.sign(e,rt(t),new Uint8Array(r))}async onVerify(e,t,r,i){return kt.verify(e,rt(t),new Uint8Array(r),new Uint8Array(i))}async onExportKey(e,t){return kt.exportKey(e,rt(t))}async onImportKey(e,t,r,i,n){return it(await kt.importKey(e,t,{...r,name:this.name},i,n))}checkCryptoKey(e,t){super.checkCryptoKey(e,t);const r=rt(e);if(!(r instanceof Et||r instanceof Ct))throw new TypeError("key: Is not RSA CryptoKey")}}class It{static size(e){switch(e.name.toUpperCase()){case"SHA-1":return 160;case"SHA-256":case"SHA3-256":return 256;case"SHA-384":case"SHA3-384":return 384;case"SHA-512":case"SHA3-512":return 512;default:throw new Error("Unrecognized name")}}static getAlgorithmName(e){switch(e.name.toUpperCase()){case"SHA-1":return"sha1";case"SHA-256":return"sha256";case"SHA-384":return"sha384";case"SHA-512":return"sha512";case"SHA3-256":return"sha3-256";case"SHA3-384":return"sha3-384";case"SHA3-512":return"sha3-512";default:throw new Error("Unrecognized name")}}static digest(e,t){const r=this.getAlgorithmName(e),i=Ge().createHash(r).update(Buffer.from(t)).digest();return new Uint8Array(i).buffer}}class Rt extends F{async onGenerateKey(e,t,r){const i=await kt.generateKey({...e,name:this.name},t,r);return{privateKey:it(i.privateKey),publicKey:it(i.publicKey)}}async onEncrypt(e,t,r){const i=rt(t),s=new Uint8Array(r),o=Math.ceil(i.algorithm.modulusLength>>3),a=It.size(i.algorithm.hash)>>3,c=s.byteLength,u=o-c-2*a-2;if(c>o-2*a-2)throw new Error("Data too large");const h=new Uint8Array(o),d=h.subarray(1,a+1),l=h.subarray(a+1);l.set(s,a+u+1);const f=Ge().createHash(i.algorithm.hash.name.replace("-","")).update(n.vJ.toUint8Array(e.label||new Uint8Array(0))).digest();l.set(f,0),l[a+u]=1,Ge().randomFillSync(d);const p=this.mgf1(i.algorithm.hash,d,l.length);for(let e=0;e<l.length;e++)l[e]^=p[e];const y=this.mgf1(i.algorithm.hash,l,d.length);for(let e=0;e<d.length;e++)d[e]^=y[e];i.pem||(i.pem=`-----BEGIN PUBLIC KEY-----\n${i.data.toString("base64")}\n-----END PUBLIC KEY-----`);const m=Ge().publicEncrypt({key:i.pem,padding:Ge().constants.RSA_NO_PADDING},Buffer.from(h));return new Uint8Array(m).buffer}async onDecrypt(e,t,r){const i=rt(t),s=Math.ceil(i.algorithm.modulusLength>>3),o=It.size(i.algorithm.hash)>>3;if(r.byteLength!==s)throw new Error("Bad data");i.pem||(i.pem=`-----BEGIN PRIVATE KEY-----\n${i.data.toString("base64")}\n-----END PRIVATE KEY-----`);let a=Ge().privateDecrypt({key:i.pem,padding:Ge().constants.RSA_NO_PADDING},Buffer.from(r));const c=a[0],u=a.subarray(1,o+1),h=a.subarray(o+1);if(0!==c)throw new Error("Decryption failed");const d=this.mgf1(i.algorithm.hash,h,u.length);for(let e=0;e<u.length;e++)u[e]^=d[e];const l=this.mgf1(i.algorithm.hash,u,h.length);for(let e=0;e<h.length;e++)h[e]^=l[e];const f=Ge().createHash(i.algorithm.hash.name.replace("-","")).update(n.vJ.toUint8Array(e.label||new Uint8Array(0))).digest();for(let e=0;e<o;e++)if(f[e]!==h[e])throw new Error("Decryption failed");let p=o;for(;p<h.length;p++){const e=h[p];if(1===e)break;if(0!==e)throw new Error("Decryption failed")}if(p===h.length)throw new Error("Decryption failed");return a=h.subarray(p+1),new Uint8Array(a).buffer}async onExportKey(e,t){return kt.exportKey(e,rt(t))}async onImportKey(e,t,r,i,n){return it(await kt.importKey(e,t,{...r,name:this.name},i,n))}checkCryptoKey(e,t){super.checkCryptoKey(e,t);const r=rt(e);if(!(r instanceof Et||r instanceof Ct))throw new TypeError("key: Is not RSA CryptoKey")}mgf1(e,t,r=0){const i=It.size(e)>>3,n=new Uint8Array(r),s=new Uint8Array(4),o=Math.ceil(r/i);for(let r=0;r<o;r++){s[0]=r>>>24,s[1]=r>>>16&255,s[2]=r>>>8&255,s[3]=255&r;const o=n.subarray(r*i);let a=Ge().createHash(e.name.replace("-","")).update(t).update(s).digest();a.length>o.length&&(a=a.subarray(0,o.length)),o.set(a)}return n}}class xt extends B{constructor(){super(...arguments),this.name="RSAES-PKCS1-v1_5",this.usages={publicKey:["encrypt","wrapKey"],privateKey:["decrypt","unwrapKey"]}}async onGenerateKey(e,t,r){const i=await kt.generateKey({...e,name:this.name},t,r);return{privateKey:it(i.privateKey),publicKey:it(i.publicKey)}}checkGenerateKeyParams(e){if(this.checkRequiredProperty(e,"publicExponent"),!(e.publicExponent&&e.publicExponent instanceof Uint8Array))throw new TypeError("publicExponent: Missing or not a Uint8Array");const t=n.ep.ToBase64(e.publicExponent);if("Aw=="!==t&&"AQAB"!==t)throw new TypeError("publicExponent: Must be [3] or [1,0,1]");switch(this.checkRequiredProperty(e,"modulusLength"),e.modulusLength){case 1024:case 2048:case 4096:break;default:throw new TypeError("modulusLength: Must be 1024, 2048, or 4096")}}async onEncrypt(e,t,r){const i=this.toCryptoOptions(t),n=We.publicEncrypt(i,new Uint8Array(r));return new Uint8Array(n).buffer}async onDecrypt(e,t,r){const i=this.toCryptoOptions(t),n=We.privateDecrypt(i,new Uint8Array(r));return new Uint8Array(n).buffer}async onExportKey(e,t){return kt.exportKey(e,rt(t))}async onImportKey(e,t,r,i,n){return it(await kt.importKey(e,t,{...r,name:this.name},i,n))}checkCryptoKey(e,t){super.checkCryptoKey(e,t);const r=rt(e);if(!(r instanceof Et||r instanceof Ct))throw new TypeError("key: Is not RSA CryptoKey")}toCryptoOptions(e){const t=e.type.toUpperCase();return{key:`-----BEGIN ${t} KEY-----\n${rt(e).data.toString("base64")}\n-----END ${t} KEY-----`,padding:We.constants.RSA_PKCS1_PADDING}}}const Bt={"1.2.840.10045.3.1.7":"P-256","P-256":"1.2.840.10045.3.1.7","1.3.132.0.34":"P-384","P-384":"1.3.132.0.34","1.3.132.0.35":"P-521","P-521":"1.3.132.0.35","1.3.132.0.10":"K-256","K-256":"1.3.132.0.10",brainpoolP160r1:"1.3.36.3.3.2.8.1.1.1","1.3.36.3.3.2.8.1.1.1":"brainpoolP160r1",brainpoolP160t1:"1.3.36.3.3.2.8.1.1.2","1.3.36.3.3.2.8.1.1.2":"brainpoolP160t1",brainpoolP192r1:"1.3.36.3.3.2.8.1.1.3","1.3.36.3.3.2.8.1.1.3":"brainpoolP192r1",brainpoolP192t1:"1.3.36.3.3.2.8.1.1.4","1.3.36.3.3.2.8.1.1.4":"brainpoolP192t1",brainpoolP224r1:"1.3.36.3.3.2.8.1.1.5","1.3.36.3.3.2.8.1.1.5":"brainpoolP224r1",brainpoolP224t1:"1.3.36.3.3.2.8.1.1.6","1.3.36.3.3.2.8.1.1.6":"brainpoolP224t1",brainpoolP256r1:"1.3.36.3.3.2.8.1.1.7","1.3.36.3.3.2.8.1.1.7":"brainpoolP256r1",brainpoolP256t1:"1.3.36.3.3.2.8.1.1.8","1.3.36.3.3.2.8.1.1.8":"brainpoolP256t1",brainpoolP320r1:"1.3.36.3.3.2.8.1.1.9","1.3.36.3.3.2.8.1.1.9":"brainpoolP320r1",brainpoolP320t1:"1.3.36.3.3.2.8.1.1.10","1.3.36.3.3.2.8.1.1.10":"brainpoolP320t1",brainpoolP384r1:"1.3.36.3.3.2.8.1.1.11","1.3.36.3.3.2.8.1.1.11":"brainpoolP384r1",brainpoolP384t1:"1.3.36.3.3.2.8.1.1.12","1.3.36.3.3.2.8.1.1.12":"brainpoolP384t1",brainpoolP512r1:"1.3.36.3.3.2.8.1.1.13","1.3.36.3.3.2.8.1.1.13":"brainpoolP512r1",brainpoolP512t1:"1.3.36.3.3.2.8.1.1.14","1.3.36.3.3.2.8.1.1.14":"brainpoolP512t1"};function Ot(e){const t=Bt[e];if(!t)throw new R(`Cannot convert WebCrypto named curve '${e}' to OID`);return t}class Mt extends Qe{constructor(){super(...arguments),this.type="private"}getKey(){const e=s.Vs.parse(this.data,De.PrivateKeyInfo);return s.Vs.parse(e.privateKey,De.EcPrivateKey)}toJSON(){const e=this.getKey(),t={kty:"EC",crv:this.algorithm.namedCurve,key_ops:this.usages,ext:this.extractable};return Object.assign(t,A.toJSON(e))}fromJSON(e){if(!e.crv)throw new R("Cannot get named curve from JWK. Property 'crv' is required");const t=new De.PrivateKeyInfo;t.privateKeyAlgorithm.algorithm="1.2.840.10045.2.1",t.privateKeyAlgorithm.parameters=s.xg.serialize(new De.ObjectIdentifier(Ot(e.crv)));const r=E.fromJSON(e,{targetSchema:De.EcPrivateKey});return t.privateKey=s.xg.serialize(r),this.data=Buffer.from(s.xg.serialize(t)),this}}class Nt extends Qe{constructor(){super(...arguments),this.type="public"}getKey(){const e=s.Vs.parse(this.data,De.PublicKeyInfo);return new De.EcPublicKey(e.publicKey)}toJSON(){const e=this.getKey(),t={kty:"EC",crv:this.algorithm.namedCurve,key_ops:this.usages,ext:this.extractable};return Object.assign(t,A.toJSON(e))}fromJSON(e){if(!e.crv)throw new R("Cannot get named curve from JWK. Property 'crv' is required");const t=E.fromJSON(e,{targetSchema:De.EcPublicKey}),r=new De.PublicKeyInfo;return r.publicKeyAlgorithm.algorithm="1.2.840.10045.2.1",r.publicKeyAlgorithm.parameters=s.xg.serialize(new De.ObjectIdentifier(Ot(e.crv))),r.publicKey=s.xg.toASN(t).valueHex,this.data=Buffer.from(s.xg.serialize(r)),this}}class Dt extends B{constructor(){super(...arguments),this.name="SHA-1",this.usages=[]}async onDigest(e,t){return It.digest(e,t)}}class Lt extends B{constructor(){super(...arguments),this.name="SHA-256",this.usages=[]}async onDigest(e,t){return It.digest(e,t)}}class Ut extends B{constructor(){super(...arguments),this.name="SHA-384",this.usages=[]}async onDigest(e,t){return It.digest(e,t)}}class jt extends B{constructor(){super(...arguments),this.name="SHA-512",this.usages=[]}async onDigest(e,t){return It.digest(e,t)}}class qt extends B{constructor(){super(...arguments),this.name="SHA3-256",this.usages=[]}async onDigest(e,t){return It.digest(e,t)}}class Kt extends B{constructor(){super(...arguments),this.name="SHA3-384",this.usages=[]}async onDigest(e,t){return It.digest(e,t)}}class Ht extends B{constructor(){super(...arguments),this.name="SHA3-512",this.usages=[]}async onDigest(e,t){return It.digest(e,t)}}class zt{static async generateKey(e,t,r){const i=new Mt;i.algorithm=e,i.extractable=t,i.usages=r.filter((e=>-1!==this.privateKeyUsages.indexOf(e)));const n=new Nt;n.algorithm=e,n.extractable=!0,n.usages=r.filter((e=>-1!==this.publicKeyUsages.indexOf(e)));const s=Ge().generateKeyPairSync("ec",{namedCurve:this.getOpenSSLNamedCurve(e.namedCurve),publicKeyEncoding:{format:"der",type:"spki"},privateKeyEncoding:{format:"der",type:"pkcs8"}});i.data=s.privateKey,n.data=s.publicKey;return{privateKey:i,publicKey:n}}static async sign(e,t,r){const i=It.getAlgorithmName(e.hash),n=Ge().createSign(i);n.update(Buffer.from(r)),t.pem||(t.pem=`-----BEGIN PRIVATE KEY-----\n${t.data.toString("base64")}\n-----END PRIVATE KEY-----`);const o={key:t.pem},a=n.sign(o),c=s.Vs.parse(a,De.EcDsaSignature);return he.encodeSignature(c,Le.get(t.algorithm.namedCurve).size).buffer}static async verify(e,t,r,i){const o=It.getAlgorithmName(e.hash),a=Ge().createVerify(o);a.update(Buffer.from(i)),t.pem||(t.pem=`-----BEGIN PUBLIC KEY-----\n${t.data.toString("base64")}\n-----END PUBLIC KEY-----`);const c={key:t.pem},u=new De.EcDsaSignature,h=Le.get(t.algorithm.namedCurve),d=he.decodeSignature(r,h.size);u.r=n.vJ.toArrayBuffer(d.r),u.s=n.vJ.toArrayBuffer(d.s);const l=Buffer.from(s.xg.serialize(u));return a.verify(c,l)}static async deriveBits(e,t,r){const i=this.getOpenSSLNamedCurve(t.algorithm.namedCurve),n=Ge().createECDH(i),o=s.Vs.parse(t.data,De.PrivateKeyInfo),a=s.Vs.parse(o.privateKey,De.EcPrivateKey);n.setPrivateKey(Buffer.from(a.privateKey));const c=s.Vs.parse(e.public.data,De.PublicKeyInfo),u=n.computeSecret(Buffer.from(c.publicKey));return null===r?u:new Uint8Array(u).buffer.slice(0,r>>3)}static async exportKey(e,t){switch(e.toLowerCase()){case"jwk":return A.toJSON(t);case"pkcs8":case"spki":return new Uint8Array(t.data).buffer;case"raw":return s.Vs.parse(t.data,De.PublicKeyInfo).publicKey;default:throw new R("format: Must be 'jwk', 'raw', pkcs8' or 'spki'")}}static async importKey(e,t,r,i,n){switch(e.toLowerCase()){case"jwk":if(t.d){const e=E.fromJSON(t,{targetSchema:De.EcPrivateKey});return this.importPrivateKey(e,r,i,n)}{const e=E.fromJSON(t,{targetSchema:De.EcPublicKey});return this.importPublicKey(e,r,i,n)}case"raw":{const e=new De.EcPublicKey(t);return this.importPublicKey(e,r,i,n)}case"spki":{const e=s.Vs.parse(new Uint8Array(t),De.PublicKeyInfo),o=new De.EcPublicKey(e.publicKey);return this.assertKeyParameters(e.publicKeyAlgorithm.parameters,r.namedCurve),this.importPublicKey(o,r,i,n)}case"pkcs8":{const e=s.Vs.parse(new Uint8Array(t),De.PrivateKeyInfo),o=s.Vs.parse(e.privateKey,De.EcPrivateKey);return this.assertKeyParameters(e.privateKeyAlgorithm.parameters,r.namedCurve),this.importPrivateKey(o,r,i,n)}default:throw new R("format: Must be 'jwk', 'raw', 'pkcs8' or 'spki'")}}static assertKeyParameters(e,t){if(!e)throw new T("Key info doesn't have required parameters");let r="";try{r=s.Vs.parse(e,De.ObjectIdentifier).value}catch(e){throw new T("Cannot read key info parameters")}if(Ot(t)!==r)throw new T("Key info parameter doesn't match to named curve")}static async importPrivateKey(e,t,r,i){const n=new De.PrivateKeyInfo;n.privateKeyAlgorithm.algorithm="1.2.840.10045.2.1",n.privateKeyAlgorithm.parameters=s.xg.serialize(new De.ObjectIdentifier(Ot(t.namedCurve))),n.privateKey=s.xg.serialize(e);const o=new Mt;return o.data=Buffer.from(s.xg.serialize(n)),o.algorithm=Object.assign({},t),o.extractable=r,o.usages=i,o}static async importPublicKey(e,t,r,i){const n=new De.PublicKeyInfo;n.publicKeyAlgorithm.algorithm="1.2.840.10045.2.1";const o=Ot(t.namedCurve);n.publicKeyAlgorithm.parameters=s.xg.serialize(new De.ObjectIdentifier(o)),n.publicKey=e.value;const a=new Nt;return a.data=Buffer.from(s.xg.serialize(n)),a.algorithm=Object.assign({},t),a.extractable=r,a.usages=i,a}static getOpenSSLNamedCurve(e){switch(e.toUpperCase()){case"P-256":return"prime256v1";case"K-256":return"secp256k1";case"P-384":return"secp384r1";case"P-521":return"secp521r1";default:return e}}}zt.publicKeyUsages=["verify"],zt.privateKeyUsages=["sign","deriveKey","deriveBits"];class Ft extends ${constructor(){super(...arguments),this.namedCurves=Le.names,this.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512","shake128","shake256","SHA3-256","SHA3-384","SHA3-512"]}async onGenerateKey(e,t,r){const i=await zt.generateKey({...e,name:this.name},t,r);return{privateKey:it(i.privateKey),publicKey:it(i.publicKey)}}async onSign(e,t,r){return zt.sign(e,rt(t),new Uint8Array(r))}async onVerify(e,t,r,i){return zt.verify(e,rt(t),new Uint8Array(r),new Uint8Array(i))}async onExportKey(e,t){return zt.exportKey(e,rt(t))}async onImportKey(e,t,r,i,n){return it(await zt.importKey(e,t,{...r,name:this.name},i,n))}checkCryptoKey(e,t){super.checkCryptoKey(e,t);const r=rt(e);if(!(r instanceof Mt||r instanceof Nt))throw new TypeError("key: Is not EC CryptoKey")}}class Vt extends J{constructor(){super(...arguments),this.namedCurves=Le.names}async onGenerateKey(e,t,r){const i=await zt.generateKey({...e,name:this.name},t,r);return{privateKey:it(i.privateKey),publicKey:it(i.publicKey)}}async onExportKey(e,t){return zt.exportKey(e,rt(t))}async onImportKey(e,t,r,i,n){return it(await zt.importKey(e,t,{...r,name:this.name},i,n))}checkCryptoKey(e,t){super.checkCryptoKey(e,t);const r=rt(e);if(!(r instanceof Mt||r instanceof Nt))throw new TypeError("key: Is not EC CryptoKey")}async onDeriveBits(e,t,r){return await zt.deriveBits({...e,public:rt(e.public)},rt(t),r)}}const $t={[De.idEd448]:"Ed448",ed448:De.idEd448,[De.idX448]:"X448",x448:De.idX448,[De.idEd25519]:"Ed25519",ed25519:De.idEd25519,[De.idX25519]:"X25519",x25519:De.idX25519};function Wt(e){const t=$t[e.toLowerCase()];if(!t)throw new R(`Cannot convert WebCrypto named curve '${e}' to OID`);return t}class Gt extends Qe{constructor(){super(...arguments),this.type="private"}getKey(){const e=s.Vs.parse(this.data,De.PrivateKeyInfo);return s.Vs.parse(e.privateKey,De.CurvePrivateKey)}toJSON(){const e=this.getKey(),t={kty:"OKP",crv:this.algorithm.namedCurve,key_ops:this.usages,ext:this.extractable};return Object.assign(t,A.toJSON(e))}fromJSON(e){if(!e.crv)throw new R("Cannot get named curve from JWK. Property 'crv' is required");const t=new De.PrivateKeyInfo;t.privateKeyAlgorithm.algorithm=Wt(e.crv);const r=E.fromJSON(e,{targetSchema:De.CurvePrivateKey});return t.privateKey=s.xg.serialize(r),this.data=Buffer.from(s.xg.serialize(t)),this}}class Jt extends Qe{constructor(){super(...arguments),this.type="public"}getKey(){return s.Vs.parse(this.data,De.PublicKeyInfo).publicKey}toJSON(){const e=this.getKey(),t={kty:"OKP",crv:this.algorithm.namedCurve,key_ops:this.usages,ext:this.extractable};return Object.assign(t,{x:n.ep.ToBase64Url(e)})}fromJSON(e){if(!e.crv)throw new R("Cannot get named curve from JWK. Property 'crv' is required");if(!e.x)throw new R("Cannot get property from JWK. Property 'x' is required");const t=new De.PublicKeyInfo;return t.publicKeyAlgorithm.algorithm=Wt(e.crv),t.publicKey=n.ep.FromBase64Url(e.x),this.data=Buffer.from(s.xg.serialize(t)),this}}class Yt{static async generateKey(e,t,r){const i=new Gt;i.algorithm=e,i.extractable=t,i.usages=r.filter((e=>-1!==this.privateKeyUsages.indexOf(e)));const n=new Jt;n.algorithm=e,n.extractable=!0,n.usages=r.filter((e=>-1!==this.publicKeyUsages.indexOf(e)));const s=e.namedCurve.toLowerCase(),o=Ge().generateKeyPairSync(s,{publicKeyEncoding:{format:"der",type:"spki"},privateKeyEncoding:{format:"der",type:"pkcs8"}});i.data=o.privateKey,n.data=o.publicKey;return{privateKey:i,publicKey:n}}static async sign(e,t,r){t.pem||(t.pem=`-----BEGIN PRIVATE KEY-----\n${t.data.toString("base64")}\n-----END PRIVATE KEY-----`);const i={key:t.pem},s=Ge().sign(null,Buffer.from(r),i);return n.vJ.toArrayBuffer(s)}static async verify(e,t,r,i){t.pem||(t.pem=`-----BEGIN PUBLIC KEY-----\n${t.data.toString("base64")}\n-----END PUBLIC KEY-----`);const n={key:t.pem};return Ge().verify(null,Buffer.from(i),n,Buffer.from(r))}static async deriveBits(e,t,r){const i=Ge().createPublicKey({key:e.public.data,format:"der",type:"spki"}),n=Ge().createPrivateKey({key:t.data,format:"der",type:"pkcs8"}),s=Ge().diffieHellman({publicKey:i,privateKey:n});return new Uint8Array(s).buffer.slice(0,r>>3)}static async exportKey(e,t){switch(e.toLowerCase()){case"jwk":return A.toJSON(t);case"pkcs8":case"spki":return new Uint8Array(t.data).buffer;case"raw":return s.Vs.parse(t.data,De.PublicKeyInfo).publicKey;default:throw new R("format: Must be 'jwk', 'raw', pkcs8' or 'spki'")}}static async importKey(e,t,r,i,o){switch(e.toLowerCase()){case"jwk":{const e=t;if(e.d){const e=E.fromJSON(t,{targetSchema:De.CurvePrivateKey});return this.importPrivateKey(e,r,i,o)}if(!e.x)throw new TypeError("keyData: Cannot get required 'x' filed");return this.importPublicKey(n.ep.FromBase64Url(e.x),r,i,o)}case"raw":return this.importPublicKey(t,r,i,o);case"spki":{const e=s.Vs.parse(new Uint8Array(t),De.PublicKeyInfo);return this.importPublicKey(e.publicKey,r,i,o)}case"pkcs8":{const e=s.Vs.parse(new Uint8Array(t),De.PrivateKeyInfo),n=s.Vs.parse(e.privateKey,De.CurvePrivateKey);return this.importPrivateKey(n,r,i,o)}default:throw new R("format: Must be 'jwk', 'raw', 'pkcs8' or 'spki'")}}static importPrivateKey(e,t,r,i){const s=new Gt;return s.fromJSON({crv:t.namedCurve,d:n.ep.ToBase64Url(e.d)}),s.algorithm=Object.assign({},t),s.extractable=r,s.usages=i,s}static async importPublicKey(e,t,r,i){const s=new Jt;return s.fromJSON({crv:t.namedCurve,x:n.ep.ToBase64Url(e)}),s.algorithm=Object.assign({},t),s.extractable=r,s.usages=i,s}}Yt.publicKeyUsages=["verify"],Yt.privateKeyUsages=["sign","deriveKey","deriveBits"];class Zt extends Z{async onGenerateKey(e,t,r){const i=await Yt.generateKey({name:this.name,namedCurve:e.namedCurve.replace(/^ed/i,"Ed")},t,r);return{privateKey:it(i.privateKey),publicKey:it(i.publicKey)}}async onSign(e,t,r){return Yt.sign(e,rt(t),new Uint8Array(r))}async onVerify(e,t,r,i){return Yt.verify(e,rt(t),new Uint8Array(r),new Uint8Array(i))}async onExportKey(e,t){return Yt.exportKey(e,rt(t))}async onImportKey(e,t,r,i,n){return it(await Yt.importKey(e,t,{...r,name:this.name},i,n))}}class Xt extends Y{async onGenerateKey(e,t,r){const i=await Yt.generateKey({name:this.name,namedCurve:e.namedCurve.toUpperCase()},t,r);return{privateKey:it(i.privateKey),publicKey:it(i.publicKey)}}async onDeriveBits(e,t,r){return await Yt.deriveBits({...e,public:rt(e.public)},rt(t),r)}async onExportKey(e,t){return Yt.exportKey(e,rt(t))}async onImportKey(e,t,r,i,n){return it(await Yt.importKey(e,t,{...r,name:this.name},i,n))}}class Qt extends Ze{}class er extends je{async onDeriveBits(e,t,r){return new Promise(((i,s)=>{const o=n.vJ.toArrayBuffer(e.salt),a=e.hash.name.replace("-","");Ge().pbkdf2(rt(t).data,Buffer.from(o),e.iterations,r>>3,a,((e,t)=>{e?s(e):i(new Uint8Array(t).buffer)}))}))}async onImportKey(e,t,r,i,n){if("raw"===e){const e=new Qt;return e.data=Buffer.from(t),e.algorithm={name:this.name},e.extractable=!1,e.usages=n,it(e)}throw new R("format: Must be 'raw'")}checkCryptoKey(e,t){if(super.checkCryptoKey(e,t),!(rt(e)instanceof Qt))throw new TypeError("key: Is not PBKDF CryptoKey")}}class tr extends Ze{get alg(){return`HS${this.algorithm.hash.name.toUpperCase().replace("SHA-","")}`}set alg(e){}}(0,o.__decorate)([C({name:"k",converter:Ye})],tr.prototype,"data",void 0);class rr extends Ue{async onGenerateKey(e,t,r){const i=(e.length||this.getDefaultLength(e.hash.name))>>3<<3,n=new tr;return n.algorithm={...e,length:i,name:this.name},n.extractable=t,n.usages=r,n.data=Ge().randomBytes(i>>3),it(n)}async onSign(e,t,r){const i=It.getAlgorithmName(t.algorithm.hash),n=Ge().createHmac(i,rt(t).data).update(Buffer.from(r)).digest();return new Uint8Array(n).buffer}async onVerify(e,t,r,i){const n=It.getAlgorithmName(t.algorithm.hash);return 0===Ge().createHmac(n,rt(t).data).update(Buffer.from(i)).digest().compare(Buffer.from(r))}async onImportKey(e,t,r,i,n){let s;switch(e.toLowerCase()){case"jwk":s=E.fromJSON(t,{targetSchema:tr});break;case"raw":s=new tr,s.data=Buffer.from(t);break;default:throw new R("format: Must be 'jwk' or 'raw'")}return s.algorithm={hash:{name:r.hash.name},name:this.name,length:s.data.length<<3},s.extractable=i,s.usages=n,it(s)}async onExportKey(e,t){switch(e.toLowerCase()){case"jwk":return A.toJSON(rt(t));case"raw":return new Uint8Array(rt(t).data).buffer;default:throw new R("format: Must be 'jwk' or 'raw'")}}checkCryptoKey(e,t){if(super.checkCryptoKey(e,t),!(rt(e)instanceof tr))throw new TypeError("key: Is not HMAC CryptoKey")}}class ir extends Ze{}class nr extends qe{async onImportKey(e,t,r,i,n){if("raw"!==e.toLowerCase())throw new R("Operation not supported");const s=new ir;return s.data=Buffer.from(t),s.algorithm={name:this.name},s.extractable=i,s.usages=n,it(s)}async onDeriveBits(e,t,r){const i=e.hash.name.replace("-",""),s=Ge().createHash(i).digest().length,o=r/8,a=n.vJ.toUint8Array(e.info),c=Ge().createHmac(i,n.vJ.toUint8Array(e.salt)).update(n.vJ.toUint8Array(rt(t).data)).digest(),u=[Buffer.alloc(0)],h=Math.ceil(o/s)+1;for(let e=1;e<h;++e)u.push(Ge().createHmac(i,c).update(Buffer.concat([u[e-1],a,Buffer.from([e])])).digest());return Buffer.concat(u).slice(0,o)}checkCryptoKey(e,t){if(super.checkCryptoKey(e,t),!(rt(e)instanceof ir))throw new TypeError("key: Is not HKDF CryptoKey")}}class sr{static digest(e,t){const r=Ge().createHash(e.name.toLowerCase(),{outputLength:e.length}).update(Buffer.from(t)).digest();return new Uint8Array(r).buffer}}class or extends He{async onDigest(e,t){return sr.digest(e,t)}}class ar extends ze{async onDigest(e,t){return sr.digest(e,t)}}class cr extends $e{constructor(){var e;super(),this.providers.set(new st),this.providers.set(new yt),this.providers.set(new mt),this.providers.set(new pt),this.providers.set(new gt),this.providers.set(new bt),this.providers.set(new St),this.providers.set(new _t),this.providers.set(new Tt),this.providers.set(new Pt),this.providers.set(new Rt),this.providers.set(new xt),this.providers.set(new Ft),this.providers.set(new Vt),this.providers.set(new Dt),this.providers.set(new Lt),this.providers.set(new Ut),this.providers.set(new jt),this.providers.set(new er),this.providers.set(new rr),this.providers.set(new nr);const t=null===(e=/^v(\d+)/.exec(Je.version))||void 0===e?void 0:e[1];t&&parseInt(t,10)>=12&&(this.providers.set(new or),this.providers.set(new ar));const r=We.getHashes();r.includes("sha3-256")&&this.providers.set(new qt),r.includes("sha3-384")&&this.providers.set(new Kt),r.includes("sha3-512")&&this.providers.set(new Ht),t&&parseInt(t,10)>=14&&(this.providers.set(new Zt),this.providers.set(new Xt))}}class ur extends Fe{constructor(){super(...arguments),this.subtle=new cr}getRandomValues(e){if(!ArrayBuffer.isView(e))throw new TypeError("Failed to execute 'getRandomValues' on 'Crypto': parameter 1 is not of type 'ArrayBufferView'");const t=Buffer.from(e.buffer,e.byteOffset,e.byteLength);return Ge().randomFillSync(t),e}}},7091:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AlgorithmProvider:()=>es,AsnData:()=>qs,AsnDefaultSignatureFormatter:()=>wo,AsnEcSignatureFormatter:()=>Do,Attribute:()=>xo,AttributeFactory:()=>Mo,AuthorityKeyIdentifierExtension:()=>_o,BasicConstraintsExtension:()=>Ao,CertificatePolicyExtension:()=>Ro,ChallengePasswordAttribute:()=>Bo,CryptoProvider:()=>zs,DefaultAlgorithmSerializer:()=>Ls,EcAlgorithm:()=>Os,EdAlgorithm:()=>Ko,ExtendedKeyUsage:()=>Eo,ExtendedKeyUsageExtension:()=>ko,Extension:()=>Ks,ExtensionFactory:()=>bo,ExtensionsAttribute:()=>Oo,GeneralName:()=>ho,GeneralNames:()=>lo,KeyUsageFlags:()=>Co,KeyUsagesExtension:()=>To,Name:()=>Js,NameIdentifier:()=>$s,OidSerializer:()=>Us,PemConverter:()=>yo,Pkcs10CertificateRequest:()=>Ho,Pkcs10CertificateRequestGenerator:()=>zo,PublicKey:()=>go,RsaAlgorithm:()=>No,SubjectAlternativeNameExtension:()=>Io,SubjectKeyIdentifierExtension:()=>Po,TextConverter:()=>js,TextObject:()=>Ds,X509Certificate:()=>So,X509CertificateGenerator:()=>$o,X509Certificates:()=>Fo,X509ChainBuilder:()=>Vo,X509Crl:()=>Jo,X509CrlEntry:()=>Go,X509CrlGenerator:()=>Yo,X509CrlReason:()=>Wo,cryptoProvider:()=>Fs,diAlgorithm:()=>Qn,diAlgorithmProvider:()=>ts,diAsnSignatureFormatter:()=>vo,idEd25519:()=>jo,idEd448:()=>qo,idX25519:()=>Lo,idX448:()=>Uo});r(8555);var i,n,s,o=r(1750),a=r(1443),c=r(4492),u=r(9715);class h{static decodeIP(e){if(64===e.length&&0===parseInt(e,16))return"::/0";if(16!==e.length)return e;const t=parseInt(e.slice(8),16).toString(2).split("").reduce(((e,t)=>e+ +t),0);let r=e.slice(0,8).replace(/(.{2})/g,(e=>`${parseInt(e,16)}.`));return r=r.slice(0,-1),`${r}/${t}`}static toString(e){if(4===e.byteLength||16===e.byteLength){const t=new Uint8Array(e);return c.fromByteArray(Array.from(t)).toString()}return this.decodeIP(u.ep.ToHex(e))}static fromString(e){const t=c.parse(e);return new Uint8Array(t.toByteArray()).buffer}}let d=class{constructor(e={}){Object.assign(this,e)}toString(){return this.bmpString||this.printableString||this.teletexString||this.universalString||this.utf8String||""}};(0,a.__decorate)([(0,o.qw)({type:o.gZ.TeletexString})],d.prototype,"teletexString",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.PrintableString})],d.prototype,"printableString",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.UniversalString})],d.prototype,"universalString",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Utf8String})],d.prototype,"utf8String",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.BmpString})],d.prototype,"bmpString",void 0),d=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],d);let l=class extends d{constructor(e={}){super(e),Object.assign(this,e)}toString(){return this.ia5String||(this.anyValue?u.ep.ToHex(this.anyValue):super.toString())}};(0,a.__decorate)([(0,o.qw)({type:o.gZ.IA5String})],l.prototype,"ia5String",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Any})],l.prototype,"anyValue",void 0),l=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],l);class f{constructor(e={}){this.type="",this.value=new l,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],f.prototype,"type",void 0),(0,a.__decorate)([(0,o.qw)({type:l})],f.prototype,"value",void 0);let p=i=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,i.prototype)}};p=i=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Set,itemType:f})],p);let y=n=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,n.prototype)}};y=n=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence,itemType:p})],y);let m=s=class extends y{constructor(e){super(e),Object.setPrototypeOf(this,s.prototype)}};m=s=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence})],m);const g={fromASN:e=>h.toString(o.Cz.fromASN(e)),toASN:e=>o.Cz.toASN(h.fromString(e))};class b{constructor(e={}){this.typeId="",this.value=new ArrayBuffer(0),Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],b.prototype,"typeId",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Any,context:0})],b.prototype,"value",void 0);class v{constructor(e={}){this.partyName=new ArrayBuffer(0),Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:d,optional:!0,context:0,implicit:!0})],v.prototype,"nameAssigner",void 0),(0,a.__decorate)([(0,o.qw)({type:d,context:1,implicit:!0})],v.prototype,"partyName",void 0);let w=class{constructor(e={}){Object.assign(this,e)}};(0,a.__decorate)([(0,o.qw)({type:b,context:0,implicit:!0})],w.prototype,"otherName",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.IA5String,context:1,implicit:!0})],w.prototype,"rfc822Name",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.IA5String,context:2,implicit:!0})],w.prototype,"dNSName",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Any,context:3,implicit:!0})],w.prototype,"x400Address",void 0),(0,a.__decorate)([(0,o.qw)({type:m,context:4,implicit:!1})],w.prototype,"directoryName",void 0),(0,a.__decorate)([(0,o.qw)({type:v,context:5})],w.prototype,"ediPartyName",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.IA5String,context:6,implicit:!0})],w.prototype,"uniformResourceIdentifier",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.OctetString,context:7,implicit:!0,converter:g})],w.prototype,"iPAddress",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier,context:8,implicit:!0})],w.prototype,"registeredID",void 0),w=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],w);const S="1.3.6.1.5.5.7",_=`${S}.3`;var A;class E{constructor(e={}){this.accessMethod="",this.accessLocation=new w,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],E.prototype,"accessMethod",void 0),(0,a.__decorate)([(0,o.qw)({type:w})],E.prototype,"accessLocation",void 0);let C=A=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,A.prototype)}};C=A=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence,itemType:E})],C);const k="2.5.29.35";class T extends o.fi{}class P{constructor(e={}){e&&Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:T,context:0,optional:!0,implicit:!0})],P.prototype,"keyIdentifier",void 0),(0,a.__decorate)([(0,o.qw)({type:w,context:1,optional:!0,implicit:!0,repeated:"sequence"})],P.prototype,"authorityCertIssuer",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,context:2,optional:!0,implicit:!0,converter:o.te})],P.prototype,"authorityCertSerialNumber",void 0);const I="2.5.29.19";class R{constructor(e={}){this.cA=!1,Object.assign(this,e)}}var x;(0,a.__decorate)([(0,o.qw)({type:o.gZ.Boolean,defaultValue:!1})],R.prototype,"cA",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,optional:!0})],R.prototype,"pathLenConstraint",void 0);let B=x=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,x.prototype)}};var O;B=x=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence,itemType:w})],B);let M=O=class extends B{constructor(e){super(e),Object.setPrototypeOf(this,O.prototype)}};var N;M=O=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence})],M);const D="2.5.29.32";let L=class{constructor(e={}){Object.assign(this,e)}toString(){return this.ia5String||this.visibleString||this.bmpString||this.utf8String||""}};(0,a.__decorate)([(0,o.qw)({type:o.gZ.IA5String})],L.prototype,"ia5String",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.VisibleString})],L.prototype,"visibleString",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.BmpString})],L.prototype,"bmpString",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Utf8String})],L.prototype,"utf8String",void 0),L=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],L);class U{constructor(e={}){this.organization=new L,this.noticeNumbers=[],Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:L})],U.prototype,"organization",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,repeated:"sequence"})],U.prototype,"noticeNumbers",void 0);class j{constructor(e={}){Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:U,optional:!0})],j.prototype,"noticeRef",void 0),(0,a.__decorate)([(0,o.qw)({type:L,optional:!0})],j.prototype,"explicitText",void 0);let q=class{constructor(e={}){Object.assign(this,e)}};(0,a.__decorate)([(0,o.qw)({type:o.gZ.IA5String})],q.prototype,"cPSuri",void 0),(0,a.__decorate)([(0,o.qw)({type:j})],q.prototype,"userNotice",void 0),q=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],q);class K{constructor(e={}){this.policyQualifierId="",this.qualifier=new ArrayBuffer(0),Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],K.prototype,"policyQualifierId",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Any})],K.prototype,"qualifier",void 0);class H{constructor(e={}){this.policyIdentifier="",Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],H.prototype,"policyIdentifier",void 0),(0,a.__decorate)([(0,o.qw)({type:K,repeated:"sequence",optional:!0})],H.prototype,"policyQualifiers",void 0);let z=N=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,N.prototype)}};z=N=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence,itemType:H})],z);let F=class{constructor(e=0){this.value=e}};(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer})],F.prototype,"value",void 0),F=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],F);let V=class extends F{};var $;V=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],V);var W;!function(e){e[e.unused=1]="unused",e[e.keyCompromise=2]="keyCompromise",e[e.cACompromise=4]="cACompromise",e[e.affiliationChanged=8]="affiliationChanged",e[e.superseded=16]="superseded",e[e.cessationOfOperation=32]="cessationOfOperation",e[e.certificateHold=64]="certificateHold",e[e.privilegeWithdrawn=128]="privilegeWithdrawn",e[e.aACompromise=256]="aACompromise"}(W||(W={}));class G extends o._K{toJSON(){const e=[],t=this.toNumber();return t&W.aACompromise&&e.push("aACompromise"),t&W.affiliationChanged&&e.push("affiliationChanged"),t&W.cACompromise&&e.push("cACompromise"),t&W.certificateHold&&e.push("certificateHold"),t&W.cessationOfOperation&&e.push("cessationOfOperation"),t&W.keyCompromise&&e.push("keyCompromise"),t&W.privilegeWithdrawn&&e.push("privilegeWithdrawn"),t&W.superseded&&e.push("superseded"),t&W.unused&&e.push("unused"),e}toString(){return`[${this.toJSON().join(", ")}]`}}let J=class{constructor(e={}){Object.assign(this,e)}};(0,a.__decorate)([(0,o.qw)({type:w,context:0,repeated:"sequence",implicit:!0})],J.prototype,"fullName",void 0),(0,a.__decorate)([(0,o.qw)({type:p,context:1,implicit:!0})],J.prototype,"nameRelativeToCRLIssuer",void 0),J=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],J);class Y{constructor(e={}){Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:J,context:0,optional:!0})],Y.prototype,"distributionPoint",void 0),(0,a.__decorate)([(0,o.qw)({type:G,context:1,optional:!0,implicit:!0})],Y.prototype,"reasons",void 0),(0,a.__decorate)([(0,o.qw)({type:w,context:2,optional:!0,repeated:"sequence",implicit:!0})],Y.prototype,"cRLIssuer",void 0);let Z=$=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,$.prototype)}};var X;Z=$=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence,itemType:Y})],Z);let Q=X=class extends Z{constructor(e){super(e),Object.setPrototypeOf(this,X.prototype)}};Q=X=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence,itemType:Y})],Q);class ee{constructor(e={}){this.onlyContainsUserCerts=ee.ONLY,this.onlyContainsCACerts=ee.ONLY,this.indirectCRL=ee.ONLY,this.onlyContainsAttributeCerts=ee.ONLY,Object.assign(this,e)}}ee.ONLY=!1,(0,a.__decorate)([(0,o.qw)({type:J,context:0,optional:!0})],ee.prototype,"distributionPoint",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Boolean,context:1,defaultValue:ee.ONLY,implicit:!0})],ee.prototype,"onlyContainsUserCerts",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Boolean,context:2,defaultValue:ee.ONLY,implicit:!0})],ee.prototype,"onlyContainsCACerts",void 0),(0,a.__decorate)([(0,o.qw)({type:G,context:3,optional:!0,implicit:!0})],ee.prototype,"onlySomeReasons",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Boolean,context:4,defaultValue:ee.ONLY,implicit:!0})],ee.prototype,"indirectCRL",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Boolean,context:5,defaultValue:ee.ONLY,implicit:!0})],ee.prototype,"onlyContainsAttributeCerts",void 0);const te="2.5.29.21";var re;!function(e){e[e.unspecified=0]="unspecified",e[e.keyCompromise=1]="keyCompromise",e[e.cACompromise=2]="cACompromise",e[e.affiliationChanged=3]="affiliationChanged",e[e.superseded=4]="superseded",e[e.cessationOfOperation=5]="cessationOfOperation",e[e.certificateHold=6]="certificateHold",e[e.removeFromCRL=8]="removeFromCRL",e[e.privilegeWithdrawn=9]="privilegeWithdrawn",e[e.aACompromise=10]="aACompromise"}(re||(re={}));let ie=class{constructor(e=re.unspecified){this.reason=re.unspecified,this.reason=e}toJSON(){return re[this.reason]}toString(){return this.toJSON()}};var ne;(0,a.__decorate)([(0,o.qw)({type:o.gZ.Enumerated})],ie.prototype,"reason",void 0),ie=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],ie);const se="2.5.29.37";let oe=ne=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,ne.prototype)}};oe=ne=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence,itemType:o.gZ.ObjectIdentifier})],oe);const ae=`${_}.1`,ce=`${_}.2`,ue=`${_}.3`,he=`${_}.4`,de=`${_}.8`,le=`${_}.9`;let fe=class{constructor(e=new ArrayBuffer(0)){this.value=e}};(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,converter:o.te})],fe.prototype,"value",void 0),fe=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],fe);const pe="2.5.29.24";let ye=class{constructor(e){this.value=new Date,e&&(this.value=e)}};var me;(0,a.__decorate)([(0,o.qw)({type:o.gZ.GeneralizedTime})],ye.prototype,"value",void 0),ye=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],ye);let ge=me=class extends B{constructor(e){super(e),Object.setPrototypeOf(this,me.prototype)}};ge=me=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence})],ge);const be="2.5.29.15";var ve,we;!function(e){e[e.digitalSignature=1]="digitalSignature",e[e.nonRepudiation=2]="nonRepudiation",e[e.keyEncipherment=4]="keyEncipherment",e[e.dataEncipherment=8]="dataEncipherment",e[e.keyAgreement=16]="keyAgreement",e[e.keyCertSign=32]="keyCertSign",e[e.cRLSign=64]="cRLSign",e[e.encipherOnly=128]="encipherOnly",e[e.decipherOnly=256]="decipherOnly"}(ve||(ve={}));class Se extends o._K{toJSON(){const e=this.toNumber(),t=[];return e&ve.cRLSign&&t.push("crlSign"),e&ve.dataEncipherment&&t.push("dataEncipherment"),e&ve.decipherOnly&&t.push("decipherOnly"),e&ve.digitalSignature&&t.push("digitalSignature"),e&ve.encipherOnly&&t.push("encipherOnly"),e&ve.keyAgreement&&t.push("keyAgreement"),e&ve.keyCertSign&&t.push("keyCertSign"),e&ve.keyEncipherment&&t.push("keyEncipherment"),e&ve.nonRepudiation&&t.push("nonRepudiation"),t}toString(){return`[${this.toJSON().join(", ")}]`}}class _e{constructor(e={}){this.base=new w,this.minimum=0,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:w})],_e.prototype,"base",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,context:0,defaultValue:0,implicit:!0})],_e.prototype,"minimum",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,context:1,optional:!0,implicit:!0})],_e.prototype,"maximum",void 0);let Ae=we=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,we.prototype)}};Ae=we=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence,itemType:_e})],Ae);class Ee{constructor(e={}){Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:Ae,context:0,optional:!0,implicit:!0})],Ee.prototype,"permittedSubtrees",void 0),(0,a.__decorate)([(0,o.qw)({type:Ae,context:1,optional:!0,implicit:!0})],Ee.prototype,"excludedSubtrees",void 0);class Ce{constructor(e={}){Object.assign(this,e)}}var ke;(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,context:0,implicit:!0,optional:!0,converter:o.te})],Ce.prototype,"requireExplicitPolicy",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,context:1,implicit:!0,optional:!0,converter:o.te})],Ce.prototype,"inhibitPolicyMapping",void 0);class Te{constructor(e={}){this.issuerDomainPolicy="",this.subjectDomainPolicy="",Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],Te.prototype,"issuerDomainPolicy",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],Te.prototype,"subjectDomainPolicy",void 0);let Pe=ke=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,ke.prototype)}};var Ie;Pe=ke=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence,itemType:Te})],Pe);const Re="2.5.29.17";let xe=Ie=class extends B{constructor(e){super(e),Object.setPrototypeOf(this,Ie.prototype)}};xe=Ie=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence})],xe);class Be{constructor(e={}){this.type="",this.values=[],Object.assign(this,e)}}var Oe;(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],Be.prototype,"type",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Any,repeated:"set"})],Be.prototype,"values",void 0);let Me=Oe=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,Oe.prototype)}};Me=Oe=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence,itemType:Be})],Me);const Ne="2.5.29.14";class De extends T{}class Le{constructor(e={}){Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.GeneralizedTime,context:0,implicit:!0,optional:!0})],Le.prototype,"notBefore",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.GeneralizedTime,context:1,implicit:!0,optional:!0})],Le.prototype,"notAfter",void 0);var Ue,je;!function(e){e[e.keyUpdateAllowed=1]="keyUpdateAllowed",e[e.newExtensions=2]="newExtensions",e[e.pKIXCertificate=4]="pKIXCertificate"}(Ue||(Ue={}));class qe extends o._K{toJSON(){const e=[],t=this.toNumber();return t&Ue.pKIXCertificate&&e.push("pKIXCertificate"),t&Ue.newExtensions&&e.push("newExtensions"),t&Ue.keyUpdateAllowed&&e.push("keyUpdateAllowed"),e}toString(){return`[${this.toJSON().join(", ")}]`}}class Ke{constructor(e={}){this.entrustVers="",this.entrustInfoFlags=new qe,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.GeneralString})],Ke.prototype,"entrustVers",void 0),(0,a.__decorate)([(0,o.qw)({type:qe})],Ke.prototype,"entrustInfoFlags",void 0);let He=je=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,je.prototype)}};He=je=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence,itemType:E})],He);class ze{constructor(e={}){this.algorithm="",Object.assign(this,e)}isEqual(e){return e instanceof ze&&e.algorithm==this.algorithm&&(e.parameters&&this.parameters&&u.Xy(e.parameters,this.parameters)||e.parameters===this.parameters)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],ze.prototype,"algorithm",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Any,optional:!0})],ze.prototype,"parameters",void 0);class Fe{constructor(e={}){this.algorithm=new ze,this.subjectPublicKey=new ArrayBuffer(0),Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:ze})],Fe.prototype,"algorithm",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.BitString})],Fe.prototype,"subjectPublicKey",void 0);let Ve=class{constructor(e){if(e)if("string"==typeof e||"number"==typeof e||e instanceof Date){const t=new Date(e);t.getUTCFullYear()>2049?this.generalTime=t:this.utcTime=t}else Object.assign(this,e)}getTime(){const e=this.utcTime||this.generalTime;if(!e)throw new Error("Cannot get time from CHOICE object");return e}};(0,a.__decorate)([(0,o.qw)({type:o.gZ.UTCTime})],Ve.prototype,"utcTime",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.GeneralizedTime})],Ve.prototype,"generalTime",void 0),Ve=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],Ve);class $e{constructor(e){this.notBefore=new Ve(new Date),this.notAfter=new Ve(new Date),e&&(this.notBefore=new Ve(e.notBefore),this.notAfter=new Ve(e.notAfter))}}var We;(0,a.__decorate)([(0,o.qw)({type:Ve})],$e.prototype,"notBefore",void 0),(0,a.__decorate)([(0,o.qw)({type:Ve})],$e.prototype,"notAfter",void 0);class Ge{constructor(e={}){this.extnID="",this.critical=Ge.CRITICAL,this.extnValue=new o.fi,Object.assign(this,e)}}Ge.CRITICAL=!1,(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],Ge.prototype,"extnID",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Boolean,defaultValue:Ge.CRITICAL})],Ge.prototype,"critical",void 0),(0,a.__decorate)([(0,o.qw)({type:o.fi})],Ge.prototype,"extnValue",void 0);let Je=We=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,We.prototype)}};var Ye,Ze;Je=We=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence,itemType:Ge})],Je),function(e){e[e.v1=0]="v1",e[e.v2=1]="v2",e[e.v3=2]="v3"}(Ye||(Ye={}));class Xe{constructor(e={}){this.version=Ye.v1,this.serialNumber=new ArrayBuffer(0),this.signature=new ze,this.issuer=new m,this.validity=new $e,this.subject=new m,this.subjectPublicKeyInfo=new Fe,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,context:0,defaultValue:Ye.v1})],Xe.prototype,"version",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,converter:o.te})],Xe.prototype,"serialNumber",void 0),(0,a.__decorate)([(0,o.qw)({type:ze})],Xe.prototype,"signature",void 0),(0,a.__decorate)([(0,o.qw)({type:m})],Xe.prototype,"issuer",void 0),(0,a.__decorate)([(0,o.qw)({type:$e})],Xe.prototype,"validity",void 0),(0,a.__decorate)([(0,o.qw)({type:m})],Xe.prototype,"subject",void 0),(0,a.__decorate)([(0,o.qw)({type:Fe})],Xe.prototype,"subjectPublicKeyInfo",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.BitString,context:1,implicit:!0,optional:!0})],Xe.prototype,"issuerUniqueID",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.BitString,context:2,implicit:!0,optional:!0})],Xe.prototype,"subjectUniqueID",void 0),(0,a.__decorate)([(0,o.qw)({type:Je,context:3,optional:!0})],Xe.prototype,"extensions",void 0);class Qe{constructor(e={}){this.tbsCertificate=new Xe,this.signatureAlgorithm=new ze,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:Xe})],Qe.prototype,"tbsCertificate",void 0),(0,a.__decorate)([(0,o.qw)({type:ze})],Qe.prototype,"signatureAlgorithm",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.BitString})],Qe.prototype,"signatureValue",void 0);class et{constructor(e={}){this.userCertificate=new ArrayBuffer(0),this.revocationDate=new Ve,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,converter:o.te})],et.prototype,"userCertificate",void 0),(0,a.__decorate)([(0,o.qw)({type:Ve})],et.prototype,"revocationDate",void 0),(0,a.__decorate)([(0,o.qw)({type:Ge,optional:!0,repeated:"sequence"})],et.prototype,"crlEntryExtensions",void 0);class tt{constructor(e={}){this.signature=new ze,this.issuer=new m,this.thisUpdate=new Ve,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,optional:!0})],tt.prototype,"version",void 0),(0,a.__decorate)([(0,o.qw)({type:ze})],tt.prototype,"signature",void 0),(0,a.__decorate)([(0,o.qw)({type:m})],tt.prototype,"issuer",void 0),(0,a.__decorate)([(0,o.qw)({type:Ve})],tt.prototype,"thisUpdate",void 0),(0,a.__decorate)([(0,o.qw)({type:Ve,optional:!0})],tt.prototype,"nextUpdate",void 0),(0,a.__decorate)([(0,o.qw)({type:et,repeated:"sequence",optional:!0})],tt.prototype,"revokedCertificates",void 0),(0,a.__decorate)([(0,o.qw)({type:Ge,optional:!0,context:0,repeated:"sequence"})],tt.prototype,"crlExtensions",void 0);class rt{constructor(e={}){this.tbsCertList=new tt,this.signatureAlgorithm=new ze,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:tt})],rt.prototype,"tbsCertList",void 0),(0,a.__decorate)([(0,o.qw)({type:ze})],rt.prototype,"signatureAlgorithm",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.BitString})],rt.prototype,"signature",void 0);class it{constructor(e={}){this.attrType="",this.attrValues=[],Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],it.prototype,"attrType",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Any,repeated:"set"})],it.prototype,"attrValues",void 0);class nt{constructor(e={}){this.acIssuer=new w,this.acSerial=0,this.attrs=[],Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:w})],nt.prototype,"acIssuer",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer})],nt.prototype,"acSerial",void 0),(0,a.__decorate)([(0,o.qw)({type:Be,repeated:"sequence"})],nt.prototype,"attrs",void 0);let st=Ze=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,Ze.prototype)}};st=Ze=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence,itemType:o.gZ.ObjectIdentifier})],st);class ot{constructor(e={}){this.permitUnSpecified=!0,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,optional:!0})],ot.prototype,"pathLenConstraint",void 0),(0,a.__decorate)([(0,o.qw)({type:st,implicit:!0,context:0,optional:!0})],ot.prototype,"permittedAttrs",void 0),(0,a.__decorate)([(0,o.qw)({type:st,implicit:!0,context:1,optional:!0})],ot.prototype,"excludedAttrs",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Boolean,defaultValue:!0})],ot.prototype,"permitUnSpecified",void 0);class at{constructor(e={}){this.issuer=new B,this.serial=new ArrayBuffer(0),this.issuerUID=new ArrayBuffer(0),Object.assign(this,e)}}var ct;(0,a.__decorate)([(0,o.qw)({type:B})],at.prototype,"issuer",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,converter:o.te})],at.prototype,"serial",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.BitString,optional:!0})],at.prototype,"issuerUID",void 0),function(e){e[e.publicKey=0]="publicKey",e[e.publicKeyCert=1]="publicKeyCert",e[e.otherObjectTypes=2]="otherObjectTypes"}(ct||(ct={}));class ut{constructor(e={}){this.digestedObjectType=ct.publicKey,this.digestAlgorithm=new ze,this.objectDigest=new ArrayBuffer(0),Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.Enumerated})],ut.prototype,"digestedObjectType",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier,optional:!0})],ut.prototype,"otherObjectTypeID",void 0),(0,a.__decorate)([(0,o.qw)({type:ze})],ut.prototype,"digestAlgorithm",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.BitString})],ut.prototype,"objectDigest",void 0);class ht{constructor(e={}){Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:B,optional:!0})],ht.prototype,"issuerName",void 0),(0,a.__decorate)([(0,o.qw)({type:at,context:0,implicit:!0,optional:!0})],ht.prototype,"baseCertificateID",void 0),(0,a.__decorate)([(0,o.qw)({type:ut,context:1,implicit:!0,optional:!0})],ht.prototype,"objectDigestInfo",void 0);let dt=class{constructor(e={}){Object.assign(this,e)}};(0,a.__decorate)([(0,o.qw)({type:w,repeated:"sequence"})],dt.prototype,"v1Form",void 0),(0,a.__decorate)([(0,o.qw)({type:ht,context:0,implicit:!0})],dt.prototype,"v2Form",void 0),dt=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],dt);class lt{constructor(e={}){this.notBeforeTime=new Date,this.notAfterTime=new Date,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.GeneralizedTime})],lt.prototype,"notBeforeTime",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.GeneralizedTime})],lt.prototype,"notAfterTime",void 0);class ft{constructor(e={}){Object.assign(this,e)}}var pt,yt;(0,a.__decorate)([(0,o.qw)({type:at,implicit:!0,context:0,optional:!0})],ft.prototype,"baseCertificateID",void 0),(0,a.__decorate)([(0,o.qw)({type:B,implicit:!0,context:1,optional:!0})],ft.prototype,"entityName",void 0),(0,a.__decorate)([(0,o.qw)({type:ut,implicit:!0,context:2,optional:!0})],ft.prototype,"objectDigestInfo",void 0),function(e){e[e.v2=1]="v2"}(pt||(pt={}));class mt{constructor(e={}){this.version=pt.v2,this.holder=new ft,this.issuer=new dt,this.signature=new ze,this.serialNumber=new ArrayBuffer(0),this.attrCertValidityPeriod=new lt,this.attributes=[],Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer})],mt.prototype,"version",void 0),(0,a.__decorate)([(0,o.qw)({type:ft})],mt.prototype,"holder",void 0),(0,a.__decorate)([(0,o.qw)({type:dt})],mt.prototype,"issuer",void 0),(0,a.__decorate)([(0,o.qw)({type:ze})],mt.prototype,"signature",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,converter:o.te})],mt.prototype,"serialNumber",void 0),(0,a.__decorate)([(0,o.qw)({type:lt})],mt.prototype,"attrCertValidityPeriod",void 0),(0,a.__decorate)([(0,o.qw)({type:Be,repeated:"sequence"})],mt.prototype,"attributes",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.BitString,optional:!0})],mt.prototype,"issuerUniqueID",void 0),(0,a.__decorate)([(0,o.qw)({type:Je,optional:!0})],mt.prototype,"extensions",void 0);class gt{constructor(e={}){this.acinfo=new mt,this.signatureAlgorithm=new ze,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:mt})],gt.prototype,"acinfo",void 0),(0,a.__decorate)([(0,o.qw)({type:ze})],gt.prototype,"signatureAlgorithm",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.BitString})],gt.prototype,"signatureValue",void 0),function(e){e[e.unmarked=1]="unmarked",e[e.unclassified=2]="unclassified",e[e.restricted=4]="restricted",e[e.confidential=8]="confidential",e[e.secret=16]="secret",e[e.topSecret=32]="topSecret"}(yt||(yt={}));class bt extends o._K{}class vt{constructor(e={}){this.type="",this.value=new ArrayBuffer(0),Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier,implicit:!0,context:0})],vt.prototype,"type",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Any,implicit:!0,context:1})],vt.prototype,"value",void 0);class wt{constructor(e={}){this.policyId="",this.classList=new bt(yt.unclassified),Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],wt.prototype,"policyId",void 0),(0,a.__decorate)([(0,o.qw)({type:bt,defaultValue:new bt(yt.unclassified)})],wt.prototype,"classList",void 0),(0,a.__decorate)([(0,o.qw)({type:vt,repeated:"set"})],wt.prototype,"securityCategories",void 0);class St{constructor(e={}){Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.fi})],St.prototype,"cotets",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],St.prototype,"oid",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Utf8String})],St.prototype,"string",void 0);class _t{constructor(e={}){this.values=[],Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:B,implicit:!0,context:0,optional:!0})],_t.prototype,"policyAuthority",void 0),(0,a.__decorate)([(0,o.qw)({type:St,repeated:"sequence"})],_t.prototype,"values",void 0);var At;class Et{constructor(e={}){this.targetCertificate=new at,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:at})],Et.prototype,"targetCertificate",void 0),(0,a.__decorate)([(0,o.qw)({type:w,optional:!0})],Et.prototype,"targetName",void 0),(0,a.__decorate)([(0,o.qw)({type:ut,optional:!0})],Et.prototype,"certDigestInfo",void 0);let Ct=class{constructor(e={}){Object.assign(this,e)}};(0,a.__decorate)([(0,o.qw)({type:w,context:0,implicit:!0})],Ct.prototype,"targetName",void 0),(0,a.__decorate)([(0,o.qw)({type:w,context:1,implicit:!0})],Ct.prototype,"targetGroup",void 0),(0,a.__decorate)([(0,o.qw)({type:Et,context:2,implicit:!0})],Ct.prototype,"targetCert",void 0),Ct=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],Ct);let kt=At=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,At.prototype)}};var Tt;kt=At=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence,itemType:Ct})],kt);let Pt=Tt=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,Tt.prototype)}};Pt=Tt=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence,itemType:kt})],Pt);class It{constructor(e={}){Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:B,implicit:!0,context:0,optional:!0})],It.prototype,"roleAuthority",void 0),(0,a.__decorate)([(0,o.qw)({type:w,implicit:!0,context:1})],It.prototype,"roleName",void 0);class Rt{constructor(e={}){this.service=new w,this.ident=new w,Object.assign(this,e)}}var xt;(0,a.__decorate)([(0,o.qw)({type:w})],Rt.prototype,"service",void 0),(0,a.__decorate)([(0,o.qw)({type:w})],Rt.prototype,"ident",void 0),(0,a.__decorate)([(0,o.qw)({type:o.fi,optional:!0})],Rt.prototype,"authInfo",void 0);class Bt{constructor(e={}){this.otherCertFormat="",this.otherCert=new ArrayBuffer(0),Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],Bt.prototype,"otherCertFormat",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Any})],Bt.prototype,"otherCert",void 0);let Ot=class{constructor(e={}){Object.assign(this,e)}};(0,a.__decorate)([(0,o.qw)({type:Qe})],Ot.prototype,"certificate",void 0),(0,a.__decorate)([(0,o.qw)({type:gt,context:2,implicit:!0})],Ot.prototype,"v2AttrCert",void 0),(0,a.__decorate)([(0,o.qw)({type:Bt,context:3,implicit:!0})],Ot.prototype,"other",void 0),Ot=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],Ot);let Mt=xt=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,xt.prototype)}};Mt=xt=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Set,itemType:Ot})],Mt);class Nt{constructor(e={}){this.contentType="",this.content=new ArrayBuffer(0),Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],Nt.prototype,"contentType",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Any,context:0})],Nt.prototype,"content",void 0);let Dt=class{constructor(e={}){Object.assign(this,e)}};(0,a.__decorate)([(0,o.qw)({type:o.fi})],Dt.prototype,"single",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Any})],Dt.prototype,"any",void 0),Dt=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],Dt);class Lt{constructor(e={}){this.eContentType="",Object.assign(this,e)}}var Ut;(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],Lt.prototype,"eContentType",void 0),(0,a.__decorate)([(0,o.qw)({type:Dt,context:0,optional:!0})],Lt.prototype,"eContent",void 0),function(e){e[e.v0=0]="v0",e[e.v1=1]="v1",e[e.v2=2]="v2",e[e.v3=3]="v3",e[e.v4=4]="v4",e[e.v5=5]="v5"}(Ut||(Ut={}));let jt=class extends ze{};jt=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence})],jt);let qt=class extends ze{};qt=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence})],qt);let Kt=class extends ze{};Kt=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence})],Kt);let Ht=class extends ze{};Ht=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence})],Ht);let zt=class extends ze{};zt=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence})],zt);let Ft=class extends ze{};Ft=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence})],Ft);let Vt=class{constructor(e={}){Object.assign(this,e)}};(0,a.__decorate)([(0,o.qw)({type:o.fi,context:0,implicit:!0,optional:!0})],Vt.prototype,"value",void 0),(0,a.__decorate)([(0,o.qw)({type:o.fi,converter:o.lW,context:0,implicit:!0,optional:!0,repeated:"sequence"})],Vt.prototype,"constructedValue",void 0),Vt=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],Vt);class $t{constructor(e={}){this.contentType="",this.contentEncryptionAlgorithm=new Ht,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],$t.prototype,"contentType",void 0),(0,a.__decorate)([(0,o.qw)({type:Ht})],$t.prototype,"contentEncryptionAlgorithm",void 0),(0,a.__decorate)([(0,o.qw)({type:Vt,optional:!0})],$t.prototype,"encryptedContent",void 0);class Wt{constructor(e={}){this.issuer=new m,this.serialNumber=new ArrayBuffer(0),Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:m})],Wt.prototype,"issuer",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,converter:o.te})],Wt.prototype,"serialNumber",void 0);class Gt{constructor(e={}){this.keyAttrId="",Object.assign(this,e)}}var Jt;(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],Gt.prototype,"keyAttrId",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Any,optional:!0})],Gt.prototype,"keyAttr",void 0);class Yt{constructor(e={}){this.subjectKeyIdentifier=new De,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:De})],Yt.prototype,"subjectKeyIdentifier",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.GeneralizedTime,optional:!0})],Yt.prototype,"date",void 0),(0,a.__decorate)([(0,o.qw)({type:Gt,optional:!0})],Yt.prototype,"other",void 0);let Zt=class{constructor(e={}){Object.assign(this,e)}};(0,a.__decorate)([(0,o.qw)({type:Yt,context:0,implicit:!0,optional:!0})],Zt.prototype,"rKeyId",void 0),(0,a.__decorate)([(0,o.qw)({type:Wt,optional:!0})],Zt.prototype,"issuerAndSerialNumber",void 0),Zt=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],Zt);class Xt{constructor(e={}){this.rid=new Zt,this.encryptedKey=new o.fi,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:Zt})],Xt.prototype,"rid",void 0),(0,a.__decorate)([(0,o.qw)({type:o.fi})],Xt.prototype,"encryptedKey",void 0);let Qt=Jt=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,Jt.prototype)}};Qt=Jt=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence,itemType:Xt})],Qt);class er{constructor(e={}){this.algorithm=new ze,this.publicKey=new ArrayBuffer(0),Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:ze})],er.prototype,"algorithm",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.BitString})],er.prototype,"publicKey",void 0);let tr=class{constructor(e={}){Object.assign(this,e)}};(0,a.__decorate)([(0,o.qw)({type:De,context:0,implicit:!0,optional:!0})],tr.prototype,"subjectKeyIdentifier",void 0),(0,a.__decorate)([(0,o.qw)({type:er,context:1,implicit:!0,optional:!0})],tr.prototype,"originatorKey",void 0),(0,a.__decorate)([(0,o.qw)({type:Wt,optional:!0})],tr.prototype,"issuerAndSerialNumber",void 0),tr=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],tr);class rr{constructor(e={}){this.version=Ut.v3,this.originator=new tr,this.keyEncryptionAlgorithm=new Kt,this.recipientEncryptedKeys=new Qt,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer})],rr.prototype,"version",void 0),(0,a.__decorate)([(0,o.qw)({type:tr,context:0})],rr.prototype,"originator",void 0),(0,a.__decorate)([(0,o.qw)({type:o.fi,context:1,optional:!0})],rr.prototype,"ukm",void 0),(0,a.__decorate)([(0,o.qw)({type:Kt})],rr.prototype,"keyEncryptionAlgorithm",void 0),(0,a.__decorate)([(0,o.qw)({type:Qt})],rr.prototype,"recipientEncryptedKeys",void 0);let ir=class{constructor(e={}){Object.assign(this,e)}};(0,a.__decorate)([(0,o.qw)({type:De,context:0,implicit:!0})],ir.prototype,"subjectKeyIdentifier",void 0),(0,a.__decorate)([(0,o.qw)({type:Wt})],ir.prototype,"issuerAndSerialNumber",void 0),ir=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],ir);class nr{constructor(e={}){this.version=Ut.v0,this.rid=new ir,this.keyEncryptionAlgorithm=new Kt,this.encryptedKey=new o.fi,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer})],nr.prototype,"version",void 0),(0,a.__decorate)([(0,o.qw)({type:ir})],nr.prototype,"rid",void 0),(0,a.__decorate)([(0,o.qw)({type:Kt})],nr.prototype,"keyEncryptionAlgorithm",void 0),(0,a.__decorate)([(0,o.qw)({type:o.fi})],nr.prototype,"encryptedKey",void 0);class sr{constructor(e={}){this.keyIdentifier=new o.fi,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.fi})],sr.prototype,"keyIdentifier",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.GeneralizedTime,optional:!0})],sr.prototype,"date",void 0),(0,a.__decorate)([(0,o.qw)({type:Gt,optional:!0})],sr.prototype,"other",void 0);class or{constructor(e={}){this.version=Ut.v4,this.kekid=new sr,this.keyEncryptionAlgorithm=new Kt,this.encryptedKey=new o.fi,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer})],or.prototype,"version",void 0),(0,a.__decorate)([(0,o.qw)({type:sr})],or.prototype,"kekid",void 0),(0,a.__decorate)([(0,o.qw)({type:Kt})],or.prototype,"keyEncryptionAlgorithm",void 0),(0,a.__decorate)([(0,o.qw)({type:o.fi})],or.prototype,"encryptedKey",void 0);class ar{constructor(e={}){this.version=Ut.v0,this.keyEncryptionAlgorithm=new Kt,this.encryptedKey=new o.fi,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer})],ar.prototype,"version",void 0),(0,a.__decorate)([(0,o.qw)({type:Ft,context:0,optional:!0})],ar.prototype,"keyDerivationAlgorithm",void 0),(0,a.__decorate)([(0,o.qw)({type:Kt})],ar.prototype,"keyEncryptionAlgorithm",void 0),(0,a.__decorate)([(0,o.qw)({type:o.fi})],ar.prototype,"encryptedKey",void 0);class cr{constructor(e={}){this.oriType="",this.oriValue=new ArrayBuffer(0),Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],cr.prototype,"oriType",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Any})],cr.prototype,"oriValue",void 0);let ur=class{constructor(e={}){Object.assign(this,e)}};var hr;(0,a.__decorate)([(0,o.qw)({type:nr,optional:!0})],ur.prototype,"ktri",void 0),(0,a.__decorate)([(0,o.qw)({type:rr,context:1,implicit:!0,optional:!0})],ur.prototype,"kari",void 0),(0,a.__decorate)([(0,o.qw)({type:or,context:2,implicit:!0,optional:!0})],ur.prototype,"kekri",void 0),(0,a.__decorate)([(0,o.qw)({type:ar,context:3,implicit:!0,optional:!0})],ur.prototype,"pwri",void 0),(0,a.__decorate)([(0,o.qw)({type:cr,context:4,implicit:!0,optional:!0})],ur.prototype,"ori",void 0),ur=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],ur);let dr=hr=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,hr.prototype)}};var lr;dr=hr=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Set,itemType:ur})],dr);class fr{constructor(e={}){this.otherRevInfoFormat="",this.otherRevInfo=new ArrayBuffer(0),Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],fr.prototype,"otherRevInfoFormat",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Any})],fr.prototype,"otherRevInfo",void 0);let pr=class{constructor(e={}){this.other=new fr,Object.assign(this,e)}};(0,a.__decorate)([(0,o.qw)({type:fr,context:1,implicit:!0})],pr.prototype,"other",void 0),pr=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],pr);let yr=lr=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,lr.prototype)}};yr=lr=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Set,itemType:pr})],yr);class mr{constructor(e={}){Object.assign(this,e)}}var gr;(0,a.__decorate)([(0,o.qw)({type:Mt,context:0,implicit:!0,optional:!0})],mr.prototype,"certs",void 0),(0,a.__decorate)([(0,o.qw)({type:yr,context:1,implicit:!0,optional:!0})],mr.prototype,"crls",void 0);let br=gr=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,gr.prototype)}};br=gr=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Set,itemType:it})],br);class vr{constructor(e={}){this.version=Ut.v0,this.recipientInfos=new dr,this.encryptedContentInfo=new $t,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer})],vr.prototype,"version",void 0),(0,a.__decorate)([(0,o.qw)({type:mr,context:0,implicit:!0,optional:!0})],vr.prototype,"originatorInfo",void 0),(0,a.__decorate)([(0,o.qw)({type:dr})],vr.prototype,"recipientInfos",void 0),(0,a.__decorate)([(0,o.qw)({type:$t})],vr.prototype,"encryptedContentInfo",void 0),(0,a.__decorate)([(0,o.qw)({type:br,context:1,implicit:!0,optional:!0})],vr.prototype,"unprotectedAttrs",void 0);const wr="1.2.840.113549.1.7.2";let Sr=class{constructor(e={}){Object.assign(this,e)}};var _r;(0,a.__decorate)([(0,o.qw)({type:De,context:0,implicit:!0})],Sr.prototype,"subjectKeyIdentifier",void 0),(0,a.__decorate)([(0,o.qw)({type:Wt})],Sr.prototype,"issuerAndSerialNumber",void 0),Sr=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],Sr);class Ar{constructor(e={}){this.version=Ut.v0,this.sid=new Sr,this.digestAlgorithm=new jt,this.signatureAlgorithm=new qt,this.signature=new o.fi,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer})],Ar.prototype,"version",void 0),(0,a.__decorate)([(0,o.qw)({type:Sr})],Ar.prototype,"sid",void 0),(0,a.__decorate)([(0,o.qw)({type:jt})],Ar.prototype,"digestAlgorithm",void 0),(0,a.__decorate)([(0,o.qw)({type:it,repeated:"set",context:0,implicit:!0,optional:!0})],Ar.prototype,"signedAttrs",void 0),(0,a.__decorate)([(0,o.qw)({type:qt})],Ar.prototype,"signatureAlgorithm",void 0),(0,a.__decorate)([(0,o.qw)({type:o.fi})],Ar.prototype,"signature",void 0),(0,a.__decorate)([(0,o.qw)({type:it,repeated:"set",context:1,implicit:!0,optional:!0})],Ar.prototype,"unsignedAttrs",void 0);let Er=_r=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,_r.prototype)}};var Cr;Er=_r=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Set,itemType:Ar})],Er);let kr=Cr=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,Cr.prototype)}};kr=Cr=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Set,itemType:jt})],kr);class Tr{constructor(e={}){this.version=Ut.v0,this.digestAlgorithms=new kr,this.encapContentInfo=new Lt,this.signerInfos=new Er,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer})],Tr.prototype,"version",void 0),(0,a.__decorate)([(0,o.qw)({type:kr})],Tr.prototype,"digestAlgorithms",void 0),(0,a.__decorate)([(0,o.qw)({type:Lt})],Tr.prototype,"encapContentInfo",void 0),(0,a.__decorate)([(0,o.qw)({type:Mt,context:0,implicit:!0,optional:!0})],Tr.prototype,"certificates",void 0),(0,a.__decorate)([(0,o.qw)({type:pr,context:1,implicit:!0,optional:!0})],Tr.prototype,"crls",void 0),(0,a.__decorate)([(0,o.qw)({type:Er})],Tr.prototype,"signerInfos",void 0);const Pr="1.2.840.10045.2.1",Ir="1.2.840.10045.4.1",Rr="1.2.840.10045.4.3.1",xr="1.2.840.10045.4.3.2",Br="1.2.840.10045.4.3.3",Or="1.2.840.10045.4.3.4",Mr="1.2.840.10045.3.1.7",Nr="1.3.132.0.34",Dr="1.3.132.0.35";function Lr(e){return new ze({algorithm:e})}const Ur=Lr(Ir),jr=(Lr(Rr),Lr(xr)),qr=Lr(Br),Kr=Lr(Or);let Hr=class{constructor(e={}){Object.assign(this,e)}};(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],Hr.prototype,"namedCurve",void 0),Hr=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],Hr);class zr{constructor(e={}){this.version=1,this.privateKey=new o.fi,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer})],zr.prototype,"version",void 0),(0,a.__decorate)([(0,o.qw)({type:o.fi})],zr.prototype,"privateKey",void 0),(0,a.__decorate)([(0,o.qw)({type:Hr,context:0,optional:!0})],zr.prototype,"parameters",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.BitString,context:1,optional:!0})],zr.prototype,"publicKey",void 0);class Fr{constructor(e={}){this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0),Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,converter:o.te})],Fr.prototype,"r",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,converter:o.te})],Fr.prototype,"s",void 0);const Vr="1.2.840.113549.1.1",$r=`${Vr}.1`,Wr=`${Vr}.7`,Gr=`${Vr}.9`,Jr=`${Vr}.10`,Yr=`${Vr}.2`,Zr=`${Vr}.4`,Xr=`${Vr}.5`,Qr=`${Vr}.14`,ei=`${Vr}.11`,ti=`${Vr}.12`,ri=`${Vr}.13`,ii=`${Vr}.15`,ni=`${Vr}.16`,si="1.3.14.3.2.26",oi="2.16.840.1.101.3.4.2.4",ai="2.16.840.1.101.3.4.2.1",ci="2.16.840.1.101.3.4.2.2",ui="2.16.840.1.101.3.4.2.3",hi=`${Vr}.8`;function di(e){return new ze({algorithm:e,parameters:null})}di("1.2.840.113549.2.2"),di("1.2.840.113549.2.5");const li=di(si),fi=(di(oi),di(ai),di(ci),di(ui),di("2.16.840.1.101.3.4.2.5"),di("2.16.840.1.101.3.4.2.6"),new ze({algorithm:hi,parameters:o.zc.serialize(li)})),pi=new ze({algorithm:Gr,parameters:o.zc.serialize(o.Cz.toASN(new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer))});di($r),di(Yr),di(Zr),di(Xr),di(ii),di(ni),di(ti),di(ri),di(ii),di(ni);class yi{constructor(e={}){this.hashAlgorithm=new ze(li),this.maskGenAlgorithm=new ze({algorithm:hi,parameters:o.zc.serialize(li)}),this.pSourceAlgorithm=new ze(pi),Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:ze,context:0,defaultValue:li})],yi.prototype,"hashAlgorithm",void 0),(0,a.__decorate)([(0,o.qw)({type:ze,context:1,defaultValue:fi})],yi.prototype,"maskGenAlgorithm",void 0),(0,a.__decorate)([(0,o.qw)({type:ze,context:2,defaultValue:pi})],yi.prototype,"pSourceAlgorithm",void 0);new ze({algorithm:Wr,parameters:o.zc.serialize(new yi)});class mi{constructor(e={}){this.hashAlgorithm=new ze(li),this.maskGenAlgorithm=new ze({algorithm:hi,parameters:o.zc.serialize(li)}),this.saltLength=20,this.trailerField=1,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:ze,context:0,defaultValue:li})],mi.prototype,"hashAlgorithm",void 0),(0,a.__decorate)([(0,o.qw)({type:ze,context:1,defaultValue:fi})],mi.prototype,"maskGenAlgorithm",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,context:2,defaultValue:20})],mi.prototype,"saltLength",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,context:3,defaultValue:1})],mi.prototype,"trailerField",void 0);new ze({algorithm:Jr,parameters:o.zc.serialize(new mi)});class gi{constructor(e={}){this.digestAlgorithm=new ze,this.digest=new o.fi,Object.assign(this,e)}}var bi;(0,a.__decorate)([(0,o.qw)({type:ze})],gi.prototype,"digestAlgorithm",void 0),(0,a.__decorate)([(0,o.qw)({type:o.fi})],gi.prototype,"digest",void 0);class vi{constructor(e={}){this.prime=new ArrayBuffer(0),this.exponent=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,converter:o.te})],vi.prototype,"prime",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,converter:o.te})],vi.prototype,"exponent",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,converter:o.te})],vi.prototype,"coefficient",void 0);let wi=bi=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,bi.prototype)}};wi=bi=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence,itemType:vi})],wi);class Si{constructor(e={}){this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer})],Si.prototype,"version",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,converter:o.te})],Si.prototype,"modulus",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,converter:o.te})],Si.prototype,"publicExponent",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,converter:o.te})],Si.prototype,"privateExponent",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,converter:o.te})],Si.prototype,"prime1",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,converter:o.te})],Si.prototype,"prime2",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,converter:o.te})],Si.prototype,"exponent1",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,converter:o.te})],Si.prototype,"exponent2",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,converter:o.te})],Si.prototype,"coefficient",void 0),(0,a.__decorate)([(0,o.qw)({type:wi,optional:!0})],Si.prototype,"otherPrimeInfos",void 0);class _i{constructor(e={}){this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),Object.assign(this,e)}}var Ai;(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,converter:o.te})],_i.prototype,"modulus",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,converter:o.te})],_i.prototype,"publicExponent",void 0),function(e){e[e.Transient=0]="Transient",e[e.Singleton=1]="Singleton",e[e.ResolutionScoped=2]="ResolutionScoped",e[e.ContainerScoped=3]="ContainerScoped"}(Ai||(Ai={}));const Ei=Ai;var Ci=function(e,t){return Ci=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},Ci(e,t)};function ki(e,t){function r(){this.constructor=e}Ci(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function Ti(e,t,r,i){return new(r||(r=Promise))((function(n,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))}function Pi(e,t){var r,i,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&s[0]?i.return:s[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,s[1])).done)return n;switch(i=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{r=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}function Ii(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ri(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,s=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return o}function xi(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Ri(arguments[t]));return e}function Bi(e){return!!e.useClass}function Oi(e){return!!e.useFactory}var Mi=function(){function e(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return e.prototype.createProxy=function(e){var t,r=this,i=!1;return new Proxy({},this.createHandler((function(){return i||(t=e(r.wrap()),i=!0),t})))},e.prototype.createHandler=function(e){var t={};return this.reflectMethods.forEach((function(r){t[r]=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];t[0]=e();var n=Reflect[r];return n.apply(void 0,xi(t))}})),t},e}();function Ni(e){return"string"==typeof e||"symbol"==typeof e}function Di(e){return"object"==typeof e&&"token"in e&&"transform"in e}function Li(e){return!!e.useToken}function Ui(e){return null!=e.useValue}const ji=function(){function e(){this._registryMap=new Map}return e.prototype.entries=function(){return this._registryMap.entries()},e.prototype.getAll=function(e){return this.ensure(e),this._registryMap.get(e)},e.prototype.get=function(e){this.ensure(e);var t=this._registryMap.get(e);return t[t.length-1]||null},e.prototype.set=function(e,t){this.ensure(e),this._registryMap.get(e).push(t)},e.prototype.setAll=function(e,t){this._registryMap.set(e,t)},e.prototype.has=function(e){return this.ensure(e),this._registryMap.get(e).length>0},e.prototype.clear=function(){this._registryMap.clear()},e.prototype.ensure=function(e){this._registryMap.has(e)||this._registryMap.set(e,[])},e}();const qi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ki(t,e),t}(ji);const Ki=function(){this.scopedResolutions=new Map};function Hi(e,t,r){var i,n,s=Ri(e.toString().match(/constructor\(([\w, ]+)\)/)||[],2)[1],o=function(e,t){return null===e?"at position #"+t:'"'+e.split(",")[t].trim()+'" at position #'+t}(void 0===s?null:s,t);return i="Cannot inject the dependency "+o+' of "'+e.name+'" constructor. Reason:',void 0===n&&(n="    "),xi([i],r.message.split("\n").map((function(e){return n+e}))).join("\n")}var zi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ki(t,e),t}(ji),Fi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ki(t,e),t}(ji);const Vi=function(){this.preResolution=new zi,this.postResolution=new Fi};var $i=new Map,Wi=function(){function e(e){this.parent=e,this._registry=new qi,this.interceptors=new Vi,this.disposed=!1,this.disposables=new Set}return e.prototype.register=function(e,t,r){var i;if(void 0===r&&(r={lifecycle:Ei.Transient}),this.ensureNotDisposed(),i=function(e){return Bi(e)||Ui(e)||Li(e)||Oi(e)}(t)?t:{useClass:t},Li(i))for(var n=[e],s=i;null!=s;){var o=s.useToken;if(n.includes(o))throw new Error("Token registration cycle detected! "+xi(n,[o]).join(" -> "));n.push(o);var a=this._registry.get(o);s=a&&Li(a.provider)?a.provider:null}if((r.lifecycle===Ei.Singleton||r.lifecycle==Ei.ContainerScoped||r.lifecycle==Ei.ResolutionScoped)&&(Ui(i)||Oi(i)))throw new Error('Cannot use lifecycle "'+Ei[r.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(e,{provider:i,options:r}),this},e.prototype.registerType=function(e,t){return this.ensureNotDisposed(),Ni(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})},e.prototype.registerInstance=function(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})},e.prototype.registerSingleton=function(e,t){if(this.ensureNotDisposed(),Ni(e)){if(Ni(t))return this.register(e,{useToken:t},{lifecycle:Ei.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:Ei.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}var r=e;return t&&!Ni(t)&&(r=t),this.register(e,{useClass:r},{lifecycle:Ei.Singleton})},e.prototype.resolve=function(e,t){void 0===t&&(t=new Ki),this.ensureNotDisposed();var r=this.getRegistration(e);if(!r&&Ni(e))throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"');if(this.executePreResolutionInterceptor(e,"Single"),r){var i=this.resolveRegistration(r,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}if(function(e){return"function"==typeof e||e instanceof Mi}(e)){i=this.construct(e,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},e.prototype.executePreResolutionInterceptor=function(e,t){var r,i;if(this.interceptors.preResolution.has(e)){var n=[];try{for(var s=Ii(this.interceptors.preResolution.getAll(e)),o=s.next();!o.done;o=s.next()){var a=o.value;"Once"!=a.options.frequency&&n.push(a),a.callback(e,t)}}catch(e){r={error:e}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}this.interceptors.preResolution.setAll(e,n)}},e.prototype.executePostResolutionInterceptor=function(e,t,r){var i,n;if(this.interceptors.postResolution.has(e)){var s=[];try{for(var o=Ii(this.interceptors.postResolution.getAll(e)),a=o.next();!a.done;a=o.next()){var c=a.value;"Once"!=c.options.frequency&&s.push(c),c.callback(e,t,r)}}catch(e){i={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}this.interceptors.postResolution.setAll(e,s)}},e.prototype.resolveRegistration=function(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===Ei.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);var r,i=e.options.lifecycle===Ei.Singleton,n=e.options.lifecycle===Ei.ContainerScoped,s=i||n;return r=Ui(e.provider)?e.provider.useValue:Li(e.provider)?s?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):Bi(e.provider)?s?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):Oi(e.provider)?e.provider.useFactory(this):this.construct(e.provider,t),e.options.lifecycle===Ei.ResolutionScoped&&t.scopedResolutions.set(e,r),r},e.prototype.resolveAll=function(e,t){var r=this;void 0===t&&(t=new Ki),this.ensureNotDisposed();var i=this.getAllRegistrations(e);if(!i&&Ni(e))throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"');if(this.executePreResolutionInterceptor(e,"All"),i){var n=i.map((function(e){return r.resolveRegistration(e,t)}));return this.executePostResolutionInterceptor(e,n,"All"),n}var s=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,s,"All"),s},e.prototype.isRegistered=function(e,t){return void 0===t&&(t=!1),this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)},e.prototype.reset=function(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},e.prototype.clearInstances=function(){var e,t;this.ensureNotDisposed();try{for(var r=Ii(this._registry.entries()),i=r.next();!i.done;i=r.next()){var n=Ri(i.value,2),s=n[0],o=n[1];this._registry.setAll(s,o.filter((function(e){return!Ui(e.provider)})).map((function(e){return e.instance=void 0,e})))}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e.prototype.createChildContainer=function(){var t,r;this.ensureNotDisposed();var i=new e(this);try{for(var n=Ii(this._registry.entries()),s=n.next();!s.done;s=n.next()){var o=Ri(s.value,2),a=o[0],c=o[1];c.some((function(e){return e.options.lifecycle===Ei.ContainerScoped}))&&i._registry.setAll(a,c.map((function(e){return e.options.lifecycle===Ei.ContainerScoped?{provider:e.provider,options:e.options}:e})))}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return i},e.prototype.beforeResolution=function(e,t,r){void 0===r&&(r={frequency:"Always"}),this.interceptors.preResolution.set(e,{callback:t,options:r})},e.prototype.afterResolution=function(e,t,r){void 0===r&&(r={frequency:"Always"}),this.interceptors.postResolution.set(e,{callback:t,options:r})},e.prototype.dispose=function(){return Ti(this,void 0,void 0,(function(){var e;return Pi(this,(function(t){switch(t.label){case 0:return this.disposed=!0,e=[],this.disposables.forEach((function(t){var r=t.dispose();r&&e.push(r)})),[4,Promise.all(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.getRegistration=function(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null},e.prototype.getAllRegistrations=function(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null},e.prototype.construct=function(e,t){var r=this;if(e instanceof Mi)return e.createProxy((function(e){return r.resolve(e,t)}));var i,n=function(){var i=$i.get(e);if(!i||0===i.length){if(0===e.length)return new e;throw new Error('TypeInfo not known for "'+e.name+'"')}var n=i.map(r.resolveParams(t,e));return new(e.bind.apply(e,xi([void 0],n)))}();return"function"!=typeof(i=n).dispose||i.dispose.length>0||this.disposables.add(n),n},e.prototype.resolveParams=function(e,t){var r=this;return function(i,n){var s,o,a,c;try{return"object"==typeof(c=i)&&"token"in c&&"multiple"in c?Di(i)?i.multiple?(s=r.resolve(i.transform)).transform.apply(s,xi([r.resolveAll(i.token)],i.transformArgs)):(o=r.resolve(i.transform)).transform.apply(o,xi([r.resolve(i.token,e)],i.transformArgs)):i.multiple?r.resolveAll(i.token):r.resolve(i.token,e):Di(i)?(a=r.resolve(i.transform,e)).transform.apply(a,xi([r.resolve(i.token,e)],i.transformArgs)):r.resolve(i,e)}catch(e){throw new Error(Hi(t,n,e))}}},e.prototype.ensureNotDisposed=function(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")},e}(),Gi=new Wi;var Ji="injectionTokens";const Yi=function(){return function(e){$i.set(e,function(e){var t=Reflect.getMetadata("design:paramtypes",e)||[],r=Reflect.getOwnMetadata(Ji,e)||{};return Object.keys(r).forEach((function(e){t[+e]=r[e]})),t}(e))}};if("undefined"==typeof Reflect||!Reflect.getMetadata)throw new Error("tsyringe requires a reflect polyfill. Please add 'import \"reflect-metadata\"' to the top of your entry point.");var Zi;class Xi{constructor(e={}){this.attrId="",this.attrValues=[],Object.assign(e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],Xi.prototype,"attrId",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Any,repeated:"set"})],Xi.prototype,"attrValues",void 0);let Qi=Zi=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,Zi.prototype)}};var en;Qi=Zi=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence,itemType:Xi})],Qi);let tn=en=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,en.prototype)}};tn=en=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence,itemType:Nt})],tn);class rn{constructor(e={}){this.certId="",this.certValue=new ArrayBuffer(0),Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],rn.prototype,"certId",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Any,context:0})],rn.prototype,"certValue",void 0);class nn{constructor(e={}){this.crlId="",this.crltValue=new ArrayBuffer(0),Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],nn.prototype,"crlId",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Any,context:0})],nn.prototype,"crltValue",void 0);class sn extends o.fi{}class on{constructor(e={}){this.encryptionAlgorithm=new ze,this.encryptedData=new sn,Object.assign(this,e)}}var an,cn;(0,a.__decorate)([(0,o.qw)({type:ze})],on.prototype,"encryptionAlgorithm",void 0),(0,a.__decorate)([(0,o.qw)({type:sn})],on.prototype,"encryptedData",void 0),function(e){e[e.v1=0]="v1"}(cn||(cn={}));class un extends o.fi{}let hn=an=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,an.prototype)}};hn=an=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence,itemType:Be})],hn);class dn{constructor(e={}){this.version=cn.v1,this.privateKeyAlgorithm=new ze,this.privateKey=new un,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer})],dn.prototype,"version",void 0),(0,a.__decorate)([(0,o.qw)({type:ze})],dn.prototype,"privateKeyAlgorithm",void 0),(0,a.__decorate)([(0,o.qw)({type:un})],dn.prototype,"privateKey",void 0),(0,a.__decorate)([(0,o.qw)({type:hn,implicit:!0,context:0,optional:!0})],dn.prototype,"attributes",void 0);let ln=class extends dn{};ln=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence})],ln);let fn=class extends on{};fn=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence})],fn);class pn{constructor(e={}){this.secretTypeId="",this.secretValue=new ArrayBuffer(0),Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],pn.prototype,"secretTypeId",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Any,context:0})],pn.prototype,"secretValue",void 0);class yn{constructor(e={}){this.mac=new gi,this.macSalt=new o.fi,this.iterations=1,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:gi})],yn.prototype,"mac",void 0),(0,a.__decorate)([(0,o.qw)({type:o.fi})],yn.prototype,"macSalt",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer,defaultValue:1})],yn.prototype,"iterations",void 0);class mn{constructor(e={}){this.version=3,this.authSafe=new Nt,this.macData=new yn,Object.assign(this,e)}}var gn;(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer})],mn.prototype,"version",void 0),(0,a.__decorate)([(0,o.qw)({type:Nt})],mn.prototype,"authSafe",void 0),(0,a.__decorate)([(0,o.qw)({type:yn,optional:!0})],mn.prototype,"macData",void 0);class bn{constructor(e={}){this.bagId="",this.bagValue=new ArrayBuffer(0),Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],bn.prototype,"bagId",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.Any,context:0})],bn.prototype,"bagValue",void 0),(0,a.__decorate)([(0,o.qw)({type:Xi,repeated:"set",optional:!0})],bn.prototype,"bagAttributes",void 0);let vn=gn=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,gn.prototype)}};var wn,Sn,_n;vn=gn=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence,itemType:bn})],vn);const An="1.2.840.113549.1.9",En=`${An}.7`,Cn=`${An}.14`;let kn=class extends d{constructor(e={}){super(e)}toString(){return{}.toString(),this.ia5String||super.toString()}};(0,a.__decorate)([(0,o.qw)({type:o.gZ.IA5String})],kn.prototype,"ia5String",void 0),kn=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],kn);let Tn=class extends Nt{};Tn=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence})],Tn);let Pn=class extends mn{};Pn=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence})],Pn);let In=class extends on{};In=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence})],In);let Rn=class{constructor(e=""){this.value=e}toString(){return this.value}};(0,a.__decorate)([(0,o.qw)({type:o.gZ.IA5String})],Rn.prototype,"value",void 0),Rn=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],Rn);let xn=class extends kn{};xn=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],xn);let Bn=class extends d{};Bn=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],Bn);let On=class{constructor(e=new Date){this.value=e}};(0,a.__decorate)([(0,o.qw)({type:o.gZ.GeneralizedTime})],On.prototype,"value",void 0),On=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],On);let Mn=class extends d{};Mn=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],Mn);let Nn=class{constructor(e="M"){this.value=e}toString(){return this.value}};(0,a.__decorate)([(0,o.qw)({type:o.gZ.PrintableString})],Nn.prototype,"value",void 0),Nn=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],Nn);let Dn=class{constructor(e=""){this.value=e}toString(){return this.value}};(0,a.__decorate)([(0,o.qw)({type:o.gZ.PrintableString})],Dn.prototype,"value",void 0),Dn=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],Dn);let Ln=class extends Dn{};Ln=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],Ln);let Un=class extends d{};Un=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],Un);let jn=class{constructor(e=""){this.value=e}toString(){return this.value}};(0,a.__decorate)([(0,o.qw)({type:o.gZ.ObjectIdentifier})],jn.prototype,"value",void 0),jn=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],jn);let qn=class extends Ve{};qn=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],qn);let Kn=class{constructor(e=0){this.value=e}toString(){return this.value.toString()}};(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer})],Kn.prototype,"value",void 0),Kn=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],Kn);let Hn=class extends Ar{};Hn=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence})],Hn);let zn=class extends d{};zn=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],zn);let Fn=wn=class extends Je{constructor(e){super(e),Object.setPrototypeOf(this,wn.prototype)}};Fn=wn=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence})],Fn);let Vn=Sn=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,Sn.prototype)}};Vn=Sn=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Set,itemType:it})],Vn);let $n=class{constructor(e=""){this.value=e}toString(){return this.value}};(0,a.__decorate)([(0,o.qw)({type:o.gZ.BmpString})],$n.prototype,"value",void 0),$n=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Choice})],$n);let Wn=class extends ze{};Wn=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence})],Wn);let Gn=_n=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,_n.prototype)}};var Jn;Gn=_n=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence,itemType:Wn})],Gn);let Yn=Jn=class extends o.YQ{constructor(e){super(e),Object.setPrototypeOf(this,Jn.prototype)}};Yn=Jn=(0,a.__decorate)([(0,o.Ve)({type:o.cN.Sequence,itemType:Be})],Yn);class Zn{constructor(e={}){this.version=0,this.subject=new m,this.subjectPKInfo=new Fe,this.attributes=new Yn,Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:o.gZ.Integer})],Zn.prototype,"version",void 0),(0,a.__decorate)([(0,o.qw)({type:m})],Zn.prototype,"subject",void 0),(0,a.__decorate)([(0,o.qw)({type:Fe})],Zn.prototype,"subjectPKInfo",void 0),(0,a.__decorate)([(0,o.qw)({type:Yn,implicit:!0,context:0})],Zn.prototype,"attributes",void 0);class Xn{constructor(e={}){this.certificationRequestInfo=new Zn,this.signatureAlgorithm=new ze,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}(0,a.__decorate)([(0,o.qw)({type:Zn})],Xn.prototype,"certificationRequestInfo",void 0),(0,a.__decorate)([(0,o.qw)({type:ze})],Xn.prototype,"signatureAlgorithm",void 0),(0,a.__decorate)([(0,o.qw)({type:o.gZ.BitString})],Xn.prototype,"signature",void 0);const Qn="crypto.algorithm";class es{getAlgorithms(){return Gi.resolveAll(Qn)}toAsnAlgorithm(e){for(const t of this.getAlgorithms()){const r=t.toAsnAlgorithm(e);if(r)return r}if(/[0-9.]+/.test(e.name)){const t=new ze({algorithm:e.name});if("parameters"in e){const r=e;t.parameters=r.parameters}return t}throw new Error("Cannot convert WebCrypto algorithm to ASN.1 algorithm")}toWebAlgorithm(e){for(const t of this.getAlgorithms()){const r=t.toWebAlgorithm(e);if(r)return r}return{name:e.algorithm,parameters:e.parameters}}}const ts="crypto.algorithmProvider";var rs;Gi.registerSingleton(ts,es);const is="1.3.36.3.3.2.8.1.1",ns=`${is}.1`,ss=`${is}.2`,os=`${is}.3`,as=`${is}.4`,cs=`${is}.5`,us=`${is}.6`,hs=`${is}.7`,ds=`${is}.8`,ls=`${is}.9`,fs=`${is}.10`,ps=`${is}.11`,ys=`${is}.12`,ms=`${is}.13`,gs=`${is}.14`,bs="brainpoolP160r1",vs="brainpoolP160t1",ws="brainpoolP192r1",Ss="brainpoolP192t1",_s="brainpoolP224r1",As="brainpoolP224t1",Es="brainpoolP256r1",Cs="brainpoolP256t1",ks="brainpoolP320r1",Ts="brainpoolP320t1",Ps="brainpoolP384r1",Is="brainpoolP384t1",Rs="brainpoolP512r1",xs="brainpoolP512t1",Bs="ECDSA";let Os=rs=class{toAsnAlgorithm(e){if(e.name.toLowerCase()===Bs.toLowerCase())if("hash"in e){switch(("string"==typeof e.hash?e.hash:e.hash.name).toLowerCase()){case"sha-1":return Ur;case"sha-256":return jr;case"sha-384":return qr;case"sha-512":return Kr}}else if("namedCurve"in e){let t="";switch(e.namedCurve){case"P-256":t=Mr;break;case"K-256":t=rs.SECP256K1;break;case"P-384":t=Nr;break;case"P-521":t=Dr;break;case bs:t=ns;break;case vs:t=ss;break;case ws:t=os;break;case Ss:t=as;break;case _s:t=cs;break;case As:t=us;break;case Es:t=hs;break;case Cs:t=ds;break;case ks:t=ls;break;case Ts:t=fs;break;case Ps:t=ps;break;case Is:t=ys;break;case Rs:t=ms;break;case xs:t=gs}if(t)return new ze({algorithm:Pr,parameters:o.zc.serialize(new Hr({namedCurve:t}))})}return null}toWebAlgorithm(e){switch(e.algorithm){case Ir:return{name:Bs,hash:{name:"SHA-1"}};case xr:return{name:Bs,hash:{name:"SHA-256"}};case Br:return{name:Bs,hash:{name:"SHA-384"}};case Or:return{name:Bs,hash:{name:"SHA-512"}};case Pr:if(!e.parameters)throw new TypeError("Cannot get required parameters from EC algorithm");switch(o.zc.parse(e.parameters,Hr).namedCurve){case Mr:return{name:Bs,namedCurve:"P-256"};case rs.SECP256K1:return{name:Bs,namedCurve:"K-256"};case Nr:return{name:Bs,namedCurve:"P-384"};case Dr:return{name:Bs,namedCurve:"P-521"};case ns:return{name:Bs,namedCurve:bs};case ss:return{name:Bs,namedCurve:vs};case os:return{name:Bs,namedCurve:ws};case as:return{name:Bs,namedCurve:Ss};case cs:return{name:Bs,namedCurve:_s};case us:return{name:Bs,namedCurve:As};case hs:return{name:Bs,namedCurve:Es};case ds:return{name:Bs,namedCurve:Cs};case ls:return{name:Bs,namedCurve:ks};case fs:return{name:Bs,namedCurve:Ts};case ps:return{name:Bs,namedCurve:Ps};case ys:return{name:Bs,namedCurve:Is};case ms:return{name:Bs,namedCurve:Rs};case gs:return{name:Bs,namedCurve:xs}}}return null}};Os.SECP256K1="1.3.132.0.10",Os=rs=(0,a.__decorate)([Yi()],Os),Gi.registerSingleton(Qn,Os);const Ms=Symbol("name"),Ns=Symbol("value");class Ds{constructor(e,t={},r=""){this[Ms]=e,this[Ns]=r;for(const e in t)this[e]=t[e]}}Ds.NAME=Ms,Ds.VALUE=Ns;class Ls{static toTextObject(e){const t=new Ds("Algorithm Identifier",{},Us.toString(e.algorithm));if(e.parameters)switch(e.algorithm){case Pr:{const r=(new Os).toWebAlgorithm(e);r&&"namedCurve"in r?t["Named Curve"]=r.namedCurve:t.Parameters=e.parameters;break}default:t.Parameters=e.parameters}return t}}class Us{static toString(e){const t=this.items[e];return t||e}}Us.items={[si]:"sha1",[oi]:"sha224",[ai]:"sha256",[ci]:"sha384",[ui]:"sha512",[$r]:"rsaEncryption",[Xr]:"sha1WithRSAEncryption",[Qr]:"sha224WithRSAEncryption",[ei]:"sha256WithRSAEncryption",[ti]:"sha384WithRSAEncryption",[ri]:"sha512WithRSAEncryption",[Pr]:"ecPublicKey",[Ir]:"ecdsaWithSHA1",[Rr]:"ecdsaWithSHA224",[xr]:"ecdsaWithSHA256",[Br]:"ecdsaWithSHA384",[Or]:"ecdsaWithSHA512",[ae]:"TLS WWW server authentication",[ce]:"TLS WWW client authentication",[ue]:"Code Signing",[he]:"E-mail Protection",[de]:"Time Stamping",[le]:"OCSP Signing",[wr]:"Signed Data"};class js{static serialize(e){return this.serializeObj(e).join("\n")}static pad(e=0){return"".padStart(2*e," ")}static serializeObj(e,t=0){const r=[];let i=this.pad(t++),n="";const s=e[Ds.VALUE];s&&(n=` ${s}`),r.push(`${i}${e[Ds.NAME]}:${n}`),i=this.pad(t);for(const n in e){if("symbol"==typeof n)continue;const s=e[n],o=n?`${n}: `:"";if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)r.push(`${i}${o}${s}`);else if(s instanceof Date)r.push(`${i}${o}${s.toUTCString()}`);else if(Array.isArray(s))for(const e of s)e[Ds.NAME]=n,r.push(...this.serializeObj(e,t));else if(s instanceof Ds)s[Ds.NAME]=n,r.push(...this.serializeObj(s,t));else if(u.vJ.isBufferSource(s))n?(r.push(`${i}${o}`),r.push(...this.serializeBufferSource(s,t+1))):r.push(...this.serializeBufferSource(s,t));else{if(!("toTextObject"in s))throw new TypeError("Cannot serialize data in text format. Unsupported type.");{const e=s.toTextObject();e[Ds.NAME]=n,r.push(...this.serializeObj(e,t))}}}return r}static serializeBufferSource(e,t=0){const r=this.pad(t),i=u.vJ.toUint8Array(e),n=[];for(let e=0;e<i.length;){const t=[];for(let r=0;r<16&&e<i.length;r++){8===r&&t.push("");const n=i[e++].toString(16).padStart(2,"0");t.push(n)}n.push(`${r}${t.join(" ")}`)}return n}static serializeAlgorithm(e){return this.algorithmSerializer.toTextObject(e)}}js.oidSerializer=Us,js.algorithmSerializer=Ls;class qs{constructor(...e){if(1===e.length){const t=e[0];this.rawData=o.zc.serialize(t),this.onInit(t)}else{const t=o.zc.parse(e[0],e[1]);this.rawData=u.vJ.toArrayBuffer(e[0]),this.onInit(t)}}equal(e){return e instanceof qs&&(0,u.Xy)(e.rawData,this.rawData)}toString(e="text"){switch(e){case"asn":return o.zc.toString(this.rawData);case"text":return js.serialize(this.toTextObject());case"hex":return u.ep.ToHex(this.rawData);case"base64":return u.ep.ToBase64(this.rawData);case"base64url":return u.ep.ToBase64Url(this.rawData);default:throw TypeError("Argument 'format' is unsupported value")}}getTextName(){return this.constructor.NAME}toTextObject(){const e=this.toTextObjectEmpty();return e[""]=this.rawData,e}toTextObjectEmpty(e){return new Ds(this.getTextName(),{},e)}}qs.NAME="ASN";class Ks extends qs{constructor(...e){let t;t=u.vJ.isBufferSource(e[0])?u.vJ.toArrayBuffer(e[0]):o.zc.serialize(new Ge({extnID:e[0],critical:e[1],extnValue:new o.fi(u.vJ.toArrayBuffer(e[2]))})),super(t,Ge)}onInit(e){this.type=e.extnID,this.critical=e.critical,this.value=e.extnValue.buffer}toTextObject(){const e=this.toTextObjectWithoutValue();return e[""]=this.value,e}toTextObjectWithoutValue(){const e=this.toTextObjectEmpty(this.critical?"critical":void 0);return e[Ds.NAME]===Ks.NAME&&(e[Ds.NAME]=Us.toString(this.type)),e}}var Hs;class zs{constructor(){this.items=new Map,this[Hs]="CryptoProvider","undefined"!=typeof self&&"undefined"!=typeof crypto&&this.set(zs.DEFAULT,crypto)}static isCryptoKeyPair(e){return e&&e.privateKey&&e.publicKey}static isCryptoKey(e){return e&&e.usages&&e.type&&e.algorithm&&void 0!==e.extractable}clear(){this.items.clear()}delete(e){return this.items.delete(e)}forEach(e,t){return this.items.forEach(e,t)}has(e){return this.items.has(e)}get size(){return this.items.size}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}[Symbol.iterator](){return this.items[Symbol.iterator]()}get(e=zs.DEFAULT){const t=this.items.get(e.toLowerCase());if(!t)throw new Error(`Cannot get Crypto by name '${e}'`);return t}set(e,t){if("string"==typeof e){if(!t)throw new TypeError("Argument 'value' is required");this.items.set(e.toLowerCase(),t)}else this.items.set(zs.DEFAULT,e);return this}}Hs=Symbol.toStringTag,zs.DEFAULT="default";const Fs=new zs,Vs=/^[0-2](?:\.[1-9][0-9]*)+$/;class $s{constructor(e={}){this.items={};for(const t in e)this.register(t,e[t])}get(e){return this.items[e]||null}findId(e){return t=e,new RegExp(Vs).test(t)?e:this.get(e);var t}register(e,t){this.items[e]=t,this.items[t]=e}}const Ws=new $s;function Gs(e,t){return`\\${u.ep.ToHex(u.ep.FromUtf8String(t)).toUpperCase()}`}Ws.register("CN","2.5.4.3"),Ws.register("L","2.5.4.7"),Ws.register("ST","2.5.4.8"),Ws.register("O","2.5.4.10"),Ws.register("OU","2.5.4.11"),Ws.register("C","2.5.4.6"),Ws.register("DC","0.9.2342.19200300.100.1.25"),Ws.register("E","1.2.840.113549.1.9.1"),Ws.register("G","2.5.4.42"),Ws.register("I","2.5.4.43"),Ws.register("SN","2.5.4.4"),Ws.register("T","2.5.4.12");class Js{constructor(e,t={}){this.extraNames=new $s,this.asn=new m;for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){const r=t[e];this.extraNames.register(e,r)}"string"==typeof e?this.asn=this.fromString(e):e instanceof m?this.asn=e:u.vJ.isBufferSource(e)?this.asn=o.zc.parse(e,m):this.asn=this.fromJSON(e)}static isASCII(e){for(let t=0;t<e.length;t++){if(e.charCodeAt(t)>255)return!1}return!0}getField(e){const t=this.extraNames.findId(e)||Ws.findId(e),r=[];for(const e of this.asn)for(const i of e)i.type===t&&r.push(i.value.toString());return r}getName(e){return this.extraNames.get(e)||Ws.get(e)}toString(){return this.asn.map((e=>e.map((e=>`${this.getName(e.type)||e.type}=${e.value.anyValue?`#${u.ep.ToHex(e.value.anyValue)}`:e.value.toString().replace(/([,+"\\<>;])/g,"\\$1").replace(/^([ #])/,"\\$1").replace(/([ ]$)/,"\\$1").replace(/([\r\n\t])/,Gs)}`)).join("+"))).join(", ")}toJSON(){var e;const t=[];for(const r of this.asn){const i={};for(const t of r){const r=this.getName(t.type)||t.type;null!==(e=i[r])&&void 0!==e||(i[r]=[]),i[r].push(t.value.anyValue?`#${u.ep.ToHex(t.value.anyValue)}`:t.value.toString())}t.push(i)}return t}fromString(e){const t=new m,r=/(\d\.[\d.]*\d|[A-Za-z]+)=((?:"")|(?:".*?[^\\]")|(?:[^,+].*?(?:[^\\][,+]))|(?:))([,+])?/g;let i=null,n=",";for(;i=r.exec(`${e},`);){let[,e,r]=i;const s=r[r.length-1];","!==s&&"+"!==s||(r=r.slice(0,r.length-1),i[3]=s);const o=i[3];if(/[\d.]+/.test(e)||(e=this.getName(e)||""),!e)throw new Error(`Cannot get OID for name type '${e}'`);const a=new f({type:e});if("#"===r.charAt(0))a.value.anyValue=u.ep.FromHex(r.slice(1));else{const t=/"(.*?[^\\])?"/.exec(r);t&&(r=t[1]),r=r.replace(/\\0a/gi,"\n").replace(/\\0d/gi,"\r").replace(/\\0g/gi,"\t").replace(/\\(.)/g,"$1"),e===this.getName("E")||e===this.getName("DC")?a.value.ia5String=r:Js.isASCII(r)?a.value.printableString=r:a.value.utf8String=r}"+"===n?t[t.length-1].push(a):t.push(new p([a])),n=o}return t}fromJSON(e){const t=new m;for(const r of e){const e=new p;for(const t in r){let i=t;if(/[\d.]+/.test(t)||(i=this.getName(t)||""),!i)throw new Error(`Cannot get OID for name type '${t}'`);const n=r[t];for(const t of n){const r=new f({type:i});if("object"==typeof t)for(const e in t)switch(e){case"ia5String":r.value.ia5String=t[e];break;case"utf8String":r.value.utf8String=t[e];break;case"universalString":r.value.universalString=t[e];break;case"bmpString":r.value.bmpString=t[e];break;case"printableString":r.value.printableString=t[e]}else"#"===t[0]?r.value.anyValue=u.ep.FromHex(t.slice(1)):i===this.getName("E")||i===this.getName("DC")?r.value.ia5String=t:r.value.printableString=t;e.push(r)}}t.push(e)}return t}toArrayBuffer(){return o.zc.serialize(this.asn)}async getThumbprint(...e){var t;let r,i="SHA-1";return e.length>=1&&!(null===(t=e[0])||void 0===t?void 0:t.subtle)?(i=e[0]||i,r=e[1]||Fs.get()):r=e[0]||Fs.get(),await r.subtle.digest(i,this.toArrayBuffer())}}const Ys="Cannot initialize GeneralName from ASN.1 data.",Zs=`${Ys} Unsupported string format in use.`,Xs=`${Ys} Value doesn't match to GUID regular expression.`,Qs=/^([0-9a-f]{8})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{12})$/i,eo="1.3.6.1.4.1.311.25.1",to="1.3.6.1.4.1.311.20.2.3",ro="dns",io="dn",no="email",so="ip",oo="url",ao="guid",co="upn",uo="id";class ho extends qs{constructor(...e){let t;if(2===e.length)switch(e[0]){case io:{const r=new Js(e[1]).toArrayBuffer(),i=o.zc.parse(r,m);t=new w({directoryName:i});break}case ro:t=new w({dNSName:e[1]});break;case no:t=new w({rfc822Name:e[1]});break;case ao:{const r=new RegExp(Qs,"i").exec(e[1]);if(!r)throw new Error("Cannot parse GUID value. Value doesn't match to regular expression");const i=r.slice(1).map(((e,t)=>t<3?u.ep.ToHex(new Uint8Array(u.ep.FromHex(e)).reverse()):e)).join("");t=new w({otherName:new b({typeId:eo,value:o.zc.serialize(new o.fi(u.ep.FromHex(i)))})});break}case so:t=new w({iPAddress:e[1]});break;case uo:t=new w({registeredID:e[1]});break;case co:t=new w({otherName:new b({typeId:to,value:o.zc.serialize(o.VU.toASN(e[1]))})});break;case oo:t=new w({uniformResourceIdentifier:e[1]});break;default:throw new Error("Cannot create GeneralName. Unsupported type of the name")}else t=u.vJ.isBufferSource(e[0])?o.zc.parse(e[0],w):e[0];super(t)}onInit(e){if(null!=e.dNSName)this.type=ro,this.value=e.dNSName;else if(null!=e.rfc822Name)this.type=no,this.value=e.rfc822Name;else if(null!=e.iPAddress)this.type=so,this.value=e.iPAddress;else if(null!=e.uniformResourceIdentifier)this.type=oo,this.value=e.uniformResourceIdentifier;else if(null!=e.registeredID)this.type=uo,this.value=e.registeredID;else if(null!=e.directoryName)this.type=io,this.value=new Js(e.directoryName).toString();else{if(null==e.otherName)throw new Error(Zs);if(e.otherName.typeId===eo){this.type=ao;const t=o.zc.parse(e.otherName.value,o.fi),r=new RegExp(Qs,"i").exec(u.ep.ToHex(t));if(!r)throw new Error(Xs);this.value=r.slice(1).map(((e,t)=>t<3?u.ep.ToHex(new Uint8Array(u.ep.FromHex(e)).reverse()):e)).join("-")}else{if(e.otherName.typeId!==to)throw new Error(Zs);this.type=co,this.value=o.zc.parse(e.otherName.value,d).toString()}}}toJSON(){return{type:this.type,value:this.value}}toTextObject(){let e;switch(this.type){case io:case ro:case ao:case so:case uo:case co:case oo:e=this.type.toUpperCase();break;case no:e="Email";break;default:throw new Error("Unsupported GeneralName type")}let t=this.value;return this.type===uo&&(t=Us.toString(t)),new Ds(e,void 0,t)}}class lo extends qs{constructor(e){let t;if(e instanceof B)t=e;else if(Array.isArray(e)){const r=[];for(const t of e)if(t instanceof w)r.push(t);else{const e=o.zc.parse(new ho(t.type,t.value).rawData,w);r.push(e)}t=new B(r)}else{if(!u.vJ.isBufferSource(e))throw new Error("Cannot initialize GeneralNames. Incorrect incoming arguments");t=o.zc.parse(e,B)}super(t)}onInit(e){const t=[];for(const r of e){let e=null;try{e=new ho(r)}catch{continue}t.push(e)}this.items=t}toJSON(){return this.items.map((e=>e.toJSON()))}toTextObject(){const e=super.toTextObjectEmpty();for(const t of this.items){const r=t.toTextObject();let i=e[r[Ds.NAME]];Array.isArray(i)||(i=[],e[r[Ds.NAME]]=i),i.push(r)}return e}}lo.NAME="GeneralNames";const fo="\\n",po="-{5}BEGIN ([^\\n]+(?=-{5}))-{5}\\n(?:((?:[^:\\n]+: (?:[^\\n]+\\n(?: +[^\\n]+\\n)*))+))?\\n?((?:[a-zA-Z0-9=+/]+\\n)+)-{5}END \\1-{5}";class yo{static isPem(e){return"string"==typeof e&&new RegExp(po,"g").test(e)}static decodeWithHeaders(e){e=e.replace(/\r/g,"");const t=new RegExp(po,"g"),r=[];let i=null;for(;i=t.exec(e);){const e=i[3].replace(new RegExp("[\\n]+","g"),""),t={type:i[1],headers:[],rawData:u.ep.FromBase64(e)},n=i[2];if(n){const e=n.split(new RegExp(fo,"g"));let r=null;for(const i of e){const[e,n]=i.split(/:(.*)/);if(void 0===n){if(!r)throw new Error("Cannot parse PEM string. Incorrect header value");r.value+=e.trim()}else r&&t.headers.push(r),r={key:e,value:n.trim()}}r&&t.headers.push(r)}r.push(t)}return r}static decode(e){return this.decodeWithHeaders(e).map((e=>e.rawData))}static decodeFirst(e){const t=this.decode(e);if(!t.length)throw new RangeError("PEM string doesn't contain any objects");return t[0]}static encode(e,t){if(Array.isArray(e)){const r=new Array;return t?e.forEach((e=>{if(!u.vJ.isBufferSource(e))throw new TypeError("Cannot encode array of BufferSource in PEM format. Not all items of the array are BufferSource");r.push(this.encodeStruct({type:t,rawData:u.vJ.toArrayBuffer(e)}))})):e.forEach((e=>{if(!("type"in e))throw new TypeError("Cannot encode array of PemStruct in PEM format. Not all items of the array are PemStrut");r.push(this.encodeStruct(e))})),r.join("\n")}if(!t)throw new Error("Required argument 'tag' is missed");return this.encodeStruct({type:t,rawData:u.vJ.toArrayBuffer(e)})}static encodeStruct(e){var t;const r=e.type.toLocaleUpperCase(),i=[];if(i.push(`-----BEGIN ${r}-----`),null===(t=e.headers)||void 0===t?void 0:t.length){for(const t of e.headers)i.push(`${t.key}: ${t.value}`);i.push("")}const n=u.ep.ToBase64(e.rawData);let s,o=0;const a=Array();for(;o<n.length&&(n.length-o<64?s=n.substring(o):(s=n.substring(o,o+64),o+=64),0!==s.length)&&(a.push(s),!(s.length<64)););return i.push(...a),i.push(`-----END ${r}-----`),i.join("\n")}}yo.CertificateTag="CERTIFICATE",yo.CrlTag="CRL",yo.CertificateRequestTag="CERTIFICATE REQUEST",yo.PublicKeyTag="PUBLIC KEY",yo.PrivateKeyTag="PRIVATE KEY";class mo extends qs{static isAsnEncoded(e){return u.vJ.isBufferSource(e)||"string"==typeof e}static toArrayBuffer(e){if("string"==typeof e){if(yo.isPem(e))return yo.decode(e)[0];if(u.ep.isHex(e))return u.ep.FromHex(e);if(u.ep.isBase64(e))return u.ep.FromBase64(e);if(u.ep.isBase64Url(e))return u.ep.FromBase64Url(e);throw new TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url")}{const t=u.ep.ToBinary(e);return yo.isPem(t)?yo.decode(t)[0]:u.ep.isHex(t)?u.ep.FromHex(t):u.ep.isBase64(t)?u.ep.FromBase64(t):u.ep.isBase64Url(t)?u.ep.FromBase64Url(t):u.vJ.toArrayBuffer(e)}}constructor(...e){mo.isAsnEncoded(e[0])?super(mo.toArrayBuffer(e[0]),e[1]):super(e[0])}toString(e="pem"){return"pem"===e?yo.encode(this.rawData,this.tag):super.toString(e)}}class go extends mo{constructor(e){mo.isAsnEncoded(e)?super(e,Fe):super(e),this.tag=yo.PublicKeyTag}async export(...e){let t,r=["verify"],i={hash:"SHA-256",...this.algorithm};return e.length>1?(i=e[0]||i,r=e[1]||r,t=e[2]||Fs.get()):t=e[0]||Fs.get(),t.subtle.importKey("spki",this.rawData,i,!0,r)}onInit(e){const t=Gi.resolve(ts),r=this.algorithm=t.toWebAlgorithm(e.algorithm);switch(e.algorithm.algorithm){case $r:{const t=o.zc.parse(e.subjectPublicKey,_i),i=u.vJ.toUint8Array(t.modulus);r.publicExponent=u.vJ.toUint8Array(t.publicExponent),r.modulusLength=(i[0]?i:i.slice(1)).byteLength<<3;break}}}async getThumbprint(...e){var t;let r,i="SHA-1";return e.length>=1&&!(null===(t=e[0])||void 0===t?void 0:t.subtle)?(i=e[0]||i,r=e[1]||Fs.get()):r=e[0]||Fs.get(),await r.subtle.digest(i,this.rawData)}async getKeyIdentifier(e){e||(e=Fs.get());const t=o.zc.parse(this.rawData,Fe);return await e.subtle.digest("SHA-1",t.subjectPublicKey)}toTextObject(){const e=this.toTextObjectEmpty(),t=o.zc.parse(this.rawData,Fe);if(e.Algorithm=js.serializeAlgorithm(t.algorithm),t.algorithm.algorithm===Pr)e["EC Point"]=t.subjectPublicKey;else e["Raw Data"]=t.subjectPublicKey;return e}}class bo{static register(e,t){this.items.set(e,t)}static create(e){const t=new Ks(e),r=this.items.get(t.type);return r?new r(e):t}}bo.items=new Map;const vo="crypto.signatureFormatter";class wo{toAsnSignature(e,t){return u.vJ.toArrayBuffer(t)}toWebSignature(e,t){return u.vJ.toArrayBuffer(t)}}class So extends mo{constructor(e){mo.isAsnEncoded(e)?super(e,Qe):super(e),this.tag=yo.CertificateTag}onInit(e){const t=e.tbsCertificate;this.tbs=o.zc.serialize(t),this.serialNumber=u.ep.ToHex(t.serialNumber),this.subjectName=new Js(t.subject),this.subject=new Js(t.subject).toString(),this.issuerName=new Js(t.issuer),this.issuer=this.issuerName.toString();const r=Gi.resolve(ts);this.signatureAlgorithm=r.toWebAlgorithm(e.signatureAlgorithm),this.signature=e.signatureValue;const i=t.validity.notBefore.utcTime||t.validity.notBefore.generalTime;if(!i)throw new Error("Cannot get 'notBefore' value");this.notBefore=i;const n=t.validity.notAfter.utcTime||t.validity.notAfter.generalTime;if(!n)throw new Error("Cannot get 'notAfter' value");this.notAfter=n,this.extensions=[],t.extensions&&(this.extensions=t.extensions.map((e=>bo.create(o.zc.serialize(e))))),this.publicKey=new go(t.subjectPublicKeyInfo)}getExtension(e){for(const t of this.extensions)if("string"==typeof e){if(t.type===e)return t}else if(t instanceof e)return t;return null}getExtensions(e){return this.extensions.filter((t=>"string"==typeof e?t.type===e:t instanceof e))}async verify(e={},t=Fs.get()){let r,i;const n=e.publicKey;try{if(n)if("publicKey"in n)r={...n.publicKey.algorithm,...this.signatureAlgorithm},i=await n.publicKey.export(r,["verify"]);else if(n instanceof go)r={...n.algorithm,...this.signatureAlgorithm},i=await n.export(r,["verify"]);else if(u.vJ.isBufferSource(n)){const e=new go(n);r={...e.algorithm,...this.signatureAlgorithm},i=await e.export(r,["verify"])}else r={...n.algorithm,...this.signatureAlgorithm},i=n;else r={...this.publicKey.algorithm,...this.signatureAlgorithm},i=await this.publicKey.export(r,["verify"],t)}catch(e){return!1}const s=Gi.resolveAll(vo).reverse();let o=null;for(const e of s)if(o=e.toWebSignature(r,this.signature),o)break;if(!o)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");const a=await t.subtle.verify(this.signatureAlgorithm,i,o,this.tbs);if(e.signatureOnly)return a;{const t=(e.date||new Date).getTime();return a&&this.notBefore.getTime()<t&&t<this.notAfter.getTime()}}async getThumbprint(...e){let t,r="SHA-1";return e[0]&&(e[0].subtle?t=e[0]:(r=e[0]||r,t=e[1])),null!=t||(t=Fs.get()),await t.subtle.digest(r,this.rawData)}async isSelfSigned(e=Fs.get()){return this.subject===this.issuer&&await this.verify({signatureOnly:!0},e)}toTextObject(){const e=this.toTextObjectEmpty(),t=o.zc.parse(this.rawData,Qe),r=t.tbsCertificate,i=new Ds("",{Version:`${Ye[r.version]} (${r.version})`,"Serial Number":r.serialNumber,"Signature Algorithm":js.serializeAlgorithm(r.signature),Issuer:this.issuer,Validity:new Ds("",{"Not Before":r.validity.notBefore.getTime(),"Not After":r.validity.notAfter.getTime()}),Subject:this.subject,"Subject Public Key Info":this.publicKey});if(r.issuerUniqueID&&(i["Issuer Unique ID"]=r.issuerUniqueID),r.subjectUniqueID&&(i["Subject Unique ID"]=r.subjectUniqueID),this.extensions.length){const e=new Ds("");for(const t of this.extensions){const r=t.toTextObject();e[r[Ds.NAME]]=r}i.Extensions=e}return e.Data=i,e.Signature=new Ds("",{Algorithm:js.serializeAlgorithm(t.signatureAlgorithm),"":t.signatureValue}),e}}So.NAME="Certificate";class _o extends Ks{constructor(...e){if(u.vJ.isBufferSource(e[0]))super(e[0]);else if("string"==typeof e[0]){const t=new P({keyIdentifier:new T(u.ep.FromHex(e[0]))});super(k,e[1],o.zc.serialize(t))}else{const t=e[0],r=t.name instanceof lo?o.zc.parse(t.name.rawData,B):t.name,i=new P({authorityCertIssuer:r,authorityCertSerialNumber:u.ep.FromHex(t.serialNumber)});super(k,e[1],o.zc.serialize(i))}}static async create(e,t=!1,r=Fs.get()){if(e instanceof So||zs.isCryptoKey(e)){const i=e instanceof So?await e.publicKey.export(r):e,n=await r.subtle.exportKey("spki",i),s=new go(n),o=await s.getKeyIdentifier(r);return new _o(u.ep.ToHex(o),t)}return new _o(e,t)}onInit(e){super.onInit(e);const t=o.zc.parse(e.extnValue,P);t.keyIdentifier&&(this.keyId=u.ep.ToHex(t.keyIdentifier)),t.authorityCertIssuer&&t.authorityCertSerialNumber&&(this.certId={name:t.authorityCertIssuer,serialNumber:u.ep.ToHex(t.authorityCertSerialNumber)})}toTextObject(){const e=this.toTextObjectWithoutValue(),t=o.zc.parse(this.value,P);return t.authorityCertIssuer&&(e["Authority Issuer"]=new lo(t.authorityCertIssuer).toTextObject()),t.authorityCertSerialNumber&&(e["Authority Serial Number"]=t.authorityCertSerialNumber),t.keyIdentifier&&(e[""]=t.keyIdentifier),e}}_o.NAME="Authority Key Identifier";class Ao extends Ks{constructor(...e){if(u.vJ.isBufferSource(e[0])){super(e[0]);const t=o.zc.parse(this.value,R);this.ca=t.cA,this.pathLength=t.pathLenConstraint}else{const t=new R({cA:e[0],pathLenConstraint:e[1]});super(I,e[2],o.zc.serialize(t)),this.ca=e[0],this.pathLength=e[1]}}toTextObject(){const e=this.toTextObjectWithoutValue();return this.ca&&(e.CA=this.ca),void 0!==this.pathLength&&(e["Path Length"]=this.pathLength),e}}var Eo,Co;Ao.NAME="Basic Constraints",function(e){e.serverAuth="1.3.6.1.5.5.7.3.1",e.clientAuth="1.3.6.1.5.5.7.3.2",e.codeSigning="1.3.6.1.5.5.7.3.3",e.emailProtection="1.3.6.1.5.5.7.3.4",e.timeStamping="1.3.6.1.5.5.7.3.8",e.ocspSigning="1.3.6.1.5.5.7.3.9"}(Eo||(Eo={}));class ko extends Ks{constructor(...e){if(u.vJ.isBufferSource(e[0])){super(e[0]);const t=o.zc.parse(this.value,oe);this.usages=t.map((e=>e))}else{const t=new oe(e[0]);super(se,e[1],o.zc.serialize(t)),this.usages=e[0]}}toTextObject(){const e=this.toTextObjectWithoutValue();return e[""]=this.usages.map((e=>Us.toString(e))).join(", "),e}}ko.NAME="Extended Key Usages",function(e){e[e.digitalSignature=1]="digitalSignature",e[e.nonRepudiation=2]="nonRepudiation",e[e.keyEncipherment=4]="keyEncipherment",e[e.dataEncipherment=8]="dataEncipherment",e[e.keyAgreement=16]="keyAgreement",e[e.keyCertSign=32]="keyCertSign",e[e.cRLSign=64]="cRLSign",e[e.encipherOnly=128]="encipherOnly",e[e.decipherOnly=256]="decipherOnly"}(Co||(Co={}));class To extends Ks{constructor(...e){if(u.vJ.isBufferSource(e[0])){super(e[0]);const t=o.zc.parse(this.value,Se);this.usages=t.toNumber()}else{const t=new Se(e[0]);super(be,e[1],o.zc.serialize(t)),this.usages=e[0]}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=o.zc.parse(this.value,Se);return e[""]=t.toJSON().join(", "),e}}To.NAME="Key Usages";class Po extends Ks{constructor(...e){if(u.vJ.isBufferSource(e[0])){super(e[0]);const t=o.zc.parse(this.value,De);this.keyId=u.ep.ToHex(t)}else{const t="string"==typeof e[0]?u.ep.FromHex(e[0]):e[0],r=new De(t);super(Ne,e[1],o.zc.serialize(r)),this.keyId=u.ep.ToHex(t)}}static async create(e,t=!1,r=Fs.get()){let i;i=e instanceof go?e.rawData:"publicKey"in e?e.publicKey.rawData:u.vJ.isBufferSource(e)?e:await r.subtle.exportKey("spki",e);const n=new go(i),s=await n.getKeyIdentifier(r);return new Po(u.ep.ToHex(s),t)}toTextObject(){const e=this.toTextObjectWithoutValue(),t=o.zc.parse(this.value,De);return e[""]=t,e}}Po.NAME="Subject Key Identifier";class Io extends Ks{constructor(...e){u.vJ.isBufferSource(e[0])?super(e[0]):super(Re,e[1],new lo(e[0]||[]).rawData)}onInit(e){super.onInit(e);const t=o.zc.parse(e.extnValue,xe);this.names=new lo(t)}toTextObject(){const e=this.toTextObjectWithoutValue(),t=this.names.toTextObject();for(const r in t)e[r]=t[r];return e}}Io.NAME="Subject Alternative Name";class Ro extends Ks{constructor(...e){var t;if(u.vJ.isBufferSource(e[0])){super(e[0]);const t=o.zc.parse(this.value,z);this.policies=t.map((e=>e.policyIdentifier))}else{const r=e[0],i=null!==(t=e[1])&&void 0!==t&&t,n=new z(r.map((e=>new H({policyIdentifier:e}))));super(D,i,o.zc.serialize(n)),this.policies=r}}toTextObject(){const e=this.toTextObjectWithoutValue();return e.Policy=this.policies.map((e=>new Ds("",{},Us.toString(e)))),e}}Ro.NAME="Certificate Policies",bo.register(D,Ro);class xo extends qs{constructor(...e){let t;if(u.vJ.isBufferSource(e[0]))t=u.vJ.toArrayBuffer(e[0]);else{const r=e[0],i=Array.isArray(e[1])?e[1].map((e=>u.vJ.toArrayBuffer(e))):[];t=o.zc.serialize(new Be({type:r,values:i}))}super(t,Be)}onInit(e){this.type=e.type,this.values=e.values}toTextObject(){const e=this.toTextObjectWithoutValue();return e.Value=this.values.map((e=>new Ds("",{"":e}))),e}toTextObjectWithoutValue(){const e=this.toTextObjectEmpty();return e[Ds.NAME]===xo.NAME&&(e[Ds.NAME]=Us.toString(this.type)),e}}xo.NAME="Attribute";class Bo extends xo{constructor(...e){var t;if(u.vJ.isBufferSource(e[0]))super(e[0]);else{const t=new zn({printableString:e[0]});super(En,[o.zc.serialize(t)])}null!==(t=this.password)&&void 0!==t||(this.password="")}onInit(e){if(super.onInit(e),this.values[0]){const e=o.zc.parse(this.values[0],zn);this.password=e.toString()}}toTextObject(){const e=this.toTextObjectWithoutValue();return e[Ds.VALUE]=this.password,e}}Bo.NAME="Challenge Password";class Oo extends xo{constructor(...e){var t;if(u.vJ.isBufferSource(e[0]))super(e[0]);else{const t=e[0],r=new Je;for(const e of t)r.push(o.zc.parse(e.rawData,Ge));super(Cn,[o.zc.serialize(r)])}null!==(t=this.items)&&void 0!==t||(this.items=[])}onInit(e){if(super.onInit(e),this.values[0]){const e=o.zc.parse(this.values[0],Je);this.items=e.map((e=>bo.create(o.zc.serialize(e))))}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=this.items.map((e=>e.toTextObject()));for(const r of t)e[r[Ds.NAME]]=r;return e}}Oo.NAME="Extensions";class Mo{static register(e,t){this.items.set(e,t)}static create(e){const t=new xo(e),r=this.items.get(t.type);return r?new r(e):t}}Mo.items=new Map;let No=class{toAsnAlgorithm(e){if("rsassa-pkcs1-v1_5"===e.name.toLowerCase()){if(!e.hash)return new ze({algorithm:$r,parameters:null});switch(e.hash.name.toLowerCase()){case"sha-1":return new ze({algorithm:Xr,parameters:null});case"sha-256":return new ze({algorithm:ei,parameters:null});case"sha-384":return new ze({algorithm:ti,parameters:null});case"sha-512":return new ze({algorithm:ri,parameters:null})}}return null}toWebAlgorithm(e){switch(e.algorithm){case $r:return{name:"RSASSA-PKCS1-v1_5"};case Xr:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case ei:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case ti:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case ri:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}}}return null}};No=(0,a.__decorate)([Yi()],No),Gi.registerSingleton(Qn,No);class Do{addPadding(e,t){const r=u.vJ.toUint8Array(t),i=new Uint8Array(e);return i.set(r,e-r.length),i}removePadding(e,t=!1){let r=u.vJ.toUint8Array(e);for(let e=0;e<r.length;e++)if(r[e]){r=r.slice(e);break}if(t&&r[0]>127){const e=new Uint8Array(r.length+1);return e.set(r,1),e.buffer}return r.buffer}toAsnSignature(e,t){if("ECDSA"===e.name){const r=e.namedCurve,i=Do.namedCurveSize.get(r)||Do.defaultNamedCurveSize,n=new Fr,s=u.vJ.toUint8Array(t);return n.r=this.removePadding(s.slice(0,i),!0),n.s=this.removePadding(s.slice(i,i+i),!0),o.zc.serialize(n)}return null}toWebSignature(e,t){if("ECDSA"===e.name){const r=o.zc.parse(t,Fr),i=e.namedCurve,n=Do.namedCurveSize.get(i)||Do.defaultNamedCurveSize,s=this.addPadding(n,this.removePadding(r.r)),a=this.addPadding(n,this.removePadding(r.s));return(0,u.$e)(s,a)}return null}}Do.namedCurveSize=new Map,Do.defaultNamedCurveSize=32;const Lo="1.3.101.110",Uo="1.3.101.111",jo="1.3.101.112",qo="1.3.101.113";let Ko=class{toAsnAlgorithm(e){let t=null;switch(e.name.toLowerCase()){case"eddsa":switch(e.namedCurve.toLowerCase()){case"ed25519":t=jo;break;case"ed448":t=qo}break;case"ecdh-es":switch(e.namedCurve.toLowerCase()){case"x25519":t=Lo;break;case"x448":t=Uo}}return t?new ze({algorithm:t}):null}toWebAlgorithm(e){switch(e.algorithm){case jo:return{name:"EdDSA",namedCurve:"Ed25519"};case qo:return{name:"EdDSA",namedCurve:"Ed448"};case Lo:return{name:"ECDH-ES",namedCurve:"X25519"};case Uo:return{name:"ECDH-ES",namedCurve:"X448"}}return null}};Ko=(0,a.__decorate)([Yi()],Ko),Gi.registerSingleton(Qn,Ko);class Ho extends mo{constructor(e){mo.isAsnEncoded(e)?super(e,Xn):super(e),this.tag=yo.CertificateRequestTag}onInit(e){this.tbs=o.zc.serialize(e.certificationRequestInfo),this.publicKey=new go(e.certificationRequestInfo.subjectPKInfo);const t=Gi.resolve(ts);this.signatureAlgorithm=t.toWebAlgorithm(e.signatureAlgorithm),this.signature=e.signature,this.attributes=e.certificationRequestInfo.attributes.map((e=>Mo.create(o.zc.serialize(e))));const r=this.getAttribute(Cn);this.extensions=[],r instanceof Oo&&(this.extensions=r.items),this.subjectName=new Js(e.certificationRequestInfo.subject),this.subject=this.subjectName.toString()}getAttribute(e){for(const t of this.attributes)if(t.type===e)return t;return null}getAttributes(e){return this.attributes.filter((t=>t.type===e))}getExtension(e){for(const t of this.extensions)if(t.type===e)return t;return null}getExtensions(e){return this.extensions.filter((t=>t.type===e))}async verify(e=Fs.get()){const t={...this.publicKey.algorithm,...this.signatureAlgorithm},r=await this.publicKey.export(t,["verify"],e),i=Gi.resolveAll(vo).reverse();let n=null;for(const e of i)if(n=e.toWebSignature(t,this.signature),n)break;if(!n)throw Error("Cannot convert WebCrypto signature value to ASN.1 format");return await e.subtle.verify(this.signatureAlgorithm,r,n,this.tbs)}toTextObject(){const e=this.toTextObjectEmpty(),t=o.zc.parse(this.rawData,Xn),r=t.certificationRequestInfo,i=new Ds("",{Version:`${Ye[r.version]} (${r.version})`,Subject:this.subject,"Subject Public Key Info":this.publicKey});if(this.attributes.length){const e=new Ds("");for(const t of this.attributes){const r=t.toTextObject();e[r[Ds.NAME]]=r}i.Attributes=e}return e.Data=i,e.Signature=new Ds("",{Algorithm:js.serializeAlgorithm(t.signatureAlgorithm),"":t.signature}),e}}Ho.NAME="PKCS#10 Certificate Request";class zo{static async create(e,t=Fs.get()){if(!e.keys.privateKey)throw new Error("Bad field 'keys' in 'params' argument. 'privateKey' is empty");if(!e.keys.publicKey)throw new Error("Bad field 'keys' in 'params' argument. 'publicKey' is empty");const r=await t.subtle.exportKey("spki",e.keys.publicKey),i=new Xn({certificationRequestInfo:new Zn({subjectPKInfo:o.zc.parse(r,Fe)})});if(e.name){const t=e.name instanceof Js?e.name:new Js(e.name);i.certificationRequestInfo.subject=o.zc.parse(t.toArrayBuffer(),m)}if(e.attributes)for(const t of e.attributes)i.certificationRequestInfo.attributes.push(o.zc.parse(t.rawData,Be));if(e.extensions&&e.extensions.length){const t=new Be({type:Cn}),r=new Je;for(const t of e.extensions)r.push(o.zc.parse(t.rawData,Ge));t.values.push(o.zc.serialize(r)),i.certificationRequestInfo.attributes.push(t)}const n={...e.signingAlgorithm,...e.keys.privateKey.algorithm},s=Gi.resolve(ts);i.signatureAlgorithm=s.toAsnAlgorithm(n);const a=o.zc.serialize(i.certificationRequestInfo),c=await t.subtle.sign(n,e.keys.privateKey,a),u=Gi.resolveAll(vo).reverse();let h=null;for(const e of u)if(h=e.toAsnSignature(n,c),h)break;if(!h)throw Error("Cannot convert WebCrypto signature value to ASN.1 format");return i.signature=h,new Ho(o.zc.serialize(i))}}class Fo extends Array{constructor(e){if(super(),mo.isAsnEncoded(e))this.import(e);else if(e instanceof So)this.push(e);else if(Array.isArray(e))for(const t of e)this.push(t)}export(e){const t=new Tr;t.version=1,t.encapContentInfo.eContentType="1.2.840.113549.1.7.1",t.encapContentInfo.eContent=new Dt({single:new o.fi}),t.certificates=new Mt(this.map((e=>new Ot({certificate:o.zc.parse(e.rawData,Qe)}))));const r=new Nt({contentType:wr,content:o.zc.serialize(t)}),i=o.zc.serialize(r);return"raw"===e?i:this.toString(e)}import(e){const t=mo.toArrayBuffer(e),r=o.zc.parse(t,Nt);if(r.contentType!==wr)throw new TypeError("Cannot parse CMS package. Incoming data is not a SignedData object.");const i=o.zc.parse(r.content,Tr);this.clear();for(const e of i.certificates||[])e.certificate&&this.push(new So(e.certificate))}clear(){for(;this.pop(););}toString(e="pem"){const t=this.export("raw");switch(e){case"pem":return yo.encode(t,"CMS");case"pem-chain":return this.map((e=>e.toString("pem"))).join("\n");case"asn":return o.zc.toString(t);case"hex":return u.ep.ToHex(t);case"base64":return u.ep.ToBase64(t);case"base64url":return u.ep.ToBase64Url(t);case"text":return js.serialize(this.toTextObject());default:throw TypeError("Argument 'format' is unsupported value")}}toTextObject(){const e=o.zc.parse(this.export("raw"),Nt),t=o.zc.parse(e.content,Tr);return new Ds("X509Certificates",{"Content Type":Us.toString(e.contentType),Content:new Ds("",{Version:`${Ut[t.version]} (${t.version})`,Certificates:new Ds("",{Certificate:this.map((e=>e.toTextObject()))})})})}}class Vo{constructor(e={}){this.certificates=[],e.certificates&&(this.certificates=e.certificates)}async build(e,t=Fs.get()){const r=new Fo(e);let i=e;for(;i=await this.findIssuer(i,t);){const e=await i.getThumbprint(t);for(const i of r){const r=await i.getThumbprint(t);if((0,u.Xy)(e,r))throw new Error("Cannot build a certificate chain. Circular dependency.")}r.push(i)}return r}async findIssuer(e,t=Fs.get()){if(!await e.isSelfSigned(t)){const r=e.getExtension(k);for(const i of this.certificates)if(i.subject===e.issuer){if(r)if(r.keyId){const e=i.getExtension(Ne);if(e&&e.keyId!==r.keyId)continue}else if(r.certId){const e=i.getExtension(Re);if(e&&(r.certId.serialNumber!==i.serialNumber||!(0,u.Xy)(o.zc.serialize(r.certId.name),o.zc.serialize(e))))continue}if(await e.verify({publicKey:await i.publicKey.export(t),signatureOnly:!0},t))return i}}return null}}class $o{static async createSelfSigned(e,t=Fs.get()){if(!e.keys.privateKey)throw new Error("Bad field 'keys' in 'params' argument. 'privateKey' is empty");if(!e.keys.publicKey)throw new Error("Bad field 'keys' in 'params' argument. 'privateKey' is empty");return this.create({serialNumber:e.serialNumber,subject:e.name,issuer:e.name,notBefore:e.notBefore,notAfter:e.notAfter,publicKey:e.keys.publicKey,signingKey:e.keys.privateKey,signingAlgorithm:e.signingAlgorithm,extensions:e.extensions},t)}static async create(e,t=Fs.get()){var r;let i;i=e.publicKey instanceof go?e.publicKey.rawData:"publicKey"in e.publicKey?e.publicKey.publicKey.rawData:u.vJ.isBufferSource(e.publicKey)?e.publicKey:await t.subtle.exportKey("spki",e.publicKey);const n=new Qe({tbsCertificate:new Xe({version:Ye.v3,serialNumber:u.ep.FromHex(e.serialNumber),validity:new $e({notBefore:e.notBefore,notAfter:e.notAfter}),extensions:new Je((null===(r=e.extensions)||void 0===r?void 0:r.map((e=>o.zc.parse(e.rawData,Ge))))||[]),subjectPublicKeyInfo:o.zc.parse(i,Fe)})});if(e.subject){const t=e.subject instanceof Js?e.subject:new Js(e.subject);n.tbsCertificate.subject=o.zc.parse(t.toArrayBuffer(),m)}if(e.issuer){const t=e.issuer instanceof Js?e.issuer:new Js(e.issuer);n.tbsCertificate.issuer=o.zc.parse(t.toArrayBuffer(),m)}const s="signingKey"in e?{...e.signingAlgorithm,...e.signingKey.algorithm}:e.publicKey.algorithm,a=Gi.resolve(ts);n.tbsCertificate.signature=n.signatureAlgorithm=a.toAsnAlgorithm(s);const c=o.zc.serialize(n.tbsCertificate),h="signingKey"in e?await t.subtle.sign(s,e.signingKey,c):e.signature,d=Gi.resolveAll(vo).reverse();let l=null;for(const e of d)if(l=e.toAsnSignature(s,h),l)break;if(!l)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return n.signatureValue=l,new So(o.zc.serialize(n))}}var Wo;!function(e){e[e.unspecified=0]="unspecified",e[e.keyCompromise=1]="keyCompromise",e[e.cACompromise=2]="cACompromise",e[e.affiliationChanged=3]="affiliationChanged",e[e.superseded=4]="superseded",e[e.cessationOfOperation=5]="cessationOfOperation",e[e.certificateHold=6]="certificateHold",e[e.removeFromCRL=8]="removeFromCRL",e[e.privilegeWithdrawn=9]="privilegeWithdrawn",e[e.aACompromise=10]="aACompromise"}(Wo||(Wo={}));class Go extends qs{constructor(...e){let t;t=u.vJ.isBufferSource(e[0])?u.vJ.toArrayBuffer(e[0]):o.zc.serialize(new et({userCertificate:e[0],revocationDate:new Ve(e[1]),crlEntryExtensions:e[2]})),super(t,et)}onInit(e){this.serialNumber=u.ep.ToHex(e.userCertificate),this.revocationDate=e.revocationDate.getTime(),this.extensions=[],e.crlEntryExtensions&&(this.extensions=e.crlEntryExtensions.map((e=>{const t=bo.create(o.zc.serialize(e));switch(t.type){case te:this.reason=o.zc.parse(t.value,ie).reason;break;case pe:this.invalidity=o.zc.parse(t.value,ye).value}return t})))}}class Jo extends mo{constructor(e){mo.isAsnEncoded(e)?super(e,rt):super(e),this.tag=yo.CrlTag}onInit(e){var t,r;const i=e.tbsCertList;this.tbs=o.zc.serialize(i),this.version=i.version;const n=Gi.resolve(ts);this.signatureAlgorithm=n.toWebAlgorithm(e.signatureAlgorithm),this.tbsCertListSignatureAlgorithm=i.signature,this.certListSignatureAlgorithm=e.signatureAlgorithm,this.signature=e.signature,this.issuerName=new Js(i.issuer),this.issuer=this.issuerName.toString();const s=i.thisUpdate.getTime();if(!s)throw new Error("Cannot get 'thisUpdate' value");this.thisUpdate=s;const a=null===(t=i.nextUpdate)||void 0===t?void 0:t.getTime();this.nextUpdate=a,this.entries=(null===(r=i.revokedCertificates)||void 0===r?void 0:r.map((e=>new Go(o.zc.serialize(e)))))||[],this.extensions=[],i.crlExtensions&&(this.extensions=i.crlExtensions.map((e=>bo.create(o.zc.serialize(e)))))}getExtension(e){for(const t of this.extensions)if("string"==typeof e){if(t.type===e)return t}else if(t instanceof e)return t;return null}getExtensions(e){return this.extensions.filter((t=>"string"==typeof e?t.type===e:t instanceof e))}async verify(e,t=Fs.get()){if(!this.certListSignatureAlgorithm.isEqual(this.tbsCertListSignatureAlgorithm))throw new Error("algorithm identifier in the sequence tbsCertList and CertificateList mismatch");let r,i;const n=e.publicKey;try{n instanceof So?(r={...n.publicKey.algorithm,...n.signatureAlgorithm},i=await n.publicKey.export(r,["verify"])):n instanceof go?(r={...n.algorithm,...this.signature},i=await n.export(r,["verify"])):(r={...n.algorithm,...this.signature},i=n)}catch(e){return!1}const s=Gi.resolveAll(vo).reverse();let o=null;for(const e of s)if(o=e.toWebSignature(r,this.signature),o)break;if(!o)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return await t.subtle.verify(this.signatureAlgorithm,i,o,this.tbs)}async getThumbprint(...e){let t,r="SHA-1";return e[0]&&(e[0].subtle?t=e[0]:(r=e[0]||r,t=e[1])),null!=t||(t=Fs.get()),await t.subtle.digest(r,this.rawData)}findRevoked(e){const t="string"==typeof e?e:e.serialNumber;for(const e of this.entries)if(e.serialNumber===t)return e;return null}}class Yo{static async create(e,t=Fs.get()){var r;const i=e.issuer instanceof Js?e.issuer:new Js(e.issuer),n=new rt({tbsCertList:new tt({version:Ye.v2,issuer:o.zc.parse(i.toArrayBuffer(),m),thisUpdate:new Ve(e.thisUpdate||new Date)})});if(e.nextUpdate&&(n.tbsCertList.nextUpdate=new Ve(e.nextUpdate)),e.extensions&&e.extensions.length&&(n.tbsCertList.crlExtensions=new Je(e.extensions.map((e=>o.zc.parse(e.rawData,Ge)))||[])),e.entries&&e.entries.length){n.tbsCertList.revokedCertificates=[];for(const t of e.entries){const i=mo.toArrayBuffer(t.serialNumber);if(n.tbsCertList.revokedCertificates.findIndex((e=>(0,u.Xy)(e.userCertificate,i)))>-1)throw new Error(`Certificate serial number ${t.serialNumber} already exists in tbsCertList`);const s=new et({userCertificate:i,revocationDate:new Ve(t.revocationDate||new Date)});if("extensions"in t&&(null===(r=t.extensions)||void 0===r?void 0:r.length)?s.crlEntryExtensions=t.extensions.map((e=>o.zc.parse(e.rawData,Ge))):s.crlEntryExtensions=[],!(t instanceof Go)&&(t.reason&&s.crlEntryExtensions.push(new Ge({extnID:te,critical:!1,extnValue:new o.fi(o.zc.serialize(new ie(t.reason)))})),t.invalidity&&s.crlEntryExtensions.push(new Ge({extnID:pe,critical:!1,extnValue:new o.fi(o.zc.serialize(new ye(t.invalidity)))})),t.issuer)){const t=e.issuer instanceof Js?e.issuer:new Js(e.issuer);s.crlEntryExtensions.push(new Ge({extnID:"2.5.29.29",critical:!1,extnValue:new o.fi(o.zc.serialize(o.zc.parse(t.toArrayBuffer(),m)))}))}n.tbsCertList.revokedCertificates.push(s)}}const s={...e.signingAlgorithm,...e.signingKey.algorithm},a=Gi.resolve(ts);n.tbsCertList.signature=n.signatureAlgorithm=a.toAsnAlgorithm(s);const c=o.zc.serialize(n.tbsCertList),h=await t.subtle.sign(s,e.signingKey,c),d=Gi.resolveAll(vo).reverse();let l=null;for(const e of d)if(l=e.toAsnSignature(s,h),l)break;if(!l)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return n.signature=l,new Jo(o.zc.serialize(n))}}bo.register(I,Ao),bo.register(se,ko),bo.register(be,To),bo.register(Ne,Po),bo.register(k,_o),bo.register(Re,Io),Mo.register(En,Bo),Mo.register(Cn,Oo),Gi.registerSingleton(vo,wo),Gi.registerSingleton(vo,Do),Do.namedCurveSize.set("P-256",32),Do.namedCurveSize.set("K-256",32),Do.namedCurveSize.set("P-384",48),Do.namedCurveSize.set("P-521",66)},3663:function(e){!function(t){"use strict";function r(e){return parseInt(e)===e}function i(e){if(!r(e.length))return!1;for(var t=0;t<e.length;t++)if(!r(e[t])||e[t]<0||e[t]>255)return!1;return!0}function n(e,t){if(e.buffer&&"Uint8Array"===e.name)return t&&(e=e.slice?e.slice():Array.prototype.slice.call(e)),e;if(Array.isArray(e)){if(!i(e))throw new Error("Array contains invalid value: "+e);return new Uint8Array(e)}if(r(e.length)&&i(e))return new Uint8Array(e);throw new Error("unsupported array-like object")}function s(e){return new Uint8Array(e)}function o(e,t,r,i,n){null==i&&null==n||(e=e.slice?e.slice(i,n):Array.prototype.slice.call(e,i,n)),t.set(e,r)}var a,c={toBytes:function(e){var t=[],r=0;for(e=encodeURI(e);r<e.length;){var i=e.charCodeAt(r++);37===i?(t.push(parseInt(e.substr(r,2),16)),r+=2):t.push(i)}return n(t)},fromBytes:function(e){for(var t=[],r=0;r<e.length;){var i=e[r];i<128?(t.push(String.fromCharCode(i)),r++):i>191&&i<224?(t.push(String.fromCharCode((31&i)<<6|63&e[r+1])),r+=2):(t.push(String.fromCharCode((15&i)<<12|(63&e[r+1])<<6|63&e[r+2])),r+=3)}return t.join("")}},u=(a="0123456789abcdef",{toBytes:function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(parseInt(e.substr(r,2),16));return t},fromBytes:function(e){for(var t=[],r=0;r<e.length;r++){var i=e[r];t.push(a[(240&i)>>4]+a[15&i])}return t.join("")}}),h={16:10,24:12,32:14},d=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],l=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],f=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],p=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],y=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],m=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],g=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],b=[1374988112,2118214995,437757123,975658646,1001089995,530400753,2902087851,1273168787,540080725,2910219766,2295101073,4110568485,1340463100,3307916247,641025152,3043140495,3736164937,632953703,1172967064,1576976609,3274667266,2169303058,2370213795,1809054150,59727847,361929877,3211623147,2505202138,3569255213,1484005843,1239443753,2395588676,1975683434,4102977912,2572697195,666464733,3202437046,4035489047,3374361702,2110667444,1675577880,3843699074,2538681184,1649639237,2976151520,3144396420,4269907996,4178062228,1883793496,2403728665,2497604743,1383856311,2876494627,1917518562,3810496343,1716890410,3001755655,800440835,2261089178,3543599269,807962610,599762354,33778362,3977675356,2328828971,2809771154,4077384432,1315562145,1708848333,101039829,3509871135,3299278474,875451293,2733856160,92987698,2767645557,193195065,1080094634,1584504582,3178106961,1042385657,2531067453,3711829422,1306967366,2438237621,1908694277,67556463,1615861247,429456164,3602770327,2302690252,1742315127,2968011453,126454664,3877198648,2043211483,2709260871,2084704233,4169408201,0,159417987,841739592,504459436,1817866830,4245618683,260388950,1034867998,908933415,168810852,1750902305,2606453969,607530554,202008497,2472011535,3035535058,463180190,2160117071,1641816226,1517767529,470948374,3801332234,3231722213,1008918595,303765277,235474187,4069246893,766945465,337553864,1475418501,2943682380,4003061179,2743034109,4144047775,1551037884,1147550661,1543208500,2336434550,3408119516,3069049960,3102011747,3610369226,1113818384,328671808,2227573024,2236228733,3535486456,2935566865,3341394285,496906059,3702665459,226906860,2009195472,733156972,2842737049,294930682,1206477858,2835123396,2700099354,1451044056,573804783,2269728455,3644379585,2362090238,2564033334,2801107407,2776292904,3669462566,1068351396,742039012,1350078989,1784663195,1417561698,4136440770,2430122216,775550814,2193862645,2673705150,1775276924,1876241833,3475313331,3366754619,270040487,3902563182,3678124923,3441850377,1851332852,3969562369,2203032232,3868552805,2868897406,566021896,4011190502,3135740889,1248802510,3936291284,699432150,832877231,708780849,3332740144,899835584,1951317047,4236429990,3767586992,866637845,4043610186,1106041591,2144161806,395441711,1984812685,1139781709,3433712980,3835036895,2664543715,1282050075,3240894392,1181045119,2640243204,25965917,4203181171,4211818798,3009879386,2463879762,3910161971,1842759443,2597806476,933301370,1509430414,3943906441,3467192302,3076639029,3776767469,2051518780,2631065433,1441952575,404016761,1942435775,1408749034,1610459739,3745345300,2017778566,3400528769,3110650942,941896748,3265478751,371049330,3168937228,675039627,4279080257,967311729,135050206,3635733660,1683407248,2076935265,3576870512,1215061108,3501741890],v=[1347548327,1400783205,3273267108,2520393566,3409685355,4045380933,2880240216,2471224067,1428173050,4138563181,2441661558,636813900,4233094615,3620022987,2149987652,2411029155,1239331162,1730525723,2554718734,3781033664,46346101,310463728,2743944855,3328955385,3875770207,2501218972,3955191162,3667219033,768917123,3545789473,692707433,1150208456,1786102409,2029293177,1805211710,3710368113,3065962831,401639597,1724457132,3028143674,409198410,2196052529,1620529459,1164071807,3769721975,2226875310,486441376,2499348523,1483753576,428819965,2274680428,3075636216,598438867,3799141122,1474502543,711349675,129166120,53458370,2592523643,2782082824,4063242375,2988687269,3120694122,1559041666,730517276,2460449204,4042459122,2706270690,3446004468,3573941694,533804130,2328143614,2637442643,2695033685,839224033,1973745387,957055980,2856345839,106852767,1371368976,4181598602,1033297158,2933734917,1179510461,3046200461,91341917,1862534868,4284502037,605657339,2547432937,3431546947,2003294622,3182487618,2282195339,954669403,3682191598,1201765386,3917234703,3388507166,0,2198438022,1211247597,2887651696,1315723890,4227665663,1443857720,507358933,657861945,1678381017,560487590,3516619604,975451694,2970356327,261314535,3535072918,2652609425,1333838021,2724322336,1767536459,370938394,182621114,3854606378,1128014560,487725847,185469197,2918353863,3106780840,3356761769,2237133081,1286567175,3152976349,4255350624,2683765030,3160175349,3309594171,878443390,1988838185,3704300486,1756818940,1673061617,3403100636,272786309,1075025698,545572369,2105887268,4174560061,296679730,1841768865,1260232239,4091327024,3960309330,3497509347,1814803222,2578018489,4195456072,575138148,3299409036,446754879,3629546796,4011996048,3347532110,3252238545,4270639778,915985419,3483825537,681933534,651868046,2755636671,3828103837,223377554,2607439820,1649704518,3270937875,3901806776,1580087799,4118987695,3198115200,2087309459,2842678573,3016697106,1003007129,2802849917,1860738147,2077965243,164439672,4100872472,32283319,2827177882,1709610350,2125135846,136428751,3874428392,3652904859,3460984630,3572145929,3593056380,2939266226,824852259,818324884,3224740454,930369212,2801566410,2967507152,355706840,1257309336,4148292826,243256656,790073846,2373340630,1296297904,1422699085,3756299780,3818836405,457992840,3099667487,2135319889,77422314,1560382517,1945798516,788204353,1521706781,1385356242,870912086,325965383,2358957921,2050466060,2388260884,2313884476,4006521127,901210569,3990953189,1014646705,1503449823,1062597235,2031621326,3212035895,3931371469,1533017514,350174575,2256028891,2177544179,1052338372,741876788,1606591296,1914052035,213705253,2334669897,1107234197,1899603969,3725069491,2631447780,2422494913,1635502980,1893020342,1950903388,1120974935],w=[2807058932,1699970625,2764249623,1586903591,1808481195,1173430173,1487645946,59984867,4199882800,1844882806,1989249228,1277555970,3623636965,3419915562,1149249077,2744104290,1514790577,459744698,244860394,3235995134,1963115311,4027744588,2544078150,4190530515,1608975247,2627016082,2062270317,1507497298,2200818878,567498868,1764313568,3359936201,2305455554,2037970062,1047239e3,1910319033,1337376481,2904027272,2892417312,984907214,1243112415,830661914,861968209,2135253587,2011214180,2927934315,2686254721,731183368,1750626376,4246310725,1820824798,4172763771,3542330227,48394827,2404901663,2871682645,671593195,3254988725,2073724613,145085239,2280796200,2779915199,1790575107,2187128086,472615631,3029510009,4075877127,3802222185,4107101658,3201631749,1646252340,4270507174,1402811438,1436590835,3778151818,3950355702,3963161475,4020912224,2667994737,273792366,2331590177,104699613,95345982,3175501286,2377486676,1560637892,3564045318,369057872,4213447064,3919042237,1137477952,2658625497,1119727848,2340947849,1530455833,4007360968,172466556,266959938,516552836,0,2256734592,3980931627,1890328081,1917742170,4294704398,945164165,3575528878,958871085,3647212047,2787207260,1423022939,775562294,1739656202,3876557655,2530391278,2443058075,3310321856,547512796,1265195639,437656594,3121275539,719700128,3762502690,387781147,218828297,3350065803,2830708150,2848461854,428169201,122466165,3720081049,1627235199,648017665,4122762354,1002783846,2117360635,695634755,3336358691,4234721005,4049844452,3704280881,2232435299,574624663,287343814,612205898,1039717051,840019705,2708326185,793451934,821288114,1391201670,3822090177,376187827,3113855344,1224348052,1679968233,2361698556,1058709744,752375421,2431590963,1321699145,3519142200,2734591178,188127444,2177869557,3727205754,2384911031,3215212461,2648976442,2450346104,3432737375,1180849278,331544205,3102249176,4150144569,2952102595,2159976285,2474404304,766078933,313773861,2570832044,2108100632,1668212892,3145456443,2013908262,418672217,3070356634,2594734927,1852171925,3867060991,3473416636,3907448597,2614737639,919489135,164948639,2094410160,2997825956,590424639,2486224549,1723872674,3157750862,3399941250,3501252752,3625268135,2555048196,3673637356,1343127501,4130281361,3599595085,2957853679,1297403050,81781910,3051593425,2283490410,532201772,1367295589,3926170974,895287692,1953757831,1093597963,492483431,3528626907,1446242576,1192455638,1636604631,209336225,344873464,1015671571,669961897,3375740769,3857572124,2973530695,3747192018,1933530610,3464042516,935293895,3454686199,2858115069,1863638845,3683022916,4085369519,3292445032,875313188,1080017571,3279033885,621591778,1233856572,2504130317,24197544,3017672716,3835484340,3247465558,2220981195,3060847922,1551124588,1463996600],S=[4104605777,1097159550,396673818,660510266,2875968315,2638606623,4200115116,3808662347,821712160,1986918061,3430322568,38544885,3856137295,718002117,893681702,1654886325,2975484382,3122358053,3926825029,4274053469,796197571,1290801793,1184342925,3556361835,2405426947,2459735317,1836772287,1381620373,3196267988,1948373848,3764988233,3385345166,3263785589,2390325492,1480485785,3111247143,3780097726,2293045232,548169417,3459953789,3746175075,439452389,1362321559,1400849762,1685577905,1806599355,2174754046,137073913,1214797936,1174215055,3731654548,2079897426,1943217067,1258480242,529487843,1437280870,3945269170,3049390895,3313212038,923313619,679998e3,3215307299,57326082,377642221,3474729866,2041877159,133361907,1776460110,3673476453,96392454,878845905,2801699524,777231668,4082475170,2330014213,4142626212,2213296395,1626319424,1906247262,1846563261,562755902,3708173718,1040559837,3871163981,1418573201,3294430577,114585348,1343618912,2566595609,3186202582,1078185097,3651041127,3896688048,2307622919,425408743,3371096953,2081048481,1108339068,2216610296,0,2156299017,736970802,292596766,1517440620,251657213,2235061775,2933202493,758720310,265905162,1554391400,1532285339,908999204,174567692,1474760595,4002861748,2610011675,3234156416,3693126241,2001430874,303699484,2478443234,2687165888,585122620,454499602,151849742,2345119218,3064510765,514443284,4044981591,1963412655,2581445614,2137062819,19308535,1928707164,1715193156,4219352155,1126790795,600235211,3992742070,3841024952,836553431,1669664834,2535604243,3323011204,1243905413,3141400786,4180808110,698445255,2653899549,2989552604,2253581325,3252932727,3004591147,1891211689,2487810577,3915653703,4237083816,4030667424,2100090966,865136418,1229899655,953270745,3399679628,3557504664,4118925222,2061379749,3079546586,2915017791,983426092,2022837584,1607244650,2118541908,2366882550,3635996816,972512814,3283088770,1568718495,3499326569,3576539503,621982671,2895723464,410887952,2623762152,1002142683,645401037,1494807662,2595684844,1335535747,2507040230,4293295786,3167684641,367585007,3885750714,1865862730,2668221674,2960971305,2763173681,1059270954,2777952454,2724642869,1320957812,2194319100,2429595872,2815956275,77089521,3973773121,3444575871,2448830231,1305906550,4021308739,2857194700,2516901860,3518358430,1787304780,740276417,1699839814,1592394909,2352307457,2272556026,188821243,1729977011,3687994002,274084841,3594982253,3613494426,2701949495,4162096729,322734571,2837966542,1640576439,484830689,1202797690,3537852828,4067639125,349075736,3342319475,4157467219,4255800159,1030690015,1155237496,2951971274,1757691577,607398968,2738905026,499347990,3794078908,1011452712,227885567,2818666809,213114376,3034881240,1455525988,3414450555,850817237,1817998408,3092726480],_=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],A=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],E=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],C=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];function k(e){for(var t=[],r=0;r<e.length;r+=4)t.push(e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3]);return t}var T=function(e){if(!(this instanceof T))throw Error("AES must be instanitated with `new`");Object.defineProperty(this,"key",{value:n(e,!0)}),this._prepare()};T.prototype._prepare=function(){var e=h[this.key.length];if(null==e)throw new Error("invalid key size (must be 16, 24 or 32 bytes)");this._Ke=[],this._Kd=[];for(var t=0;t<=e;t++)this._Ke.push([0,0,0,0]),this._Kd.push([0,0,0,0]);var r,i=4*(e+1),n=this.key.length/4,s=k(this.key);for(t=0;t<n;t++)r=t>>2,this._Ke[r][t%4]=s[t],this._Kd[e-r][t%4]=s[t];for(var o,a=0,c=n;c<i;){if(o=s[n-1],s[0]^=l[o>>16&255]<<24^l[o>>8&255]<<16^l[255&o]<<8^l[o>>24&255]^d[a]<<24,a+=1,8!=n)for(t=1;t<n;t++)s[t]^=s[t-1];else{for(t=1;t<n/2;t++)s[t]^=s[t-1];o=s[n/2-1],s[n/2]^=l[255&o]^l[o>>8&255]<<8^l[o>>16&255]<<16^l[o>>24&255]<<24;for(t=n/2+1;t<n;t++)s[t]^=s[t-1]}for(t=0;t<n&&c<i;)u=c>>2,f=c%4,this._Ke[u][f]=s[t],this._Kd[e-u][f]=s[t++],c++}for(var u=1;u<e;u++)for(var f=0;f<4;f++)o=this._Kd[u][f],this._Kd[u][f]=_[o>>24&255]^A[o>>16&255]^E[o>>8&255]^C[255&o]},T.prototype.encrypt=function(e){if(16!=e.length)throw new Error("invalid plaintext size (must be 16 bytes)");for(var t=this._Ke.length-1,r=[0,0,0,0],i=k(e),n=0;n<4;n++)i[n]^=this._Ke[0][n];for(var o=1;o<t;o++){for(n=0;n<4;n++)r[n]=p[i[n]>>24&255]^y[i[(n+1)%4]>>16&255]^m[i[(n+2)%4]>>8&255]^g[255&i[(n+3)%4]]^this._Ke[o][n];i=r.slice()}var a,c=s(16);for(n=0;n<4;n++)a=this._Ke[t][n],c[4*n]=255&(l[i[n]>>24&255]^a>>24),c[4*n+1]=255&(l[i[(n+1)%4]>>16&255]^a>>16),c[4*n+2]=255&(l[i[(n+2)%4]>>8&255]^a>>8),c[4*n+3]=255&(l[255&i[(n+3)%4]]^a);return c},T.prototype.decrypt=function(e){if(16!=e.length)throw new Error("invalid ciphertext size (must be 16 bytes)");for(var t=this._Kd.length-1,r=[0,0,0,0],i=k(e),n=0;n<4;n++)i[n]^=this._Kd[0][n];for(var o=1;o<t;o++){for(n=0;n<4;n++)r[n]=b[i[n]>>24&255]^v[i[(n+3)%4]>>16&255]^w[i[(n+2)%4]>>8&255]^S[255&i[(n+1)%4]]^this._Kd[o][n];i=r.slice()}var a,c=s(16);for(n=0;n<4;n++)a=this._Kd[t][n],c[4*n]=255&(f[i[n]>>24&255]^a>>24),c[4*n+1]=255&(f[i[(n+3)%4]>>16&255]^a>>16),c[4*n+2]=255&(f[i[(n+2)%4]>>8&255]^a>>8),c[4*n+3]=255&(f[255&i[(n+1)%4]]^a);return c};var P=function(e){if(!(this instanceof P))throw Error("AES must be instanitated with `new`");this.description="Electronic Code Block",this.name="ecb",this._aes=new T(e)};P.prototype.encrypt=function(e){if((e=n(e)).length%16!=0)throw new Error("invalid plaintext size (must be multiple of 16 bytes)");for(var t=s(e.length),r=s(16),i=0;i<e.length;i+=16)o(e,r,0,i,i+16),o(r=this._aes.encrypt(r),t,i);return t},P.prototype.decrypt=function(e){if((e=n(e)).length%16!=0)throw new Error("invalid ciphertext size (must be multiple of 16 bytes)");for(var t=s(e.length),r=s(16),i=0;i<e.length;i+=16)o(e,r,0,i,i+16),o(r=this._aes.decrypt(r),t,i);return t};var I=function(e,t){if(!(this instanceof I))throw Error("AES must be instanitated with `new`");if(this.description="Cipher Block Chaining",this.name="cbc",t){if(16!=t.length)throw new Error("invalid initialation vector size (must be 16 bytes)")}else t=s(16);this._lastCipherblock=n(t,!0),this._aes=new T(e)};I.prototype.encrypt=function(e){if((e=n(e)).length%16!=0)throw new Error("invalid plaintext size (must be multiple of 16 bytes)");for(var t=s(e.length),r=s(16),i=0;i<e.length;i+=16){o(e,r,0,i,i+16);for(var a=0;a<16;a++)r[a]^=this._lastCipherblock[a];this._lastCipherblock=this._aes.encrypt(r),o(this._lastCipherblock,t,i)}return t},I.prototype.decrypt=function(e){if((e=n(e)).length%16!=0)throw new Error("invalid ciphertext size (must be multiple of 16 bytes)");for(var t=s(e.length),r=s(16),i=0;i<e.length;i+=16){o(e,r,0,i,i+16),r=this._aes.decrypt(r);for(var a=0;a<16;a++)t[i+a]=r[a]^this._lastCipherblock[a];o(e,this._lastCipherblock,0,i,i+16)}return t};var R=function(e,t,r){if(!(this instanceof R))throw Error("AES must be instanitated with `new`");if(this.description="Cipher Feedback",this.name="cfb",t){if(16!=t.length)throw new Error("invalid initialation vector size (must be 16 size)")}else t=s(16);r||(r=1),this.segmentSize=r,this._shiftRegister=n(t,!0),this._aes=new T(e)};R.prototype.encrypt=function(e){if(e.length%this.segmentSize!=0)throw new Error("invalid plaintext size (must be segmentSize bytes)");for(var t,r=n(e,!0),i=0;i<r.length;i+=this.segmentSize){t=this._aes.encrypt(this._shiftRegister);for(var s=0;s<this.segmentSize;s++)r[i+s]^=t[s];o(this._shiftRegister,this._shiftRegister,0,this.segmentSize),o(r,this._shiftRegister,16-this.segmentSize,i,i+this.segmentSize)}return r},R.prototype.decrypt=function(e){if(e.length%this.segmentSize!=0)throw new Error("invalid ciphertext size (must be segmentSize bytes)");for(var t,r=n(e,!0),i=0;i<r.length;i+=this.segmentSize){t=this._aes.encrypt(this._shiftRegister);for(var s=0;s<this.segmentSize;s++)r[i+s]^=t[s];o(this._shiftRegister,this._shiftRegister,0,this.segmentSize),o(e,this._shiftRegister,16-this.segmentSize,i,i+this.segmentSize)}return r};var x=function(e,t){if(!(this instanceof x))throw Error("AES must be instanitated with `new`");if(this.description="Output Feedback",this.name="ofb",t){if(16!=t.length)throw new Error("invalid initialation vector size (must be 16 bytes)")}else t=s(16);this._lastPrecipher=n(t,!0),this._lastPrecipherIndex=16,this._aes=new T(e)};x.prototype.encrypt=function(e){for(var t=n(e,!0),r=0;r<t.length;r++)16===this._lastPrecipherIndex&&(this._lastPrecipher=this._aes.encrypt(this._lastPrecipher),this._lastPrecipherIndex=0),t[r]^=this._lastPrecipher[this._lastPrecipherIndex++];return t},x.prototype.decrypt=x.prototype.encrypt;var B=function(e){if(!(this instanceof B))throw Error("Counter must be instanitated with `new`");0===e||e||(e=1),"number"==typeof e?(this._counter=s(16),this.setValue(e)):this.setBytes(e)};B.prototype.setValue=function(e){if("number"!=typeof e||parseInt(e)!=e)throw new Error("invalid counter value (must be an integer)");if(e>Number.MAX_SAFE_INTEGER)throw new Error("integer value out of safe range");for(var t=15;t>=0;--t)this._counter[t]=e%256,e=parseInt(e/256)},B.prototype.setBytes=function(e){if(16!=(e=n(e,!0)).length)throw new Error("invalid counter bytes size (must be 16 bytes)");this._counter=e},B.prototype.increment=function(){for(var e=15;e>=0;e--){if(255!==this._counter[e]){this._counter[e]++;break}this._counter[e]=0}};var O=function(e,t){if(!(this instanceof O))throw Error("AES must be instanitated with `new`");this.description="Counter",this.name="ctr",t instanceof B||(t=new B(t)),this._counter=t,this._remainingCounter=null,this._remainingCounterIndex=16,this._aes=new T(e)};O.prototype.encrypt=function(e){for(var t=n(e,!0),r=0;r<t.length;r++)16===this._remainingCounterIndex&&(this._remainingCounter=this._aes.encrypt(this._counter._counter),this._remainingCounterIndex=0,this._counter.increment()),t[r]^=this._remainingCounter[this._remainingCounterIndex++];return t},O.prototype.decrypt=O.prototype.encrypt;var M={AES:T,Counter:B,ModeOfOperation:{ecb:P,cbc:I,cfb:R,ofb:x,ctr:O},utils:{hex:u,utf8:c},padding:{pkcs7:{pad:function(e){var t=16-(e=n(e,!0)).length%16,r=s(e.length+t);o(e,r);for(var i=e.length;i<r.length;i++)r[i]=t;return r},strip:function(e){if((e=n(e,!0)).length<16)throw new Error("PKCS#7 invalid length");var t=e[e.length-1];if(t>16)throw new Error("PKCS#7 padding byte out of range");for(var r=e.length-t,i=0;i<t;i++)if(e[r+i]!==t)throw new Error("PKCS#7 invalid padding byte");var a=s(r);return o(e,a,0,0,r),a}}},_arrayTest:{coerceArray:n,createArray:s,copyArray:o}};e.exports=M}()},295:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Any:()=>dt,BaseBlock:()=>I,BaseStringBlock:()=>x,BitString:()=>Ce,BmpString:()=>$e,Boolean:()=>Se,CharacterString:()=>it,Choice:()=>lt,Constructed:()=>me,DATE:()=>ot,DateTime:()=>ct,Duration:()=>ut,EndOfContent:()=>be,Enumerated:()=>xe,GeneralString:()=>rt,GeneralizedTime:()=>st,GraphicString:()=>et,HexBlock:()=>A,IA5String:()=>Qe,Integer:()=>Re,Null:()=>ve,NumericString:()=>Je,ObjectIdentifier:()=>Me,OctetString:()=>Ae,Primitive:()=>le,PrintableString:()=>Ye,RawData:()=>pt,RelativeObjectIdentifier:()=>Le,Repeated:()=>ft,Sequence:()=>Ue,Set:()=>je,TIME:()=>ht,TeletexString:()=>Ze,TimeOfDay:()=>at,UTCTime:()=>nt,UniversalString:()=>Ge,Utf8String:()=>Fe,ValueBlock:()=>C,VideotexString:()=>Xe,ViewWriter:()=>l,VisibleString:()=>tt,compareSchema:()=>yt,fromBER:()=>pe,verifySchema:()=>mt});var i=r(9715);function n(e,t){let r=0;if(1===e.length)return e[0];for(let i=e.length-1;i>=0;i--)r+=e[e.length-1-i]*Math.pow(2,t*i);return r}function s(e,t,r=-1){const i=r;let n=e,s=0,o=Math.pow(2,t);for(let r=1;r<8;r++){if(e<o){let e;if(i<0)e=new ArrayBuffer(r),s=r;else{if(i<r)return new ArrayBuffer(0);e=new ArrayBuffer(i),s=i}const o=new Uint8Array(e);for(let e=r-1;e>=0;e--){const r=Math.pow(2,e*t);o[s-e-1]=Math.floor(n/r),n-=o[s-e-1]*r}return e}o*=Math.pow(2,t)}return new ArrayBuffer(0)}function o(...e){let t=0,r=0;for(const r of e)t+=r.length;const i=new ArrayBuffer(t),n=new Uint8Array(i);for(const t of e)n.set(t,r),r+=t.length;return n}function a(){const e=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const t=255===e[0]&&128&e[1],r=0===e[0]&&0==(128&e[1]);(t||r)&&this.warnings.push("Needlessly long format")}const t=new ArrayBuffer(this.valueHex.byteLength),r=new Uint8Array(t);for(let e=0;e<this.valueHex.byteLength;e++)r[e]=0;r[0]=128&e[0];const i=n(r,8),s=new ArrayBuffer(this.valueHex.byteLength),o=new Uint8Array(s);for(let t=0;t<this.valueHex.byteLength;t++)o[t]=e[t];o[0]&=127;return n(o,8)-i}function c(e,t){const r=e.toString(10);if(t<r.length)return"";const i=t-r.length,n=new Array(i);for(let e=0;e<i;e++)n[e]="0";return n.join("").concat(r)}Math.log(2);function u(){if("undefined"==typeof BigInt)throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function h(e){let t=0,r=0;for(let r=0;r<e.length;r++){t+=e[r].byteLength}const i=new Uint8Array(t);for(let t=0;t<e.length;t++){const n=e[t];i.set(new Uint8Array(n),r),r+=n.byteLength}return i.buffer}function d(e,t,r,i){return t instanceof Uint8Array?t.byteLength?r<0?(e.error="Wrong parameter: inputOffset less than zero",!1):i<0?(e.error="Wrong parameter: inputLength less than zero",!1):!(t.byteLength-r-i<0)||(e.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):(e.error="Wrong parameter: inputBuffer has zero length",!1):(e.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class l{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return h(this.items)}}const f=[new Uint8Array([1])],p="0123456789",y="name",m="valueHexView",g="",b=new ArrayBuffer(0),v=new Uint8Array(0),w="EndOfContent",S="OCTET STRING",_="BIT STRING";function A(e){var t;return(t=class extends e{constructor(...e){var t;super(...e);const r=e[0]||{};this.isHexOnly=null!==(t=r.isHexOnly)&&void 0!==t&&t,this.valueHexView=r.valueHex?i.vJ.toUint8Array(r.valueHex):v}get valueHex(){return this.valueHexView.slice().buffer}set valueHex(e){this.valueHexView=new Uint8Array(e)}fromBER(e,t,r){const i=e instanceof ArrayBuffer?new Uint8Array(e):e;if(!d(this,i,t,r))return-1;const n=t+r;return this.valueHexView=i.subarray(t,n),this.valueHexView.length?(this.blockLength=r,n):(this.warnings.push("Zero buffer length"),t)}toBER(e=!1){return this.isHexOnly?e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",b)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:i.ep.ToHex(this.valueHexView)}}}).NAME="hexBlock",t}class E{constructor({blockLength:e=0,error:t="",warnings:r=[],valueBeforeDecode:n=v}={}){this.blockLength=e,this.error=t,this.warnings=r,this.valueBeforeDecodeView=i.vJ.toUint8Array(n)}static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:i.ep.ToHex(this.valueBeforeDecodeView)}}}E.NAME="baseBlock";class C extends E{fromBER(e,t,r){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}C.NAME="valueBlock";class k extends(A(E)){constructor({idBlock:e={}}={}){var t,r,n,s;super(),e?(this.isHexOnly=null!==(t=e.isHexOnly)&&void 0!==t&&t,this.valueHexView=e.valueHex?i.vJ.toUint8Array(e.valueHex):v,this.tagClass=null!==(r=e.tagClass)&&void 0!==r?r:-1,this.tagNumber=null!==(n=e.tagNumber)&&void 0!==n?n:-1,this.isConstructed=null!==(s=e.isConstructed)&&void 0!==s&&s):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",b}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){const r=new Uint8Array(1);if(!e){let e=this.tagNumber;e&=31,t|=e,r[0]=t}return r.buffer}if(!this.isHexOnly){const r=s(this.tagNumber,7),i=new Uint8Array(r),n=r.byteLength,o=new Uint8Array(n+1);if(o[0]=31|t,!e){for(let e=0;e<n-1;e++)o[e+1]=128|i[e];o[n]=i[n-1]}return o.buffer}const r=new Uint8Array(this.valueHexView.byteLength+1);if(r[0]=31|t,!e){const e=this.valueHexView;for(let t=0;t<e.length-1;t++)r[t+1]=128|e[t];r[this.valueHexView.byteLength]=e[e.length-1]}return r.buffer}fromBER(e,t,r){const s=i.vJ.toUint8Array(e);if(!d(this,s,t,r))return-1;const o=s.subarray(t,t+r);if(0===o.length)return this.error="Zero buffer length",-1;switch(192&o[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=32==(32&o[0]),this.isHexOnly=!1;const a=31&o[0];if(31!==a)this.tagNumber=a,this.blockLength=1;else{let e=1,t=this.valueHexView=new Uint8Array(255),r=255;for(;128&o[e];){if(t[e-1]=127&o[e],e++,e>=o.length)return this.error="End of input reached before message was fully decoded",-1;if(e===r){r+=255;const e=new Uint8Array(r);for(let r=0;r<t.length;r++)e[r]=t[r];t=this.valueHexView=new Uint8Array(r)}}this.blockLength=e+1,t[e-1]=127&o[e];const i=new Uint8Array(e);for(let r=0;r<e;r++)i[r]=t[r];t=this.valueHexView=new Uint8Array(e),t.set(i),this.blockLength<=9?this.tagNumber=n(t,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}k.NAME="identificationBlock";class T extends E{constructor({lenBlock:e={}}={}){var t,r,i;super(),this.isIndefiniteForm=null!==(t=e.isIndefiniteForm)&&void 0!==t&&t,this.longFormUsed=null!==(r=e.longFormUsed)&&void 0!==r&&r,this.length=null!==(i=e.length)&&void 0!==i?i:0}fromBER(e,t,r){const s=i.vJ.toUint8Array(e);if(!d(this,s,t,r))return-1;const o=s.subarray(t,t+r);if(0===o.length)return this.error="Zero buffer length",-1;if(255===o[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===o[0],this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&o[0]),!1===this.longFormUsed)return this.length=o[0],this.blockLength=1,t+this.blockLength;const a=127&o[0];if(a>8)return this.error="Too big integer",-1;if(a+1>o.length)return this.error="End of input reached before message was fully decoded",-1;const c=t+1,u=s.subarray(c,c+a);return 0===u[a-1]&&this.warnings.push("Needlessly long encoded length"),this.length=n(u,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=a+1,t+this.blockLength}toBER(e=!1){let t,r;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),!1===e&&(r=new Uint8Array(t),r[0]=128),t;if(this.longFormUsed){const i=s(this.length,8);if(i.byteLength>127)return this.error="Too big length",b;if(t=new ArrayBuffer(i.byteLength+1),e)return t;const n=new Uint8Array(i);r=new Uint8Array(t),r[0]=128|i.byteLength;for(let e=0;e<i.byteLength;e++)r[e+1]=n[e];return t}return t=new ArrayBuffer(1),!1===e&&(r=new Uint8Array(t),r[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}T.NAME="lengthBlock";const P={};class I extends E{constructor({name:e="",optional:t=!1,primitiveSchema:r,...i}={},n){super(i),this.name=e,this.optional=t,r&&(this.primitiveSchema=r),this.idBlock=new k(i),this.lenBlock=new T(i),this.valueBlock=n?new n(i):new C(i)}fromBER(e,t,r){const i=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===i?(this.error=this.valueBlock.error,i):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}toBER(e,t){const r=t||new l;t||R(this);const i=this.idBlock.toBER(e);if(r.write(i),this.lenBlock.isIndefiniteForm)r.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,r),r.write(new ArrayBuffer(2));else{const t=this.valueBlock.toBER(e);this.lenBlock.length=t.byteLength;const i=this.lenBlock.toBER(e);r.write(i),r.write(t)}return t?b:r.final()}toJSON(){const e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return"ascii"===e?this.onAsciiEncoding():i.ep.ToHex(this.toBER())}onAsciiEncoding(){return`${this.constructor.NAME} : ${i.ep.ToHex(this.valueBlock.valueBeforeDecodeView)}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;return function(e,t){if(e.byteLength!==t.byteLength)return!1;const r=new Uint8Array(e),i=new Uint8Array(t);for(let e=0;e<r.length;e++)if(r[e]!==i[e])return!1;return!0}(this.toBER(),e.toBER())}}function R(e){if(e instanceof P.Constructed)for(const t of e.valueBlock.value)R(t)&&(e.lenBlock.isIndefiniteForm=!0);return!!e.lenBlock.isIndefiniteForm}I.NAME="BaseBlock";class x extends I{constructor({value:e="",...t}={},r){super(t,r),e&&this.fromString(e)}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}fromBER(e,t,r){const i=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===i?(this.error=this.valueBlock.error,i):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}x.NAME="BaseStringBlock";class B extends(A(C)){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}var O,M,N,D,L,U,j,q,K,H,z,F,V,$,W,G,J,Y,Z,X,Q,ee,te,re,ie,ne,se,oe,ae,ce,ue,he,de;B.NAME="PrimitiveValueBlock";class le extends I{constructor(e={}){super(e,B),this.idBlock.isConstructed=!1}}function fe(e,t=0,r=e.length){const i=t;let n=new I({},C);const s=new E;if(!d(s,e,t,r))return n.error=s.error,{offset:-1,result:n};if(!e.subarray(t,t+r).length)return n.error="Zero buffer length",{offset:-1,result:n};let o=n.idBlock.fromBER(e,t,r);if(n.idBlock.warnings.length&&n.warnings.concat(n.idBlock.warnings),-1===o)return n.error=n.idBlock.error,{offset:-1,result:n};if(t=o,r-=n.idBlock.blockLength,o=n.lenBlock.fromBER(e,t,r),n.lenBlock.warnings.length&&n.warnings.concat(n.lenBlock.warnings),-1===o)return n.error=n.lenBlock.error,{offset:-1,result:n};if(t=o,r-=n.lenBlock.blockLength,!n.idBlock.isConstructed&&n.lenBlock.isIndefiniteForm)return n.error="Indefinite length form used for primitive encoding form",{offset:-1,result:n};let a=I;if(1===n.idBlock.tagClass){if(n.idBlock.tagNumber>=37&&!1===n.idBlock.isHexOnly)return n.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:n};switch(n.idBlock.tagNumber){case 0:if(n.idBlock.isConstructed&&n.lenBlock.length>0)return n.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:n};a=P.EndOfContent;break;case 1:a=P.Boolean;break;case 2:a=P.Integer;break;case 3:a=P.BitString;break;case 4:a=P.OctetString;break;case 5:a=P.Null;break;case 6:a=P.ObjectIdentifier;break;case 10:a=P.Enumerated;break;case 12:a=P.Utf8String;break;case 13:a=P.RelativeObjectIdentifier;break;case 14:a=P.TIME;break;case 15:return n.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:n};case 16:a=P.Sequence;break;case 17:a=P.Set;break;case 18:a=P.NumericString;break;case 19:a=P.PrintableString;break;case 20:a=P.TeletexString;break;case 21:a=P.VideotexString;break;case 22:a=P.IA5String;break;case 23:a=P.UTCTime;break;case 24:a=P.GeneralizedTime;break;case 25:a=P.GraphicString;break;case 26:a=P.VisibleString;break;case 27:a=P.GeneralString;break;case 28:a=P.UniversalString;break;case 29:a=P.CharacterString;break;case 30:a=P.BmpString;break;case 31:a=P.DATE;break;case 32:a=P.TimeOfDay;break;case 33:a=P.DateTime;break;case 34:a=P.Duration;break;default:{const e=n.idBlock.isConstructed?new P.Constructed:new P.Primitive;e.idBlock=n.idBlock,e.lenBlock=n.lenBlock,e.warnings=n.warnings,n=e}}}else a=n.idBlock.isConstructed?P.Constructed:P.Primitive;return n=function(e,t){if(e instanceof t)return e;const r=new t;return r.idBlock=e.idBlock,r.lenBlock=e.lenBlock,r.warnings=e.warnings,r.valueBeforeDecodeView=e.valueBeforeDecodeView,r}(n,a),o=n.fromBER(e,t,n.lenBlock.isIndefiniteForm?r:n.lenBlock.length),n.valueBeforeDecodeView=e.subarray(i,i+n.blockLength),{offset:o,result:n}}function pe(e){if(!e.byteLength){const e=new I({},C);return e.error="Input buffer has zero length",{offset:-1,result:e}}return fe(i.vJ.toUint8Array(e).slice(),0,e.byteLength)}O=le,P.Primitive=O,le.NAME="PRIMITIVE";class ye extends C{constructor({value:e=[],isIndefiniteForm:t=!1,...r}={}){super(r),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,r){const n=i.vJ.toUint8Array(e);if(!d(this,n,t,r))return-1;if(this.valueBeforeDecodeView=n.subarray(t,t+r),0===this.valueBeforeDecodeView.length)return this.warnings.push("Zero buffer length"),t;let s=t;for(;o=this.isIndefiniteForm,a=r,(o?1:a)>0;){const e=fe(n,s,r);if(-1===e.offset)return this.error=e.result.error,this.warnings.concat(e.result.warnings),-1;if(s=e.offset,this.blockLength+=e.result.blockLength,r-=e.result.blockLength,this.value.push(e.result),this.isIndefiniteForm&&e.result.constructor.NAME===w)break}var o,a;return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===w?this.value.pop():this.warnings.push("No EndOfContent block encoded")),s}toBER(e,t){const r=t||new l;for(let t=0;t<this.value.length;t++)this.value[t].toBER(e,r);return t?b:r.final()}toJSON(){const e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const t of this.value)e.value.push(t.toJSON());return e}}ye.NAME="ConstructedValueBlock";class me extends I{constructor(e={}){super(e,ye),this.idBlock.isConstructed=!0}fromBER(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const i=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===i?(this.error=this.valueBlock.error,i):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}onAsciiEncoding(){const e=[];for(const t of this.valueBlock.value)e.push(t.toString("ascii").split("\n").map((e=>`  ${e}`)).join("\n"));const t=3===this.idBlock.tagClass?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :\n${e.join("\n")}`:`${t} :`}}M=me,P.Constructed=M,me.NAME="CONSTRUCTED";class ge extends C{fromBER(e,t,r){return t}toBER(e){return b}}ge.override="EndOfContentValueBlock";class be extends I{constructor(e={}){super(e,ge),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}N=be,P.EndOfContent=N,be.NAME=w;class ve extends I{constructor(e={}){super(e,C),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}toBER(e,t){const r=new ArrayBuffer(2);if(!e){const e=new Uint8Array(r);e[0]=5,e[1]=0}return t&&t.write(r),r}onAsciiEncoding(){return`${this.constructor.NAME}`}}D=ve,P.Null=D,ve.NAME="NULL";class we extends(A(C)){constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=i.vJ.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}get value(){for(const e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}fromBER(e,t,r){const n=i.vJ.toUint8Array(e);return d(this,n,t,r)?(this.valueHexView=n.subarray(t,t+r),r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,a.call(this),this.blockLength=r,t+r):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}we.NAME="BooleanValueBlock";class Se extends I{constructor(e={}){super(e,we),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}}L=Se,P.Boolean=L,Se.NAME="BOOLEAN";class _e extends(A(ye)){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,r){let i=0;if(this.isConstructed){if(this.isHexOnly=!1,i=ye.prototype.fromBER.call(this,e,t,r),-1===i)return i;for(let e=0;e<this.value.length;e++){const t=this.value[e].constructor.NAME;if(t===w){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(t!==S)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,i=super.fromBER(e,t,r),this.blockLength=r;return i}toBER(e,t){return this.isConstructed?ye.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}_e.NAME="OctetStringValueBlock";class Ae extends I{constructor({idBlock:e={},lenBlock:t={},...r}={}){var i,n;null!==(i=r.isConstructed)&&void 0!==i||(r.isConstructed=!!(null===(n=r.value)||void 0===n?void 0:n.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},_e),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,r){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===r)return 0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){const i=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+r);try{if(i.byteLength){const e=fe(i,0,i.byteLength);-1!==e.offset&&e.offset===r&&(this.valueBlock.value=[e.result])}}catch(e){}}return super.fromBER(e,t,r)}onAsciiEncoding(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?me.prototype.onAsciiEncoding.call(this):`${this.constructor.NAME} : ${i.ep.ToHex(this.valueBlock.valueHexView)}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const e=[];for(const t of this.valueBlock.value)t instanceof Ae&&e.push(t.valueBlock.valueHexView);return i.vJ.concat(e)}}U=Ae,P.OctetString=U,Ae.NAME=S;class Ee extends(A(ye)){constructor({unusedBits:e=0,isConstructed:t=!1,...r}={}){super(r),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,r){if(!r)return t;let n=-1;if(this.isConstructed){if(n=ye.prototype.fromBER.call(this,e,t,r),-1===n)return n;for(const e of this.value){const t=e.constructor.NAME;if(t===w){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(t!==_)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const r=e.valueBlock;if(this.unusedBits>0&&r.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=r.unusedBits}return n}const s=i.vJ.toUint8Array(e);if(!d(this,s,t,r))return-1;const o=s.subarray(t,t+r);if(this.unusedBits=o[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const e=o.subarray(1);try{if(e.byteLength){const t=fe(e,0,e.byteLength);-1!==t.offset&&t.offset===r-1&&(this.value=[t.result])}}catch(e){}}return this.valueHexView=o.subarray(1),this.blockLength=o.length,t+r}toBER(e,t){if(this.isConstructed)return ye.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return b;const r=new Uint8Array(this.valueHexView.length+1);return r[0]=this.unusedBits,r.set(this.valueHexView,1),r.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}Ee.NAME="BitStringValueBlock";class Ce extends I{constructor({idBlock:e={},lenBlock:t={},...r}={}){var i,n;null!==(i=r.isConstructed)&&void 0!==i||(r.isConstructed=!!(null===(n=r.value)||void 0===n?void 0:n.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},Ee),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,r){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,r)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return me.prototype.onAsciiEncoding.call(this);{const e=[],t=this.valueBlock.valueHexView;for(const r of t)e.push(r.toString(2).padStart(8,"0"));const r=e.join("");return`${this.constructor.NAME} : ${r.substring(0,r.length-this.valueBlock.unusedBits)}`}}}function ke(e,t){const r=new Uint8Array([0]),i=new Uint8Array(e),n=new Uint8Array(t);let s=i.slice(0);const a=s.length-1,c=n.slice(0),u=c.length-1;let h=0;let d=0;for(let e=u<a?a:u;e>=0;e--,d++){if(!0==d<c.length)h=s[a-d]+c[u-d]+r[0];else h=s[a-d]+r[0];if(r[0]=h/10,!0==d>=s.length)s=o(new Uint8Array([h%10]),s);else s[a-d]=h%10}return r[0]>0&&(s=o(r,s)),s}function Te(e){if(e>=f.length)for(let t=f.length;t<=e;t++){const e=new Uint8Array([0]);let r=f[t-1].slice(0);for(let t=r.length-1;t>=0;t--){const i=new Uint8Array([(r[t]<<1)+e[0]]);e[0]=i[0]/10,r[t]=i[0]%10}e[0]>0&&(r=o(e,r)),f.push(r)}return f[e]}function Pe(e,t){let r=0;const i=new Uint8Array(e),n=new Uint8Array(t),s=i.slice(0),o=s.length-1,a=n.slice(0),c=a.length-1;let u,h=0;for(let e=c;e>=0;e--,h++)if(u=s[o-h]-a[c-h]-r,!0==u<0)r=1,s[o-h]=u+10;else r=0,s[o-h]=u;if(r>0)for(let e=o-c+1;e>=0;e--,h++){if(u=s[o-h]-r,!(u<0)){r=0,s[o-h]=u;break}r=1,s[o-h]=u+10}return s.slice()}j=Ce,P.BitString=j,Ce.NAME=_;class Ie extends(A(C)){constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),void 0!==e&&(this.valueDec=e)}setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=a.call(this)))}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(function(e){const t=e<0?-1*e:e;let r=128;for(let i=1;i<8;i++){if(t<=r){if(e<0){const e=s(r-t,8,i);return new Uint8Array(e)[0]|=128,e}let n=s(t,8,i),o=new Uint8Array(n);if(128&o[0]){const e=n.slice(0),t=new Uint8Array(e);n=new ArrayBuffer(n.byteLength+1),o=new Uint8Array(n);for(let r=0;r<e.byteLength;r++)o[r+1]=t[r];o[0]=0}return n}r*=Math.pow(2,8)}return new ArrayBuffer(0)}(e))}get valueDec(){return this._valueDec}fromDER(e,t,r,i=0){const n=this.fromBER(e,t,r);if(-1===n)return n;const s=this.valueHexView;return 0===s[0]&&0!=(128&s[1])?this.valueHexView=s.subarray(1):0!==i&&s.length<i&&(i-s.length>1&&(i=s.length+1),this.valueHexView=s.subarray(i-s.length)),n}toDER(e=!1){const t=this.valueHexView;switch(!0){case 0!=(128&t[0]):{const e=new Uint8Array(this.valueHexView.length+1);e[0]=0,e.set(t,1),this.valueHexView=e}break;case 0===t[0]&&0==(128&t[1]):this.valueHexView=this.valueHexView.subarray(1)}return this.toBER(e)}fromBER(e,t,r){const i=super.fromBER(e,t,r);return-1===i||this.setValueHex(),i}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const e=8*this.valueHexView.length-1;let t,r=new Uint8Array(8*this.valueHexView.length/3),i=0;const n=this.valueHexView;let s="",o=!1;for(let o=n.byteLength-1;o>=0;o--){t=n[o];for(let n=0;n<8;n++){if(1==(1&t))if(i===e)r=Pe(Te(i),r),s="-";else r=ke(r,Te(i));i++,t>>=1}}for(let e=0;e<r.length;e++)r[e]&&(o=!0),o&&(s+=p.charAt(r[e]));return!1===o&&(s+=p.charAt(0)),s}}q=Ie,Ie.NAME="IntegerValueBlock",Object.defineProperty(q.prototype,"valueHex",{set:function(e){this.valueHexView=new Uint8Array(e),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});class Re extends I{constructor(e={}){super(e,Ie),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return u(),BigInt(this.valueBlock.toString())}static fromBigInt(e){u();const t=BigInt(e),r=new l,n=t.toString(16).replace(/^-/,""),s=new Uint8Array(i.ep.FromHex(n));if(t<0){const e=new Uint8Array(s.length+(128&s[0]?1:0));e[0]|=128;const n=BigInt(`0x${i.ep.ToHex(e)}`)+t,o=i.vJ.toUint8Array(i.ep.FromHex(n.toString(16)));o[0]|=128,r.write(o)}else 128&s[0]&&r.write(new Uint8Array([0])),r.write(s);return new Re({valueHex:r.final()})}convertToDER(){const e=new Re({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new Re({valueHex:0===this.valueBlock.valueHexView[0]?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}K=Re,P.Integer=K,Re.NAME="INTEGER";class xe extends Re{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}H=xe,P.Enumerated=H,xe.NAME="ENUMERATED";class Be extends(A(C)){constructor({valueDec:e=-1,isFirstSid:t=!1,...r}={}){super(r),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,r){if(!r)return t;const s=i.vJ.toUint8Array(e);if(!d(this,s,t,r))return-1;const o=s.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let e=0;e<r&&(this.valueHexView[e]=127&o[e],this.blockLength++,0!=(128&o[e]));e++);const a=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength;e++)a[e]=this.valueHexView[e];return this.valueHexView=a,0!=(128&o[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=n(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){u();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const r=new Uint8Array(t.length/7);for(let e=0;e<r.length;e++)r[e]=parseInt(t.slice(7*e,7*e+7),2)+(e+1<r.length?128:0);this.fromBER(r.buffer,0,r.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const t=this.valueHexView,r=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength-1;e++)r[e]=128|t[e];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}const t=s(this.valueDec,7);if(0===t.byteLength)return this.error="Error during encoding SID value",b;const r=new Uint8Array(t.byteLength);if(!e){const e=new Uint8Array(t),i=t.byteLength-1;for(let t=0;t<i;t++)r[t]=128|e[t];r[i]=e[i]}return r}toString(){let e="";if(this.isHexOnly)e=i.ep.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}Be.NAME="sidBlock";class Oe extends C{constructor({value:e="",...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let i=t;for(;r>0;){const t=new Be;if(i=t.fromBER(e,i,r),-1===i)return this.blockLength=0,this.error=t.error,i;0===this.value.length&&(t.isFirstSid=!0),this.blockLength+=t.blockLength,r-=t.blockLength,this.value.push(t)}return i}toBER(e){const t=[];for(let r=0;r<this.value.length;r++){const i=this.value[r].toBER(e);if(0===i.byteLength)return this.error=this.value[r].error,b;t.push(i)}return h(t)}fromString(e){this.value=[];let t=0,r=0,i="",n=!1;do{if(r=e.indexOf(".",t),i=-1===r?e.substring(t):e.substring(t,r),t=r+1,n){const e=this.value[0];let t=0;switch(e.valueDec){case 0:break;case 1:t=40;break;case 2:t=80;break;default:return void(this.value=[])}const r=parseInt(i,10);if(isNaN(r))return;e.valueDec=r+t,n=!1}else{const e=new Be;if(i>Number.MAX_SAFE_INTEGER){u();const t=BigInt(i);e.valueBigInt=t}else if(e.valueDec=parseInt(i,10),isNaN(e.valueDec))return;this.value.length||(e.isFirstSid=!0,n=!0),this.value.push(e)}}while(-1!==r)}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let i=this.value[r].toString();0!==r&&(e=`${e}.`),t?(i=`{${i}}`,this.value[r].isFirstSid?e=`2.{${i} - 80}`:e+=i):e+=i}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}Oe.NAME="ObjectIdentifierValueBlock";class Me extends I{constructor(e={}){super(e,Oe),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}z=Me,P.ObjectIdentifier=z,Me.NAME="OBJECT IDENTIFIER";class Ne extends(A(E)){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,r){if(0===r)return t;const s=i.vJ.toUint8Array(e);if(!d(this,s,t,r))return-1;const o=s.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let e=0;e<r&&(this.valueHexView[e]=127&o[e],this.blockLength++,0!=(128&o[e]));e++);const a=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength;e++)a[e]=this.valueHexView[e];return this.valueHexView=a,0!=(128&o[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=n(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const t=this.valueHexView,r=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength-1;e++)r[e]=128|t[e];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}const t=s(this.valueDec,7);if(0===t.byteLength)return this.error="Error during encoding SID value",b;const r=new Uint8Array(t.byteLength);if(!e){const e=new Uint8Array(t),i=t.byteLength-1;for(let t=0;t<i;t++)r[t]=128|e[t];r[i]=e[i]}return r.buffer}toString(){let e="";return e=this.isHexOnly?i.ep.ToHex(this.valueHexView):this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}Ne.NAME="relativeSidBlock";class De extends C{constructor({value:e="",...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let i=t;for(;r>0;){const t=new Ne;if(i=t.fromBER(e,i,r),-1===i)return this.blockLength=0,this.error=t.error,i;this.blockLength+=t.blockLength,r-=t.blockLength,this.value.push(t)}return i}toBER(e,t){const r=[];for(let t=0;t<this.value.length;t++){const i=this.value[t].toBER(e);if(0===i.byteLength)return this.error=this.value[t].error,b;r.push(i)}return h(r)}fromString(e){this.value=[];let t=0,r=0,i="";do{r=e.indexOf(".",t),i=-1===r?e.substring(t):e.substring(t,r),t=r+1;const n=new Ne;if(n.valueDec=parseInt(i,10),isNaN(n.valueDec))return!0;this.value.push(n)}while(-1!==r);return!0}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let i=this.value[r].toString();0!==r&&(e=`${e}.`),t?(i=`{${i}}`,e+=i):e+=i}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}De.NAME="RelativeObjectIdentifierValueBlock";class Le extends I{constructor(e={}){super(e,De),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}F=Le,P.RelativeObjectIdentifier=F,Le.NAME="RelativeObjectIdentifier";class Ue extends me{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}V=Ue,P.Sequence=V,Ue.NAME="SEQUENCE";class je extends me{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}}$=je,P.Set=$,je.NAME="SET";class qe extends(A(C)){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=g}toJSON(){return{...super.toJSON(),value:this.value}}}qe.NAME="StringValueBlock";class Ke extends qe{}Ke.NAME="SimpleStringValueBlock";class He extends x{constructor({...e}={}){super(e,Ke)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,i.vJ.toUint8Array(e))}fromString(e){const t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(t);for(let i=0;i<t;i++)r[i]=e.charCodeAt(i);this.valueBlock.value=e}}He.NAME="SIMPLE STRING";class ze extends He{fromBuffer(e){this.valueBlock.valueHexView=i.vJ.toUint8Array(e);try{this.valueBlock.value=i.ep.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=i.ep.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(i.ep.FromUtf8String(e)),this.valueBlock.value=e}}ze.NAME="Utf8StringValueBlock";class Fe extends ze{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}W=Fe,P.Utf8String=W,Fe.NAME="UTF8String";class Ve extends He{fromBuffer(e){this.valueBlock.value=i.ep.ToUtf16String(e),this.valueBlock.valueHexView=i.vJ.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(i.ep.FromUtf16String(e))}}Ve.NAME="BmpStringValueBlock";class $e extends Ve{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}G=$e,P.BmpString=G,$e.NAME="BMPString";class We extends He{fromBuffer(e){const t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),r=new Uint8Array(t);for(let e=0;e<r.length;e+=4)r[e]=r[e+3],r[e+1]=r[e+2],r[e+2]=0,r[e+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(4*t);for(let i=0;i<t;i++){const t=s(e.charCodeAt(i),8),n=new Uint8Array(t);if(n.length>4)continue;const o=4-n.length;for(let e=n.length-1;e>=0;e--)r[4*i+e+o]=n[e]}this.valueBlock.value=e}}We.NAME="UniversalStringValueBlock";class Ge extends We{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}J=Ge,P.UniversalString=J,Ge.NAME="UniversalString";class Je extends He{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}Y=Je,P.NumericString=Y,Je.NAME="NumericString";class Ye extends He{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}Z=Ye,P.PrintableString=Z,Ye.NAME="PrintableString";class Ze extends He{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}X=Ze,P.TeletexString=X,Ze.NAME="TeletexString";class Xe extends He{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}Q=Xe,P.VideotexString=Q,Xe.NAME="VideotexString";class Qe extends He{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}ee=Qe,P.IA5String=ee,Qe.NAME="IA5String";class et extends He{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}te=et,P.GraphicString=te,et.NAME="GraphicString";class tt extends He{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}re=tt,P.VisibleString=re,tt.NAME="VisibleString";class rt extends He{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}ie=rt,P.GeneralString=ie,rt.NAME="GeneralString";class it extends He{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}ne=it,P.CharacterString=ne,it.NAME="CharacterString";class nt extends tt{constructor({value:e,valueDate:t,...r}={}){if(super(r),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let t=0;t<e.length;t++)this.valueBlock.valueHexView[t]=e.charCodeAt(t)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,i.vJ.toUint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){const t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi.exec(e);if(null===t)return void(this.error="Wrong input string for conversion");const r=parseInt(t[1],10);this.year=r>=50?1900+r:2e3+r,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}toString(e="iso"){if("iso"===e){const e=new Array(7);return e[0]=c(this.year<2e3?this.year-1900:this.year-2e3,2),e[1]=c(this.month,2),e[2]=c(this.day,2),e[3]=c(this.hour,2),e[4]=c(this.minute,2),e[5]=c(this.second,2),e[6]="Z",e.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}se=nt,P.UTCTime=se,nt.NAME="UTCTime";class st extends nt{constructor(e={}){var t;super(e),null!==(t=this.millisecond)&&void 0!==t||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}fromString(e){let t,r=!1,i="",n="",s=0,o=0,a=0;if("Z"===e[e.length-1])i=e.substring(0,e.length-1),r=!0;else{const t=new Number(e[e.length-1]);if(isNaN(t.valueOf()))throw new Error("Wrong input string for conversion");i=e}if(r){if(-1!==i.indexOf("+"))throw new Error("Wrong input string for conversion");if(-1!==i.indexOf("-"))throw new Error("Wrong input string for conversion")}else{let e=1,t=i.indexOf("+"),r="";if(-1===t&&(t=i.indexOf("-"),e=-1),-1!==t){if(r=i.substring(t+1),i=i.substring(0,t),2!==r.length&&4!==r.length)throw new Error("Wrong input string for conversion");let n=parseInt(r.substring(0,2),10);if(isNaN(n.valueOf()))throw new Error("Wrong input string for conversion");if(o=e*n,4===r.length){if(n=parseInt(r.substring(2,4),10),isNaN(n.valueOf()))throw new Error("Wrong input string for conversion");a=e*n}}}let c=i.indexOf(".");if(-1===c&&(c=i.indexOf(",")),-1!==c){const e=new Number(`0${i.substring(c)}`);if(isNaN(e.valueOf()))throw new Error("Wrong input string for conversion");s=e.valueOf(),n=i.substring(0,c)}else n=i;switch(!0){case 8===n.length:if(t=/(\d{4})(\d{2})(\d{2})/gi,-1!==c)throw new Error("Wrong input string for conversion");break;case 10===n.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})/gi,-1!==c){let e=60*s;this.minute=Math.floor(e),e=60*(e-this.minute),this.second=Math.floor(e),e=1e3*(e-this.second),this.millisecond=Math.floor(e)}break;case 12===n.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==c){let e=60*s;this.second=Math.floor(e),e=1e3*(e-this.second),this.millisecond=Math.floor(e)}break;case 14===n.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==c){const e=1e3*s;this.millisecond=Math.floor(e)}break;default:throw new Error("Wrong input string for conversion")}const u=t.exec(n);if(null===u)throw new Error("Wrong input string for conversion");for(let e=1;e<u.length;e++)switch(e){case 1:this.year=parseInt(u[e],10);break;case 2:this.month=parseInt(u[e],10);break;case 3:this.day=parseInt(u[e],10);break;case 4:this.hour=parseInt(u[e],10)+o;break;case 5:this.minute=parseInt(u[e],10)+a;break;case 6:this.second=parseInt(u[e],10);break;default:throw new Error("Wrong input string for conversion")}if(!1===r){const e=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=e.getUTCFullYear(),this.month=e.getUTCMonth(),this.day=e.getUTCDay(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds(),this.millisecond=e.getUTCMilliseconds()}}toString(e="iso"){if("iso"===e){const e=[];return e.push(c(this.year,4)),e.push(c(this.month,2)),e.push(c(this.day,2)),e.push(c(this.hour,2)),e.push(c(this.minute,2)),e.push(c(this.second,2)),0!==this.millisecond&&(e.push("."),e.push(c(this.millisecond,3))),e.push("Z"),e.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}oe=st,P.GeneralizedTime=oe,st.NAME="GeneralizedTime";class ot extends Fe{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}ae=ot,P.DATE=ae,ot.NAME="DATE";class at extends Fe{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}ce=at,P.TimeOfDay=ce,at.NAME="TimeOfDay";class ct extends Fe{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}ue=ct,P.DateTime=ue,ct.NAME="DateTime";class ut extends Fe{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}he=ut,P.Duration=he,ut.NAME="Duration";class ht extends Fe{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}de=ht,P.TIME=de,ht.NAME="TIME";class dt{constructor({name:e="",optional:t=!1}={}){this.name=e,this.optional=t}}class lt extends dt{constructor({value:e=[],...t}={}){super(t),this.value=e}}class ft extends dt{constructor({value:e=new dt,local:t=!1,...r}={}){super(r),this.value=e,this.local=t}}class pt{constructor({data:e=v}={}){this.dataView=i.vJ.toUint8Array(e)}get data(){return this.dataView.slice().buffer}set data(e){this.dataView=i.vJ.toUint8Array(e)}fromBER(e,t,r){const n=t+r;return this.dataView=i.vJ.toUint8Array(e).subarray(t,n),n}toBER(e){return this.dataView.slice().buffer}}function yt(e,t,r){if(r instanceof lt){for(let i=0;i<r.value.length;i++){if(yt(e,t,r.value[i]).verified)return{verified:!0,result:e}}{const e={verified:!1,result:{error:"Wrong values for Choice type"}};return r.hasOwnProperty(y)&&(e.name=r.name),e}}if(r instanceof dt)return r.hasOwnProperty(y)&&(e[r.name]=t),{verified:!0,result:e};if(e instanceof Object==!1)return{verified:!1,result:{error:"Wrong root object"}};if(t instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(r instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("idBlock"in r==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("fromBER"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("toBER"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const i=r.idBlock.toBER(!1);if(0===i.byteLength)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(-1===r.idBlock.fromBER(i,0,i.byteLength))return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(!1===r.idBlock.hasOwnProperty("tagClass"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagClass!==t.idBlock.tagClass)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("tagNumber"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagNumber!==t.idBlock.tagNumber)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("isConstructed"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isConstructed!==t.idBlock.isConstructed)return{verified:!1,result:e};if(!("isHexOnly"in r.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isHexOnly!==t.idBlock.isHexOnly)return{verified:!1,result:e};if(r.idBlock.isHexOnly){if(m in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const i=r.idBlock.valueHexView,n=t.idBlock.valueHexView;if(i.length!==n.length)return{verified:!1,result:e};for(let t=0;t<i.length;t++)if(i[t]!==n[1])return{verified:!1,result:e}}if(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,g),r.name&&(e[r.name]=t)),r instanceof P.Constructed){let i=0,n={verified:!1,result:{error:"Unknown error"}},s=r.valueBlock.value.length;if(s>0&&r.valueBlock.value[0]instanceof ft&&(s=t.valueBlock.value.length),0===s)return{verified:!0,result:e};if(0===t.valueBlock.value.length&&0!==r.valueBlock.value.length){let t=!0;for(let e=0;e<r.valueBlock.value.length;e++)t=t&&(r.valueBlock.value[e].optional||!1);return t?{verified:!0,result:e}:(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,g),r.name&&delete e[r.name]),e.error="Inconsistent object length",{verified:!1,result:e})}for(let o=0;o<s;o++)if(o-i>=t.valueBlock.value.length){if(!1===r.valueBlock.value[o].optional){const t={verified:!1,result:e};return e.error="Inconsistent length between ASN.1 data and schema",r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,g),r.name&&(delete e[r.name],t.name=r.name)),t}}else if(r.valueBlock.value[0]instanceof ft){if(n=yt(e,t.valueBlock.value[o],r.valueBlock.value[0].value),!1===n.verified){if(!r.valueBlock.value[0].optional)return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,g),r.name&&delete e[r.name]),n;i++}if(y in r.valueBlock.value[0]&&r.valueBlock.value[0].name.length>0){let i={};i="local"in r.valueBlock.value[0]&&r.valueBlock.value[0].local?t:e,void 0===i[r.valueBlock.value[0].name]&&(i[r.valueBlock.value[0].name]=[]),i[r.valueBlock.value[0].name].push(t.valueBlock.value[o])}}else if(n=yt(e,t.valueBlock.value[o-i],r.valueBlock.value[o]),!1===n.verified){if(!r.valueBlock.value[o].optional)return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,g),r.name&&delete e[r.name]),n;i++}if(!1===n.verified){const t={verified:!1,result:e};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,g),r.name&&(delete e[r.name],t.name=r.name)),t}return{verified:!0,result:e}}if(r.primitiveSchema&&m in t.valueBlock){const i=fe(t.valueBlock.valueHexView);if(-1===i.offset){const t={verified:!1,result:i.result};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,g),r.name&&(delete e[r.name],t.name=r.name)),t}return yt(e,i.result,r.primitiveSchema)}return{verified:!0,result:e}}function mt(e,t){if(t instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};const r=fe(i.vJ.toUint8Array(e));return-1===r.offset?{verified:!1,result:r.result}:yt(r.result,r.result,t)}},8374:(e,t,r)=>{var i;e=r.nmd(e);var n=function(e){"use strict";var t=1e7,r=9007199254740992,i=l(r),s="0123456789abcdefghijklmnopqrstuvwxyz",o="function"==typeof BigInt;function a(e,t,r,i){return void 0===e?a[0]:void 0!==t&&(10!=+t||r)?F(e,t,r,i):J(e)}function c(e,t){this.value=e,this.sign=t,this.isSmall=!1}function u(e){this.value=e,this.sign=e<0,this.isSmall=!0}function h(e){this.value=e}function d(e){return-r<e&&e<r}function l(e){return e<1e7?[e]:e<1e14?[e%1e7,Math.floor(e/1e7)]:[e%1e7,Math.floor(e/1e7)%1e7,Math.floor(e/1e14)]}function f(e){p(e);var r=e.length;if(r<4&&R(e,i)<0)switch(r){case 0:return 0;case 1:return e[0];case 2:return e[0]+e[1]*t;default:return e[0]+(e[1]+e[2]*t)*t}return e}function p(e){for(var t=e.length;0===e[--t];);e.length=t+1}function y(e){for(var t=new Array(e),r=-1;++r<e;)t[r]=0;return t}function m(e){return e>0?Math.floor(e):Math.ceil(e)}function g(e,r){var i,n,s=e.length,o=r.length,a=new Array(s),c=0,u=t;for(n=0;n<o;n++)c=(i=e[n]+r[n]+c)>=u?1:0,a[n]=i-c*u;for(;n<s;)c=(i=e[n]+c)===u?1:0,a[n++]=i-c*u;return c>0&&a.push(c),a}function b(e,t){return e.length>=t.length?g(e,t):g(t,e)}function v(e,r){var i,n,s=e.length,o=new Array(s),a=t;for(n=0;n<s;n++)i=e[n]-a+r,r=Math.floor(i/a),o[n]=i-r*a,r+=1;for(;r>0;)o[n++]=r%a,r=Math.floor(r/a);return o}function w(e,r){var i,n,s=e.length,o=r.length,a=new Array(s),c=0,u=t;for(i=0;i<o;i++)(n=e[i]-c-r[i])<0?(n+=u,c=1):c=0,a[i]=n;for(i=o;i<s;i++){if(!((n=e[i]-c)<0)){a[i++]=n;break}n+=u,a[i]=n}for(;i<s;i++)a[i]=e[i];return p(a),a}function S(e,r,i){var n,s,o=e.length,a=new Array(o),h=-r,d=t;for(n=0;n<o;n++)s=e[n]+h,h=Math.floor(s/d),s%=d,a[n]=s<0?s+d:s;return"number"==typeof(a=f(a))?(i&&(a=-a),new u(a)):new c(a,i)}function _(e,r){var i,n,s,o,a=e.length,c=r.length,u=y(a+c),h=t;for(s=0;s<a;++s){o=e[s];for(var d=0;d<c;++d)i=o*r[d]+u[s+d],n=Math.floor(i/h),u[s+d]=i-n*h,u[s+d+1]+=n}return p(u),u}function A(e,r){var i,n,s=e.length,o=new Array(s),a=t,c=0;for(n=0;n<s;n++)i=e[n]*r+c,c=Math.floor(i/a),o[n]=i-c*a;for(;c>0;)o[n++]=c%a,c=Math.floor(c/a);return o}function E(e,t){for(var r=[];t-- >0;)r.push(0);return r.concat(e)}function C(e,t){var r=Math.max(e.length,t.length);if(r<=30)return _(e,t);r=Math.ceil(r/2);var i=e.slice(r),n=e.slice(0,r),s=t.slice(r),o=t.slice(0,r),a=C(n,o),c=C(i,s),u=C(b(n,i),b(o,s)),h=b(b(a,E(w(w(u,a),c),r)),E(c,2*r));return p(h),h}function k(e,r,i){return new c(e<t?A(r,e):_(r,l(e)),i)}function T(e){var r,i,n,s,o=e.length,a=y(o+o),c=t;for(n=0;n<o;n++){i=0-(s=e[n])*s;for(var u=n;u<o;u++)r=s*e[u]*2+a[n+u]+i,i=Math.floor(r/c),a[n+u]=r-i*c;a[n+o]=i}return p(a),a}function P(e,t){var r,i,n,s,o=e.length,a=y(o);for(n=0,r=o-1;r>=0;--r)n=(s=1e7*n+e[r])-(i=m(s/t))*t,a[r]=0|i;return[a,0|n]}function I(e,r){var i,n=J(r);if(o)return[new h(e.value/n.value),new h(e.value%n.value)];var s,d=e.value,g=n.value;if(0===g)throw new Error("Cannot divide by zero");if(e.isSmall)return n.isSmall?[new u(m(d/g)),new u(d%g)]:[a[0],e];if(n.isSmall){if(1===g)return[e,a[0]];if(-1==g)return[e.negate(),a[0]];var b=Math.abs(g);if(b<t){s=f((i=P(d,b))[0]);var v=i[1];return e.sign&&(v=-v),"number"==typeof s?(e.sign!==n.sign&&(s=-s),[new u(s),new u(v)]):[new c(s,e.sign!==n.sign),new u(v)]}g=l(b)}var S=R(d,g);if(-1===S)return[a[0],e];if(0===S)return[a[e.sign===n.sign?1:-1],a[0]];i=d.length+g.length<=200?function(e,r){var i,n,s,o,a,c,u,h=e.length,d=r.length,l=t,p=y(r.length),m=r[d-1],g=Math.ceil(l/(2*m)),b=A(e,g),v=A(r,g);for(b.length<=h&&b.push(0),v.push(0),m=v[d-1],n=h-d;n>=0;n--){for(i=l-1,b[n+d]!==m&&(i=Math.floor((b[n+d]*l+b[n+d-1])/m)),s=0,o=0,c=v.length,a=0;a<c;a++)s+=i*v[a],u=Math.floor(s/l),o+=b[n+a]-(s-u*l),s=u,o<0?(b[n+a]=o+l,o=-1):(b[n+a]=o,o=0);for(;0!==o;){for(i-=1,s=0,a=0;a<c;a++)(s+=b[n+a]-l+v[a])<0?(b[n+a]=s+l,s=0):(b[n+a]=s,s=1);o+=s}p[n]=i}return b=P(b,g)[0],[f(p),f(b)]}(d,g):function(e,r){for(var i,n,s,o,a,c=e.length,u=r.length,h=[],d=[],l=t;c;)if(d.unshift(e[--c]),p(d),R(d,r)<0)h.push(0);else{s=d[(n=d.length)-1]*l+d[n-2],o=r[u-1]*l+r[u-2],n>u&&(s=(s+1)*l),i=Math.ceil(s/o);do{if(R(a=A(r,i),d)<=0)break;i--}while(i);h.push(i),d=w(d,a)}return h.reverse(),[f(h),f(d)]}(d,g),s=i[0];var _=e.sign!==n.sign,E=i[1],C=e.sign;return"number"==typeof s?(_&&(s=-s),s=new u(s)):s=new c(s,_),"number"==typeof E?(C&&(E=-E),E=new u(E)):E=new c(E,C),[s,E]}function R(e,t){if(e.length!==t.length)return e.length>t.length?1:-1;for(var r=e.length-1;r>=0;r--)if(e[r]!==t[r])return e[r]>t[r]?1:-1;return 0}function x(e){var t=e.abs();return!t.isUnit()&&(!!(t.equals(2)||t.equals(3)||t.equals(5))||!(t.isEven()||t.isDivisibleBy(3)||t.isDivisibleBy(5))&&(!!t.lesser(49)||void 0))}function B(e,t){for(var r,i,s,o=e.prev(),a=o,c=0;a.isEven();)a=a.divide(2),c++;e:for(i=0;i<t.length;i++)if(!e.lesser(t[i])&&!(s=n(t[i]).modPow(a,e)).isUnit()&&!s.equals(o)){for(r=c-1;0!=r;r--){if((s=s.square().mod(e)).isUnit())return!1;if(s.equals(o))continue e}return!1}return!0}c.prototype=Object.create(a.prototype),u.prototype=Object.create(a.prototype),h.prototype=Object.create(a.prototype),c.prototype.add=function(e){var t=J(e);if(this.sign!==t.sign)return this.subtract(t.negate());var r=this.value,i=t.value;return t.isSmall?new c(v(r,Math.abs(i)),this.sign):new c(b(r,i),this.sign)},c.prototype.plus=c.prototype.add,u.prototype.add=function(e){var t=J(e),r=this.value;if(r<0!==t.sign)return this.subtract(t.negate());var i=t.value;if(t.isSmall){if(d(r+i))return new u(r+i);i=l(Math.abs(i))}return new c(v(i,Math.abs(r)),r<0)},u.prototype.plus=u.prototype.add,h.prototype.add=function(e){return new h(this.value+J(e).value)},h.prototype.plus=h.prototype.add,c.prototype.subtract=function(e){var t=J(e);if(this.sign!==t.sign)return this.add(t.negate());var r=this.value,i=t.value;return t.isSmall?S(r,Math.abs(i),this.sign):function(e,t,r){var i;return R(e,t)>=0?i=w(e,t):(i=w(t,e),r=!r),"number"==typeof(i=f(i))?(r&&(i=-i),new u(i)):new c(i,r)}(r,i,this.sign)},c.prototype.minus=c.prototype.subtract,u.prototype.subtract=function(e){var t=J(e),r=this.value;if(r<0!==t.sign)return this.add(t.negate());var i=t.value;return t.isSmall?new u(r-i):S(i,Math.abs(r),r>=0)},u.prototype.minus=u.prototype.subtract,h.prototype.subtract=function(e){return new h(this.value-J(e).value)},h.prototype.minus=h.prototype.subtract,c.prototype.negate=function(){return new c(this.value,!this.sign)},u.prototype.negate=function(){var e=this.sign,t=new u(-this.value);return t.sign=!e,t},h.prototype.negate=function(){return new h(-this.value)},c.prototype.abs=function(){return new c(this.value,!1)},u.prototype.abs=function(){return new u(Math.abs(this.value))},h.prototype.abs=function(){return new h(this.value>=0?this.value:-this.value)},c.prototype.multiply=function(e){var r,i,n,s=J(e),o=this.value,u=s.value,h=this.sign!==s.sign;if(s.isSmall){if(0===u)return a[0];if(1===u)return this;if(-1===u)return this.negate();if((r=Math.abs(u))<t)return new c(A(o,r),h);u=l(r)}return i=o.length,n=u.length,new c(-.012*i-.012*n+15e-6*i*n>0?C(o,u):_(o,u),h)},c.prototype.times=c.prototype.multiply,u.prototype._multiplyBySmall=function(e){return d(e.value*this.value)?new u(e.value*this.value):k(Math.abs(e.value),l(Math.abs(this.value)),this.sign!==e.sign)},c.prototype._multiplyBySmall=function(e){return 0===e.value?a[0]:1===e.value?this:-1===e.value?this.negate():k(Math.abs(e.value),this.value,this.sign!==e.sign)},u.prototype.multiply=function(e){return J(e)._multiplyBySmall(this)},u.prototype.times=u.prototype.multiply,h.prototype.multiply=function(e){return new h(this.value*J(e).value)},h.prototype.times=h.prototype.multiply,c.prototype.square=function(){return new c(T(this.value),!1)},u.prototype.square=function(){var e=this.value*this.value;return d(e)?new u(e):new c(T(l(Math.abs(this.value))),!1)},h.prototype.square=function(e){return new h(this.value*this.value)},c.prototype.divmod=function(e){var t=I(this,e);return{quotient:t[0],remainder:t[1]}},h.prototype.divmod=u.prototype.divmod=c.prototype.divmod,c.prototype.divide=function(e){return I(this,e)[0]},h.prototype.over=h.prototype.divide=function(e){return new h(this.value/J(e).value)},u.prototype.over=u.prototype.divide=c.prototype.over=c.prototype.divide,c.prototype.mod=function(e){return I(this,e)[1]},h.prototype.mod=h.prototype.remainder=function(e){return new h(this.value%J(e).value)},u.prototype.remainder=u.prototype.mod=c.prototype.remainder=c.prototype.mod,c.prototype.pow=function(e){var t,r,i,n=J(e),s=this.value,o=n.value;if(0===o)return a[1];if(0===s)return a[0];if(1===s)return a[1];if(-1===s)return n.isEven()?a[1]:a[-1];if(n.sign)return a[0];if(!n.isSmall)throw new Error("The exponent "+n.toString()+" is too large.");if(this.isSmall&&d(t=Math.pow(s,o)))return new u(m(t));for(r=this,i=a[1];!0&o&&(i=i.times(r),--o),0!==o;)o/=2,r=r.square();return i},u.prototype.pow=c.prototype.pow,h.prototype.pow=function(e){var t=J(e),r=this.value,i=t.value,n=BigInt(0),s=BigInt(1),o=BigInt(2);if(i===n)return a[1];if(r===n)return a[0];if(r===s)return a[1];if(r===BigInt(-1))return t.isEven()?a[1]:a[-1];if(t.isNegative())return new h(n);for(var c=this,u=a[1];(i&s)===s&&(u=u.times(c),--i),i!==n;)i/=o,c=c.square();return u},c.prototype.modPow=function(e,t){if(e=J(e),(t=J(t)).isZero())throw new Error("Cannot take modPow with modulus 0");var r=a[1],i=this.mod(t);for(e.isNegative()&&(e=e.multiply(a[-1]),i=i.modInv(t));e.isPositive();){if(i.isZero())return a[0];e.isOdd()&&(r=r.multiply(i).mod(t)),e=e.divide(2),i=i.square().mod(t)}return r},h.prototype.modPow=u.prototype.modPow=c.prototype.modPow,c.prototype.compareAbs=function(e){var t=J(e),r=this.value,i=t.value;return t.isSmall?1:R(r,i)},u.prototype.compareAbs=function(e){var t=J(e),r=Math.abs(this.value),i=t.value;return t.isSmall?r===(i=Math.abs(i))?0:r>i?1:-1:-1},h.prototype.compareAbs=function(e){var t=this.value,r=J(e).value;return(t=t>=0?t:-t)===(r=r>=0?r:-r)?0:t>r?1:-1},c.prototype.compare=function(e){if(e===1/0)return-1;if(e===-1/0)return 1;var t=J(e),r=this.value,i=t.value;return this.sign!==t.sign?t.sign?1:-1:t.isSmall?this.sign?-1:1:R(r,i)*(this.sign?-1:1)},c.prototype.compareTo=c.prototype.compare,u.prototype.compare=function(e){if(e===1/0)return-1;if(e===-1/0)return 1;var t=J(e),r=this.value,i=t.value;return t.isSmall?r==i?0:r>i?1:-1:r<0!==t.sign?r<0?-1:1:r<0?1:-1},u.prototype.compareTo=u.prototype.compare,h.prototype.compare=function(e){if(e===1/0)return-1;if(e===-1/0)return 1;var t=this.value,r=J(e).value;return t===r?0:t>r?1:-1},h.prototype.compareTo=h.prototype.compare,c.prototype.equals=function(e){return 0===this.compare(e)},h.prototype.eq=h.prototype.equals=u.prototype.eq=u.prototype.equals=c.prototype.eq=c.prototype.equals,c.prototype.notEquals=function(e){return 0!==this.compare(e)},h.prototype.neq=h.prototype.notEquals=u.prototype.neq=u.prototype.notEquals=c.prototype.neq=c.prototype.notEquals,c.prototype.greater=function(e){return this.compare(e)>0},h.prototype.gt=h.prototype.greater=u.prototype.gt=u.prototype.greater=c.prototype.gt=c.prototype.greater,c.prototype.lesser=function(e){return this.compare(e)<0},h.prototype.lt=h.prototype.lesser=u.prototype.lt=u.prototype.lesser=c.prototype.lt=c.prototype.lesser,c.prototype.greaterOrEquals=function(e){return this.compare(e)>=0},h.prototype.geq=h.prototype.greaterOrEquals=u.prototype.geq=u.prototype.greaterOrEquals=c.prototype.geq=c.prototype.greaterOrEquals,c.prototype.lesserOrEquals=function(e){return this.compare(e)<=0},h.prototype.leq=h.prototype.lesserOrEquals=u.prototype.leq=u.prototype.lesserOrEquals=c.prototype.leq=c.prototype.lesserOrEquals,c.prototype.isEven=function(){return 0==(1&this.value[0])},u.prototype.isEven=function(){return 0==(1&this.value)},h.prototype.isEven=function(){return(this.value&BigInt(1))===BigInt(0)},c.prototype.isOdd=function(){return 1==(1&this.value[0])},u.prototype.isOdd=function(){return 1==(1&this.value)},h.prototype.isOdd=function(){return(this.value&BigInt(1))===BigInt(1)},c.prototype.isPositive=function(){return!this.sign},u.prototype.isPositive=function(){return this.value>0},h.prototype.isPositive=u.prototype.isPositive,c.prototype.isNegative=function(){return this.sign},u.prototype.isNegative=function(){return this.value<0},h.prototype.isNegative=u.prototype.isNegative,c.prototype.isUnit=function(){return!1},u.prototype.isUnit=function(){return 1===Math.abs(this.value)},h.prototype.isUnit=function(){return this.abs().value===BigInt(1)},c.prototype.isZero=function(){return!1},u.prototype.isZero=function(){return 0===this.value},h.prototype.isZero=function(){return this.value===BigInt(0)},c.prototype.isDivisibleBy=function(e){var t=J(e);return!t.isZero()&&(!!t.isUnit()||(0===t.compareAbs(2)?this.isEven():this.mod(t).isZero()))},h.prototype.isDivisibleBy=u.prototype.isDivisibleBy=c.prototype.isDivisibleBy,c.prototype.isPrime=function(t){var r=x(this);if(r!==e)return r;var i=this.abs(),s=i.bitLength();if(s<=64)return B(i,[2,3,5,7,11,13,17,19,23,29,31,37]);for(var o=Math.log(2)*s.toJSNumber(),a=Math.ceil(!0===t?2*Math.pow(o,2):o),c=[],u=0;u<a;u++)c.push(n(u+2));return B(i,c)},h.prototype.isPrime=u.prototype.isPrime=c.prototype.isPrime,c.prototype.isProbablePrime=function(t,r){var i=x(this);if(i!==e)return i;for(var s=this.abs(),o=t===e?5:t,a=[],c=0;c<o;c++)a.push(n.randBetween(2,s.minus(2),r));return B(s,a)},h.prototype.isProbablePrime=u.prototype.isProbablePrime=c.prototype.isProbablePrime,c.prototype.modInv=function(e){for(var t,r,i,s=n.zero,o=n.one,a=J(e),c=this.abs();!c.isZero();)t=a.divide(c),r=s,i=a,s=o,a=c,o=r.subtract(t.multiply(o)),c=i.subtract(t.multiply(c));if(!a.isUnit())throw new Error(this.toString()+" and "+e.toString()+" are not co-prime");return-1===s.compare(0)&&(s=s.add(e)),this.isNegative()?s.negate():s},h.prototype.modInv=u.prototype.modInv=c.prototype.modInv,c.prototype.next=function(){var e=this.value;return this.sign?S(e,1,this.sign):new c(v(e,1),this.sign)},u.prototype.next=function(){var e=this.value;return e+1<r?new u(e+1):new c(i,!1)},h.prototype.next=function(){return new h(this.value+BigInt(1))},c.prototype.prev=function(){var e=this.value;return this.sign?new c(v(e,1),!0):S(e,1,this.sign)},u.prototype.prev=function(){var e=this.value;return e-1>-r?new u(e-1):new c(i,!0)},h.prototype.prev=function(){return new h(this.value-BigInt(1))};for(var O=[1];2*O[O.length-1]<=t;)O.push(2*O[O.length-1]);var M=O.length,N=O[M-1];function D(e){return Math.abs(e)<=t}function L(e,t,r){t=J(t);for(var i=e.isNegative(),s=t.isNegative(),o=i?e.not():e,a=s?t.not():t,c=0,u=0,h=null,d=null,l=[];!o.isZero()||!a.isZero();)c=(h=I(o,N))[1].toJSNumber(),i&&(c=N-1-c),u=(d=I(a,N))[1].toJSNumber(),s&&(u=N-1-u),o=h[0],a=d[0],l.push(r(c,u));for(var f=0!==r(i?1:0,s?1:0)?n(-1):n(0),p=l.length-1;p>=0;p-=1)f=f.multiply(N).add(n(l[p]));return f}c.prototype.shiftLeft=function(e){var t=J(e).toJSNumber();if(!D(t))throw new Error(String(t)+" is too large for shifting.");if(t<0)return this.shiftRight(-t);var r=this;if(r.isZero())return r;for(;t>=M;)r=r.multiply(N),t-=M-1;return r.multiply(O[t])},h.prototype.shiftLeft=u.prototype.shiftLeft=c.prototype.shiftLeft,c.prototype.shiftRight=function(e){var t,r=J(e).toJSNumber();if(!D(r))throw new Error(String(r)+" is too large for shifting.");if(r<0)return this.shiftLeft(-r);for(var i=this;r>=M;){if(i.isZero()||i.isNegative()&&i.isUnit())return i;i=(t=I(i,N))[1].isNegative()?t[0].prev():t[0],r-=M-1}return(t=I(i,O[r]))[1].isNegative()?t[0].prev():t[0]},h.prototype.shiftRight=u.prototype.shiftRight=c.prototype.shiftRight,c.prototype.not=function(){return this.negate().prev()},h.prototype.not=u.prototype.not=c.prototype.not,c.prototype.and=function(e){return L(this,e,(function(e,t){return e&t}))},h.prototype.and=u.prototype.and=c.prototype.and,c.prototype.or=function(e){return L(this,e,(function(e,t){return e|t}))},h.prototype.or=u.prototype.or=c.prototype.or,c.prototype.xor=function(e){return L(this,e,(function(e,t){return e^t}))},h.prototype.xor=u.prototype.xor=c.prototype.xor;var U=1<<30;function j(e){var r=e.value,i="number"==typeof r?r|U:"bigint"==typeof r?r|BigInt(U):r[0]+r[1]*t|1073758208;return i&-i}function q(e,t){if(t.compareTo(e)<=0){var r=q(e,t.square(t)),i=r.p,s=r.e,o=i.multiply(t);return o.compareTo(e)<=0?{p:o,e:2*s+1}:{p:i,e:2*s}}return{p:n(1),e:0}}function K(e,t){return e=J(e),t=J(t),e.greater(t)?e:t}function H(e,t){return e=J(e),t=J(t),e.lesser(t)?e:t}function z(e,t){if(e=J(e).abs(),t=J(t).abs(),e.equals(t))return e;if(e.isZero())return t;if(t.isZero())return e;for(var r,i,n=a[1];e.isEven()&&t.isEven();)r=H(j(e),j(t)),e=e.divide(r),t=t.divide(r),n=n.multiply(r);for(;e.isEven();)e=e.divide(j(e));do{for(;t.isEven();)t=t.divide(j(t));e.greater(t)&&(i=t,t=e,e=i),t=t.subtract(e)}while(!t.isZero());return n.isUnit()?e:e.multiply(n)}c.prototype.bitLength=function(){var e=this;return e.compareTo(n(0))<0&&(e=e.negate().subtract(n(1))),0===e.compareTo(n(0))?n(0):n(q(e,n(2)).e).add(n(1))},h.prototype.bitLength=u.prototype.bitLength=c.prototype.bitLength;var F=function(e,t,r,i){r=r||s,e=String(e),i||(e=e.toLowerCase(),r=r.toLowerCase());var n,o=e.length,a=Math.abs(t),c={};for(n=0;n<r.length;n++)c[r[n]]=n;for(n=0;n<o;n++){if("-"!==(d=e[n])&&(d in c&&c[d]>=a)){if("1"===d&&1===a)continue;throw new Error(d+" is not a valid digit in base "+t+".")}}t=J(t);var u=[],h="-"===e[0];for(n=h?1:0;n<e.length;n++){var d;if((d=e[n])in c)u.push(J(c[d]));else{if("<"!==d)throw new Error(d+" is not a valid character");var l=n;do{n++}while(">"!==e[n]&&n<e.length);u.push(J(e.slice(l+1,n)))}}return V(u,t,h)};function V(e,t,r){var i,n=a[0],s=a[1];for(i=e.length-1;i>=0;i--)n=n.add(e[i].times(s)),s=s.times(t);return r?n.negate():n}function $(e,t){if((t=n(t)).isZero()){if(e.isZero())return{value:[0],isNegative:!1};throw new Error("Cannot convert nonzero numbers to base 0.")}if(t.equals(-1)){if(e.isZero())return{value:[0],isNegative:!1};if(e.isNegative())return{value:[].concat.apply([],Array.apply(null,Array(-e.toJSNumber())).map(Array.prototype.valueOf,[1,0])),isNegative:!1};var r=Array.apply(null,Array(e.toJSNumber()-1)).map(Array.prototype.valueOf,[0,1]);return r.unshift([1]),{value:[].concat.apply([],r),isNegative:!1}}var i=!1;if(e.isNegative()&&t.isPositive()&&(i=!0,e=e.abs()),t.isUnit())return e.isZero()?{value:[0],isNegative:!1}:{value:Array.apply(null,Array(e.toJSNumber())).map(Number.prototype.valueOf,1),isNegative:i};for(var s,o=[],a=e;a.isNegative()||a.compareAbs(t)>=0;){s=a.divmod(t),a=s.quotient;var c=s.remainder;c.isNegative()&&(c=t.minus(c).abs(),a=a.next()),o.push(c.toJSNumber())}return o.push(a.toJSNumber()),{value:o.reverse(),isNegative:i}}function W(e,t,r){var i=$(e,t);return(i.isNegative?"-":"")+i.value.map((function(e){return function(e,t){return e<(t=t||s).length?t[e]:"<"+e+">"}(e,r)})).join("")}function G(e){if(d(+e)){var t=+e;if(t===m(t))return o?new h(BigInt(t)):new u(t);throw new Error("Invalid integer: "+e)}var r="-"===e[0];r&&(e=e.slice(1));var i=e.split(/e/i);if(i.length>2)throw new Error("Invalid integer: "+i.join("e"));if(2===i.length){var n=i[1];if("+"===n[0]&&(n=n.slice(1)),(n=+n)!==m(n)||!d(n))throw new Error("Invalid integer: "+n+" is not a valid exponent.");var s=i[0],a=s.indexOf(".");if(a>=0&&(n-=s.length-a-1,s=s.slice(0,a)+s.slice(a+1)),n<0)throw new Error("Cannot include negative exponent part for integers");e=s+=new Array(n+1).join("0")}if(!/^([0-9][0-9]*)$/.test(e))throw new Error("Invalid integer: "+e);if(o)return new h(BigInt(r?"-"+e:e));for(var l=[],f=e.length,y=f-7;f>0;)l.push(+e.slice(y,f)),(y-=7)<0&&(y=0),f-=7;return p(l),new c(l,r)}function J(e){return"number"==typeof e?function(e){if(o)return new h(BigInt(e));if(d(e)){if(e!==m(e))throw new Error(e+" is not an integer.");return new u(e)}return G(e.toString())}(e):"string"==typeof e?G(e):"bigint"==typeof e?new h(e):e}c.prototype.toArray=function(e){return $(this,e)},u.prototype.toArray=function(e){return $(this,e)},h.prototype.toArray=function(e){return $(this,e)},c.prototype.toString=function(t,r){if(t===e&&(t=10),10!==t)return W(this,t,r);for(var i,n=this.value,s=n.length,o=String(n[--s]);--s>=0;)i=String(n[s]),o+="0000000".slice(i.length)+i;return(this.sign?"-":"")+o},u.prototype.toString=function(t,r){return t===e&&(t=10),10!=t?W(this,t,r):String(this.value)},h.prototype.toString=u.prototype.toString,h.prototype.toJSON=c.prototype.toJSON=u.prototype.toJSON=function(){return this.toString()},c.prototype.valueOf=function(){return parseInt(this.toString(),10)},c.prototype.toJSNumber=c.prototype.valueOf,u.prototype.valueOf=function(){return this.value},u.prototype.toJSNumber=u.prototype.valueOf,h.prototype.valueOf=h.prototype.toJSNumber=function(){return parseInt(this.toString(),10)};for(var Y=0;Y<1e3;Y++)a[Y]=J(Y),Y>0&&(a[-Y]=J(-Y));return a.one=a[1],a.zero=a[0],a.minusOne=a[-1],a.max=K,a.min=H,a.gcd=z,a.lcm=function(e,t){return e=J(e).abs(),t=J(t).abs(),e.divide(z(e,t)).multiply(t)},a.isInstance=function(e){return e instanceof c||e instanceof u||e instanceof h},a.randBetween=function(e,r,i){e=J(e),r=J(r);var n=i||Math.random,s=H(e,r),o=K(e,r).subtract(s).add(1);if(o.isSmall)return s.add(Math.floor(n()*o));for(var c=$(o,t).value,u=[],h=!0,d=0;d<c.length;d++){var l=h?c[d]+(d+1<c.length?c[d+1]/t:0):t,f=m(n()*l);u.push(f),f<c[d]&&(h=!1)}return s.add(a.fromArray(u,t,!1))},a.fromArray=function(e,t,r){return V(e.map(J),J(t||10),r)},a}();e.hasOwnProperty("exports")&&(e.exports=n),void 0===(i=function(){return n}.call(t,r,t,e))||(e.exports=i)},4756:(e,t,r)=>{"use strict";const i=r(4987),n=r(7581),s=r(4858),o=r(8850),a=r(6699),c=r(161),u=r(3675),h=r(9827),d=r(4424),{encode:l}=r(7805),{decode:f}=r(7876),{encodingLength:p}=r(1411),y=r(2142),m=r(9189),g={array:n,bool:o,buffer:s,reserved:a,string:c,when:h,select:d};for(const e of Object.keys(u))g[e]=u[e];const b=Symbol("schema");function v(e){const t=new i({readableObjectMode:!1,writableObjectMode:!0,transform:S});return t[b]=e,t}function w(e){let t=null;const r=Buffer.isBuffer(e);r||(t=e);const n=new i({transform:_,readableObjectMode:!0,writableObjectMode:!1});return n[b]=t,r&&n.append(e),n}function S(e,t,r){try{l(e,this[b],this);const t=this.slice();this.consume(t.length),r(null,t)}catch(e){r(e)}}function _(e,t,r){this.append(e);try{for(;this.length>0;){const e=new y(this),t=f(e,this[b]);e.commit(),this.push(t)}r()}catch(e){e instanceof m?r():r(e)}}e.exports={createEncodeStream:v,createDecodeStream:w,encode:l,decode:f,encodingLength:p,createEncode:v,createDecode:w,types:g,BinaryStream:i,NotEnoughDataError:m}},3804:(e,t,r)=>{"use strict";const i=r(116),n=r(2552);class s{constructor(){this.queue=new n,this.offset=0}get length(){return this.queue.length-this.offset}append(e){if(Buffer.isBuffer(e)){if(this.offset>0){const e=this.queue.shift();this.queue.unshift(e.slice(this.offset)),this.offset=0}this.queue.push(e)}else if(Array.isArray(e))for(let t=0;t<e.length;t+=1)this.append(e[t]);else if(e instanceof s){if(this.offset>0){const e=this.queue.shift();this.queue.unshift(e.slice(this.offset)),this.offset=0}if(e.offset>0){const t=e.queue.shift();e.queue.unshift(t.slice(e.offset)),e.offset=0}let t=e.queue.head;for(;t;)this.queue.push(t.buffer),t=t.next}}get(e){let t=e;for(;t>=this.length;)t-=this.length;for(;t<0;)t+=this.length;let r=this.queue.head,{offset:i}=this;for(;r;){if(r.buffer.length-i>t)return r.buffer[t+i];t-=r.buffer.length-i,i=0,r=r.next}}slice(e,t){for("number"!=typeof e&&(e=0),"number"!=typeof t&&(t=this.length);e<0;)e+=this.length;for(;t<0;)t+=this.length;if(t=Math.min(t,this.length),e>=this.length||0===t)return Buffer.alloc(0);const r=e;e=Math.min(r,t),t=Math.max(r,t);const i=this.queue.slice(e+this.offset,t+this.offset);if(1===i.count)return i.first;let n=i.head;const s=Buffer.allocUnsafe(i.length);let o=0;for(let e=0;e<i.count;e+=1)s.set(n.buffer,o),o+=n.buffer.length,n=n.next;return s}toString(e,t,r){return this.slice(t,r).toString(e)}consume(e){let t=e;for(;this.length>0;){const e=this.queue.first.length-this.offset;if(!(t>=e)){this.offset+=t;break}this.queue.shift(),t-=e,this.offset=0}}indexOf(e,t=0){if(!Number.isInteger(e))throw new TypeError("Invalid argument 1");if(e<0||e>255)throw new Error("Invalid argument 1");for(Number.isInteger(t)||(t=0);t>=this.length;)t-=this.length;for(;t<0;)t+=this.length;let r=this.queue.head,i=0;const n=()=>{i+=r.buffer.length,r=r.next};for(;r;){let s=0;if(r===this.queue.head&&(s+=this.offset),t>=r.buffer.length-s){t-=r.buffer.length-s,n();continue}t<r.buffer.length&&(s+=t);const o=r.buffer.indexOf(e,s);if(o>-1)return o+i-this.offset;n(),s>this.offset&&(t=0)}return-1}}const o={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1};Object.keys(o).forEach((e=>{const t=i();t(`\n    function bufferlist_${e}(offset = 0) {\n      const start = offset + this.offset;\n      const head = this.queue.first;\n      const size = ${t.formats.d(o[e])};\n      const isFirtsChunkEnough = head.length - start >= size;\n\n      return isFirtsChunkEnough\n        ? head.${e}(start)\n        : this.slice(offset, offset + size).${e}(0)\n    }\n  `),s.prototype[e]=t.toFunction()}));["readIntBE","readIntLE","readUIntBE","readUIntLE"].forEach((e=>{const t=i();t(`\n    function bufferlist_${e}(size, offset = 0) {\n      const start = offset + this.offset;\n      const head = this.queue.first;\n      const isFirtsChunkEnough = head.length - start >= size;\n\n      return isFirtsChunkEnough\n        ? head.${e}(start, size)\n        : this.slice(offset, offset + size).${e}(0, size)\n    }\n  `),s.prototype[e]=t.toFunction()}));const a={writeDoubleBE:8,writeDoubleLE:8,writeFloatBE:4,writeFloatLE:4,writeInt32BE:4,writeInt32LE:4,writeUInt32BE:4,writeUInt32LE:4,writeInt16BE:2,writeInt16LE:2,writeUInt16BE:2,writeUInt16LE:2,writeInt8:1,writeUInt8:1};Object.keys(a).forEach((e=>{const t=i();t(`\n    function bufferlist_${e}(value) {\n      const size = ${t.formats.d(a[e])};\n      const buf = Buffer.allocUnsafe(size);\n      buf.${e}(value, 0);\n      this.append(buf);\n    }\n  `),s.prototype[e]=t.toFunction()}));["writeIntBE","writeIntLE","writeUIntBE","writeUIntLE"].forEach((e=>{const t=i();t(`\n    function bufferlist_${e}(value, size) {\n      const buf = Buffer.allocUnsafe(size);\n      buf.${e}(value, 0, size);\n      this.append(buf);\n    }\n  `),s.prototype[e]=t.toFunction()})),e.exports=s},2552:e=>{"use strict";class t{constructor(){this.next=null,this.buffer=null}}e.exports=class e{constructor(){this.head=null,this.tail=null,this.length=0,this.count=0}push(e){const r=new t;r.buffer=e,this.length>0?this.tail.next=r:this.head=r,this.tail=r,this.length+=e.length,this.count+=1}unshift(e){const r=new t;r.buffer=e,r.next=this.head,this.isEmpty()&&(this.tail=r),this.head=r,this.length+=e.length,this.count+=1}shift(){if(this.isEmpty())return null;const e=this.head.buffer;return this.head===this.tail?(this.head=null,this.tail=null):this.head=this.head.next,this.length-=e.length,this.length=Math.max(this.length,0),this.count-=1,e}get first(){return this.isEmpty()?null:this.head.buffer}get last(){return this.isEmpty()?null:this.tail.buffer}isEmpty(){return 0===this.length}clear(){this.head=null,this.tail=null,this.length=0,this.count=0}slice(t,r){if(t<0||t>=this.length)return new e;if(r<0||r>this.length||r<t)return new e;const i=new e;let n=this.head,s=t,o=r;for(;n;){if(n.buffer.length>s){0===s&&n.buffer.length<=o?i.push(n.buffer):n.buffer.length>=o?i.push(n.buffer.slice(s,o)):i.push(n.buffer.slice(s));break}s-=n.buffer.length,o-=n.buffer.length,n=n.next}if(n.buffer.length<o)for(;n;){if(n.buffer.length===o){i.push(n.buffer);break}if(n.buffer.length>o){i.push(n.buffer.slice(0,o));break}s<0&&n.buffer.length<o&&i.push(n.buffer),s-=n.buffer.length,o-=n.buffer.length,n=n.next}return i}}},8513:(e,t,r)=>{"use strict";const i=r(3803);e.exports=class e{constructor(){this[i.bytes]=0,this.node=void 0,this.current=void 0}get bytes(){return this[i.bytes]}static clone(t){const r=new e;return t instanceof e&&(r.node=t.node,r.current=t.current),r}static clean(t){t instanceof e&&(t.node=void 0,t.current=void 0)}}},3803:e=>{"use strict";const t=Symbol("skip"),r=Symbol("bytes");e.exports={skip:t,bytes:r}},4987:(e,t,r)=>{"use strict";const{Transform:i}=r(2781),n=r(116),s=r(3804),o=r(9189),a=Symbol("buffer");class c extends i{constructor(e={}){super(e),this[a]=new s}get buffer(){return this[a]}get length(){return this.buffer.length}append(e){this.buffer.append(e)}get(e){return this.buffer.get(e)}slice(e,t){return this.buffer.slice(e,t)}consume(e){this.buffer.consume(e)}toString(e,t,r){return this.buffer.toString(e,t,r)}indexOf(e,t=0){return this.buffer.indexOf(e,t)}readBuffer(e){h(e,this.length);const t=this.slice(0,e);return this.consume(e),t}writeBuffer(e){this.append(e)}}const u={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1};Object.keys(u).forEach((e=>{const t=n();t(`\n    function binary_${e}() {\n      const bytes = ${t.formats.d(u[e])};\n      assertSize(bytes, this.length);\n\n      const res = this.buffer.${e}(0);\n      this.consume(bytes);\n\n      return res;\n    }\n  `),c.prototype[e]=t.toFunction({assertSize:h})})),["readIntBE","readIntLE","readUIntBE","readUIntLE"].forEach((e=>{const t=n();t(`\n    function binary_${e}(size) {\n      assertSize(size, this.length);\n\n      const res = this.buffer.${e}(size, 0);\n      this.consume(size);\n      return res;\n    }\n  `),c.prototype[e]=t.toFunction({assertSize:h})}));["writeDoubleBE","writeDoubleLE","writeFloatBE","writeFloatLE","writeInt32BE","writeInt32LE","writeUInt32BE","writeUInt32LE","writeInt16BE","writeInt16LE","writeUInt16BE","writeUInt16LE","writeInt8","writeUInt8"].forEach((e=>{const t=n();t(`\n    function binary_${e}(value) {\n      this.buffer.${e}(value);\n    }\n  `),c.prototype[e]=t.toFunction()}));function h(e,t){if(e>t)throw new o(e,t)}["writeIntBE","writeIntLE","writeUIntBE","writeUIntLE"].forEach((e=>{const t=n();t(`\n    function binary_${e}(value, size) {\n      this.buffer.${e}(value, size);\n    }\n  `),c.prototype[e]=t.toFunction()})),e.exports=c},7876:(e,t,r)=>{"use strict";const{isType:i,isUserType:n,isDecodeType:s}=r(3768),o=r(4987),a=r(3803),c=r(8513);function u(e,t,r){if(i(t)){const i=t.decode.call(r,e);return r[a.bytes]+=t.decode.bytes,i}return h(e,t,r)}function h(e,t,r){!function(e){if(!n(e))throw new TypeError("Argument #2 should be a plain object.")}(t);const i=Object.create(null);void 0===r.node?(r.node=i,r.current=i):r.current=i;const o=Object.keys(t);for(let n=0;n<o.length;n+=1){const c=o[n],u=t[c];if(!s(u)){i[c]=h(e,u,r),r.current=i;continue}const d=u.decode.call(r,e);r[a.bytes]+=u.decode.bytes,!0!==u[a.skip]&&(i[c]=d)}return i}e.exports={decode:function e(t,r){let i=t;Buffer.isBuffer(t)&&(i=new o,i.append(t));const n=new c,s=u(i,r,n);return e.bytes=n.bytes,c.clean(n),s},decodeCommon:u}},7805:(e,t,r)=>{"use strict";const{isUserType:i,isEncodeType:n,isType:s}=r(3768),o=r(3803),a=r(8513),c=r(4987);function u(e,t,r,i){s(r)?(r.encode.call(i,e,t),i[o.bytes]+=r.encode.bytes):h(e,t,r,i)}function h(e,t,r,s){!function(e){if(!i(e))throw new TypeError("Argument `schema` should be a plain object.")}(r),void 0===s.node?(s.node=e,s.current=e):s.current=e;const a=Object.keys(r);for(let i=0;i<a.length;i+=1){const c=a[i],u=r[c],d=e[c];n(u)?(u.encode.call(s,d,t),s[o.bytes]+=u.encode.bytes):(h(d,t,u,s),s.current=e)}}e.exports={encode:function e(t,r,i){const n=new a;if(r instanceof c){const e=i;i=r,r=e}i instanceof c||(i=new c);return u(t,i,r,n),e.bytes=n.bytes,a.clean(n),i},encodeCommon:u}},1411:(e,t,r)=>{"use strict";const{isUserType:i,isType:n}=r(3768),s=r(8513),o=r(3803);function a(e,t,r){n(t)?r[o.bytes]+=t.encodingLength.call(r,e):c(e,t,r)}function c(e,t,r){if(!i(t))throw new TypeError("Argument `schema` should be a plain object.");void 0===r.node?(r.node=e,r.current=e):r.current=e;const s=Object.keys(t);for(let i=0;i<s.length;i+=1){const a=s[i],u=t[a],h=e[a];n(u)?r[o.bytes]+=u.encodingLength.call(r,h):(c(h,u,r),r.current=e)}}e.exports={encodingLength:function(e,t){const r=new s;return a(e,t,r),s.clean(r),r.bytes},encodingLengthCommon:a}},9189:e=>{"use strict";e.exports=class extends Error{constructor(e,t){super(`requested ${e} bytes but only ${t} available`),this.name="NotEnoughDataError"}}},2142:(e,t,r)=>{"use strict";const i=r(116),n=r(9189);class s{constructor(e){this.stream=e,this.index=0}append(e){this.stream.append(e)}commit(){this.stream.consume(this.index)}get(e=0){return this.stream.get(this.index+e)}get length(){return this.stream.length}slice(e,t){return this.stream.slice(e,t)}toString(e,t,r){return this.stream.toString(e,t,r)}readBuffer(e){a(this.index+e,this.length);const t=this.stream.slice(this.index,this.index+e);return this.index+=e,t}indexOf(e,t=0){return this.stream.indexOf(e,this.index+t)-this.index}}const o={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1};function a(e,t){if(e>t)throw new n(e,t)}Object.keys(o).forEach((e=>{const t=i(),r=o[e];t(`\n    function transaction_${e}() {\n      assertSize(this.index + ${t.formats.d(r)}, this.length);\n      const value = this.stream.buffer.${e}(this.index);\n      this.index += ${t.formats.d(r)};\n      return value;\n    }\n  `),s.prototype[e]=t.toFunction({assertSize:a})})),["readIntBE","readIntLE","readUIntBE","readUIntLE"].forEach((e=>{const t=i();t(`\n    function transaction_${e}(bytes) {\n      assertSize(this.index + bytes, this.length);\n      const value = this.stream.buffer.${e}(bytes, this.index);\n      this.index += bytes;\n      return value;\n    }\n  `),s.prototype[e]=t.toFunction({assertSize:a})})),e.exports=s},3768:(e,t,r)=>{"use strict";const i=r(570);function n(e){return"function"==typeof e}function s(e){return"object"==typeof e&&null!==e}e.exports={isType:function(e){return s(e)&&n(e.encode)&&n(e.decode)},isUserType:i,isFunction:n,isDecodeType:function(e){return s(e)&&n(e.decode)},isEncodeType:function(e){return s(e)&&n(e.encode)}}},7581:(e,t,r)=>{"use strict";const{decodeCommon:i}=r(7876),{encodeCommon:n}=r(7805),{encodingLengthCommon:s}=r(1411),{isType:o,isUserType:a,isFunction:c}=r(3768),u=r(8513);function h(e){if(!Array.isArray(e))throw new TypeError("Argument #1 should be an Array.")}function d(e){if("number"!=typeof e)throw new TypeError("Length of an array should be a number.")}function l(e,t){if(e!==t)throw new Error(`Argument #1 required length ${e} instead of ${t}`)}e.exports=function(e,t,r="count"){if(!o(e)&&!a(e))throw new TypeError("Argument #1 should be a valid type.");const f="bytes"===r,p="number"==typeof t,y=o(t),m=c(t);if(!p&&!y&&!m)throw new TypeError("Unknown type of argument #1.");return{encode:function r(i,o){h(i);const a=u.clone(this);r.bytes=0;let c=0;y?c=i.length:p?c=t:m&&(c=t(a),d(c));f||l(c,i.length);if(f){const t=u.clone(a);for(const r of i)s(r,e,t);y&&(c=t.bytes),l(t.bytes,c),u.clean(t)}y&&(t.encode.call(a,c,o),r.bytes+=t.encode.bytes);i.forEach((t=>{n(t,o,e,a)})),r.bytes+=a.bytes,u.clean(a)},decode:function r(n){let s=0;r.bytes=0;const o=u.clone(this);p?s=t:y?(s=t.decode.call(o,n),r.bytes+=t.decode.bytes):m&&(s=t(o));let a;d(s),a=f?function(e,t,r,n){const s=[],o=n.bytes;let a=0;for(;a<t;)s.push(i(r,e,n)),a=n.bytes-o;if(a>t)throw new Error("Incorrect length of an array.");return s}(e,s,n,o):function(e,t,r,n){const s=new Array(t);for(let o=0;o<t;o+=1)s[o]=i(r,e,n);return s}(e,s,n,o);return r.bytes+=o.bytes,u.clean(o),a},encodingLength:function(r){h(r);const i=u.clone(this);let n=0;if(p&&f)return t;y&&!f&&(n=t.encodingLength(r.length));for(const t of r)s(t,e,i);u.clean(i),n+=i.bytes,y&&f&&(n+=t.encodingLength(n));return n}}}},8850:(e,t,r)=>{"use strict";const{isType:i}=r(3768);e.exports=function(e){if(!i(e))throw new TypeError("Argument #1 should be valid type.");return{encode:function t(r,i){e.encode.call(this,r?1:0,i),t.bytes=e.encode.bytes},decode:function t(r){const i=e.decode.call(this,r);return t.bytes=e.decode.bytes,Boolean(i)},encodingLength:e.encodingLength}}},4858:(e,t,r)=>{"use strict";const{isType:i,isFunction:n}=r(3768),s=r(9189),o=r(4987);function a(e){if(!(Buffer.isBuffer(e)||e instanceof o))throw new TypeError("Argument 1 should be a Buffer or a BinaryStream.")}function c(e,t){if(e!==t)throw new Error(`Buffer required length ${e} instead of ${t}`)}function u(e){if("number"!=typeof e)throw new TypeError("Length of a buffer should be a number.")}e.exports=function(e){const t="number"==typeof e,r=i(e),o=n(e),h=null===e;if(!(t||r||o||h))throw new TypeError("Unknown type of argument #1.");return{encode:function i(n,s){a(n),i.bytes=0;const d=this;t&&c(e,n.length);r&&(e.encode.call(d,n.length,s),i.bytes+=e.encode.bytes);if(o){const t=e(d);u(t),c(t,n.length)}s.writeBuffer(Buffer.isBuffer(n)?n:n.buffer),i.bytes+=n.length,h&&(s.writeUInt8(0),i.bytes+=1)},decode:function i(n){let a=0;i.bytes=0;const c=this;if(t)a=e;else if(r)a=e.decode.call(c,n),i.bytes+=e.decode.bytes,u(a);else if(o)a=e(c),u(a);else if(h&&(a=n.indexOf(0),-1===a))throw new s(n.length+1,n.length);const d=n.readBuffer(a);i.bytes+=a,h&&(i.bytes+=1,n.consume(1));return d},encodingLength:function(i){a(i);let n=0;if(t)return e;h?n=1:r&&(n=e.encodingLength(i.length));return n+i.length}}}},3675:(e,t,r)=>{"use strict";const i=r(116);function n(e,t,r){const n=i(),s=i();return n(`\n    function decode_${r}(rstream) {\n      decode_${r}.bytes = ${n.formats.d(e)};\n      return rstream.${r}()\n    }\n  `),s(`\n    function encode_${t}(value, wstream) {\n      wstream.${t}(value);\n      encode_${t}.bytes = ${n.formats.d(e)};\n    }\n  `),{encodingLength:()=>e,encode:s.toFunction(),decode:n.toFunction()}}function s(e,t,r){const n=i(),s=i();return n(`\n    function decode_${r}(rstream) {\n      decode_${r}.bytes = ${n.formats.d(e)};\n      return rstream.${r}(${n.formats.d(e)})\n    }\n  `),s(`\n    function encode_${t}(value, wstream) {\n      wstream.${t}(value, ${n.formats.d(e)});\n      encode_${t}.bytes = ${n.formats.d(e)};\n    }\n  `),{encodingLength:()=>e,encode:s.toFunction(),decode:n.toFunction()}}e.exports={doublebe:n(8,"writeDoubleBE","readDoubleBE"),doublele:n(8,"writeDoubleLE","readDoubleLE"),floatbe:n(4,"writeFloatBE","readFloatBE"),floatle:n(4,"writeFloatLE","readFloatLE"),int8:n(1,"writeInt8","readInt8"),uint8:n(1,"writeUInt8","readUInt8"),int16be:n(2,"writeInt16BE","readInt16BE"),uint16be:n(2,"writeUInt16BE","readUInt16BE"),int16le:n(2,"writeInt16LE","readInt16LE"),uint16le:n(2,"writeUInt16LE","readUInt16LE"),int32be:n(4,"writeInt32BE","readInt32BE"),uint32be:n(4,"writeUInt32BE","readUInt32BE"),int32le:n(4,"writeInt32LE","readInt32LE"),uint32le:n(4,"writeUInt32LE","readUInt32LE"),int24be:s(3,"writeIntBE","readIntBE"),uint24be:s(3,"writeUIntBE","readUIntBE"),int24le:s(3,"writeIntLE","readIntLE"),uint24le:s(3,"writeUIntLE","readUIntLE"),int40be:s(5,"writeIntBE","readIntBE"),uint40be:s(5,"writeUIntBE","readUIntBE"),int40le:s(5,"writeIntLE","readIntLE"),uint40le:s(5,"writeUIntLE","readUIntLE"),int48be:s(6,"writeIntBE","readIntBE"),uint48be:s(6,"writeUIntBE","readUIntBE"),int48le:s(6,"writeIntLE","readIntLE"),uint48le:s(6,"writeUIntLE","readUIntLE")}},6699:(e,t,r)=>{"use strict";const{decodeCommon:i}=r(7876),{encodeCommon:n}=r(7805),{encodingLengthCommon:s}=r(1411),{isType:o,isFunction:a}=r(3768),c=r(3803),u=r(8513);e.exports=function(e,t=1){if(!o(e))throw new TypeError("Invalid data type.");if(!Number.isInteger(t)&&!a(t))throw new TypeError("Argument #2 should be a valid integer or function.");return{[c.skip]:!0,encodingLength:function(r){const i=u.clone(this),n=a(t)?t(i):t;return s(r,e,i),u.clean(i),i.bytes*n},decode:function r(n){const s=u.clone(this);r.bytes=0;const o=a(t)?t(s):t;if(0===o)return void u.clean(s);for(let t=o;t>0;t-=1)i(n,e,s);r.bytes=s.bytes,u.clean(s)},encode:function r(i,s){r.bytes=0;const o=u.clone(this),c=a(t)?t(o):t;if(0===c)return void u.clean(o);for(let t=c;t>0;t-=1)n(0,s,e,o);r.bytes=o.bytes,u.clean(o)}}}},4424:(e,t,r)=>{"use strict";const i=r(3803),{decodeCommon:n}=r(7876),s=r(8513);e.exports=function(...e){if(0===e.length)throw new TypeError("You should set at least one condition type.");const t={decode:function r(o){r.bytes=0;const a=s.clone(this);for(const c of e){const e=n(o,c,a);if(!0!==c[i.skip])return r.bytes=a.bytes,s.clean(a),t[i.skip]=!1,e}t[i.skip]=!0},encode:()=>{},[i.skip]:!0};return t}},161:(e,t,r)=>{"use strict";const{isType:i}=r(3768),n=r(9189);function s(e){return function t(r,i){const n=Buffer.from(r.toString(),e);i.writeBuffer(n),i.writeInt8(0),t.bytes=n.length+1}}function o(e){return function t(r){const i=r.indexOf(0);if(-1===i)throw new n(r.length+1,r.length);const s=i+1,o=r.readBuffer(s);return t.bytes=s,o.toString(e,0,i)}}function a(e,t){return function r(i,n){if(i=i.toString(),Buffer.byteLength(i,t)!==e)throw new Error(`Size of string should be ${e} in bytes.`);const s=Buffer.from(i,t);n.writeBuffer(s),r.bytes=s.length}}function c(e,t){return function r(i){const n=i.readBuffer(e);return r.bytes=e,n.toString(t)}}function u(e,t){return function r(i,n){i=i.toString();e.encode.call(this,Buffer.byteLength(i,t),n),r.bytes=e.encode.bytes;const s=Buffer.from(i,t);n.writeBuffer(s),r.bytes+=s.length}}function h(e,t){return function r(i){const n=e.decode.call(this,i);if("number"!=typeof n)throw new TypeError("Size of a string should be a number.");const s=i.readBuffer(n);return r.bytes=e.decode.bytes+s.length,s.toString(t)}}function d(e,t){return function(r){const i=Buffer.byteLength(r,t);return e.encodingLength(i)+i}}function l(e,t){return function r(i,n){r.bytes=0;const s=e(this),o=Buffer.from(i.toString(),t);p(s),function(e,t){if(e!==t)throw new Error(`Buffer required length ${e} instead of ${t}`)}(s,o.length),n.writeBuffer(o),r.bytes+=o.length}}function f(e,t){return function r(i){const n=e(this);p(n);const s=i.readBuffer(n);return r.bytes=n,s.toString(t)}}function p(e){if("number"!=typeof e)throw new TypeError("Length of a buffer should be a number.")}e.exports=function(e,t="ascii"){if(!Buffer.isEncoding(t))throw new Error("Argument #2 should be an encoding name.");if("number"==typeof e)return{encode:a(e,t),decode:c(e,t),encodingLength:()=>e};if(i(e))return{encode:u(e,t),decode:h(e,t),encodingLength:d(e,t)};if(null===e)return{encode:s(t),decode:o(t),encodingLength:e=>Buffer.byteLength(e,t)+1};if("function"==typeof e)return{encode:l(e,t),decode:f(e,t),encodingLength:e=>Buffer.byteLength(e,t)};throw new TypeError("Unknown type of argument #1.")}},9827:(e,t,r)=>{"use strict";const{isType:i,isFunction:n,isUserType:s}=r(3768),o=r(3803),{decodeCommon:a}=r(7876),{encodeCommon:c}=r(7805),{encodingLengthCommon:u}=r(1411),h=r(8513);e.exports=function(e,t){if(!i(t)&&!s(t))throw new TypeError("Argument #2 should be a valid type.");const r={encode:function i(s,a){const u=h.clone(this);i.bytes=0;const d=n(e)?Boolean(e(u)):Boolean(e);if(r[o.skip]=!d,!d)return void h.clean(u);c(s,a,t,u),i.bytes=u.bytes,h.clean(u)},decode:function i(s){const c=h.clone(this);i.bytes=0;const u=n(e)?Boolean(e(c)):Boolean(e);if(r[o.skip]=!u,!u)return void h.clean(c);const d=a(s,t,c);return i.bytes=c.bytes,h.clean(c),d},encodingLength:function(r){const i=h.clone(this);(n(e)?Boolean(e(i)):Boolean(e))&&u(r,t,i);return h.clean(i),i.bytes},[o.skip]:!1};return r}},1531:function(e,t,r){!function(e,t){"use strict";function i(e,t){if(!e)throw new Error(t||"Assertion failed")}function n(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}function s(e,t,r){if(s.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(r=t,t=10),this._init(e||0,t||10,r||"be"))}var o;"object"==typeof e?e.exports=s:t.BN=s,s.BN=s,s.wordSize=26;try{o="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:r(4300).Buffer}catch(e){}function a(e,t){var r=e.charCodeAt(t);return r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:r-48&15}function c(e,t,r){var i=a(e,r);return r-1>=t&&(i|=a(e,r-1)<<4),i}function u(e,t,r,i){for(var n=0,s=Math.min(e.length,r),o=t;o<s;o++){var a=e.charCodeAt(o)-48;n*=i,n+=a>=49?a-49+10:a>=17?a-17+10:a}return n}s.isBN=function(e){return e instanceof s||null!==e&&"object"==typeof e&&e.constructor.wordSize===s.wordSize&&Array.isArray(e.words)},s.max=function(e,t){return e.cmp(t)>0?e:t},s.min=function(e,t){return e.cmp(t)<0?e:t},s.prototype._init=function(e,t,r){if("number"==typeof e)return this._initNumber(e,t,r);if("object"==typeof e)return this._initArray(e,t,r);"hex"===t&&(t=16),i(t===(0|t)&&t>=2&&t<=36);var n=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(n++,this.negative=1),n<e.length&&(16===t?this._parseHex(e,n,r):(this._parseBase(e,t,n),"le"===r&&this._initArray(this.toArray(),t,r)))},s.prototype._initNumber=function(e,t,r){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(i(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===r&&this._initArray(this.toArray(),t,r)},s.prototype._initArray=function(e,t,r){if(i("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var s,o,a=0;if("be"===r)for(n=e.length-1,s=0;n>=0;n-=3)o=e[n]|e[n-1]<<8|e[n-2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);else if("le"===r)for(n=0,s=0;n<e.length;n+=3)o=e[n]|e[n+1]<<8|e[n+2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);return this.strip()},s.prototype._parseHex=function(e,t,r){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var n,s=0,o=0;if("be"===r)for(i=e.length-1;i>=t;i-=2)n=c(e,t,i)<<s,this.words[o]|=67108863&n,s>=18?(s-=18,o+=1,this.words[o]|=n>>>26):s+=8;else for(i=(e.length-t)%2==0?t+1:t;i<e.length;i+=2)n=c(e,t,i)<<s,this.words[o]|=67108863&n,s>=18?(s-=18,o+=1,this.words[o]|=n>>>26):s+=8;this.strip()},s.prototype._parseBase=function(e,t,r){this.words=[0],this.length=1;for(var i=0,n=1;n<=67108863;n*=t)i++;i--,n=n/t|0;for(var s=e.length-r,o=s%i,a=Math.min(s,s-o)+r,c=0,h=r;h<a;h+=i)c=u(e,h,h+i,t),this.imuln(n),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c);if(0!==o){var d=1;for(c=u(e,h,e.length,t),h=0;h<o;h++)d*=t;this.imuln(d),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c)}this.strip()},s.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},s.prototype.clone=function(){var e=new s(null);return this.copy(e),e},s.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},s.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},s.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},s.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var h=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],d=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],l=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function f(e,t,r){r.negative=t.negative^e.negative;var i=e.length+t.length|0;r.length=i,i=i-1|0;var n=0|e.words[0],s=0|t.words[0],o=n*s,a=67108863&o,c=o/67108864|0;r.words[0]=a;for(var u=1;u<i;u++){for(var h=c>>>26,d=67108863&c,l=Math.min(u,t.length-1),f=Math.max(0,u-e.length+1);f<=l;f++){var p=u-f|0;h+=(o=(n=0|e.words[p])*(s=0|t.words[f])+d)/67108864|0,d=67108863&o}r.words[u]=0|d,c=0|h}return 0!==c?r.words[u]=0|c:r.length--,r.strip()}s.prototype.toString=function(e,t){var r;if(t=0|t||1,16===(e=e||10)||"hex"===e){r="";for(var n=0,s=0,o=0;o<this.length;o++){var a=this.words[o],c=(16777215&(a<<n|s)).toString(16);r=0!==(s=a>>>24-n&16777215)||o!==this.length-1?h[6-c.length]+c+r:c+r,(n+=2)>=26&&(n-=26,o--)}for(0!==s&&(r=s.toString(16)+r);r.length%t!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}if(e===(0|e)&&e>=2&&e<=36){var u=d[e],f=l[e];r="";var p=this.clone();for(p.negative=0;!p.isZero();){var y=p.modn(f).toString(e);r=(p=p.idivn(f)).isZero()?y+r:h[u-y.length]+y+r}for(this.isZero()&&(r="0"+r);r.length%t!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}i(!1,"Base should be between 2 and 36")},s.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&i(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},s.prototype.toJSON=function(){return this.toString(16)},s.prototype.toBuffer=function(e,t){return i(void 0!==o),this.toArrayLike(o,e,t)},s.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},s.prototype.toArrayLike=function(e,t,r){var n=this.byteLength(),s=r||Math.max(1,n);i(n<=s,"byte array longer than desired length"),i(s>0,"Requested array length <= 0"),this.strip();var o,a,c="le"===t,u=new e(s),h=this.clone();if(c){for(a=0;!h.isZero();a++)o=h.andln(255),h.iushrn(8),u[a]=o;for(;a<s;a++)u[a]=0}else{for(a=0;a<s-n;a++)u[a]=0;for(a=0;!h.isZero();a++)o=h.andln(255),h.iushrn(8),u[s-a-1]=o}return u},Math.clz32?s.prototype._countBits=function(e){return 32-Math.clz32(e)}:s.prototype._countBits=function(e){var t=e,r=0;return t>=4096&&(r+=13,t>>>=13),t>=64&&(r+=7,t>>>=7),t>=8&&(r+=4,t>>>=4),t>=2&&(r+=2,t>>>=2),r+t},s.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,r=0;return 0==(8191&t)&&(r+=13,t>>>=13),0==(127&t)&&(r+=7,t>>>=7),0==(15&t)&&(r+=4,t>>>=4),0==(3&t)&&(r+=2,t>>>=2),0==(1&t)&&r++,r},s.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},s.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var r=this._zeroBits(this.words[t]);if(e+=r,26!==r)break}return e},s.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},s.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},s.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},s.prototype.isNeg=function(){return 0!==this.negative},s.prototype.neg=function(){return this.clone().ineg()},s.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},s.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},s.prototype.ior=function(e){return i(0==(this.negative|e.negative)),this.iuor(e)},s.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},s.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},s.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var r=0;r<t.length;r++)this.words[r]=this.words[r]&e.words[r];return this.length=t.length,this.strip()},s.prototype.iand=function(e){return i(0==(this.negative|e.negative)),this.iuand(e)},s.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},s.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},s.prototype.iuxor=function(e){var t,r;this.length>e.length?(t=this,r=e):(t=e,r=this);for(var i=0;i<r.length;i++)this.words[i]=t.words[i]^r.words[i];if(this!==t)for(;i<t.length;i++)this.words[i]=t.words[i];return this.length=t.length,this.strip()},s.prototype.ixor=function(e){return i(0==(this.negative|e.negative)),this.iuxor(e)},s.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},s.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},s.prototype.inotn=function(e){i("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),r=e%26;this._expand(t),r>0&&t--;for(var n=0;n<t;n++)this.words[n]=67108863&~this.words[n];return r>0&&(this.words[n]=~this.words[n]&67108863>>26-r),this.strip()},s.prototype.notn=function(e){return this.clone().inotn(e)},s.prototype.setn=function(e,t){i("number"==typeof e&&e>=0);var r=e/26|0,n=e%26;return this._expand(r+1),this.words[r]=t?this.words[r]|1<<n:this.words[r]&~(1<<n),this.strip()},s.prototype.iadd=function(e){var t,r,i;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(r=this,i=e):(r=e,i=this);for(var n=0,s=0;s<i.length;s++)t=(0|r.words[s])+(0|i.words[s])+n,this.words[s]=67108863&t,n=t>>>26;for(;0!==n&&s<r.length;s++)t=(0|r.words[s])+n,this.words[s]=67108863&t,n=t>>>26;if(this.length=r.length,0!==n)this.words[this.length]=n,this.length++;else if(r!==this)for(;s<r.length;s++)this.words[s]=r.words[s];return this},s.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},s.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var r,i,n=this.cmp(e);if(0===n)return this.negative=0,this.length=1,this.words[0]=0,this;n>0?(r=this,i=e):(r=e,i=this);for(var s=0,o=0;o<i.length;o++)s=(t=(0|r.words[o])-(0|i.words[o])+s)>>26,this.words[o]=67108863&t;for(;0!==s&&o<r.length;o++)s=(t=(0|r.words[o])+s)>>26,this.words[o]=67108863&t;if(0===s&&o<r.length&&r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this.length=Math.max(this.length,o),r!==this&&(this.negative=1),this.strip()},s.prototype.sub=function(e){return this.clone().isub(e)};var p=function(e,t,r){var i,n,s,o=e.words,a=t.words,c=r.words,u=0,h=0|o[0],d=8191&h,l=h>>>13,f=0|o[1],p=8191&f,y=f>>>13,m=0|o[2],g=8191&m,b=m>>>13,v=0|o[3],w=8191&v,S=v>>>13,_=0|o[4],A=8191&_,E=_>>>13,C=0|o[5],k=8191&C,T=C>>>13,P=0|o[6],I=8191&P,R=P>>>13,x=0|o[7],B=8191&x,O=x>>>13,M=0|o[8],N=8191&M,D=M>>>13,L=0|o[9],U=8191&L,j=L>>>13,q=0|a[0],K=8191&q,H=q>>>13,z=0|a[1],F=8191&z,V=z>>>13,$=0|a[2],W=8191&$,G=$>>>13,J=0|a[3],Y=8191&J,Z=J>>>13,X=0|a[4],Q=8191&X,ee=X>>>13,te=0|a[5],re=8191&te,ie=te>>>13,ne=0|a[6],se=8191&ne,oe=ne>>>13,ae=0|a[7],ce=8191&ae,ue=ae>>>13,he=0|a[8],de=8191&he,le=he>>>13,fe=0|a[9],pe=8191&fe,ye=fe>>>13;r.negative=e.negative^t.negative,r.length=19;var me=(u+(i=Math.imul(d,K))|0)+((8191&(n=(n=Math.imul(d,H))+Math.imul(l,K)|0))<<13)|0;u=((s=Math.imul(l,H))+(n>>>13)|0)+(me>>>26)|0,me&=67108863,i=Math.imul(p,K),n=(n=Math.imul(p,H))+Math.imul(y,K)|0,s=Math.imul(y,H);var ge=(u+(i=i+Math.imul(d,F)|0)|0)+((8191&(n=(n=n+Math.imul(d,V)|0)+Math.imul(l,F)|0))<<13)|0;u=((s=s+Math.imul(l,V)|0)+(n>>>13)|0)+(ge>>>26)|0,ge&=67108863,i=Math.imul(g,K),n=(n=Math.imul(g,H))+Math.imul(b,K)|0,s=Math.imul(b,H),i=i+Math.imul(p,F)|0,n=(n=n+Math.imul(p,V)|0)+Math.imul(y,F)|0,s=s+Math.imul(y,V)|0;var be=(u+(i=i+Math.imul(d,W)|0)|0)+((8191&(n=(n=n+Math.imul(d,G)|0)+Math.imul(l,W)|0))<<13)|0;u=((s=s+Math.imul(l,G)|0)+(n>>>13)|0)+(be>>>26)|0,be&=67108863,i=Math.imul(w,K),n=(n=Math.imul(w,H))+Math.imul(S,K)|0,s=Math.imul(S,H),i=i+Math.imul(g,F)|0,n=(n=n+Math.imul(g,V)|0)+Math.imul(b,F)|0,s=s+Math.imul(b,V)|0,i=i+Math.imul(p,W)|0,n=(n=n+Math.imul(p,G)|0)+Math.imul(y,W)|0,s=s+Math.imul(y,G)|0;var ve=(u+(i=i+Math.imul(d,Y)|0)|0)+((8191&(n=(n=n+Math.imul(d,Z)|0)+Math.imul(l,Y)|0))<<13)|0;u=((s=s+Math.imul(l,Z)|0)+(n>>>13)|0)+(ve>>>26)|0,ve&=67108863,i=Math.imul(A,K),n=(n=Math.imul(A,H))+Math.imul(E,K)|0,s=Math.imul(E,H),i=i+Math.imul(w,F)|0,n=(n=n+Math.imul(w,V)|0)+Math.imul(S,F)|0,s=s+Math.imul(S,V)|0,i=i+Math.imul(g,W)|0,n=(n=n+Math.imul(g,G)|0)+Math.imul(b,W)|0,s=s+Math.imul(b,G)|0,i=i+Math.imul(p,Y)|0,n=(n=n+Math.imul(p,Z)|0)+Math.imul(y,Y)|0,s=s+Math.imul(y,Z)|0;var we=(u+(i=i+Math.imul(d,Q)|0)|0)+((8191&(n=(n=n+Math.imul(d,ee)|0)+Math.imul(l,Q)|0))<<13)|0;u=((s=s+Math.imul(l,ee)|0)+(n>>>13)|0)+(we>>>26)|0,we&=67108863,i=Math.imul(k,K),n=(n=Math.imul(k,H))+Math.imul(T,K)|0,s=Math.imul(T,H),i=i+Math.imul(A,F)|0,n=(n=n+Math.imul(A,V)|0)+Math.imul(E,F)|0,s=s+Math.imul(E,V)|0,i=i+Math.imul(w,W)|0,n=(n=n+Math.imul(w,G)|0)+Math.imul(S,W)|0,s=s+Math.imul(S,G)|0,i=i+Math.imul(g,Y)|0,n=(n=n+Math.imul(g,Z)|0)+Math.imul(b,Y)|0,s=s+Math.imul(b,Z)|0,i=i+Math.imul(p,Q)|0,n=(n=n+Math.imul(p,ee)|0)+Math.imul(y,Q)|0,s=s+Math.imul(y,ee)|0;var Se=(u+(i=i+Math.imul(d,re)|0)|0)+((8191&(n=(n=n+Math.imul(d,ie)|0)+Math.imul(l,re)|0))<<13)|0;u=((s=s+Math.imul(l,ie)|0)+(n>>>13)|0)+(Se>>>26)|0,Se&=67108863,i=Math.imul(I,K),n=(n=Math.imul(I,H))+Math.imul(R,K)|0,s=Math.imul(R,H),i=i+Math.imul(k,F)|0,n=(n=n+Math.imul(k,V)|0)+Math.imul(T,F)|0,s=s+Math.imul(T,V)|0,i=i+Math.imul(A,W)|0,n=(n=n+Math.imul(A,G)|0)+Math.imul(E,W)|0,s=s+Math.imul(E,G)|0,i=i+Math.imul(w,Y)|0,n=(n=n+Math.imul(w,Z)|0)+Math.imul(S,Y)|0,s=s+Math.imul(S,Z)|0,i=i+Math.imul(g,Q)|0,n=(n=n+Math.imul(g,ee)|0)+Math.imul(b,Q)|0,s=s+Math.imul(b,ee)|0,i=i+Math.imul(p,re)|0,n=(n=n+Math.imul(p,ie)|0)+Math.imul(y,re)|0,s=s+Math.imul(y,ie)|0;var _e=(u+(i=i+Math.imul(d,se)|0)|0)+((8191&(n=(n=n+Math.imul(d,oe)|0)+Math.imul(l,se)|0))<<13)|0;u=((s=s+Math.imul(l,oe)|0)+(n>>>13)|0)+(_e>>>26)|0,_e&=67108863,i=Math.imul(B,K),n=(n=Math.imul(B,H))+Math.imul(O,K)|0,s=Math.imul(O,H),i=i+Math.imul(I,F)|0,n=(n=n+Math.imul(I,V)|0)+Math.imul(R,F)|0,s=s+Math.imul(R,V)|0,i=i+Math.imul(k,W)|0,n=(n=n+Math.imul(k,G)|0)+Math.imul(T,W)|0,s=s+Math.imul(T,G)|0,i=i+Math.imul(A,Y)|0,n=(n=n+Math.imul(A,Z)|0)+Math.imul(E,Y)|0,s=s+Math.imul(E,Z)|0,i=i+Math.imul(w,Q)|0,n=(n=n+Math.imul(w,ee)|0)+Math.imul(S,Q)|0,s=s+Math.imul(S,ee)|0,i=i+Math.imul(g,re)|0,n=(n=n+Math.imul(g,ie)|0)+Math.imul(b,re)|0,s=s+Math.imul(b,ie)|0,i=i+Math.imul(p,se)|0,n=(n=n+Math.imul(p,oe)|0)+Math.imul(y,se)|0,s=s+Math.imul(y,oe)|0;var Ae=(u+(i=i+Math.imul(d,ce)|0)|0)+((8191&(n=(n=n+Math.imul(d,ue)|0)+Math.imul(l,ce)|0))<<13)|0;u=((s=s+Math.imul(l,ue)|0)+(n>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,i=Math.imul(N,K),n=(n=Math.imul(N,H))+Math.imul(D,K)|0,s=Math.imul(D,H),i=i+Math.imul(B,F)|0,n=(n=n+Math.imul(B,V)|0)+Math.imul(O,F)|0,s=s+Math.imul(O,V)|0,i=i+Math.imul(I,W)|0,n=(n=n+Math.imul(I,G)|0)+Math.imul(R,W)|0,s=s+Math.imul(R,G)|0,i=i+Math.imul(k,Y)|0,n=(n=n+Math.imul(k,Z)|0)+Math.imul(T,Y)|0,s=s+Math.imul(T,Z)|0,i=i+Math.imul(A,Q)|0,n=(n=n+Math.imul(A,ee)|0)+Math.imul(E,Q)|0,s=s+Math.imul(E,ee)|0,i=i+Math.imul(w,re)|0,n=(n=n+Math.imul(w,ie)|0)+Math.imul(S,re)|0,s=s+Math.imul(S,ie)|0,i=i+Math.imul(g,se)|0,n=(n=n+Math.imul(g,oe)|0)+Math.imul(b,se)|0,s=s+Math.imul(b,oe)|0,i=i+Math.imul(p,ce)|0,n=(n=n+Math.imul(p,ue)|0)+Math.imul(y,ce)|0,s=s+Math.imul(y,ue)|0;var Ee=(u+(i=i+Math.imul(d,de)|0)|0)+((8191&(n=(n=n+Math.imul(d,le)|0)+Math.imul(l,de)|0))<<13)|0;u=((s=s+Math.imul(l,le)|0)+(n>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,i=Math.imul(U,K),n=(n=Math.imul(U,H))+Math.imul(j,K)|0,s=Math.imul(j,H),i=i+Math.imul(N,F)|0,n=(n=n+Math.imul(N,V)|0)+Math.imul(D,F)|0,s=s+Math.imul(D,V)|0,i=i+Math.imul(B,W)|0,n=(n=n+Math.imul(B,G)|0)+Math.imul(O,W)|0,s=s+Math.imul(O,G)|0,i=i+Math.imul(I,Y)|0,n=(n=n+Math.imul(I,Z)|0)+Math.imul(R,Y)|0,s=s+Math.imul(R,Z)|0,i=i+Math.imul(k,Q)|0,n=(n=n+Math.imul(k,ee)|0)+Math.imul(T,Q)|0,s=s+Math.imul(T,ee)|0,i=i+Math.imul(A,re)|0,n=(n=n+Math.imul(A,ie)|0)+Math.imul(E,re)|0,s=s+Math.imul(E,ie)|0,i=i+Math.imul(w,se)|0,n=(n=n+Math.imul(w,oe)|0)+Math.imul(S,se)|0,s=s+Math.imul(S,oe)|0,i=i+Math.imul(g,ce)|0,n=(n=n+Math.imul(g,ue)|0)+Math.imul(b,ce)|0,s=s+Math.imul(b,ue)|0,i=i+Math.imul(p,de)|0,n=(n=n+Math.imul(p,le)|0)+Math.imul(y,de)|0,s=s+Math.imul(y,le)|0;var Ce=(u+(i=i+Math.imul(d,pe)|0)|0)+((8191&(n=(n=n+Math.imul(d,ye)|0)+Math.imul(l,pe)|0))<<13)|0;u=((s=s+Math.imul(l,ye)|0)+(n>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,i=Math.imul(U,F),n=(n=Math.imul(U,V))+Math.imul(j,F)|0,s=Math.imul(j,V),i=i+Math.imul(N,W)|0,n=(n=n+Math.imul(N,G)|0)+Math.imul(D,W)|0,s=s+Math.imul(D,G)|0,i=i+Math.imul(B,Y)|0,n=(n=n+Math.imul(B,Z)|0)+Math.imul(O,Y)|0,s=s+Math.imul(O,Z)|0,i=i+Math.imul(I,Q)|0,n=(n=n+Math.imul(I,ee)|0)+Math.imul(R,Q)|0,s=s+Math.imul(R,ee)|0,i=i+Math.imul(k,re)|0,n=(n=n+Math.imul(k,ie)|0)+Math.imul(T,re)|0,s=s+Math.imul(T,ie)|0,i=i+Math.imul(A,se)|0,n=(n=n+Math.imul(A,oe)|0)+Math.imul(E,se)|0,s=s+Math.imul(E,oe)|0,i=i+Math.imul(w,ce)|0,n=(n=n+Math.imul(w,ue)|0)+Math.imul(S,ce)|0,s=s+Math.imul(S,ue)|0,i=i+Math.imul(g,de)|0,n=(n=n+Math.imul(g,le)|0)+Math.imul(b,de)|0,s=s+Math.imul(b,le)|0;var ke=(u+(i=i+Math.imul(p,pe)|0)|0)+((8191&(n=(n=n+Math.imul(p,ye)|0)+Math.imul(y,pe)|0))<<13)|0;u=((s=s+Math.imul(y,ye)|0)+(n>>>13)|0)+(ke>>>26)|0,ke&=67108863,i=Math.imul(U,W),n=(n=Math.imul(U,G))+Math.imul(j,W)|0,s=Math.imul(j,G),i=i+Math.imul(N,Y)|0,n=(n=n+Math.imul(N,Z)|0)+Math.imul(D,Y)|0,s=s+Math.imul(D,Z)|0,i=i+Math.imul(B,Q)|0,n=(n=n+Math.imul(B,ee)|0)+Math.imul(O,Q)|0,s=s+Math.imul(O,ee)|0,i=i+Math.imul(I,re)|0,n=(n=n+Math.imul(I,ie)|0)+Math.imul(R,re)|0,s=s+Math.imul(R,ie)|0,i=i+Math.imul(k,se)|0,n=(n=n+Math.imul(k,oe)|0)+Math.imul(T,se)|0,s=s+Math.imul(T,oe)|0,i=i+Math.imul(A,ce)|0,n=(n=n+Math.imul(A,ue)|0)+Math.imul(E,ce)|0,s=s+Math.imul(E,ue)|0,i=i+Math.imul(w,de)|0,n=(n=n+Math.imul(w,le)|0)+Math.imul(S,de)|0,s=s+Math.imul(S,le)|0;var Te=(u+(i=i+Math.imul(g,pe)|0)|0)+((8191&(n=(n=n+Math.imul(g,ye)|0)+Math.imul(b,pe)|0))<<13)|0;u=((s=s+Math.imul(b,ye)|0)+(n>>>13)|0)+(Te>>>26)|0,Te&=67108863,i=Math.imul(U,Y),n=(n=Math.imul(U,Z))+Math.imul(j,Y)|0,s=Math.imul(j,Z),i=i+Math.imul(N,Q)|0,n=(n=n+Math.imul(N,ee)|0)+Math.imul(D,Q)|0,s=s+Math.imul(D,ee)|0,i=i+Math.imul(B,re)|0,n=(n=n+Math.imul(B,ie)|0)+Math.imul(O,re)|0,s=s+Math.imul(O,ie)|0,i=i+Math.imul(I,se)|0,n=(n=n+Math.imul(I,oe)|0)+Math.imul(R,se)|0,s=s+Math.imul(R,oe)|0,i=i+Math.imul(k,ce)|0,n=(n=n+Math.imul(k,ue)|0)+Math.imul(T,ce)|0,s=s+Math.imul(T,ue)|0,i=i+Math.imul(A,de)|0,n=(n=n+Math.imul(A,le)|0)+Math.imul(E,de)|0,s=s+Math.imul(E,le)|0;var Pe=(u+(i=i+Math.imul(w,pe)|0)|0)+((8191&(n=(n=n+Math.imul(w,ye)|0)+Math.imul(S,pe)|0))<<13)|0;u=((s=s+Math.imul(S,ye)|0)+(n>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,i=Math.imul(U,Q),n=(n=Math.imul(U,ee))+Math.imul(j,Q)|0,s=Math.imul(j,ee),i=i+Math.imul(N,re)|0,n=(n=n+Math.imul(N,ie)|0)+Math.imul(D,re)|0,s=s+Math.imul(D,ie)|0,i=i+Math.imul(B,se)|0,n=(n=n+Math.imul(B,oe)|0)+Math.imul(O,se)|0,s=s+Math.imul(O,oe)|0,i=i+Math.imul(I,ce)|0,n=(n=n+Math.imul(I,ue)|0)+Math.imul(R,ce)|0,s=s+Math.imul(R,ue)|0,i=i+Math.imul(k,de)|0,n=(n=n+Math.imul(k,le)|0)+Math.imul(T,de)|0,s=s+Math.imul(T,le)|0;var Ie=(u+(i=i+Math.imul(A,pe)|0)|0)+((8191&(n=(n=n+Math.imul(A,ye)|0)+Math.imul(E,pe)|0))<<13)|0;u=((s=s+Math.imul(E,ye)|0)+(n>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,i=Math.imul(U,re),n=(n=Math.imul(U,ie))+Math.imul(j,re)|0,s=Math.imul(j,ie),i=i+Math.imul(N,se)|0,n=(n=n+Math.imul(N,oe)|0)+Math.imul(D,se)|0,s=s+Math.imul(D,oe)|0,i=i+Math.imul(B,ce)|0,n=(n=n+Math.imul(B,ue)|0)+Math.imul(O,ce)|0,s=s+Math.imul(O,ue)|0,i=i+Math.imul(I,de)|0,n=(n=n+Math.imul(I,le)|0)+Math.imul(R,de)|0,s=s+Math.imul(R,le)|0;var Re=(u+(i=i+Math.imul(k,pe)|0)|0)+((8191&(n=(n=n+Math.imul(k,ye)|0)+Math.imul(T,pe)|0))<<13)|0;u=((s=s+Math.imul(T,ye)|0)+(n>>>13)|0)+(Re>>>26)|0,Re&=67108863,i=Math.imul(U,se),n=(n=Math.imul(U,oe))+Math.imul(j,se)|0,s=Math.imul(j,oe),i=i+Math.imul(N,ce)|0,n=(n=n+Math.imul(N,ue)|0)+Math.imul(D,ce)|0,s=s+Math.imul(D,ue)|0,i=i+Math.imul(B,de)|0,n=(n=n+Math.imul(B,le)|0)+Math.imul(O,de)|0,s=s+Math.imul(O,le)|0;var xe=(u+(i=i+Math.imul(I,pe)|0)|0)+((8191&(n=(n=n+Math.imul(I,ye)|0)+Math.imul(R,pe)|0))<<13)|0;u=((s=s+Math.imul(R,ye)|0)+(n>>>13)|0)+(xe>>>26)|0,xe&=67108863,i=Math.imul(U,ce),n=(n=Math.imul(U,ue))+Math.imul(j,ce)|0,s=Math.imul(j,ue),i=i+Math.imul(N,de)|0,n=(n=n+Math.imul(N,le)|0)+Math.imul(D,de)|0,s=s+Math.imul(D,le)|0;var Be=(u+(i=i+Math.imul(B,pe)|0)|0)+((8191&(n=(n=n+Math.imul(B,ye)|0)+Math.imul(O,pe)|0))<<13)|0;u=((s=s+Math.imul(O,ye)|0)+(n>>>13)|0)+(Be>>>26)|0,Be&=67108863,i=Math.imul(U,de),n=(n=Math.imul(U,le))+Math.imul(j,de)|0,s=Math.imul(j,le);var Oe=(u+(i=i+Math.imul(N,pe)|0)|0)+((8191&(n=(n=n+Math.imul(N,ye)|0)+Math.imul(D,pe)|0))<<13)|0;u=((s=s+Math.imul(D,ye)|0)+(n>>>13)|0)+(Oe>>>26)|0,Oe&=67108863;var Me=(u+(i=Math.imul(U,pe))|0)+((8191&(n=(n=Math.imul(U,ye))+Math.imul(j,pe)|0))<<13)|0;return u=((s=Math.imul(j,ye))+(n>>>13)|0)+(Me>>>26)|0,Me&=67108863,c[0]=me,c[1]=ge,c[2]=be,c[3]=ve,c[4]=we,c[5]=Se,c[6]=_e,c[7]=Ae,c[8]=Ee,c[9]=Ce,c[10]=ke,c[11]=Te,c[12]=Pe,c[13]=Ie,c[14]=Re,c[15]=xe,c[16]=Be,c[17]=Oe,c[18]=Me,0!==u&&(c[19]=u,r.length++),r};function y(e,t,r){return(new m).mulp(e,t,r)}function m(e,t){this.x=e,this.y=t}Math.imul||(p=f),s.prototype.mulTo=function(e,t){var r,i=this.length+e.length;return r=10===this.length&&10===e.length?p(this,e,t):i<63?f(this,e,t):i<1024?function(e,t,r){r.negative=t.negative^e.negative,r.length=e.length+t.length;for(var i=0,n=0,s=0;s<r.length-1;s++){var o=n;n=0;for(var a=67108863&i,c=Math.min(s,t.length-1),u=Math.max(0,s-e.length+1);u<=c;u++){var h=s-u,d=(0|e.words[h])*(0|t.words[u]),l=67108863&d;a=67108863&(l=l+a|0),n+=(o=(o=o+(d/67108864|0)|0)+(l>>>26)|0)>>>26,o&=67108863}r.words[s]=a,i=o,o=n}return 0!==i?r.words[s]=i:r.length--,r.strip()}(this,e,t):y(this,e,t),r},m.prototype.makeRBT=function(e){for(var t=new Array(e),r=s.prototype._countBits(e)-1,i=0;i<e;i++)t[i]=this.revBin(i,r,e);return t},m.prototype.revBin=function(e,t,r){if(0===e||e===r-1)return e;for(var i=0,n=0;n<t;n++)i|=(1&e)<<t-n-1,e>>=1;return i},m.prototype.permute=function(e,t,r,i,n,s){for(var o=0;o<s;o++)i[o]=t[e[o]],n[o]=r[e[o]]},m.prototype.transform=function(e,t,r,i,n,s){this.permute(s,e,t,r,i,n);for(var o=1;o<n;o<<=1)for(var a=o<<1,c=Math.cos(2*Math.PI/a),u=Math.sin(2*Math.PI/a),h=0;h<n;h+=a)for(var d=c,l=u,f=0;f<o;f++){var p=r[h+f],y=i[h+f],m=r[h+f+o],g=i[h+f+o],b=d*m-l*g;g=d*g+l*m,m=b,r[h+f]=p+m,i[h+f]=y+g,r[h+f+o]=p-m,i[h+f+o]=y-g,f!==a&&(b=c*d-u*l,l=c*l+u*d,d=b)}},m.prototype.guessLen13b=function(e,t){var r=1|Math.max(t,e),i=1&r,n=0;for(r=r/2|0;r;r>>>=1)n++;return 1<<n+1+i},m.prototype.conjugate=function(e,t,r){if(!(r<=1))for(var i=0;i<r/2;i++){var n=e[i];e[i]=e[r-i-1],e[r-i-1]=n,n=t[i],t[i]=-t[r-i-1],t[r-i-1]=-n}},m.prototype.normalize13b=function(e,t){for(var r=0,i=0;i<t/2;i++){var n=8192*Math.round(e[2*i+1]/t)+Math.round(e[2*i]/t)+r;e[i]=67108863&n,r=n<67108864?0:n/67108864|0}return e},m.prototype.convert13b=function(e,t,r,n){for(var s=0,o=0;o<t;o++)s+=0|e[o],r[2*o]=8191&s,s>>>=13,r[2*o+1]=8191&s,s>>>=13;for(o=2*t;o<n;++o)r[o]=0;i(0===s),i(0==(-8192&s))},m.prototype.stub=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=0;return t},m.prototype.mulp=function(e,t,r){var i=2*this.guessLen13b(e.length,t.length),n=this.makeRBT(i),s=this.stub(i),o=new Array(i),a=new Array(i),c=new Array(i),u=new Array(i),h=new Array(i),d=new Array(i),l=r.words;l.length=i,this.convert13b(e.words,e.length,o,i),this.convert13b(t.words,t.length,u,i),this.transform(o,s,a,c,i,n),this.transform(u,s,h,d,i,n);for(var f=0;f<i;f++){var p=a[f]*h[f]-c[f]*d[f];c[f]=a[f]*d[f]+c[f]*h[f],a[f]=p}return this.conjugate(a,c,i),this.transform(a,c,l,s,i,n),this.conjugate(l,s,i),this.normalize13b(l,i),r.negative=e.negative^t.negative,r.length=e.length+t.length,r.strip()},s.prototype.mul=function(e){var t=new s(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},s.prototype.mulf=function(e){var t=new s(null);return t.words=new Array(this.length+e.length),y(this,e,t)},s.prototype.imul=function(e){return this.clone().mulTo(e,this)},s.prototype.imuln=function(e){i("number"==typeof e),i(e<67108864);for(var t=0,r=0;r<this.length;r++){var n=(0|this.words[r])*e,s=(67108863&n)+(67108863&t);t>>=26,t+=n/67108864|0,t+=s>>>26,this.words[r]=67108863&s}return 0!==t&&(this.words[r]=t,this.length++),this},s.prototype.muln=function(e){return this.clone().imuln(e)},s.prototype.sqr=function(){return this.mul(this)},s.prototype.isqr=function(){return this.imul(this.clone())},s.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),r=0;r<t.length;r++){var i=r/26|0,n=r%26;t[r]=(e.words[i]&1<<n)>>>n}return t}(e);if(0===t.length)return new s(1);for(var r=this,i=0;i<t.length&&0===t[i];i++,r=r.sqr());if(++i<t.length)for(var n=r.sqr();i<t.length;i++,n=n.sqr())0!==t[i]&&(r=r.mul(n));return r},s.prototype.iushln=function(e){i("number"==typeof e&&e>=0);var t,r=e%26,n=(e-r)/26,s=67108863>>>26-r<<26-r;if(0!==r){var o=0;for(t=0;t<this.length;t++){var a=this.words[t]&s,c=(0|this.words[t])-a<<r;this.words[t]=c|o,o=a>>>26-r}o&&(this.words[t]=o,this.length++)}if(0!==n){for(t=this.length-1;t>=0;t--)this.words[t+n]=this.words[t];for(t=0;t<n;t++)this.words[t]=0;this.length+=n}return this.strip()},s.prototype.ishln=function(e){return i(0===this.negative),this.iushln(e)},s.prototype.iushrn=function(e,t,r){var n;i("number"==typeof e&&e>=0),n=t?(t-t%26)/26:0;var s=e%26,o=Math.min((e-s)/26,this.length),a=67108863^67108863>>>s<<s,c=r;if(n-=o,n=Math.max(0,n),c){for(var u=0;u<o;u++)c.words[u]=this.words[u];c.length=o}if(0===o);else if(this.length>o)for(this.length-=o,u=0;u<this.length;u++)this.words[u]=this.words[u+o];else this.words[0]=0,this.length=1;var h=0;for(u=this.length-1;u>=0&&(0!==h||u>=n);u--){var d=0|this.words[u];this.words[u]=h<<26-s|d>>>s,h=d&a}return c&&0!==h&&(c.words[c.length++]=h),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},s.prototype.ishrn=function(e,t,r){return i(0===this.negative),this.iushrn(e,t,r)},s.prototype.shln=function(e){return this.clone().ishln(e)},s.prototype.ushln=function(e){return this.clone().iushln(e)},s.prototype.shrn=function(e){return this.clone().ishrn(e)},s.prototype.ushrn=function(e){return this.clone().iushrn(e)},s.prototype.testn=function(e){i("number"==typeof e&&e>=0);var t=e%26,r=(e-t)/26,n=1<<t;return!(this.length<=r)&&!!(this.words[r]&n)},s.prototype.imaskn=function(e){i("number"==typeof e&&e>=0);var t=e%26,r=(e-t)/26;if(i(0===this.negative,"imaskn works only with positive numbers"),this.length<=r)return this;if(0!==t&&r++,this.length=Math.min(r,this.length),0!==t){var n=67108863^67108863>>>t<<t;this.words[this.length-1]&=n}return this.strip()},s.prototype.maskn=function(e){return this.clone().imaskn(e)},s.prototype.iaddn=function(e){return i("number"==typeof e),i(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},s.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},s.prototype.isubn=function(e){if(i("number"==typeof e),i(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},s.prototype.addn=function(e){return this.clone().iaddn(e)},s.prototype.subn=function(e){return this.clone().isubn(e)},s.prototype.iabs=function(){return this.negative=0,this},s.prototype.abs=function(){return this.clone().iabs()},s.prototype._ishlnsubmul=function(e,t,r){var n,s,o=e.length+r;this._expand(o);var a=0;for(n=0;n<e.length;n++){s=(0|this.words[n+r])+a;var c=(0|e.words[n])*t;a=((s-=67108863&c)>>26)-(c/67108864|0),this.words[n+r]=67108863&s}for(;n<this.length-r;n++)a=(s=(0|this.words[n+r])+a)>>26,this.words[n+r]=67108863&s;if(0===a)return this.strip();for(i(-1===a),a=0,n=0;n<this.length;n++)a=(s=-(0|this.words[n])+a)>>26,this.words[n]=67108863&s;return this.negative=1,this.strip()},s.prototype._wordDiv=function(e,t){var r=(this.length,e.length),i=this.clone(),n=e,o=0|n.words[n.length-1];0!==(r=26-this._countBits(o))&&(n=n.ushln(r),i.iushln(r),o=0|n.words[n.length-1]);var a,c=i.length-n.length;if("mod"!==t){(a=new s(null)).length=c+1,a.words=new Array(a.length);for(var u=0;u<a.length;u++)a.words[u]=0}var h=i.clone()._ishlnsubmul(n,1,c);0===h.negative&&(i=h,a&&(a.words[c]=1));for(var d=c-1;d>=0;d--){var l=67108864*(0|i.words[n.length+d])+(0|i.words[n.length+d-1]);for(l=Math.min(l/o|0,67108863),i._ishlnsubmul(n,l,d);0!==i.negative;)l--,i.negative=0,i._ishlnsubmul(n,1,d),i.isZero()||(i.negative^=1);a&&(a.words[d]=l)}return a&&a.strip(),i.strip(),"div"!==t&&0!==r&&i.iushrn(r),{div:a||null,mod:i}},s.prototype.divmod=function(e,t,r){return i(!e.isZero()),this.isZero()?{div:new s(0),mod:new s(0)}:0!==this.negative&&0===e.negative?(a=this.neg().divmod(e,t),"mod"!==t&&(n=a.div.neg()),"div"!==t&&(o=a.mod.neg(),r&&0!==o.negative&&o.iadd(e)),{div:n,mod:o}):0===this.negative&&0!==e.negative?(a=this.divmod(e.neg(),t),"mod"!==t&&(n=a.div.neg()),{div:n,mod:a.mod}):0!=(this.negative&e.negative)?(a=this.neg().divmod(e.neg(),t),"div"!==t&&(o=a.mod.neg(),r&&0!==o.negative&&o.isub(e)),{div:a.div,mod:o}):e.length>this.length||this.cmp(e)<0?{div:new s(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new s(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new s(this.modn(e.words[0]))}:this._wordDiv(e,t);var n,o,a},s.prototype.div=function(e){return this.divmod(e,"div",!1).div},s.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},s.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},s.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var r=0!==t.div.negative?t.mod.isub(e):t.mod,i=e.ushrn(1),n=e.andln(1),s=r.cmp(i);return s<0||1===n&&0===s?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},s.prototype.modn=function(e){i(e<=67108863);for(var t=(1<<26)%e,r=0,n=this.length-1;n>=0;n--)r=(t*r+(0|this.words[n]))%e;return r},s.prototype.idivn=function(e){i(e<=67108863);for(var t=0,r=this.length-1;r>=0;r--){var n=(0|this.words[r])+67108864*t;this.words[r]=n/e|0,t=n%e}return this.strip()},s.prototype.divn=function(e){return this.clone().idivn(e)},s.prototype.egcd=function(e){i(0===e.negative),i(!e.isZero());var t=this,r=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var n=new s(1),o=new s(0),a=new s(0),c=new s(1),u=0;t.isEven()&&r.isEven();)t.iushrn(1),r.iushrn(1),++u;for(var h=r.clone(),d=t.clone();!t.isZero();){for(var l=0,f=1;0==(t.words[0]&f)&&l<26;++l,f<<=1);if(l>0)for(t.iushrn(l);l-- >0;)(n.isOdd()||o.isOdd())&&(n.iadd(h),o.isub(d)),n.iushrn(1),o.iushrn(1);for(var p=0,y=1;0==(r.words[0]&y)&&p<26;++p,y<<=1);if(p>0)for(r.iushrn(p);p-- >0;)(a.isOdd()||c.isOdd())&&(a.iadd(h),c.isub(d)),a.iushrn(1),c.iushrn(1);t.cmp(r)>=0?(t.isub(r),n.isub(a),o.isub(c)):(r.isub(t),a.isub(n),c.isub(o))}return{a,b:c,gcd:r.iushln(u)}},s.prototype._invmp=function(e){i(0===e.negative),i(!e.isZero());var t=this,r=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var n,o=new s(1),a=new s(0),c=r.clone();t.cmpn(1)>0&&r.cmpn(1)>0;){for(var u=0,h=1;0==(t.words[0]&h)&&u<26;++u,h<<=1);if(u>0)for(t.iushrn(u);u-- >0;)o.isOdd()&&o.iadd(c),o.iushrn(1);for(var d=0,l=1;0==(r.words[0]&l)&&d<26;++d,l<<=1);if(d>0)for(r.iushrn(d);d-- >0;)a.isOdd()&&a.iadd(c),a.iushrn(1);t.cmp(r)>=0?(t.isub(r),o.isub(a)):(r.isub(t),a.isub(o))}return(n=0===t.cmpn(1)?o:a).cmpn(0)<0&&n.iadd(e),n},s.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),r=e.clone();t.negative=0,r.negative=0;for(var i=0;t.isEven()&&r.isEven();i++)t.iushrn(1),r.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;r.isEven();)r.iushrn(1);var n=t.cmp(r);if(n<0){var s=t;t=r,r=s}else if(0===n||0===r.cmpn(1))break;t.isub(r)}return r.iushln(i)},s.prototype.invm=function(e){return this.egcd(e).a.umod(e)},s.prototype.isEven=function(){return 0==(1&this.words[0])},s.prototype.isOdd=function(){return 1==(1&this.words[0])},s.prototype.andln=function(e){return this.words[0]&e},s.prototype.bincn=function(e){i("number"==typeof e);var t=e%26,r=(e-t)/26,n=1<<t;if(this.length<=r)return this._expand(r+1),this.words[r]|=n,this;for(var s=n,o=r;0!==s&&o<this.length;o++){var a=0|this.words[o];s=(a+=s)>>>26,a&=67108863,this.words[o]=a}return 0!==s&&(this.words[o]=s,this.length++),this},s.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},s.prototype.cmpn=function(e){var t,r=e<0;if(0!==this.negative&&!r)return-1;if(0===this.negative&&r)return 1;if(this.strip(),this.length>1)t=1;else{r&&(e=-e),i(e<=67108863,"Number is too big");var n=0|this.words[0];t=n===e?0:n<e?-1:1}return 0!==this.negative?0|-t:t},s.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},s.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,r=this.length-1;r>=0;r--){var i=0|this.words[r],n=0|e.words[r];if(i!==n){i<n?t=-1:i>n&&(t=1);break}}return t},s.prototype.gtn=function(e){return 1===this.cmpn(e)},s.prototype.gt=function(e){return 1===this.cmp(e)},s.prototype.gten=function(e){return this.cmpn(e)>=0},s.prototype.gte=function(e){return this.cmp(e)>=0},s.prototype.ltn=function(e){return-1===this.cmpn(e)},s.prototype.lt=function(e){return-1===this.cmp(e)},s.prototype.lten=function(e){return this.cmpn(e)<=0},s.prototype.lte=function(e){return this.cmp(e)<=0},s.prototype.eqn=function(e){return 0===this.cmpn(e)},s.prototype.eq=function(e){return 0===this.cmp(e)},s.red=function(e){return new A(e)},s.prototype.toRed=function(e){return i(!this.red,"Already a number in reduction context"),i(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},s.prototype.fromRed=function(){return i(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},s.prototype._forceRed=function(e){return this.red=e,this},s.prototype.forceRed=function(e){return i(!this.red,"Already a number in reduction context"),this._forceRed(e)},s.prototype.redAdd=function(e){return i(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},s.prototype.redIAdd=function(e){return i(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},s.prototype.redSub=function(e){return i(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},s.prototype.redISub=function(e){return i(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},s.prototype.redShl=function(e){return i(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},s.prototype.redMul=function(e){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},s.prototype.redIMul=function(e){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},s.prototype.redSqr=function(){return i(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},s.prototype.redISqr=function(){return i(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},s.prototype.redSqrt=function(){return i(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},s.prototype.redInvm=function(){return i(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},s.prototype.redNeg=function(){return i(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},s.prototype.redPow=function(e){return i(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var g={k256:null,p224:null,p192:null,p25519:null};function b(e,t){this.name=e,this.p=new s(t,16),this.n=this.p.bitLength(),this.k=new s(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function v(){b.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function w(){b.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function S(){b.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function _(){b.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function A(e){if("string"==typeof e){var t=s._prime(e);this.m=t.p,this.prime=t}else i(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function E(e){A.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new s(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}b.prototype._tmp=function(){var e=new s(null);return e.words=new Array(Math.ceil(this.n/13)),e},b.prototype.ireduce=function(e){var t,r=e;do{this.split(r,this.tmp),t=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(t>this.n);var i=t<this.n?-1:r.ucmp(this.p);return 0===i?(r.words[0]=0,r.length=1):i>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},b.prototype.split=function(e,t){e.iushrn(this.n,0,t)},b.prototype.imulK=function(e){return e.imul(this.k)},n(v,b),v.prototype.split=function(e,t){for(var r=4194303,i=Math.min(e.length,9),n=0;n<i;n++)t.words[n]=e.words[n];if(t.length=i,e.length<=9)return e.words[0]=0,void(e.length=1);var s=e.words[9];for(t.words[t.length++]=s&r,n=10;n<e.length;n++){var o=0|e.words[n];e.words[n-10]=(o&r)<<4|s>>>22,s=o}s>>>=22,e.words[n-10]=s,0===s&&e.length>10?e.length-=10:e.length-=9},v.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,r=0;r<e.length;r++){var i=0|e.words[r];t+=977*i,e.words[r]=67108863&t,t=64*i+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},n(w,b),n(S,b),n(_,b),_.prototype.imulK=function(e){for(var t=0,r=0;r<e.length;r++){var i=19*(0|e.words[r])+t,n=67108863&i;i>>>=26,e.words[r]=n,t=i}return 0!==t&&(e.words[e.length++]=t),e},s._prime=function(e){if(g[e])return g[e];var t;if("k256"===e)t=new v;else if("p224"===e)t=new w;else if("p192"===e)t=new S;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new _}return g[e]=t,t},A.prototype._verify1=function(e){i(0===e.negative,"red works only with positives"),i(e.red,"red works only with red numbers")},A.prototype._verify2=function(e,t){i(0==(e.negative|t.negative),"red works only with positives"),i(e.red&&e.red===t.red,"red works only with red numbers")},A.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},A.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},A.prototype.add=function(e,t){this._verify2(e,t);var r=e.add(t);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},A.prototype.iadd=function(e,t){this._verify2(e,t);var r=e.iadd(t);return r.cmp(this.m)>=0&&r.isub(this.m),r},A.prototype.sub=function(e,t){this._verify2(e,t);var r=e.sub(t);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},A.prototype.isub=function(e,t){this._verify2(e,t);var r=e.isub(t);return r.cmpn(0)<0&&r.iadd(this.m),r},A.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},A.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},A.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},A.prototype.isqr=function(e){return this.imul(e,e.clone())},A.prototype.sqr=function(e){return this.mul(e,e)},A.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(i(t%2==1),3===t){var r=this.m.add(new s(1)).iushrn(2);return this.pow(e,r)}for(var n=this.m.subn(1),o=0;!n.isZero()&&0===n.andln(1);)o++,n.iushrn(1);i(!n.isZero());var a=new s(1).toRed(this),c=a.redNeg(),u=this.m.subn(1).iushrn(1),h=this.m.bitLength();for(h=new s(2*h*h).toRed(this);0!==this.pow(h,u).cmp(c);)h.redIAdd(c);for(var d=this.pow(h,n),l=this.pow(e,n.addn(1).iushrn(1)),f=this.pow(e,n),p=o;0!==f.cmp(a);){for(var y=f,m=0;0!==y.cmp(a);m++)y=y.redSqr();i(m<p);var g=this.pow(d,new s(1).iushln(p-m-1));l=l.redMul(g),d=g.redSqr(),f=f.redMul(d),p=m}return l},A.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},A.prototype.pow=function(e,t){if(t.isZero())return new s(1).toRed(this);if(0===t.cmpn(1))return e.clone();var r=new Array(16);r[0]=new s(1).toRed(this),r[1]=e;for(var i=2;i<r.length;i++)r[i]=this.mul(r[i-1],e);var n=r[0],o=0,a=0,c=t.bitLength()%26;for(0===c&&(c=26),i=t.length-1;i>=0;i--){for(var u=t.words[i],h=c-1;h>=0;h--){var d=u>>h&1;n!==r[0]&&(n=this.sqr(n)),0!==d||0!==o?(o<<=1,o|=d,(4===++a||0===i&&0===h)&&(n=this.mul(n,r[o]),a=0,o=0)):a=0}c=26}return n},A.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},A.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},s.mont=function(e){return new E(e)},n(E,A),E.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},E.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},E.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var r=e.imul(t),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),s=n;return n.cmp(this.m)>=0?s=n.isub(this.m):n.cmpn(0)<0&&(s=n.iadd(this.m)),s._forceRed(this)},E.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new s(0)._forceRed(this);var r=e.mul(t),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),o=n;return n.cmp(this.m)>=0?o=n.isub(this.m):n.cmpn(0)<0&&(o=n.iadd(this.m)),o._forceRed(this)},E.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e=r.nmd(e),this)},8185:(e,t,r)=>{var i;function n(e){this.rand=e}if(e.exports=function(e){return i||(i=new n(null)),i.generate(e)},e.exports.Rand=n,n.prototype.generate=function(e){return this._rand(e)},n.prototype._rand=function(e){if(this.rand.getBytes)return this.rand.getBytes(e);for(var t=new Uint8Array(e),r=0;r<t.length;r++)t[r]=this.rand.getByte();return t},"object"==typeof self)self.crypto&&self.crypto.getRandomValues?n.prototype._rand=function(e){var t=new Uint8Array(e);return self.crypto.getRandomValues(t),t}:self.msCrypto&&self.msCrypto.getRandomValues?n.prototype._rand=function(e){var t=new Uint8Array(e);return self.msCrypto.getRandomValues(t),t}:"object"==typeof window&&(n.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var s=r(6113);if("function"!=typeof s.randomBytes)throw new Error("Not supported");n.prototype._rand=function(e){return s.randomBytes(e)}}catch(e){}},2992:(e,t,r)=>{var i=r(4300).Buffer,n=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];function s(e){if(i.isBuffer(e))return e;var t="function"==typeof i.alloc&&"function"==typeof i.from;if("number"==typeof e)return t?i.alloc(e):new i(e);if("string"==typeof e)return t?i.from(e):new i(e);throw new Error("input must be buffer, number, or string, received "+typeof e)}function o(e){var t=s(4);return t.writeInt32BE(e,0),t}function a(e,t){e=s(e),i.isBuffer(t)&&(t=t.readUInt32BE(0));for(var r=-1^~~t,o=0;o<e.length;o++)r=n[255&(r^e[o])]^r>>>8;return-1^r}function c(){return o(a.apply(null,arguments))}"undefined"!=typeof Int32Array&&(n=new Int32Array(n)),c.signed=function(){return a.apply(null,arguments)},c.unsigned=function(){return a.apply(null,arguments)>>>0},e.exports=c},6585:(e,t,r)=>{"use strict";function i(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function n(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function o(e){n(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"===s(e)&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):("string"!=typeof e&&"[object String]"!==t||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn((new Error).stack)),new Date(NaN))}function a(e,t){n(2,arguments);var r=o(e),s=i(t);if(isNaN(s))return new Date(NaN);if(!s)return r;var a=r.getDate(),c=new Date(r.getTime());c.setMonth(r.getMonth()+s+1,0);var u=c.getDate();return a>=u?c:(r.setFullYear(c.getFullYear(),c.getMonth(),a),r)}function c(e,t){n(2,arguments);var r=i(t);return a(e,12*r)}r.r(t),r.d(t,{default:()=>c})},7142:(e,t,r)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let i=0,n=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(i++,"%c"===e&&(n=i))})),t.splice(n,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(9067)(t);const{formatters:i}=e.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},9067:(e,t,r)=>{e.exports=function(e){function t(e){let r,n,s,o=null;function a(...e){if(!a.enabled)return;const i=a,n=Number(new Date),s=n-(r||n);i.diff=s,i.prev=r,i.curr=n,r=n,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,n)=>{if("%%"===r)return"%";o++;const s=t.formatters[n];if("function"==typeof s){const t=e[o];r=s.call(i,t),e.splice(o,1),o--}return r})),t.formatArgs.call(i,e);(i.log||t.log).apply(i,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=i,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(n!==t.namespaces&&(n=t.namespaces,s=t.enabled(e)),s),set:e=>{o=e}}),"function"==typeof t.init&&t.init(a),a}function i(e,r){const i=t(this.namespace+(void 0===r?":":r)+e);return i.log=this.log,i}function n(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(n),...t.skips.map(n).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const i=("string"==typeof e?e:"").split(/[\s,]+/),n=i.length;for(r=0;r<n;r++)i[r]&&("-"===(e=i[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,i;for(r=0,i=t.skips.length;r<i;r++)if(t.skips[r].test(e))return!1;for(r=0,i=t.names.length;r<i;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(1126),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},5493:(e,t,r)=>{"undefined"==typeof process||"renderer"===process.type||!0===process.browser||process.__nwjs?e.exports=r(7142):e.exports=r(3991)},3991:(e,t,r)=>{const i=r(6224),n=r(3837);t.init=function(e){e.inspectOpts={};const r=Object.keys(t.inspectOpts);for(let i=0;i<r.length;i++)e.inspectOpts[r[i]]=t.inspectOpts[r[i]]},t.log=function(...e){return process.stderr.write(n.format(...e)+"\n")},t.formatArgs=function(r){const{namespace:i,useColors:n}=this;if(n){const t=this.color,n="[3"+(t<8?t:"8;5;"+t),s=`  ${n};1m${i} [0m`;r[0]=s+r[0].split("\n").join("\n"+s),r.push(n+"m+"+e.exports.humanize(this.diff)+"[0m")}else r[0]=function(){if(t.inspectOpts.hideDate)return"";return(new Date).toISOString()+" "}()+i+" "+r[0]},t.save=function(e){e?process.env.DEBUG=e:delete process.env.DEBUG},t.load=function(){return process.env.DEBUG},t.useColors=function(){return"colors"in t.inspectOpts?Boolean(t.inspectOpts.colors):i.isatty(process.stderr.fd)},t.destroy=n.deprecate((()=>{}),"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),t.colors=[6,2,3,4,5,1];try{const e=r(8352);e&&(e.stderr||e).level>=2&&(t.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(e){}t.inspectOpts=Object.keys(process.env).filter((e=>/^debug_/i.test(e))).reduce(((e,t)=>{const r=t.substring(6).toLowerCase().replace(/_([a-z])/g,((e,t)=>t.toUpperCase()));let i=process.env[t];return i=!!/^(yes|on|true|enabled)$/i.test(i)||!/^(no|off|false|disabled)$/i.test(i)&&("null"===i?null:Number(i)),e[r]=i,e}),{}),e.exports=r(9067)(t);const{formatters:s}=e.exports;s.o=function(e){return this.inspectOpts.colors=this.useColors,n.inspect(e,this.inspectOpts).split("\n").map((e=>e.trim())).join(" ")},s.O=function(e){return this.inspectOpts.colors=this.useColors,n.inspect(e,this.inspectOpts)}},4676:(e,t,r)=>{"use strict";var i=t;i.version=r(9813).i8,i.utils=r(809),i.rand=r(8185),i.curve=r(6004),i.curves=r(2015),i.ec=r(7237),i.eddsa=r(6319)},3539:(e,t,r)=>{"use strict";var i=r(1531),n=r(809),s=n.getNAF,o=n.getJSF,a=n.assert;function c(e,t){this.type=e,this.p=new i(t.p,16),this.red=t.prime?i.red(t.prime):i.mont(this.p),this.zero=new i(0).toRed(this.red),this.one=new i(1).toRed(this.red),this.two=new i(2).toRed(this.red),this.n=t.n&&new i(t.n,16),this.g=t.g&&this.pointFromJSON(t.g,t.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var r=this.n&&this.p.div(this.n);!r||r.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}function u(e,t){this.curve=e,this.type=t,this.precomputed=null}e.exports=c,c.prototype.point=function(){throw new Error("Not implemented")},c.prototype.validate=function(){throw new Error("Not implemented")},c.prototype._fixedNafMul=function(e,t){a(e.precomputed);var r=e._getDoubles(),i=s(t,1,this._bitLength),n=(1<<r.step+1)-(r.step%2==0?2:1);n/=3;var o,c,u=[];for(o=0;o<i.length;o+=r.step){c=0;for(var h=o+r.step-1;h>=o;h--)c=(c<<1)+i[h];u.push(c)}for(var d=this.jpoint(null,null,null),l=this.jpoint(null,null,null),f=n;f>0;f--){for(o=0;o<u.length;o++)(c=u[o])===f?l=l.mixedAdd(r.points[o]):c===-f&&(l=l.mixedAdd(r.points[o].neg()));d=d.add(l)}return d.toP()},c.prototype._wnafMul=function(e,t){var r=4,i=e._getNAFPoints(r);r=i.wnd;for(var n=i.points,o=s(t,r,this._bitLength),c=this.jpoint(null,null,null),u=o.length-1;u>=0;u--){for(var h=0;u>=0&&0===o[u];u--)h++;if(u>=0&&h++,c=c.dblp(h),u<0)break;var d=o[u];a(0!==d),c="affine"===e.type?d>0?c.mixedAdd(n[d-1>>1]):c.mixedAdd(n[-d-1>>1].neg()):d>0?c.add(n[d-1>>1]):c.add(n[-d-1>>1].neg())}return"affine"===e.type?c.toP():c},c.prototype._wnafMulAdd=function(e,t,r,i,n){var a,c,u,h=this._wnafT1,d=this._wnafT2,l=this._wnafT3,f=0;for(a=0;a<i;a++){var p=(u=t[a])._getNAFPoints(e);h[a]=p.wnd,d[a]=p.points}for(a=i-1;a>=1;a-=2){var y=a-1,m=a;if(1===h[y]&&1===h[m]){var g=[t[y],null,null,t[m]];0===t[y].y.cmp(t[m].y)?(g[1]=t[y].add(t[m]),g[2]=t[y].toJ().mixedAdd(t[m].neg())):0===t[y].y.cmp(t[m].y.redNeg())?(g[1]=t[y].toJ().mixedAdd(t[m]),g[2]=t[y].add(t[m].neg())):(g[1]=t[y].toJ().mixedAdd(t[m]),g[2]=t[y].toJ().mixedAdd(t[m].neg()));var b=[-3,-1,-5,-7,0,7,5,1,3],v=o(r[y],r[m]);for(f=Math.max(v[0].length,f),l[y]=new Array(f),l[m]=new Array(f),c=0;c<f;c++){var w=0|v[0][c],S=0|v[1][c];l[y][c]=b[3*(w+1)+(S+1)],l[m][c]=0,d[y]=g}}else l[y]=s(r[y],h[y],this._bitLength),l[m]=s(r[m],h[m],this._bitLength),f=Math.max(l[y].length,f),f=Math.max(l[m].length,f)}var _=this.jpoint(null,null,null),A=this._wnafT4;for(a=f;a>=0;a--){for(var E=0;a>=0;){var C=!0;for(c=0;c<i;c++)A[c]=0|l[c][a],0!==A[c]&&(C=!1);if(!C)break;E++,a--}if(a>=0&&E++,_=_.dblp(E),a<0)break;for(c=0;c<i;c++){var k=A[c];0!==k&&(k>0?u=d[c][k-1>>1]:k<0&&(u=d[c][-k-1>>1].neg()),_="affine"===u.type?_.mixedAdd(u):_.add(u))}}for(a=0;a<i;a++)d[a]=null;return n?_:_.toP()},c.BasePoint=u,u.prototype.eq=function(){throw new Error("Not implemented")},u.prototype.validate=function(){return this.curve.validate(this)},c.prototype.decodePoint=function(e,t){e=n.toArray(e,t);var r=this.p.byteLength();if((4===e[0]||6===e[0]||7===e[0])&&e.length-1==2*r)return 6===e[0]?a(e[e.length-1]%2==0):7===e[0]&&a(e[e.length-1]%2==1),this.point(e.slice(1,1+r),e.slice(1+r,1+2*r));if((2===e[0]||3===e[0])&&e.length-1===r)return this.pointFromX(e.slice(1,1+r),3===e[0]);throw new Error("Unknown point format")},u.prototype.encodeCompressed=function(e){return this.encode(e,!0)},u.prototype._encode=function(e){var t=this.curve.p.byteLength(),r=this.getX().toArray("be",t);return e?[this.getY().isEven()?2:3].concat(r):[4].concat(r,this.getY().toArray("be",t))},u.prototype.encode=function(e,t){return n.encode(this._encode(t),e)},u.prototype.precompute=function(e){if(this.precomputed)return this;var t={doubles:null,naf:null,beta:null};return t.naf=this._getNAFPoints(8),t.doubles=this._getDoubles(4,e),t.beta=this._getBeta(),this.precomputed=t,this},u.prototype._hasDoubles=function(e){if(!this.precomputed)return!1;var t=this.precomputed.doubles;return!!t&&t.points.length>=Math.ceil((e.bitLength()+1)/t.step)},u.prototype._getDoubles=function(e,t){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var r=[this],i=this,n=0;n<t;n+=e){for(var s=0;s<e;s++)i=i.dbl();r.push(i)}return{step:e,points:r}},u.prototype._getNAFPoints=function(e){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var t=[this],r=(1<<e)-1,i=1===r?null:this.dbl(),n=1;n<r;n++)t[n]=t[n-1].add(i);return{wnd:e,points:t}},u.prototype._getBeta=function(){return null},u.prototype.dblp=function(e){for(var t=this,r=0;r<e;r++)t=t.dbl();return t}},7486:(e,t,r)=>{"use strict";var i=r(809),n=r(1531),s=r(2003),o=r(3539),a=i.assert;function c(e){this.twisted=1!=(0|e.a),this.mOneA=this.twisted&&-1==(0|e.a),this.extended=this.mOneA,o.call(this,"edwards",e),this.a=new n(e.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new n(e.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new n(e.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),a(!this.twisted||0===this.c.fromRed().cmpn(1)),this.oneC=1==(0|e.c)}function u(e,t,r,i,s){o.BasePoint.call(this,e,"projective"),null===t&&null===r&&null===i?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new n(t,16),this.y=new n(r,16),this.z=i?new n(i,16):this.curve.one,this.t=s&&new n(s,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}s(c,o),e.exports=c,c.prototype._mulA=function(e){return this.mOneA?e.redNeg():this.a.redMul(e)},c.prototype._mulC=function(e){return this.oneC?e:this.c.redMul(e)},c.prototype.jpoint=function(e,t,r,i){return this.point(e,t,r,i)},c.prototype.pointFromX=function(e,t){(e=new n(e,16)).red||(e=e.toRed(this.red));var r=e.redSqr(),i=this.c2.redSub(this.a.redMul(r)),s=this.one.redSub(this.c2.redMul(this.d).redMul(r)),o=i.redMul(s.redInvm()),a=o.redSqrt();if(0!==a.redSqr().redSub(o).cmp(this.zero))throw new Error("invalid point");var c=a.fromRed().isOdd();return(t&&!c||!t&&c)&&(a=a.redNeg()),this.point(e,a)},c.prototype.pointFromY=function(e,t){(e=new n(e,16)).red||(e=e.toRed(this.red));var r=e.redSqr(),i=r.redSub(this.c2),s=r.redMul(this.d).redMul(this.c2).redSub(this.a),o=i.redMul(s.redInvm());if(0===o.cmp(this.zero)){if(t)throw new Error("invalid point");return this.point(this.zero,e)}var a=o.redSqrt();if(0!==a.redSqr().redSub(o).cmp(this.zero))throw new Error("invalid point");return a.fromRed().isOdd()!==t&&(a=a.redNeg()),this.point(a,e)},c.prototype.validate=function(e){if(e.isInfinity())return!0;e.normalize();var t=e.x.redSqr(),r=e.y.redSqr(),i=t.redMul(this.a).redAdd(r),n=this.c2.redMul(this.one.redAdd(this.d.redMul(t).redMul(r)));return 0===i.cmp(n)},s(u,o.BasePoint),c.prototype.pointFromJSON=function(e){return u.fromJSON(this,e)},c.prototype.point=function(e,t,r,i){return new u(this,e,t,r,i)},u.fromJSON=function(e,t){return new u(e,t[0],t[1],t[2])},u.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},u.prototype.isInfinity=function(){return 0===this.x.cmpn(0)&&(0===this.y.cmp(this.z)||this.zOne&&0===this.y.cmp(this.curve.c))},u.prototype._extDbl=function(){var e=this.x.redSqr(),t=this.y.redSqr(),r=this.z.redSqr();r=r.redIAdd(r);var i=this.curve._mulA(e),n=this.x.redAdd(this.y).redSqr().redISub(e).redISub(t),s=i.redAdd(t),o=s.redSub(r),a=i.redSub(t),c=n.redMul(o),u=s.redMul(a),h=n.redMul(a),d=o.redMul(s);return this.curve.point(c,u,d,h)},u.prototype._projDbl=function(){var e,t,r,i,n,s,o=this.x.redAdd(this.y).redSqr(),a=this.x.redSqr(),c=this.y.redSqr();if(this.curve.twisted){var u=(i=this.curve._mulA(a)).redAdd(c);this.zOne?(e=o.redSub(a).redSub(c).redMul(u.redSub(this.curve.two)),t=u.redMul(i.redSub(c)),r=u.redSqr().redSub(u).redSub(u)):(n=this.z.redSqr(),s=u.redSub(n).redISub(n),e=o.redSub(a).redISub(c).redMul(s),t=u.redMul(i.redSub(c)),r=u.redMul(s))}else i=a.redAdd(c),n=this.curve._mulC(this.z).redSqr(),s=i.redSub(n).redSub(n),e=this.curve._mulC(o.redISub(i)).redMul(s),t=this.curve._mulC(i).redMul(a.redISub(c)),r=i.redMul(s);return this.curve.point(e,t,r)},u.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()},u.prototype._extAdd=function(e){var t=this.y.redSub(this.x).redMul(e.y.redSub(e.x)),r=this.y.redAdd(this.x).redMul(e.y.redAdd(e.x)),i=this.t.redMul(this.curve.dd).redMul(e.t),n=this.z.redMul(e.z.redAdd(e.z)),s=r.redSub(t),o=n.redSub(i),a=n.redAdd(i),c=r.redAdd(t),u=s.redMul(o),h=a.redMul(c),d=s.redMul(c),l=o.redMul(a);return this.curve.point(u,h,l,d)},u.prototype._projAdd=function(e){var t,r,i=this.z.redMul(e.z),n=i.redSqr(),s=this.x.redMul(e.x),o=this.y.redMul(e.y),a=this.curve.d.redMul(s).redMul(o),c=n.redSub(a),u=n.redAdd(a),h=this.x.redAdd(this.y).redMul(e.x.redAdd(e.y)).redISub(s).redISub(o),d=i.redMul(c).redMul(h);return this.curve.twisted?(t=i.redMul(u).redMul(o.redSub(this.curve._mulA(s))),r=c.redMul(u)):(t=i.redMul(u).redMul(o.redSub(s)),r=this.curve._mulC(c).redMul(u)),this.curve.point(d,t,r)},u.prototype.add=function(e){return this.isInfinity()?e:e.isInfinity()?this:this.curve.extended?this._extAdd(e):this._projAdd(e)},u.prototype.mul=function(e){return this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve._wnafMul(this,e)},u.prototype.mulAdd=function(e,t,r){return this.curve._wnafMulAdd(1,[this,t],[e,r],2,!1)},u.prototype.jmulAdd=function(e,t,r){return this.curve._wnafMulAdd(1,[this,t],[e,r],2,!0)},u.prototype.normalize=function(){if(this.zOne)return this;var e=this.z.redInvm();return this.x=this.x.redMul(e),this.y=this.y.redMul(e),this.t&&(this.t=this.t.redMul(e)),this.z=this.curve.one,this.zOne=!0,this},u.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())},u.prototype.getX=function(){return this.normalize(),this.x.fromRed()},u.prototype.getY=function(){return this.normalize(),this.y.fromRed()},u.prototype.eq=function(e){return this===e||0===this.getX().cmp(e.getX())&&0===this.getY().cmp(e.getY())},u.prototype.eqXToP=function(e){var t=e.toRed(this.curve.red).redMul(this.z);if(0===this.x.cmp(t))return!0;for(var r=e.clone(),i=this.curve.redN.redMul(this.z);;){if(r.iadd(this.curve.n),r.cmp(this.curve.p)>=0)return!1;if(t.redIAdd(i),0===this.x.cmp(t))return!0}},u.prototype.toP=u.prototype.normalize,u.prototype.mixedAdd=u.prototype.add},6004:(e,t,r)=>{"use strict";var i=t;i.base=r(3539),i.short=r(4899),i.mont=r(4706),i.edwards=r(7486)},4706:(e,t,r)=>{"use strict";var i=r(1531),n=r(2003),s=r(3539),o=r(809);function a(e){s.call(this,"mont",e),this.a=new i(e.a,16).toRed(this.red),this.b=new i(e.b,16).toRed(this.red),this.i4=new i(4).toRed(this.red).redInvm(),this.two=new i(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}function c(e,t,r){s.BasePoint.call(this,e,"projective"),null===t&&null===r?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new i(t,16),this.z=new i(r,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}n(a,s),e.exports=a,a.prototype.validate=function(e){var t=e.normalize().x,r=t.redSqr(),i=r.redMul(t).redAdd(r.redMul(this.a)).redAdd(t);return 0===i.redSqrt().redSqr().cmp(i)},n(c,s.BasePoint),a.prototype.decodePoint=function(e,t){return this.point(o.toArray(e,t),1)},a.prototype.point=function(e,t){return new c(this,e,t)},a.prototype.pointFromJSON=function(e){return c.fromJSON(this,e)},c.prototype.precompute=function(){},c.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())},c.fromJSON=function(e,t){return new c(e,t[0],t[1]||e.one)},c.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},c.prototype.isInfinity=function(){return 0===this.z.cmpn(0)},c.prototype.dbl=function(){var e=this.x.redAdd(this.z).redSqr(),t=this.x.redSub(this.z).redSqr(),r=e.redSub(t),i=e.redMul(t),n=r.redMul(t.redAdd(this.curve.a24.redMul(r)));return this.curve.point(i,n)},c.prototype.add=function(){throw new Error("Not supported on Montgomery curve")},c.prototype.diffAdd=function(e,t){var r=this.x.redAdd(this.z),i=this.x.redSub(this.z),n=e.x.redAdd(e.z),s=e.x.redSub(e.z).redMul(r),o=n.redMul(i),a=t.z.redMul(s.redAdd(o).redSqr()),c=t.x.redMul(s.redISub(o).redSqr());return this.curve.point(a,c)},c.prototype.mul=function(e){for(var t=e.clone(),r=this,i=this.curve.point(null,null),n=[];0!==t.cmpn(0);t.iushrn(1))n.push(t.andln(1));for(var s=n.length-1;s>=0;s--)0===n[s]?(r=r.diffAdd(i,this),i=i.dbl()):(i=r.diffAdd(i,this),r=r.dbl());return i},c.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")},c.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")},c.prototype.eq=function(e){return 0===this.getX().cmp(e.getX())},c.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this},c.prototype.getX=function(){return this.normalize(),this.x.fromRed()}},4899:(e,t,r)=>{"use strict";var i=r(809),n=r(1531),s=r(2003),o=r(3539),a=i.assert;function c(e){o.call(this,"short",e),this.a=new n(e.a,16).toRed(this.red),this.b=new n(e.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=0===this.a.fromRed().cmpn(0),this.threeA=0===this.a.fromRed().sub(this.p).cmpn(-3),this.endo=this._getEndomorphism(e),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}function u(e,t,r,i){o.BasePoint.call(this,e,"affine"),null===t&&null===r?(this.x=null,this.y=null,this.inf=!0):(this.x=new n(t,16),this.y=new n(r,16),i&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}function h(e,t,r,i){o.BasePoint.call(this,e,"jacobian"),null===t&&null===r&&null===i?(this.x=this.curve.one,this.y=this.curve.one,this.z=new n(0)):(this.x=new n(t,16),this.y=new n(r,16),this.z=new n(i,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}s(c,o),e.exports=c,c.prototype._getEndomorphism=function(e){if(this.zeroA&&this.g&&this.n&&1===this.p.modn(3)){var t,r;if(e.beta)t=new n(e.beta,16).toRed(this.red);else{var i=this._getEndoRoots(this.p);t=(t=i[0].cmp(i[1])<0?i[0]:i[1]).toRed(this.red)}if(e.lambda)r=new n(e.lambda,16);else{var s=this._getEndoRoots(this.n);0===this.g.mul(s[0]).x.cmp(this.g.x.redMul(t))?r=s[0]:(r=s[1],a(0===this.g.mul(r).x.cmp(this.g.x.redMul(t))))}return{beta:t,lambda:r,basis:e.basis?e.basis.map((function(e){return{a:new n(e.a,16),b:new n(e.b,16)}})):this._getEndoBasis(r)}}},c.prototype._getEndoRoots=function(e){var t=e===this.p?this.red:n.mont(e),r=new n(2).toRed(t).redInvm(),i=r.redNeg(),s=new n(3).toRed(t).redNeg().redSqrt().redMul(r);return[i.redAdd(s).fromRed(),i.redSub(s).fromRed()]},c.prototype._getEndoBasis=function(e){for(var t,r,i,s,o,a,c,u,h,d=this.n.ushrn(Math.floor(this.n.bitLength()/2)),l=e,f=this.n.clone(),p=new n(1),y=new n(0),m=new n(0),g=new n(1),b=0;0!==l.cmpn(0);){var v=f.div(l);u=f.sub(v.mul(l)),h=m.sub(v.mul(p));var w=g.sub(v.mul(y));if(!i&&u.cmp(d)<0)t=c.neg(),r=p,i=u.neg(),s=h;else if(i&&2==++b)break;c=u,f=l,l=u,m=p,p=h,g=y,y=w}o=u.neg(),a=h;var S=i.sqr().add(s.sqr());return o.sqr().add(a.sqr()).cmp(S)>=0&&(o=t,a=r),i.negative&&(i=i.neg(),s=s.neg()),o.negative&&(o=o.neg(),a=a.neg()),[{a:i,b:s},{a:o,b:a}]},c.prototype._endoSplit=function(e){var t=this.endo.basis,r=t[0],i=t[1],n=i.b.mul(e).divRound(this.n),s=r.b.neg().mul(e).divRound(this.n),o=n.mul(r.a),a=s.mul(i.a),c=n.mul(r.b),u=s.mul(i.b);return{k1:e.sub(o).sub(a),k2:c.add(u).neg()}},c.prototype.pointFromX=function(e,t){(e=new n(e,16)).red||(e=e.toRed(this.red));var r=e.redSqr().redMul(e).redIAdd(e.redMul(this.a)).redIAdd(this.b),i=r.redSqrt();if(0!==i.redSqr().redSub(r).cmp(this.zero))throw new Error("invalid point");var s=i.fromRed().isOdd();return(t&&!s||!t&&s)&&(i=i.redNeg()),this.point(e,i)},c.prototype.validate=function(e){if(e.inf)return!0;var t=e.x,r=e.y,i=this.a.redMul(t),n=t.redSqr().redMul(t).redIAdd(i).redIAdd(this.b);return 0===r.redSqr().redISub(n).cmpn(0)},c.prototype._endoWnafMulAdd=function(e,t,r){for(var i=this._endoWnafT1,n=this._endoWnafT2,s=0;s<e.length;s++){var o=this._endoSplit(t[s]),a=e[s],c=a._getBeta();o.k1.negative&&(o.k1.ineg(),a=a.neg(!0)),o.k2.negative&&(o.k2.ineg(),c=c.neg(!0)),i[2*s]=a,i[2*s+1]=c,n[2*s]=o.k1,n[2*s+1]=o.k2}for(var u=this._wnafMulAdd(1,i,n,2*s,r),h=0;h<2*s;h++)i[h]=null,n[h]=null;return u},s(u,o.BasePoint),c.prototype.point=function(e,t,r){return new u(this,e,t,r)},c.prototype.pointFromJSON=function(e,t){return u.fromJSON(this,e,t)},u.prototype._getBeta=function(){if(this.curve.endo){var e=this.precomputed;if(e&&e.beta)return e.beta;var t=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(e){var r=this.curve,i=function(e){return r.point(e.x.redMul(r.endo.beta),e.y)};e.beta=t,t.precomputed={beta:null,naf:e.naf&&{wnd:e.naf.wnd,points:e.naf.points.map(i)},doubles:e.doubles&&{step:e.doubles.step,points:e.doubles.points.map(i)}}}return t}},u.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]},u.fromJSON=function(e,t,r){"string"==typeof t&&(t=JSON.parse(t));var i=e.point(t[0],t[1],r);if(!t[2])return i;function n(t){return e.point(t[0],t[1],r)}var s=t[2];return i.precomputed={beta:null,doubles:s.doubles&&{step:s.doubles.step,points:[i].concat(s.doubles.points.map(n))},naf:s.naf&&{wnd:s.naf.wnd,points:[i].concat(s.naf.points.map(n))}},i},u.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"},u.prototype.isInfinity=function(){return this.inf},u.prototype.add=function(e){if(this.inf)return e;if(e.inf)return this;if(this.eq(e))return this.dbl();if(this.neg().eq(e))return this.curve.point(null,null);if(0===this.x.cmp(e.x))return this.curve.point(null,null);var t=this.y.redSub(e.y);0!==t.cmpn(0)&&(t=t.redMul(this.x.redSub(e.x).redInvm()));var r=t.redSqr().redISub(this.x).redISub(e.x),i=t.redMul(this.x.redSub(r)).redISub(this.y);return this.curve.point(r,i)},u.prototype.dbl=function(){if(this.inf)return this;var e=this.y.redAdd(this.y);if(0===e.cmpn(0))return this.curve.point(null,null);var t=this.curve.a,r=this.x.redSqr(),i=e.redInvm(),n=r.redAdd(r).redIAdd(r).redIAdd(t).redMul(i),s=n.redSqr().redISub(this.x.redAdd(this.x)),o=n.redMul(this.x.redSub(s)).redISub(this.y);return this.curve.point(s,o)},u.prototype.getX=function(){return this.x.fromRed()},u.prototype.getY=function(){return this.y.fromRed()},u.prototype.mul=function(e){return e=new n(e,16),this.isInfinity()?this:this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve.endo?this.curve._endoWnafMulAdd([this],[e]):this.curve._wnafMul(this,e)},u.prototype.mulAdd=function(e,t,r){var i=[this,t],n=[e,r];return this.curve.endo?this.curve._endoWnafMulAdd(i,n):this.curve._wnafMulAdd(1,i,n,2)},u.prototype.jmulAdd=function(e,t,r){var i=[this,t],n=[e,r];return this.curve.endo?this.curve._endoWnafMulAdd(i,n,!0):this.curve._wnafMulAdd(1,i,n,2,!0)},u.prototype.eq=function(e){return this===e||this.inf===e.inf&&(this.inf||0===this.x.cmp(e.x)&&0===this.y.cmp(e.y))},u.prototype.neg=function(e){if(this.inf)return this;var t=this.curve.point(this.x,this.y.redNeg());if(e&&this.precomputed){var r=this.precomputed,i=function(e){return e.neg()};t.precomputed={naf:r.naf&&{wnd:r.naf.wnd,points:r.naf.points.map(i)},doubles:r.doubles&&{step:r.doubles.step,points:r.doubles.points.map(i)}}}return t},u.prototype.toJ=function(){return this.inf?this.curve.jpoint(null,null,null):this.curve.jpoint(this.x,this.y,this.curve.one)},s(h,o.BasePoint),c.prototype.jpoint=function(e,t,r){return new h(this,e,t,r)},h.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var e=this.z.redInvm(),t=e.redSqr(),r=this.x.redMul(t),i=this.y.redMul(t).redMul(e);return this.curve.point(r,i)},h.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)},h.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var t=e.z.redSqr(),r=this.z.redSqr(),i=this.x.redMul(t),n=e.x.redMul(r),s=this.y.redMul(t.redMul(e.z)),o=e.y.redMul(r.redMul(this.z)),a=i.redSub(n),c=s.redSub(o);if(0===a.cmpn(0))return 0!==c.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var u=a.redSqr(),h=u.redMul(a),d=i.redMul(u),l=c.redSqr().redIAdd(h).redISub(d).redISub(d),f=c.redMul(d.redISub(l)).redISub(s.redMul(h)),p=this.z.redMul(e.z).redMul(a);return this.curve.jpoint(l,f,p)},h.prototype.mixedAdd=function(e){if(this.isInfinity())return e.toJ();if(e.isInfinity())return this;var t=this.z.redSqr(),r=this.x,i=e.x.redMul(t),n=this.y,s=e.y.redMul(t).redMul(this.z),o=r.redSub(i),a=n.redSub(s);if(0===o.cmpn(0))return 0!==a.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var c=o.redSqr(),u=c.redMul(o),h=r.redMul(c),d=a.redSqr().redIAdd(u).redISub(h).redISub(h),l=a.redMul(h.redISub(d)).redISub(n.redMul(u)),f=this.z.redMul(o);return this.curve.jpoint(d,l,f)},h.prototype.dblp=function(e){if(0===e)return this;if(this.isInfinity())return this;if(!e)return this.dbl();var t;if(this.curve.zeroA||this.curve.threeA){var r=this;for(t=0;t<e;t++)r=r.dbl();return r}var i=this.curve.a,n=this.curve.tinv,s=this.x,o=this.y,a=this.z,c=a.redSqr().redSqr(),u=o.redAdd(o);for(t=0;t<e;t++){var h=s.redSqr(),d=u.redSqr(),l=d.redSqr(),f=h.redAdd(h).redIAdd(h).redIAdd(i.redMul(c)),p=s.redMul(d),y=f.redSqr().redISub(p.redAdd(p)),m=p.redISub(y),g=f.redMul(m);g=g.redIAdd(g).redISub(l);var b=u.redMul(a);t+1<e&&(c=c.redMul(l)),s=y,a=b,u=g}return this.curve.jpoint(s,u.redMul(n),a)},h.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()},h.prototype._zeroDbl=function(){var e,t,r;if(this.zOne){var i=this.x.redSqr(),n=this.y.redSqr(),s=n.redSqr(),o=this.x.redAdd(n).redSqr().redISub(i).redISub(s);o=o.redIAdd(o);var a=i.redAdd(i).redIAdd(i),c=a.redSqr().redISub(o).redISub(o),u=s.redIAdd(s);u=(u=u.redIAdd(u)).redIAdd(u),e=c,t=a.redMul(o.redISub(c)).redISub(u),r=this.y.redAdd(this.y)}else{var h=this.x.redSqr(),d=this.y.redSqr(),l=d.redSqr(),f=this.x.redAdd(d).redSqr().redISub(h).redISub(l);f=f.redIAdd(f);var p=h.redAdd(h).redIAdd(h),y=p.redSqr(),m=l.redIAdd(l);m=(m=m.redIAdd(m)).redIAdd(m),e=y.redISub(f).redISub(f),t=p.redMul(f.redISub(e)).redISub(m),r=(r=this.y.redMul(this.z)).redIAdd(r)}return this.curve.jpoint(e,t,r)},h.prototype._threeDbl=function(){var e,t,r;if(this.zOne){var i=this.x.redSqr(),n=this.y.redSqr(),s=n.redSqr(),o=this.x.redAdd(n).redSqr().redISub(i).redISub(s);o=o.redIAdd(o);var a=i.redAdd(i).redIAdd(i).redIAdd(this.curve.a),c=a.redSqr().redISub(o).redISub(o);e=c;var u=s.redIAdd(s);u=(u=u.redIAdd(u)).redIAdd(u),t=a.redMul(o.redISub(c)).redISub(u),r=this.y.redAdd(this.y)}else{var h=this.z.redSqr(),d=this.y.redSqr(),l=this.x.redMul(d),f=this.x.redSub(h).redMul(this.x.redAdd(h));f=f.redAdd(f).redIAdd(f);var p=l.redIAdd(l),y=(p=p.redIAdd(p)).redAdd(p);e=f.redSqr().redISub(y),r=this.y.redAdd(this.z).redSqr().redISub(d).redISub(h);var m=d.redSqr();m=(m=(m=m.redIAdd(m)).redIAdd(m)).redIAdd(m),t=f.redMul(p.redISub(e)).redISub(m)}return this.curve.jpoint(e,t,r)},h.prototype._dbl=function(){var e=this.curve.a,t=this.x,r=this.y,i=this.z,n=i.redSqr().redSqr(),s=t.redSqr(),o=r.redSqr(),a=s.redAdd(s).redIAdd(s).redIAdd(e.redMul(n)),c=t.redAdd(t),u=(c=c.redIAdd(c)).redMul(o),h=a.redSqr().redISub(u.redAdd(u)),d=u.redISub(h),l=o.redSqr();l=(l=(l=l.redIAdd(l)).redIAdd(l)).redIAdd(l);var f=a.redMul(d).redISub(l),p=r.redAdd(r).redMul(i);return this.curve.jpoint(h,f,p)},h.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var e=this.x.redSqr(),t=this.y.redSqr(),r=this.z.redSqr(),i=t.redSqr(),n=e.redAdd(e).redIAdd(e),s=n.redSqr(),o=this.x.redAdd(t).redSqr().redISub(e).redISub(i),a=(o=(o=(o=o.redIAdd(o)).redAdd(o).redIAdd(o)).redISub(s)).redSqr(),c=i.redIAdd(i);c=(c=(c=c.redIAdd(c)).redIAdd(c)).redIAdd(c);var u=n.redIAdd(o).redSqr().redISub(s).redISub(a).redISub(c),h=t.redMul(u);h=(h=h.redIAdd(h)).redIAdd(h);var d=this.x.redMul(a).redISub(h);d=(d=d.redIAdd(d)).redIAdd(d);var l=this.y.redMul(u.redMul(c.redISub(u)).redISub(o.redMul(a)));l=(l=(l=l.redIAdd(l)).redIAdd(l)).redIAdd(l);var f=this.z.redAdd(o).redSqr().redISub(r).redISub(a);return this.curve.jpoint(d,l,f)},h.prototype.mul=function(e,t){return e=new n(e,t),this.curve._wnafMul(this,e)},h.prototype.eq=function(e){if("affine"===e.type)return this.eq(e.toJ());if(this===e)return!0;var t=this.z.redSqr(),r=e.z.redSqr();if(0!==this.x.redMul(r).redISub(e.x.redMul(t)).cmpn(0))return!1;var i=t.redMul(this.z),n=r.redMul(e.z);return 0===this.y.redMul(n).redISub(e.y.redMul(i)).cmpn(0)},h.prototype.eqXToP=function(e){var t=this.z.redSqr(),r=e.toRed(this.curve.red).redMul(t);if(0===this.x.cmp(r))return!0;for(var i=e.clone(),n=this.curve.redN.redMul(t);;){if(i.iadd(this.curve.n),i.cmp(this.curve.p)>=0)return!1;if(r.redIAdd(n),0===this.x.cmp(r))return!0}},h.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"},h.prototype.isInfinity=function(){return 0===this.z.cmpn(0)}},2015:(e,t,r)=>{"use strict";var i,n=t,s=r(796),o=r(6004),a=r(809).assert;function c(e){"short"===e.type?this.curve=new o.short(e):"edwards"===e.type?this.curve=new o.edwards(e):this.curve=new o.mont(e),this.g=this.curve.g,this.n=this.curve.n,this.hash=e.hash,a(this.g.validate(),"Invalid curve"),a(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}function u(e,t){Object.defineProperty(n,e,{configurable:!0,enumerable:!0,get:function(){var r=new c(t);return Object.defineProperty(n,e,{configurable:!0,enumerable:!0,value:r}),r}})}n.PresetCurve=c,u("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:s.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),u("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:s.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),u("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:s.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),u("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:s.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),u("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:s.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),u("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:s.sha256,gRed:!1,g:["9"]}),u("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:s.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});try{i=r(4303)}catch(e){i=void 0}u("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:s.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",i]})},7237:(e,t,r)=>{"use strict";var i=r(1531),n=r(8045),s=r(809),o=r(2015),a=r(8185),c=s.assert,u=r(3740),h=r(6313);function d(e){if(!(this instanceof d))return new d(e);"string"==typeof e&&(c(Object.prototype.hasOwnProperty.call(o,e),"Unknown curve "+e),e=o[e]),e instanceof o.PresetCurve&&(e={curve:e}),this.curve=e.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=e.curve.g,this.g.precompute(e.curve.n.bitLength()+1),this.hash=e.hash||e.curve.hash}e.exports=d,d.prototype.keyPair=function(e){return new u(this,e)},d.prototype.keyFromPrivate=function(e,t){return u.fromPrivate(this,e,t)},d.prototype.keyFromPublic=function(e,t){return u.fromPublic(this,e,t)},d.prototype.genKeyPair=function(e){e||(e={});for(var t=new n({hash:this.hash,pers:e.pers,persEnc:e.persEnc||"utf8",entropy:e.entropy||a(this.hash.hmacStrength),entropyEnc:e.entropy&&e.entropyEnc||"utf8",nonce:this.n.toArray()}),r=this.n.byteLength(),s=this.n.sub(new i(2));;){var o=new i(t.generate(r));if(!(o.cmp(s)>0))return o.iaddn(1),this.keyFromPrivate(o)}},d.prototype._truncateToN=function(e,t){var r=8*e.byteLength()-this.n.bitLength();return r>0&&(e=e.ushrn(r)),!t&&e.cmp(this.n)>=0?e.sub(this.n):e},d.prototype.sign=function(e,t,r,s){"object"==typeof r&&(s=r,r=null),s||(s={}),t=this.keyFromPrivate(t,r),e=this._truncateToN(new i(e,16));for(var o=this.n.byteLength(),a=t.getPrivate().toArray("be",o),c=e.toArray("be",o),u=new n({hash:this.hash,entropy:a,nonce:c,pers:s.pers,persEnc:s.persEnc||"utf8"}),d=this.n.sub(new i(1)),l=0;;l++){var f=s.k?s.k(l):new i(u.generate(this.n.byteLength()));if(!((f=this._truncateToN(f,!0)).cmpn(1)<=0||f.cmp(d)>=0)){var p=this.g.mul(f);if(!p.isInfinity()){var y=p.getX(),m=y.umod(this.n);if(0!==m.cmpn(0)){var g=f.invm(this.n).mul(m.mul(t.getPrivate()).iadd(e));if(0!==(g=g.umod(this.n)).cmpn(0)){var b=(p.getY().isOdd()?1:0)|(0!==y.cmp(m)?2:0);return s.canonical&&g.cmp(this.nh)>0&&(g=this.n.sub(g),b^=1),new h({r:m,s:g,recoveryParam:b})}}}}}},d.prototype.verify=function(e,t,r,n){e=this._truncateToN(new i(e,16)),r=this.keyFromPublic(r,n);var s=(t=new h(t,"hex")).r,o=t.s;if(s.cmpn(1)<0||s.cmp(this.n)>=0)return!1;if(o.cmpn(1)<0||o.cmp(this.n)>=0)return!1;var a,c=o.invm(this.n),u=c.mul(e).umod(this.n),d=c.mul(s).umod(this.n);return this.curve._maxwellTrick?!(a=this.g.jmulAdd(u,r.getPublic(),d)).isInfinity()&&a.eqXToP(s):!(a=this.g.mulAdd(u,r.getPublic(),d)).isInfinity()&&0===a.getX().umod(this.n).cmp(s)},d.prototype.recoverPubKey=function(e,t,r,n){c((3&r)===r,"The recovery param is more than two bits"),t=new h(t,n);var s=this.n,o=new i(e),a=t.r,u=t.s,d=1&r,l=r>>1;if(a.cmp(this.curve.p.umod(this.curve.n))>=0&&l)throw new Error("Unable to find sencond key candinate");a=l?this.curve.pointFromX(a.add(this.curve.n),d):this.curve.pointFromX(a,d);var f=t.r.invm(s),p=s.sub(o).mul(f).umod(s),y=u.mul(f).umod(s);return this.g.mulAdd(p,a,y)},d.prototype.getKeyRecoveryParam=function(e,t,r,i){if(null!==(t=new h(t,i)).recoveryParam)return t.recoveryParam;for(var n=0;n<4;n++){var s;try{s=this.recoverPubKey(e,t,n)}catch(e){continue}if(s.eq(r))return n}throw new Error("Unable to find valid recovery factor")}},3740:(e,t,r)=>{"use strict";var i=r(1531),n=r(809).assert;function s(e,t){this.ec=e,this.priv=null,this.pub=null,t.priv&&this._importPrivate(t.priv,t.privEnc),t.pub&&this._importPublic(t.pub,t.pubEnc)}e.exports=s,s.fromPublic=function(e,t,r){return t instanceof s?t:new s(e,{pub:t,pubEnc:r})},s.fromPrivate=function(e,t,r){return t instanceof s?t:new s(e,{priv:t,privEnc:r})},s.prototype.validate=function(){var e=this.getPublic();return e.isInfinity()?{result:!1,reason:"Invalid public key"}:e.validate()?e.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}},s.prototype.getPublic=function(e,t){return"string"==typeof e&&(t=e,e=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),t?this.pub.encode(t,e):this.pub},s.prototype.getPrivate=function(e){return"hex"===e?this.priv.toString(16,2):this.priv},s.prototype._importPrivate=function(e,t){this.priv=new i(e,t||16),this.priv=this.priv.umod(this.ec.curve.n)},s.prototype._importPublic=function(e,t){if(e.x||e.y)return"mont"===this.ec.curve.type?n(e.x,"Need x coordinate"):"short"!==this.ec.curve.type&&"edwards"!==this.ec.curve.type||n(e.x&&e.y,"Need both x and y coordinate"),void(this.pub=this.ec.curve.point(e.x,e.y));this.pub=this.ec.curve.decodePoint(e,t)},s.prototype.derive=function(e){return e.validate()||n(e.validate(),"public point not validated"),e.mul(this.priv).getX()},s.prototype.sign=function(e,t,r){return this.ec.sign(e,this,t,r)},s.prototype.verify=function(e,t){return this.ec.verify(e,t,this)},s.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"}},6313:(e,t,r)=>{"use strict";var i=r(1531),n=r(809),s=n.assert;function o(e,t){if(e instanceof o)return e;this._importDER(e,t)||(s(e.r&&e.s,"Signature without r or s"),this.r=new i(e.r,16),this.s=new i(e.s,16),void 0===e.recoveryParam?this.recoveryParam=null:this.recoveryParam=e.recoveryParam)}function a(){this.place=0}function c(e,t){var r=e[t.place++];if(!(128&r))return r;var i=15&r;if(0===i||i>4)return!1;for(var n=0,s=0,o=t.place;s<i;s++,o++)n<<=8,n|=e[o],n>>>=0;return!(n<=127)&&(t.place=o,n)}function u(e){for(var t=0,r=e.length-1;!e[t]&&!(128&e[t+1])&&t<r;)t++;return 0===t?e:e.slice(t)}function h(e,t){if(t<128)e.push(t);else{var r=1+(Math.log(t)/Math.LN2>>>3);for(e.push(128|r);--r;)e.push(t>>>(r<<3)&255);e.push(t)}}e.exports=o,o.prototype._importDER=function(e,t){e=n.toArray(e,t);var r=new a;if(48!==e[r.place++])return!1;var s=c(e,r);if(!1===s)return!1;if(s+r.place!==e.length)return!1;if(2!==e[r.place++])return!1;var o=c(e,r);if(!1===o)return!1;var u=e.slice(r.place,o+r.place);if(r.place+=o,2!==e[r.place++])return!1;var h=c(e,r);if(!1===h)return!1;if(e.length!==h+r.place)return!1;var d=e.slice(r.place,h+r.place);if(0===u[0]){if(!(128&u[1]))return!1;u=u.slice(1)}if(0===d[0]){if(!(128&d[1]))return!1;d=d.slice(1)}return this.r=new i(u),this.s=new i(d),this.recoveryParam=null,!0},o.prototype.toDER=function(e){var t=this.r.toArray(),r=this.s.toArray();for(128&t[0]&&(t=[0].concat(t)),128&r[0]&&(r=[0].concat(r)),t=u(t),r=u(r);!(r[0]||128&r[1]);)r=r.slice(1);var i=[2];h(i,t.length),(i=i.concat(t)).push(2),h(i,r.length);var s=i.concat(r),o=[48];return h(o,s.length),o=o.concat(s),n.encode(o,e)}},6319:(e,t,r)=>{"use strict";var i=r(796),n=r(2015),s=r(809),o=s.assert,a=s.parseBytes,c=r(5082),u=r(208);function h(e){if(o("ed25519"===e,"only tested with ed25519 so far"),!(this instanceof h))return new h(e);e=n[e].curve,this.curve=e,this.g=e.g,this.g.precompute(e.n.bitLength()+1),this.pointClass=e.point().constructor,this.encodingLength=Math.ceil(e.n.bitLength()/8),this.hash=i.sha512}e.exports=h,h.prototype.sign=function(e,t){e=a(e);var r=this.keyFromSecret(t),i=this.hashInt(r.messagePrefix(),e),n=this.g.mul(i),s=this.encodePoint(n),o=this.hashInt(s,r.pubBytes(),e).mul(r.priv()),c=i.add(o).umod(this.curve.n);return this.makeSignature({R:n,S:c,Rencoded:s})},h.prototype.verify=function(e,t,r){e=a(e),t=this.makeSignature(t);var i=this.keyFromPublic(r),n=this.hashInt(t.Rencoded(),i.pubBytes(),e),s=this.g.mul(t.S());return t.R().add(i.pub().mul(n)).eq(s)},h.prototype.hashInt=function(){for(var e=this.hash(),t=0;t<arguments.length;t++)e.update(arguments[t]);return s.intFromLE(e.digest()).umod(this.curve.n)},h.prototype.keyFromPublic=function(e){return c.fromPublic(this,e)},h.prototype.keyFromSecret=function(e){return c.fromSecret(this,e)},h.prototype.makeSignature=function(e){return e instanceof u?e:new u(this,e)},h.prototype.encodePoint=function(e){var t=e.getY().toArray("le",this.encodingLength);return t[this.encodingLength-1]|=e.getX().isOdd()?128:0,t},h.prototype.decodePoint=function(e){var t=(e=s.parseBytes(e)).length-1,r=e.slice(0,t).concat(-129&e[t]),i=0!=(128&e[t]),n=s.intFromLE(r);return this.curve.pointFromY(n,i)},h.prototype.encodeInt=function(e){return e.toArray("le",this.encodingLength)},h.prototype.decodeInt=function(e){return s.intFromLE(e)},h.prototype.isPoint=function(e){return e instanceof this.pointClass}},5082:(e,t,r)=>{"use strict";var i=r(809),n=i.assert,s=i.parseBytes,o=i.cachedProperty;function a(e,t){this.eddsa=e,this._secret=s(t.secret),e.isPoint(t.pub)?this._pub=t.pub:this._pubBytes=s(t.pub)}a.fromPublic=function(e,t){return t instanceof a?t:new a(e,{pub:t})},a.fromSecret=function(e,t){return t instanceof a?t:new a(e,{secret:t})},a.prototype.secret=function(){return this._secret},o(a,"pubBytes",(function(){return this.eddsa.encodePoint(this.pub())})),o(a,"pub",(function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())})),o(a,"privBytes",(function(){var e=this.eddsa,t=this.hash(),r=e.encodingLength-1,i=t.slice(0,e.encodingLength);return i[0]&=248,i[r]&=127,i[r]|=64,i})),o(a,"priv",(function(){return this.eddsa.decodeInt(this.privBytes())})),o(a,"hash",(function(){return this.eddsa.hash().update(this.secret()).digest()})),o(a,"messagePrefix",(function(){return this.hash().slice(this.eddsa.encodingLength)})),a.prototype.sign=function(e){return n(this._secret,"KeyPair can only verify"),this.eddsa.sign(e,this)},a.prototype.verify=function(e,t){return this.eddsa.verify(e,t,this)},a.prototype.getSecret=function(e){return n(this._secret,"KeyPair is public only"),i.encode(this.secret(),e)},a.prototype.getPublic=function(e){return i.encode(this.pubBytes(),e)},e.exports=a},208:(e,t,r)=>{"use strict";var i=r(1531),n=r(809),s=n.assert,o=n.cachedProperty,a=n.parseBytes;function c(e,t){this.eddsa=e,"object"!=typeof t&&(t=a(t)),Array.isArray(t)&&(t={R:t.slice(0,e.encodingLength),S:t.slice(e.encodingLength)}),s(t.R&&t.S,"Signature without R or S"),e.isPoint(t.R)&&(this._R=t.R),t.S instanceof i&&(this._S=t.S),this._Rencoded=Array.isArray(t.R)?t.R:t.Rencoded,this._Sencoded=Array.isArray(t.S)?t.S:t.Sencoded}o(c,"S",(function(){return this.eddsa.decodeInt(this.Sencoded())})),o(c,"R",(function(){return this.eddsa.decodePoint(this.Rencoded())})),o(c,"Rencoded",(function(){return this.eddsa.encodePoint(this.R())})),o(c,"Sencoded",(function(){return this.eddsa.encodeInt(this.S())})),c.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())},c.prototype.toHex=function(){return n.encode(this.toBytes(),"hex").toUpperCase()},e.exports=c},4303:e=>{e.exports={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}},809:(e,t,r)=>{"use strict";var i=t,n=r(1531),s=r(7292),o=r(8531);i.assert=s,i.toArray=o.toArray,i.zero2=o.zero2,i.toHex=o.toHex,i.encode=o.encode,i.getNAF=function(e,t,r){var i=new Array(Math.max(e.bitLength(),r)+1);i.fill(0);for(var n=1<<t+1,s=e.clone(),o=0;o<i.length;o++){var a,c=s.andln(n-1);s.isOdd()?(a=c>(n>>1)-1?(n>>1)-c:c,s.isubn(a)):a=0,i[o]=a,s.iushrn(1)}return i},i.getJSF=function(e,t){var r=[[],[]];e=e.clone(),t=t.clone();for(var i,n=0,s=0;e.cmpn(-n)>0||t.cmpn(-s)>0;){var o,a,c=e.andln(3)+n&3,u=t.andln(3)+s&3;3===c&&(c=-1),3===u&&(u=-1),o=0==(1&c)?0:3!==(i=e.andln(7)+n&7)&&5!==i||2!==u?c:-c,r[0].push(o),a=0==(1&u)?0:3!==(i=t.andln(7)+s&7)&&5!==i||2!==c?u:-u,r[1].push(a),2*n===o+1&&(n=1-n),2*s===a+1&&(s=1-s),e.iushrn(1),t.iushrn(1)}return r},i.cachedProperty=function(e,t,r){var i="_"+t;e.prototype[t]=function(){return void 0!==this[i]?this[i]:this[i]=r.call(this)}},i.parseBytes=function(e){return"string"==typeof e?i.toArray(e,"hex"):e},i.intFromLE=function(e){return new n(e,"hex","le")}},116:(e,t,r)=>{for(var i=r(3837),n=r(7666),s=/[\{\[]/,o=/[\}\]]/,a=["do","if","in","for","let","new","try","var","case","else","enum","eval","null","this","true","void","with","await","break","catch","class","const","false","super","throw","while","yield","delete","export","import","public","return","static","switch","typeof","default","extends","finally","package","private","continue","debugger","function","arguments","interface","protected","implements","instanceof","NaN","undefined"],c={},u=0;u<a.length;u++)c[a[u]]=!0;var h=function(e){return n(e)&&!c.hasOwnProperty(e)},d={s:function(e){return""+e},d:function(e){return""+Number(e)},o:function(e){return JSON.stringify(e)}},l=function(){var e=[],t=0,r={},a=function(r){for(var i="";i.length<2*t;)i+="  ";e.push(i+r)},c=function(e){return o.test(e.trim()[0])&&s.test(e[e.length-1])?(t--,a(e),void t++):s.test(e[e.length-1])?(a(e),void t++):o.test(e.trim()[0])?(t--,void a(e)):void a(e)},u=function(e){if(!e)return u;if(1===arguments.length&&e.indexOf("\n")>-1)for(var t=e.trim().split("\n"),r=0;r<t.length;r++)c(t[r].trim());else c(i.format.apply(i,arguments));return u};return u.scope={},u.formats=d,u.sym=function(e){return e&&h(e)||(e="tmp"),r[e]||(r[e]=0),e+(r[e]++||"")},u.property=function(e,t){return 1===arguments.length&&(t=e,e=""),n(t+="")?e?e+"."+t:t:e?e+"["+JSON.stringify(t)+"]":JSON.stringify(t)},u.toString=function(){return e.join("\n")},u.toFunction=function(e){e||(e={});var t="return ("+u.toString()+")";Object.keys(u.scope).forEach((function(t){e[t]||(e[t]=u.scope[t])}));var r=Object.keys(e).map((function(e){return e})),i=r.map((function(t){return e[t]}));return Function.apply(null,r.concat(t)).apply(null,i)},arguments.length&&u.apply(null,arguments),u};l.formats=d,e.exports=l},8605:e=>{"use strict";e.exports=(e,t=process.argv)=>{const r=e.startsWith("-")?"":1===e.length?"-":"--",i=t.indexOf(r+e),n=t.indexOf("--");return-1!==i&&(-1===n||i<n)}},796:(e,t,r)=>{var i=t;i.utils=r(7918),i.common=r(9588),i.sha=r(88),i.ripemd=r(8528),i.hmac=r(7714),i.sha1=i.sha.sha1,i.sha256=i.sha.sha256,i.sha224=i.sha.sha224,i.sha384=i.sha.sha384,i.sha512=i.sha.sha512,i.ripemd160=i.ripemd.ripemd160},9588:(e,t,r)=>{"use strict";var i=r(7918),n=r(7292);function s(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}t.BlockHash=s,s.prototype.update=function(e,t){if(e=i.toArray(e,t),this.pending?this.pending=this.pending.concat(e):this.pending=e,this.pendingTotal+=e.length,this.pending.length>=this._delta8){var r=(e=this.pending).length%this._delta8;this.pending=e.slice(e.length-r,e.length),0===this.pending.length&&(this.pending=null),e=i.join32(e,0,e.length-r,this.endian);for(var n=0;n<e.length;n+=this._delta32)this._update(e,n,n+this._delta32)}return this},s.prototype.digest=function(e){return this.update(this._pad()),n(null===this.pending),this._digest(e)},s.prototype._pad=function(){var e=this.pendingTotal,t=this._delta8,r=t-(e+this.padLength)%t,i=new Array(r+this.padLength);i[0]=128;for(var n=1;n<r;n++)i[n]=0;if(e<<=3,"big"===this.endian){for(var s=8;s<this.padLength;s++)i[n++]=0;i[n++]=0,i[n++]=0,i[n++]=0,i[n++]=0,i[n++]=e>>>24&255,i[n++]=e>>>16&255,i[n++]=e>>>8&255,i[n++]=255&e}else for(i[n++]=255&e,i[n++]=e>>>8&255,i[n++]=e>>>16&255,i[n++]=e>>>24&255,i[n++]=0,i[n++]=0,i[n++]=0,i[n++]=0,s=8;s<this.padLength;s++)i[n++]=0;return i}},7714:(e,t,r)=>{"use strict";var i=r(7918),n=r(7292);function s(e,t,r){if(!(this instanceof s))return new s(e,t,r);this.Hash=e,this.blockSize=e.blockSize/8,this.outSize=e.outSize/8,this.inner=null,this.outer=null,this._init(i.toArray(t,r))}e.exports=s,s.prototype._init=function(e){e.length>this.blockSize&&(e=(new this.Hash).update(e).digest()),n(e.length<=this.blockSize);for(var t=e.length;t<this.blockSize;t++)e.push(0);for(t=0;t<e.length;t++)e[t]^=54;for(this.inner=(new this.Hash).update(e),t=0;t<e.length;t++)e[t]^=106;this.outer=(new this.Hash).update(e)},s.prototype.update=function(e,t){return this.inner.update(e,t),this},s.prototype.digest=function(e){return this.outer.update(this.inner.digest()),this.outer.digest(e)}},8528:(e,t,r)=>{"use strict";var i=r(7918),n=r(9588),s=i.rotl32,o=i.sum32,a=i.sum32_3,c=i.sum32_4,u=n.BlockHash;function h(){if(!(this instanceof h))return new h;u.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}function d(e,t,r,i){return e<=15?t^r^i:e<=31?t&r|~t&i:e<=47?(t|~r)^i:e<=63?t&i|r&~i:t^(r|~i)}function l(e){return e<=15?0:e<=31?1518500249:e<=47?1859775393:e<=63?2400959708:2840853838}function f(e){return e<=15?1352829926:e<=31?1548603684:e<=47?1836072691:e<=63?2053994217:0}i.inherits(h,u),t.ripemd160=h,h.blockSize=512,h.outSize=160,h.hmacStrength=192,h.padLength=64,h.prototype._update=function(e,t){for(var r=this.h[0],i=this.h[1],n=this.h[2],u=this.h[3],h=this.h[4],b=r,v=i,w=n,S=u,_=h,A=0;A<80;A++){var E=o(s(c(r,d(A,i,n,u),e[p[A]+t],l(A)),m[A]),h);r=h,h=u,u=s(n,10),n=i,i=E,E=o(s(c(b,d(79-A,v,w,S),e[y[A]+t],f(A)),g[A]),_),b=_,_=S,S=s(w,10),w=v,v=E}E=a(this.h[1],n,S),this.h[1]=a(this.h[2],u,_),this.h[2]=a(this.h[3],h,b),this.h[3]=a(this.h[4],r,v),this.h[4]=a(this.h[0],i,w),this.h[0]=E},h.prototype._digest=function(e){return"hex"===e?i.toHex32(this.h,"little"):i.split32(this.h,"little")};var p=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],y=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],m=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],g=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]},88:(e,t,r)=>{"use strict";t.sha1=r(532),t.sha224=r(2603),t.sha256=r(1119),t.sha384=r(5815),t.sha512=r(3612)},532:(e,t,r)=>{"use strict";var i=r(7918),n=r(9588),s=r(2e3),o=i.rotl32,a=i.sum32,c=i.sum32_5,u=s.ft_1,h=n.BlockHash,d=[1518500249,1859775393,2400959708,3395469782];function l(){if(!(this instanceof l))return new l;h.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}i.inherits(l,h),e.exports=l,l.blockSize=512,l.outSize=160,l.hmacStrength=80,l.padLength=64,l.prototype._update=function(e,t){for(var r=this.W,i=0;i<16;i++)r[i]=e[t+i];for(;i<r.length;i++)r[i]=o(r[i-3]^r[i-8]^r[i-14]^r[i-16],1);var n=this.h[0],s=this.h[1],h=this.h[2],l=this.h[3],f=this.h[4];for(i=0;i<r.length;i++){var p=~~(i/20),y=c(o(n,5),u(p,s,h,l),f,r[i],d[p]);f=l,l=h,h=o(s,30),s=n,n=y}this.h[0]=a(this.h[0],n),this.h[1]=a(this.h[1],s),this.h[2]=a(this.h[2],h),this.h[3]=a(this.h[3],l),this.h[4]=a(this.h[4],f)},l.prototype._digest=function(e){return"hex"===e?i.toHex32(this.h,"big"):i.split32(this.h,"big")}},2603:(e,t,r)=>{"use strict";var i=r(7918),n=r(1119);function s(){if(!(this instanceof s))return new s;n.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}i.inherits(s,n),e.exports=s,s.blockSize=512,s.outSize=224,s.hmacStrength=192,s.padLength=64,s.prototype._digest=function(e){return"hex"===e?i.toHex32(this.h.slice(0,7),"big"):i.split32(this.h.slice(0,7),"big")}},1119:(e,t,r)=>{"use strict";var i=r(7918),n=r(9588),s=r(2e3),o=r(7292),a=i.sum32,c=i.sum32_4,u=i.sum32_5,h=s.ch32,d=s.maj32,l=s.s0_256,f=s.s1_256,p=s.g0_256,y=s.g1_256,m=n.BlockHash,g=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function b(){if(!(this instanceof b))return new b;m.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=g,this.W=new Array(64)}i.inherits(b,m),e.exports=b,b.blockSize=512,b.outSize=256,b.hmacStrength=192,b.padLength=64,b.prototype._update=function(e,t){for(var r=this.W,i=0;i<16;i++)r[i]=e[t+i];for(;i<r.length;i++)r[i]=c(y(r[i-2]),r[i-7],p(r[i-15]),r[i-16]);var n=this.h[0],s=this.h[1],m=this.h[2],g=this.h[3],b=this.h[4],v=this.h[5],w=this.h[6],S=this.h[7];for(o(this.k.length===r.length),i=0;i<r.length;i++){var _=u(S,f(b),h(b,v,w),this.k[i],r[i]),A=a(l(n),d(n,s,m));S=w,w=v,v=b,b=a(g,_),g=m,m=s,s=n,n=a(_,A)}this.h[0]=a(this.h[0],n),this.h[1]=a(this.h[1],s),this.h[2]=a(this.h[2],m),this.h[3]=a(this.h[3],g),this.h[4]=a(this.h[4],b),this.h[5]=a(this.h[5],v),this.h[6]=a(this.h[6],w),this.h[7]=a(this.h[7],S)},b.prototype._digest=function(e){return"hex"===e?i.toHex32(this.h,"big"):i.split32(this.h,"big")}},5815:(e,t,r)=>{"use strict";var i=r(7918),n=r(3612);function s(){if(!(this instanceof s))return new s;n.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}i.inherits(s,n),e.exports=s,s.blockSize=1024,s.outSize=384,s.hmacStrength=192,s.padLength=128,s.prototype._digest=function(e){return"hex"===e?i.toHex32(this.h.slice(0,12),"big"):i.split32(this.h.slice(0,12),"big")}},3612:(e,t,r)=>{"use strict";var i=r(7918),n=r(9588),s=r(7292),o=i.rotr64_hi,a=i.rotr64_lo,c=i.shr64_hi,u=i.shr64_lo,h=i.sum64,d=i.sum64_hi,l=i.sum64_lo,f=i.sum64_4_hi,p=i.sum64_4_lo,y=i.sum64_5_hi,m=i.sum64_5_lo,g=n.BlockHash,b=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function v(){if(!(this instanceof v))return new v;g.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=b,this.W=new Array(160)}function w(e,t,r,i,n){var s=e&r^~e&n;return s<0&&(s+=4294967296),s}function S(e,t,r,i,n,s){var o=t&i^~t&s;return o<0&&(o+=4294967296),o}function _(e,t,r,i,n){var s=e&r^e&n^r&n;return s<0&&(s+=4294967296),s}function A(e,t,r,i,n,s){var o=t&i^t&s^i&s;return o<0&&(o+=4294967296),o}function E(e,t){var r=o(e,t,28)^o(t,e,2)^o(t,e,7);return r<0&&(r+=4294967296),r}function C(e,t){var r=a(e,t,28)^a(t,e,2)^a(t,e,7);return r<0&&(r+=4294967296),r}function k(e,t){var r=o(e,t,14)^o(e,t,18)^o(t,e,9);return r<0&&(r+=4294967296),r}function T(e,t){var r=a(e,t,14)^a(e,t,18)^a(t,e,9);return r<0&&(r+=4294967296),r}function P(e,t){var r=o(e,t,1)^o(e,t,8)^c(e,t,7);return r<0&&(r+=4294967296),r}function I(e,t){var r=a(e,t,1)^a(e,t,8)^u(e,t,7);return r<0&&(r+=4294967296),r}function R(e,t){var r=o(e,t,19)^o(t,e,29)^c(e,t,6);return r<0&&(r+=4294967296),r}function x(e,t){var r=a(e,t,19)^a(t,e,29)^u(e,t,6);return r<0&&(r+=4294967296),r}i.inherits(v,g),e.exports=v,v.blockSize=1024,v.outSize=512,v.hmacStrength=192,v.padLength=128,v.prototype._prepareBlock=function(e,t){for(var r=this.W,i=0;i<32;i++)r[i]=e[t+i];for(;i<r.length;i+=2){var n=R(r[i-4],r[i-3]),s=x(r[i-4],r[i-3]),o=r[i-14],a=r[i-13],c=P(r[i-30],r[i-29]),u=I(r[i-30],r[i-29]),h=r[i-32],d=r[i-31];r[i]=f(n,s,o,a,c,u,h,d),r[i+1]=p(n,s,o,a,c,u,h,d)}},v.prototype._update=function(e,t){this._prepareBlock(e,t);var r=this.W,i=this.h[0],n=this.h[1],o=this.h[2],a=this.h[3],c=this.h[4],u=this.h[5],f=this.h[6],p=this.h[7],g=this.h[8],b=this.h[9],v=this.h[10],P=this.h[11],I=this.h[12],R=this.h[13],x=this.h[14],B=this.h[15];s(this.k.length===r.length);for(var O=0;O<r.length;O+=2){var M=x,N=B,D=k(g,b),L=T(g,b),U=w(g,b,v,P,I),j=S(g,b,v,P,I,R),q=this.k[O],K=this.k[O+1],H=r[O],z=r[O+1],F=y(M,N,D,L,U,j,q,K,H,z),V=m(M,N,D,L,U,j,q,K,H,z);M=E(i,n),N=C(i,n),D=_(i,n,o,a,c),L=A(i,n,o,a,c,u);var $=d(M,N,D,L),W=l(M,N,D,L);x=I,B=R,I=v,R=P,v=g,P=b,g=d(f,p,F,V),b=l(p,p,F,V),f=c,p=u,c=o,u=a,o=i,a=n,i=d(F,V,$,W),n=l(F,V,$,W)}h(this.h,0,i,n),h(this.h,2,o,a),h(this.h,4,c,u),h(this.h,6,f,p),h(this.h,8,g,b),h(this.h,10,v,P),h(this.h,12,I,R),h(this.h,14,x,B)},v.prototype._digest=function(e){return"hex"===e?i.toHex32(this.h,"big"):i.split32(this.h,"big")}},2e3:(e,t,r)=>{"use strict";var i=r(7918).rotr32;function n(e,t,r){return e&t^~e&r}function s(e,t,r){return e&t^e&r^t&r}function o(e,t,r){return e^t^r}t.ft_1=function(e,t,r,i){return 0===e?n(t,r,i):1===e||3===e?o(t,r,i):2===e?s(t,r,i):void 0},t.ch32=n,t.maj32=s,t.p32=o,t.s0_256=function(e){return i(e,2)^i(e,13)^i(e,22)},t.s1_256=function(e){return i(e,6)^i(e,11)^i(e,25)},t.g0_256=function(e){return i(e,7)^i(e,18)^e>>>3},t.g1_256=function(e){return i(e,17)^i(e,19)^e>>>10}},7918:(e,t,r)=>{"use strict";var i=r(7292),n=r(2003);function s(e,t){return 55296==(64512&e.charCodeAt(t))&&(!(t<0||t+1>=e.length)&&56320==(64512&e.charCodeAt(t+1)))}function o(e){return(e>>>24|e>>>8&65280|e<<8&16711680|(255&e)<<24)>>>0}function a(e){return 1===e.length?"0"+e:e}function c(e){return 7===e.length?"0"+e:6===e.length?"00"+e:5===e.length?"000"+e:4===e.length?"0000"+e:3===e.length?"00000"+e:2===e.length?"000000"+e:1===e.length?"0000000"+e:e}t.inherits=n,t.toArray=function(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var r=[];if("string"==typeof e)if(t){if("hex"===t)for((e=e.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(e="0"+e),n=0;n<e.length;n+=2)r.push(parseInt(e[n]+e[n+1],16))}else for(var i=0,n=0;n<e.length;n++){var o=e.charCodeAt(n);o<128?r[i++]=o:o<2048?(r[i++]=o>>6|192,r[i++]=63&o|128):s(e,n)?(o=65536+((1023&o)<<10)+(1023&e.charCodeAt(++n)),r[i++]=o>>18|240,r[i++]=o>>12&63|128,r[i++]=o>>6&63|128,r[i++]=63&o|128):(r[i++]=o>>12|224,r[i++]=o>>6&63|128,r[i++]=63&o|128)}else for(n=0;n<e.length;n++)r[n]=0|e[n];return r},t.toHex=function(e){for(var t="",r=0;r<e.length;r++)t+=a(e[r].toString(16));return t},t.htonl=o,t.toHex32=function(e,t){for(var r="",i=0;i<e.length;i++){var n=e[i];"little"===t&&(n=o(n)),r+=c(n.toString(16))}return r},t.zero2=a,t.zero8=c,t.join32=function(e,t,r,n){var s=r-t;i(s%4==0);for(var o=new Array(s/4),a=0,c=t;a<o.length;a++,c+=4){var u;u="big"===n?e[c]<<24|e[c+1]<<16|e[c+2]<<8|e[c+3]:e[c+3]<<24|e[c+2]<<16|e[c+1]<<8|e[c],o[a]=u>>>0}return o},t.split32=function(e,t){for(var r=new Array(4*e.length),i=0,n=0;i<e.length;i++,n+=4){var s=e[i];"big"===t?(r[n]=s>>>24,r[n+1]=s>>>16&255,r[n+2]=s>>>8&255,r[n+3]=255&s):(r[n+3]=s>>>24,r[n+2]=s>>>16&255,r[n+1]=s>>>8&255,r[n]=255&s)}return r},t.rotr32=function(e,t){return e>>>t|e<<32-t},t.rotl32=function(e,t){return e<<t|e>>>32-t},t.sum32=function(e,t){return e+t>>>0},t.sum32_3=function(e,t,r){return e+t+r>>>0},t.sum32_4=function(e,t,r,i){return e+t+r+i>>>0},t.sum32_5=function(e,t,r,i,n){return e+t+r+i+n>>>0},t.sum64=function(e,t,r,i){var n=e[t],s=i+e[t+1]>>>0,o=(s<i?1:0)+r+n;e[t]=o>>>0,e[t+1]=s},t.sum64_hi=function(e,t,r,i){return(t+i>>>0<t?1:0)+e+r>>>0},t.sum64_lo=function(e,t,r,i){return t+i>>>0},t.sum64_4_hi=function(e,t,r,i,n,s,o,a){var c=0,u=t;return c+=(u=u+i>>>0)<t?1:0,c+=(u=u+s>>>0)<s?1:0,e+r+n+o+(c+=(u=u+a>>>0)<a?1:0)>>>0},t.sum64_4_lo=function(e,t,r,i,n,s,o,a){return t+i+s+a>>>0},t.sum64_5_hi=function(e,t,r,i,n,s,o,a,c,u){var h=0,d=t;return h+=(d=d+i>>>0)<t?1:0,h+=(d=d+s>>>0)<s?1:0,h+=(d=d+a>>>0)<a?1:0,e+r+n+o+c+(h+=(d=d+u>>>0)<u?1:0)>>>0},t.sum64_5_lo=function(e,t,r,i,n,s,o,a,c,u){return t+i+s+a+u>>>0},t.rotr64_hi=function(e,t,r){return(t<<32-r|e>>>r)>>>0},t.rotr64_lo=function(e,t,r){return(e<<32-r|t>>>r)>>>0},t.shr64_hi=function(e,t,r){return e>>>r},t.shr64_lo=function(e,t,r){return(e<<32-r|t>>>r)>>>0}},8045:(e,t,r)=>{"use strict";var i=r(796),n=r(8531),s=r(7292);function o(e){if(!(this instanceof o))return new o(e);this.hash=e.hash,this.predResist=!!e.predResist,this.outLen=this.hash.outSize,this.minEntropy=e.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var t=n.toArray(e.entropy,e.entropyEnc||"hex"),r=n.toArray(e.nonce,e.nonceEnc||"hex"),i=n.toArray(e.pers,e.persEnc||"hex");s(t.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(t,r,i)}e.exports=o,o.prototype._init=function(e,t,r){var i=e.concat(t).concat(r);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var n=0;n<this.V.length;n++)this.K[n]=0,this.V[n]=1;this._update(i),this._reseed=1,this.reseedInterval=281474976710656},o.prototype._hmac=function(){return new i.hmac(this.hash,this.K)},o.prototype._update=function(e){var t=this._hmac().update(this.V).update([0]);e&&(t=t.update(e)),this.K=t.digest(),this.V=this._hmac().update(this.V).digest(),e&&(this.K=this._hmac().update(this.V).update([1]).update(e).digest(),this.V=this._hmac().update(this.V).digest())},o.prototype.reseed=function(e,t,r,i){"string"!=typeof t&&(i=r,r=t,t=null),e=n.toArray(e,t),r=n.toArray(r,i),s(e.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(e.concat(r||[])),this._reseed=1},o.prototype.generate=function(e,t,r,i){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");"string"!=typeof t&&(i=r,r=t,t=null),r&&(r=n.toArray(r,i||"hex"),this._update(r));for(var s=[];s.length<e;)this.V=this._hmac().update(this.V).digest(),s=s.concat(this.V);var o=s.slice(0,e);return this._update(r),this._reseed++,n.encode(o,t)}},2003:(e,t,r)=>{try{var i=r(3837);if("function"!=typeof i.inherits)throw"";e.exports=i.inherits}catch(t){e.exports=r(946)}},946:e=>{"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},3543:function(e,t){!function(e){var t,r="undefined",i=r!==typeof Buffer&&Buffer,n=r!==typeof Uint8Array&&Uint8Array,s=r!==typeof ArrayBuffer&&ArrayBuffer,o=[0,0,0,0,0,0,0,0],a=Array.isArray||function(e){return!!e&&"[object Array]"==Object.prototype.toString.call(e)},c=4294967296;function u(a,u,w){var S=u?0:4,_=u?4:0,A=u?0:3,E=u?1:2,C=u?2:1,k=u?3:0,T=u?m:b,P=u?g:v,I=B.prototype,R="is"+a,x="_"+R;return I.buffer=void 0,I.offset=0,I[x]=!0,I.toNumber=O,I.toString=function(e){var t=this.buffer,r=this.offset,i=N(t,r+S),n=N(t,r+_),s="",o=!w&&2147483648&i;o&&(i=~i,n=c-n);e=e||10;for(;;){var a=i%e*c+n;if(i=Math.floor(i/e),n=Math.floor(a/e),s=(a%e).toString(e)+s,!i&&!n)break}o&&(s="-"+s);return s},I.toJSON=O,I.toArray=h,i&&(I.toBuffer=d),n&&(I.toArrayBuffer=l),B[R]=function(e){return!(!e||!e[x])},e[a]=B,B;function B(e,a,u,h){return this instanceof B?function(e,a,u,h,d){n&&s&&(a instanceof s&&(a=new n(a)),h instanceof s&&(h=new n(h)));if(!(a||u||h||t))return void(e.buffer=y(o,0));if(!f(a,u)){var l=t||Array;d=u,h=a,u=0,a=t===i?i.alloc(8):new l(8)}if(e.buffer=a,e.offset=u|=0,r===typeof h)return;"string"==typeof h?function(e,t,r,i){var n=0,s=r.length,o=0,a=0;"-"===r[0]&&n++;var u=n;for(;n<s;){var h=parseInt(r[n++],i);if(!(h>=0))break;a=a*i+h,o=o*i+Math.floor(a/c),a%=c}u&&(o=~o,a?a=c-a:o++);M(e,t+S,o),M(e,t+_,a)}(a,u,h,d||10):f(h,d)?p(a,u,h,d):"number"==typeof d?(M(a,u+S,h),M(a,u+_,d)):h>0?T(a,u,h):h<0?P(a,u,h):p(a,u,o,0)}(this,e,a,u,h):new B(e,a,u,h)}function O(){var e=this.buffer,t=this.offset,r=N(e,t+S),i=N(e,t+_);return w||(r|=0),r?r*c+i:i}function M(e,t,r){e[t+k]=255&r,r>>=8,e[t+C]=255&r,r>>=8,e[t+E]=255&r,r>>=8,e[t+A]=255&r}function N(e,t){return 16777216*e[t+A]+(e[t+E]<<16)+(e[t+C]<<8)+e[t+k]}}function h(e){var r=this.buffer,i=this.offset;return t=null,!1!==e&&a(r)?8===r.length?r:r.slice(i,i+8):y(r,i)}function d(e){var r=this.buffer,n=this.offset;return t=i,!1!==e&&i.isBuffer(r)?8===r.length?r:r.slice(n,n+8):i.from(l.call(this,e))}function l(e){var r=this.buffer,i=this.offset,o=r.buffer;if(t=n,!1!==e&&!r.offset&&o instanceof s)return 8===o.byteLength?o:o.slice(i,i+8);var a=new n(8);return p(a,0,r,i),a.buffer}function f(e,t){var r=e&&e.length;return t|=0,r&&t+8<=r&&"string"!=typeof e[t]}function p(e,t,r,i){t|=0,i|=0;for(var n=0;n<8;n++)e[t++]=255&r[i++]}function y(e,t){return Array.prototype.slice.call(e,t,t+8)}function m(e,t,r){for(var i=t+8;i>t;)e[--i]=255&r,r/=256}function g(e,t,r){var i=t+8;for(r++;i>t;)e[--i]=255&-r^255,r/=256}function b(e,t,r){for(var i=t+8;t<i;)e[t++]=255&r,r/=256}function v(e,t,r){var i=t+8;for(r++;t<i;)e[t++]=255&-r^255,r/=256}u("Uint64BE",!0,!0),u("Int64BE",!0,!1),u("Uint64LE",!1,!0),u("Int64LE",!1,!1)}("string"!=typeof t.nodeName?t:this||{})},4492:function(e){!function(t){"use strict";const r="(0?\\d+|0x[a-f0-9]+)",i={fourOctet:new RegExp(`^${r}\\.${r}\\.${r}\\.${r}$`,"i"),threeOctet:new RegExp(`^${r}\\.${r}\\.${r}$`,"i"),twoOctet:new RegExp(`^${r}\\.${r}$`,"i"),longValue:new RegExp(`^${r}$`,"i")},n=new RegExp("^0[0-7]+$","i"),s=new RegExp("^0x[a-f0-9]+$","i"),o="%[0-9a-z]{1,}",a="(?:[0-9a-f]+::?)+",c={zoneIndex:new RegExp(o,"i"),native:new RegExp(`^(::)?(${a})?([0-9a-f]+)?(::)?(${o})?$`,"i"),deprecatedTransitional:new RegExp(`^(?:::)(${r}\\.${r}\\.${r}\\.${r}(${o})?)$`,"i"),transitional:new RegExp(`^((?:${a})|(?:::)(?:${a})?)${r}\\.${r}\\.${r}\\.${r}(${o})?$`,"i")};function u(e,t){if(e.indexOf("::")!==e.lastIndexOf("::"))return null;let r,i,n=0,s=-1,o=(e.match(c.zoneIndex)||[])[0];for(o&&(o=o.substring(1),e=e.replace(/%.+$/,""));(s=e.indexOf(":",s+1))>=0;)n++;if("::"===e.substr(0,2)&&n--,"::"===e.substr(-2,2)&&n--,n>t)return null;for(i=t-n,r=":";i--;)r+="0:";return":"===(e=e.replace("::",r))[0]&&(e=e.slice(1)),":"===e[e.length-1]&&(e=e.slice(0,-1)),t=function(){const t=e.split(":"),r=[];for(let e=0;e<t.length;e++)r.push(parseInt(t[e],16));return r}(),{parts:t,zoneId:o}}function h(e,t,r,i){if(e.length!==t.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");let n,s=0;for(;i>0;){if(n=r-i,n<0&&(n=0),e[s]>>n!=t[s]>>n)return!1;i-=r,s+=1}return!0}function d(e){if(s.test(e))return parseInt(e,16);if("0"===e[0]&&!isNaN(parseInt(e[1],10))){if(n.test(e))return parseInt(e,8);throw new Error(`ipaddr: cannot parse ${e} as octal`)}return parseInt(e,10)}function l(e,t){for(;e.length<t;)e=`0${e}`;return e}const f={};f.IPv4=function(){function e(e){if(4!==e.length)throw new Error("ipaddr: ipv4 octet count should be 4");let t,r;for(t=0;t<e.length;t++)if(r=e[t],!(0<=r&&r<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=e}return e.prototype.SpecialRanges={unspecified:[[new e([0,0,0,0]),8]],broadcast:[[new e([255,255,255,255]),32]],multicast:[[new e([224,0,0,0]),4]],linkLocal:[[new e([169,254,0,0]),16]],loopback:[[new e([127,0,0,0]),8]],carrierGradeNat:[[new e([100,64,0,0]),10]],private:[[new e([10,0,0,0]),8],[new e([172,16,0,0]),12],[new e([192,168,0,0]),16]],reserved:[[new e([192,0,0,0]),24],[new e([192,0,2,0]),24],[new e([192,88,99,0]),24],[new e([198,51,100,0]),24],[new e([203,0,113,0]),24],[new e([240,0,0,0]),4]]},e.prototype.kind=function(){return"ipv4"},e.prototype.match=function(e,t){let r;if(void 0===t&&(r=e,e=r[0],t=r[1]),"ipv4"!==e.kind())throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return h(this.octets,e.octets,8,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const r={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0};let i,n,s;for(i=3;i>=0;i-=1){if(n=this.octets[i],!(n in r))return null;if(s=r[n],t&&0!==s)return null;8!==s&&(t=!0),e+=s}return 32-e},e.prototype.range=function(){return f.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){return this.octets.slice(0)},e.prototype.toIPv4MappedAddress=function(){return f.IPv6.parse(`::ffff:${this.toString()}`)},e.prototype.toNormalizedString=function(){return this.toString()},e.prototype.toString=function(){return this.octets.join(".")},e}(),f.IPv4.broadcastAddressFromCIDR=function(e){try{const t=this.parseCIDR(e),r=t[0].toByteArray(),i=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),n=[];let s=0;for(;s<4;)n.push(parseInt(r[s],10)|255^parseInt(i[s],10)),s++;return new this(n)}catch(e){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},f.IPv4.isIPv4=function(e){return null!==this.parser(e)},f.IPv4.isValid=function(e){try{return new this(this.parser(e)),!0}catch(e){return!1}},f.IPv4.isValidFourPartDecimal=function(e){return!(!f.IPv4.isValid(e)||!e.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},f.IPv4.networkAddressFromCIDR=function(e){let t,r,i,n,s;try{for(t=this.parseCIDR(e),i=t[0].toByteArray(),s=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),n=[],r=0;r<4;)n.push(parseInt(i[r],10)&parseInt(s[r],10)),r++;return new this(n)}catch(e){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},f.IPv4.parse=function(e){const t=this.parser(e);if(null===t)throw new Error("ipaddr: string is not formatted like an IPv4 Address");return new this(t)},f.IPv4.parseCIDR=function(e){let t;if(t=e.match(/^(.+)\/(\d+)$/)){const e=parseInt(t[2]);if(e>=0&&e<=32){const r=[this.parse(t[1]),e];return Object.defineProperty(r,"toString",{value:function(){return this.join("/")}}),r}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},f.IPv4.parser=function(e){let t,r,n;if(t=e.match(i.fourOctet))return function(){const e=t.slice(1,6),i=[];for(let t=0;t<e.length;t++)r=e[t],i.push(d(r));return i}();if(t=e.match(i.longValue)){if(n=d(t[1]),n>4294967295||n<0)throw new Error("ipaddr: address outside defined range");return function(){const e=[];let t;for(t=0;t<=24;t+=8)e.push(n>>t&255);return e}().reverse()}return(t=e.match(i.twoOctet))?function(){const e=t.slice(1,4),r=[];if(n=d(e[1]),n>16777215||n<0)throw new Error("ipaddr: address outside defined range");return r.push(d(e[0])),r.push(n>>16&255),r.push(n>>8&255),r.push(255&n),r}():(t=e.match(i.threeOctet))?function(){const e=t.slice(1,5),r=[];if(n=d(e[2]),n>65535||n<0)throw new Error("ipaddr: address outside defined range");return r.push(d(e[0])),r.push(d(e[1])),r.push(n>>8&255),r.push(255&n),r}():null},f.IPv4.subnetMaskFromPrefixLength=function(e){if((e=parseInt(e))<0||e>32)throw new Error("ipaddr: invalid IPv4 prefix length");const t=[0,0,0,0];let r=0;const i=Math.floor(e/8);for(;r<i;)t[r]=255,r++;return i<4&&(t[i]=Math.pow(2,e%8)-1<<8-e%8),new this(t)},f.IPv6=function(){function e(e,t){let r,i;if(16===e.length)for(this.parts=[],r=0;r<=14;r+=2)this.parts.push(e[r]<<8|e[r+1]);else{if(8!==e.length)throw new Error("ipaddr: ipv6 part count should be 8 or 16");this.parts=e}for(r=0;r<this.parts.length;r++)if(i=this.parts[r],!(0<=i&&i<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");t&&(this.zoneId=t)}return e.prototype.SpecialRanges={unspecified:[new e([0,0,0,0,0,0,0,0]),128],linkLocal:[new e([65152,0,0,0,0,0,0,0]),10],multicast:[new e([65280,0,0,0,0,0,0,0]),8],loopback:[new e([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new e([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new e([0,0,0,0,0,65535,0,0]),96],rfc6145:[new e([0,0,0,0,65535,0,0,0]),96],rfc6052:[new e([100,65435,0,0,0,0,0,0]),96],"6to4":[new e([8194,0,0,0,0,0,0,0]),16],teredo:[new e([8193,0,0,0,0,0,0,0]),32],reserved:[[new e([8193,3512,0,0,0,0,0,0]),32]]},e.prototype.isIPv4MappedAddress=function(){return"ipv4Mapped"===this.range()},e.prototype.kind=function(){return"ipv6"},e.prototype.match=function(e,t){let r;if(void 0===t&&(r=e,e=r[0],t=r[1]),"ipv6"!==e.kind())throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return h(this.parts,e.parts,16,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const r={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0};let i,n;for(let s=7;s>=0;s-=1){if(i=this.parts[s],!(i in r))return null;if(n=r[i],t&&0!==n)return null;16!==n&&(t=!0),e+=n}return 128-e},e.prototype.range=function(){return f.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){let e;const t=[],r=this.parts;for(let i=0;i<r.length;i++)e=r[i],t.push(e>>8),t.push(255&e);return t},e.prototype.toFixedLengthString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(l(this.parts[t].toString(16),4));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toIPv4Address=function(){if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");const e=this.parts.slice(-2),t=e[0],r=e[1];return new f.IPv4([t>>8,255&t,r>>8,255&r])},e.prototype.toNormalizedString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(this.parts[t].toString(16));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toRFC5952String=function(){const e=/((^|:)(0(:|$)){2,})/g,t=this.toNormalizedString();let r,i=0,n=-1;for(;r=e.exec(t);)r[0].length>n&&(i=r.index,n=r[0].length);return n<0?t:`${t.substring(0,i)}::${t.substring(i+n)}`},e.prototype.toString=function(){return this.toNormalizedString().replace(/((^|:)(0(:|$))+)/,"::")},e}(),f.IPv6.broadcastAddressFromCIDR=function(e){try{const t=this.parseCIDR(e),r=t[0].toByteArray(),i=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),n=[];let s=0;for(;s<16;)n.push(parseInt(r[s],10)|255^parseInt(i[s],10)),s++;return new this(n)}catch(e){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${e})`)}},f.IPv6.isIPv6=function(e){return null!==this.parser(e)},f.IPv6.isValid=function(e){if("string"==typeof e&&-1===e.indexOf(":"))return!1;try{const t=this.parser(e);return new this(t.parts,t.zoneId),!0}catch(e){return!1}},f.IPv6.networkAddressFromCIDR=function(e){let t,r,i,n,s;try{for(t=this.parseCIDR(e),i=t[0].toByteArray(),s=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),n=[],r=0;r<16;)n.push(parseInt(i[r],10)&parseInt(s[r],10)),r++;return new this(n)}catch(e){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${e})`)}},f.IPv6.parse=function(e){const t=this.parser(e);if(null===t.parts)throw new Error("ipaddr: string is not formatted like an IPv6 Address");return new this(t.parts,t.zoneId)},f.IPv6.parseCIDR=function(e){let t,r,i;if((r=e.match(/^(.+)\/(\d+)$/))&&(t=parseInt(r[2]),t>=0&&t<=128))return i=[this.parse(r[1]),t],Object.defineProperty(i,"toString",{value:function(){return this.join("/")}}),i;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},f.IPv6.parser=function(e){let t,r,i,n,s,o;if(i=e.match(c.deprecatedTransitional))return this.parser(`::ffff:${i[1]}`);if(c.native.test(e))return u(e,8);if((i=e.match(c.transitional))&&(o=i[6]||"",t=u(i[1].slice(0,-1)+o,6),t.parts)){for(s=[parseInt(i[2]),parseInt(i[3]),parseInt(i[4]),parseInt(i[5])],r=0;r<s.length;r++)if(n=s[r],!(0<=n&&n<=255))return null;return t.parts.push(s[0]<<8|s[1]),t.parts.push(s[2]<<8|s[3]),{parts:t.parts,zoneId:t.zoneId}}return null},f.IPv6.subnetMaskFromPrefixLength=function(e){if((e=parseInt(e))<0||e>128)throw new Error("ipaddr: invalid IPv6 prefix length");const t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];let r=0;const i=Math.floor(e/8);for(;r<i;)t[r]=255,r++;return i<16&&(t[i]=Math.pow(2,e%8)-1<<8-e%8),new this(t)},f.fromByteArray=function(e){const t=e.length;if(4===t)return new f.IPv4(e);if(16===t)return new f.IPv6(e);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},f.isValid=function(e){return f.IPv6.isValid(e)||f.IPv4.isValid(e)},f.parse=function(e){if(f.IPv6.isValid(e))return f.IPv6.parse(e);if(f.IPv4.isValid(e))return f.IPv4.parse(e);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},f.parseCIDR=function(e){try{return f.IPv6.parseCIDR(e)}catch(t){try{return f.IPv4.parseCIDR(e)}catch(e){throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},f.process=function(e){const t=this.parse(e);return"ipv6"===t.kind()&&t.isIPv4MappedAddress()?t.toIPv4Address():t},f.subnetMatch=function(e,t,r){let i,n,s,o;for(n in null==r&&(r="unicast"),t)if(Object.prototype.hasOwnProperty.call(t,n))for(s=t[n],!s[0]||s[0]instanceof Array||(s=[s]),i=0;i<s.length;i++)if(o=s[i],e.kind()===o[0].kind()&&e.match.apply(e,o))return n;return r},e.exports?e.exports=f:t.ipaddr=f}(this)},570:(e,t,r)=>{"use strict";var i=r(9952);function n(e){return!0===i(e)&&"[object Object]"===Object.prototype.toString.call(e)}e.exports=function(e){var t,r;return!1!==n(e)&&("function"==typeof(t=e.constructor)&&(!1!==n(r=t.prototype)&&!1!==r.hasOwnProperty("isPrototypeOf")))}},7666:e=>{"use strict";e.exports=function(e){return/^[$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc][$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc0-9\u0300-\u036f\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u0669\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u06f0-\u06f9\u0711\u0730-\u074a\u07a6-\u07b0\u07c0-\u07c9\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0859-\u085b\u08e4-\u08fe\u0900-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09cb-\u09cd\u09d7\u09e2\u09e3\u09e6-\u09ef\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c3e-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0ce6-\u0cef\u0d02\u0d03\u0d3e-\u0d44\u0d46-\u0d48\u0d4a-\u0d4d\u0d57\u0d62\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0e50-\u0e59\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e\u0f3f\u0f71-\u0f84\u0f86\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u102b-\u103e\u1040-\u1049\u1056-\u1059\u105e-\u1060\u1062-\u1064\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b4-\u17d3\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u18a9\u1920-\u192b\u1930-\u193b\u1946-\u194f\u19b0-\u19c0\u19c8\u19c9\u19d0-\u19d9\u1a17-\u1a1b\u1a55-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1b00-\u1b04\u1b34-\u1b44\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1b82\u1ba1-\u1bad\u1bb0-\u1bb9\u1be6-\u1bf3\u1c24-\u1c37\u1c40-\u1c49\u1c50-\u1c59\u1cd0-\u1cd2\u1cd4-\u1ce8\u1ced\u1cf2-\u1cf4\u1dc0-\u1de6\u1dfc-\u1dff\u200c\u200d\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2cef-\u2cf1\u2d7f\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua620-\ua629\ua66f\ua674-\ua67d\ua69f\ua6f0\ua6f1\ua802\ua806\ua80b\ua823-\ua827\ua880\ua881\ua8b4-\ua8c4\ua8d0-\ua8d9\ua8e0-\ua8f1\ua900-\ua909\ua926-\ua92d\ua947-\ua953\ua980-\ua983\ua9b3-\ua9c0\ua9d0-\ua9d9\uaa29-\uaa36\uaa43\uaa4c\uaa4d\uaa50-\uaa59\uaa7b\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uaaeb-\uaaef\uaaf5\uaaf6\uabe3-\uabea\uabec\uabed\uabf0-\uabf9\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f]*$/.test(e)}},9952:e=>{"use strict";e.exports=function(e){return null!=e&&"object"==typeof e&&!1===Array.isArray(e)}},239:(e,t)=>{t.jspack=new function(){var e,t=!1,r=this;r._DeArray=function(e,t,r){return[e.slice(t,t+r)]},r._EnArray=function(e,t,r,i){for(var n=0;n<r;e[t+n]=i[n]?i[n]:0,n++);},r._DeChar=function(e,t){return String.fromCharCode(e[t])},r._EnChar=function(e,t,r){e[t]=r.charCodeAt(0)},r._DeInt=function(r,i){var n,s,o,a=t?e.len-1:0,c=t?-1:1,u=a+c*e.len;for(n=0,s=a,o=1;s!=u;n+=r[i+s]*o,s+=c,o*=256);return e.bSigned&&n&Math.pow(2,8*e.len-1)&&(n-=Math.pow(2,8*e.len)),n},r._EnInt=function(r,i,n){var s,o=t?e.len-1:0,a=t?-1:1,c=o+a*e.len;for(n=n<e.min?e.min:n>e.max?e.max:n,s=o;s!=c;r[i+s]=255&n,s+=a,n>>=8);},r._DeString=function(e,t,r){for(var i=new Array(r),n=0;n<r;i[n]=String.fromCharCode(e[t+n]),n++);return i.join("")},r._EnString=function(e,t,r,i){for(var n,s=0;s<r;e[t+s]=(n=i.charCodeAt(s))?n:0,s++);},r._De754=function(r,i){var n,s,o,a,c,u,h,d,l,f;for(h=e.mLen,l=(f=(1<<(d=8*e.len-e.mLen-1))-1)>>1,a=t?0:e.len-1,c=t?1:-1,n=r[i+a],a+=c,s=n&(1<<-(u=-7))-1,n>>=-u,u+=d;u>0;s=256*s+r[i+a],a+=c,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=h;u>0;o=256*o+r[i+a],a+=c,u-=8);switch(s){case 0:s=1-l;break;case f:return o?NaN:1/0*(n?-1:1);default:o+=Math.pow(2,h),s-=l}return(n?-1:1)*o*Math.pow(2,s-h)},r._En754=function(r,i,n){var s,o,a,c,u,h,d,l,f,p;for(d=e.mLen,f=(p=(1<<(l=8*e.len-e.mLen-1))-1)>>1,s=n<0?1:0,n=Math.abs(n),isNaN(n)||n==1/0?(a=isNaN(n)?1:0,o=p):(o=Math.floor(Math.log(n)/Math.LN2),n*(h=Math.pow(2,-o))<1&&(o--,h*=2),(n+=o+f>=1?e.rt/h:e.rt*Math.pow(2,1-f))*h>=2&&(o++,h/=2),o+f>=p?(a=0,o=p):o+f>=1?(a=(n*h-1)*Math.pow(2,d),o+=f):(a=n*Math.pow(2,f-1)*Math.pow(2,d),o=0)),c=t?e.len-1:0,u=t?-1:1;d>=8;r[i+c]=255&a,c+=u,a/=256,d-=8);for(o=o<<d|a,l+=d;l>0;r[i+c]=255&o,c+=u,o/=256,l-=8);r[i+c-u]|=128*s},r._DeInt64=function(r,i){var n,s,o,a=t?0:7,c=t?1:-1,u=a+8*c,h=[0,0,!e.bSigned];for(n=a,o=1,s=0;n!=u;h[o]=(h[o]<<8>>>0)+r[i+n],n+=c,o=++s<4?1:0);return h},r._EnInt64=function(e,r,i){var n,s,o,a,c=t?0:7,u=t?1:-1,h=c+8*u;for(n=c,o=1,s=0,a=24;n!=h;e[r+n]=i[o]>>a&255,n+=u,o=++s<4?1:0,a=24-s%4*8);},r._sPattern="(\\d+)?([AxcbBhHsfdiIlLqQ])",r._lenLut={A:1,x:1,c:1,b:1,B:1,h:2,H:2,s:1,f:4,d:8,i:4,I:4,l:4,L:4,q:8,Q:8},r._elLut={A:{en:r._EnArray,de:r._DeArray},s:{en:r._EnString,de:r._DeString},c:{en:r._EnChar,de:r._DeChar},b:{en:r._EnInt,de:r._DeInt,len:1,bSigned:!0,min:-Math.pow(2,7),max:Math.pow(2,7)-1},B:{en:r._EnInt,de:r._DeInt,len:1,bSigned:!1,min:0,max:Math.pow(2,8)-1},h:{en:r._EnInt,de:r._DeInt,len:2,bSigned:!0,min:-Math.pow(2,15),max:Math.pow(2,15)-1},H:{en:r._EnInt,de:r._DeInt,len:2,bSigned:!1,min:0,max:Math.pow(2,16)-1},i:{en:r._EnInt,de:r._DeInt,len:4,bSigned:!0,min:-Math.pow(2,31),max:Math.pow(2,31)-1},I:{en:r._EnInt,de:r._DeInt,len:4,bSigned:!1,min:0,max:Math.pow(2,32)-1},l:{en:r._EnInt,de:r._DeInt,len:4,bSigned:!0,min:-Math.pow(2,31),max:Math.pow(2,31)-1},L:{en:r._EnInt,de:r._DeInt,len:4,bSigned:!1,min:0,max:Math.pow(2,32)-1},f:{en:r._En754,de:r._De754,len:4,mLen:23,rt:Math.pow(2,-24)-Math.pow(2,-77)},d:{en:r._En754,de:r._De754,len:8,mLen:52,rt:0},q:{en:r._EnInt64,de:r._DeInt64,bSigned:!0},Q:{en:r._EnInt64,de:r._DeInt64,bSigned:!1}},r._UnpackSeries=function(t,r,i,n){for(var s=e.de,o=[],a=0;a<t;o.push(s(i,n+a*r)),a++);return o},r._PackSeries=function(t,r,i,n,s,o){for(var a=e.en,c=0;c<t;a(i,n+c*r,s[o+c]),c++);},r.Unpack=function(r,i,n){t="<"!=r.charAt(0),n=n||0;for(var s,o,a,c=new RegExp(this._sPattern,"g"),u=[];s=c.exec(r);){if(n+(o=null==s[1]||""==s[1]?1:parseInt(s[1]))*(a=this._lenLut[s[2]])>i.length)return;switch(s[2]){case"A":case"s":u.push(this._elLut[s[2]].de(i,n,o));break;case"c":case"b":case"B":case"h":case"H":case"i":case"I":case"l":case"L":case"f":case"d":case"q":case"Q":e=this._elLut[s[2]],u.push(this._UnpackSeries(o,a,i,n))}n+=o*a}return Array.prototype.concat.apply([],u)},r.PackTo=function(r,i,n,s){t="<"!=r.charAt(0);for(var o,a,c,u,h=new RegExp(this._sPattern,"g"),d=0;o=h.exec(r);){if(n+(a=null==o[1]||""==o[1]?1:parseInt(o[1]))*(c=this._lenLut[o[2]])>i.length)return!1;switch(o[2]){case"A":case"s":if(d+1>s.length)return!1;this._elLut[o[2]].en(i,n,a,s[d]),d+=1;break;case"c":case"b":case"B":case"h":case"H":case"i":case"I":case"l":case"L":case"f":case"d":case"q":case"Q":if(e=this._elLut[o[2]],d+a>s.length)return!1;this._PackSeries(a,c,i,n,s,d),d+=a;break;case"x":for(u=0;u<a;u++)i[n+u]=0}n+=a*c}return i},r.Pack=function(e,t){return this.PackTo(e,new Array(this.CalcLength(e)),0,t)},r.CalcLength=function(e){for(var t,r=new RegExp(this._sPattern,"g"),i=0;t=r.exec(e);)i+=(null==t[1]||""==t[1]?1:parseInt(t[1]))*this._lenLut[t[2]];return i}}},2655:(e,t,r)=>{var i=r(3120)(r(5737),"DataView");e.exports=i},7958:(e,t,r)=>{var i=r(1307),n=r(917),s=r(9148),o=r(9857),a=r(2717);function c(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}c.prototype.clear=i,c.prototype.delete=n,c.prototype.get=s,c.prototype.has=o,c.prototype.set=a,e.exports=c},8089:(e,t,r)=>{var i=r(1273),n=r(2449),s=r(892),o=r(3974),a=r(9537);function c(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}c.prototype.clear=i,c.prototype.delete=n,c.prototype.get=s,c.prototype.has=o,c.prototype.set=a,e.exports=c},4876:(e,t,r)=>{var i=r(3120)(r(5737),"Map");e.exports=i},8808:(e,t,r)=>{var i=r(4970),n=r(8616),s=r(49),o=r(3380),a=r(4870);function c(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}c.prototype.clear=i,c.prototype.delete=n,c.prototype.get=s,c.prototype.has=o,c.prototype.set=a,e.exports=c},1746:(e,t,r)=>{var i=r(3120)(r(5737),"Promise");e.exports=i},7561:(e,t,r)=>{var i=r(3120)(r(5737),"Set");e.exports=i},6375:(e,t,r)=>{var i=r(8808),n=r(3124),s=r(3742);function o(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new i;++t<r;)this.add(e[t])}o.prototype.add=o.prototype.push=n,o.prototype.has=s,e.exports=o},6470:(e,t,r)=>{var i=r(8089),n=r(4575),s=r(9422),o=r(6127),a=r(6693),c=r(3510);function u(e){var t=this.__data__=new i(e);this.size=t.size}u.prototype.clear=n,u.prototype.delete=s,u.prototype.get=o,u.prototype.has=a,u.prototype.set=c,e.exports=u},4651:(e,t,r)=>{var i=r(5737).Symbol;e.exports=i},1217:(e,t,r)=>{var i=r(5737).Uint8Array;e.exports=i},8365:(e,t,r)=>{var i=r(3120)(r(5737),"WeakMap");e.exports=i},3533:e=>{e.exports=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}},3773:e=>{e.exports=function(e,t){for(var r=-1,i=null==e?0:e.length;++r<i&&!1!==t(e[r],r,e););return e}},859:e=>{e.exports=function(e,t){for(var r=-1,i=null==e?0:e.length,n=0,s=[];++r<i;){var o=e[r];t(o,r,e)&&(s[n++]=o)}return s}},5327:(e,t,r)=>{var i=r(2058),n=r(3402),s=r(262),o=r(482),a=r(5868),c=r(8516),u=Object.prototype.hasOwnProperty;e.exports=function(e,t){var r=s(e),h=!r&&n(e),d=!r&&!h&&o(e),l=!r&&!h&&!d&&c(e),f=r||h||d||l,p=f?i(e.length,String):[],y=p.length;for(var m in e)!t&&!u.call(e,m)||f&&("length"==m||d&&("offset"==m||"parent"==m)||l&&("buffer"==m||"byteLength"==m||"byteOffset"==m)||a(m,y))||p.push(m);return p}},3627:e=>{e.exports=function(e,t){for(var r=-1,i=t.length,n=e.length;++r<i;)e[n+r]=t[r];return e}},1009:e=>{e.exports=function(e,t){for(var r=-1,i=null==e?0:e.length;++r<i;)if(t(e[r],r,e))return!0;return!1}},3654:(e,t,r)=>{var i=r(3392),n=r(6924);e.exports=function(e,t,r){(void 0!==r&&!n(e[t],r)||void 0===r&&!(t in e))&&i(e,t,r)}},5928:(e,t,r)=>{var i=r(3392),n=r(6924),s=Object.prototype.hasOwnProperty;e.exports=function(e,t,r){var o=e[t];s.call(e,t)&&n(o,r)&&(void 0!==r||t in e)||i(e,t,r)}},6530:(e,t,r)=>{var i=r(6924);e.exports=function(e,t){for(var r=e.length;r--;)if(i(e[r][0],t))return r;return-1}},5107:(e,t,r)=>{var i=r(1504),n=r(5220);e.exports=function(e,t){return e&&i(t,n(t),e)}},8011:(e,t,r)=>{var i=r(1504),n=r(9120);e.exports=function(e,t){return e&&i(t,n(t),e)}},3392:(e,t,r)=>{var i=r(4586);e.exports=function(e,t,r){"__proto__"==t&&i?i(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}},6752:(e,t,r)=>{var i=r(6470),n=r(3773),s=r(5928),o=r(5107),a=r(8011),c=r(9117),u=r(6760),h=r(9460),d=r(9042),l=r(5330),f=r(9557),p=r(2489),y=r(9172),m=r(7938),g=r(4218),b=r(262),v=r(482),w=r(9895),S=r(7861),_=r(1523),A=r(5220),E=r(9120),C="[object Arguments]",k="[object Function]",T="[object Object]",P={};P[C]=P["[object Array]"]=P["[object ArrayBuffer]"]=P["[object DataView]"]=P["[object Boolean]"]=P["[object Date]"]=P["[object Float32Array]"]=P["[object Float64Array]"]=P["[object Int8Array]"]=P["[object Int16Array]"]=P["[object Int32Array]"]=P["[object Map]"]=P["[object Number]"]=P[T]=P["[object RegExp]"]=P["[object Set]"]=P["[object String]"]=P["[object Symbol]"]=P["[object Uint8Array]"]=P["[object Uint8ClampedArray]"]=P["[object Uint16Array]"]=P["[object Uint32Array]"]=!0,P["[object Error]"]=P[k]=P["[object WeakMap]"]=!1,e.exports=function e(t,r,I,R,x,B){var O,M=1&r,N=2&r,D=4&r;if(I&&(O=x?I(t,R,x,B):I(t)),void 0!==O)return O;if(!S(t))return t;var L=b(t);if(L){if(O=y(t),!M)return u(t,O)}else{var U=p(t),j=U==k||"[object GeneratorFunction]"==U;if(v(t))return c(t,M);if(U==T||U==C||j&&!x){if(O=N||j?{}:g(t),!M)return N?d(t,a(O,t)):h(t,o(O,t))}else{if(!P[U])return x?t:{};O=m(t,U,M)}}B||(B=new i);var q=B.get(t);if(q)return q;B.set(t,O),_(t)?t.forEach((function(i){O.add(e(i,r,I,i,t,B))})):w(t)&&t.forEach((function(i,n){O.set(n,e(i,r,I,n,t,B))}));var K=L?void 0:(D?N?f:l:N?E:A)(t);return n(K||t,(function(i,n){K&&(i=t[n=i]),s(O,n,e(i,r,I,n,t,B))})),O}},631:(e,t,r)=>{var i=r(7861),n=Object.create,s=function(){function e(){}return function(t){if(!i(t))return{};if(n)return n(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();e.exports=s},2274:(e,t,r)=>{var i=r(9404)();e.exports=i},4063:(e,t,r)=>{var i=r(3627),n=r(262);e.exports=function(e,t,r){var s=t(e);return n(e)?s:i(s,r(e))}},9678:(e,t,r)=>{var i=r(4651),n=r(1737),s=r(4448),o=i?i.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":o&&o in Object(e)?n(e):s(e)}},803:(e,t,r)=>{var i=r(9678),n=r(845);e.exports=function(e){return n(e)&&"[object Arguments]"==i(e)}},6312:(e,t,r)=>{var i=r(7350),n=r(845);e.exports=function e(t,r,s,o,a){return t===r||(null==t||null==r||!n(t)&&!n(r)?t!=t&&r!=r:i(t,r,s,o,e,a))}},7350:(e,t,r)=>{var i=r(6470),n=r(465),s=r(5180),o=r(8643),a=r(2489),c=r(262),u=r(482),h=r(8516),d="[object Arguments]",l="[object Array]",f="[object Object]",p=Object.prototype.hasOwnProperty;e.exports=function(e,t,r,y,m,g){var b=c(e),v=c(t),w=b?l:a(e),S=v?l:a(t),_=(w=w==d?f:w)==f,A=(S=S==d?f:S)==f,E=w==S;if(E&&u(e)){if(!u(t))return!1;b=!0,_=!1}if(E&&!_)return g||(g=new i),b||h(e)?n(e,t,r,y,m,g):s(e,t,w,r,y,m,g);if(!(1&r)){var C=_&&p.call(e,"__wrapped__"),k=A&&p.call(t,"__wrapped__");if(C||k){var T=C?e.value():e,P=k?t.value():t;return g||(g=new i),m(T,P,r,y,g)}}return!!E&&(g||(g=new i),o(e,t,r,y,m,g))}},5361:(e,t,r)=>{var i=r(2489),n=r(845);e.exports=function(e){return n(e)&&"[object Map]"==i(e)}},9078:(e,t,r)=>{var i=r(9373),n=r(3112),s=r(7861),o=r(685),a=/^\[object .+?Constructor\]$/,c=Function.prototype,u=Object.prototype,h=c.toString,d=u.hasOwnProperty,l=RegExp("^"+h.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!s(e)||n(e))&&(i(e)?l:a).test(o(e))}},1782:(e,t,r)=>{var i=r(2489),n=r(845);e.exports=function(e){return n(e)&&"[object Set]"==i(e)}},1271:(e,t,r)=>{var i=r(9678),n=r(3579),s=r(845),o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1,e.exports=function(e){return s(e)&&n(e.length)&&!!o[i(e)]}},5547:(e,t,r)=>{var i=r(184),n=r(8804),s=Object.prototype.hasOwnProperty;e.exports=function(e){if(!i(e))return n(e);var t=[];for(var r in Object(e))s.call(e,r)&&"constructor"!=r&&t.push(r);return t}},4732:(e,t,r)=>{var i=r(7861),n=r(184),s=r(1461),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!i(e))return s(e);var t=n(e),r=[];for(var a in e)("constructor"!=a||!t&&o.call(e,a))&&r.push(a);return r}},6755:(e,t,r)=>{var i=r(6470),n=r(3654),s=r(2274),o=r(1769),a=r(7861),c=r(9120),u=r(4539);e.exports=function e(t,r,h,d,l){t!==r&&s(r,(function(s,c){if(l||(l=new i),a(s))o(t,r,c,h,e,d,l);else{var f=d?d(u(t,c),s,c+"",t,r,l):void 0;void 0===f&&(f=s),n(t,c,f)}}),c)}},1769:(e,t,r)=>{var i=r(3654),n=r(9117),s=r(8006),o=r(6760),a=r(4218),c=r(3402),u=r(262),h=r(6912),d=r(482),l=r(9373),f=r(7861),p=r(91),y=r(8516),m=r(4539),g=r(3139);e.exports=function(e,t,r,b,v,w,S){var _=m(e,r),A=m(t,r),E=S.get(A);if(E)i(e,r,E);else{var C=w?w(_,A,r+"",e,t,S):void 0,k=void 0===C;if(k){var T=u(A),P=!T&&d(A),I=!T&&!P&&y(A);C=A,T||P||I?u(_)?C=_:h(_)?C=o(_):P?(k=!1,C=n(A,!0)):I?(k=!1,C=s(A,!0)):C=[]:p(A)||c(A)?(C=_,c(_)?C=g(_):f(_)&&!l(_)||(C=a(A))):k=!1}k&&(S.set(A,C),v(C,A,b,w,S),S.delete(A)),i(e,r,C)}}},609:e=>{var t=Math.ceil,r=Math.max;e.exports=function(e,i,n,s){for(var o=-1,a=r(t((i-e)/(n||1)),0),c=Array(a);a--;)c[s?a:++o]=e,e+=n;return c}},5286:(e,t,r)=>{var i=r(3155),n=r(6051),s=r(2904);e.exports=function(e,t){return s(n(e,t,i),e+"")}},9447:(e,t,r)=>{var i=r(1453),n=r(4586),s=r(3155),o=n?function(e,t){return n(e,"toString",{configurable:!0,enumerable:!1,value:i(t),writable:!0})}:s;e.exports=o},2058:e=>{e.exports=function(e,t){for(var r=-1,i=Array(e);++r<e;)i[r]=t(r);return i}},2132:(e,t,r)=>{var i=r(985),n=/^\s+/;e.exports=function(e){return e?e.slice(0,i(e)+1).replace(n,""):e}},2089:e=>{e.exports=function(e){return function(t){return e(t)}}},4164:e=>{e.exports=function(e,t){return e.has(t)}},8558:(e,t,r)=>{var i=r(3155);e.exports=function(e){return"function"==typeof e?e:i}},1043:(e,t,r)=>{var i=r(1217);e.exports=function(e){var t=new e.constructor(e.byteLength);return new i(t).set(new i(e)),t}},9117:(e,t,r)=>{e=r.nmd(e);var i=r(5737),n=t&&!t.nodeType&&t,s=n&&e&&!e.nodeType&&e,o=s&&s.exports===n?i.Buffer:void 0,a=o?o.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var r=e.length,i=a?a(r):new e.constructor(r);return e.copy(i),i}},2452:(e,t,r)=>{var i=r(1043);e.exports=function(e,t){var r=t?i(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}},6856:e=>{var t=/\w*$/;e.exports=function(e){var r=new e.constructor(e.source,t.exec(e));return r.lastIndex=e.lastIndex,r}},3239:(e,t,r)=>{var i=r(4651),n=i?i.prototype:void 0,s=n?n.valueOf:void 0;e.exports=function(e){return s?Object(s.call(e)):{}}},8006:(e,t,r)=>{var i=r(1043);e.exports=function(e,t){var r=t?i(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}},6760:e=>{e.exports=function(e,t){var r=-1,i=e.length;for(t||(t=Array(i));++r<i;)t[r]=e[r];return t}},1504:(e,t,r)=>{var i=r(5928),n=r(3392);e.exports=function(e,t,r,s){var o=!r;r||(r={});for(var a=-1,c=t.length;++a<c;){var u=t[a],h=s?s(r[u],e[u],u,r,e):void 0;void 0===h&&(h=e[u]),o?n(r,u,h):i(r,u,h)}return r}},9460:(e,t,r)=>{var i=r(1504),n=r(5342);e.exports=function(e,t){return i(e,n(e),t)}},9042:(e,t,r)=>{var i=r(1504),n=r(3272);e.exports=function(e,t){return i(e,n(e),t)}},2353:(e,t,r)=>{var i=r(5737)["__core-js_shared__"];e.exports=i},3928:(e,t,r)=>{var i=r(5286),n=r(8457);e.exports=function(e){return i((function(t,r){var i=-1,s=r.length,o=s>1?r[s-1]:void 0,a=s>2?r[2]:void 0;for(o=e.length>3&&"function"==typeof o?(s--,o):void 0,a&&n(r[0],r[1],a)&&(o=s<3?void 0:o,s=1),t=Object(t);++i<s;){var c=r[i];c&&e(t,c,i,o)}return t}))}},9404:e=>{e.exports=function(e){return function(t,r,i){for(var n=-1,s=Object(t),o=i(t),a=o.length;a--;){var c=o[e?a:++n];if(!1===r(s[c],c,s))break}return t}}},362:(e,t,r)=>{var i=r(609),n=r(8457),s=r(8456);e.exports=function(e){return function(t,r,o){return o&&"number"!=typeof o&&n(t,r,o)&&(r=o=void 0),t=s(t),void 0===r?(r=t,t=0):r=s(r),o=void 0===o?t<r?1:-1:s(o),i(t,r,o,e)}}},4586:(e,t,r)=>{var i=r(3120),n=function(){try{var e=i(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=n},465:(e,t,r)=>{var i=r(6375),n=r(1009),s=r(4164);e.exports=function(e,t,r,o,a,c){var u=1&r,h=e.length,d=t.length;if(h!=d&&!(u&&d>h))return!1;var l=c.get(e),f=c.get(t);if(l&&f)return l==t&&f==e;var p=-1,y=!0,m=2&r?new i:void 0;for(c.set(e,t),c.set(t,e);++p<h;){var g=e[p],b=t[p];if(o)var v=u?o(b,g,p,t,e,c):o(g,b,p,e,t,c);if(void 0!==v){if(v)continue;y=!1;break}if(m){if(!n(t,(function(e,t){if(!s(m,t)&&(g===e||a(g,e,r,o,c)))return m.push(t)}))){y=!1;break}}else if(g!==b&&!a(g,b,r,o,c)){y=!1;break}}return c.delete(e),c.delete(t),y}},5180:(e,t,r)=>{var i=r(4651),n=r(1217),s=r(6924),o=r(465),a=r(7612),c=r(3896),u=i?i.prototype:void 0,h=u?u.valueOf:void 0;e.exports=function(e,t,r,i,u,d,l){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!d(new n(e),new n(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return s(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var f=a;case"[object Set]":var p=1&i;if(f||(f=c),e.size!=t.size&&!p)return!1;var y=l.get(e);if(y)return y==t;i|=2,l.set(e,t);var m=o(f(e),f(t),i,u,d,l);return l.delete(e),m;case"[object Symbol]":if(h)return h.call(e)==h.call(t)}return!1}},8643:(e,t,r)=>{var i=r(5330),n=Object.prototype.hasOwnProperty;e.exports=function(e,t,r,s,o,a){var c=1&r,u=i(e),h=u.length;if(h!=i(t).length&&!c)return!1;for(var d=h;d--;){var l=u[d];if(!(c?l in t:n.call(t,l)))return!1}var f=a.get(e),p=a.get(t);if(f&&p)return f==t&&p==e;var y=!0;a.set(e,t),a.set(t,e);for(var m=c;++d<h;){var g=e[l=u[d]],b=t[l];if(s)var v=c?s(b,g,l,t,e,a):s(g,b,l,e,t,a);if(!(void 0===v?g===b||o(g,b,r,s,a):v)){y=!1;break}m||(m="constructor"==l)}if(y&&!m){var w=e.constructor,S=t.constructor;w==S||!("constructor"in e)||!("constructor"in t)||"function"==typeof w&&w instanceof w&&"function"==typeof S&&S instanceof S||(y=!1)}return a.delete(e),a.delete(t),y}},5911:e=>{var t="object"==typeof global&&global&&global.Object===Object&&global;e.exports=t},5330:(e,t,r)=>{var i=r(4063),n=r(5342),s=r(5220);e.exports=function(e){return i(e,s,n)}},9557:(e,t,r)=>{var i=r(4063),n=r(3272),s=r(9120);e.exports=function(e){return i(e,s,n)}},8048:(e,t,r)=>{var i=r(9674);e.exports=function(e,t){var r=e.__data__;return i(t)?r["string"==typeof t?"string":"hash"]:r.map}},3120:(e,t,r)=>{var i=r(9078),n=r(5219);e.exports=function(e,t){var r=n(e,t);return i(r)?r:void 0}},7494:(e,t,r)=>{var i=r(6295)(Object.getPrototypeOf,Object);e.exports=i},1737:(e,t,r)=>{var i=r(4651),n=Object.prototype,s=n.hasOwnProperty,o=n.toString,a=i?i.toStringTag:void 0;e.exports=function(e){var t=s.call(e,a),r=e[a];try{e[a]=void 0;var i=!0}catch(e){}var n=o.call(e);return i&&(t?e[a]=r:delete e[a]),n}},5342:(e,t,r)=>{var i=r(859),n=r(4541),s=Object.prototype.propertyIsEnumerable,o=Object.getOwnPropertySymbols,a=o?function(e){return null==e?[]:(e=Object(e),i(o(e),(function(t){return s.call(e,t)})))}:n;e.exports=a},3272:(e,t,r)=>{var i=r(3627),n=r(7494),s=r(5342),o=r(4541),a=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)i(t,s(e)),e=n(e);return t}:o;e.exports=a},2489:(e,t,r)=>{var i=r(2655),n=r(4876),s=r(1746),o=r(7561),a=r(8365),c=r(9678),u=r(685),h="[object Map]",d="[object Promise]",l="[object Set]",f="[object WeakMap]",p="[object DataView]",y=u(i),m=u(n),g=u(s),b=u(o),v=u(a),w=c;(i&&w(new i(new ArrayBuffer(1)))!=p||n&&w(new n)!=h||s&&w(s.resolve())!=d||o&&w(new o)!=l||a&&w(new a)!=f)&&(w=function(e){var t=c(e),r="[object Object]"==t?e.constructor:void 0,i=r?u(r):"";if(i)switch(i){case y:return p;case m:return h;case g:return d;case b:return l;case v:return f}return t}),e.exports=w},5219:e=>{e.exports=function(e,t){return null==e?void 0:e[t]}},1307:(e,t,r)=>{var i=r(7869);e.exports=function(){this.__data__=i?i(null):{},this.size=0}},917:e=>{e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},9148:(e,t,r)=>{var i=r(7869),n=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(i){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return n.call(t,e)?t[e]:void 0}},9857:(e,t,r)=>{var i=r(7869),n=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return i?void 0!==t[e]:n.call(t,e)}},2717:(e,t,r)=>{var i=r(7869);e.exports=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=i&&void 0===t?"__lodash_hash_undefined__":t,this}},9172:e=>{var t=Object.prototype.hasOwnProperty;e.exports=function(e){var r=e.length,i=new e.constructor(r);return r&&"string"==typeof e[0]&&t.call(e,"index")&&(i.index=e.index,i.input=e.input),i}},7938:(e,t,r)=>{var i=r(1043),n=r(2452),s=r(6856),o=r(3239),a=r(8006);e.exports=function(e,t,r){var c=e.constructor;switch(t){case"[object ArrayBuffer]":return i(e);case"[object Boolean]":case"[object Date]":return new c(+e);case"[object DataView]":return n(e,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return a(e,r);case"[object Map]":case"[object Set]":return new c;case"[object Number]":case"[object String]":return new c(e);case"[object RegExp]":return s(e);case"[object Symbol]":return o(e)}}},4218:(e,t,r)=>{var i=r(631),n=r(7494),s=r(184);e.exports=function(e){return"function"!=typeof e.constructor||s(e)?{}:i(n(e))}},5868:e=>{var t=/^(?:0|[1-9]\d*)$/;e.exports=function(e,r){var i=typeof e;return!!(r=null==r?9007199254740991:r)&&("number"==i||"symbol"!=i&&t.test(e))&&e>-1&&e%1==0&&e<r}},8457:(e,t,r)=>{var i=r(6924),n=r(6448),s=r(5868),o=r(7861);e.exports=function(e,t,r){if(!o(r))return!1;var a=typeof t;return!!("number"==a?n(r)&&s(t,r.length):"string"==a&&t in r)&&i(r[t],e)}},9674:e=>{e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},3112:(e,t,r)=>{var i,n=r(2353),s=(i=/[^.]+$/.exec(n&&n.keys&&n.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"";e.exports=function(e){return!!s&&s in e}},184:e=>{var t=Object.prototype;e.exports=function(e){var r=e&&e.constructor;return e===("function"==typeof r&&r.prototype||t)}},1273:e=>{e.exports=function(){this.__data__=[],this.size=0}},2449:(e,t,r)=>{var i=r(6530),n=Array.prototype.splice;e.exports=function(e){var t=this.__data__,r=i(t,e);return!(r<0)&&(r==t.length-1?t.pop():n.call(t,r,1),--this.size,!0)}},892:(e,t,r)=>{var i=r(6530);e.exports=function(e){var t=this.__data__,r=i(t,e);return r<0?void 0:t[r][1]}},3974:(e,t,r)=>{var i=r(6530);e.exports=function(e){return i(this.__data__,e)>-1}},9537:(e,t,r)=>{var i=r(6530);e.exports=function(e,t){var r=this.__data__,n=i(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}},4970:(e,t,r)=>{var i=r(7958),n=r(8089),s=r(4876);e.exports=function(){this.size=0,this.__data__={hash:new i,map:new(s||n),string:new i}}},8616:(e,t,r)=>{var i=r(8048);e.exports=function(e){var t=i(this,e).delete(e);return this.size-=t?1:0,t}},49:(e,t,r)=>{var i=r(8048);e.exports=function(e){return i(this,e).get(e)}},3380:(e,t,r)=>{var i=r(8048);e.exports=function(e){return i(this,e).has(e)}},4870:(e,t,r)=>{var i=r(8048);e.exports=function(e,t){var r=i(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}},7612:e=>{e.exports=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e,i){r[++t]=[i,e]})),r}},7869:(e,t,r)=>{var i=r(3120)(Object,"create");e.exports=i},8804:(e,t,r)=>{var i=r(6295)(Object.keys,Object);e.exports=i},1461:e=>{e.exports=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}},8743:(e,t,r)=>{e=r.nmd(e);var i=r(5911),n=t&&!t.nodeType&&t,s=n&&e&&!e.nodeType&&e,o=s&&s.exports===n&&i.process,a=function(){try{var e=s&&s.require&&s.require("util").types;return e||o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=a},4448:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},6295:e=>{e.exports=function(e,t){return function(r){return e(t(r))}}},6051:(e,t,r)=>{var i=r(3533),n=Math.max;e.exports=function(e,t,r){return t=n(void 0===t?e.length-1:t,0),function(){for(var s=arguments,o=-1,a=n(s.length-t,0),c=Array(a);++o<a;)c[o]=s[t+o];o=-1;for(var u=Array(t+1);++o<t;)u[o]=s[o];return u[t]=r(c),i(e,this,u)}}},5737:(e,t,r)=>{var i=r(5911),n="object"==typeof self&&self&&self.Object===Object&&self,s=i||n||Function("return this")();e.exports=s},4539:e=>{e.exports=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}},3124:e=>{e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},3742:e=>{e.exports=function(e){return this.__data__.has(e)}},3896:e=>{e.exports=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}},2904:(e,t,r)=>{var i=r(9447),n=r(1621)(i);e.exports=n},1621:e=>{var t=Date.now;e.exports=function(e){var r=0,i=0;return function(){var n=t(),s=16-(n-i);if(i=n,s>0){if(++r>=800)return arguments[0]}else r=0;return e.apply(void 0,arguments)}}},4575:(e,t,r)=>{var i=r(8089);e.exports=function(){this.__data__=new i,this.size=0}},9422:e=>{e.exports=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}},6127:e=>{e.exports=function(e){return this.__data__.get(e)}},6693:e=>{e.exports=function(e){return this.__data__.has(e)}},3510:(e,t,r)=>{var i=r(8089),n=r(4876),s=r(8808);e.exports=function(e,t){var r=this.__data__;if(r instanceof i){var o=r.__data__;if(!n||o.length<199)return o.push([e,t]),this.size=++r.size,this;r=this.__data__=new s(o)}return r.set(e,t),this.size=r.size,this}},685:e=>{var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},985:e=>{var t=/\s/;e.exports=function(e){for(var r=e.length;r--&&t.test(e.charAt(r)););return r}},825:(e,t,r)=>{var i=r(6752);e.exports=function(e){return i(e,5)}},1453:e=>{e.exports=function(e){return function(){return e}}},6924:e=>{e.exports=function(e,t){return e===t||e!=e&&t!=t}},3155:e=>{e.exports=function(e){return e}},3402:(e,t,r)=>{var i=r(803),n=r(845),s=Object.prototype,o=s.hasOwnProperty,a=s.propertyIsEnumerable,c=i(function(){return arguments}())?i:function(e){return n(e)&&o.call(e,"callee")&&!a.call(e,"callee")};e.exports=c},262:e=>{var t=Array.isArray;e.exports=t},6448:(e,t,r)=>{var i=r(9373),n=r(3579);e.exports=function(e){return null!=e&&n(e.length)&&!i(e)}},6912:(e,t,r)=>{var i=r(6448),n=r(845);e.exports=function(e){return n(e)&&i(e)}},482:(e,t,r)=>{e=r.nmd(e);var i=r(5737),n=r(1387),s=t&&!t.nodeType&&t,o=s&&e&&!e.nodeType&&e,a=o&&o.exports===s?i.Buffer:void 0,c=(a?a.isBuffer:void 0)||n;e.exports=c},271:(e,t,r)=>{var i=r(6312);e.exports=function(e,t){return i(e,t)}},9373:(e,t,r)=>{var i=r(9678),n=r(7861);e.exports=function(e){if(!n(e))return!1;var t=i(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},3579:e=>{e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},9895:(e,t,r)=>{var i=r(5361),n=r(2089),s=r(8743),o=s&&s.isMap,a=o?n(o):i;e.exports=a},7861:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},845:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},91:(e,t,r)=>{var i=r(9678),n=r(7494),s=r(845),o=Function.prototype,a=Object.prototype,c=o.toString,u=a.hasOwnProperty,h=c.call(Object);e.exports=function(e){if(!s(e)||"[object Object]"!=i(e))return!1;var t=n(e);if(null===t)return!0;var r=u.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&c.call(r)==h}},1523:(e,t,r)=>{var i=r(1782),n=r(2089),s=r(8743),o=s&&s.isSet,a=o?n(o):i;e.exports=a},945:(e,t,r)=>{var i=r(9678),n=r(845);e.exports=function(e){return"symbol"==typeof e||n(e)&&"[object Symbol]"==i(e)}},8516:(e,t,r)=>{var i=r(1271),n=r(2089),s=r(8743),o=s&&s.isTypedArray,a=o?n(o):i;e.exports=a},5220:(e,t,r)=>{var i=r(5327),n=r(5547),s=r(6448);e.exports=function(e){return s(e)?i(e):n(e)}},9120:(e,t,r)=>{var i=r(5327),n=r(4732),s=r(6448);e.exports=function(e){return s(e)?i(e,!0):n(e)}},7510:(e,t,r)=>{var i=r(8808);function n(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function(){var i=arguments,n=t?t.apply(this,i):i[0],s=r.cache;if(s.has(n))return s.get(n);var o=e.apply(this,i);return r.cache=s.set(n,o)||s,o};return r.cache=new(n.Cache||i),r}n.Cache=i,e.exports=n},2158:(e,t,r)=>{var i=r(6755),n=r(3928)((function(e,t,r,n){i(e,t,r,n)}));e.exports=n},201:(e,t,r)=>{var i=r(362)();e.exports=i},4541:e=>{e.exports=function(){return[]}},1387:e=>{e.exports=function(){return!1}},8595:(e,t,r)=>{var i=r(2058),n=r(8558),s=r(7150),o=4294967295,a=Math.min;e.exports=function(e,t){if((e=s(e))<1||e>9007199254740991)return[];var r=o,c=a(e,o);t=n(t),e-=o;for(var u=i(c,t);++r<e;)t(r);return u}},8456:(e,t,r)=>{var i=r(672),n=1/0;e.exports=function(e){return e?(e=i(e))===n||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}},7150:(e,t,r)=>{var i=r(8456);e.exports=function(e){var t=i(e),r=t%1;return t==t?r?t-r:t:0}},672:(e,t,r)=>{var i=r(2132),n=r(7861),s=r(945),o=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(s(e))return NaN;if(n(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=n(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=i(e);var r=a.test(e);return r||c.test(e)?u(e.slice(2),r?2:8):o.test(e)?NaN:+e}},3139:(e,t,r)=>{var i=r(1504),n=r(9120);e.exports=function(e){return i(e,n(e))}},7292:e=>{function t(e,t){if(!e)throw new Error(t||"Assertion failed")}e.exports=t,t.equal=function(e,t,r){if(e!=t)throw new Error(r||"Assertion failed: "+e+" != "+t)}},8531:(e,t)=>{"use strict";var r=t;function i(e){return 1===e.length?"0"+e:e}function n(e){for(var t="",r=0;r<e.length;r++)t+=i(e[r].toString(16));return t}r.toArray=function(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var r=[];if("string"!=typeof e){for(var i=0;i<e.length;i++)r[i]=0|e[i];return r}if("hex"===t){(e=e.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(e="0"+e);for(i=0;i<e.length;i+=2)r.push(parseInt(e[i]+e[i+1],16))}else for(i=0;i<e.length;i++){var n=e.charCodeAt(i),s=n>>8,o=255&n;s?r.push(s,o):r.push(o)}return r},r.zero2=i,r.toHex=n,r.encode=function(e,t){return"hex"===t?n(e):e}},1126:e=>{var t=1e3,r=60*t,i=60*r,n=24*i,s=7*n,o=365.25*n;function a(e,t,r,i){var n=t>=1.5*r;return Math.round(e/r)+" "+i+(n?"s":"")}e.exports=function(e,c){c=c||{};var u=typeof e;if("string"===u&&e.length>0)return function(e){if((e=String(e)).length>100)return;var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!a)return;var c=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*o;case"weeks":case"week":case"w":return c*s;case"days":case"day":case"d":return c*n;case"hours":case"hour":case"hrs":case"hr":case"h":return c*i;case"minutes":case"minute":case"mins":case"min":case"m":return c*r;case"seconds":case"second":case"secs":case"sec":case"s":return c*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(e);if("number"===u&&isFinite(e))return c.long?function(e){var s=Math.abs(e);if(s>=n)return a(e,s,n,"day");if(s>=i)return a(e,s,i,"hour");if(s>=r)return a(e,s,r,"minute");if(s>=t)return a(e,s,t,"second");return e+" ms"}(e):function(e){var s=Math.abs(e);if(s>=n)return Math.round(e/n)+"d";if(s>=i)return Math.round(e/i)+"h";if(s>=r)return Math.round(e/r)+"m";if(s>=t)return Math.round(e/t)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},8955:(e,t,r)=>{"use strict";const i=r(8374),n=process.hrtime(),s=(new Date).getTime();function o(){let e=process.hrtime(n);return i(s).times(1e6).add(i(e[0]).times(1e9).plus(e[1])).toString()}e.exports=o,e.exports.microseconds=e.exports.micro=function(){return i(o()).divide(1e3).toString()}},9715:(e,t,r)=>{"use strict";r.d(t,{$e:()=>a,Xy:()=>c,ep:()=>o,vJ:()=>i});class i{static isArrayBuffer(e){return"[object ArrayBuffer]"===Object.prototype.toString.call(e)}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e).slice().buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){const r=i.toUint8Array(e),n=i.toUint8Array(t);if(r.length!==n.byteLength)return!1;for(let e=0;e<r.length;e++)if(r[e]!==n[e])return!1;return!0}static concat(...e){if(Array.isArray(e[0])){const t=e[0];let r=0;for(const e of t)r+=e.byteLength;const i=new Uint8Array(r);let n=0;for(const e of t){const t=this.toUint8Array(e);i.set(t,n),n+=t.length}return e[1]?this.toView(i,e[1]):i.buffer}return this.concat(e)}}class n{static fromString(e){const t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r.buffer}static toString(e){const t=i.toUint8Array(e);let r="";for(let e=0;e<t.length;e++)r+=String.fromCharCode(t[e]);return decodeURIComponent(escape(r))}}class s{static toString(e,t=!1){const r=i.toArrayBuffer(e),n=new DataView(r);let s="";for(let e=0;e<r.byteLength;e+=2){const r=n.getUint16(e,t);s+=String.fromCharCode(r)}return s}static fromString(e,t=!1){const r=new ArrayBuffer(2*e.length),i=new DataView(r);for(let r=0;r<e.length;r++)i.setUint16(2*r,e.charCodeAt(r),t);return r}}class o{static isHex(e){return"string"==typeof e&&/^[a-z0-9]+$/i.test(e)}static isBase64(e){return"string"==typeof e&&/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}static isBase64Url(e){return"string"==typeof e&&/^[a-zA-Z0-9-_]+$/i.test(e)}static ToString(e,t="utf8"){const r=i.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);case"utf16le":return s.toString(r,!0);case"utf16":case"utf16be":return s.toString(r);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return s.fromString(e,!0);case"utf16":case"utf16be":return s.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){const t=i.toUint8Array(e);if("undefined"!=typeof btoa){const e=this.ToString(t,"binary");return btoa(e)}return Buffer.from(t).toString("base64")}static FromBase64(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!o.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return"undefined"!=typeof atob?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!o.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=o.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return n.fromString(e);case"utf16":case"utf16be":return s.fromString(e);case"utf16le":case"usc2":return s.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=o.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return n.toString(e);case"utf16":case"utf16be":return s.toString(e);case"utf16le":case"usc2":return s.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){const t=e.length,r=new Uint8Array(t);for(let i=0;i<t;i++)r[i]=e.charCodeAt(i);return r.buffer}static ToBinary(e){const t=i.toUint8Array(e);let r="";for(let e=0;e<t.length;e++)r+=String.fromCharCode(t[e]);return r}static ToHex(e){const t=i.toUint8Array(e),r=[],n=t.length;for(let e=0;e<n;e++){const i=t[e].toString(16).padStart(2,"0");r.push(i)}return r.join("")}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!o.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);const r=new Uint8Array(t.length/2);for(let e=0;e<t.length;e+=2){const i=t.slice(e,e+2);r[e/2]=parseInt(i,16)}return r.buffer}static ToUtf16String(e,t=!1){return s.toString(e,t)}static FromUtf16String(e,t=!1){return s.fromString(e,t)}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let r=0;r<t;r++)e+="=";return e}static formatString(e){return(null==e?void 0:e.replace(/[\n\r\t ]/g,""))||""}}function a(...e){const t=e.map((e=>e.byteLength)).reduce(((e,t)=>e+t)),r=new Uint8Array(t);let i=0;return e.map((e=>new Uint8Array(e))).forEach((e=>{for(const t of e)r[i++]=t})),r.buffer}function c(e,t){if(!e||!t)return!1;if(e.byteLength!==t.byteLength)return!1;const r=new Uint8Array(e),i=new Uint8Array(t);for(let t=0;t<e.byteLength;t++)if(r[t]!==i[t])return!1;return!0}o.DEFAULT_UTF8_ENCODING="utf8"},8555:()=>{var e;!function(e){!function(t){var r="object"==typeof global?global:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),i=n(e);function n(e,t){return function(r,i){"function"!=typeof e[r]&&Object.defineProperty(e,r,{configurable:!0,writable:!0,value:i}),t&&t(r,i)}}void 0===r.Reflect?r.Reflect=e:i=n(r.Reflect,i),function(e){var t=Object.prototype.hasOwnProperty,r="function"==typeof Symbol,i=r&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",n=r&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",s="function"==typeof Object.create,o={__proto__:[]}instanceof Array,a=!s&&!o,c={create:s?function(){return ie(Object.create(null))}:o?function(){return ie({__proto__:null})}:function(){return ie({})},has:a?function(e,r){return t.call(e,r)}:function(e,t){return t in e},get:a?function(e,r){return t.call(e,r)?e[r]:void 0}:function(e,t){return e[t]}},u=Object.getPrototypeOf(Function),h="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,d=h||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?ee():Map,l=h||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?te():Set,f=new(h||"function"!=typeof WeakMap?re():WeakMap);function p(e,t,r,i){if(N(r)){if(!F(e))throw new TypeError;if(!$(t))throw new TypeError;return E(e,t)}if(!F(e))throw new TypeError;if(!U(t))throw new TypeError;if(!U(i)&&!N(i)&&!D(i))throw new TypeError;return D(i)&&(i=void 0),C(e,t,r=z(r),i)}function y(e,t){function r(r,i){if(!U(r))throw new TypeError;if(!N(i)&&!W(i))throw new TypeError;x(e,t,r,i)}return r}function m(e,t,r,i){if(!U(r))throw new TypeError;return N(i)||(i=z(i)),x(e,t,r,i)}function g(e,t,r){if(!U(t))throw new TypeError;return N(r)||(r=z(r)),T(e,t,r)}function b(e,t,r){if(!U(t))throw new TypeError;return N(r)||(r=z(r)),P(e,t,r)}function v(e,t,r){if(!U(t))throw new TypeError;return N(r)||(r=z(r)),I(e,t,r)}function w(e,t,r){if(!U(t))throw new TypeError;return N(r)||(r=z(r)),R(e,t,r)}function S(e,t){if(!U(e))throw new TypeError;return N(t)||(t=z(t)),B(e,t)}function _(e,t){if(!U(e))throw new TypeError;return N(t)||(t=z(t)),O(e,t)}function A(e,t,r){if(!U(t))throw new TypeError;N(r)||(r=z(r));var i=k(t,r,!1);if(N(i))return!1;if(!i.delete(e))return!1;if(i.size>0)return!0;var n=f.get(t);return n.delete(r),n.size>0||f.delete(t),!0}function E(e,t){for(var r=e.length-1;r>=0;--r){var i=(0,e[r])(t);if(!N(i)&&!D(i)){if(!$(i))throw new TypeError;t=i}}return t}function C(e,t,r,i){for(var n=e.length-1;n>=0;--n){var s=(0,e[n])(t,r,i);if(!N(s)&&!D(s)){if(!U(s))throw new TypeError;i=s}}return i}function k(e,t,r){var i=f.get(e);if(N(i)){if(!r)return;i=new d,f.set(e,i)}var n=i.get(t);if(N(n)){if(!r)return;n=new d,i.set(t,n)}return n}function T(e,t,r){if(P(e,t,r))return!0;var i=Q(t);return!D(i)&&T(e,i,r)}function P(e,t,r){var i=k(t,r,!1);return!N(i)&&K(i.has(e))}function I(e,t,r){if(P(e,t,r))return R(e,t,r);var i=Q(t);return D(i)?void 0:I(e,i,r)}function R(e,t,r){var i=k(t,r,!1);if(!N(i))return i.get(e)}function x(e,t,r,i){k(r,i,!0).set(e,t)}function B(e,t){var r=O(e,t),i=Q(e);if(null===i)return r;var n=B(i,t);if(n.length<=0)return r;if(r.length<=0)return n;for(var s=new l,o=[],a=0,c=r;a<c.length;a++){var u=c[a];s.has(u)||(s.add(u),o.push(u))}for(var h=0,d=n;h<d.length;h++){u=d[h];s.has(u)||(s.add(u),o.push(u))}return o}function O(e,t){var r=[],i=k(e,t,!1);if(N(i))return r;for(var n=J(i.keys()),s=0;;){var o=Z(n);if(!o)return r.length=s,r;var a=Y(o);try{r[s]=a}catch(e){try{X(n)}finally{throw e}}s++}}function M(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function N(e){return void 0===e}function D(e){return null===e}function L(e){return"symbol"==typeof e}function U(e){return"object"==typeof e?null!==e:"function"==typeof e}function j(e,t){switch(M(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var r=3===t?"string":5===t?"number":"default",n=G(e,i);if(void 0!==n){var s=n.call(e,r);if(U(s))throw new TypeError;return s}return q(e,"default"===r?"number":r)}function q(e,t){if("string"===t){var r=e.toString;if(V(r))if(!U(n=r.call(e)))return n;if(V(i=e.valueOf))if(!U(n=i.call(e)))return n}else{var i;if(V(i=e.valueOf))if(!U(n=i.call(e)))return n;var n,s=e.toString;if(V(s))if(!U(n=s.call(e)))return n}throw new TypeError}function K(e){return!!e}function H(e){return""+e}function z(e){var t=j(e,3);return L(t)?t:H(t)}function F(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function V(e){return"function"==typeof e}function $(e){return"function"==typeof e}function W(e){switch(M(e)){case 3:case 4:return!0;default:return!1}}function G(e,t){var r=e[t];if(null!=r){if(!V(r))throw new TypeError;return r}}function J(e){var t=G(e,n);if(!V(t))throw new TypeError;var r=t.call(e);if(!U(r))throw new TypeError;return r}function Y(e){return e.value}function Z(e){var t=e.next();return!t.done&&t}function X(e){var t=e.return;t&&t.call(e)}function Q(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===u)return t;if(t!==u)return t;var r=e.prototype,i=r&&Object.getPrototypeOf(r);if(null==i||i===Object.prototype)return t;var n=i.constructor;return"function"!=typeof n||n===e?t:n}function ee(){var e={},t=[],r=function(){function e(e,t,r){this._index=0,this._keys=e,this._values=t,this._selector=r}return e.prototype["@@iterator"]=function(){return this},e.prototype[n]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var r=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:r,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var r=this._find(e,!0);return this._values[r]=t,this},t.prototype.delete=function(t){var r=this._find(t,!1);if(r>=0){for(var i=this._keys.length,n=r+1;n<i;n++)this._keys[n-1]=this._keys[n],this._values[n-1]=this._values[n];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new r(this._keys,this._values,i)},t.prototype.values=function(){return new r(this._keys,this._values,s)},t.prototype.entries=function(){return new r(this._keys,this._values,o)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[n]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function i(e,t){return e}function s(e,t){return t}function o(e,t){return[e,t]}}function te(){return function(){function e(){this._map=new d}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[n]=function(){return this.keys()},e}()}function re(){var e=16,r=c.create(),i=n();return function(){function e(){this._key=n()}return e.prototype.has=function(e){var t=s(e,!1);return void 0!==t&&c.has(t,this._key)},e.prototype.get=function(e){var t=s(e,!1);return void 0!==t?c.get(t,this._key):void 0},e.prototype.set=function(e,t){return s(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=s(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=n()},e}();function n(){var e;do{e="@@WeakMap@@"+u()}while(c.has(r,e));return r[e]=!0,e}function s(e,r){if(!t.call(e,i)){if(!r)return;Object.defineProperty(e,i,{value:c.create()})}return e[i]}function o(e,t){for(var r=0;r<t;++r)e[r]=255*Math.random()|0;return e}function a(e){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):o(new Uint8Array(e),e):o(new Array(e),e)}function u(){var t=a(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var r="",i=0;i<e;++i){var n=t[i];4!==i&&6!==i&&8!==i||(r+="-"),n<16&&(r+="0"),r+=n.toString(16).toLowerCase()}return r}}function ie(e){return e.__=void 0,delete e.__,e}e("decorate",p),e("metadata",y),e("defineMetadata",m),e("hasMetadata",g),e("hasOwnMetadata",b),e("getMetadata",v),e("getOwnMetadata",w),e("getMetadataKeys",S),e("getOwnMetadataKeys",_),e("deleteMetadata",A)}(i)}()}(e||(e={}))},9818:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventDisposer=t.Event=void 0;var r=function(){function e(){var e=this;this.event={stack:[],index:0},this.ended=!1,this.execute=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(e.ended)throw new Error("event completed");for(var i=0,n=e.event.stack;i<n.length;i++){var s=n[i];s.execute.apply(s,t)}},this.complete=function(){if(e.ended)throw new Error("event completed");for(var t=0,r=e.event.stack;t<r.length;t++){var i=r[t];i.complete&&i.complete()}e.allUnsubscribe(),e.ended=!0},this.error=function(t){if(e.ended)throw new Error("event completed");for(var r=0,i=e.event.stack;r<i.length;r++){var n=i[r];n.error&&n.error(t)}e.allUnsubscribe()},this.allUnsubscribe=function(){if(e.ended)throw new Error("event completed");e.event={stack:[],index:0}},this.subscribe=function(t,r,i){if(e.ended)throw new Error("event completed");var n=e.event.index;e.event.stack.push({execute:t,id:n,complete:r,error:i}),e.event.index++;var s=function(){e.event.stack=e.event.stack.filter((function(e){return e.id!==n&&e}))};return{unSubscribe:s,disposer:function(e){e.push(s)}}},this.once=function(t,r,i){var n=e.subscribe((function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];n.unSubscribe(),t.apply(void 0,e)}),r,i)},this.watch=function(t,r){return new Promise((function(i,n){var s=r&&setTimeout((function(){n("Event watch timeout")}),r),o=e.subscribe((function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n=t.apply(void 0,e);n&&(s&&clearTimeout(s),o(),i(e))})).unSubscribe}))},this.asPromise=function(t){return new Promise((function(r,i){var n=t&&setTimeout((function(){i("Event asPromise timeout")}),t);e.once((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];n&&clearTimeout(n),r(e)}),(function(){n&&clearTimeout(n),r([])}),(function(e){n&&clearTimeout(n),i(e)}))}))}}return Object.defineProperty(e.prototype,"returnTrigger",{get:function(){var e=this;return{execute:e.execute,error:e.error,complete:e.complete}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"returnListener",{get:function(){var e=this;return{subscribe:e.subscribe,once:e.once,asPromise:e.asPromise}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this.event.stack.length},enumerable:!1,configurable:!0}),e}();t.Event=r;var i=function(){function e(){this._disposer=[]}return e.prototype.push=function(e){this._disposer.push(e)},e.prototype.dispose=function(){this._disposer.forEach((function(e){return e()})),this._disposer=[]},e}();t.EventDisposer=i},541:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Buffer=void 0;var i=r(9818);t.Buffer=function(e,t){var r=new i.Event,n=[],s=!1;return t.subscribe((function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];s||n.length!==e||(n.forEach((function(e){return r.execute.apply(r,e)})),s=!0),s?r.execute.apply(r,t):n.push(t)})),{subscribe:r.subscribe,asPromise:r.asPromise,once:r.once}}},2281:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(9818);t.default=function(){var e=[];return{event:function(){var t=new i.Event;return e.push(t),t},finishAll:function(){e.forEach((function(e){return e.allUnsubscribe()})),e=[]}}}},1909:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1443),n=i.__importDefault(r(5473)),s=function(){function e(){this.candidates={}}return e.prototype.exist=function(e){return Object.keys(this.candidates).includes(e)},e.prototype.delete=function(e){delete this.candidates[e]},e.prototype.create=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var r,s;return i.__generator(this,(function(i){switch(i.label){case 0:return this.exist(e)?[2,{exist:this.candidates[e]}]:[3,1];case 1:return r=new n.default,this.candidates[e]=r,[4,t()];case 2:return s=i.sent(),r.execute.apply(r,s),this.delete(e),[2,{result:s}]}}))}))},e}();t.default=s},5473:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1443),n=r(9818);t.default=n.Event,i.__exportStar(r(9818),t),i.__exportStar(r(2281),t),i.__exportStar(r(1909),t),i.__exportStar(r(541),t)},8352:(e,t,r)=>{"use strict";const i=r(2037),n=r(6224),s=r(8605),{env:o}=process;let a;function c(e){return 0!==e&&{level:e,hasBasic:!0,has256:e>=2,has16m:e>=3}}function u(e,t){if(0===a)return 0;if(s("color=16m")||s("color=full")||s("color=truecolor"))return 3;if(s("color=256"))return 2;if(e&&!t&&void 0===a)return 0;const r=a||0;if("dumb"===o.TERM)return r;if("win32"===process.platform){const e=i.release().split(".");return Number(e[0])>=10&&Number(e[2])>=10586?Number(e[2])>=14931?3:2:1}if("CI"in o)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some((e=>e in o))||"codeship"===o.CI_NAME?1:r;if("TEAMCITY_VERSION"in o)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(o.TEAMCITY_VERSION)?1:0;if("truecolor"===o.COLORTERM)return 3;if("TERM_PROGRAM"in o){const e=parseInt((o.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(o.TERM_PROGRAM){case"iTerm.app":return e>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(o.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(o.TERM)||"COLORTERM"in o?1:r}s("no-color")||s("no-colors")||s("color=false")||s("color=never")?a=0:(s("color")||s("colors")||s("color=true")||s("color=always"))&&(a=1),"FORCE_COLOR"in o&&(a="true"===o.FORCE_COLOR?1:"false"===o.FORCE_COLOR?0:0===o.FORCE_COLOR.length?1:Math.min(parseInt(o.FORCE_COLOR,10),3)),e.exports={supportsColor:function(e){return c(u(e,e&&e.isTTY))},stdout:c(u(!0,n.isatty(1))),stderr:c(u(!0,n.isatty(2)))}},1443:(e,t,r)=>{"use strict";r.r(t),r.d(t,{__assign:()=>s,__asyncDelegator:()=>S,__asyncGenerator:()=>w,__asyncValues:()=>_,__await:()=>v,__awaiter:()=>h,__classPrivateFieldGet:()=>T,__classPrivateFieldIn:()=>I,__classPrivateFieldSet:()=>P,__createBinding:()=>l,__decorate:()=>a,__exportStar:()=>f,__extends:()=>n,__generator:()=>d,__importDefault:()=>k,__importStar:()=>C,__makeTemplateObject:()=>A,__metadata:()=>u,__param:()=>c,__read:()=>y,__rest:()=>o,__spread:()=>m,__spreadArray:()=>b,__spreadArrays:()=>g,__values:()=>p});var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},i(e,t)};function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var s=function(){return s=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},s.apply(this,arguments)};function o(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]])}return r}function a(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}function c(e,t){return function(r,i){t(r,i,e)}}function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function h(e,t,r,i){return new(r||(r=Promise))((function(n,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))}function d(e,t){var r,i,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}var l=Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]};function f(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||l(t,e,r)}function p(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function y(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,s=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return o}function m(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(y(arguments[t]));return e}function g(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,n++)i[n]=s[o];return i}function b(e,t,r){if(r||2===arguments.length)for(var i,n=0,s=t.length;n<s;n++)!i&&n in t||(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}function v(e){return this instanceof v?(this.v=e,this):new v(e)}function w(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,n=r.apply(e,t||[]),s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(e){n[e]&&(i[e]=function(t){return new Promise((function(r,i){s.push([e,t,r,i])>1||a(e,t)}))})}function a(e,t){try{(r=n[e](t)).value instanceof v?Promise.resolve(r.value.v).then(c,u):h(s[0][2],r)}catch(e){h(s[0][3],e)}var r}function c(e){a("next",e)}function u(e){a("throw",e)}function h(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}}function S(e){var t,r;return t={},i("next"),i("throw",(function(e){throw e})),i("return"),t[Symbol.iterator]=function(){return this},t;function i(i,n){t[i]=e[i]?function(t){return(r=!r)?{value:v(e[i](t)),done:"return"===i}:n?n(t):t}:n}}function _(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=p(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(r){t[r]=e[r]&&function(t){return new Promise((function(i,n){(function(e,t,r,i){Promise.resolve(i).then((function(t){e({value:t,done:r})}),t)})(i,n,(t=e[r](t)).done,t.value)}))}}}function A(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var E=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function C(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&l(t,e,r);return E(t,e),t}function k(e){return e&&e.__esModule?e:{default:e}}function T(e,t,r,i){if("a"===r&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?i:"a"===r?i.call(e):i?i.value:t.get(e)}function P(e,t,r,i,n){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(e,r):n?n.value=r:t.set(e,r),r}function I(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}},4768:(e,t,r)=>{"use strict";const{createSlicedTable:i}=r(5161),n=r(216),s=i(2197175160);e.exports=function(e){const t=Buffer.isBuffer(e)?e:Buffer.from(e);return(4294967295^n(s,t,4294967295,0))>>>0}},8214:e=>{"use strict";e.exports=function(e,t,r,i){let n=r;for(let r=i;r<t.length;r+=1){const i=t[r];n=e[0][255&(n^i)]^n>>>8}return n}},6640:(e,t,r)=>{"use strict";const i=r(8214);e.exports=function(e,t,r,n){let s=n,o=r;for(let r=s;r+4<t.length;r+=4){const i=t.readUInt32LE(r)^o;o=e[0][i>>>24&255]^e[1][i>>>16&255]^e[2][i>>>8&255]^e[3][255&i],s+=4}return i(e,t,o,s)}},216:(e,t,r)=>{"use strict";const i=r(6640);e.exports=function(e,t,r,n){let s=n,o=r;for(let r=s;r+8<t.length;r+=8){const i=t.readUInt32LE(r)^o,n=t.readUInt32LE(r+4);o=e[0][n>>>24&255]^e[1][n>>>16&255]^e[2][n>>>8&255]^e[3][255&n]^e[4][i>>>24&255]^e[5][i>>>16&255]^e[6][i>>>8&255]^e[7][255&i],s+=8}return i(e,t,o,s)}},5161:e=>{"use strict";function t(e){const t=new Uint32Array(256);for(let r=0;r<t.length;r+=1){let i=r;for(let t=0;t<8;t+=1)i=1&i?i>>>1^e:i>>>1;t[r]=i}return t}e.exports={createTable:t,createSlicedTable:function(e){const r=new Array(8),i=t(e);r[0]=i;for(let e=1;e<r.length;e+=1){r[e]=new Uint32Array(256);for(let t=0;t<256;t+=1)r[e][t]=r[e-1][t]>>>8^r[0][255&r[e-1][t]]}return r}}},9698:(e,t,r)=>{!function(e){"use strict";var t=function(e){var t,r=new Float64Array(16);if(e)for(t=0;t<e.length;t++)r[t]=e[t];return r},i=function(){throw new Error("no PRNG")},n=new Uint8Array(16),s=new Uint8Array(32);s[0]=9;var o=t(),a=t([1]),c=t([56129,1]),u=t([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),h=t([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),d=t([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),l=t([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),f=t([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function p(e,t,r,i){e[t]=r>>24&255,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r,e[t+4]=i>>24&255,e[t+5]=i>>16&255,e[t+6]=i>>8&255,e[t+7]=255&i}function y(e,t,r,i,n){var s,o=0;for(s=0;s<n;s++)o|=e[t+s]^r[i+s];return(1&o-1>>>8)-1}function m(e,t,r,i){return y(e,t,r,i,16)}function g(e,t,r,i){return y(e,t,r,i,32)}function b(e,t,r,i){!function(e,t,r,i){for(var n,s=255&i[0]|(255&i[1])<<8|(255&i[2])<<16|(255&i[3])<<24,o=255&r[0]|(255&r[1])<<8|(255&r[2])<<16|(255&r[3])<<24,a=255&r[4]|(255&r[5])<<8|(255&r[6])<<16|(255&r[7])<<24,c=255&r[8]|(255&r[9])<<8|(255&r[10])<<16|(255&r[11])<<24,u=255&r[12]|(255&r[13])<<8|(255&r[14])<<16|(255&r[15])<<24,h=255&i[4]|(255&i[5])<<8|(255&i[6])<<16|(255&i[7])<<24,d=255&t[0]|(255&t[1])<<8|(255&t[2])<<16|(255&t[3])<<24,l=255&t[4]|(255&t[5])<<8|(255&t[6])<<16|(255&t[7])<<24,f=255&t[8]|(255&t[9])<<8|(255&t[10])<<16|(255&t[11])<<24,p=255&t[12]|(255&t[13])<<8|(255&t[14])<<16|(255&t[15])<<24,y=255&i[8]|(255&i[9])<<8|(255&i[10])<<16|(255&i[11])<<24,m=255&r[16]|(255&r[17])<<8|(255&r[18])<<16|(255&r[19])<<24,g=255&r[20]|(255&r[21])<<8|(255&r[22])<<16|(255&r[23])<<24,b=255&r[24]|(255&r[25])<<8|(255&r[26])<<16|(255&r[27])<<24,v=255&r[28]|(255&r[29])<<8|(255&r[30])<<16|(255&r[31])<<24,w=255&i[12]|(255&i[13])<<8|(255&i[14])<<16|(255&i[15])<<24,S=s,_=o,A=a,E=c,C=u,k=h,T=d,P=l,I=f,R=p,x=y,B=m,O=g,M=b,N=v,D=w,L=0;L<20;L+=2)S^=(n=(O^=(n=(I^=(n=(C^=(n=S+O|0)<<7|n>>>25)+S|0)<<9|n>>>23)+C|0)<<13|n>>>19)+I|0)<<18|n>>>14,k^=(n=(_^=(n=(M^=(n=(R^=(n=k+_|0)<<7|n>>>25)+k|0)<<9|n>>>23)+R|0)<<13|n>>>19)+M|0)<<18|n>>>14,x^=(n=(T^=(n=(A^=(n=(N^=(n=x+T|0)<<7|n>>>25)+x|0)<<9|n>>>23)+N|0)<<13|n>>>19)+A|0)<<18|n>>>14,D^=(n=(B^=(n=(P^=(n=(E^=(n=D+B|0)<<7|n>>>25)+D|0)<<9|n>>>23)+E|0)<<13|n>>>19)+P|0)<<18|n>>>14,S^=(n=(E^=(n=(A^=(n=(_^=(n=S+E|0)<<7|n>>>25)+S|0)<<9|n>>>23)+_|0)<<13|n>>>19)+A|0)<<18|n>>>14,k^=(n=(C^=(n=(P^=(n=(T^=(n=k+C|0)<<7|n>>>25)+k|0)<<9|n>>>23)+T|0)<<13|n>>>19)+P|0)<<18|n>>>14,x^=(n=(R^=(n=(I^=(n=(B^=(n=x+R|0)<<7|n>>>25)+x|0)<<9|n>>>23)+B|0)<<13|n>>>19)+I|0)<<18|n>>>14,D^=(n=(N^=(n=(M^=(n=(O^=(n=D+N|0)<<7|n>>>25)+D|0)<<9|n>>>23)+O|0)<<13|n>>>19)+M|0)<<18|n>>>14;S=S+s|0,_=_+o|0,A=A+a|0,E=E+c|0,C=C+u|0,k=k+h|0,T=T+d|0,P=P+l|0,I=I+f|0,R=R+p|0,x=x+y|0,B=B+m|0,O=O+g|0,M=M+b|0,N=N+v|0,D=D+w|0,e[0]=S>>>0&255,e[1]=S>>>8&255,e[2]=S>>>16&255,e[3]=S>>>24&255,e[4]=_>>>0&255,e[5]=_>>>8&255,e[6]=_>>>16&255,e[7]=_>>>24&255,e[8]=A>>>0&255,e[9]=A>>>8&255,e[10]=A>>>16&255,e[11]=A>>>24&255,e[12]=E>>>0&255,e[13]=E>>>8&255,e[14]=E>>>16&255,e[15]=E>>>24&255,e[16]=C>>>0&255,e[17]=C>>>8&255,e[18]=C>>>16&255,e[19]=C>>>24&255,e[20]=k>>>0&255,e[21]=k>>>8&255,e[22]=k>>>16&255,e[23]=k>>>24&255,e[24]=T>>>0&255,e[25]=T>>>8&255,e[26]=T>>>16&255,e[27]=T>>>24&255,e[28]=P>>>0&255,e[29]=P>>>8&255,e[30]=P>>>16&255,e[31]=P>>>24&255,e[32]=I>>>0&255,e[33]=I>>>8&255,e[34]=I>>>16&255,e[35]=I>>>24&255,e[36]=R>>>0&255,e[37]=R>>>8&255,e[38]=R>>>16&255,e[39]=R>>>24&255,e[40]=x>>>0&255,e[41]=x>>>8&255,e[42]=x>>>16&255,e[43]=x>>>24&255,e[44]=B>>>0&255,e[45]=B>>>8&255,e[46]=B>>>16&255,e[47]=B>>>24&255,e[48]=O>>>0&255,e[49]=O>>>8&255,e[50]=O>>>16&255,e[51]=O>>>24&255,e[52]=M>>>0&255,e[53]=M>>>8&255,e[54]=M>>>16&255,e[55]=M>>>24&255,e[56]=N>>>0&255,e[57]=N>>>8&255,e[58]=N>>>16&255,e[59]=N>>>24&255,e[60]=D>>>0&255,e[61]=D>>>8&255,e[62]=D>>>16&255,e[63]=D>>>24&255}(e,t,r,i)}function v(e,t,r,i){!function(e,t,r,i){for(var n,s=255&i[0]|(255&i[1])<<8|(255&i[2])<<16|(255&i[3])<<24,o=255&r[0]|(255&r[1])<<8|(255&r[2])<<16|(255&r[3])<<24,a=255&r[4]|(255&r[5])<<8|(255&r[6])<<16|(255&r[7])<<24,c=255&r[8]|(255&r[9])<<8|(255&r[10])<<16|(255&r[11])<<24,u=255&r[12]|(255&r[13])<<8|(255&r[14])<<16|(255&r[15])<<24,h=255&i[4]|(255&i[5])<<8|(255&i[6])<<16|(255&i[7])<<24,d=255&t[0]|(255&t[1])<<8|(255&t[2])<<16|(255&t[3])<<24,l=255&t[4]|(255&t[5])<<8|(255&t[6])<<16|(255&t[7])<<24,f=255&t[8]|(255&t[9])<<8|(255&t[10])<<16|(255&t[11])<<24,p=255&t[12]|(255&t[13])<<8|(255&t[14])<<16|(255&t[15])<<24,y=255&i[8]|(255&i[9])<<8|(255&i[10])<<16|(255&i[11])<<24,m=255&r[16]|(255&r[17])<<8|(255&r[18])<<16|(255&r[19])<<24,g=255&r[20]|(255&r[21])<<8|(255&r[22])<<16|(255&r[23])<<24,b=255&r[24]|(255&r[25])<<8|(255&r[26])<<16|(255&r[27])<<24,v=255&r[28]|(255&r[29])<<8|(255&r[30])<<16|(255&r[31])<<24,w=255&i[12]|(255&i[13])<<8|(255&i[14])<<16|(255&i[15])<<24,S=0;S<20;S+=2)s^=(n=(g^=(n=(f^=(n=(u^=(n=s+g|0)<<7|n>>>25)+s|0)<<9|n>>>23)+u|0)<<13|n>>>19)+f|0)<<18|n>>>14,h^=(n=(o^=(n=(b^=(n=(p^=(n=h+o|0)<<7|n>>>25)+h|0)<<9|n>>>23)+p|0)<<13|n>>>19)+b|0)<<18|n>>>14,y^=(n=(d^=(n=(a^=(n=(v^=(n=y+d|0)<<7|n>>>25)+y|0)<<9|n>>>23)+v|0)<<13|n>>>19)+a|0)<<18|n>>>14,w^=(n=(m^=(n=(l^=(n=(c^=(n=w+m|0)<<7|n>>>25)+w|0)<<9|n>>>23)+c|0)<<13|n>>>19)+l|0)<<18|n>>>14,s^=(n=(c^=(n=(a^=(n=(o^=(n=s+c|0)<<7|n>>>25)+s|0)<<9|n>>>23)+o|0)<<13|n>>>19)+a|0)<<18|n>>>14,h^=(n=(u^=(n=(l^=(n=(d^=(n=h+u|0)<<7|n>>>25)+h|0)<<9|n>>>23)+d|0)<<13|n>>>19)+l|0)<<18|n>>>14,y^=(n=(p^=(n=(f^=(n=(m^=(n=y+p|0)<<7|n>>>25)+y|0)<<9|n>>>23)+m|0)<<13|n>>>19)+f|0)<<18|n>>>14,w^=(n=(v^=(n=(b^=(n=(g^=(n=w+v|0)<<7|n>>>25)+w|0)<<9|n>>>23)+g|0)<<13|n>>>19)+b|0)<<18|n>>>14;e[0]=s>>>0&255,e[1]=s>>>8&255,e[2]=s>>>16&255,e[3]=s>>>24&255,e[4]=h>>>0&255,e[5]=h>>>8&255,e[6]=h>>>16&255,e[7]=h>>>24&255,e[8]=y>>>0&255,e[9]=y>>>8&255,e[10]=y>>>16&255,e[11]=y>>>24&255,e[12]=w>>>0&255,e[13]=w>>>8&255,e[14]=w>>>16&255,e[15]=w>>>24&255,e[16]=d>>>0&255,e[17]=d>>>8&255,e[18]=d>>>16&255,e[19]=d>>>24&255,e[20]=l>>>0&255,e[21]=l>>>8&255,e[22]=l>>>16&255,e[23]=l>>>24&255,e[24]=f>>>0&255,e[25]=f>>>8&255,e[26]=f>>>16&255,e[27]=f>>>24&255,e[28]=p>>>0&255,e[29]=p>>>8&255,e[30]=p>>>16&255,e[31]=p>>>24&255}(e,t,r,i)}var w=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function S(e,t,r,i,n,s,o){var a,c,u=new Uint8Array(16),h=new Uint8Array(64);for(c=0;c<16;c++)u[c]=0;for(c=0;c<8;c++)u[c]=s[c];for(;n>=64;){for(b(h,u,o,w),c=0;c<64;c++)e[t+c]=r[i+c]^h[c];for(a=1,c=8;c<16;c++)a=a+(255&u[c])|0,u[c]=255&a,a>>>=8;n-=64,t+=64,i+=64}if(n>0)for(b(h,u,o,w),c=0;c<n;c++)e[t+c]=r[i+c]^h[c];return 0}function _(e,t,r,i,n){var s,o,a=new Uint8Array(16),c=new Uint8Array(64);for(o=0;o<16;o++)a[o]=0;for(o=0;o<8;o++)a[o]=i[o];for(;r>=64;){for(b(c,a,n,w),o=0;o<64;o++)e[t+o]=c[o];for(s=1,o=8;o<16;o++)s=s+(255&a[o])|0,a[o]=255&s,s>>>=8;r-=64,t+=64}if(r>0)for(b(c,a,n,w),o=0;o<r;o++)e[t+o]=c[o];return 0}function A(e,t,r,i,n){var s=new Uint8Array(32);v(s,i,n,w);for(var o=new Uint8Array(8),a=0;a<8;a++)o[a]=i[a+16];return _(e,t,r,o,s)}function E(e,t,r,i,n,s,o){var a=new Uint8Array(32);v(a,s,o,w);for(var c=new Uint8Array(8),u=0;u<8;u++)c[u]=s[u+16];return S(e,t,r,i,n,c,a)}var C=function(e){var t,r,i,n,s,o,a,c;this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.leftover=0,this.fin=0,t=255&e[0]|(255&e[1])<<8,this.r[0]=8191&t,r=255&e[2]|(255&e[3])<<8,this.r[1]=8191&(t>>>13|r<<3),i=255&e[4]|(255&e[5])<<8,this.r[2]=7939&(r>>>10|i<<6),n=255&e[6]|(255&e[7])<<8,this.r[3]=8191&(i>>>7|n<<9),s=255&e[8]|(255&e[9])<<8,this.r[4]=255&(n>>>4|s<<12),this.r[5]=s>>>1&8190,o=255&e[10]|(255&e[11])<<8,this.r[6]=8191&(s>>>14|o<<2),a=255&e[12]|(255&e[13])<<8,this.r[7]=8065&(o>>>11|a<<5),c=255&e[14]|(255&e[15])<<8,this.r[8]=8191&(a>>>8|c<<8),this.r[9]=c>>>5&127,this.pad[0]=255&e[16]|(255&e[17])<<8,this.pad[1]=255&e[18]|(255&e[19])<<8,this.pad[2]=255&e[20]|(255&e[21])<<8,this.pad[3]=255&e[22]|(255&e[23])<<8,this.pad[4]=255&e[24]|(255&e[25])<<8,this.pad[5]=255&e[26]|(255&e[27])<<8,this.pad[6]=255&e[28]|(255&e[29])<<8,this.pad[7]=255&e[30]|(255&e[31])<<8};function k(e,t,r,i,n,s){var o=new C(s);return o.update(r,i,n),o.finish(e,t),0}function T(e,t,r,i,n,s){var o=new Uint8Array(16);return k(o,0,r,i,n,s),m(e,t,o,0)}function P(e,t,r,i,n){var s;if(r<32)return-1;for(E(e,0,t,0,r,i,n),k(e,16,e,32,r-32,e),s=0;s<16;s++)e[s]=0;return 0}function I(e,t,r,i,n){var s,o=new Uint8Array(32);if(r<32)return-1;if(A(o,0,32,i,n),0!==T(t,16,t,32,r-32,o))return-1;for(E(e,0,t,0,r,i,n),s=0;s<32;s++)e[s]=0;return 0}function R(e,t){var r;for(r=0;r<16;r++)e[r]=0|t[r]}function x(e){var t,r,i=1;for(t=0;t<16;t++)r=e[t]+i+65535,i=Math.floor(r/65536),e[t]=r-65536*i;e[0]+=i-1+37*(i-1)}function B(e,t,r){for(var i,n=~(r-1),s=0;s<16;s++)i=n&(e[s]^t[s]),e[s]^=i,t[s]^=i}function O(e,r){var i,n,s,o=t(),a=t();for(i=0;i<16;i++)a[i]=r[i];for(x(a),x(a),x(a),n=0;n<2;n++){for(o[0]=a[0]-65517,i=1;i<15;i++)o[i]=a[i]-65535-(o[i-1]>>16&1),o[i-1]&=65535;o[15]=a[15]-32767-(o[14]>>16&1),s=o[15]>>16&1,o[14]&=65535,B(a,o,1-s)}for(i=0;i<16;i++)e[2*i]=255&a[i],e[2*i+1]=a[i]>>8}function M(e,t){var r=new Uint8Array(32),i=new Uint8Array(32);return O(r,e),O(i,t),g(r,0,i,0)}function N(e){var t=new Uint8Array(32);return O(t,e),1&t[0]}function D(e,t){var r;for(r=0;r<16;r++)e[r]=t[2*r]+(t[2*r+1]<<8);e[15]&=32767}function L(e,t,r){for(var i=0;i<16;i++)e[i]=t[i]+r[i]}function U(e,t,r){for(var i=0;i<16;i++)e[i]=t[i]-r[i]}function j(e,t,r){var i,n,s=0,o=0,a=0,c=0,u=0,h=0,d=0,l=0,f=0,p=0,y=0,m=0,g=0,b=0,v=0,w=0,S=0,_=0,A=0,E=0,C=0,k=0,T=0,P=0,I=0,R=0,x=0,B=0,O=0,M=0,N=0,D=r[0],L=r[1],U=r[2],j=r[3],q=r[4],K=r[5],H=r[6],z=r[7],F=r[8],V=r[9],$=r[10],W=r[11],G=r[12],J=r[13],Y=r[14],Z=r[15];s+=(i=t[0])*D,o+=i*L,a+=i*U,c+=i*j,u+=i*q,h+=i*K,d+=i*H,l+=i*z,f+=i*F,p+=i*V,y+=i*$,m+=i*W,g+=i*G,b+=i*J,v+=i*Y,w+=i*Z,o+=(i=t[1])*D,a+=i*L,c+=i*U,u+=i*j,h+=i*q,d+=i*K,l+=i*H,f+=i*z,p+=i*F,y+=i*V,m+=i*$,g+=i*W,b+=i*G,v+=i*J,w+=i*Y,S+=i*Z,a+=(i=t[2])*D,c+=i*L,u+=i*U,h+=i*j,d+=i*q,l+=i*K,f+=i*H,p+=i*z,y+=i*F,m+=i*V,g+=i*$,b+=i*W,v+=i*G,w+=i*J,S+=i*Y,_+=i*Z,c+=(i=t[3])*D,u+=i*L,h+=i*U,d+=i*j,l+=i*q,f+=i*K,p+=i*H,y+=i*z,m+=i*F,g+=i*V,b+=i*$,v+=i*W,w+=i*G,S+=i*J,_+=i*Y,A+=i*Z,u+=(i=t[4])*D,h+=i*L,d+=i*U,l+=i*j,f+=i*q,p+=i*K,y+=i*H,m+=i*z,g+=i*F,b+=i*V,v+=i*$,w+=i*W,S+=i*G,_+=i*J,A+=i*Y,E+=i*Z,h+=(i=t[5])*D,d+=i*L,l+=i*U,f+=i*j,p+=i*q,y+=i*K,m+=i*H,g+=i*z,b+=i*F,v+=i*V,w+=i*$,S+=i*W,_+=i*G,A+=i*J,E+=i*Y,C+=i*Z,d+=(i=t[6])*D,l+=i*L,f+=i*U,p+=i*j,y+=i*q,m+=i*K,g+=i*H,b+=i*z,v+=i*F,w+=i*V,S+=i*$,_+=i*W,A+=i*G,E+=i*J,C+=i*Y,k+=i*Z,l+=(i=t[7])*D,f+=i*L,p+=i*U,y+=i*j,m+=i*q,g+=i*K,b+=i*H,v+=i*z,w+=i*F,S+=i*V,_+=i*$,A+=i*W,E+=i*G,C+=i*J,k+=i*Y,T+=i*Z,f+=(i=t[8])*D,p+=i*L,y+=i*U,m+=i*j,g+=i*q,b+=i*K,v+=i*H,w+=i*z,S+=i*F,_+=i*V,A+=i*$,E+=i*W,C+=i*G,k+=i*J,T+=i*Y,P+=i*Z,p+=(i=t[9])*D,y+=i*L,m+=i*U,g+=i*j,b+=i*q,v+=i*K,w+=i*H,S+=i*z,_+=i*F,A+=i*V,E+=i*$,C+=i*W,k+=i*G,T+=i*J,P+=i*Y,I+=i*Z,y+=(i=t[10])*D,m+=i*L,g+=i*U,b+=i*j,v+=i*q,w+=i*K,S+=i*H,_+=i*z,A+=i*F,E+=i*V,C+=i*$,k+=i*W,T+=i*G,P+=i*J,I+=i*Y,R+=i*Z,m+=(i=t[11])*D,g+=i*L,b+=i*U,v+=i*j,w+=i*q,S+=i*K,_+=i*H,A+=i*z,E+=i*F,C+=i*V,k+=i*$,T+=i*W,P+=i*G,I+=i*J,R+=i*Y,x+=i*Z,g+=(i=t[12])*D,b+=i*L,v+=i*U,w+=i*j,S+=i*q,_+=i*K,A+=i*H,E+=i*z,C+=i*F,k+=i*V,T+=i*$,P+=i*W,I+=i*G,R+=i*J,x+=i*Y,B+=i*Z,b+=(i=t[13])*D,v+=i*L,w+=i*U,S+=i*j,_+=i*q,A+=i*K,E+=i*H,C+=i*z,k+=i*F,T+=i*V,P+=i*$,I+=i*W,R+=i*G,x+=i*J,B+=i*Y,O+=i*Z,v+=(i=t[14])*D,w+=i*L,S+=i*U,_+=i*j,A+=i*q,E+=i*K,C+=i*H,k+=i*z,T+=i*F,P+=i*V,I+=i*$,R+=i*W,x+=i*G,B+=i*J,O+=i*Y,M+=i*Z,w+=(i=t[15])*D,o+=38*(_+=i*U),a+=38*(A+=i*j),c+=38*(E+=i*q),u+=38*(C+=i*K),h+=38*(k+=i*H),d+=38*(T+=i*z),l+=38*(P+=i*F),f+=38*(I+=i*V),p+=38*(R+=i*$),y+=38*(x+=i*W),m+=38*(B+=i*G),g+=38*(O+=i*J),b+=38*(M+=i*Y),v+=38*(N+=i*Z),s=(i=(s+=38*(S+=i*L))+(n=1)+65535)-65536*(n=Math.floor(i/65536)),o=(i=o+n+65535)-65536*(n=Math.floor(i/65536)),a=(i=a+n+65535)-65536*(n=Math.floor(i/65536)),c=(i=c+n+65535)-65536*(n=Math.floor(i/65536)),u=(i=u+n+65535)-65536*(n=Math.floor(i/65536)),h=(i=h+n+65535)-65536*(n=Math.floor(i/65536)),d=(i=d+n+65535)-65536*(n=Math.floor(i/65536)),l=(i=l+n+65535)-65536*(n=Math.floor(i/65536)),f=(i=f+n+65535)-65536*(n=Math.floor(i/65536)),p=(i=p+n+65535)-65536*(n=Math.floor(i/65536)),y=(i=y+n+65535)-65536*(n=Math.floor(i/65536)),m=(i=m+n+65535)-65536*(n=Math.floor(i/65536)),g=(i=g+n+65535)-65536*(n=Math.floor(i/65536)),b=(i=b+n+65535)-65536*(n=Math.floor(i/65536)),v=(i=v+n+65535)-65536*(n=Math.floor(i/65536)),w=(i=w+n+65535)-65536*(n=Math.floor(i/65536)),s=(i=(s+=n-1+37*(n-1))+(n=1)+65535)-65536*(n=Math.floor(i/65536)),o=(i=o+n+65535)-65536*(n=Math.floor(i/65536)),a=(i=a+n+65535)-65536*(n=Math.floor(i/65536)),c=(i=c+n+65535)-65536*(n=Math.floor(i/65536)),u=(i=u+n+65535)-65536*(n=Math.floor(i/65536)),h=(i=h+n+65535)-65536*(n=Math.floor(i/65536)),d=(i=d+n+65535)-65536*(n=Math.floor(i/65536)),l=(i=l+n+65535)-65536*(n=Math.floor(i/65536)),f=(i=f+n+65535)-65536*(n=Math.floor(i/65536)),p=(i=p+n+65535)-65536*(n=Math.floor(i/65536)),y=(i=y+n+65535)-65536*(n=Math.floor(i/65536)),m=(i=m+n+65535)-65536*(n=Math.floor(i/65536)),g=(i=g+n+65535)-65536*(n=Math.floor(i/65536)),b=(i=b+n+65535)-65536*(n=Math.floor(i/65536)),v=(i=v+n+65535)-65536*(n=Math.floor(i/65536)),w=(i=w+n+65535)-65536*(n=Math.floor(i/65536)),s+=n-1+37*(n-1),e[0]=s,e[1]=o,e[2]=a,e[3]=c,e[4]=u,e[5]=h,e[6]=d,e[7]=l,e[8]=f,e[9]=p,e[10]=y,e[11]=m,e[12]=g,e[13]=b,e[14]=v,e[15]=w}function q(e,t){j(e,t,t)}function K(e,r){var i,n=t();for(i=0;i<16;i++)n[i]=r[i];for(i=253;i>=0;i--)q(n,n),2!==i&&4!==i&&j(n,n,r);for(i=0;i<16;i++)e[i]=n[i]}function H(e,r){var i,n=t();for(i=0;i<16;i++)n[i]=r[i];for(i=250;i>=0;i--)q(n,n),1!==i&&j(n,n,r);for(i=0;i<16;i++)e[i]=n[i]}function z(e,r,i){var n,s,o=new Uint8Array(32),a=new Float64Array(80),u=t(),h=t(),d=t(),l=t(),f=t(),p=t();for(s=0;s<31;s++)o[s]=r[s];for(o[31]=127&r[31]|64,o[0]&=248,D(a,i),s=0;s<16;s++)h[s]=a[s],l[s]=u[s]=d[s]=0;for(u[0]=l[0]=1,s=254;s>=0;--s)B(u,h,n=o[s>>>3]>>>(7&s)&1),B(d,l,n),L(f,u,d),U(u,u,d),L(d,h,l),U(h,h,l),q(l,f),q(p,u),j(u,d,u),j(d,h,f),L(f,u,d),U(u,u,d),q(h,u),U(d,l,p),j(u,d,c),L(u,u,l),j(d,d,u),j(u,l,p),j(l,h,a),q(h,f),B(u,h,n),B(d,l,n);for(s=0;s<16;s++)a[s+16]=u[s],a[s+32]=d[s],a[s+48]=h[s],a[s+64]=l[s];var y=a.subarray(32),m=a.subarray(16);return K(y,y),j(m,m,y),O(e,m),0}function F(e,t){return z(e,t,s)}function V(e,t){return i(t,32),F(e,t)}function $(e,t,r){var i=new Uint8Array(32);return z(i,r,t),v(e,n,i,w)}C.prototype.blocks=function(e,t,r){for(var i,n,s,o,a,c,u,h,d,l,f,p,y,m,g,b,v,w,S,_=this.fin?0:2048,A=this.h[0],E=this.h[1],C=this.h[2],k=this.h[3],T=this.h[4],P=this.h[5],I=this.h[6],R=this.h[7],x=this.h[8],B=this.h[9],O=this.r[0],M=this.r[1],N=this.r[2],D=this.r[3],L=this.r[4],U=this.r[5],j=this.r[6],q=this.r[7],K=this.r[8],H=this.r[9];r>=16;)l=d=0,l+=(A+=8191&(i=255&e[t+0]|(255&e[t+1])<<8))*O,l+=(E+=8191&(i>>>13|(n=255&e[t+2]|(255&e[t+3])<<8)<<3))*(5*H),l+=(C+=8191&(n>>>10|(s=255&e[t+4]|(255&e[t+5])<<8)<<6))*(5*K),l+=(k+=8191&(s>>>7|(o=255&e[t+6]|(255&e[t+7])<<8)<<9))*(5*q),d=(l+=(T+=8191&(o>>>4|(a=255&e[t+8]|(255&e[t+9])<<8)<<12))*(5*j))>>>13,l&=8191,l+=(P+=a>>>1&8191)*(5*U),l+=(I+=8191&(a>>>14|(c=255&e[t+10]|(255&e[t+11])<<8)<<2))*(5*L),l+=(R+=8191&(c>>>11|(u=255&e[t+12]|(255&e[t+13])<<8)<<5))*(5*D),l+=(x+=8191&(u>>>8|(h=255&e[t+14]|(255&e[t+15])<<8)<<8))*(5*N),f=d+=(l+=(B+=h>>>5|_)*(5*M))>>>13,f+=A*M,f+=E*O,f+=C*(5*H),f+=k*(5*K),d=(f+=T*(5*q))>>>13,f&=8191,f+=P*(5*j),f+=I*(5*U),f+=R*(5*L),f+=x*(5*D),d+=(f+=B*(5*N))>>>13,f&=8191,p=d,p+=A*N,p+=E*M,p+=C*O,p+=k*(5*H),d=(p+=T*(5*K))>>>13,p&=8191,p+=P*(5*q),p+=I*(5*j),p+=R*(5*U),p+=x*(5*L),y=d+=(p+=B*(5*D))>>>13,y+=A*D,y+=E*N,y+=C*M,y+=k*O,d=(y+=T*(5*H))>>>13,y&=8191,y+=P*(5*K),y+=I*(5*q),y+=R*(5*j),y+=x*(5*U),m=d+=(y+=B*(5*L))>>>13,m+=A*L,m+=E*D,m+=C*N,m+=k*M,d=(m+=T*O)>>>13,m&=8191,m+=P*(5*H),m+=I*(5*K),m+=R*(5*q),m+=x*(5*j),g=d+=(m+=B*(5*U))>>>13,g+=A*U,g+=E*L,g+=C*D,g+=k*N,d=(g+=T*M)>>>13,g&=8191,g+=P*O,g+=I*(5*H),g+=R*(5*K),g+=x*(5*q),b=d+=(g+=B*(5*j))>>>13,b+=A*j,b+=E*U,b+=C*L,b+=k*D,d=(b+=T*N)>>>13,b&=8191,b+=P*M,b+=I*O,b+=R*(5*H),b+=x*(5*K),v=d+=(b+=B*(5*q))>>>13,v+=A*q,v+=E*j,v+=C*U,v+=k*L,d=(v+=T*D)>>>13,v&=8191,v+=P*N,v+=I*M,v+=R*O,v+=x*(5*H),w=d+=(v+=B*(5*K))>>>13,w+=A*K,w+=E*q,w+=C*j,w+=k*U,d=(w+=T*L)>>>13,w&=8191,w+=P*D,w+=I*N,w+=R*M,w+=x*O,S=d+=(w+=B*(5*H))>>>13,S+=A*H,S+=E*K,S+=C*q,S+=k*j,d=(S+=T*U)>>>13,S&=8191,S+=P*L,S+=I*D,S+=R*N,S+=x*M,A=l=8191&(d=(d=((d+=(S+=B*O)>>>13)<<2)+d|0)+(l&=8191)|0),E=f+=d>>>=13,C=p&=8191,k=y&=8191,T=m&=8191,P=g&=8191,I=b&=8191,R=v&=8191,x=w&=8191,B=S&=8191,t+=16,r-=16;this.h[0]=A,this.h[1]=E,this.h[2]=C,this.h[3]=k,this.h[4]=T,this.h[5]=P,this.h[6]=I,this.h[7]=R,this.h[8]=x,this.h[9]=B},C.prototype.finish=function(e,t){var r,i,n,s,o=new Uint16Array(10);if(this.leftover){for(s=this.leftover,this.buffer[s++]=1;s<16;s++)this.buffer[s]=0;this.fin=1,this.blocks(this.buffer,0,16)}for(r=this.h[1]>>>13,this.h[1]&=8191,s=2;s<10;s++)this.h[s]+=r,r=this.h[s]>>>13,this.h[s]&=8191;for(this.h[0]+=5*r,r=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=r,r=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=r,o[0]=this.h[0]+5,r=o[0]>>>13,o[0]&=8191,s=1;s<10;s++)o[s]=this.h[s]+r,r=o[s]>>>13,o[s]&=8191;for(o[9]-=8192,i=(1^r)-1,s=0;s<10;s++)o[s]&=i;for(i=~i,s=0;s<10;s++)this.h[s]=this.h[s]&i|o[s];for(this.h[0]=65535&(this.h[0]|this.h[1]<<13),this.h[1]=65535&(this.h[1]>>>3|this.h[2]<<10),this.h[2]=65535&(this.h[2]>>>6|this.h[3]<<7),this.h[3]=65535&(this.h[3]>>>9|this.h[4]<<4),this.h[4]=65535&(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14),this.h[5]=65535&(this.h[6]>>>2|this.h[7]<<11),this.h[6]=65535&(this.h[7]>>>5|this.h[8]<<8),this.h[7]=65535&(this.h[8]>>>8|this.h[9]<<5),n=this.h[0]+this.pad[0],this.h[0]=65535&n,s=1;s<8;s++)n=(this.h[s]+this.pad[s]|0)+(n>>>16)|0,this.h[s]=65535&n;e[t+0]=this.h[0]>>>0&255,e[t+1]=this.h[0]>>>8&255,e[t+2]=this.h[1]>>>0&255,e[t+3]=this.h[1]>>>8&255,e[t+4]=this.h[2]>>>0&255,e[t+5]=this.h[2]>>>8&255,e[t+6]=this.h[3]>>>0&255,e[t+7]=this.h[3]>>>8&255,e[t+8]=this.h[4]>>>0&255,e[t+9]=this.h[4]>>>8&255,e[t+10]=this.h[5]>>>0&255,e[t+11]=this.h[5]>>>8&255,e[t+12]=this.h[6]>>>0&255,e[t+13]=this.h[6]>>>8&255,e[t+14]=this.h[7]>>>0&255,e[t+15]=this.h[7]>>>8&255},C.prototype.update=function(e,t,r){var i,n;if(this.leftover){for((n=16-this.leftover)>r&&(n=r),i=0;i<n;i++)this.buffer[this.leftover+i]=e[t+i];if(r-=n,t+=n,this.leftover+=n,this.leftover<16)return;this.blocks(this.buffer,0,16),this.leftover=0}if(r>=16&&(n=r-r%16,this.blocks(e,t,n),t+=n,r-=n),r){for(i=0;i<r;i++)this.buffer[this.leftover+i]=e[t+i];this.leftover+=r}};var W=P,G=I;var J=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function Y(e,t,r,i){for(var n,s,o,a,c,u,h,d,l,f,p,y,m,g,b,v,w,S,_,A,E,C,k,T,P,I,R=new Int32Array(16),x=new Int32Array(16),B=e[0],O=e[1],M=e[2],N=e[3],D=e[4],L=e[5],U=e[6],j=e[7],q=t[0],K=t[1],H=t[2],z=t[3],F=t[4],V=t[5],$=t[6],W=t[7],G=0;i>=128;){for(_=0;_<16;_++)A=8*_+G,R[_]=r[A+0]<<24|r[A+1]<<16|r[A+2]<<8|r[A+3],x[_]=r[A+4]<<24|r[A+5]<<16|r[A+6]<<8|r[A+7];for(_=0;_<80;_++)if(n=B,s=O,o=M,a=N,c=D,u=L,h=U,j,l=q,f=K,p=H,y=z,m=F,g=V,b=$,W,k=65535&(C=W),T=C>>>16,P=65535&(E=j),I=E>>>16,k+=65535&(C=(F>>>14|D<<18)^(F>>>18|D<<14)^(D>>>9|F<<23)),T+=C>>>16,P+=65535&(E=(D>>>14|F<<18)^(D>>>18|F<<14)^(F>>>9|D<<23)),I+=E>>>16,k+=65535&(C=F&V^~F&$),T+=C>>>16,P+=65535&(E=D&L^~D&U),I+=E>>>16,k+=65535&(C=J[2*_+1]),T+=C>>>16,P+=65535&(E=J[2*_]),I+=E>>>16,E=R[_%16],T+=(C=x[_%16])>>>16,P+=65535&E,I+=E>>>16,P+=(T+=(k+=65535&C)>>>16)>>>16,k=65535&(C=S=65535&k|T<<16),T=C>>>16,P=65535&(E=w=65535&P|(I+=P>>>16)<<16),I=E>>>16,k+=65535&(C=(q>>>28|B<<4)^(B>>>2|q<<30)^(B>>>7|q<<25)),T+=C>>>16,P+=65535&(E=(B>>>28|q<<4)^(q>>>2|B<<30)^(q>>>7|B<<25)),I+=E>>>16,T+=(C=q&K^q&H^K&H)>>>16,P+=65535&(E=B&O^B&M^O&M),I+=E>>>16,d=65535&(P+=(T+=(k+=65535&C)>>>16)>>>16)|(I+=P>>>16)<<16,v=65535&k|T<<16,k=65535&(C=y),T=C>>>16,P=65535&(E=a),I=E>>>16,T+=(C=S)>>>16,P+=65535&(E=w),I+=E>>>16,O=n,M=s,N=o,D=a=65535&(P+=(T+=(k+=65535&C)>>>16)>>>16)|(I+=P>>>16)<<16,L=c,U=u,j=h,B=d,K=l,H=f,z=p,F=y=65535&k|T<<16,V=m,$=g,W=b,q=v,_%16==15)for(A=0;A<16;A++)E=R[A],k=65535&(C=x[A]),T=C>>>16,P=65535&E,I=E>>>16,E=R[(A+9)%16],k+=65535&(C=x[(A+9)%16]),T+=C>>>16,P+=65535&E,I+=E>>>16,w=R[(A+1)%16],k+=65535&(C=((S=x[(A+1)%16])>>>1|w<<31)^(S>>>8|w<<24)^(S>>>7|w<<25)),T+=C>>>16,P+=65535&(E=(w>>>1|S<<31)^(w>>>8|S<<24)^w>>>7),I+=E>>>16,w=R[(A+14)%16],T+=(C=((S=x[(A+14)%16])>>>19|w<<13)^(w>>>29|S<<3)^(S>>>6|w<<26))>>>16,P+=65535&(E=(w>>>19|S<<13)^(S>>>29|w<<3)^w>>>6),I+=E>>>16,I+=(P+=(T+=(k+=65535&C)>>>16)>>>16)>>>16,R[A]=65535&P|I<<16,x[A]=65535&k|T<<16;k=65535&(C=q),T=C>>>16,P=65535&(E=B),I=E>>>16,E=e[0],T+=(C=t[0])>>>16,P+=65535&E,I+=E>>>16,I+=(P+=(T+=(k+=65535&C)>>>16)>>>16)>>>16,e[0]=B=65535&P|I<<16,t[0]=q=65535&k|T<<16,k=65535&(C=K),T=C>>>16,P=65535&(E=O),I=E>>>16,E=e[1],T+=(C=t[1])>>>16,P+=65535&E,I+=E>>>16,I+=(P+=(T+=(k+=65535&C)>>>16)>>>16)>>>16,e[1]=O=65535&P|I<<16,t[1]=K=65535&k|T<<16,k=65535&(C=H),T=C>>>16,P=65535&(E=M),I=E>>>16,E=e[2],T+=(C=t[2])>>>16,P+=65535&E,I+=E>>>16,I+=(P+=(T+=(k+=65535&C)>>>16)>>>16)>>>16,e[2]=M=65535&P|I<<16,t[2]=H=65535&k|T<<16,k=65535&(C=z),T=C>>>16,P=65535&(E=N),I=E>>>16,E=e[3],T+=(C=t[3])>>>16,P+=65535&E,I+=E>>>16,I+=(P+=(T+=(k+=65535&C)>>>16)>>>16)>>>16,e[3]=N=65535&P|I<<16,t[3]=z=65535&k|T<<16,k=65535&(C=F),T=C>>>16,P=65535&(E=D),I=E>>>16,E=e[4],T+=(C=t[4])>>>16,P+=65535&E,I+=E>>>16,I+=(P+=(T+=(k+=65535&C)>>>16)>>>16)>>>16,e[4]=D=65535&P|I<<16,t[4]=F=65535&k|T<<16,k=65535&(C=V),T=C>>>16,P=65535&(E=L),I=E>>>16,E=e[5],T+=(C=t[5])>>>16,P+=65535&E,I+=E>>>16,I+=(P+=(T+=(k+=65535&C)>>>16)>>>16)>>>16,e[5]=L=65535&P|I<<16,t[5]=V=65535&k|T<<16,k=65535&(C=$),T=C>>>16,P=65535&(E=U),I=E>>>16,E=e[6],T+=(C=t[6])>>>16,P+=65535&E,I+=E>>>16,I+=(P+=(T+=(k+=65535&C)>>>16)>>>16)>>>16,e[6]=U=65535&P|I<<16,t[6]=$=65535&k|T<<16,k=65535&(C=W),T=C>>>16,P=65535&(E=j),I=E>>>16,E=e[7],T+=(C=t[7])>>>16,P+=65535&E,I+=E>>>16,I+=(P+=(T+=(k+=65535&C)>>>16)>>>16)>>>16,e[7]=j=65535&P|I<<16,t[7]=W=65535&k|T<<16,G+=128,i-=128}return i}function Z(e,t,r){var i,n=new Int32Array(8),s=new Int32Array(8),o=new Uint8Array(256),a=r;for(n[0]=1779033703,n[1]=3144134277,n[2]=1013904242,n[3]=2773480762,n[4]=1359893119,n[5]=2600822924,n[6]=528734635,n[7]=1541459225,s[0]=4089235720,s[1]=2227873595,s[2]=4271175723,s[3]=1595750129,s[4]=2917565137,s[5]=725511199,s[6]=4215389547,s[7]=327033209,Y(n,s,t,r),r%=128,i=0;i<r;i++)o[i]=t[a-r+i];for(o[r]=128,o[(r=256-128*(r<112?1:0))-9]=0,p(o,r-8,a/536870912|0,a<<3),Y(n,s,o,r),i=0;i<8;i++)p(e,8*i,n[i],s[i]);return 0}function X(e,r){var i=t(),n=t(),s=t(),o=t(),a=t(),c=t(),u=t(),d=t(),l=t();U(i,e[1],e[0]),U(l,r[1],r[0]),j(i,i,l),L(n,e[0],e[1]),L(l,r[0],r[1]),j(n,n,l),j(s,e[3],r[3]),j(s,s,h),j(o,e[2],r[2]),L(o,o,o),U(a,n,i),U(c,o,s),L(u,o,s),L(d,n,i),j(e[0],a,c),j(e[1],d,u),j(e[2],u,c),j(e[3],a,d)}function Q(e,t,r){var i;for(i=0;i<4;i++)B(e[i],t[i],r)}function ee(e,r){var i=t(),n=t(),s=t();K(s,r[2]),j(i,r[0],s),j(n,r[1],s),O(e,n),e[31]^=N(i)<<7}function te(e,t,r){var i,n;for(R(e[0],o),R(e[1],a),R(e[2],a),R(e[3],o),n=255;n>=0;--n)Q(e,t,i=r[n/8|0]>>(7&n)&1),X(t,e),X(e,e),Q(e,t,i)}function re(e,r){var i=[t(),t(),t(),t()];R(i[0],d),R(i[1],l),R(i[2],a),j(i[3],d,l),te(e,i,r)}function ie(e,r,n){var s,o=new Uint8Array(64),a=[t(),t(),t(),t()];for(n||i(r,32),Z(o,r,32),o[0]&=248,o[31]&=127,o[31]|=64,re(a,o),ee(e,a),s=0;s<32;s++)r[s+32]=e[s];return 0}var ne=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function se(e,t){var r,i,n,s;for(i=63;i>=32;--i){for(r=0,n=i-32,s=i-12;n<s;++n)t[n]+=r-16*t[i]*ne[n-(i-32)],r=Math.floor((t[n]+128)/256),t[n]-=256*r;t[n]+=r,t[i]=0}for(r=0,n=0;n<32;n++)t[n]+=r-(t[31]>>4)*ne[n],r=t[n]>>8,t[n]&=255;for(n=0;n<32;n++)t[n]-=r*ne[n];for(i=0;i<32;i++)t[i+1]+=t[i]>>8,e[i]=255&t[i]}function oe(e){var t,r=new Float64Array(64);for(t=0;t<64;t++)r[t]=e[t];for(t=0;t<64;t++)e[t]=0;se(e,r)}function ae(e,r,i,n){var s,o,a=new Uint8Array(64),c=new Uint8Array(64),u=new Uint8Array(64),h=new Float64Array(64),d=[t(),t(),t(),t()];Z(a,n,32),a[0]&=248,a[31]&=127,a[31]|=64;var l=i+64;for(s=0;s<i;s++)e[64+s]=r[s];for(s=0;s<32;s++)e[32+s]=a[32+s];for(Z(u,e.subarray(32),i+32),oe(u),re(d,u),ee(e,d),s=32;s<64;s++)e[s]=n[s];for(Z(c,e,i+64),oe(c),s=0;s<64;s++)h[s]=0;for(s=0;s<32;s++)h[s]=u[s];for(s=0;s<32;s++)for(o=0;o<32;o++)h[s+o]+=c[s]*a[o];return se(e.subarray(32),h),l}function ce(e,r,i,n){var s,c=new Uint8Array(32),h=new Uint8Array(64),d=[t(),t(),t(),t()],l=[t(),t(),t(),t()];if(i<64)return-1;if(function(e,r){var i=t(),n=t(),s=t(),c=t(),h=t(),d=t(),l=t();return R(e[2],a),D(e[1],r),q(s,e[1]),j(c,s,u),U(s,s,e[2]),L(c,e[2],c),q(h,c),q(d,h),j(l,d,h),j(i,l,s),j(i,i,c),H(i,i),j(i,i,s),j(i,i,c),j(i,i,c),j(e[0],i,c),q(n,e[0]),j(n,n,c),M(n,s)&&j(e[0],e[0],f),q(n,e[0]),j(n,n,c),M(n,s)?-1:(N(e[0])===r[31]>>7&&U(e[0],o,e[0]),j(e[3],e[0],e[1]),0)}(l,n))return-1;for(s=0;s<i;s++)e[s]=r[s];for(s=0;s<32;s++)e[s+32]=n[s];if(Z(h,e,i),oe(h),te(d,l,h),re(l,r.subarray(32)),X(d,l),ee(c,d),i-=64,g(r,0,c,0)){for(s=0;s<i;s++)e[s]=0;return-1}for(s=0;s<i;s++)e[s]=r[s+64];return i}var ue=16,he=64,de=32,le=64;function fe(e,t){if(32!==e.length)throw new Error("bad key size");if(24!==t.length)throw new Error("bad nonce size")}function pe(){for(var e=0;e<arguments.length;e++)if(!(arguments[e]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}function ye(e){for(var t=0;t<e.length;t++)e[t]=0}e.lowlevel={crypto_core_hsalsa20:v,crypto_stream_xor:E,crypto_stream:A,crypto_stream_salsa20_xor:S,crypto_stream_salsa20:_,crypto_onetimeauth:k,crypto_onetimeauth_verify:T,crypto_verify_16:m,crypto_verify_32:g,crypto_secretbox:P,crypto_secretbox_open:I,crypto_scalarmult:z,crypto_scalarmult_base:F,crypto_box_beforenm:$,crypto_box_afternm:W,crypto_box:function(e,t,r,i,n,s){var o=new Uint8Array(32);return $(o,n,s),W(e,t,r,i,o)},crypto_box_open:function(e,t,r,i,n,s){var o=new Uint8Array(32);return $(o,n,s),G(e,t,r,i,o)},crypto_box_keypair:V,crypto_hash:Z,crypto_sign:ae,crypto_sign_keypair:ie,crypto_sign_open:ce,crypto_secretbox_KEYBYTES:32,crypto_secretbox_NONCEBYTES:24,crypto_secretbox_ZEROBYTES:32,crypto_secretbox_BOXZEROBYTES:ue,crypto_scalarmult_BYTES:32,crypto_scalarmult_SCALARBYTES:32,crypto_box_PUBLICKEYBYTES:32,crypto_box_SECRETKEYBYTES:32,crypto_box_BEFORENMBYTES:32,crypto_box_NONCEBYTES:24,crypto_box_ZEROBYTES:32,crypto_box_BOXZEROBYTES:16,crypto_sign_BYTES:he,crypto_sign_PUBLICKEYBYTES:de,crypto_sign_SECRETKEYBYTES:le,crypto_sign_SEEDBYTES:32,crypto_hash_BYTES:64,gf:t,D:u,L:ne,pack25519:O,unpack25519:D,M:j,A:L,S:q,Z:U,pow2523:H,add:X,set25519:R,modL:se,scalarmult:te,scalarbase:re},e.randomBytes=function(e){var t=new Uint8Array(e);return i(t,e),t},e.secretbox=function(e,t,r){pe(e,t,r),fe(r,t);for(var i=new Uint8Array(32+e.length),n=new Uint8Array(i.length),s=0;s<e.length;s++)i[s+32]=e[s];return P(n,i,i.length,t,r),n.subarray(ue)},e.secretbox.open=function(e,t,r){pe(e,t,r),fe(r,t);for(var i=new Uint8Array(ue+e.length),n=new Uint8Array(i.length),s=0;s<e.length;s++)i[s+ue]=e[s];return i.length<32||0!==I(n,i,i.length,t,r)?null:n.subarray(32)},e.secretbox.keyLength=32,e.secretbox.nonceLength=24,e.secretbox.overheadLength=ue,e.scalarMult=function(e,t){if(pe(e,t),32!==e.length)throw new Error("bad n size");if(32!==t.length)throw new Error("bad p size");var r=new Uint8Array(32);return z(r,e,t),r},e.scalarMult.base=function(e){if(pe(e),32!==e.length)throw new Error("bad n size");var t=new Uint8Array(32);return F(t,e),t},e.scalarMult.scalarLength=32,e.scalarMult.groupElementLength=32,e.box=function(t,r,i,n){var s=e.box.before(i,n);return e.secretbox(t,r,s)},e.box.before=function(e,t){pe(e,t),function(e,t){if(32!==e.length)throw new Error("bad public key size");if(32!==t.length)throw new Error("bad secret key size")}(e,t);var r=new Uint8Array(32);return $(r,e,t),r},e.box.after=e.secretbox,e.box.open=function(t,r,i,n){var s=e.box.before(i,n);return e.secretbox.open(t,r,s)},e.box.open.after=e.secretbox.open,e.box.keyPair=function(){var e=new Uint8Array(32),t=new Uint8Array(32);return V(e,t),{publicKey:e,secretKey:t}},e.box.keyPair.fromSecretKey=function(e){if(pe(e),32!==e.length)throw new Error("bad secret key size");var t=new Uint8Array(32);return F(t,e),{publicKey:t,secretKey:new Uint8Array(e)}},e.box.publicKeyLength=32,e.box.secretKeyLength=32,e.box.sharedKeyLength=32,e.box.nonceLength=24,e.box.overheadLength=e.secretbox.overheadLength,e.sign=function(e,t){if(pe(e,t),t.length!==le)throw new Error("bad secret key size");var r=new Uint8Array(he+e.length);return ae(r,e,e.length,t),r},e.sign.open=function(e,t){if(pe(e,t),t.length!==de)throw new Error("bad public key size");var r=new Uint8Array(e.length),i=ce(r,e,e.length,t);if(i<0)return null;for(var n=new Uint8Array(i),s=0;s<n.length;s++)n[s]=r[s];return n},e.sign.detached=function(t,r){for(var i=e.sign(t,r),n=new Uint8Array(he),s=0;s<n.length;s++)n[s]=i[s];return n},e.sign.detached.verify=function(e,t,r){if(pe(e,t,r),t.length!==he)throw new Error("bad signature size");if(r.length!==de)throw new Error("bad public key size");var i,n=new Uint8Array(he+e.length),s=new Uint8Array(he+e.length);for(i=0;i<he;i++)n[i]=t[i];for(i=0;i<e.length;i++)n[i+he]=e[i];return ce(s,n,n.length,r)>=0},e.sign.keyPair=function(){var e=new Uint8Array(de),t=new Uint8Array(le);return ie(e,t),{publicKey:e,secretKey:t}},e.sign.keyPair.fromSecretKey=function(e){if(pe(e),e.length!==le)throw new Error("bad secret key size");for(var t=new Uint8Array(de),r=0;r<t.length;r++)t[r]=e[32+r];return{publicKey:t,secretKey:new Uint8Array(e)}},e.sign.keyPair.fromSeed=function(e){if(pe(e),32!==e.length)throw new Error("bad seed size");for(var t=new Uint8Array(de),r=new Uint8Array(le),i=0;i<32;i++)r[i]=e[i];return ie(t,r,!0),{publicKey:t,secretKey:r}},e.sign.publicKeyLength=de,e.sign.secretKeyLength=le,e.sign.seedLength=32,e.sign.signatureLength=he,e.hash=function(e){pe(e);var t=new Uint8Array(64);return Z(t,e,e.length),t},e.hash.hashLength=64,e.verify=function(e,t){return pe(e,t),0!==e.length&&0!==t.length&&(e.length===t.length&&0===y(e,0,t,0,e.length))},e.setPRNG=function(e){i=e},function(){var t="undefined"!=typeof self?self.crypto||self.msCrypto:null;if(t&&t.getRandomValues){e.setPRNG((function(e,r){var i,n=new Uint8Array(r);for(i=0;i<r;i+=65536)t.getRandomValues(n.subarray(i,i+Math.min(r-i,65536)));for(i=0;i<r;i++)e[i]=n[i];ye(n)}))}else(t=r(6113))&&t.randomBytes&&e.setPRNG((function(e,r){var i,n=t.randomBytes(r);for(i=0;i<r;i++)e[i]=n[i];ye(n)}))}()}(e.exports?e.exports:self.nacl=self.nacl||{})},2163:(e,t,r)=>{"use strict";r.r(t),r.d(t,{NIL:()=>E,parse:()=>b,stringify:()=>l,v1:()=>g,v3:()=>w,v4:()=>_,v5:()=>A,validate:()=>u,version:()=>C});var i=r(6113),n=r.n(i);const s=new Uint8Array(256);let o=s.length;function a(){return o>s.length-16&&(n().randomFillSync(s),o=0),s.slice(o,o+=16)}const c=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const u=function(e){return"string"==typeof e&&c.test(e)},h=[];for(let e=0;e<256;++e)h.push((e+256).toString(16).slice(1));function d(e,t=0){return(h[e[t+0]]+h[e[t+1]]+h[e[t+2]]+h[e[t+3]]+"-"+h[e[t+4]]+h[e[t+5]]+"-"+h[e[t+6]]+h[e[t+7]]+"-"+h[e[t+8]]+h[e[t+9]]+"-"+h[e[t+10]]+h[e[t+11]]+h[e[t+12]]+h[e[t+13]]+h[e[t+14]]+h[e[t+15]]).toLowerCase()}const l=function(e,t=0){const r=d(e,t);if(!u(r))throw TypeError("Stringified UUID is invalid");return r};let f,p,y=0,m=0;const g=function(e,t,r){let i=t&&r||0;const n=t||new Array(16);let s=(e=e||{}).node||f,o=void 0!==e.clockseq?e.clockseq:p;if(null==s||null==o){const t=e.random||(e.rng||a)();null==s&&(s=f=[1|t[0],t[1],t[2],t[3],t[4],t[5]]),null==o&&(o=p=16383&(t[6]<<8|t[7]))}let c=void 0!==e.msecs?e.msecs:Date.now(),u=void 0!==e.nsecs?e.nsecs:m+1;const h=c-y+(u-m)/1e4;if(h<0&&void 0===e.clockseq&&(o=o+1&16383),(h<0||c>y)&&void 0===e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");y=c,m=u,p=o,c+=122192928e5;const l=(1e4*(268435455&c)+u)%4294967296;n[i++]=l>>>24&255,n[i++]=l>>>16&255,n[i++]=l>>>8&255,n[i++]=255&l;const g=c/4294967296*1e4&268435455;n[i++]=g>>>8&255,n[i++]=255&g,n[i++]=g>>>24&15|16,n[i++]=g>>>16&255,n[i++]=o>>>8|128,n[i++]=255&o;for(let e=0;e<6;++e)n[i+e]=s[e];return t||d(n)};const b=function(e){if(!u(e))throw TypeError("Invalid UUID");let t;const r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r};function v(e,t,r){function i(e,i,n,s){var o;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));const t=[];for(let r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof i&&(i=b(i)),16!==(null===(o=i)||void 0===o?void 0:o.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let a=new Uint8Array(16+e.length);if(a.set(i),a.set(e,i.length),a=r(a),a[6]=15&a[6]|t,a[8]=63&a[8]|128,n){s=s||0;for(let e=0;e<16;++e)n[s+e]=a[e];return n}return d(a)}try{i.name=e}catch(e){}return i.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",i.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",i}const w=v("v3",48,(function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),n().createHash("md5").update(e).digest()})),S={randomUUID:n().randomUUID};const _=function(e,t,r){if(S.randomUUID&&!t&&!e)return S.randomUUID();const i=(e=e||{}).random||(e.rng||a)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=i[e];return t}return d(i)};const A=v("v5",80,(function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),n().createHash("sha1").update(e).digest()})),E="00000000-0000-0000-0000-000000000000";const C=function(e){if(!u(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}},5790:(e,t,r)=>{var i=t,{Buffer:n}=r(4300),s=r(2037);i.toBuffer=function(e,t,r){var i;if(r=~~r,this.isV4Format(e))i=t||new n(r+4),e.split(/\./g).map((e=>{i[r++]=255&parseInt(e,10)}));else if(this.isV6Format(e)){var s,o=e.split(":",8);for(s=0;s<o.length;s++){var a;this.isV4Format(o[s])&&(a=this.toBuffer(o[s]),o[s]=a.slice(0,2).toString("hex")),a&&++s<8&&o.splice(s,0,a.slice(2,4).toString("hex"))}if(""===o[0])for(;o.length<8;)o.unshift("0");else if(""===o[o.length-1])for(;o.length<8;)o.push("0");else if(o.length<8){for(s=0;s<o.length&&""!==o[s];s++);var c=[s,1];for(s=9-o.length;s>0;s--)c.push("0");o.splice.apply(o,c)}for(i=t||new n(r+16),s=0;s<o.length;s++){var u=parseInt(o[s],16);i[r++]=u>>8&255,i[r++]=255&u}}if(!i)throw Error(`Invalid ip address: ${e}`);return i},i.toString=function(e,t,r){t=~~t;var i,n=[];if(4===(r=r||e.length-t)){for(i=0;i<r;i++)n.push(e[t+i]);n=n.join(".")}else if(16===r){for(i=0;i<r;i+=2)n.push(e.readUInt16BE(t+i).toString(16));n=(n=(n=n.join(":")).replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3")).replace(/:{3,4}/,"::")}return n};var o=/^(\d{1,3}\.){3,3}\d{1,3}$/,a=/^(::)?(((\d{1,3}\.){3}(\d{1,3}){1})?([0-9a-f]){0,4}:{0,2}){1,8}(::)?$/i;function c(e){return 4===e?"ipv4":6===e?"ipv6":e?e.toLowerCase():"ipv4"}i.isV4Format=function(e){return o.test(e)},i.isV6Format=function(e){return a.test(e)},i.fromPrefixLen=function(e,t){var r=4;"ipv6"===(t=e>32?"ipv6":c(t))&&(r=16);for(var s=new n(r),o=0,a=s.length;o<a;++o){var u=8;e<8&&(u=e),e-=u,s[o]=255&~(255>>u)}return i.toString(s)},i.mask=function(e,t){e=i.toBuffer(e),t=i.toBuffer(t);var r,s=new n(Math.max(e.length,t.length));if(e.length===t.length)for(r=0;r<e.length;r++)s[r]=e[r]&t[r];else if(4===t.length)for(r=0;r<t.length;r++)s[r]=e[e.length-4+r]&t[r];else{for(r=0;r<s.length-6;r++)s[r]=0;for(s[10]=255,s[11]=255,r=0;r<e.length;r++)s[r+12]=e[r]&t[r+12];r+=12}for(;r<s.length;r++)s[r]=0;return i.toString(s)},i.cidr=function(e){var t=e.split("/"),r=t[0];if(2!==t.length)throw new Error(`invalid CIDR subnet: ${r}`);var n=i.fromPrefixLen(parseInt(t[1],10));return i.mask(r,n)},i.subnet=function(e,t){for(var r=i.toLong(i.mask(e,t)),n=i.toBuffer(t),s=0,o=0;o<n.length;o++)if(255===n[o])s+=8;else for(var a=255&n[o];a;)a=a<<1&255,s++;var c=Math.pow(2,32-s);return{networkAddress:i.fromLong(r),firstAddress:c<=2?i.fromLong(r):i.fromLong(r+1),lastAddress:c<=2?i.fromLong(r+c-1):i.fromLong(r+c-2),broadcastAddress:i.fromLong(r+c-1),subnetMask:t,subnetMaskLength:s,numHosts:c<=2?c:c-2,length:c,contains:e=>r===i.toLong(i.mask(e,t))}},i.cidrSubnet=function(e){var t=e.split("/"),r=t[0];if(2!==t.length)throw new Error(`invalid CIDR subnet: ${r}`);var n=i.fromPrefixLen(parseInt(t[1],10));return i.subnet(r,n)},i.not=function(e){for(var t=i.toBuffer(e),r=0;r<t.length;r++)t[r]=255^t[r];return i.toString(t)},i.or=function(e,t){var r;if(e=i.toBuffer(e),t=i.toBuffer(t),e.length===t.length){for(r=0;r<e.length;++r)e[r]|=t[r];return i.toString(e)}var n=e,s=t;t.length>e.length&&(n=t,s=e);var o=n.length-s.length;for(r=o;r<n.length;++r)n[r]|=s[r-o];return i.toString(n)},i.isEqual=function(e,t){var r;if(e=i.toBuffer(e),t=i.toBuffer(t),e.length===t.length){for(r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}if(4===t.length){var n=t;t=e,e=n}for(r=0;r<10;r++)if(0!==t[r])return!1;var s=t.readUInt16BE(10);if(0!==s&&65535!==s)return!1;for(r=0;r<4;r++)if(e[r]!==t[r+12])return!1;return!0},i.isPrivate=function(e){return/^(::f{4}:)?10\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?192\.168\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?172\.(1[6-9]|2\d|30|31)\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?169\.254\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^f[cd][0-9a-f]{2}:/i.test(e)||/^fe80:/i.test(e)||/^::1$/.test(e)||/^::$/.test(e)},i.isPublic=function(e){return!i.isPrivate(e)},i.isLoopback=function(e){return/^(::f{4}:)?127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})/.test(e)||/^fe80::1$/.test(e)||/^::1$/.test(e)||/^::$/.test(e)},i.loopback=function(e){if("ipv4"!==(e=c(e))&&"ipv6"!==e)throw new Error("family must be ipv4 or ipv6");return"ipv4"===e?"127.0.0.1":"fe80::1"},i.address=function(e,t){var r=s.networkInterfaces();if(t=c(t),e&&"private"!==e&&"public"!==e){var n=r[e].filter((e=>c(e.family)===t));if(0===n.length)return;return n[0].address}var o=Object.keys(r).map((n=>{var s=r[n].filter((r=>(r.family=c(r.family),r.family===t&&!i.isLoopback(r.address)&&(!e||("public"===e?i.isPrivate(r.address):i.isPublic(r.address))))));return s.length?s[0].address:void 0})).filter(Boolean);return o.length?o[0]:i.loopback(t)},i.toLong=function(e){var t=0;return e.split(".").forEach((e=>{t<<=8,t+=parseInt(e)})),t>>>0},i.fromLong=function(e){return`${e>>>24}.${e>>16&255}.${e>>8&255}.${255&e}`}},4538:e=>{"use strict";class t extends Error{constructor(e){super(e||"Promise was canceled"),this.name="CancelError"}get isCanceled(){return!0}}class r{static fn(e){return(...t)=>new r(((r,i,n)=>{t.push(n),e(...t).then(r,i)}))}constructor(e){this._cancelHandlers=[],this._isPending=!0,this._isCanceled=!1,this._rejectOnCancel=!0,this._promise=new Promise(((t,r)=>{this._reject=r;const i=e=>{if(!this._isPending)throw new Error("The `onCancel` handler was attached after the promise settled.");this._cancelHandlers.push(e)};return Object.defineProperties(i,{shouldReject:{get:()=>this._rejectOnCancel,set:e=>{this._rejectOnCancel=e}}}),e((e=>{this._isCanceled&&i.shouldReject||(this._isPending=!1,t(e))}),(e=>{this._isPending=!1,r(e)}),i)}))}then(e,t){return this._promise.then(e,t)}catch(e){return this._promise.catch(e)}finally(e){return this._promise.finally(e)}cancel(e){if(this._isPending&&!this._isCanceled){if(this._isCanceled=!0,this._cancelHandlers.length>0)try{for(const e of this._cancelHandlers)e()}catch(e){return void this._reject(e)}this._rejectOnCancel&&this._reject(new t(e))}}get isCanceled(){return this._isCanceled}}Object.setPrototypeOf(r.prototype,Promise.prototype),e.exports=r,e.exports.CancelError=t},413:(e,t,r)=>{"use strict";var i=t,n=r(4300).Buffer,s=r(2037);i.toBuffer=function(e,t,r){var i;if(r=~~r,this.isV4Format(e))i=t||new n(r+4),e.split(/\./g).map((function(e){i[r++]=255&parseInt(e,10)}));else if(this.isV6Format(e)){var s,o=e.split(":",8);for(s=0;s<o.length;s++){var a;this.isV4Format(o[s])&&(a=this.toBuffer(o[s]),o[s]=a.slice(0,2).toString("hex")),a&&++s<8&&o.splice(s,0,a.slice(2,4).toString("hex"))}if(""===o[0])for(;o.length<8;)o.unshift("0");else if(""===o[o.length-1])for(;o.length<8;)o.push("0");else if(o.length<8){for(s=0;s<o.length&&""!==o[s];s++);var c=[s,1];for(s=9-o.length;s>0;s--)c.push("0");o.splice.apply(o,c)}for(i=t||new n(r+16),s=0;s<o.length;s++){var u=parseInt(o[s],16);i[r++]=u>>8&255,i[r++]=255&u}}if(!i)throw Error("Invalid ip address: "+e);return i},i.toString=function(e,t,r){t=~~t;var i=[];if(4===(r=r||e.length-t)){for(var n=0;n<r;n++)i.push(e[t+n]);i=i.join(".")}else if(16===r){for(n=0;n<r;n+=2)i.push(e.readUInt16BE(t+n).toString(16));i=(i=(i=i.join(":")).replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3")).replace(/:{3,4}/,"::")}return i};var o=/^(\d{1,3}\.){3,3}\d{1,3}$/,a=/^(::)?(((\d{1,3}\.){3}(\d{1,3}){1})?([0-9a-f]){0,4}:{0,2}){1,8}(::)?$/i;function c(e){return e?e.toLowerCase():"ipv4"}i.isV4Format=function(e){return o.test(e)},i.isV6Format=function(e){return a.test(e)},i.fromPrefixLen=function(e,t){var r=4;"ipv6"===(t=e>32?"ipv6":c(t))&&(r=16);for(var s=new n(r),o=0,a=s.length;o<a;++o){var u=8;e<8&&(u=e),e-=u,s[o]=255&~(255>>u)}return i.toString(s)},i.mask=function(e,t){e=i.toBuffer(e),t=i.toBuffer(t);var r=new n(Math.max(e.length,t.length)),s=0;if(e.length===t.length)for(s=0;s<e.length;s++)r[s]=e[s]&t[s];else if(4===t.length)for(s=0;s<t.length;s++)r[s]=e[e.length-4+s]&t[s];else{for(s=0;s<r.length-6;s++)r[s]=0;for(r[10]=255,r[11]=255,s=0;s<e.length;s++)r[s+12]=e[s]&t[s+12];s+=12}for(;s<r.length;s++)r[s]=0;return i.toString(r)},i.cidr=function(e){var t=e.split("/"),r=t[0];if(2!==t.length)throw new Error("invalid CIDR subnet: "+r);var n=i.fromPrefixLen(parseInt(t[1],10));return i.mask(r,n)},i.subnet=function(e,t){for(var r=i.toLong(i.mask(e,t)),n=i.toBuffer(t),s=0,o=0;o<n.length;o++)if(255===n[o])s+=8;else for(var a=255&n[o];a;)a=a<<1&255,s++;var c=Math.pow(2,32-s);return{networkAddress:i.fromLong(r),firstAddress:c<=2?i.fromLong(r):i.fromLong(r+1),lastAddress:c<=2?i.fromLong(r+c-1):i.fromLong(r+c-2),broadcastAddress:i.fromLong(r+c-1),subnetMask:t,subnetMaskLength:s,numHosts:c<=2?c:c-2,length:c,contains:function(e){return r===i.toLong(i.mask(e,t))}}},i.cidrSubnet=function(e){var t=e.split("/"),r=t[0];if(2!==t.length)throw new Error("invalid CIDR subnet: "+r);var n=i.fromPrefixLen(parseInt(t[1],10));return i.subnet(r,n)},i.not=function(e){for(var t=i.toBuffer(e),r=0;r<t.length;r++)t[r]=255^t[r];return i.toString(t)},i.or=function(e,t){if(e=i.toBuffer(e),t=i.toBuffer(t),e.length===t.length){for(var r=0;r<e.length;++r)e[r]|=t[r];return i.toString(e)}var n=e,s=t;t.length>e.length&&(n=t,s=e);var o=n.length-s.length;for(r=o;r<n.length;++r)n[r]|=s[r-o];return i.toString(n)},i.isEqual=function(e,t){if(e=i.toBuffer(e),t=i.toBuffer(t),e.length===t.length){for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}if(4===t.length){var n=t;t=e,e=n}for(r=0;r<10;r++)if(0!==t[r])return!1;var s=t.readUInt16BE(10);if(0!==s&&65535!==s)return!1;for(r=0;r<4;r++)if(e[r]!==t[r+12])return!1;return!0},i.isPrivate=function(e){return/^(::f{4}:)?10\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?192\.168\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?172\.(1[6-9]|2\d|30|31)\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?169\.254\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^f[cd][0-9a-f]{2}:/i.test(e)||/^fe80:/i.test(e)||/^::1$/.test(e)||/^::$/.test(e)},i.isPublic=function(e){return!i.isPrivate(e)},i.isLoopback=function(e){return/^(::f{4}:)?127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})/.test(e)||/^fe80::1$/.test(e)||/^::1$/.test(e)||/^::$/.test(e)},i.loopback=function(e){if("ipv4"!==(e=c(e))&&"ipv6"!==e)throw new Error("family must be ipv4 or ipv6");return"ipv4"===e?"127.0.0.1":"fe80::1"},i.address=function(e,t){var r,n=s.networkInterfaces();if(t=c(t),e&&"private"!==e&&"public"!==e){var o=n[e].filter((function(e){return e.family.toLowerCase()===t}));if(0===o.length)return;return o[0].address}return(r=Object.keys(n).map((function(r){var s=n[r].filter((function(r){return r.family=r.family.toLowerCase(),r.family===t&&!i.isLoopback(r.address)&&(!e||("public"===e?i.isPrivate(r.address):i.isPublic(r.address)))}));return s.length?s[0].address:void 0})).filter(Boolean)).length?r[0]:i.loopback(t)},i.toLong=function(e){var t=0;return e.split(".").forEach((function(e){t<<=8,t+=parseInt(e)})),t>>>0},i.fromLong=function(e){return(e>>>24)+"."+(e>>16&255)+"."+(e>>8&255)+"."+(255&e)}},7954:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.MixinDeviceBase=t.ScryptedDeviceBase=void 0,n(r(5492),t);const s=r(5492);class o extends s.DeviceBase{constructor(e){super(),this.nativeId=e}get storage(){return this._storage||(this._storage=deviceManager.getDeviceStorage(this.nativeId)),this._storage}get log(){return this._log||(this._log=deviceManager.getDeviceLogger(this.nativeId)),this._log}get console(){return this._console||(this._console=deviceManager.getDeviceConsole(this.nativeId)),this._console}async createMediaObject(e,t){return mediaManager.createMediaObject(e,t,{sourceId:this.id})}getMediaObjectConsole(e){return"string"!=typeof e.sourceId?this.console:deviceManager.getMixinConsole(e.sourceId,this.nativeId)}_lazyLoadDeviceState(){this._deviceState||(this.nativeId?this._deviceState=deviceManager.getDeviceState(this.nativeId):this._deviceState=deviceManager.getDeviceState())}onDeviceEvent(e,t){return deviceManager.onDeviceEvent(this.nativeId,e,t)}}t.ScryptedDeviceBase=o;class a extends s.DeviceBase{constructor(e){super(),this._listeners=new Set,this.nativeId=systemManager.getDeviceById(this.id)?.nativeId,this.mixinDevice=e.mixinDevice,this.mixinDeviceInterfaces=e.mixinDeviceInterfaces,this.mixinStorageSuffix=e.mixinStorageSuffix,this._deviceState=e.mixinDeviceState,this._deviceState.__rpcproxy_traps_all_properties&&deviceManager.createDeviceState&&"string"==typeof this._deviceState.id&&(this._deviceState=deviceManager.createDeviceState(this._deviceState.id,this._deviceState.setState)),this.mixinProviderNativeId=e.mixinProviderNativeId}get storage(){if(!this._storage){const e=this.mixinStorageSuffix,t=this.id+(e?":"+e:"");this._storage=deviceManager.getMixinStorage(t,this.mixinProviderNativeId)}return this._storage}get console(){return this._console||(deviceManager.getMixinConsole?this._console=deviceManager.getMixinConsole(this.id,this.mixinProviderNativeId):this._console=deviceManager.getDeviceConsole(this.mixinProviderNativeId)),this._console}async createMediaObject(e,t){return mediaManager.createMediaObject(e,t,{sourceId:this.id})}getMediaObjectConsole(e){return"string"!=typeof e.sourceId?this.console:deviceManager.getMixinConsole(e.sourceId,this.mixinProviderNativeId)}onDeviceEvent(e,t){return deviceManager.onMixinEvent(this.id,this,e,t)}_lazyLoadDeviceState(){}manageListener(e){this._listeners.add(e)}release(){for(const e of this._listeners)e.removeListener()}}t.MixinDeviceBase=a,function(){function e(e){return function(){return this._lazyLoadDeviceState(),this._deviceState?.[e]}}function t(e){return function(t){this._lazyLoadDeviceState(),this._deviceState?this._deviceState[e]=t:console.warn("device state is unavailable. the device must be discovered with deviceManager.onDeviceDiscovered or deviceManager.onDevicesChanged before the state can be set.")}}for(const r of Object.values(s.ScryptedInterfaceProperty))r!==s.ScryptedInterfaceProperty.nativeId&&(Object.defineProperty(o.prototype,r,{set:t(r),get:e(r)}),Object.defineProperty(a.prototype,r,{set:t(r),get:e(r)}))}();let c={};try{let e;try{e=pluginRuntimeAPI}catch(e){}c=Object.assign(c,{log:deviceManager.getDeviceLogger(void 0),deviceManager,endpointManager,mediaManager,systemManager,pluginHostAPI,...e});try{systemManager.setScryptedInterfaceDescriptors?.(s.TYPES_VERSION,s.ScryptedInterfaceDescriptors)?.catch((()=>{}))}catch(e){}}catch(e){console.error("sdk initialization error, import @scrypted/types or use @scrypted/client instead",e)}t.default=c},8202:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.StorageSettings=void 0;const o=s(r(7954)),{systemManager:a}=o.default;t.StorageSettings=class{constructor(e,t){this.device=e,this.settings=t,this.values={},this.hasValue={};for(const e of Object.keys(t)){const r=t[e],i=()=>this.getItem(e);let n;n="clippath"!==r.type?i:()=>{try{return JSON.parse(i())}catch(e){}},Object.defineProperty(this.values,e,{get:n,set:t=>this.putSetting(e,t),enumerable:!0}),Object.defineProperty(this.hasValue,e,{get:()=>null!=this.device.storage.getItem(e),enumerable:!0})}}get keys(){const e={};for(const t of Object.keys(this.settings))e[t]=t;return e}async getSettings(){const e=await(this.options?.onGet?.()),t=[];for(const[r,i]of Object.entries(this.settings)){let n=Object.assign({},i);e?.[r]&&(n=Object.assign(n,e[r])),n.onGet&&(n=Object.assign(n,await n.onGet())),n.hide||await(this.options?.hide?.[r]?.())||(n.key=r,n.value=this.getItemInternal(r,n,!0),t.push(n),delete n.onPut,delete n.onGet,delete n.mapPut,delete n.mapGet)}return t}async putSetting(e,t){const r=this.settings[e];let i;return r&&(i=this.getItemInternal(e,r)),this.putSettingInternal(r,i,e,t)}putSettingInternal(e,t,r,i){e?.noStore||(e?.mapPut&&(i=e.mapPut(t,i)),"object"==typeof i?this.device.storage.setItem(r,JSON.stringify(i)):null==i?this.device.storage.removeItem(r):this.device.storage.setItem(r,i?.toString())),e?.onPut?.(t,i),this.device.onDeviceEvent(o.ScryptedInterface.Settings,void 0)}getItemInternal(e,t,r){if(!t)return this.device.storage.getItem(e);const i=function(e,t,r,i){const n=t.multiple?"array":t.type;if("boolean"===n)return"true"===e||"false"!==e&&(r()||!1);if("number"===n)return parseFloat(e)||r()||0;if("integer"===n)return parseInt(e)||r()||0;if("array"===n)try{return JSON.parse(e)}catch(e){return r()||[]}if("device"===n)return i?e:a.getDeviceById(e)||a.getDeviceById(r());if(e&&t.json)try{return JSON.parse(e)}catch(e){return r()}return e||r()}(this.device.storage.getItem(e),t,(()=>t.persistedDefaultValue?(this.putSettingInternal(t,void 0,e,t.persistedDefaultValue),t.persistedDefaultValue):t.defaultValue),r);return t.mapGet?t.mapGet(i):i}getItem(e){return this.getItemInternal(e,this.settings[e])}}},5492:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScryptedMimeTypes=t.ScryptedInterface=t.MediaPlayerState=t.SecuritySystemObstruction=t.SecuritySystemMode=t.AirQuality=t.ChargeState=t.LockState=t.PanTiltZoomMovement=t.ThermostatMode=t.TemperatureUnit=t.FanMode=t.HumidityMode=t.ScryptedDeviceType=t.ScryptedInterfaceDescriptors=t.ScryptedInterfaceMethod=t.ScryptedInterfaceProperty=t.DeviceBase=t.TYPES_VERSION=void 0,t.TYPES_VERSION="0.2.79";t.DeviceBase=class{},function(e){e.id="id",e.info="info",e.interfaces="interfaces",e.mixins="mixins",e.name="name",e.nativeId="nativeId",e.pluginId="pluginId",e.providedInterfaces="providedInterfaces",e.providedName="providedName",e.providedRoom="providedRoom",e.providedType="providedType",e.providerId="providerId",e.room="room",e.type="type",e.on="on",e.brightness="brightness",e.colorTemperature="colorTemperature",e.rgb="rgb",e.hsv="hsv",e.running="running",e.paused="paused",e.docked="docked",e.temperatureSetting="temperatureSetting",e.thermostatActiveMode="thermostatActiveMode",e.thermostatAvailableModes="thermostatAvailableModes",e.thermostatMode="thermostatMode",e.thermostatSetpoint="thermostatSetpoint",e.thermostatSetpointHigh="thermostatSetpointHigh",e.thermostatSetpointLow="thermostatSetpointLow",e.temperature="temperature",e.temperatureUnit="temperatureUnit",e.humidity="humidity",e.ptzCapabilities="ptzCapabilities",e.lockState="lockState",e.entryOpen="entryOpen",e.batteryLevel="batteryLevel",e.chargeState="chargeState",e.online="online",e.fromMimeType="fromMimeType",e.toMimeType="toMimeType",e.binaryState="binaryState",e.tampered="tampered",e.powerDetected="powerDetected",e.audioDetected="audioDetected",e.motionDetected="motionDetected",e.ambientLight="ambientLight",e.occupied="occupied",e.flooded="flooded",e.ultraviolet="ultraviolet",e.luminance="luminance",e.position="position",e.securitySystemState="securitySystemState",e.pm10Density="pm10Density",e.pm25Density="pm25Density",e.vocDensity="vocDensity",e.noxDensity="noxDensity",e.co2ppm="co2ppm",e.airQuality="airQuality",e.humiditySetting="humiditySetting",e.fan="fan",e.applicationInfo="applicationInfo"}(t.ScryptedInterfaceProperty||(t.ScryptedInterfaceProperty={})),function(e){e.listen="listen",e.probe="probe",e.setMixins="setMixins",e.setName="setName",e.setRoom="setRoom",e.setType="setType",e.getPluginJson="getPluginJson",e.turnOff="turnOff",e.turnOn="turnOn",e.setBrightness="setBrightness",e.getTemperatureMaxK="getTemperatureMaxK",e.getTemperatureMinK="getTemperatureMinK",e.setColorTemperature="setColorTemperature",e.setRgb="setRgb",e.setHsv="setHsv",e.sendNotification="sendNotification",e.start="start",e.stop="stop",e.pause="pause",e.resume="resume",e.dock="dock",e.setTemperature="setTemperature",e.setThermostatMode="setThermostatMode",e.setThermostatSetpoint="setThermostatSetpoint",e.setThermostatSetpointHigh="setThermostatSetpointHigh",e.setThermostatSetpointLow="setThermostatSetpointLow",e.setTemperatureUnit="setTemperatureUnit",e.getPictureOptions="getPictureOptions",e.takePicture="takePicture",e.getAudioStream="getAudioStream",e.startDisplay="startDisplay",e.stopDisplay="stopDisplay",e.getVideoStream="getVideoStream",e.getVideoStreamOptions="getVideoStreamOptions",e.getRecordingStream="getRecordingStream",e.getRecordingStreamCurrentTime="getRecordingStreamCurrentTime",e.getRecordingStreamOptions="getRecordingStreamOptions",e.getRecordingStreamThumbnail="getRecordingStreamThumbnail",e.ptzCommand="ptzCommand",e.getRecordedEvents="getRecordedEvents",e.getVideoClip="getVideoClip",e.getVideoClipThumbnail="getVideoClipThumbnail",e.getVideoClips="getVideoClips",e.removeVideoClips="removeVideoClips",e.setVideoStreamOptions="setVideoStreamOptions",e.startIntercom="startIntercom",e.stopIntercom="stopIntercom",e.lock="lock",e.unlock="unlock",e.addPassword="addPassword",e.getPasswords="getPasswords",e.removePassword="removePassword",e.activate="activate",e.deactivate="deactivate",e.isReversible="isReversible",e.closeEntry="closeEntry",e.openEntry="openEntry",e.getDevice="getDevice",e.releaseDevice="releaseDevice",e.adoptDevice="adoptDevice",e.discoverDevices="discoverDevices",e.createDevice="createDevice",e.getCreateDeviceSettings="getCreateDeviceSettings",e.getRefreshFrequency="getRefreshFrequency",e.refresh="refresh",e.getMediaStatus="getMediaStatus",e.load="load",e.seek="seek",e.skipNext="skipNext",e.skipPrevious="skipPrevious",e.convert="convert",e.getSettings="getSettings",e.putSetting="putSetting",e.armSecuritySystem="armSecuritySystem",e.disarmSecuritySystem="disarmSecuritySystem",e.getReadmeMarkdown="getReadmeMarkdown",e.getOauthUrl="getOauthUrl",e.onOauthCallback="onOauthCallback",e.canMixin="canMixin",e.getMixin="getMixin",e.releaseMixin="releaseMixin",e.onRequest="onRequest",e.onConnection="onConnection",e.onPush="onPush",e.run="run",e.eval="eval",e.loadScripts="loadScripts",e.saveScript="saveScript",e.trackObjects="trackObjects",e.getDetectionInput="getDetectionInput",e.getObjectTypes="getObjectTypes",e.detectObjects="detectObjects",e.generateObjectDetections="generateObjectDetections",e.getDetectionModel="getDetectionModel",e.setHumidity="setHumidity",e.setFan="setFan",e.startRTCSignalingSession="startRTCSignalingSession",e.createRTCSignalingSession="createRTCSignalingSession",e.getScryptedUserAccessControl="getScryptedUserAccessControl",e.generateVideoFrames="generateVideoFrames"}(t.ScryptedInterfaceMethod||(t.ScryptedInterfaceMethod={})),t.ScryptedInterfaceDescriptors={ScryptedDevice:{name:"ScryptedDevice",methods:["listen","probe","setMixins","setName","setRoom","setType"],properties:["id","info","interfaces","mixins","name","nativeId","pluginId","providedInterfaces","providedName","providedRoom","providedType","providerId","room","type"]},ScryptedPlugin:{name:"ScryptedPlugin",methods:["getPluginJson"],properties:[]},OnOff:{name:"OnOff",methods:["turnOff","turnOn"],properties:["on"]},Brightness:{name:"Brightness",methods:["setBrightness"],properties:["brightness"]},ColorSettingTemperature:{name:"ColorSettingTemperature",methods:["getTemperatureMaxK","getTemperatureMinK","setColorTemperature"],properties:["colorTemperature"]},ColorSettingRgb:{name:"ColorSettingRgb",methods:["setRgb"],properties:["rgb"]},ColorSettingHsv:{name:"ColorSettingHsv",methods:["setHsv"],properties:["hsv"]},Notifier:{name:"Notifier",methods:["sendNotification"],properties:[]},StartStop:{name:"StartStop",methods:["start","stop"],properties:["running"]},Pause:{name:"Pause",methods:["pause","resume"],properties:["paused"]},Dock:{name:"Dock",methods:["dock"],properties:["docked"]},TemperatureSetting:{name:"TemperatureSetting",methods:["setTemperature","setThermostatMode","setThermostatSetpoint","setThermostatSetpointHigh","setThermostatSetpointLow"],properties:["temperatureSetting","thermostatActiveMode","thermostatAvailableModes","thermostatMode","thermostatSetpoint","thermostatSetpointHigh","thermostatSetpointLow"]},Thermometer:{name:"Thermometer",methods:["setTemperatureUnit"],properties:["temperature","temperatureUnit"]},HumiditySensor:{name:"HumiditySensor",methods:[],properties:["humidity"]},Camera:{name:"Camera",methods:["getPictureOptions","takePicture"],properties:[]},Microphone:{name:"Microphone",methods:["getAudioStream"],properties:[]},Display:{name:"Display",methods:["startDisplay","stopDisplay"],properties:[]},VideoCamera:{name:"VideoCamera",methods:["getVideoStream","getVideoStreamOptions"],properties:[]},VideoRecorder:{name:"VideoRecorder",methods:["getRecordingStream","getRecordingStreamCurrentTime","getRecordingStreamOptions","getRecordingStreamThumbnail"],properties:[]},PanTiltZoom:{name:"PanTiltZoom",methods:["ptzCommand"],properties:["ptzCapabilities"]},EventRecorder:{name:"EventRecorder",methods:["getRecordedEvents"],properties:[]},VideoClips:{name:"VideoClips",methods:["getVideoClip","getVideoClipThumbnail","getVideoClips","removeVideoClips"],properties:[]},VideoCameraConfiguration:{name:"VideoCameraConfiguration",methods:["setVideoStreamOptions"],properties:[]},Intercom:{name:"Intercom",methods:["startIntercom","stopIntercom"],properties:[]},Lock:{name:"Lock",methods:["lock","unlock"],properties:["lockState"]},PasswordStore:{name:"PasswordStore",methods:["addPassword","getPasswords","removePassword"],properties:[]},Scene:{name:"Scene",methods:["activate","deactivate","isReversible"],properties:[]},Entry:{name:"Entry",methods:["closeEntry","openEntry"],properties:[]},EntrySensor:{name:"EntrySensor",methods:[],properties:["entryOpen"]},DeviceProvider:{name:"DeviceProvider",methods:["getDevice","releaseDevice"],properties:[]},DeviceDiscovery:{name:"DeviceDiscovery",methods:["adoptDevice","discoverDevices"],properties:[]},DeviceCreator:{name:"DeviceCreator",methods:["createDevice","getCreateDeviceSettings"],properties:[]},Battery:{name:"Battery",methods:[],properties:["batteryLevel"]},Charger:{name:"Charger",methods:[],properties:["chargeState"]},Refresh:{name:"Refresh",methods:["getRefreshFrequency","refresh"],properties:[]},MediaPlayer:{name:"MediaPlayer",methods:["getMediaStatus","load","seek","skipNext","skipPrevious"],properties:[]},Online:{name:"Online",methods:[],properties:["online"]},BufferConverter:{name:"BufferConverter",methods:["convert"],properties:["fromMimeType","toMimeType"]},Settings:{name:"Settings",methods:["getSettings","putSetting"],properties:[]},BinarySensor:{name:"BinarySensor",methods:[],properties:["binaryState"]},TamperSensor:{name:"TamperSensor",methods:[],properties:["tampered"]},PowerSensor:{name:"PowerSensor",methods:[],properties:["powerDetected"]},AudioSensor:{name:"AudioSensor",methods:[],properties:["audioDetected"]},MotionSensor:{name:"MotionSensor",methods:[],properties:["motionDetected"]},AmbientLightSensor:{name:"AmbientLightSensor",methods:[],properties:["ambientLight"]},OccupancySensor:{name:"OccupancySensor",methods:[],properties:["occupied"]},FloodSensor:{name:"FloodSensor",methods:[],properties:["flooded"]},UltravioletSensor:{name:"UltravioletSensor",methods:[],properties:["ultraviolet"]},LuminanceSensor:{name:"LuminanceSensor",methods:[],properties:["luminance"]},PositionSensor:{name:"PositionSensor",methods:[],properties:["position"]},SecuritySystem:{name:"SecuritySystem",methods:["armSecuritySystem","disarmSecuritySystem"],properties:["securitySystemState"]},PM10Sensor:{name:"PM10Sensor",methods:[],properties:["pm10Density"]},PM25Sensor:{name:"PM25Sensor",methods:[],properties:["pm25Density"]},VOCSensor:{name:"VOCSensor",methods:[],properties:["vocDensity"]},NOXSensor:{name:"NOXSensor",methods:[],properties:["noxDensity"]},CO2Sensor:{name:"CO2Sensor",methods:[],properties:["co2ppm"]},AirQualitySensor:{name:"AirQualitySensor",methods:[],properties:["airQuality"]},Readme:{name:"Readme",methods:["getReadmeMarkdown"],properties:[]},OauthClient:{name:"OauthClient",methods:["getOauthUrl","onOauthCallback"],properties:[]},MixinProvider:{name:"MixinProvider",methods:["canMixin","getMixin","releaseMixin"],properties:[]},HttpRequestHandler:{name:"HttpRequestHandler",methods:["onRequest"],properties:[]},EngineIOHandler:{name:"EngineIOHandler",methods:["onConnection"],properties:[]},PushHandler:{name:"PushHandler",methods:["onPush"],properties:[]},Program:{name:"Program",methods:["run"],properties:[]},Scriptable:{name:"Scriptable",methods:["eval","loadScripts","saveScript"],properties:[]},ObjectTracker:{name:"ObjectTracker",methods:["trackObjects"],properties:[]},ObjectDetector:{name:"ObjectDetector",methods:["getDetectionInput","getObjectTypes"],properties:[]},ObjectDetection:{name:"ObjectDetection",methods:["detectObjects","generateObjectDetections","getDetectionModel"],properties:[]},HumiditySetting:{name:"HumiditySetting",methods:["setHumidity"],properties:["humiditySetting"]},Fan:{name:"Fan",methods:["setFan"],properties:["fan"]},RTCSignalingChannel:{name:"RTCSignalingChannel",methods:["startRTCSignalingSession"],properties:[]},RTCSignalingClient:{name:"RTCSignalingClient",methods:["createRTCSignalingSession"],properties:[]},LauncherApplication:{name:"LauncherApplication",methods:[],properties:["applicationInfo"]},ScryptedUser:{name:"ScryptedUser",methods:["getScryptedUserAccessControl"],properties:[]},VideoFrameGenerator:{name:"VideoFrameGenerator",methods:["generateVideoFrames"],properties:[]}},function(e){e.Builtin="Builtin",e.Camera="Camera",e.Fan="Fan",e.Light="Light",e.Switch="Switch",e.Outlet="Outlet",e.Sensor="Sensor",e.Scene="Scene",e.Program="Program",e.Automation="Automation",e.Vacuum="Vacuum",e.Notifier="Notifier",e.Thermostat="Thermostat",e.Lock="Lock",e.PasswordControl="PasswordControl",e.Display="Display",e.SmartDisplay="SmartDisplay",e.Speaker="Speaker",e.SmartSpeaker="SmartSpeaker",e.Event="Event",e.Entry="Entry",e.Garage="Garage",e.DeviceProvider="DeviceProvider",e.DataSource="DataSource",e.API="API",e.Doorbell="Doorbell",e.Irrigation="Irrigation",e.Valve="Valve",e.Person="Person",e.SecuritySystem="SecuritySystem",e.WindowCovering="WindowCovering",e.Siren="Siren",e.Unknown="Unknown"}(t.ScryptedDeviceType||(t.ScryptedDeviceType={})),function(e){e.Humidify="Humidify",e.Dehumidify="Dehumidify",e.Auto="Auto",e.Off="Off"}(t.HumidityMode||(t.HumidityMode={})),function(e){e.Auto="Auto",e.Manual="Manual"}(t.FanMode||(t.FanMode={})),function(e){e.C="C",e.F="F"}(t.TemperatureUnit||(t.TemperatureUnit={})),function(e){e.Off="Off",e.Cool="Cool",e.Heat="Heat",e.HeatCool="HeatCool",e.Auto="Auto",e.FanOnly="FanOnly",e.Purifier="Purifier",e.Eco="Eco",e.Dry="Dry",e.On="On"}(t.ThermostatMode||(t.ThermostatMode={})),function(e){e.Absolute="Absolute",e.Relative="Relative"}(t.PanTiltZoomMovement||(t.PanTiltZoomMovement={})),function(e){e.Locked="Locked",e.Unlocked="Unlocked",e.Jammed="Jammed"}(t.LockState||(t.LockState={})),function(e){e.Trickle="trickle",e.Charging="charging",e.NotCharging="not-charging"}(t.ChargeState||(t.ChargeState={})),function(e){e.Unknown="Unknown",e.Excellent="Excellent",e.Good="Good",e.Fair="Fair",e.Inferior="Inferior",e.Poor="Poor"}(t.AirQuality||(t.AirQuality={})),function(e){e.Disarmed="Disarmed",e.HomeArmed="HomeArmed",e.AwayArmed="AwayArmed",e.NightArmed="NightArmed"}(t.SecuritySystemMode||(t.SecuritySystemMode={})),function(e){e.Sensor="Sensor",e.Occupied="Occupied",e.Time="Time",e.Error="Error"}(t.SecuritySystemObstruction||(t.SecuritySystemObstruction={})),function(e){e.Idle="Idle",e.Playing="Playing",e.Paused="Paused",e.Buffering="Buffering"}(t.MediaPlayerState||(t.MediaPlayerState={})),function(e){e.ScryptedDevice="ScryptedDevice",e.ScryptedPlugin="ScryptedPlugin",e.OnOff="OnOff",e.Brightness="Brightness",e.ColorSettingTemperature="ColorSettingTemperature",e.ColorSettingRgb="ColorSettingRgb",e.ColorSettingHsv="ColorSettingHsv",e.Notifier="Notifier",e.StartStop="StartStop",e.Pause="Pause",e.Dock="Dock",e.TemperatureSetting="TemperatureSetting",e.Thermometer="Thermometer",e.HumiditySensor="HumiditySensor",e.Camera="Camera",e.Microphone="Microphone",e.Display="Display",e.VideoCamera="VideoCamera",e.VideoRecorder="VideoRecorder",e.PanTiltZoom="PanTiltZoom",e.EventRecorder="EventRecorder",e.VideoClips="VideoClips",e.VideoCameraConfiguration="VideoCameraConfiguration",e.Intercom="Intercom",e.Lock="Lock",e.PasswordStore="PasswordStore",e.Scene="Scene",e.Entry="Entry",e.EntrySensor="EntrySensor",e.DeviceProvider="DeviceProvider",e.DeviceDiscovery="DeviceDiscovery",e.DeviceCreator="DeviceCreator",e.Battery="Battery",e.Charger="Charger",e.Refresh="Refresh",e.MediaPlayer="MediaPlayer",e.Online="Online",e.BufferConverter="BufferConverter",e.Settings="Settings",e.BinarySensor="BinarySensor",e.TamperSensor="TamperSensor",e.PowerSensor="PowerSensor",e.AudioSensor="AudioSensor",e.MotionSensor="MotionSensor",e.AmbientLightSensor="AmbientLightSensor",e.OccupancySensor="OccupancySensor",e.FloodSensor="FloodSensor",e.UltravioletSensor="UltravioletSensor",e.LuminanceSensor="LuminanceSensor",e.PositionSensor="PositionSensor",e.SecuritySystem="SecuritySystem",e.PM10Sensor="PM10Sensor",e.PM25Sensor="PM25Sensor",e.VOCSensor="VOCSensor",e.NOXSensor="NOXSensor",e.CO2Sensor="CO2Sensor",e.AirQualitySensor="AirQualitySensor",e.Readme="Readme",e.OauthClient="OauthClient",e.MixinProvider="MixinProvider",e.HttpRequestHandler="HttpRequestHandler",e.EngineIOHandler="EngineIOHandler",e.PushHandler="PushHandler",e.Program="Program",e.Scriptable="Scriptable",e.ObjectTracker="ObjectTracker",e.ObjectDetector="ObjectDetector",e.ObjectDetection="ObjectDetection",e.HumiditySetting="HumiditySetting",e.Fan="Fan",e.RTCSignalingChannel="RTCSignalingChannel",e.RTCSignalingClient="RTCSignalingClient",e.LauncherApplication="LauncherApplication",e.ScryptedUser="ScryptedUser",e.VideoFrameGenerator="VideoFrameGenerator"}(t.ScryptedInterface||(t.ScryptedInterface={})),function(e){e.Url="text/x-uri",e.InsecureLocalUrl="text/x-insecure-local-uri",e.LocalUrl="text/x-local-uri",e.PushEndpoint="text/x-push-endpoint",e.SchemePrefix="x-scrypted/x-scrypted-scheme-",e.MediaStreamUrl="text/x-media-url",e.MediaObject="x-scrypted/x-scrypted-media-object",e.RequestMediaObject="x-scrypted/x-scrypted-request-media-object",e.RequestMediaStream="x-scrypted/x-scrypted-request-stream",e.MediaStreamFeedback="x-scrypted/x-media-stream-feedback",e.FFmpegInput="x-scrypted/x-ffmpeg-input",e.FFmpegTranscodeStream="x-scrypted/x-ffmpeg-transcode-stream",e.RTCSignalingChannel="x-scrypted/x-scrypted-rtc-signaling-channel",e.RTCSignalingSession="x-scrypted/x-scrypted-rtc-signaling-session",e.RTCConnectionManagement="x-scrypted/x-scrypted-rtc-connection-management",e.Image="x-scrypted/x-scrypted-image"}(t.ScryptedMimeTypes||(t.ScryptedMimeTypes={}))},7817:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AutoenableMixinProvider=void 0;const n=r(7954),s=i(r(7954)),{systemManager:o}=s.default,a="v4";class c extends n.ScryptedDeviceBase{constructor(e){super(e),this.hasEnabledMixin={},this.unshiftMixin=!1;try{this.hasEnabledMixin=JSON.parse(this.storage.getItem("hasEnabledMixin"))}catch(e){this.hasEnabledMixin={}}this.pluginsComponent=o.getComponent("plugins"),o.listen((async(e,t,r)=>{t.eventInterface!==n.ScryptedInterface.ScryptedDevice||t.property||this.maybeEnableMixin(e)}));for(const e of Object.keys(o.getSystemState())){const t=o.getDeviceById(e);this.maybeEnableMixin(t)}}async shouldEnableMixin(e){return!0}async maybeEnableMixin(e){if(!e||e.mixins?.includes(this.id))return;if(this.hasEnabledMixin[e.id]===a)return;if(!await this.canMixin(e.type,e.interfaces))return;if(!await this.shouldEnableMixin(e))return;this.log.i("auto enabling mixin for "+e.name);const t=(e.mixins||[]).slice();this.unshiftMixin?t.unshift(this.id):t.push(this.id);const r=await this.pluginsComponent;await r.setMixins(e.id,t),this.setHasEnabledMixin(e.id)}setHasEnabledMixin(e){this.hasEnabledMixin[e]!==a&&(this.hasEnabledMixin[e]=a,this.storage.setItem("hasEnabledMixin",JSON.stringify(this.hasEnabledMixin)))}}t.AutoenableMixinProvider=c},6405:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Deferred=void 0;t.Deferred=class{constructor(){this.finished=!1,this.promise=new Promise(((e,t)=>{this.resolve=t=>(this.finished=!0,e(t),this),this.reject=e=>(this.finished=!0,t(e),this)}))}}},9934:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addVideoFilterArguments=void 0,t.addVideoFilterArguments=function(e,t,r="unfilteredRecording"){const i=e.findIndex((e=>"-filter_complex"===e));void 0!==i&&-1!==i?e[i+1]=e[i+1]+`[${r}] ; [${r}] ${t}`:e.push("-filter_complex",t)}},400:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ListenZeroSingleClientTimeoutError=t.listenZeroSingleClient=t.listenZero=t.bind=t.createBindUdp=t.reserveUdpPort=t.createBindZero=t.bindZero=t.bindUdp=t.closeQuiet=void 0;const n=r(2361),s=i(r(1891));async function o(e,t,r){e.bind(t,r),await(0,n.once)(e,"listening");const i=e.address().port;return{port:i,url:`udp://127.0.0.1:${i}`}}async function a(e){return c(0,e)}async function c(e,t){const r=s.default.createSocket(t||"udp4"),{port:i,url:n}=await o(r,e);return{server:r,port:i,url:n}}t.closeQuiet=async function(e){if(e)try{await new Promise(((t,r)=>{try{e.close(t)}catch(e){r(e)}}))}catch(e){}},t.bindUdp=o,t.bindZero=async function(e){return o(e,0)},t.createBindZero=a,t.reserveUdpPort=async function(){const e=await a();return await new Promise((t=>e.server.close((()=>t(void 0))))),e.port},t.createBindUdp=c,t.bind=async function(e,t){return e.bind(t),await(0,n.once)(e,"listening"),{port:t,url:`udp://127.0.0.1:${t}`}};var u=r(7189);Object.defineProperty(t,"listenZero",{enumerable:!0,get:function(){return u.listenZero}}),Object.defineProperty(t,"listenZeroSingleClient",{enumerable:!0,get:function(){return u.listenZeroSingleClient}}),Object.defineProperty(t,"ListenZeroSingleClientTimeoutError",{enumerable:!0,get:function(){return u.ListenZeroSingleClientTimeoutError}})},4921:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(1795),t)},2808:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createMapPromiseDebouncer=t.createPromiseDebouncer=t.timeoutFunction=t.timeoutPromise=t.TimeoutError=t.singletonPromise=void 0,t.singletonPromise=function(e,t,r=0){if(e?.promise)return e;const i=t();return e?e.promise=i:e={promise:i,cacheDuration:r},i.finally((()=>setTimeout((()=>e.promise=void 0),e.cacheDuration))),e};class r extends Error{constructor(e){super("Operation Timed Out"),this.promise=e}}t.TimeoutError=r,t.timeoutPromise=function(e,t){return new Promise(((i,n)=>{const s=setTimeout((()=>n(new r(t))),e);t.then((e=>{clearTimeout(s),i(e)})).catch((e=>{clearTimeout(s),n(e)}))}))},t.timeoutFunction=function(e,t){return new Promise(((i,n)=>{let s=!1;const o=t((()=>s)),a=setTimeout((()=>{s=!0,n(new r(o))}),e);o.then((e=>{clearTimeout(a),i(e)})).catch((e=>{clearTimeout(a),n(e)}))}))},t.createPromiseDebouncer=function(){let e;return t=>(e||(e=t().finally((()=>e=void 0))),e)},t.createMapPromiseDebouncer=function(){const e=new Map;return(t,r)=>{const i=JSON.stringify(t);let n=e.get(i);return n||(n=r().finally((()=>e.delete(i))),e.set(i,n)),n}}},6521:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readString=t.readLine=t.readUntil=t.readLength=t.StreamEndError=t.read16BELengthLoop=void 0;const i=r(2361);t.read16BELengthLoop=async function(e,t){let r;const{skipHeader:n,callback:s}=t,o=t.offset||0,a=t.headerLength||2;let c,u;e.on("error",(e=>r=e));let h=0,d=0;const l=()=>{d++,f()},f=()=>{for(;;){if(h!==d)return;if(c){const t=e.read(u);if(!t)return;s(c,t),c=void 0}else{if(c=e.read(a),!c)return;if(n?.(c,l)){h++,c=void 0;continue}u=c.readUInt16BE(o)}}};throw f(),e.on("readable",f),await(0,i.once)(e,"end"),new Error("stream ended")};class n extends Error{constructor(){super()}}async function s(e,t){if(e.readableEnded||e.destroyed)throw new Error("stream ended");if(!t)return Buffer.alloc(0);{const r=e.read(t);if(r)return r}return new Promise(((r,i)=>{const s=()=>{const n=e.read(t);if(n)return a(),void r(n);(e.readableEnded||e.destroyed)&&i(new Error("stream ended during read"))},o=()=>{a(),i(new n)},a=()=>{e.removeListener("readable",s),e.removeListener("end",o)};e.on("readable",s),e.on("end",o)}))}t.StreamEndError=n,t.readLength=s;const o="\n".charCodeAt(0);async function a(e,t){const r=[];let i=0;for(;;){const n=await s(e,1);if(!n)throw new Error("end of stream");if(n[0]===t)break;r[i++]=n[0]}return Buffer.from(r).toString()}t.readUntil=a,t.readLine=async function(e){return a(e,o)},t.readString=async function(e){let t="";return(e=await e).on("data",(e=>{t+=e.toString()})),e.resume(),await(0,i.once)(e,"end"),t}},281:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createBrowserSignalingSession=void 0;const i=r(7169),n=r(5191);t.createBrowserSignalingSession=async function(e,t,r){const s=(0,n.createRpcSerializer)({sendMessageBuffer:t=>e.send(t),sendMessageFinish:t=>e.send(JSON.stringify(t))}),o=new i.RpcPeer(t,r,((e,t,r)=>{try{s.sendMessage(e,t,r)}catch(e){t?.(e)}}));return e.addEventListener("close",(()=>o.kill("WebSocket closed"))),e.onmessage=e=>{const t=e.data;t.constructor===Buffer||t.constructor===ArrayBuffer?s.onMessageBuffer(Buffer.from(t)):s.onMessageFinish(JSON.parse(t))},s.setupRpcPeer(o),await o.getParam("session")}},566:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.connectRTCSignalingClients=t.BrowserSignalingSession=t.isPeerConnectionClosed=t.waitPeerIceConnectionClosed=t.waitPeerConnectionIceConnected=void 0;const i=r(6405);function n(){try{return navigator.userAgent}catch(e){}}function s(e){return new Promise((t=>{e.addEventListener("iceconnectionstatechange",(()=>{o(e)&&t(e.iceConnectionState)}))}))}function o(e){return"disconnected"===e.iceConnectionState||"failed"===e.iceConnectionState||"closed"===e.iceConnectionState}t.waitPeerConnectionIceConnected=function(e){return new Promise(((t,r)=>{"connected"!==e.iceConnectionState?(e.addEventListener("iceconnectionstatechange",(()=>{"connected"===e.iceConnectionState&&t(void 0)})),s(e).then((e=>r(new Error(e))))):t(void 0)}))},t.waitPeerIceConnectionClosed=s,t.isPeerConnectionClosed=o;function a(e,t,r){let i=!1,n=[];const s=function(e,t,r){return async i=>{try{"true"===localStorage.getItem("debugLog")&&e.log(`${t} trickled candidate:`,i.sdpMLineIndex,i.candidate),await r.addIceCandidate(i)}catch(t){throw e.error("addIceCandidate error",t),t}}}(e,t,r);return{flush(){i=!0;for(const e of n)s(e);n=[]},queueSendCandidate:async e=>{i?s(e):n.push(e)}}}t.BrowserSignalingSession=class{constructor(){this.pcDeferred=new i.Deferred,this.dcDeferred=new i.Deferred,this.micEnabled=!1,this.options={userAgent:n(),capabilities:{audio:RTCRtpReceiver.getCapabilities?.("audio")||{codecs:void 0,headerExtensions:void 0},video:RTCRtpReceiver.getCapabilities?.("video")||{codecs:void 0,headerExtensions:void 0}},screen:{devicePixelRatio:window.devicePixelRatio,width:screen.width,height:screen.height}}}async getOptions(){return this.options}async setMicrophone(e){if(this.microphone&&e&&!this.micEnabled){this.micEnabled=!0;const e=await navigator.mediaDevices.getUserMedia({video:!1,audio:!0});await this.microphone.replaceTrack(e.getTracks()[0])}this.microphone.track.enabled=e}close(){this.pcDeferred.promise.then((e=>{for(const t of e.getTransceivers()||[])try{t.sender?.track?.stop?.()}catch(e){}e.close()})).catch((()=>{})),this.pcDeferred.reject(new Error("iceConnectionState "+this.pc?.iceConnectionState))}async createPeerConnection(e){if(this.pc)return;const t=this.pc=new RTCPeerConnection(e.configuration);if(this.pcDeferred.resolve(t),await(this.onPeerConnection?.(t)),t.addEventListener("iceconnectionstatechange",(()=>{console.log("iceConnectionState",t.iceConnectionState),console.log("connectionState",t.connectionState),o(t)&&this.close()})),e.datachannel){const r=t.createDataChannel(e.datachannel.label,e.datachannel.dict);r.binaryType="arraybuffer",this.dcDeferred.resolve(r)}if(e.audio){let r;r=e.getUserMediaSafariHack&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?t.addTransceiver("audio",{...e.audio,streams:[await navigator.mediaDevices.getUserMedia({audio:!0})]}):t.addTransceiver("audio",e.audio),"sendrecv"!==e.audio.direction&&"sendonly"!==e.audio.direction||(this.microphone=r.sender)}if(e.video)if("sendrecv"===e.video.direction||"sendonly"===e.video.direction)try{const e=await navigator.mediaDevices.getUserMedia({video:!0});for(const r of e.getTracks())t.addTrack(r)}catch(e){}else t.addTransceiver("video",e.video)}async createLocalDescription(e,t,r){await this.createPeerConnection(t);const i=new Promise((e=>{this.pc.onicecandidate=t=>{t.candidate?r?.(JSON.parse(JSON.stringify(t.candidate))):e(void 0)},this.pc.onicegatheringstatechange=()=>{"complete"===this.pc.iceGatheringState&&e(void 0)}})),n=e=>({type:e.type,sdp:e.sdp});if("offer"===e){let e=await this.pc.createOffer({offerToReceiveAudio:!!t.audio,offerToReceiveVideo:!!t.video});const s=this.pc.setLocalDescription(e);return r||(await s,await i,e=await this.pc.createOffer({offerToReceiveAudio:!!t.audio,offerToReceiveVideo:!!t.video})),n(e)}{let e=await this.pc.createAnswer();const t=this.pc.setLocalDescription(e);return r||(await t,await i,e=this.pc.currentLocalDescription||e),n(e)}}async setRemoteDescription(e,t){await this.createPeerConnection(t),await this.pc.setRemoteDescription(e)}async addIceCandidate(e){await this.pc.addIceCandidate(e)}async endSession(){}},t.connectRTCSignalingClients=async function(e,t,r,i,n){const s=await t.getOptions(),o=await i.getOptions(),c=s?.disableTrickle||o?.disableTrickle;if(s?.offer&&o?.offer)throw new Error("Both RTC clients have offers and can not negotiate. Consider implementing this in @scrypted/webrtc.");if(s?.requiresOffer&&o?.requiresOffer)throw new Error("Both RTC clients require offers and can not negotiate.");r.type="offer",n.type="answer";const u=a(e,"offer",i),h=a(e,"answer",t),d=await t.createLocalDescription("offer",r,c?void 0:u.queueSendCandidate);"true"===localStorage.getItem("debugLog")&&e.log("offer sdp",d.sdp),await i.setRemoteDescription(d,n);const l=await i.createLocalDescription("answer",n,c?void 0:h.queueSendCandidate);"true"===localStorage.getItem("debugLog")&&e.log("answer sdp",l.sdp),await t.setRemoteDescription(l,r),h.flush(),u.flush()}},7030:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.listenSingleRtspClient=t.RtspServer=t.RtspClient=t.RtspBase=t.RtspStatusError=t.parseSemicolonDelimited=t.getFirstAuthenticateHeader=t.parseHeaders=t.createRtspParser=t.getNaluTypesInNalu=t.getNaluFragmentInformation=t.getNaluTypes=t.findH264NaluTypeInNalu=t.findH264NaluType=t.H264_NAL_TYPE_MTAP32=t.H264_NAL_TYPE_MTAP16=t.H264_NAL_TYPE_FU_B=t.H264_NAL_TYPE_FU_A=t.H264_NAL_TYPE_STAP_B=t.H264_NAL_TYPE_STAP_A=t.H264_NAL_TYPE_PPS=t.H264_NAL_TYPE_SPS=t.H264_NAL_TYPE_SEI=t.H264_NAL_TYPE_IDR=t.H264_NAL_TYPE_RESERVED31=t.H264_NAL_TYPE_RESERVED30=t.H264_NAL_TYPE_RESERVED0=t.writeMessage=t.readBody=t.readMessage=t.RTSP_FRAME_MAGIC=void 0;const a=s(r(6113)),c=r(2361),u=r(6002),h=r(9358),d=o(r(1808)),l=o(r(4404)),f=r(6405),p=r(400),y=r(2808),m=r(6521),g=r(1853),b=r(5045),v=r(7310),w=["realm","nonce"];async function S(e){let t=[];for(;;){let r=await(0,m.readLine)(e);if(r=r.trim(),!r)return t;t.push(r)}}async function _(e,t){const r=parseInt(t["content-length"]);if(r)return(0,m.readLength)(e,r)}function A(e,t,r,i,n){let s=void 0!==t?`${t}\r\n`:"";r&&(i["Content-Length"]=r.length.toString());for(const[e,t]of Object.entries(i))s+=`${e}: ${t}\r\n`;s+="\r\n",e.write(s),n?.log("rtsp outgoing message\n",s),n?.log(),r&&e.write(r)}function E(e,t){if("h264"===e.type)return C(e.chunks[e.chunks.length-1].subarray(12),t)}function C(e,r){const i=31&e[0];if(i===t.H264_NAL_TYPE_STAP_A){let t=1;for(;t<e.length;){const i=e.readUInt16BE(t);t+=2;if((31&e[t])===r)return e.subarray(t,t+i);t+=i}}else if(i===t.H264_NAL_TYPE_FU_A){const t=31&e[1],i=!!(128&e[1]);if(t===r&&i)return e.subarray(1)}else if(i===r)return e}function k(e,r=!1,i=!1){const n=new Set,s=31&e[0];if(s===t.H264_NAL_TYPE_STAP_A){n.add(t.H264_NAL_TYPE_STAP_A);let r=1;for(;r<e.length;){const t=e.readUInt16BE(r);r+=2;const i=31&e[r];n.add(i),r+=t}}else if(s===t.H264_NAL_TYPE_FU_A){n.add(t.H264_NAL_TYPE_FU_A);const s=31&e[1];if(r){!!(128&e[1])&&n.add(s)}else if(i){!!(64&e[1])&&n.add(s)}else n.add(s)}else n.add(s);return n}function T(e){const t={};for(const r of e.slice(1)){const e=r.indexOf(":");let i="";-1!==e&&(i=r.substring(e+1).trim());t[r.substring(0,e).toLowerCase()]=i}return t}function P(e){for(const t of e.slice(1)){const e=t.indexOf(":");let r="";-1!==e&&(r=t.substring(e+1).trim());if("www-authenticate"===t.substring(0,e).toLowerCase())return r}}function I(e){const t={};for(const r of e.split(";")){const[e,i]=r.split("=",2);t[e]=i}return t}t.RTSP_FRAME_MAGIC=36,t.readMessage=S,t.readBody=_,t.writeMessage=A,t.H264_NAL_TYPE_RESERVED0=0,t.H264_NAL_TYPE_RESERVED30=30,t.H264_NAL_TYPE_RESERVED31=31,t.H264_NAL_TYPE_IDR=5,t.H264_NAL_TYPE_SEI=6,t.H264_NAL_TYPE_SPS=7,t.H264_NAL_TYPE_PPS=8,t.H264_NAL_TYPE_STAP_A=24,t.H264_NAL_TYPE_STAP_B=25,t.H264_NAL_TYPE_FU_A=28,t.H264_NAL_TYPE_FU_B=29,t.H264_NAL_TYPE_MTAP16=26,t.H264_NAL_TYPE_MTAP32=27,t.findH264NaluType=E,t.findH264NaluTypeInNalu=C,t.getNaluTypes=function(e){return"h264"!==e.type?new Set:k(e.chunks[e.chunks.length-1].subarray(12))},t.getNaluFragmentInformation=function(e){const r=(31&e[0])===t.H264_NAL_TYPE_FU_A;return{fua:r,fuaStart:r&&!!(128&e[1]),fuaEnd:r&&!!(64&e[1])}},t.getNaluTypesInNalu=k,t.createRtspParser=function(e){let r;return{container:"rtsp",tcpProtocol:"rtsp://127.0.0.1/"+(0,a.randomBytes)(8).toString("hex"),inputArguments:["-rtsp_transport","tcp"],outputArguments:["-rtsp_transport","tcp",...e?.vcodec||[],...e?.acodec||[],"-f","rtsp"],findSyncFrame(e){let r,i={};const n=()=>e.slice(r);for(let n=0;n<e.length;n++){const s=e[n];"h264"===s.type?E(s,t.H264_NAL_TYPE_SPS)&&(r=n):i[s.type]=s}if(void 0!==r)return n();i={};for(let n=0;n<e.length;n++){const s=e[n];"h264"===s.type?E(s,t.H264_NAL_TYPE_IDR)&&(r=n):i[s.type]=s}return void 0!==r?n():void 0},sdp:new Promise((e=>r=e)),async*parse(e,t,i){const n=new B(e);await n.handleSetup(),r(n.sdp);for await(const{type:e,rtcp:r,header:s,packet:o}of n.handleRecord())yield{chunks:[s,o],type:`${r?"rtcp-":""}${e}`,width:t,height:i}}}},t.parseHeaders=T,t.getFirstAuthenticateHeader=P,t.parseSemicolonDelimited=I;class R extends Error{constructor(e){super(`RTSP Error: ${e.line}`),this.status=e}}t.RtspStatusError=R;class x{constructor(){}write(e,t,r){A(this.client,e,r,t,this.console)}async readMessage(){const e=await S(this.client);return this.console?.log("rtsp incoming message\n",e.join("\n")),this.console?.log(),e}}t.RtspBase=x;t.RtspClient=class extends x{constructor(e){super(),this.url=e,this.cseq=0,this.needKeepAlive=!1,this.setupOptions=new Map,this.issuedTeardown=!1,this.hasGetParameter=!0;const t=new v.URL(e),r=parseInt(t.port)||554;e.startsWith("rtsps")?this.client=l.default.connect({rejectUnauthorized:!1,port:r,host:t.hostname}):this.client=d.default.connect(r,t.hostname),this.client.on("error",(e=>{this.console?.log("client error",e)}))}async safeTeardown(){if(!this.issuedTeardown){this.issuedTeardown=!0;try{this.writeTeardown(),await(0,b.sleep)(500)}catch(e){}finally{this.client.destroy()}}}writeRequest(e,t,r,i){t=t||{};let n=this.url;r&&(r.includes("rtsp://")||r.includes("rtsps://")?n=r:n+=(n.endsWith("/")?"":"/")+r);const s=new v.URL(n);s.username="",s.password="";const o=`${e} ${s} RTSP/1.0`,a=this.cseq++;t.CSeq=a.toString(),t["User-Agent"]="Scrypted",this.wwwAuthenticate&&(t.Authorization=this.createAuthorizationHeader(e,new v.URL(n))),this.session&&(t.Session=this.session),this.write(o,t,i)}async handleDataPayload(e){if(e[0]!==t.RTSP_FRAME_MAGIC)throw new Error("RTSP Client received invalid frame magic. This may be a bug in your camera firmware. If this error persists, switch your RTSP Parser to FFmpeg or Scrypted (UDP): "+e.toString());const r=e.readUInt8(1),i=e.readUInt16BE(2),n=await(0,m.readLength)(this.client,i);this.setupOptions.get(r)?.onRtp?.(e,n)}async readDataPayload(){const e=await(0,m.readLength)(this.client,4);return this.handleDataPayload(e)}createBadHeader(e){return new Error("RTSP Client received invalid frame magic. This may be a bug in your camera firmware. If this error persists, switch your RTSP Parser to FFmpeg or Scrypted (UDP): "+e.toString())}async readLoopLegacy(){try{for(;;)this.needKeepAlive&&(this.needKeepAlive=!1,this.hasGetParameter?await this.getParameter():await this.options()),await this.readDataPayload()}catch(e){throw this.client.destroy(e),e}}async readLoop(){const e=new f.Deferred;let r,i,n;const s=async()=>{this.needKeepAlive&&(this.needKeepAlive=!1,this.hasGetParameter?this.writeGetParameter():this.writeOptions());try{for(;;){if(!r){if(r=this.client.read(4),!r)return;if(r[0]!==t.RTSP_FRAME_MAGIC){if("RTSP"!==r.toString())throw this.createBadHeader(r);this.client.unshift(r),r=void 0,this.client.removeListener("readable",s);const e=await super.readMessage();await this.readBody(T(e));this.client.on("readable",s);continue}i=r.readUInt8(1),n=r.readUInt16BE(2)}const e=this.client.read(n);if(!e)return;const o=r;r=void 0;this.setupOptions.get(i)?.onRtp?.(o,e)}}catch(t){e.reject(t),this.client.destroy()}};s(),this.client.on("readable",s),await Promise.all([(0,c.once)(this.client,"end")])}async readMessage(){for(;;){const e=await(0,m.readLength)(this.client,4);if(e[0]!==t.RTSP_FRAME_MAGIC){if("RTSP"===e.toString()){this.client.unshift(e);return await super.readMessage()}throw this.createBadHeader(e)}await this.handleDataPayload(e)}}createAuthorizationHeader(e,t){if(!this.wwwAuthenticate)throw new Error("no WWW-Authenticate found");if(this.wwwAuthenticate.includes("Basic")){return`Basic ${u.BASIC.computeHash(t)}`}const r=(0,h.parseHTTPHeadersQuotedKeyValueSet)(this.wwwAuthenticate,{indexOf:()=>0},w),i=new v.URL(this.url),n=decodeURIComponent(i.username),s=decodeURIComponent(i.password),o=new v.URL(t.toString());o.username="",o.password="";const c=a.default.createHash("md5").update(`${n}:${r.realm}:${s}`).digest("hex"),d=a.default.createHash("md5").update(`${e}:${o}`).digest("hex"),l=a.default.createHash("md5").update(`${c}:${r.nonce}:${d}`).digest("hex"),f={username:n,realm:r.realm,nonce:r.nonce,uri:o.toString(),algorithm:"MD5",response:l};return`Digest ${Object.entries(f).map((([e,t])=>{return`${e}=${t&&(r=t,`"${r.replace(/"/g,'\\"')}"`)}`;var r})).join(", ")}`}async readBody(e){return _(this.client,e)}async request(e,t,r,i,n){this.writeRequest(e,t,r,i);const s=this.requestTimeout?await(0,y.timeoutPromise)(this.requestTimeout,this.readMessage()):await this.readMessage(),o=s[0],[a,c,u]=o.split(" ",3),h=parseInt(c),d=T(s),l={line:o,code:h,version:a,reason:u};if(200!==h&&!d["www-authenticate"])throw new R(l);const f=P(s)||d["www-authenticate"];if(f){if(n)throw new Error("auth failed");return this.wwwAuthenticate=f,this.request(e,t,r,i,!0)}return{headers:d,body:await this.readBody(d),status:l}}async options(){const e=await this.request("OPTIONS",{}),t=e.headers.public;return t&&(this.hasGetParameter=t.toLowerCase().includes("get_parameter")),e}writeOptions(){return this.writeRequest("OPTIONS")}async getParameter(){return this.request("GET_PARAMETER")}writeGetParameter(){return this.writeRequest("GET_PARAMETER")}async describe(e){return this.request("DESCRIBE",{...e||{},Accept:"application/sdp"})}async setup(e,t){const r="udp"===e.type?"":"/TCP",i="udp"===e.type?"client_port":"interleaved";let n;if("tcp"===e.type)n=e.port;else{if(!e.dgram){const t=await(0,p.createBindZero)();e.dgram=t.server,this.client.on("close",(()=>(0,p.closeQuiet)(t.server)))}n=e.dgram.address().port,e.dgram.on("message",(t=>e.onRtp(void 0,t)))}t=Object.assign({Transport:`RTP/AVP${r};unicast;${i}=${n}-${n+1}`},t);const s=await this.request("SETUP",t,e.path);let o;if(s.headers.session){const e=I(s.headers.session);let t=parseInt(e.timeout);if(t){let e=setInterval((()=>this.needKeepAlive=!0),1e3*(t-5));this.client.once("close",(()=>clearInterval(e)))}this.session=s.headers.session.split(";")[0]}if(s.headers.transport){const e=s.headers.transport.match(/.*?interleaved=([0-9]+)-([0-9]+)/);if(e){const[t,r,i]=e;r&&i&&(o={begin:parseInt(r),end:parseInt(i)})}}return"tcp"===e.type&&this.setupOptions.set(o?o.begin:n,e),Object.assign({interleaved:o,options:e},s)}async play(e={},t="0.000"){return e.Range=`npt=${t}-`,this.request("PLAY",e)}writePlay(e="0.000"){const t={Range:`npt=${e}-`};return this.writeRequest("PLAY",t)}writeRtpPayload(e,t){return this.client.write(e),this.client.write(Buffer.from(t))}send(e,r){const i=Buffer.alloc(4);return i.writeUInt8(t.RTSP_FRAME_MAGIC,0),i.writeUInt8(r,1),i.writeUInt16BE(e.length,2),this.writeRtpPayload(i,e)}async pause(){return this.request("PAUSE")}async teardown(){try{return await this.request("TEARDOWN")}finally{this.client.destroy()}}writeTeardown(){this.writeRequest("TEARDOWN")}};class B{constructor(e,t,r,i){this.client=e,this.sdp=t,this.udp=r,this.checkRequest=i,this.setupTracks={},this.availableOptions=["DESCRIBE","OPTIONS","PAUSE","PLAY","SETUP","TEARDOWN","ANNOUNCE","RECORD","GET_PARAMETER"],this.session=(0,a.randomBytes)(4).toString("hex"),t&&(t=t.trim()),e instanceof d.default.Socket&&e.setNoDelay(!0)}async handleSetup(e=["play","record","teardown"]){let t=[];for(;;){let r=await(0,m.readLine)(this.client);if(r=r.trim(),r)t.push(r);else{const r=await this.headers(t);if(e.includes(r))return r;t=[]}}}async handlePlayback(){return this.handleSetup()}async handleTeardown(){return this.handleSetup()}async*handleRecord(){for(;;){const e=await(0,m.readLength)(this.client,4);if(e[0]!==t.RTSP_FRAME_MAGIC)throw new Error("RTSP Server expected frame magic but received: "+e.toString());const r=e.readUInt16BE(2),i=await(0,m.readLength)(this.client,r),n=e.readUInt8(1),s=n-n%2,o=Object.values(this.setupTracks).find((e=>e.destination===s));if(!o)throw new Error("RSTP Server received unknown channel: "+n);yield{type:o.codec,rtcp:n%2==1,header:e,packet:i}}}writeRtpPayload(e,t){return this.client.write(e),this.client.write(Buffer.from(t))}send(e,t){const r=Buffer.alloc(4);return r.writeUInt8(36,0),r.writeUInt8(t,1),r.writeUInt16BE(e.length,2),this.writeRtpPayload(r,e)}sendUdp(e,t,r){e.send(r,t,"127.0.0.1")}sendTrack(e,t,r){const i=this.setupTracks[e];return i?"udp"===i.protocol?(this.udp?this.sendUdp(r?i.rtcp:i.rtp,i.destination,t):this.console?.warn("RTSP Server UDP socket not available."),!0):this.send(t,r?i.destination+1:i.destination):(this.console?.warn("RTSP Server track not found:",e),!0)}options(e,t){const r={};r.Public=this.availableOptions.join(", "),this.respond(200,"OK",t,r)}async get_parameter(e,t){this.respond(200,"OK",t,{})}describe(e,t){const r={};r["Content-Base"]=e,r["Content-Type"]="application/sdp",this.respond(200,"OK",t,r,Buffer.from(this.sdp))}setupInterleaved(e,t,r){this.setupTracks[e.control]={control:e.control,protocol:"tcp",destination:t,codec:e.codec}}async setup(e,t){const r={};let i=t.transport;r.Session=this.session;const n=(0,g.parseSdp)(this.sdp).msections.find((t=>e.endsWith(t.control)));if(n){if(i.includes("TCP"))if(this.resolveInterleaved){const[e,t]=this.resolveInterleaved(n);this.setupInterleaved(n,e,t),i=`RTP/AVP/TCP;unicast;interleaved=${e}-${t}`}else{const e=i.match(/.*?interleaved=([0-9]+)-([0-9]+)/);if(e){const t=parseInt(e[1]),r=parseInt(e[2]);this.setupInterleaved(n,t,r)}}else{if(!this.udp)return void this.respond(461,"Unsupported Transport",t,{});const e=i.match(/.*?client_port=([0-9]+)-([0-9]+)/),[r,s,o]=e,a=await(0,p.createBindZero)(),c=await(0,p.createBindUdp)(a.port+1);this.client.on("close",(()=>(0,p.closeQuiet)(a.server))),this.client.on("close",(()=>(0,p.closeQuiet)(c.server))),this.setupTracks[n.control]={control:n.control,protocol:"udp",destination:parseInt(s),codec:n.codec,rtp:a.server,rtcp:c.server},i=i.replace("RTP/AVP/UDP","RTP/AVP").replace("RTP/AVP","RTP/AVP/UDP"),i+=`;server_port=${a.port}-${c.port}`}r.Transport=i,this.respond(200,"OK",t,r)}else this.respond(404,"Not Found",t,r)}play(e,t){const r={},i=Object.values(this.setupTracks).map((t=>`url=${e}/${t.control}`)).join(",");r["RTP-Info"]=i,r.Range="npt=now-",r.Session=this.session,this.respond(200,"OK",t,r)}async announce(e,t){const r=parseInt(t["content-length"]),i=await(0,m.readLength)(this.client,r);this.sdp=i.toString();const n={};n.Session=this.session,this.respond(200,"OK",t,n)}async record(e,t){const r={};r.Session=this.session,this.respond(200,"OK",t,r)}async teardown(e,t){const r={};r.Session=this.session,this.respond(200,"OK",t,r),this.client.destroy()}async headers(e){this.console?.log("request headers",e.join("\n"));let[t,r]=e[0].split(" ",2);t=t.toLowerCase();const i=T(e);if(this.checkRequest){let n;try{n=await this.checkRequest(t,r,i,e)}catch(e){this.console?.error("error checking request",e)}if(!n)throw this.respond(400,"Bad Request",i,{}),this.client.destroy(),new Error("check request failed")}if(this[t]&&this.availableOptions.includes(t.toUpperCase()))return await this[t](r,i),t;this.respond(400,"Bad Request",i,{})}respond(e,t,r,i,n){let s=`RTSP/1.0 ${e} ${t}\r\n`;r.cseq&&(i.CSeq=r.cseq),n&&(i["Content-Length"]=n.length.toString());for(const[e,t]of Object.entries(i))s+=`${e}: ${t}\r\n`;this.console?.log("response headers",s),s+="\r\n",this.client.write(s),n&&(this.client.write(n),this.console?.log("response body",n.toString()))}destroy(){this.client.destroy();for(const e of Object.values(this.setupTracks))(0,p.closeQuiet)(e.rtp),(0,p.closeQuiet)(e.rtcp)}}t.RtspServer=B,t.listenSingleRtspClient=async function(e){const t=e?.pathToken||a.default.randomBytes(8).toString("hex");let{url:r,clientPromise:i,server:n}=await(0,p.listenZeroSingleClient)(e?.hostname);const s="/"+t;r=r.replace("tcp:","rtsp:")+s;const o=i.then((t=>{const r=(e?.createServer||(e=>new B(e)))(t);return r.checkRequest=async(e,t,i,n)=>{r.checkRequest=void 0;return new v.URL(t).pathname===s},r}));return{url:r,rtspServerPromise:o,server:n}}},1853:(e,t)=>{"use strict";function r(e){let t=e.split("\n").map((e=>e.trim()));t=t.filter((e=>!e.includes("a=control:")));let r=0;for(let e=0;e<t.length;e++){t[e].startsWith("m=")&&(t.splice(e+1,0,"a=control:trackID="+r),r++)}return t.join("\r\n")}function i(e,t,r=["recvonly","sendrecv"]){const i=function(e){return("\n"+e).split("\nm=")}(e).filter((e=>e.startsWith(t)));for(const e of i){const t=()=>{const t=e.split("\n").map((e=>e.trim())),r="a=control:",i=t.find((e=>e.startsWith(r)));return{section:"m="+e,trackId:i.substring(r.length)}};for(const i of r)if(e.includes(`a=${i}`))return t();if(r.includes("recvonly")&&!e.includes("sendonly")&&!e.includes("inactive"))return t()}}function n(e){const t=[];for(const r of e.split(" ").slice(3)||[])t.push(parseInt(r));return t}function s(e){const t=e.split(" ");return{type:t[0].substring(2),port:parseInt(t[1]),protocol:t[2],payloadTypes:n(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.getSpsPps=t.parseSdp=t.parseMSection=t.parseRtpMap=t.parseFmtp=t.parseMLine=t.parseMLinePayloadTypes=t.findTracksByType=t.findTrackByType=t.findFmtp=t.createSdpInput=t.addTrackControls=t.replaceSectionPort=t.replacePorts=void 0,t.replacePorts=function(e,t,r){return e.replace(/c=IN .*/,"c=IN IP4 127.0.0.1").replace(/m=audio \d+/,`m=audio ${t}`).replace(/m=video \d+/,`m=video ${r}`)},t.replaceSectionPort=function(e,t,r){const i=new RegExp(`m=${t} \\d+`);return e.replace(/c=IN .*/,"c=IN IP4 127.0.0.1").replace(i,`m=${t} ${r}`)},t.addTrackControls=r,t.createSdpInput=function(e,t,i){let n=i.replace(/c=IN .*/,"c=IN IP4 127.0.0.1").replace(/m=audio \d+/,`m=audio ${e}`).replace(/m=video \d+/,`m=video ${t}`),s=n.split("\n").map((e=>e.trim()));return s=s.filter((e=>!e.includes("a=rtcp-mux"))).filter((e=>!e.includes("a=candidate"))).filter((e=>!e.includes("a=ice"))),n=s.join("\r\n"),n=r(n),n=n.split("m=").slice(1).map((e=>"m="+e)).join(""),n},t.findFmtp=function(e,t){let r=e.split("\n").map((e=>e.trim()));const i=new RegExp(`a=rtpmap:(\\d+) ${t}`);return r.map((e=>e.match(i))).filter((e=>!!e)).map((e=>{const t=parseInt(e[1]),i=`a=fmtp:${t} `,n=r.find((e=>e.startsWith(i)))?.substring(i.length);return{payloadType:t,fmtp:n}}))},t.findTrackByType=i,t.findTracksByType=function(e,t=["recvonly","sendrecv"]){return{audio:i(e,"audio",t)?.trackId,video:i(e,"video",t)?.trackId}},t.parseMLinePayloadTypes=n,t.parseMLine=s;function o(e){return e.filter((e=>e.startsWith("a=fmtp"))).map((e=>{const t=e.indexOf(" ");if(-1===t)return;const r=e.substring(0,t),i=e.substring(t+1),n=parseInt(r.split(":")[1]);if(!r||!i||Number.isNaN(n))return;const s={};return i.split(";").map((e=>e.trim())).forEach((e=>{const[t,...r]=e.split("=");s[t]=r.join("=")})),{payloadType:n,parameters:s}})).filter((e=>!!e))}function a(e,t){const r=t?.match(/a=rtpmap:([\d]+) (.*?)\/([\d]+)/);let i;return t=t?.toLowerCase(),t?.includes("mpeg4")?i="aac":t?.includes("opus")?i="opus":t?.includes("pcma")?i="pcm_alaw":t?.includes("pcmu")?i="pcm_ulaw":t?.includes("pcm")?i="pcm":t?.includes("h264")?i="h264":t?.includes("h265")?i="h265":t||"audio"!==e||(i="pcm_alaw"),{line:t,codec:i,rawCodec:r?.[2],clock:parseInt(r?.[3]),payloadType:parseInt(r?.[1])}}t.parseFmtp=o,t.parseRtpMap=a;const c="a=control:",u="a=rtpmap:";function h(e){const t=e.find((e=>e.startsWith(c)))?.substring(c.length),r=e.find((e=>e.startsWith(u))),i=s(e[0]);let n=a(i.type,r).codec;const h=e.filter((e=>e.startsWith(u))).map((e=>a(i.type,e)));let d;for(const t of["sendonly","sendrecv","recvonly","inactive"]){if(e.find((e=>e==="a="+t))){d=t;break}}const l={...i,fmtp:o(e),lines:e,rtpmaps:h,contents:e.join("\r\n"),control:t,codec:n,direction:d,toSdp:()=>l.lines.join("\r\n")};return l}t.parseMSection=h,t.parseSdp=function(e){const t=e.split("\n").map((e=>e.trim())),r=[],i=[];let n;for(const e of t)e.startsWith("m=")&&(n&&i.push(n),n=[]),n?n.push(e):r.push(e);n&&i.push(n);const s={header:{lines:r,contents:r.join("\r\n")},msections:i.map(h),toSdp:()=>[...s.header.lines,...s.msections.map((e=>e.lines)).flat()].join("\r\n")};return s},t.getSpsPps=function(e){const t=e?.fmtp?.[0]?.parameters?.["sprop-parameter-sets"]?.split(",");if(2!==t?.length)return{sps:void 0,pps:void 0};const[r,i]=t;return{sps:Buffer.from(r,"base64"),pps:Buffer.from(i,"base64")}}},6219:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SettingsMixinDeviceBase=void 0;const n=r(7954),s=i(r(7954)),{deviceManager:o}=s.default;class a extends n.MixinDeviceBase{constructor(e){super(e),this.settingsGroup=e.group,this.settingsGroupKey=e.groupKey,process.nextTick((()=>o.onMixinEvent(this.id,this,n.ScryptedInterface.Settings,null)))}async getSettings(){const e=this.mixinDeviceInterfaces.includes(n.ScryptedInterface.Settings)?this.mixinDevice.getSettings():void 0,t=this.getMixinSettings(),r=[];try{const t=await e||[];r.push(...t)}catch(e){const t=this.name,i=`${t} Extension settings failed to load.`;this.console.error(i,e),r.push({key:Math.random().toString(),title:t,value:"Settings Error",group:"Errors",description:i,readonly:!0})}try{const e=await t||[];for(const t of e)t.group=t.group||this.settingsGroup,t.key=this.settingsGroupKey+":"+t.key;r.push(...e)}catch(e){const t=o.getDeviceState(this.mixinProviderNativeId).name,i=`${t} Extension settings failed to load.`;this.console.error(i,e),r.push({key:Math.random().toString(),title:t,value:"Settings Error",group:"Errors",description:i,readonly:!0})}return r}async putSetting(e,t){const r=this.settingsGroupKey+":";if(!e?.startsWith(r))return this.mixinDevice.putSetting(e,t);await this.putMixinSetting(e.substring(r.length),t)||o.onMixinEvent(this.id,this,n.ScryptedInterface.Settings,null)}async release(){await o.onMixinEvent(this.id,this,n.ScryptedInterface.Settings,null)}}t.SettingsMixinDeviceBase=a},5045:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(9413),t)},6906:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.deepMerge=void 0;const n=i(r(2158));t.deepMerge=(e,t)=>(0,n.default)(e,t,((e,t)=>null!=t?t:e))},9618:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BitStream=t.buffer2ArrayBuffer=t.dumpBuffer=t.BufferChain=t.bufferReader=t.bufferWriterLE=t.createBufferWriter=t.bufferWriter=t.paddingBits=t.paddingByte=t.getBit=t.BitWriter2=t.BitWriter=t.bufferArrayXor=t.bufferXor=t.random32=t.random16=void 0;const i=r(6113),n=r(239);t.random16=function(){return n.jspack.Unpack("!H",(0,i.randomBytes)(2))[0]},t.random32=function(){return n.jspack.Unpack("!L",(0,i.randomBytes)(4))[0]},t.bufferXor=function(e,t){if(e.length!==t.length)throw new TypeError("[webrtc-stun] You can not XOR buffers which length are different");const r=e.length,i=Buffer.allocUnsafe(r);for(let n=0;n<r;n++)i[n]=e[n]^t[n];return i},t.bufferArrayXor=function(e){const t=[...e].sort(((e,t)=>e.length-t.length)).reverse()[0].length,r=Buffer.allocUnsafe(t);for(let i=0;i<t;i++)r[i]=0,e.forEach((e=>{r[i]^=e[i]??0}));return r};t.BitWriter=class{constructor(e){this.bitLength=e,this.value=0}set(e,t,r){return r&=(1<<e)-1,this.value|=r<<this.bitLength-e-t,this}get buffer(){const e=Math.ceil(this.bitLength/8),t=Buffer.alloc(e);return t.writeUIntBE(this.value,0,e),t}};function s(e,t){const r=e.reduce(((e,t)=>e+t),0),i=t?Buffer.alloc(r):void 0;return t=>{const n=i||Buffer.alloc(r);let s=0;return t.forEach(((t,r)=>{const i=e[r];8===i?n.writeBigUInt64BE(t,s):n.writeUIntBE(t,s,i),s+=i})),n}}t.BitWriter2=class{constructor(e){if(this.bitLength=e,this._value=0n,this.offset=0n,e>32)throw new Error}set(e,t=1){let r=BigInt(e);const i=BigInt(t);return r&=(1n<<i)-1n,this._value|=r<<BigInt(this.bitLength)-i-this.offset,this.offset+=i,this}get value(){return Number(this._value)}get buffer(){const e=Math.ceil(this.bitLength/8),t=Buffer.alloc(e);return t.writeUIntBE(this.value,0,e),t}},t.getBit=function(e,t,r=1){let i=e.toString(2).split("");i=[...Array(8-i.length).fill("0"),...i];const n=i.slice(t,t+r).join("");return parseInt(n,2)},t.paddingByte=function(e){const t=e.toString(2).split("");return[...[...Array(8-t.length)].map((()=>"0")),...t].join("")},t.paddingBits=function(e,t){const r=e.toString(2);return[...[...Array(t-r.length)].map((()=>"0")),...r].join("")},t.bufferWriter=function(e,t){return s(e)(t)},t.createBufferWriter=s,t.bufferWriterLE=function(e,t){const r=e.reduce(((e,t)=>e+t),0),i=Buffer.alloc(r);let n=0;return t.forEach(((t,r)=>{const s=e[r];8===s?i.writeBigUInt64LE(t,n):i.writeUIntLE(t,n,s),n+=s})),i},t.bufferReader=function(e,t){let r=0;return t.map((t=>{let i;return i=8===t?e.readBigUInt64BE(r):e.readUIntBE(r,t),r+=t,i}))};t.BufferChain=class{constructor(e){this.buffer=Buffer.alloc(e)}writeInt16BE(e,t){return this.buffer.writeInt16BE(e,t),this}writeUInt8(e,t){return this.buffer.writeUInt8(e,t),this}};t.dumpBuffer=e=>"0x"+e.toString("hex").replace(/(.)(.)/g,"$1$2 ").split(" ").filter((e=>null!=e&&e.length>0)).join(",0x"),t.buffer2ArrayBuffer=function(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)};t.BitStream=class{constructor(e){this.uint8Array=e,this.position=0,this.bitsPending=0}writeBits(e,t){if(0==e)return this;let r;return t&=4294967295>>>32-e,this.bitsPending>0?this.bitsPending>e?(this.uint8Array[this.position-1]|=t<<this.bitsPending-e,r=e,this.bitsPending-=e):this.bitsPending==e?(this.uint8Array[this.position-1]|=t,r=e,this.bitsPending=0):(this.uint8Array[this.position-1]|=t>>e-this.bitsPending,r=this.bitsPending,this.bitsPending=0):(r=Math.min(8,e),this.bitsPending=8-r,this.uint8Array[this.position++]=t>>e-r<<this.bitsPending),(e-=r)>0&&this.writeBits(e,t),this}readBits(e,t){if(void 0===t&&(t=0),0==e)return t;let r,i;if(this.bitsPending>0){const t=this.uint8Array[this.position-1]&255>>8-this.bitsPending;i=Math.min(this.bitsPending,e),this.bitsPending-=i,r=t>>this.bitsPending}else i=Math.min(8,e),this.bitsPending=8-i,r=this.uint8Array[this.position++]>>this.bitsPending;return t=t<<i|r,(e-=i)>0?this.readBits(e,t):t}seekTo(e){this.position=e/8|0,this.bitsPending=e%8,this.bitsPending>0&&(this.bitsPending=8-this.bitsPending,this.position++)}}},680:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(9618),t),n(r(1835),t),n(r(9580),t),n(r(2103),t),n(r(6906),t),n(r(659),t),n(r(3382),t)},3382:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WeriftError=void 0;class r extends Error{constructor(e){super(e.message)}toJSON(){return{message:this.message,payload:JSON.parse(JSON.stringify(this.payload)),path:this.path}}}t.WeriftError=r},2103:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findPort=t.randomPorts=t.randomPort=t.interfaceAddress=void 0;const i=r(1891);async function n(e="udp4",r){const n=(0,i.createSocket)(e);setImmediate((()=>n.bind({port:0,address:(0,t.interfaceAddress)(e,r)}))),await new Promise((e=>{n.once("error",e),n.once("listening",e)}));const s=n.address()?.port;return await new Promise((e=>n.close((()=>e())))),s}t.interfaceAddress=(e,t)=>t?t[e]:void 0,t.randomPort=n,t.randomPorts=async function(e,t="udp4",r){return Promise.all([...Array(e)].map((()=>n(t,r))))},t.findPort=async function(e,r,n="udp4",s){let o;for(let a=e;a<=r;a++){const c=(0,i.createSocket)(n);setImmediate((()=>c.bind({port:a,address:(0,t.interfaceAddress)(n,s)})));if(await new Promise((e=>{c.once("error",(t=>e(t))),c.once("listening",(()=>e()))})))await new Promise((e=>c.close((()=>e()))));else if(o=c.address()?.port,await new Promise((e=>c.close((()=>e())))),e<=o&&o<=r)break}if(!o)throw new Error("port not found");return o}},1835:(e,t)=>{"use strict";function r(e,t){return e<t&&t-e>32768||e>t&&e-t<32768}function i(e,t){const r=2147483648;return e<t&&t-e>r||e>t&&e-t<r}Object.defineProperty(t,"__esModule",{value:!0}),t.int=t.uint32Gte=t.uint32Gt=t.uint16Gte=t.uint16Gt=t.uint24=t.uint32Add=t.uint16Add=t.uint8Add=void 0,t.uint8Add=function(e,t){return e+t&255},t.uint16Add=function(e,t){return e+t&65535},t.uint32Add=function(e,t){return Number(BigInt(e)+BigInt(t)&0xffffffffn)},t.uint24=function(e){return 16777215&e},t.uint16Gt=r,t.uint16Gte=function(e,t){return e===t||r(e,t)},t.uint32Gt=i,t.uint32Gte=function(e,t){return e===t||i(e,t)};t.int=e=>parseInt(e,10)},9580:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseQueue=void 0;t.PromiseQueue=class{constructor(){this.queue=[],this.running=!1,this.push=e=>new Promise(((t,r)=>{this.queue.push({promise:e,done:t,failed:r}),this.running||this.run()}))}async run(){const e=this.queue.shift();if(e){this.running=!0;try{const t=await e.promise();e.done(t)}catch(t){e.failed(t)}this.run()}else this.running=!1}}},659:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},6759:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SignatureScheme=t.CurveType=t.NamedCurveAlgorithmList=t.NamedCurveAlgorithm=t.CipherSuiteList=t.CipherSuite=t.HashAlgorithm=t.SignatureAlgorithm=void 0,t.SignatureAlgorithm={rsa_1:1,ecdsa_3:3},t.HashAlgorithm={sha256_4:4},t.CipherSuite={TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_49195:49195,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256_49199:49199},t.CipherSuiteList=Object.values(t.CipherSuite),t.NamedCurveAlgorithm={x25519_29:29,secp256r1_23:23},t.NamedCurveAlgorithmList=Object.values(t.NamedCurveAlgorithm),t.CurveType={named_curve_3:3},t.SignatureScheme={rsa_pkcs1_sha256:1025,ecdsa_secp256r1_sha256:1027}},1470:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createAEADCipher=t.createCipher=void 0;const n=r(2845),s=i(r(4398)),o=49195,a=49196,c=49199,u=49200,h=156,d=157,l=168,f=169,p=53249,y=53250,m={K_LEN:16,N_MIN:12,N_MAX:12,P_MAX:2**36-31,A_MAX:2**53-1,C_MAX:2**36-15},g={K_LEN:32,N_MIN:12,N_MAX:12,P_MAX:2**36-31,A_MAX:2**53-1,C_MAX:2**36-15},b=(0,n.createRSAKeyExchange)(),v=(0,n.createECDHERSAKeyExchange)(),w=(0,n.createECDHEECDSAKeyExchange)(),S=(0,n.createPSKKeyExchange)(),_=(0,n.createECDHEPSKKeyExchange)();function A(e,t,r,i,n,o="sha256"){const a=new s.default;return a.id=e,a.name=t,a.blockAlgorithm=r,a.kx=i,a.hashAlgorithm=o,a.keyLength=n.K_LEN,a.nonceLength=n.N_MAX,a.nonceImplicitLength=4,a.nonceExplicitLength=8,a.ivLength=a.nonceImplicitLength,a.authTagLength=16,a}t.createCipher=function(e){switch(e){case h:return A(h,"TLS_RSA_WITH_AES_128_GCM_SHA256","aes-128-gcm",b,m);case d:return A(d,"TLS_RSA_WITH_AES_256_GCM_SHA384","aes-256-gcm",b,g,"sha384");case c:return A(c,"TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256","aes-128-gcm",v,m);case u:return A(u,"TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384","aes-256-gcm",v,g,"sha384");case o:return A(o,"TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256","aes-128-gcm",w,m);case a:return A(a,"TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384","aes-256-gcm",w,g,"sha384");case l:return A(l,"TLS_PSK_WITH_AES_128_GCM_SHA256","aes-128-gcm",S,m,"sha256");case f:return A(f,"TLS_PSK_WITH_AES_256_GCM_SHA384","aes-256-gcm",S,g,"sha384");case p:return A(p,"TLS_ECDHE_PSK_WITH_AES_128_GCM_SHA256","aes-128-gcm",_,m,"sha256");case y:return A(y,"TLS_ECDHE_PSK_WITH_AES_256_GCM_SHA384","aes-256-gcm",_,g,"sha384")}return null},t.createAEADCipher=A},2845:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createECDHEPSKKeyExchange=t.createPSKKeyExchange=t.createNULLKeyExchange=t.createECDHEECDSAKeyExchange=t.createECDHERSAKeyExchange=t.createRSAKeyExchange=t.KeyExchange=void 0;const r=0,i=1,n=0,s=1,o=2,a=3,c=0,u=1,h=2,d=3,l=4,f=5;class p{constructor(){this.id=0}toString(){return this.name}}t.KeyExchange=p,t.createRSAKeyExchange=function(){const e=new p;return e.id=u,e.name="RSA",e.keyType=s,e},t.createECDHERSAKeyExchange=function(){const e=new p;return e.id=h,e.name="ECDHE_RSA",e.signType=i,e.keyType=s,e},t.createECDHEECDSAKeyExchange=function(){const e=new p;return e.id=d,e.name="ECDHE_ECDSA",e.signType=i,e.keyType=o,e},t.createNULLKeyExchange=function(){const e=new p;return e.id=c,e.name="NULL",e.signType=r,e.keyType=n,e},t.createPSKKeyExchange=function(){const e=new p;return e.id=l,e.name="PSK",e.signType=r,e.keyType=a,e},t.createECDHEPSKKeyExchange=function(){const e=new p;return e.id=f,e.name="ECDHE_PSK",e.signType=i,e.keyType=a,e}},2113:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.generateKeyPair=void 0;const o=r(4676),a=s(r(9698)),c=r(6759);t.generateKeyPair=function(e){switch(e){case c.NamedCurveAlgorithm.secp256r1_23:{const t=new o.ec("p256").genKeyPair();return{curve:e,privateKey:t.getPrivate().toBuffer("be"),publicKey:Buffer.from(t.getPublic().encode("array",!1))}}case c.NamedCurveAlgorithm.x25519_29:{const t=a.box.keyPair();return{curve:e,privateKey:Buffer.from(t.secretKey.buffer),publicKey:Buffer.from(t.publicKey.buffer)}}default:throw new Error}}},7184:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.prfEncryptionKeys=t.prfVerifyDataServer=t.prfVerifyDataClient=t.prfVerifyData=t.hash=t.exportKeyingMaterial=t.prfExtendedMasterSecret=t.prfMasterSecret=t.prfPHash=t.hmac=t.prfPreMasterSecret=void 0;const o=r(4756),a=r(6113),c=r(4676),u=s(r(9698)),h=r(6759);function d(e,t,r){const i=(0,a.createHmac)(e,t);return i.update(r),i.digest()}function l(e,t,r,i="sha256"){const n=r,s=[];let o=t;do{o=d(i,e,o);const n=d(i,e,Buffer.concat([o,t]));s.push(n),r-=n.length}while(r>0);return Buffer.concat(s,n)}function f(e,t){return(0,a.createHash)(e).update(t).digest()}function p(e,t,r,i=12){const n=f("sha256",t);return l(e,Buffer.concat([Buffer.from(r),n]),i)}t.prfPreMasterSecret=function(e,t,r){switch(r){case h.NamedCurveAlgorithm.secp256r1_23:const r=new c.ec("p256"),i=r.keyFromPublic(e).getPublic(),n=r.keyFromPrivate(t).getPrivate(),s=i.mul(n);return Buffer.from(s.encode("array",!1)).slice(1,33);case h.NamedCurveAlgorithm.x25519_29:return Buffer.from(u.scalarMult(t,e));default:throw new Error}},t.hmac=d,t.prfPHash=l,t.prfMasterSecret=function(e,t,r){return l(e,Buffer.concat([Buffer.from("master secret"),t,r]),48)},t.prfExtendedMasterSecret=function(e,t){const r=f("sha256",t);return l(e,Buffer.concat([Buffer.from("extended master secret"),r]),48)},t.exportKeyingMaterial=function(e,t,r,i,n,s){const o=s?i:n,a=s?n:i;return l(r,Buffer.concat([Buffer.from(e),o,a]),t)},t.hash=f,t.prfVerifyData=p,t.prfVerifyDataClient=function(e,t){return p(e,t,"client finished")},t.prfVerifyDataServer=function(e,t){return p(e,t,"server finished")},t.prfEncryptionKeys=function(e,t,r,i,n,s,a="sha256"){const c=2*i+2*n,u=e,h=Buffer.concat([r,t]),d=l(u,Buffer.concat([Buffer.from("key expansion"),h]),c,a),f=(0,o.createDecode)(d),p=f.readBuffer(i),y=f.readBuffer(i),m=f.readBuffer(n),g=f.readBuffer(n),b=Buffer.alloc(s,0),v=Buffer.alloc(s,0);return m.copy(b,0),g.copy(v,0),{clientWriteKey:p,serverWriteKey:y,clientNonce:b,serverNonce:v}}},8263:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SessionType=void 0,t.SessionType={CLIENT:1,SERVER:2};t.default=class{constructor(){this.id=0,this.verifyDataLength=12}init(...e){throw new Error("not implemented")}encrypt(...e){throw new Error("not implemented")}decrypt(...e){throw new Error("not implemented")}toString(){return this.name}}},4398:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(r(6113)),c=o(r(5493)),u=r(560),h=r(7184),d=s(r(8263)),{createDecode:l,encode:f,types:{uint8:p,uint16be:y,uint48be:m}}=r(4756),g={epoch:y,sequence:m,type:p,version:y,length:y},b=(0,c.default)("werift-dtls : packages/dtls/src/cipher/suites/aead.ts : err");class v extends d.default{constructor(){super(),this.keyLength=0,this.nonceLength=0,this.ivLength=0,this.authTagLength=0,this.nonceImplicitLength=0,this.nonceExplicitLength=0}get summary(){return(0,u.getObjectSummary)(this)}init(e,t,r){const i=(0,h.prfEncryptionKeys)(e,r,t,this.keyLength,this.ivLength,this.nonceLength,this.hashAlgorithm);this.clientWriteKey=i.clientWriteKey,this.serverWriteKey=i.serverWriteKey,this.clientNonce=i.clientNonce,this.serverNonce=i.serverNonce}encrypt(e,t,r){const i=e===d.SessionType.CLIENT,n=i?this.clientNonce:this.serverNonce,s=i?this.clientWriteKey:this.serverWriteKey;if(!n||!s)throw new Error;n.writeUInt16BE(r.epoch,this.nonceImplicitLength),n.writeUIntBE(r.sequenceNumber,this.nonceImplicitLength+2,6);const o=n.slice(this.nonceImplicitLength),c={epoch:r.epoch,sequence:r.sequenceNumber,type:r.type,version:r.version,length:t.length},u=f(c,g).slice(),h=a.createCipheriv(this.blockAlgorithm,s,n,{authTagLength:this.authTagLength});h.setAAD(u,{plaintextLength:t.length});const l=h.update(t),p=h.final(),y=h.getAuthTag();return Buffer.concat([o,l,p,y])}decrypt(e,t,r){const i=e===d.SessionType.CLIENT,n=i?this.serverNonce:this.clientNonce,s=i?this.serverWriteKey:this.clientWriteKey;if(!n||!s)throw new Error;const o=l(t);o.readBuffer(this.nonceExplicitLength).copy(n,this.nonceImplicitLength);const c=o.readBuffer(o.length-this.authTagLength),h=o.readBuffer(this.authTagLength),p={epoch:r.epoch,sequence:r.sequenceNumber,type:r.type,version:r.version,length:c.length},y=f(p,g).slice(),m=a.createDecipheriv(this.blockAlgorithm,s,n,{authTagLength:this.authTagLength});m.setAuthTag(h),m.setAAD(y,{plaintextLength:c.length});const v=m.update(c);try{const e=m.final();return e.length>0?Buffer.concat([v,e]):v}catch(i){throw b("decrypt failed",i,e,(0,u.dumpBuffer)(t),r,this.summary),i}}}t.default=v},853:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DtlsClient=void 0;const n=i(r(5493)),s=r(8263),o=r(4817),a=r(3495),c=r(9925),u=r(9549),h=r(1039),d=r(9969),l=(0,n.default)("werift-dtls : packages/dtls/src/client.ts : log");class f extends d.DtlsSocket{constructor(e){super(e,s.SessionType.CLIENT),this.handleHandshakes=async e=>{l(this.dtls.sessionId,"handleHandshakes",e.map((e=>e.msg_type)));for(const t of e)switch(t.msg_type){case u.HandshakeType.hello_verify_request_3:{const e=h.ServerHelloVerifyRequest.deSerialize(t.fragment);await new a.Flight3(this.transport,this.dtls).exec(e)}break;case u.HandshakeType.server_hello_2:if(this.connected)return;this.flight5=new c.Flight5(this.transport,this.dtls,this.cipher,this.srtp),this.flight5.handleHandshake(t);break;case u.HandshakeType.certificate_11:case u.HandshakeType.server_key_exchange_12:case u.HandshakeType.certificate_request_13:await this.waitForReady((()=>!!this.flight5)),this.flight5?.handleHandshake(t);break;case u.HandshakeType.server_hello_done_14:{await this.waitForReady((()=>!!this.flight5)),this.flight5?.handleHandshake(t);const e=[11,12,this.options.certificateRequest&&13].filter((e=>"number"==typeof e));await this.waitForReady((()=>this.dtls.checkHandshakesExist(e))),await(this.flight5?.exec())}break;case u.HandshakeType.finished_20:this.dtls.flight=7,this.connected=!0,this.onConnect.execute(),l(this.dtls.sessionId,"dtls connected")}},this.onHandleHandshakes=this.handleHandshakes,l(this.dtls.sessionId,"start client")}async connect(){await new o.Flight1(this.transport,this.dtls,this.cipher).exec(this.extensions)}}t.DtlsClient=f},2692:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CipherContext=void 0;const a=r(8644),c=r(4058),u=s(r(7091)),h=r(4756),d=s(r(6113)),l=o(r(6585)),f=r(6759),p=r(7184),y=r(8263),m=r(5599),g=new c.Crypto;u.cryptoProvider.set(g);class b{constructor(e,t,r,i){this.sessionType=e,this.certPem=t,this.keyPem=r,t&&r&&i&&this.parseX509(t,r,i)}encryptPacket(e){const t=e.recordLayerHeader,r=this.cipher.encrypt(this.sessionType,e.fragment,{type:t.contentType,version:(0,h.decode)(Buffer.from((0,h.encode)(t.protocolVersion,m.ProtocolVersion).slice()),{version:h.types.uint16be}).version,epoch:t.epoch,sequenceNumber:t.sequenceNumber});return e.fragment=r,e.recordLayerHeader.contentLen=r.length,e}decryptPacket(e){const t=e.recordLayerHeader;return this.cipher.decrypt(this.sessionType,e.fragment,{type:t.contentType,version:(0,h.decode)(Buffer.from((0,h.encode)(t.protocolVersion,m.ProtocolVersion).slice()),{version:h.types.uint16be}).version,epoch:t.epoch,sequenceNumber:t.sequenceNumber})}verifyData(e){return this.sessionType===y.SessionType.CLIENT?(0,p.prfVerifyDataClient)(this.masterSecret,e):(0,p.prfVerifyDataServer)(this.masterSecret,e)}signatureData(e,t){const r=(0,d.createSign)(t).update(e),i=this.localPrivateKey.toPEM().toString();return r.sign(i)}generateKeySignature(e){const t=this.sessionType===y.SessionType.CLIENT?this.localRandom:this.remoteRandom,r=this.sessionType===y.SessionType.SERVER?this.localRandom:this.remoteRandom,i=this.valueKeySignature(t.serialize(),r.serialize(),this.localKeyPair.publicKey,this.namedCurve);return this.localPrivateKey.sign(i,e)}parseX509(e,t,r){const i=a.Certificate.fromPEM(Buffer.from(e)),n=a.PrivateKey.fromPEM(Buffer.from(t));this.localCert=i.raw,this.localPrivateKey=n,this.signatureHashAlgorithm=r}valueKeySignature(e,t,r,i){const n=Buffer.from((0,h.encode)({type:f.CurveType.named_curve_3,curve:i,len:r.length},{type:h.types.uint8,curve:h.types.uint16be,len:h.types.uint8}).slice());return Buffer.concat([e,t,n,r])}}t.CipherContext=b,b.createSelfSignedCertificateWithKey=async(e,t)=>{const r=(()=>{switch(e.signature){case f.SignatureAlgorithm.rsa_1:return"RSASSA-PKCS1-v1_5";case f.SignatureAlgorithm.ecdsa_3:return"ECDSA"}})(),i=(()=>{if(e.hash===f.HashAlgorithm.sha256_4)return"SHA-256"})(),n=(()=>{switch(t){case f.NamedCurveAlgorithm.secp256r1_23:return"P-256";case f.NamedCurveAlgorithm.x25519_29:return"ECDSA"===r?"P-256":"X25519";default:if("ECDSA"===r)return"P-256";if("RSASSA-PKCS1-v1_5"===r)return"X25519"}})(),s=(()=>{switch(r){case"ECDSA":return{name:r,hash:i,namedCurve:n};case"RSASSA-PKCS1-v1_5":return{name:r,hash:i,publicExponent:new Uint8Array([1,0,1]),modulusLength:2048}}})(),o=await g.subtle.generateKey(s,!0,["sign","verify"]);return{certPem:(await u.X509CertificateGenerator.createSelfSigned({serialNumber:d.default.randomBytes(8).toString("hex"),name:"C=AU, ST=Some-State, O=Internet Widgits Pty Ltd",notBefore:new Date,notAfter:(0,l.default)(Date.now(),10),signingAlgorithm:s,keys:o})).toString("pem"),keyPem:u.PemConverter.encode(await g.subtle.exportKey("pkcs8",o.privateKey),"private key"),signatureHash:e}}},6608:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DtlsContext=void 0;const i=(0,r(5493).debug)("werift-dtls : packages/dtls/src/context/dtls.ts : log");t.DtlsContext=class{constructor(e,t){this.options=e,this.sessionType=t,this.version={major:254,minor:253},this.lastFlight=[],this.lastMessage=[],this.recordSequenceNumber=0,this.sequenceNumber=0,this.epoch=0,this.flight=0,this.handshakeCache={},this.requestedCertificateTypes=[],this.requestedSignatureAlgorithms=[],this.remoteExtendedMasterSecret=!1,this.checkHandshakesExist=e=>!e.find((e=>null==this.sortedHandshakeCache.find((t=>t.msg_type===e))))}get sessionId(){return this.cookie?this.cookie.toString("hex").slice(0,10):""}get sortedHandshakeCache(){return Object.entries(this.handshakeCache).sort((([e],[t])=>Number(e)-Number(t))).map((([,{data:e}])=>e.sort(((e,t)=>e.message_seq-t.message_seq)))).flatMap((e=>e))}bufferHandshakeCache(e,t,r){this.handshakeCache[r]||(this.handshakeCache[r]={data:[],isLocal:t,flight:r});const n=e.filter((e=>{const n=this.handshakeCache[r].data.find((t=>t.msg_type===e.msg_type));return!n||(i(this.sessionId,"exist",n.summary,t,r),!1)}));this.handshakeCache[r].data=[...this.handshakeCache[r].data,...n]}}},250:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Profiles=t.ProtectionProfileAeadAes128Gcm=t.ProtectionProfileAes128CmHmacSha1_80=t.SrtpContext=void 0;t.SrtpContext=class{static findMatchingSRTPProfile(e,t){for(const r of t)if(e.includes(r))return r}},t.ProtectionProfileAes128CmHmacSha1_80=1,t.ProtectionProfileAeadAes128Gcm=7,t.Profiles=[t.ProtectionProfileAes128CmHmacSha1_80,t.ProtectionProfileAeadAes128Gcm]},8793:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TransportContext=void 0;t.TransportContext=class{constructor(e){this.socket=e,this.send=e=>this.socket.send(e)}}},4817:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Flight1=void 0;const i=r(6759),n=r(5536),s=r(3491),o=r(8634);class a extends o.Flight{constructor(e,t,r){super(e,t,1,3),this.cipher=r}async exec(e){if(1===this.dtls.flight)throw new Error;this.dtls.flight=1;const t=new n.ClientHello({major:254,minor:253},new s.DtlsRandom,Buffer.from([]),Buffer.from([]),i.CipherSuiteList,[0],e);this.dtls.version=t.clientVersion,this.cipher.localRandom=s.DtlsRandom.from(t.random);const r=this.createPacket([t]),o=Buffer.concat(r.map((e=>e.serialize())));await this.transmit([o])}}t.Flight1=a},3495:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Flight3=void 0;const i=r(8634);class n extends i.Flight{constructor(e,t){super(e,t,3,5)}async exec(e){if(3===this.dtls.flight)throw new Error;this.dtls.flight=3,this.dtls.handshakeCache=[];const[t]=this.dtls.lastFlight;t.cookie=e.cookie,this.dtls.cookie=e.cookie;const r=this.createPacket([t]),i=Buffer.concat(r.map((e=>e.serialize())));await this.transmit([i])}}t.Flight3=n},9925:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Flight5=void 0;const n=i(r(5493)),s=r(6759),o=r(1470),a=r(2113),c=r(7184),u=r(250),h=r(9549),d=r(2223),l=r(5307),f=r(5615),p=r(2084),y=r(2159),m=r(2617),g=r(5560),b=r(568),v=r(481),w=r(7680),S=r(7261),_=r(8608),A=r(3491),E=r(6461),C=r(4057),k=r(8634),T=(0,n.default)("werift-dtls : packages/dtls/src/flight/client/flight5.ts : log");class P extends k.Flight{constructor(e,t,r,i){super(e,t,5,7),this.cipher=r,this.srtp=i}handleHandshake(e){this.dtls.bufferHandshakeCache([e],!1,4);const t=(()=>{switch(e.msg_type){case h.HandshakeType.server_hello_2:return w.ServerHello.deSerialize(e.fragment);case h.HandshakeType.certificate_11:return p.Certificate.deSerialize(e.fragment);case h.HandshakeType.server_key_exchange_12:return _.ServerKeyExchange.deSerialize(e.fragment);case h.HandshakeType.certificate_request_13:return v.ServerCertificateRequest.deSerialize(e.fragment);case h.HandshakeType.server_hello_done_14:return S.ServerHelloDone.deSerialize(e.fragment)}})();t&&I[t.msgType]({dtls:this.dtls,cipher:this.cipher,srtp:this.srtp})(t)}async exec(){if(5===this.dtls.flight)return T(this.dtls.sessionId,"flight5 twice"),void this.send(this.dtls.lastMessage);this.dtls.flight=5;const e=this.dtls.requestedCertificateTypes.length>0;T(this.dtls.sessionId,"send flight5",e);const t=[e&&this.sendCertificate(),this.sendClientKeyExchange(),e&&this.sendCertificateVerify(),this.sendChangeCipherSpec(),this.sendFinished()].filter((e=>e));this.dtls.lastMessage=t,await this.transmit(t)}sendCertificate(){const e=new p.Certificate([Buffer.from(this.cipher.localCert)]),t=this.createPacket([e]);return Buffer.concat(t.map((e=>e.serialize())))}sendClientKeyExchange(){if(!this.cipher.localKeyPair)throw new Error;const e=new g.ClientKeyExchange(this.cipher.localKeyPair.publicKey),t=this.createPacket([e]),r=Buffer.concat(t.map((e=>e.serialize()))),i=this.cipher.localKeyPair,n=this.cipher.remoteKeyPair;if(!n.publicKey)throw new Error("not exist");const s=(0,c.prfPreMasterSecret)(n.publicKey,i.privateKey,i.curve);T(this.dtls.sessionId,"extendedMasterSecret",this.dtls.options.extendedMasterSecret,this.dtls.remoteExtendedMasterSecret);const a=Buffer.concat(this.dtls.sortedHandshakeCache.map((e=>e.serialize())));return this.cipher.masterSecret=this.dtls.options.extendedMasterSecret&&this.dtls.remoteExtendedMasterSecret?(0,c.prfExtendedMasterSecret)(s,a):(0,c.prfMasterSecret)(s,this.cipher.localRandom.serialize(),this.cipher.remoteRandom.serialize()),this.cipher.cipher=(0,o.createCipher)(this.cipher.cipherSuite),this.cipher.cipher.init(this.cipher.masterSecret,this.cipher.remoteRandom.serialize(),this.cipher.localRandom.serialize()),T(this.dtls.sessionId,"cipher",this.cipher.cipher.summary),r}sendCertificateVerify(){const e=Buffer.concat(this.dtls.sortedHandshakeCache.map((e=>e.serialize()))),t=this.cipher.signatureData(e,"sha256"),r=(()=>{switch(this.cipher.signatureHashAlgorithm?.signature){case s.SignatureAlgorithm.ecdsa_3:return s.SignatureScheme.ecdsa_secp256r1_sha256;case s.SignatureAlgorithm.rsa_1:return s.SignatureScheme.rsa_pkcs1_sha256}})();if(!r)throw new Error;T(this.dtls.sessionId,"signatureScheme",this.cipher.signatureHashAlgorithm?.signature,r);const i=new m.CertificateVerify(r,t),n=this.createPacket([i]);return Buffer.concat(n.map((e=>e.serialize())))}sendChangeCipherSpec(){const e=y.ChangeCipherSpec.createEmpty().serialize(),t=(0,E.createPlaintext)(this.dtls)([{type:C.ContentType.changeCipherSpec,fragment:e}],++this.dtls.recordSequenceNumber);return Buffer.concat(t.map((e=>e.serialize())))}sendFinished(){const e=Buffer.concat(this.dtls.sortedHandshakeCache.map((e=>e.serialize()))),t=this.cipher.verifyData(e),r=new b.Finished(t);this.dtls.epoch=1;const[i]=this.createPacket([r]);T(this.dtls.sessionId,"raw finish packet",i.summary,this.dtls.sortedHandshakeCache.map((e=>e.summary))),this.dtls.recordSequenceNumber=0;const n=this.cipher.encryptPacket(i).serialize();return T(this.dtls.sessionId,"finished",this.cipher.cipher.summary),n}}t.Flight5=P;const I={};I[h.HandshakeType.server_hello_2]=({cipher:e,srtp:t,dtls:r})=>i=>{T(r.sessionId,"serverHello",i.cipherSuite),e.remoteRandom=A.DtlsRandom.from(i.random),e.cipherSuite=i.cipherSuite,T(r.sessionId,"selected cipherSuite",e.cipherSuite),i.extensions&&i.extensions.forEach((e=>{switch(e.type){case f.UseSRTP.type:const i=f.UseSRTP.fromData(e.data),n=u.SrtpContext.findMatchingSRTPProfile(i.profiles,r.options.srtpProfiles||[]);if(T(r.sessionId,"selected srtp profile",n),null==n)return;t.srtpProfile=n;break;case d.ExtendedMasterSecret.type:r.remoteExtendedMasterSecret=!0;break;case l.RenegotiationIndication.type:T(r.sessionId,"RenegotiationIndication")}}))},I[h.HandshakeType.certificate_11]=({cipher:e,dtls:t})=>r=>{T(t.sessionId,"handshake certificate",r),e.remoteCertificate=r.certificateList[0]},I[h.HandshakeType.server_key_exchange_12]=({cipher:e,dtls:t})=>r=>{if(!e.localRandom||!e.remoteRandom)throw new Error;T(t.sessionId,"ServerKeyExchange",r),T(t.sessionId,"selected curve",r.namedCurve),e.remoteKeyPair={curve:r.namedCurve,publicKey:r.publicKey},e.localKeyPair=(0,a.generateKeyPair)(r.namedCurve)},I[h.HandshakeType.certificate_request_13]=({dtls:e})=>t=>{T(e.sessionId,"certificate_request",t),e.requestedCertificateTypes=t.certificateTypes,e.requestedSignatureAlgorithms=t.signatures},I[h.HandshakeType.server_hello_done_14]=({dtls:e})=>t=>{T(e.sessionId,"server_hello_done",t)}},8634:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Flight=void 0;const n=i(r(5493)),s=r(8670),o=r(6461),a=r(4057),c=(0,n.default)("werift-dtls : packages/dtls/src/flight/flight.ts : warn"),u=(0,n.default)("werift-dtls : packages/dtls/src/flight/flight.ts : err");class h{constructor(e,t,r,i){this.transport=e,this.dtls=t,this.flight=r,this.nextFlight=i,this.state="PREPARING",this.send=e=>Promise.all(e.map((e=>this.transport.send(e))))}createPacket(e){const t=(0,o.createFragments)(this.dtls)(e);this.dtls.bufferHandshakeCache(t,!0,this.flight);return(0,o.createPlaintext)(this.dtls)(t.map((e=>({type:a.ContentType.handshake,fragment:e.serialize()}))),++this.dtls.recordSequenceNumber)}async transmit(e){let t=0;for(;t<=h.RetransmitCount;t++){if(this.setState("SENDING"),this.send(e).catch((e=>{u("fail to send",u)})),this.setState("WAITING"),void 0===this.nextFlight){this.setState("FINISHED");break}if(await(0,s.setTimeout)((t+1)/2*1e3),this.dtls.flight>=this.nextFlight){this.setState("FINISHED");break}c(this.dtls.sessionId,"retransmit",t,this.dtls.flight)}if(t>h.RetransmitCount)throw u(this.dtls.sessionId,"retransmit failed",t),new Error(`over retransmitCount : ${this.flight} ${this.nextFlight}`)}setState(e){this.state=e}}t.Flight=h,h.RetransmitCount=10},1563:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.flight2=void 0;const n=r(6113),s=i(r(5493)),o=r(6759),a=r(2113),c=r(250),u=r(1390),h=r(2223),d=r(5307),l=r(500),f=r(5615),p=r(1039),y=r(3491),m=r(6461),g=r(4057),b=(0,s.default)("werift-dtls : packages/dtls/flight/server/flight2.ts : log");t.flight2=(e,t,r,i)=>s=>{t.flight=2,t.recordSequenceNumber=0,t.sequenceNumber=0,s.extensions.forEach((e=>{switch(e.type){case u.EllipticCurves.type:{const i=u.EllipticCurves.fromData(e.data).data;b(t.sessionId,"curves",i);const n=i.find((e=>o.NamedCurveAlgorithmList.includes(e)));r.namedCurve=n,b(t.sessionId,"curve selected",r.namedCurve)}break;case l.Signature.type:{if(!r.signatureHashAlgorithm)throw new Error("need to set certificate");const i=l.Signature.fromData(e.data).data;b(t.sessionId,"hash,signature",i);const n=i.find((e=>e.signature===r.signatureHashAlgorithm?.signature))?.signature,s=i.find((e=>e.hash===r.signatureHashAlgorithm?.hash))?.hash;if(null==n||null==s)throw new Error("invalid signatureHash")}break;case f.UseSRTP.type:{if(!t.options?.srtpProfiles)return;if(0===t.options.srtpProfiles.length)return;const r=f.UseSRTP.fromData(e.data);b(t.sessionId,"srtp profiles",r.profiles);const n=c.SrtpContext.findMatchingSRTPProfile(r.profiles,t.options?.srtpProfiles);if(!n)throw new Error;i.srtpProfile=n,b(t.sessionId,"srtp profile selected",i.srtpProfile)}break;case h.ExtendedMasterSecret.type:t.remoteExtendedMasterSecret=!0;break;case d.RenegotiationIndication.type:b(t.sessionId,"RenegotiationIndication",e.data)}})),r.localRandom=new y.DtlsRandom,r.remoteRandom=y.DtlsRandom.from(s.random);const v=s.cipherSuites;b(t.sessionId,"cipher suites",v);const w=(()=>{switch(r.signatureHashAlgorithm?.signature){case o.SignatureAlgorithm.ecdsa_3:return o.CipherSuite.TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_49195;case o.SignatureAlgorithm.rsa_1:return o.CipherSuite.TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256_49199}})();if(void 0===w||!v.includes(w))throw new Error("dtls cipher suite negotiation failed");r.cipherSuite=w,b(t.sessionId,"selected cipherSuite",r.cipherSuite),r.localKeyPair=(0,a.generateKeyPair)(r.namedCurve),t.cookie=(0,n.randomBytes)(20);const S=new p.ServerHelloVerifyRequest({major:254,minor:253},t.cookie),_=(0,m.createFragments)(t)([S]),A=(0,m.createPlaintext)(t)(_.map((e=>({type:g.ContentType.handshake,fragment:e.serialize()}))),++t.recordSequenceNumber).map((e=>e.serialize()));for(const t of A)e.send(t)}},5693:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Flight4=void 0;const n=i(r(5493)),s=r(6759),o=r(2223),a=r(5307),c=r(5615),u=r(2084),h=r(481),d=r(7680),l=r(7261),f=r(8608),p=r(8634),y=(0,n.default)("werift-dtls : packages/dtls/flight/server/flight4.ts : log");class m extends p.Flight{constructor(e,t,r,i){super(e,t,4,6),this.cipher=r,this.srtp=i}async exec(e,t=!1){if(4===this.dtls.flight)return y(this.dtls.sessionId,"flight4 twice"),void this.send(this.dtls.lastMessage);this.dtls.flight=4,this.dtls.sequenceNumber=1,this.dtls.bufferHandshakeCache([e],!1,4);const r=[this.sendServerHello(),this.sendCertificate(),this.sendServerKeyExchange(),t&&this.sendCertificateRequest(),this.sendServerHelloDone()].filter((e=>e));this.dtls.lastMessage=r,await this.transmit(r)}sendServerHello(){const e=[];this.srtp.srtpProfile&&e.push(c.UseSRTP.create([this.srtp.srtpProfile],Buffer.from([0])).extension),this.dtls.options.extendedMasterSecret&&e.push({type:o.ExtendedMasterSecret.type,data:Buffer.alloc(0)});const t=a.RenegotiationIndication.createEmpty();e.push(t.extension);const r=new d.ServerHello(this.dtls.version,this.cipher.localRandom,Buffer.from([0]),this.cipher.cipherSuite,0,e),i=this.createPacket([r]);return Buffer.concat(i.map((e=>e.serialize())))}sendCertificate(){const e=new u.Certificate([Buffer.from(this.cipher.localCert)]),t=this.createPacket([e]);return Buffer.concat(t.map((e=>e.serialize())))}sendServerKeyExchange(){const e=this.cipher.generateKeySignature("sha256");if(!this.cipher.signatureHashAlgorithm)throw new Error("not exist");const t=new f.ServerKeyExchange(s.CurveType.named_curve_3,this.cipher.namedCurve,this.cipher.localKeyPair.publicKey.length,this.cipher.localKeyPair.publicKey,this.cipher.signatureHashAlgorithm.hash,this.cipher.signatureHashAlgorithm.signature,e.length,e),r=this.createPacket([t]);return Buffer.concat(r.map((e=>e.serialize())))}sendCertificateRequest(){const e=new h.ServerCertificateRequest([1,64],[{hash:s.HashAlgorithm.sha256_4,signature:s.SignatureAlgorithm.rsa_1},{hash:s.HashAlgorithm.sha256_4,signature:s.SignatureAlgorithm.ecdsa_3}],[]);y(this.dtls.sessionId,"sendCertificateRequest",e);const t=this.createPacket([e]);return Buffer.concat(t.map((e=>e.serialize())))}sendServerHelloDone(){const e=new l.ServerHelloDone,t=this.createPacket([e]);return Buffer.concat(t.map((e=>e.serialize())))}}t.Flight4=m},3727:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Flight6=void 0;const n=i(r(5493)),s=r(1470),o=r(7184),a=r(9549),c=r(2084),u=r(2159),h=r(2617),d=r(5560),l=r(568),f=r(6461),p=r(4057),y=r(8634),m=(0,n.default)("werift-dtls : packages/dtls/flight/server/flight6.ts");class g extends y.Flight{constructor(e,t,r){super(e,t,6),this.cipher=r}handleHandshake(e){this.dtls.bufferHandshakeCache([e],!1,5);const t=(()=>{switch(e.msg_type){case a.HandshakeType.certificate_11:return c.Certificate.deSerialize(e.fragment);case a.HandshakeType.certificate_verify_15:return h.CertificateVerify.deSerialize(e.fragment);case a.HandshakeType.client_key_exchange_16:return d.ClientKeyExchange.deSerialize(e.fragment);case a.HandshakeType.finished_20:return l.Finished.deSerialize(e.fragment)}})();if(t){const e=b[t.msgType];if(!e)return;e({dtls:this.dtls,cipher:this.cipher})(t)}}async exec(){if(6===this.dtls.flight)return m(this.dtls.sessionId,"flight6 twice"),void this.send(this.dtls.lastMessage);this.dtls.flight=6;const e=[this.sendChangeCipherSpec(),this.sendFinished()];this.dtls.lastMessage=e,await this.transmit(e)}sendChangeCipherSpec(){const e=u.ChangeCipherSpec.createEmpty().serialize(),t=(0,f.createPlaintext)(this.dtls)([{type:p.ContentType.changeCipherSpec,fragment:e}],++this.dtls.recordSequenceNumber);return Buffer.concat(t.map((e=>e.serialize())))}sendFinished(){const e=Buffer.concat(this.dtls.sortedHandshakeCache.map((e=>e.serialize()))),t=this.cipher.verifyData(e),r=new l.Finished(t);this.dtls.epoch=1;const[i]=this.createPacket([r]);this.dtls.recordSequenceNumber=0;return this.cipher.encryptPacket(i).serialize()}}t.Flight6=g;const b={};b[a.HandshakeType.client_key_exchange_16]=({cipher:e,dtls:t})=>r=>{if(e.remoteKeyPair={curve:e.namedCurve,publicKey:r.publicKey},!(e.remoteKeyPair.publicKey&&e.localKeyPair&&e.remoteRandom&&e.localRandom))throw new Error("not exist");const i=(0,o.prfPreMasterSecret)(e.remoteKeyPair.publicKey,e.localKeyPair.privateKey,e.localKeyPair.curve);m(t.sessionId,"extendedMasterSecret",t.options.extendedMasterSecret,t.remoteExtendedMasterSecret);const n=Buffer.concat(t.sortedHandshakeCache.map((e=>e.serialize())));e.masterSecret=t.options.extendedMasterSecret&&t.remoteExtendedMasterSecret?(0,o.prfExtendedMasterSecret)(i,n):(0,o.prfMasterSecret)(i,e.remoteRandom.serialize(),e.localRandom.serialize()),e.cipher=(0,s.createCipher)(e.cipherSuite),e.cipher.init(e.masterSecret,e.localRandom.serialize(),e.remoteRandom.serialize()),m(t.sessionId,"setup cipher",e.cipher.summary)},b[a.HandshakeType.finished_20]=({dtls:e})=>t=>{m(e.sessionId,"finished",t)}},5599:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProtocolVersion=t.SignatureHashAlgorithm=t.DistinguishedName=t.ClientCertificateType=t.ASN11Cert=t.ExtensionList=void 0;const i=r(4756),{uint16be:n,uint24be:s,buffer:o,array:a,uint8:c,string:u}=i.types,h={type:n,data:o(n)};t.ExtensionList=a(h,n,"bytes"),t.ASN11Cert=o(s),t.ClientCertificateType=c,t.DistinguishedName=u(n),t.SignatureHashAlgorithm={hash:c,signature:c},t.ProtocolVersion={major:c,minor:c}},9549:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HandshakeType=void 0,function(e){e[e.hello_request_0=0]="hello_request_0",e[e.client_hello_1=1]="client_hello_1",e[e.server_hello_2=2]="server_hello_2",e[e.hello_verify_request_3=3]="hello_verify_request_3",e[e.certificate_11=11]="certificate_11",e[e.server_key_exchange_12=12]="server_key_exchange_12",e[e.certificate_request_13=13]="certificate_request_13",e[e.server_hello_done_14=14]="server_hello_done_14",e[e.certificate_verify_15=15]="certificate_verify_15",e[e.client_key_exchange_16=16]="client_key_exchange_16",e[e.finished_20=20]="finished_20"}(t.HandshakeType||(t.HandshakeType={}))},1390:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EllipticCurves=void 0;const i=r(4756);class n{constructor(e={}){this.type=n.type,this.data=[],Object.assign(this,e)}static createEmpty(){return new n}static fromData(e){return new n({type:n.type,data:(0,i.decode)(e,n.spec.data)})}static deSerialize(e){return new n((0,i.decode)(e,n.spec))}serialize(){return Buffer.from((0,i.encode)(this,n.spec).slice())}get extension(){return{type:this.type,data:this.serialize().slice(2)}}}t.EllipticCurves=n,n.type=10,n.spec={type:i.types.uint16be,data:i.types.array(i.types.uint16be,i.types.uint16be,"bytes")}},2223:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExtendedMasterSecret=void 0;class r{}t.ExtendedMasterSecret=r,r.type=23},5307:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RenegotiationIndication=void 0;const i=r(4756);class n{constructor(e={}){this.type=n.type,this.data=0,Object.assign(this,e)}static createEmpty(){return new n}static deSerialize(e){return new n((0,i.decode)(e,n.spec))}serialize(){const e=(0,i.encode)(this,n.spec).slice();return Buffer.from(e)}get extension(){return{type:this.type,data:this.serialize().slice(2)}}}t.RenegotiationIndication=n,n.type=65281,n.spec={type:i.types.uint16be,data:i.types.uint8}},500:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Signature=void 0;const i=r(4756);class n{constructor(e={}){this.type=n.type,this.data=[],Object.assign(this,e)}static createEmpty(){return new n}static deSerialize(e){return new n((0,i.decode)(e,n.spec))}serialize(){const e=(0,i.encode)(this,n.spec).slice();return Buffer.from(e)}static fromData(e){const t=Buffer.alloc(2);return t.writeUInt16BE(n.type),n.deSerialize(Buffer.concat([t,e]))}get extension(){return{type:this.type,data:this.serialize().slice(2)}}}t.Signature=n,n.type=13,n.spec={type:i.types.uint16be,data:i.types.array({hash:i.types.uint8,signature:i.types.uint8},i.types.uint16be,"bytes")}},5615:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UseSRTP=void 0;const n=r(4756),s=i(r(8595));class o{constructor(e={}){this.type=o.type,this.data=Buffer.from([]),this.profiles=[],this.mki=Buffer.from([0]),Object.assign(this,e)}static create(e,t){return new o({profiles:e,mki:t})}static deSerialize(e){const t=new o((0,n.decode)(e,o.spec)),r=t.data.readUInt16BE(),i=(0,s.default)(r/2).map((e=>t.data.readUInt16BE(2*e+2)));return t.profiles=i,t.mki=t.data.slice(r+2),t}serialize(){const e=Buffer.alloc(2);e.writeUInt16BE(2*this.profiles.length);const t=Buffer.concat([e,...this.profiles.map((e=>{const t=Buffer.alloc(2);return t.writeUInt16BE(e),t})),this.mki]);this.data=t;const r=(0,n.encode)(this,o.spec).slice();return Buffer.from(r)}static fromData(e){const t=Buffer.alloc(4);return t.writeUInt16BE(o.type),t.writeUInt16BE(e.length,2),o.deSerialize(Buffer.concat([t,e]))}get extension(){return{type:this.type,data:this.serialize().slice(4)}}}t.UseSRTP=o,o.type=14,o.spec={type:n.types.uint16be,data:n.types.buffer(n.types.uint16be)}},5674:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Alert=void 0;const i=r(4756);class n{constructor(e,t){this.level=e,this.description=t}static deSerialize(e){return new n(...Object.values((0,i.decode)(e,n.spec)))}serialize(){const e=(0,i.encode)(this,n.spec).slice();return Buffer.from(e)}}t.Alert=n,n.spec={level:i.types.uint8,description:i.types.uint8}},2084:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Certificate=void 0;const i=r(4756),n=r(7103),s=r(5599),o=r(9549);class a{constructor(e){this.certificateList=e,this.msgType=o.HandshakeType.certificate_11}static createEmpty(){return new a(void 0)}static deSerialize(e){return new a(...Object.values((0,i.decode)(e,a.spec)))}serialize(){const e=(0,i.encode)(this,a.spec).slice();return Buffer.from(e)}toFragment(){const e=this.serialize();return new n.FragmentedHandshake(this.msgType,e.length,this.messageSeq,0,e.length,e)}}t.Certificate=a,a.spec={certificateList:i.types.array(s.ASN11Cert,i.types.uint24be,"bytes")}},2159:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChangeCipherSpec=void 0;const i=r(4756);class n{constructor(e=1){this.type=e}static createEmpty(){return new n}static deSerialize(e){return new n(...Object.values((0,i.decode)(e,n.spec)))}serialize(){const e=(0,i.encode)(this,n.spec).slice();return Buffer.from(e)}}t.ChangeCipherSpec=n,n.spec={type:i.types.uint8}},2617:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CertificateVerify=void 0;const i=r(4756),n=r(7103),s=r(9549);class o{constructor(e,t){this.algorithm=e,this.signature=t,this.msgType=s.HandshakeType.certificate_verify_15}static createEmpty(){return new o(void 0,void 0)}static deSerialize(e){const t=(0,i.decode)(e,o.spec);return new o(...Object.values(t))}serialize(){const e=(0,i.encode)(this,o.spec).slice();return Buffer.from(e)}toFragment(){const e=this.serialize();return new n.FragmentedHandshake(this.msgType,e.length,this.messageSeq,0,e.length,e)}}t.CertificateVerify=o,o.spec={algorithm:i.types.uint16be,signature:i.types.buffer(i.types.uint16be)}},5536:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientHello=void 0;const i=r(4756),n=r(7103),s=r(5599),o=r(9549),a=r(3491);class c{constructor(e,t,r,i,n,s,a){this.clientVersion=e,this.random=t,this.sessionId=r,this.cookie=i,this.cipherSuites=n,this.compressionMethods=s,this.extensions=a,this.msgType=o.HandshakeType.client_hello_1,this.messageSeq=0}static createEmpty(){return new c(void 0,void 0,void 0,void 0,void 0,void 0,void 0)}static deSerialize(e){return new c(...Object.values((0,i.decode)(e,c.spec)))}serialize(){const e=(0,i.encode)(this,c.spec).slice();return Buffer.from(e)}toFragment(){const e=this.serialize();return new n.FragmentedHandshake(this.msgType,e.length,this.messageSeq,0,e.length,e)}}t.ClientHello=c,c.spec={clientVersion:{major:i.types.uint8,minor:i.types.uint8},random:a.DtlsRandom.spec,sessionId:i.types.buffer(i.types.uint8),cookie:i.types.buffer(i.types.uint8),cipherSuites:i.types.array(i.types.uint16be,i.types.uint16be,"bytes"),compressionMethods:i.types.array(i.types.uint8,i.types.uint8,"bytes"),extensions:s.ExtensionList}},5560:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientKeyExchange=void 0;const i=r(4756),n=r(7103),s=r(9549);class o{constructor(e){this.publicKey=e,this.msgType=s.HandshakeType.client_key_exchange_16}static createEmpty(){return new o(void 0)}static deSerialize(e){const t=(0,i.decode)(e,o.spec);return new o(...Object.values(t))}serialize(){const e=(0,i.encode)(this,o.spec).slice();return Buffer.from(e)}toFragment(){const e=this.serialize();return new n.FragmentedHandshake(this.msgType,e.length,this.messageSeq,0,e.length,e)}}t.ClientKeyExchange=o,o.spec={publicKey:i.types.buffer(i.types.uint8)}},568:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Finished=void 0;const i=r(7103),n=r(9549);class s{constructor(e){this.verifyData=e,this.msgType=n.HandshakeType.finished_20}static createEmpty(){return new s(void 0)}static deSerialize(e){return new s(e)}serialize(){return this.verifyData}toFragment(){const e=this.serialize();return new i.FragmentedHandshake(this.msgType,e.length,this.messageSeq,0,e.length,e)}}t.Finished=s},481:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerCertificateRequest=void 0;const i=r(4756),n=r(7103),s=r(5599),o=r(9549);class a{constructor(e,t,r){this.certificateTypes=e,this.signatures=t,this.authorities=r,this.msgType=o.HandshakeType.certificate_request_13}static createEmpty(){return new a(void 0,void 0,void 0)}static deSerialize(e){return new a(...Object.values((0,i.decode)(e,a.spec)))}serialize(){const e=(0,i.encode)(this,a.spec).slice();return Buffer.from(e)}toFragment(){const e=this.serialize();return new n.FragmentedHandshake(this.msgType,e.length,this.messageSeq,0,e.length,e)}}t.ServerCertificateRequest=a,a.spec={certificateTypes:i.types.array(s.ClientCertificateType,i.types.uint8,"bytes"),signatures:i.types.array(s.SignatureHashAlgorithm,i.types.uint16be,"bytes"),authorities:i.types.array(s.DistinguishedName,i.types.uint16be,"bytes")}},7680:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerHello=void 0;const i=r(4756),n=r(7103),s=r(5599),o=r(9549),a=r(3491);class c{constructor(e,t,r,i,n,s){this.serverVersion=e,this.random=t,this.sessionId=r,this.cipherSuite=i,this.compressionMethod=n,this.extensions=s,this.msgType=o.HandshakeType.server_hello_2}static createEmpty(){return new c(void 0,void 0,void 0,void 0,void 0,void 0)}static deSerialize(e){const t=(0,i.decode)(e,c.spec),r=new c(...Object.values(t));return r.serialize().length<e.length?new c(...Object.values((0,i.decode)(e,{...c.spec,extensions:s.ExtensionList}))):r}serialize(){const e=void 0===this.extensions?(0,i.encode)(this,c.spec).slice():(0,i.encode)(this,{...c.spec,extensions:s.ExtensionList}).slice();return Buffer.from(e)}toFragment(){const e=this.serialize();return new n.FragmentedHandshake(this.msgType,e.length,this.messageSeq,0,e.length,e)}}t.ServerHello=c,c.spec={serverVersion:s.ProtocolVersion,random:a.DtlsRandom.spec,sessionId:i.types.buffer(i.types.uint8),cipherSuite:i.types.uint16be,compressionMethod:i.types.uint8}},7261:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerHelloDone=void 0;const i=r(4756),n=r(7103),s=r(9549);class o{constructor(){this.msgType=s.HandshakeType.server_hello_done_14}static createEmpty(){return new o}static deSerialize(e){return new o(...Object.values((0,i.decode)(e,o.spec)))}serialize(){const e=(0,i.encode)(this,o.spec).slice();return Buffer.from(e)}toFragment(){const e=this.serialize();return new n.FragmentedHandshake(this.msgType,e.length,this.messageSeq,0,e.length,e)}}t.ServerHelloDone=o,o.spec={}},1039:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerHelloVerifyRequest=void 0;const i=r(4756),n=r(7103),s=r(5599),o=r(9549);class a{constructor(e,t){this.serverVersion=e,this.cookie=t,this.msgType=o.HandshakeType.hello_verify_request_3}static createEmpty(){return new a(void 0,void 0)}static deSerialize(e){return new a(...Object.values((0,i.decode)(e,a.spec)))}serialize(){const e=(0,i.encode)(this,a.spec).slice();return Buffer.from(e)}get version(){return{major:255-this.serverVersion.major,minor:255-this.serverVersion.minor}}toFragment(){const e=this.serialize();return new n.FragmentedHandshake(this.msgType,e.length,this.messageSeq,0,e.length,e)}}t.ServerHelloVerifyRequest=a,a.spec={serverVersion:s.ProtocolVersion,cookie:i.types.buffer(i.types.uint8)}},8608:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerKeyExchange=void 0;const i=r(4756),n=r(7103),s=r(5798),o=r(9549);class a{constructor(e,t,r,i,n,s,a,c){this.ellipticCurveType=e,this.namedCurve=t,this.publicKeyLength=r,this.publicKey=i,this.hashAlgorithm=n,this.signatureAlgorithm=s,this.signatureLength=a,this.signature=c,this.msgType=o.HandshakeType.server_key_exchange_12}static createEmpty(){return new a(void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0)}static deSerialize(e){const t=(0,i.decode)(e,a.spec);return new a(...Object.values(t))}serialize(){return(0,s.encodeBuffer)(this,a.spec)}toFragment(){const e=this.serialize();return new n.FragmentedHandshake(this.msgType,e.length,this.messageSeq,0,e.length,e)}}t.ServerKeyExchange=a,a.spec={ellipticCurveType:i.types.uint8,namedCurve:i.types.uint16be,publicKeyLength:i.types.uint8,publicKey:i.types.buffer((e=>e.current.publicKeyLength)),hashAlgorithm:i.types.uint8,signatureAlgorithm:i.types.uint8,signatureLength:i.types.uint16be,signature:i.types.buffer((e=>e.current.signatureLength))}},3491:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DtlsRandom=void 0;const i=r(4756),n=r(6113);class s{constructor(e=Math.floor(Date.now()/1e3),t=(0,n.randomBytes)(28)){this.gmt_unix_time=e,this.random_bytes=t}static deSerialize(e){return new s(...Object.values((0,i.decode)(e,s.spec)))}static from(e){return new s(...Object.values(e))}serialize(){const e=(0,i.encode)(this,s.spec).slice();return Buffer.from(e)}}t.DtlsRandom=s,s.spec={gmt_unix_time:i.types.uint32be,random_bytes:i.types.buffer(28)}},560:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getObjectSummary=t.dumpBuffer=t.divide=t.enumerate=void 0,t.enumerate=function(e){return e.map(((e,t)=>[t,e]))},t.divide=function(e,t){const r=e.split(t);return[r[0],r.slice(1).join(t)]};t.dumpBuffer=e=>"0x"+e.toString("hex").replace(/(.)(.)/g,"$1$2 ").split(" ").filter((e=>null!=e&&e.length>0)).join(",0x");t.getObjectSummary=e=>Object.entries({...e}).reduce(((e,[r,i])=>("number"!=typeof i&&"string"!=typeof i||(e[r]=i),Buffer.isBuffer(i)&&(e[r]=(0,t.dumpBuffer)(i)),e)),{})},7498:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UdpTransport=t.createUdpTransport=t.DtlsSocket=t.DtlsServer=t.DtlsClient=void 0;var i=r(853);Object.defineProperty(t,"DtlsClient",{enumerable:!0,get:function(){return i.DtlsClient}});var n=r(2453);Object.defineProperty(t,"DtlsServer",{enumerable:!0,get:function(){return n.DtlsServer}});var s=r(9969);Object.defineProperty(t,"DtlsSocket",{enumerable:!0,get:function(){return s.DtlsSocket}});var o=r(6543);Object.defineProperty(t,"createUdpTransport",{enumerable:!0,get:function(){return o.createUdpTransport}}),Object.defineProperty(t,"UdpTransport",{enumerable:!0,get:function(){return o.UdpTransport}})},6461:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createPlaintext=t.createFragments=void 0;const i=r(8165);t.createFragments=e=>t=>(e.lastFlight=t,t.map((t=>{t.messageSeq=e.sequenceNumber++;return t.toFragment().chunk()})).flatMap((e=>e)));t.createPlaintext=e=>(t,r)=>t.map((t=>new i.DtlsPlaintext({contentType:t.type,protocolVersion:e.version,epoch:e.epoch,sequenceNumber:r,contentLen:t.fragment.length},t.fragment)))},4057:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AlertDesc=t.ContentType=void 0,function(e){e[e.changeCipherSpec=20]="changeCipherSpec",e[e.alert=21]="alert",e[e.handshake=22]="handshake",e[e.applicationData=23]="applicationData"}(t.ContentType||(t.ContentType={})),function(e){e[e.CloseNotify=0]="CloseNotify",e[e.UnexpectedMessage=10]="UnexpectedMessage",e[e.BadRecordMac=20]="BadRecordMac",e[e.DecryptionFailed=21]="DecryptionFailed",e[e.RecordOverflow=22]="RecordOverflow",e[e.DecompressionFailure=30]="DecompressionFailure",e[e.HandshakeFailure=40]="HandshakeFailure",e[e.NoCertificate=41]="NoCertificate",e[e.BadCertificate=42]="BadCertificate",e[e.UnsupportedCertificate=43]="UnsupportedCertificate",e[e.CertificateRevoked=44]="CertificateRevoked",e[e.CertificateExpired=45]="CertificateExpired",e[e.CertificateUnknown=46]="CertificateUnknown",e[e.IllegalParameter=47]="IllegalParameter",e[e.UnknownCa=48]="UnknownCa",e[e.AccessDenied=49]="AccessDenied",e[e.DecodeError=50]="DecodeError",e[e.DecryptError=51]="DecryptError",e[e.ExportRestriction=60]="ExportRestriction",e[e.ProtocolVersion=70]="ProtocolVersion",e[e.InsufficientSecurity=71]="InsufficientSecurity",e[e.InternalError=80]="InternalError",e[e.UserCanceled=90]="UserCanceled",e[e.NoRenegotiation=100]="NoRenegotiation",e[e.UnsupportedExtension=110]="UnsupportedExtension"}(t.AlertDesc||(t.AlertDesc={}))},7103:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FragmentedHandshake=void 0;const i=r(4756),n=r(560);class s{constructor(e,t,r,i,n,s){this.msg_type=e,this.length=t,this.message_seq=r,this.fragment_offset=i,this.fragment_length=n,this.fragment=s}get summary(){return(0,n.getObjectSummary)(this)}static createEmpty(){return new s(void 0,void 0,void 0,void 0,void 0,void 0)}static deSerialize(e){return new s(...Object.values((0,i.decode)(e,s.spec)))}serialize(){const e=(0,i.encode)(this,s.spec).slice();return Buffer.from(e)}chunk(e){let t=0;const r=this.fragment.length;if(0===r)return[new s(this.msg_type,r,this.message_seq,t,0,this.fragment)];const i=[];for(e||(e=1240);t<r;){const n=Math.min(e,r-t),o=Buffer.from(this.fragment.slice(t,t+n));if(o.length<=0)throw new Error("Zero or less bytes processed while fragmenting handshake message.");i.push(new s(this.msg_type,r,this.message_seq,t,o.length,o)),t+=o.length}return i}static assemble(e){if(!e||!e.length)throw new Error("cannot reassemble handshake from empty array");e=e.sort(((e,t)=>e.fragment_offset-t.fragment_offset));const t=Buffer.alloc(e[0].length);for(const r of e)r.fragment.copy(t,r.fragment_offset);return new s(e[0].msg_type,e[0].length,e[0].message_seq,0,t.length,t)}static findAllFragments(e,t){const r=e.find((e=>e.msg_type===t));return r&&e&&e.length?e.filter((e=>e.msg_type===r.msg_type&&e.message_seq===r.message_seq&&e.length===r.length)):[]}}t.FragmentedHandshake=s,s.spec={msg_type:i.types.uint8,length:i.types.uint24be,message_seq:i.types.uint16be,fragment_offset:i.types.uint24be,fragment_length:i.types.uint24be,fragment:i.types.buffer((e=>e.current.fragment_length))}},6218:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MACHeader=t.DtlsPlaintextHeader=void 0;const i=r(4756),n=r(5599);class s{constructor(e,t,r,i,n){this.contentType=e,this.protocolVersion=t,this.epoch=r,this.sequenceNumber=i,this.contentLen=n}static createEmpty(){return new s(void 0,void 0,void 0,void 0,void 0)}static deSerialize(e){return new s(...Object.values((0,i.decode)(e,s.spec)))}serialize(){const e=(0,i.encode)(this,s.spec).slice();return Buffer.from(e)}}t.DtlsPlaintextHeader=s,s.spec={contentType:i.types.uint8,protocolVersion:n.ProtocolVersion,epoch:i.types.uint16be,sequenceNumber:i.types.uint48be,contentLen:i.types.uint16be};class o{constructor(e,t,r,i,n){this.epoch=e,this.sequenceNumber=t,this.contentType=r,this.protocolVersion=i,this.contentLen=n}static createEmpty(){return new o(void 0,void 0,void 0,void 0,void 0)}static deSerialize(e){return new o(...Object.values((0,i.decode)(e,o.spec)))}serialize(){const e=(0,i.encode)(this,o.spec).slice();return Buffer.from(e)}}t.MACHeader=o,o.spec={epoch:i.types.uint16be,sequenceNumber:i.types.uint48be,contentType:i.types.uint8,protocolVersion:n.ProtocolVersion,contentLen:i.types.uint16be}},8165:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DtlsPlaintext=void 0;const i=r(4756),n=r(560),s=r(6218);class o{constructor(e,t){this.recordLayerHeader=e,this.fragment=t}get summary(){return{header:this.recordLayerHeader,fragment:(0,n.dumpBuffer)(this.fragment)}}static createEmpty(){return new o(void 0,void 0)}static deSerialize(e){return new o(...Object.values((0,i.decode)(e,o.spec)))}serialize(){const e=(0,i.encode)(this,o.spec).slice();return Buffer.from(e)}computeMACHeader(){return new s.MACHeader(this.recordLayerHeader.epoch,this.recordLayerHeader.sequenceNumber,this.recordLayerHeader.contentType,this.recordLayerHeader.protocolVersion,this.recordLayerHeader.contentLen).serialize()}}t.DtlsPlaintext=o,o.spec={recordLayerHeader:s.DtlsPlaintextHeader.spec,fragment:i.types.buffer((e=>e.current.recordLayerHeader.contentLen))}},2697:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.parsePlainText=t.parsePacket=void 0;const n=i(r(5493)),s=r(5674),o=r(4057),a=r(7103),c=r(8165),u=(0,n.default)("werift-dtls : packages/dtls/record/receive.ts : log"),h=(0,n.default)("werift-dtls : packages/dtls/record/receive.ts : err");t.parsePacket=e=>{let t=0;const r=[];for(;e.length>t;){const i=e.readUInt16BE(t+11);if(e.length<t+(12+i))break;const n=c.DtlsPlaintext.deSerialize(e.slice(t));r.push(n),t+=13+i}return r};t.parsePlainText=(e,t)=>r=>{switch(r.recordLayerHeader.contentType){case o.ContentType.changeCipherSpec:return u(e.sessionId,"change cipher spec"),{type:o.ContentType.changeCipherSpec,data:void 0};case o.ContentType.handshake:{let i=r.fragment;try{r.recordLayerHeader.epoch>0&&(u(e.sessionId,"decrypt handshake"),i=t.decryptPacket(r))}catch(t){throw h(e.sessionId,"decrypt failed",t),t}try{return{type:o.ContentType.handshake,data:a.FragmentedHandshake.deSerialize(i)}}catch(t){throw h(e.sessionId,"decSerialize failed",t,i),t}}case o.ContentType.applicationData:return{type:o.ContentType.applicationData,data:t.decryptPacket(r)};case o.ContentType.alert:{let i=s.Alert.deSerialize(r.fragment);if(null==o.AlertDesc[i.description]){const e=t.decryptPacket(r);i=s.Alert.deSerialize(e)}if(h(e.sessionId,"ContentType.alert",i,o.AlertDesc[i.description],"flight",e.flight,"lastFlight",e.lastFlight),i.level>1)throw new Error("alert fatal error")}default:return{type:o.ContentType.alert,data:void 0}}}},2453:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DtlsServer=void 0;const n=i(r(5493)),s=r(8263),o=r(1563),a=r(5693),c=r(3727),u=r(9549),h=r(5536),d=r(9969),l=(0,n.default)("werift-dtls : packages/dtls/src/server.ts : log");class f extends d.DtlsSocket{constructor(e){super(e,s.SessionType.SERVER),this.handleHandshakes=async e=>{l(this.dtls.sessionId,"handleHandshakes",e.map((e=>e.msg_type)));for(const t of e)switch(t.msg_type){case u.HandshakeType.client_hello_1:{this.connected&&this.renegotiation();const e=h.ClientHello.deSerialize(t.fragment);0===e.cookie.length?(l(this.dtls.sessionId,"send flight2"),(0,o.flight2)(this.transport,this.dtls,this.cipher,this.srtp)(e)):this.dtls.cookie&&e.cookie.equals(this.dtls.cookie)?(l(this.dtls.sessionId,"send flight4"),await new a.Flight4(this.transport,this.dtls,this.cipher,this.srtp).exec(t,this.options.certificateRequest)):l("wrong state",{dtlsCookie:this.dtls.cookie?.toString("hex").slice(10),helloCookie:e.cookie.toString("hex").slice(10)})}break;case u.HandshakeType.certificate_11:case u.HandshakeType.certificate_verify_15:case u.HandshakeType.client_key_exchange_16:if(this.connected)return;this.flight6=new c.Flight6(this.transport,this.dtls,this.cipher),this.flight6.handleHandshake(t);break;case u.HandshakeType.finished_20:await this.waitForReady((()=>!!this.flight6)),this.flight6?.handleHandshake(t),await this.waitForReady((()=>this.dtls.checkHandshakesExist([16]))),await(this.flight6?.exec()),this.connected=!0,this.onConnect.execute(),l(this.dtls.sessionId,"dtls connected")}},this.onHandleHandshakes=this.handleHandshakes,l(this.dtls.sessionId,"start server")}}t.DtlsServer=f},9969:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DtlsSocket=void 0;const n=r(4756),s=i(r(5493)),o=r(5473),a=r(8670),c=r(6759),u=r(7184),h=r(8263),d=r(2692),l=r(6608),f=r(250),p=r(8793),y=r(1390),m=r(2223),g=r(5307),b=r(500),v=r(5615),w=r(6461),S=r(4057),_=r(7103),A=r(2697),E=(0,s.default)("werift-dtls : packages/dtls/src/socket.ts : log"),C=(0,s.default)("werift-dtls : packages/dtls/src/socket.ts : err");t.DtlsSocket=class{constructor(e,t){this.options=e,this.sessionType=t,this.onConnect=new o.Event,this.onData=new o.Event,this.onError=new o.Event,this.onClose=new o.Event,this.srtp=new f.SrtpContext,this.connected=!1,this.extensions=[],this.bufferFragmentedHandshakes=[],this.udpOnMessage=e=>{const t=(0,A.parsePacket)(e);for(const e of t)try{const t=(0,A.parsePlainText)(this.dtls,this.cipher)(e);switch(t.type){case S.ContentType.handshake:{const e=t.data,r=this.handleFragmentHandshake([e]),i=Object.values(r.reduce(((e,t)=>(e[t.msg_type]||(e[t.msg_type]=[]),e[t.msg_type].push(t),e)),{})).map((e=>_.FragmentedHandshake.assemble(e))).sort(((e,t)=>e.msg_type-t.msg_type));this.onHandleHandshakes(i).catch((e=>{C(this.dtls.sessionId,"onHandleHandshakes error",e),this.onError.execute(e)}))}break;case S.ContentType.applicationData:this.onData.execute(t.data);break;case S.ContentType.alert:this.onClose.execute()}}catch(e){C(this.dtls.sessionId,"catch udpOnMessage error",e)}},this.waitForReady=e=>new Promise((async(t,r)=>{for(let r=0;r<10;r++){if(e()){t();break}await(0,a.setTimeout)(100*r)}r("waitForReady timeout")})),this.send=async e=>{const t=(0,w.createPlaintext)(this.dtls)([{type:S.ContentType.applicationData,fragment:e}],++this.dtls.recordSequenceNumber)[0];await this.transport.send(this.cipher.encryptPacket(t).serialize())},this.dtls=new l.DtlsContext(this.options,this.sessionType),this.cipher=new d.CipherContext(this.sessionType,this.options.cert,this.options.key,this.options.signatureHash),this.transport=new p.TransportContext(this.options.transport),this.setupExtensions(),this.transport.socket.onData=this.udpOnMessage}renegotiation(){E("renegotiation",this.sessionType),this.connected=!1,this.cipher=new d.CipherContext(this.sessionType,this.options.cert,this.options.key,this.options.signatureHash),this.dtls=new l.DtlsContext(this.options,this.sessionType),this.srtp=new f.SrtpContext,this.extensions=[],this.bufferFragmentedHandshakes=[]}setupExtensions(){if(E(this.dtls.sessionId,"support srtpProfiles",this.options.srtpProfiles),this.options.srtpProfiles&&this.options.srtpProfiles.length>0){const e=v.UseSRTP.create(this.options.srtpProfiles,Buffer.from([0]));this.extensions.push(e.extension)}{const e=y.EllipticCurves.createEmpty();e.data=c.NamedCurveAlgorithmList,this.extensions.push(e.extension)}{const e=b.Signature.createEmpty();e.data=[{hash:c.HashAlgorithm.sha256_4,signature:c.SignatureAlgorithm.rsa_1},{hash:c.HashAlgorithm.sha256_4,signature:c.SignatureAlgorithm.ecdsa_3}],this.extensions.push(e.extension)}this.options.extendedMasterSecret&&this.extensions.push({type:m.ExtendedMasterSecret.type,data:Buffer.alloc(0)});{const e=g.RenegotiationIndication.createEmpty();this.extensions.push(e.extension)}}handleFragmentHandshake(e){let t=e.filter((e=>e.fragment_length===e.length||(this.bufferFragmentedHandshakes.push(e),!1)));if(this.bufferFragmentedHandshakes.length>1){const[e]=this.bufferFragmentedHandshakes.slice(-1);e.fragment_offset+e.fragment_length===e.length&&(t=[...this.bufferFragmentedHandshakes,...t],this.bufferFragmentedHandshakes=[])}return t}close(){this.transport.socket.close()}extractSessionKeys(e,t){const r=this.exportKeyingMaterial("EXTRACTOR-dtls_srtp",2*e+2*t),{clientKey:i,serverKey:s,clientSalt:o,serverSalt:a}=(0,n.decode)(r,{clientKey:n.types.buffer(e),serverKey:n.types.buffer(e),clientSalt:n.types.buffer(t),serverSalt:n.types.buffer(t)});return this.sessionType===h.SessionType.CLIENT?{localKey:i,localSalt:o,remoteKey:s,remoteSalt:a}:{localKey:s,localSalt:a,remoteKey:i,remoteSalt:o}}exportKeyingMaterial(e,t){return(0,u.exportKeyingMaterial)(e,t,this.cipher.masterSecret,this.cipher.localRandom.serialize(),this.cipher.remoteRandom.serialize(),this.sessionType===h.SessionType.CLIENT)}}},6543:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createUdpTransport=t.UdpTransport=void 0;const n=(0,i(r(5493)).default)("werift-dtls : packages/dtls/src/transport.ts");class s{constructor(e,t){this.upd=e,this.rinfo=t,this.send=e=>new Promise(((t,r)=>{n("this.rinfo",this.rinfo),this.upd.send(e,this.rinfo.port,this.rinfo.address,(e=>{e?r(e):t()}))})),e.on("message",((e,t)=>{this.rinfo=t,this.onData&&this.onData(e)}))}close(){try{this.upd.close()}catch(e){}}}t.UdpTransport=s;t.createUdpTransport=(e,t={})=>new s(e,t)},5798:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encodeBuffer=void 0;const i=r(4756);t.encodeBuffer=function(e,t){return Buffer.from((0,i.encode)(e,t).slice())}},8112:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.candidatePriority=t.candidateFoundation=t.Candidate=void 0;const n=r(6113),s=i(r(201)),o=r(1808);class a{constructor(e,t,r,i,n,s,o,a,c,u,h){this.foundation=e,this.component=t,this.transport=r,this.priority=i,this.host=n,this.port=s,this.type=o,this.relatedAddress=a,this.relatedPort=c,this.tcptype=u,this.generation=h}static fromSdp(e){const t=e.split(" ");if(t.length<8)throw new Error("SDP does not have enough properties");const r={foundation:t[0],component:Number(t[1]),transport:t[2],priority:Number(t[3]),host:t[4],port:Number(t[5]),type:t[7]};for(const e of(0,s.default)(8,t.length-1,2))"raddr"===t[e]?r.related_address=t[e+1]:"rport"===t[e]?r.related_port=Number(t[e+1]):"tcptype"===t[e]?r.tcptype=t[e+1]:"generation"===t[e]&&(r.generation=Number(t[e+1]));const{foundation:i,component:n,transport:o,priority:c,host:u,port:h,type:d}=r;return new a(i,n,o,c,u,h,d,r.related_address,r.related_port,r.tcptype,r.generation)}canPairWith(e){const t=(0,o.isIPv4)(this.host),r=(0,o.isIPv4)(e.host);return this.component===e.component&&this.transport.toLowerCase()===e.transport.toLowerCase()&&t===r}toSdp(){let e=`${this.foundation} ${this.component} ${this.transport} ${this.priority} ${this.host} ${this.port} typ ${this.type}`;return this.relatedAddress&&(e+=` raddr ${this.relatedAddress}`),null!=this.relatedPort&&(e+=` rport ${this.relatedPort}`),this.tcptype&&(e+=` tcptype ${this.tcptype}`),null!=this.generation&&(e+=` generation ${this.generation}`),e}}t.Candidate=a,t.candidateFoundation=function(e,t,r){const i=`${e}|${t}|${r}`;return(0,n.createHash)("md5").update(i,"ascii").digest("hex").slice(7)},t.candidatePriority=function(e,t,r=65535){let i=0;return i="host"===t?126:"prflx"===t?110:"srflx"===t?100:0,(1<<24)*i+256*r+(256-e)}},7650:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DnsLookup=void 0;const n=i(r(1267));t.DnsLookup=class{constructor(){this.cache=new Map;const e=`(${()=>{const e=global.require("worker_threads"),{lookup:t}=global.require("dns");e.parentPort?.on("message",(r=>{const{host:i}=r;(r=>{t(r,((t,i,n)=>{const s={err:t?.message,address:i,family:n,host:r};e.parentPort?.postMessage(s),process.exit()}))})(i)}))}})()`;this.thread=new n.default.Worker(e,{eval:!0}),this.thread.setMaxListeners(100)}async lookup(e){let t=this.cache.get(e);return t||(t=new Promise(((t,r)=>{const i=e=>r(new Error(`dns.lookup thread exited unexpectedly: ${e}`)),n=s=>{if(s.host===e){if(this.thread.removeListener("message",n),this.thread.removeListener("exit",i),!s.address)return r(new Error(s.err||"dns.lookup thread unknown error"));t(s.address)}};this.thread.on("message",n),this.thread.on("exit",i),this.thread.postMessage({host:e})})),this.cache.set(e,t),t)}close(){return this.thread.terminate()}}},2267:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TransactionTimeout=t.TransactionFailed=t.TransactionError=void 0;class r extends Error{}t.TransactionError=r;t.TransactionFailed=class extends r{constructor(e,t){super(),this.response=e,this.addr=t}get str(){let e="STUN transaction failed";const t=this.response.getAttributeValue("ERROR-CODE");if(t){const[r,i]=t;e+=` (${r} - ${i})`}return e}};t.TransactionTimeout=class extends r{get str(){return"STUN transaction timed out"}}},5597:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.future=t.PQueue=t.difference=t.bufferXor=t.randomTransactionId=t.randomString=void 0;const n=r(6113),s=i(r(5493)),o=r(5473),a=(0,s.default)("werift-ice:packages/ice/src/helper.ts");t.randomString=function(e){return(0,n.randomBytes)(e).toString("hex").substring(0,e)},t.randomTransactionId=function(){return(0,n.randomBytes)(12)},t.bufferXor=function(e,t){if(e.length!==t.length)throw new TypeError("[webrtc-stun] You can not XOR buffers which length are different");const r=e.length,i=Buffer.allocUnsafe(r);for(let n=0;n<r;n++)i[n]=e[n]^t[n];return i},t.difference=function(e,t){return new Set([...e].filter((e=>!t.has(e))))};t.PQueue=class{constructor(){this.queue=[],this.wait=new o.Event}put(e){this.queue.push(e),1===this.queue.length&&this.wait.execute(e)}get(){const e=this.queue.shift();return e||new Promise((e=>{this.wait.subscribe((t=>{this.queue.shift(),e(t)}))}))}};t.future=e=>{const t={done:!1};return e.then((()=>{t.done=!0})).catch((e=>{"cancel"!==e&&a("future",e)})),{cancel:()=>e.cancel(),promise:e,done:()=>t.done}}},8507:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.validateAddress=t.serverReflexiveCandidate=t.getHostAddresses=t.candidatePairPriority=t.sortCandidatePairs=t.validateRemoteCandidate=t.CandidatePairState=t.CandidatePair=t.Connection=void 0;const a=r(6113),c=o(r(5493)),u=r(3543),h=s(r(5790)),d=o(r(271)),l=o(r(201)),f=r(1808),p=o(r(2037)),y=o(r(4538)),m=r(5473),g=o(r(8670)),b=r(8112),v=r(7650),w=r(5597),S=r(2987),_=r(475),A=r(2939),E=r(2863),C=r(7243),k=(0,c.default)("werift-ice : packages/ice/src/ice.ts : log");t.Connection=class{get nominatedKeys(){return Object.keys(this.nominated).map((e=>e.toString()))}constructor(e,t){this.iceControlling=e,this.localUserName=(0,w.randomString)(4),this.localPassword=(0,w.randomString)(22),this.remotePassword="",this.remoteUsername="",this.remoteIsLite=!1,this.checkList=[],this.localCandidates=[],this.remoteCandidatesEnd=!1,this._localCandidatesEnd=!1,this._tieBreaker=BigInt(new u.Uint64BE((0,a.randomBytes)(64)).toString()),this.state="new",this.onData=new m.Event,this.stateChanged=new m.Event,this._remoteCandidates=[],this.nominated={},this.nominating=new Set,this.checkListDone=!1,this.checkListState=new w.PQueue,this.earlyChecks=[],this.localCandidatesStart=!1,this.protocols=[],this.queryConsent=()=>new y.default((async(e,t,r)=>{let i=0;const n=new AbortController;r((()=>{i+=x,n.abort(),t("cancel")}));try{for(;!this.remoteIsLite&&"closed"!==this.state;){await g.default.setTimeout(R*(.8+.4*Math.random())*1e3,void 0,{signal:n.signal});for(const t of this.nominatedKeys){const r=this.nominated[Number(t)],n=this.buildRequest(r,!1);try{const[e,t]=await r.protocol.request(n,r.remoteAddr,Buffer.from(this.remotePassword,"utf8"),0);i=0,"disconnected"===this.state&&this.setState("connected")}catch(e){k("no stun response"),i++,this.setState("disconnected")}if(i>=x)return k("Consent to send expired"),this.queryConsentHandle=void 0,void e(await this.close())}}}catch(e){}})),this.send=async e=>{await this.sendTo(e,1)},this.checkStart=e=>new y.default((async(t,r,i)=>{i((()=>r("cancel"))),k("check start",e.toJSON()),this.setPairState(e,B.IN_PROGRESS);const n=this.iceControlling&&!this.remoteIsLite,s=this.buildRequest(e,n),o={};try{const[t,r]=await e.protocol.request(s,e.remoteAddr,Buffer.from(this.remotePassword,"utf8"),4);k("response",t,r),o.response=t,o.addr=r}catch(r){const i=r;return k("failure case",i.response),487===i.response?.getAttributeValue("ERROR-CODE")[0]?(s.attributesKeys.includes("ICE-CONTROLLED")?this.switchRole(!0):s.attributesKeys.includes("ICE-CONTROLLING")&&this.switchRole(!1),await this.checkStart(e),void t()):(k("CandidatePairState.FAILED",e.toJSON()),this.setPairState(e,B.FAILED),this.checkComplete(e),void t())}if(!(0,d.default)(o.addr,e.remoteAddr))return this.setPairState(e,B.FAILED),this.checkComplete(e),void t();if(n||e.remoteNominated)e.nominated=!0;else if(this.iceControlling&&!this.nominating.has(e.component)){this.nominating.add(e.component);const t=this.buildRequest(e,!0);try{await e.protocol.request(t,e.remoteAddr,Buffer.from(this.remotePassword,"utf8"))}catch(t){return this.setPairState(e,B.FAILED),void this.checkComplete(e)}e.nominated=!0}this.setPairState(e,B.SUCCEEDED),this.checkComplete(e),t()})),this.pairRemoteCandidate=e=>{for(const t of this.protocols)if(t.localCandidate?.canPairWith(e)&&!this.findPair(t,e)){const r=new T(t,e);this.checkList.push(r),this.setPairState(r,B.WAITING)}},this.options={...O,...t};const{components:r,stunServer:i,turnServer:n,useIpv4:s,useIpv6:o}=this.options;this.stunServer=q(i),this.turnServer=q(n),this.useIpv4=s,this.useIpv6=o,this._components=new Set((0,l.default)(1,r+1))}setRemoteParams({iceLite:e,usernameFragment:t,password:r}){k("setRemoteParams",{iceLite:e,usernameFragment:t,password:r}),this.remoteIsLite=e,this.remoteUsername=t,this.remotePassword=r}async gatherCandidates(e){if(!this.localCandidatesStart){this.localCandidatesStart=!0,this.promiseGatherCandidates=new m.Event;let t=U(this.useIpv4,this.useIpv6);const{interfaceAddresses:r}=this.options;if(r){const e=t.filter((e=>Object.values(r).includes(e)));e.length&&(t=e)}this.options.additionalHostAddresses&&(t=Array.from(new Set([...this.options.additionalHostAddresses,...t])));for(const r of this._components){const i=await this.getComponentCandidates(r,t,5,e);this.localCandidates=[...this.localCandidates,...i]}this._localCandidatesEnd=!0,this.promiseGatherCandidates.execute()}this.setState("completed")}async getComponentCandidates(e,t,r=5,i){let n=[];await Promise.all(t.map((async t=>{const r=new A.StunProtocol(this);try{await r.connectionMade((0,f.isIPv4)(t),this.options.portRange,this.options.interfaceAddresses)}catch(e){return void k("protocol STUN",e)}r.localAddress=t,this.protocols.push(r);const s=[t,r.getExtraInfo()[1]];r.localCandidate=new b.Candidate((0,b.candidateFoundation)("host","udp",s[0]),e,"udp",(0,b.candidatePriority)(e,"host"),s[0],s[1],"host"),n.push(r.localCandidate),i&&i(r.localCandidate)})));let s=[];const{stunServer:o,turnServer:a}=this;if(o){const e=this.protocols.map((e=>new Promise((async(t,n)=>{const s=setTimeout(n,1e3*r);if(e.localCandidate?.host&&(0,f.isIPv4)(e.localCandidate?.host)){const r=await j(e,o).catch((e=>k("error",e)));r&&i&&i(r),clearTimeout(s),t(r)}else clearTimeout(s),t()})).catch((e=>{k("query STUN server",e)}))));s.push(...e)}const{turnUsername:c,turnPassword:u}=this.options;if(a&&c&&u){const t=(async()=>{const t=await(0,E.createTurnEndpoint)(a,c,u,{portRange:this.options.portRange,interfaceAddresses:this.options.interfaceAddresses});this.protocols.push(t);const r=t.turn.relayedAddress,n=t.turn.mappedAddress;return k("turn candidateAddress",r),t.localCandidate=new b.Candidate((0,b.candidateFoundation)("relay","udp",r[0]),e,"udp",(0,b.candidatePriority)(e,"relay"),r[0],r[1],"relay",n[0],n[1]),i&&i(t.localCandidate),t.receiver=this,t.localCandidate})().catch((e=>{k("query TURN server",e)}));this.options.forceTurn&&(n=[],s=[]),s.push(t)}const h=(await Promise.all(s)).filter((e=>void 0!==e));return n.push(...h),n}async connect(){if(k("start connect ice",this.localCandidates),!this._localCandidatesEnd){if(!this.localCandidatesStart)throw new Error("Local candidates gathering was not performed");this.promiseGatherCandidates&&await this.promiseGatherCandidates.asPromise()}if(!this.remoteUsername||!this.remotePassword)throw new Error("Remote username or password is missing");for(this.remoteCandidates.forEach(this.pairRemoteCandidate),this.sortCheckList(),this.unfreezeInitial(),this.earlyChecks.forEach((e=>this.checkIncoming(...e))),this.earlyChecks=[];"closed"!==this.state&&this.schedulingChecks();)await g.default.setTimeout(20);let e=I;for(;this.checkList.length>0&&e===I;)e=await this.checkListState.get();if(this.checkList.forEach((e=>e.handle?.cancel())),e!==P)throw new Error("ICE negotiation failed");this.queryConsentHandle=(0,w.future)(this.queryConsent()),this.setState("connected")}unfreezeInitial(){const e=this.checkList.find((e=>e.component===Math.min(...this._components)));if(!e)return;e.state===B.FROZEN&&this.setPairState(e,B.WAITING);const t=new Set(e.localCandidate.foundation);for(const r of this.checkList)r.component!==e.component||t.has(r.localCandidate.foundation)||r.state!==B.FROZEN||(this.setPairState(r,B.WAITING),t.add(r.localCandidate.foundation))}schedulingChecks(){{const e=this.checkList.filter((e=>!this.options.forceTurn||"stun"!==e.protocol.type)).find((e=>e.state===B.WAITING));if(e)return e.handle=(0,w.future)(this.checkStart(e)),!0}{const e=this.checkList.find((e=>e.state===B.FROZEN));if(e)return e.handle=(0,w.future)(this.checkStart(e)),!0}return!this.remoteCandidatesEnd&&!this.checkListDone}async close(){if(this.setState("closed"),this.queryConsentHandle&&!this.queryConsentHandle.done()){this.queryConsentHandle.cancel();try{await this.queryConsentHandle.promise}catch(e){}}this.checkList&&!this.checkListDone&&this.checkListState.put(new Promise((e=>{e(I)}))),this.nominated={};for(const e of this.protocols)e.close&&await e.close();this.protocols=[],this.localCandidates=[],await(this.dnsLookup?.close())}setState(e){this.state=e,this.stateChanged.execute(e)}async addRemoteCandidate(e){if(!e)return this.pruneComponents(),void(this.remoteCandidatesEnd=!0);if(e.host.includes(".local"))try{if("closed"===this.state)return;this.dnsLookup||(this.dnsLookup=new v.DnsLookup);const t=await this.dnsLookup.lookup(e.host);e.host=t}catch(e){return}try{M(e)}catch(e){return}k("addRemoteCandidate",e),this.remoteCandidates.push(e),this.pairRemoteCandidate(e),this.sortCheckList()}async sendTo(e,t){const r=this.nominated[t];r&&await r.protocol.sendData(e,r.remoteAddr)}getDefaultCandidate(e){return this.localCandidates.sort(((e,t)=>e.priority-t.priority)).find((t=>t.component===e))}requestReceived(e,t,r,i){if(e.messageMethod!==S.methods.BINDING)return void this.respondError(e,t,r,[400,"Bad Request"]);try{if((0,_.parseMessage)(i,Buffer.from(this.localPassword,"utf8")),!this.remoteUsername){const t=`${this.localUserName}:${this.remoteUsername}`;if(e.getAttributeValue("USERNAME")!=t)throw new Error("Wrong username")}}catch(i){return void this.respondError(e,t,r,[400,"Bad Request"])}const{iceControlling:n}=this;if(n&&e.attributesKeys.includes("ICE-CONTROLLING")){if(this._tieBreaker>=e.getAttributeValue("ICE-CONTROLLING"))return void this.respondError(e,t,r,[487,"Role Conflict"]);this.switchRole(!1)}else if(!n&&e.attributesKeys.includes("ICE-CONTROLLED")){if(!(this._tieBreaker<e.getAttributeValue("ICE-CONTROLLED")))return void this.switchRole(!0);this.respondError(e,t,r,[487,"Role Conflict"])}if(this.options.filterStunResponse&&!this.options.filterStunResponse(e,t,r))return;const s=new _.Message(S.methods.BINDING,S.classes.RESPONSE,e.transactionId);s.setAttribute("XOR-MAPPED-ADDRESS",t).addMessageIntegrity(Buffer.from(this.localPassword,"utf8")).addFingerprint(),r.sendStun(s,t),this.checkIncoming(e,t,r)}dataReceived(e,t){try{this.onData.execute(e,t)}catch(e){k("dataReceived",e)}}set remoteCandidates(e){if(this.remoteCandidatesEnd)throw new Error("Cannot set remote candidates after end-of-candidates.");this._remoteCandidates=[];for(const t of e){try{M(t)}catch(e){continue}this.remoteCandidates.push(t)}this.pruneComponents(),this.remoteCandidatesEnd=!0}get remoteCandidates(){return this._remoteCandidates}pruneComponents(){const e=new Set(this.remoteCandidates.map((e=>e.component)));[...(0,w.difference)(this._components,e)].length>0&&(this._components=e)}sortCheckList(){N(this.checkList,this.iceControlling)}findPair(e,t){return this.checkList.find((r=>(0,d.default)(r.protocol,e)&&(0,d.default)(r.remoteCandidate,t)))}setPairState(e,t){k("setPairState",e.toJSON(),B[t]),e.updateState(t)}switchRole(e){k("switch role",e),this.iceControlling=e,this.sortCheckList()}resetNominatedPair(){k("resetNominatedPair"),this.nominated={},this.nominating.clear()}checkComplete(e){if(e.handle=void 0,e.state===B.SUCCEEDED){if(e.nominated&&null==this.nominated[e.component]){k("nominated",e.toJSON()),this.nominated[e.component]=e,this.nominating.delete(e.component);for(const t of this.checkList)t.component===e.component&&[B.WAITING,B.FROZEN].includes(t.state)&&this.setPairState(t,B.FAILED)}if(this.nominatedKeys.length===this._components.size)return void(this.checkListDone||(k("ICE completed"),this.checkListState.put(new Promise((e=>e(P)))),this.checkListDone=!0));for(const t of this.checkList)t.localCandidate.foundation===e.localCandidate.foundation&&t.state===B.FROZEN&&this.setPairState(t,B.WAITING)}{const e=[B.SUCCEEDED,B.FAILED];if(this.checkList.find((({state:t})=>!e.includes(t))))return}if(!this.iceControlling){const e=B.SUCCEEDED;if(this.checkList.find((({state:t})=>t===e)))return}this.checkListDone||(k("ICE failed"),this.checkListState.put(new Promise((e=>{e(I)}))))}checkIncoming(e,t,r){const i=r.localCandidate?.component;if(null==i)throw new Error("component not exist");let n;const[s,o]=t;for(const e of this.remoteCandidates)if(e.host===s&&e.port===o){if(n=e,n.component!==i)throw new Error("checkIncoming");break}n||(n=new b.Candidate((0,w.randomString)(10),i,"udp",e.getAttributeValue("PRIORITY"),s,o,"prflx"),this.remoteCandidates.push(n));let a=this.findPair(r,n);a||(a=new T(r,n),this.setPairState(a,B.WAITING),this.checkList.push(a),this.sortCheckList()),[B.WAITING,B.FAILED].includes(a.state)&&(a.handle=(0,w.future)(this.checkStart(a))),e.attributesKeys.includes("USE-CANDIDATE")&&!this.iceControlling&&(a.remoteNominated=!0,a.state===B.SUCCEEDED&&(a.nominated=!0,this.checkComplete(a)))}buildRequest(e,t){const r=`${this.remoteUsername}:${this.localUserName}`,i=new _.Message(S.methods.BINDING,S.classes.REQUEST);return i.setAttribute("USERNAME",r).setAttribute("PRIORITY",(0,b.candidatePriority)(e.component,"prflx")),this.iceControlling?(i.setAttribute("ICE-CONTROLLING",this._tieBreaker),t&&i.setAttribute("USE-CANDIDATE",null)):i.setAttribute("ICE-CONTROLLED",this._tieBreaker),i}respondError(e,t,r,i){const n=new _.Message(e.messageMethod,S.classes.ERROR,e.transactionId);n.setAttribute("ERROR-CODE",i).addMessageIntegrity(Buffer.from(this.localPassword,"utf8")).addFingerprint(),r.sendStun(n,t)}};class T{get state(){return this._state}toJSON(){return{protocol:this.protocol.type,remoteAddr:this.remoteAddr}}constructor(e,t){this.protocol=e,this.remoteCandidate=t,this.nominated=!1,this.remoteNominated=!1,this._state=B.FROZEN}updateState(e){this._state=e}get localCandidate(){if(!this.protocol.localCandidate)throw new Error("localCandidate not exist");return this.protocol.localCandidate}get remoteAddr(){return[this.remoteCandidate.host,this.remoteCandidate.port]}get component(){return this.localCandidate.component}}t.CandidatePair=T;const P=1,I=2,R=5,x=6;var B;!function(e){e[e.FROZEN=0]="FROZEN",e[e.WAITING=1]="WAITING",e[e.IN_PROGRESS=2]="IN_PROGRESS",e[e.SUCCEEDED=3]="SUCCEEDED",e[e.FAILED=4]="FAILED"}(B=t.CandidatePairState||(t.CandidatePairState={}));const O={components:1,useIpv4:!0,useIpv6:!0};function M(e){if(!["host","relay","srflx"].includes(e.type))throw new Error(`Unexpected candidate type "${e.type}"`);return e}function N(e,t){e.sort(((e,r)=>D(e.localCandidate,e.remoteCandidate,t)-D(r.localCandidate,r.remoteCandidate,t)))}function D(e,t,r){const i=r&&e.priority||t.priority,n=r&&t.priority||e.priority;return 1*Math.min(i,n)+2*Math.max(i,n)+(i>n?1:0)}function L(e){const t=["ipsec","tun","utun","tap"],r=["vmnet","veth"],i=p.default.networkInterfaces(),n=Object.keys(i).map((n=>{for(const e of[...t,...r])if(n.startsWith(e))return{nic:n,addresses:[]};return{nic:n,addresses:i[n].filter((t=>{return!((0,C.normalizeFamilyNodeV18)(t.family)!==e||h.isLoopback(t.address)||(r=t,4===(0,C.normalizeFamilyNodeV18)(r.family)&&r.address?.startsWith("169.254.")));var r})).map((e=>e.address))}})).filter((e=>!!e));return n.sort(((e,t)=>e.nic.localeCompare(t.nic))),Object.values(n).map((e=>e.addresses)).flat()}function U(e,t){const r=[];return e&&r.push(...L(4)),t&&r.push(...L(6)),r}async function j(e,t){const r=new _.Message(S.methods.BINDING,S.classes.REQUEST);try{const[i]=await e.request(r,t),n=e.localCandidate;if(!n)throw new Error("not exist");return new b.Candidate((0,b.candidateFoundation)("srflx","udp",n.host),n.component,n.transport,(0,b.candidatePriority)(n.component,"srflx"),i.getAttributeValue("XOR-MAPPED-ADDRESS")[0],i.getAttributeValue("XOR-MAPPED-ADDRESS")[1],"srflx",n.host,n.port)}catch(e){k("error serverReflexiveCandidate",e)}}function q(e){return e&&isNaN(e[1])?[e[0],443]:e}t.validateRemoteCandidate=M,t.sortCandidatePairs=N,t.candidatePairPriority=D,t.getHostAddresses=U,t.serverReflexiveCandidate=j,t.validateAddress=q},3801:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.Connection=t.Candidate=void 0;var s=r(8112);Object.defineProperty(t,"Candidate",{enumerable:!0,get:function(){return s.Candidate}});var o=r(8507);Object.defineProperty(t,"Connection",{enumerable:!0,get:function(){return o.Connection}}),n(r(7243),t)},57:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ATTRIBUTES_BY_NAME=t.ATTRIBUTES_BY_TYPE=t.AttributeRepository=t.packXorAddress=t.packErrorCode=t.unpackXorAddress=t.unpackErrorCode=void 0;const a=r(3543),c=s(r(5790)),u=r(239),h=o(r(201)),d=r(2987);function l(e){const[t]=e,r=c.isV4Format(t)?d.IPV4_PROTOCOL:d.IPV6_PROTOCOL;return Buffer.concat([Buffer.from(u.jspack.Pack("!BBH",[0,r,e[1]])),c.toBuffer(t)])}function f(e){if(e.length<4)throw new Error("STUN error code is less than 4 bytes");const[,t,r]=u.jspack.Unpack("!HBB",e.slice(0,4));return[100*t+r,e.slice(4).toString("utf8")]}function p(e){if(e.length<4)throw new Error("STUN address length is less than 4 bytes");const[,t,r]=u.jspack.Unpack("!BBH",e.slice(0,4)),i=e.slice(4);switch(t){case d.IPV4_PROTOCOL:if(4!=i.length)throw new Error("STUN address has invalid length for IPv4");return[c.toString(i),r];case d.IPV6_PROTOCOL:if(16!=i.length)throw new Error("STUN address has invalid length for IPv6");return[c.toString(i),r];default:throw new Error("STUN address has unknown protocol")}}function y(e,t){const r=[...u.jspack.Pack("!HI",[d.COOKIE>>16,d.COOKIE]),...t];let i=e.slice(0,2);for(const t of(0,h.default)(2,e.length)){const n=e[t]^r[t-2],s=Buffer.alloc(1);s.writeUIntBE(n,0,1),i=Buffer.concat([i,s])}return i}function m(e,t){return p(y(e,t))}function g(e){const t=Buffer.from(u.jspack.Pack("!HBB",[0,Math.floor(e[0]/100),e[0]%100])),r=Buffer.from(e[1],"utf8");return Buffer.concat([t,r])}function b(e,t){return y(l(e),t)}t.unpackErrorCode=f,t.unpackXorAddress=m,t.packErrorCode=g,t.packXorAddress=b;const v=e=>Buffer.from(u.jspack.Pack("!I",[e])),w=e=>u.jspack.Unpack("!I",e)[0],S=e=>new a.Int64BE(e.toString()).toBuffer(),_=e=>{const t=new a.Int64BE(e);return BigInt(t.toString())},A=e=>Buffer.from(e,"utf8"),E=e=>e.toString("utf8"),C=e=>e,k=e=>e,T=[[1,"MAPPED-ADDRESS",l,p],[3,"CHANGE-REQUEST",v,w],[4,"SOURCE-ADDRESS",l,p],[5,"CHANGED-ADDRESS",l,p],[6,"USERNAME",A,E],[8,"MESSAGE-INTEGRITY",C,k],[9,"ERROR-CODE",g,f],[12,"CHANNEL-NUMBER",e=>Buffer.concat([Buffer.from(u.jspack.Pack("!H",[e])),Buffer.from("\0\0")]),e=>u.jspack.Unpack("!H",e.slice(0,2))[0]],[13,"LIFETIME",v,w],[18,"XOR-PEER-ADDRESS",b,m],[19,"DATA",C,k],[20,"REALM",A,E],[21,"NONCE",C,k],[22,"XOR-RELAYED-ADDRESS",b,m],[25,"REQUESTED-TRANSPORT",v,w],[32,"XOR-MAPPED-ADDRESS",b,m],[36,"PRIORITY",v,w],[37,"USE-CANDIDATE",e=>Buffer.from([]),e=>null],[32802,"SOFTWARE",A,E],[32808,"FINGERPRINT",v,w],[32809,"ICE-CONTROLLED",S,_],[32810,"ICE-CONTROLLING",S,_],[32811,"RESPONSE-ORIGIN",l,p],[32812,"OTHER-ADDRESS",l,p]];t.AttributeRepository=class{constructor(e=[]){this.attributes=e}getAttributes(){return this.attributes}setAttribute(e,t){const r=this.attributes.find((t=>t[0]===e));return r?r[1]=t:this.attributes.push([e,t]),this}getAttributeValue(e){const t=this.attributes.find((t=>t[0]===e));if(t)return t[1]}get attributesKeys(){return this.attributes.map((e=>e[0]))}clear(){this.attributes=[]}},t.ATTRIBUTES_BY_TYPE=T.reduce(((e,t)=>(e[t[0]]=t,e)),{}),t.ATTRIBUTES_BY_NAME=T.reduce(((e,t)=>(e[t[1]]=t,e)),{})},2987:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.methods=t.classes=t.AttributeKeys=t.RETRY_RTO=t.RETRY_MAX=t.IPV6_PROTOCOL=t.IPV4_PROTOCOL=t.INTEGRITY_LENGTH=t.HEADER_LENGTH=t.FINGERPRINT_XOR=t.FINGERPRINT_LENGTH=t.COOKIE=void 0,t.COOKIE=554869826,t.FINGERPRINT_LENGTH=8,t.FINGERPRINT_XOR=1398035790,t.HEADER_LENGTH=20,t.INTEGRITY_LENGTH=24,t.IPV4_PROTOCOL=1,t.IPV6_PROTOCOL=2,t.RETRY_MAX=6,t.RETRY_RTO=50,t.AttributeKeys=["FINGERPRINT","MESSAGE-INTEGRITY","CHANGE-REQUEST","PRIORITY","USERNAME","ICE-CONTROLLING","SOURCE-ADDRESS","USE-CANDIDATE","ICE-CONTROLLED","ERROR-CODE","XOR-MAPPED-ADDRESS","CHANGED-ADDRESS","LIFETIME","REQUESTED-TRANSPORT","NONCE","REALM","XOR-RELAYED-ADDRESS","CHANNEL-NUMBER","XOR-PEER-ADDRESS","DATA","SOFTWARE","MAPPED-ADDRESS","RESPONSE-ORIGIN","OTHER-ADDRESS"],function(e){e[e.REQUEST=0]="REQUEST",e[e.INDICATION=16]="INDICATION",e[e.RESPONSE=256]="RESPONSE",e[e.ERROR=272]="ERROR"}(t.classes||(t.classes={})),function(e){e[e.BINDING=1]="BINDING",e[e.SHARED_SECRET=2]="SHARED_SECRET",e[e.ALLOCATE=3]="ALLOCATE",e[e.REFRESH=4]="REFRESH",e[e.SEND=6]="SEND",e[e.DATA=7]="DATA",e[e.CREATE_PERMISSION=8]="CREATE_PERMISSION",e[e.CHANNEL_BIND=9]="CHANNEL_BIND"}(t.methods||(t.methods={}))},475:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Message=t.parseMessage=void 0;const n=i(r(2992)),s=r(6113),o=r(239),a=r(5597),c=r(57),u=r(2987);t.parseMessage=function(e,t){if(e.length<u.HEADER_LENGTH)return;const[r,i]=o.jspack.Unpack("!HHI",e.slice(0,u.HEADER_LENGTH)),n=Buffer.from(e.slice(u.HEADER_LENGTH-12,u.HEADER_LENGTH));if(e.length!==u.HEADER_LENGTH+i)return;const s=new c.AttributeRepository;for(let r=u.HEADER_LENGTH;r<=e.length-4;){const[i,a]=o.jspack.Unpack("!HH",e.slice(r,r+4)),u=e.slice(r+4,r+4+a),h=4*Math.floor((a+3)/4)-a;if(Object.keys(c.ATTRIBUTES_BY_TYPE).includes(i.toString())){const[,o,,a]=c.ATTRIBUTES_BY_TYPE[i];if(a.name===c.unpackXorAddress.name?s.setAttribute(o,a(u,n)):s.setAttribute(o,a(u)),"FINGERPRINT"===o){const t=l(e.slice(0,r));if(s.getAttributeValue("FINGERPRINT")!==t)return}else if("MESSAGE-INTEGRITY"===o&&t){const i=f(e.slice(0,r),t),n=s.getAttributeValue("MESSAGE-INTEGRITY");if(!i.equals(n))return}}r+=4+a+h}const a=s.getAttributes();return s.clear(),new h(16111&r,272&r,n,a)};class h extends c.AttributeRepository{constructor(e,t,r=(0,a.randomTransactionId)(),i=[]){super(i),this.messageMethod=e,this.messageClass=t,this.transactionId=r}toJSON(){return{messageMethod:u.methods[this.messageMethod],messageClass:u.classes[this.messageClass]}}get transactionIdHex(){return this.transactionId.toString("hex")}get bytes(){let e=Buffer.from([]);for(const t of this.attributesKeys){const r=this.getAttributeValue(t),[i,,n]=c.ATTRIBUTES_BY_NAME[t],s=n.name===c.packXorAddress.name?n(r,this.transactionId):n(r),a=s.length,u=4*Math.floor((a+3)/4)-a;e=Buffer.concat([e,Buffer.from(o.jspack.Pack("!HH",[i,a])),s,...[...Array(u)].map((()=>Buffer.from("\0")))])}const t=Buffer.from(o.jspack.Pack("!HHI",[this.messageMethod|this.messageClass,e.length,u.COOKIE]));return Buffer.concat([t,this.transactionId,e])}addMessageIntegrity(e){return this.setAttribute("MESSAGE-INTEGRITY",this.messageIntegrity(e)),this}messageIntegrity(e){const t=d(this.bytes,this.bytes.length-u.HEADER_LENGTH+u.INTEGRITY_LENGTH);return Buffer.from((0,s.createHmac)("sha1",e).update(t).digest("hex"),"hex")}addFingerprint(){this.setAttribute("FINGERPRINT",l(this.bytes))}}t.Message=h;const d=(e,t)=>Buffer.concat([e.slice(0,2),Buffer.from(o.jspack.Pack("!H",[t])),e.slice(4)]);function l(e){const t=d(e,e.length-u.HEADER_LENGTH+u.FINGERPRINT_LENGTH),r=(0,n.default)(t),i=Buffer.alloc(4);i.writeInt32BE(u.FINGERPRINT_XOR,0);return(0,a.bufferXor)(r,i).readUInt32BE(0)}function f(e,t){const r=d(e,e.length-u.HEADER_LENGTH+u.INTEGRITY_LENGTH);return Buffer.from((0,s.createHmac)("sha1",t).update(r).digest("hex"),"hex")}},2939:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.StunProtocol=void 0;const n=i(r(5493)),s=r(5473),o=r(4549),a=r(2987),c=r(475),u=r(6481),h=(0,n.default)("packages/ice/src/stun/protocol.ts");t.StunProtocol=class{get transactionsKeys(){return Object.keys(this.transactions)}constructor(e){this.receiver=e,this.type="stun",this.transactions={},this.closed=new s.Event,this.connectionMade=async(e,t,r)=>{this.transport=e?await o.UdpTransport.init("udp4",t,r):await o.UdpTransport.init("udp6",t,r),this.transport.onData=(e,t)=>this.datagramReceived(e,t)}}connectionLost(){this.closed.execute(),this.closed.complete()}datagramReceived(e,t){if(!this.localCandidate)throw new Error("not exist");const r=(0,c.parseMessage)(e);if(r)if(r.messageClass!==a.classes.RESPONSE&&r.messageClass!==a.classes.ERROR||!this.transactionsKeys.includes(r.transactionIdHex))r.messageClass===a.classes.REQUEST&&this.receiver.requestReceived(r,t,this,e);else{this.transactions[r.transactionIdHex].responseReceived(r,t)}else this.receiver.dataReceived(e,this.localCandidate.component)}getExtraInfo(){const{address:e,port:t}=this.transport.address();return[e,t]}async sendStun(e,t){const r=e.bytes;await this.transport.send(r,t).catch((()=>{h("sendStun failed",t,e)}))}async sendData(e,t){await this.transport.send(e,t)}async request(e,t,r,i){if(this.transactionsKeys.includes(e.transactionIdHex))throw new Error("already request ed");r&&(e.addMessageIntegrity(r),e.addFingerprint());const n=new u.Transaction(e,t,this,i);this.transactions[e.transactionIdHex]=n;try{return await n.run()}finally{delete this.transactions[e.transactionIdHex]}}async close(){Object.values(this.transactions).forEach((e=>{e.cancel()})),await this.transport.close()}}},6481:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Transaction=void 0;const n=i(r(5493)),s=r(5473),o=r(2267),a=r(2987),c=(0,n.default)("werift-ice:packages/ice/src/stun/transaction.ts");t.Transaction=class{constructor(e,t,r,i){this.request=e,this.addr=t,this.protocol=r,this.retransmissions=i,this.timeoutDelay=a.RETRY_RTO,this.tries=0,this.onResponse=new s.Event,this.responseReceived=(e,t)=>{this.onResponse.length>0&&(e.messageClass===a.classes.RESPONSE?(this.onResponse.execute(e,t),this.onResponse.complete()):this.onResponse.error(new o.TransactionFailed(e,t)))},this.run=async()=>{try{return this.retry(),await this.onResponse.asPromise()}finally{this.timeoutHandle&&clearTimeout(this.timeoutHandle)}},this.retry=()=>{if(this.tries>=this.triesMax)return c(`retry failed times:${this.tries} maxLimit:${this.triesMax}`),void this.onResponse.error(new o.TransactionTimeout);this.protocol.sendStun(this.request,this.addr),this.timeoutHandle=setTimeout(this.retry,this.timeoutDelay),this.timeoutDelay*=2,this.tries++},this.triesMax=1+(this.retransmissions?this.retransmissions:a.RETRY_MAX)}cancel(){this.timeoutHandle&&clearTimeout(this.timeoutHandle)}}},4549:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UdpTransport=void 0;const n=i(r(5493)),s=r(1891),o=r(680),a=r(7243),c=(0,n.default)("werift-ice:packages/ice/src/transport.ts");class u{constructor(e,t,r){this.type=e,this.portRange=t,this.interfaceAddresses=r,this.onData=()=>{},this.send=(e,t)=>new Promise(((r,i)=>{this.socket.send(e,t[1],t[0],(n=>{n?(c("send error",t,e),i(n)):r()}))})),this.close=()=>new Promise((e=>{this.socket.once("close",e);try{this.socket.close()}catch(t){e()}})),this.socket=(0,s.createSocket)(this.type),this.socket.on("message",((e,t)=>{6===(0,a.normalizeFamilyNodeV18)(t.family)&&([t.address]=t.address.split("%"));try{this.onData(e,[t.address,t.port])}catch(e){c("onData error",e)}}))}static async init(e,t,r){const i=new u(e,t,r);return await i.init(),i}async init(){const e=(0,o.interfaceAddress)(this.type,this.interfaceAddresses);if(this.portRange){const t=await(0,o.findPort)(this.portRange[0],this.portRange[1],this.type,this.interfaceAddresses);this.socket.bind({port:t,address:e})}else this.socket.bind({address:e});await new Promise((e=>this.socket.once("listening",e)))}address(){return this.socket.address()}}t.UdpTransport=u},2863:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.makeIntegrityKey=t.createTurnEndpoint=void 0;const n=r(6113),s=i(r(5493)),o=r(239),a=i(r(4538)),c=i(r(5473)),u=r(8670),h=r(5597),d=r(2987),l=r(475),f=r(6481),p=r(4549),y=(0,s.default)("werift-ice:packages/ice/src/turn/protocol.ts"),m=285212672;class g{constructor(e){this.turn=e,this.type="turn",this.datagramReceived=(e,t)=>{const r=(0,l.parseMessage)(e);if(r)if(r?.messageClass!==d.classes.RESPONSE&&r?.messageClass!==d.classes.ERROR||!this.turn.transactions[r.transactionIdHex])r?.messageClass===d.classes.REQUEST&&this.receiver?.requestReceived(r,t,this,e);else{this.turn.transactions[r.transactionIdHex].responseReceived(r,t)}else this.receiver?.dataReceived(e,this.localCandidate.component)},e.onDatagramReceived=this.datagramReceived}async request(e,t,r){if(this.turn.transactions[e.transactionIdHex])throw new Error("exist");r&&(e.addMessageIntegrity(r),e.addFingerprint());const i=new f.Transaction(e,t,this);this.turn.transactions[e.transactionIdHex]=i;try{return await i.run()}finally{delete this.turn.transactions[e.transactionIdHex]}}async connectionMade(){}async sendData(e,t){await this.turn.sendData(e,t)}async sendStun(e,t){await this.turn.sendData(e.bytes,t)}}class b{constructor(e,t,r,i,n){this.server=e,this.username=t,this.password=r,this.lifetime=i,this.transport=n,this.type="inner_turn",this.onData=new c.default,this.transactions={},this.channelNumber=16384,this.onDatagramReceived=()=>{},this.refresh=()=>new a.default((async(e,t,r)=>{let i=!0;for(r((()=>{i=!1,t("cancel")}));i;){await(0,u.setTimeout)(5/6*this.lifetime*1e3);const e=new l.Message(d.methods.REFRESH,d.classes.REQUEST);e.setAttribute("LIFETIME",this.lifetime),await this.request(e,this.server)}}))}async connectionMade(){this.transport.onData=(e,t)=>{this.datagramReceived(e,t)}}handleChannelData(e){const[,t]=o.jspack.Unpack("!HH",e.slice(0,4));if(this.channel?.address){const r=e.slice(4,4+t);this.onDatagramReceived(r,this.channel.address)}}handleSTUNMessage(e,t){try{const r=(0,l.parseMessage)(e);if(!r)throw new Error("not stun message");if(r.messageClass===d.classes.RESPONSE||r.messageClass===d.classes.ERROR){const e=this.transactions[r.transactionIdHex];e&&e.responseReceived(r,t)}else r.messageClass===d.classes.REQUEST&&this.onDatagramReceived(e,t);if(r.getAttributeValue("DATA")){const e=r.getAttributeValue("DATA");this.onDatagramReceived(e,t)}}catch(t){y("parse error",e.toString())}}datagramReceived(e,t){e.length>=4&&function(e){return 64==(192&e[0])}(e)?this.handleChannelData(e):this.handleSTUNMessage(e,t)}async connect(){const e=new l.Message(d.methods.ALLOCATE,d.classes.REQUEST);e.setAttribute("LIFETIME",this.lifetime).setAttribute("REQUESTED-TRANSPORT",m);const t=await this.request(e,this.server).catch((e=>e));this.server=t.addr,t.response.getAttributeValue("NONCE")&&(this.nonce=t.response.getAttributeValue("NONCE")),t.response.getAttributeValue("REALM")&&(this.realm=t.response.getAttributeValue("REALM")),this.integrityKey=v(this.username,this.realm,this.password);const r=new l.Message(d.methods.ALLOCATE,d.classes.REQUEST);r.setAttribute("REQUESTED-TRANSPORT",m);const[i]=await this.request(r,this.server);this.relayedAddress=i.getAttributeValue("XOR-RELAYED-ADDRESS"),this.mappedAddress=i.getAttributeValue("XOR-MAPPED-ADDRESS"),this.refreshHandle=(0,h.future)(this.refresh())}async createPermission(e){const t=new l.Message(d.methods.CREATE_PERMISSION,d.classes.REQUEST);t.setAttribute("XOR-PEER-ADDRESS",e).setAttribute("USERNAME",this.username).setAttribute("REALM",this.realm).setAttribute("NONCE",this.nonce);const[r]=await this.request(t,this.server).catch((e=>{throw e}));return r}async request(e,t){if(this.transactions[e.transactionIdHex])throw new Error("exist");this.integrityKey&&e.setAttribute("USERNAME",this.username).setAttribute("REALM",this.realm).setAttribute("NONCE",this.nonce).addMessageIntegrity(this.integrityKey).addFingerprint();const r=new f.Transaction(e,t,this);this.transactions[e.transactionIdHex]=r;try{return await r.run()}finally{delete this.transactions[e.transactionIdHex]}}async sendData(e,t){const r=await this.getChannel(t),i=o.jspack.Pack("!HH",[r.number,e.length]);this.transport.send(Buffer.concat([Buffer.from(i),e]),this.server)}async getChannel(e){return this.channelBinding&&await this.channelBinding,this.channel||(this.channel={number:this.channelNumber++,address:e},this.channelBinding=this.channelBind(this.channel.number,e),await this.channelBinding,this.channelBinding=void 0,y("channelBind",this.channel)),this.channel}async channelBind(e,t){const r=new l.Message(d.methods.CHANNEL_BIND,d.classes.REQUEST);r.setAttribute("CHANNEL-NUMBER",e).setAttribute("XOR-PEER-ADDRESS",t);const[i]=await this.request(r,this.server);if(i.messageMethod!==d.methods.CHANNEL_BIND)throw new Error}sendStun(e,t){this.transport.send(e.bytes,t)}}function v(e,t,r){return(0,n.createHash)("md5").update(Buffer.from([e,t,r].join(":"))).digest()}t.createTurnEndpoint=async function(e,t,r,{lifetime:i,portRange:n,interfaceAddresses:s}){null==i&&(i=600);const o=await p.UdpTransport.init("udp4",n,s),a=new b(e,t,r,i,o);return await a.connectionMade(),await a.connect(),new g(a)},t.makeIntegrityKey=v},7243:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.normalizeFamilyNodeV18=t.getGlobalIp=void 0;const i=r(8507),n=r(2939);t.getGlobalIp=async function(e,t){const r=new i.Connection(!0,{stunServer:e??["stun.l.google.com",19302]});await r.gatherCandidates();const s=new n.StunProtocol(r);s.localCandidate=r.localCandidates[0],await s.connectionMade(!0,void 0,t);const o=await(0,i.serverReflexiveCandidate)(s,["stun.l.google.com",19302]);return await r.close(),await s.close(),o?.host},t.normalizeFamilyNodeV18=function(e){return"IPv4"===e?4:"IPv6"===e?6:e}},6486:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.leb128decode=t.AV1Obu=t.AV1RtpPayload=void 0;const i=r(509),n=r(5493),s=r(680),o=(0,n.debug)("werift-rtp : packages/rtp/src/codec/av1.ts");class a{constructor(){this.obu_or_fragment=[]}static isDetectedFinalPacketInSequence(e){return e.marker}get isKeyframe(){return 1===this.nBit_RtpStartsNewCodedVideoSequence}static getFrame(e){const t=[],r=e.flatMap((e=>e.obu_or_fragment)).reduce(((e,t,r)=>(e[r]=t,e)),{}),i=Object.keys(r).length;for(const e of Object.keys(r).map(Number)){const n=r[e];if(!n)continue;const{data:s,isFragment:a}=n;if(a){let n=[];for(let t=e;t<i;t++){const e=r[t];if(!e.isFragment)break;n.push(e.data),delete r[t]}n.length<=1&&(o("fragment lost, maybe packet lost"),n=[]),t.push(Buffer.concat(n))}else t.push(s)}const n=t.map((e=>c.deSerialize(e))),s=n.pop();return Buffer.concat([...n.map((e=>(e.obu_has_size_field=1,e.serialize()))),s.serialize()])}}t.AV1RtpPayload=a,a.deSerialize=e=>{const t=new a;let r=0;if(t.zBit_RtpStartsWithFragment=(0,s.getBit)(e[r],0),t.yBit_RtpEndsWithFragment=(0,s.getBit)(e[r],1),t.w_RtpNumObus=(0,s.getBit)(e[r],2,2),t.nBit_RtpStartsNewCodedVideoSequence=(0,s.getBit)(e[r],4),r++,t.nBit_RtpStartsNewCodedVideoSequence&&t.zBit_RtpStartsWithFragment)throw new Error;[...Array(t.w_RtpNumObus-1).keys()].forEach((i=>{const[n,s]=u(e.subarray(r)),o=r+s,a=o+n;let c=!1;t.zBit_RtpStartsWithFragment&&0===i&&(c=!0),t.obu_or_fragment.push({data:e.subarray(o,a),isFragment:c}),r+=s+n}));let i=!1;return(t.yBit_RtpEndsWithFragment||1===t.w_RtpNumObus&&t.zBit_RtpStartsWithFragment)&&(i=!0),t.obu_or_fragment.push({data:e.subarray(r),isFragment:i}),t};class c{static deSerialize(e){const t=new c;let r=0;return t.obu_forbidden_bit=(0,s.getBit)(e[r],0),t.obu_type=h[(0,s.getBit)(e[r],1,4)],t.obu_extension_flag=(0,s.getBit)(e[r],5),t.obu_has_size_field=(0,s.getBit)(e[r],6),t.obu_reserved_1bit=(0,s.getBit)(e[r],7),r++,t.payload=e.subarray(r),t}serialize(){const e=new s.BitWriter2(8).set(this.obu_forbidden_bit).set(d[this.obu_type],4).set(this.obu_extension_flag).set(this.obu_has_size_field).set(this.obu_reserved_1bit).buffer;let t=Buffer.alloc(0);return this.obu_has_size_field&&(t=i.LEB128.encode(this.payload.length)),Buffer.concat([e,t,this.payload])}}function u(e){let t=0,r=0;for(let i=0;i<8;i++){const n=e.readUInt8(i);if(t|=(127&n)<<7*i,r++,!(128&n))break}return[t,r]}t.AV1Obu=c,t.leb128decode=u;const h={0:"Reserved",1:"OBU_SEQUENCE_HEADER",2:"OBU_TEMPORAL_DELIMITER",3:"OBU_FRAME_HEADER",4:"OBU_TILE_GROUP",5:"OBU_METADATA",6:"OBU_FRAME",7:"OBU_REDUNDANT_FRAME_HEADER",8:"OBU_TILE_LIST",15:"OBU_PADDING"},d=Object.entries(h).reduce(((e,[t,r])=>(e[r]=Number(t),e)),{})},6123:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DePacketizerBase=void 0;t.DePacketizerBase=class{static deSerialize(e){return{}}static isDetectedFinalPacketInSequence(e){return!0}get isKeyframe(){return!0}}},5778:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NalUnitType=t.H264RtpPayload=void 0;const i=r(680);class n{static deSerialize(e){const r=new n;let s=0;if(r.f=(0,i.getBit)(e[s],0),r.nri=(0,i.getBit)(e[s],1,2),r.nalUnitType=(0,i.getBit)(e[s],3,5),s++,r.s=(0,i.getBit)(e[s],0),r.e=(0,i.getBit)(e[s],1),r.r=(0,i.getBit)(e[s],2),r.nalUnitPayloadType=(0,i.getBit)(e[s],3,5),s++,0<r.nalUnitType&&r.nalUnitType<24)r.payload=this.packaging(e);else if(r.nalUnitType===t.NalUnitType.stap_a){let t=o,i=Buffer.alloc(0);for(;t<e.length;){const r=e.readUInt16BE(t);t+=a,i=Buffer.concat([i,this.packaging(e.subarray(t,t+r))]),t+=r}r.payload=i}return r}static packaging(e){return Buffer.concat([s,e])}static isDetectedFinalPacketInSequence(e){return e.marker}get isKeyframe(){return this.nalUnitType===t.NalUnitType.idrSlice}get isPartitionHead(){return this.nalUnitType!==t.NalUnitType.fu_a&&this.nalUnitType!==t.NalUnitType.fu_b||0!==this.s}}t.H264RtpPayload=n,t.NalUnitType={idrSlice:5,stap_a:24,stap_b:25,mtap16:26,mtap24:27,fu_a:28,fu_b:29};const s=Buffer.from([0,0,0,1]),o=1,a=2},8668:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.dePacketizeRtpPackets=void 0;const s=r(6486),o=r(5778),a=r(5746),c=r(8355),u=r(5776);n(r(6486),t),n(r(6123),t),n(r(5778),t),n(r(5746),t),n(r(8355),t),n(r(5776),t),t.dePacketizeRtpPackets=function(e,t){const r=e=>{const r=t.map((t=>e.deSerialize(t.payload)));return{isKeyframe:!!r.find((e=>e.isKeyframe)),data:Buffer.concat(r.map((e=>e.payload))),sequence:t.at(-1)?.header.sequenceNumber??0,timestamp:t.at(-1)?.header.timestamp??0}};switch(e.toUpperCase()){case"AV1":{const e=t.map((e=>s.AV1RtpPayload.deSerialize(e.payload)));return{isKeyframe:!!e.find((e=>e.isKeyframe)),data:s.AV1RtpPayload.getFrame(e),sequence:t.at(-1)?.header.sequenceNumber??0,timestamp:t.at(-1)?.header.timestamp??0}}case"MPEG4/ISO/AVC":return r(o.H264RtpPayload);case"VP8":return r(c.Vp8RtpPayload);case"VP9":return r(u.Vp9RtpPayload);case"OPUS":return r(a.OpusRtpPayload);default:throw new Error}}},5746:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpusRtpPayload=void 0;const i=r(680);class n{static deSerialize(e){const t=new n;return t.payload=e,t}static isDetectedFinalPacketInSequence(e){return!0}get isKeyframe(){return!0}static createCodecPrivate(e=48e3){return Buffer.concat([Buffer.from("OpusHead"),(0,i.bufferWriter)([1,1],[1,2]),(0,i.bufferWriterLE)([2,4,2,1],[312,e,0,0])])}}t.OpusRtpPayload=n},8355:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vp8RtpPayload=void 0;const i=r(680);class n{constructor(){this.size0=0,this.size1=0,this.size2=0}static deSerialize(e){const t=new n;let r=0;if(t.xBit=(0,i.getBit)(e[r],0),t.nBit=(0,i.getBit)(e[r],2),t.sBit=(0,i.getBit)(e[r],3),t.pid=(0,i.getBit)(e[r],5,3),r++,t.xBit&&(t.iBit=(0,i.getBit)(e[r],0),t.lBit=(0,i.getBit)(e[r],1),t.tBit=(0,i.getBit)(e[r],2),t.kBit=(0,i.getBit)(e[r],3),r++),t.iBit)if(t.mBit=(0,i.getBit)(e[r],0),t.mBit){const n=(0,i.paddingByte)((0,i.getBit)(e[r],1,7)),s=(0,i.paddingByte)(e[r+1]);t.pictureId=parseInt(n+s,2),r+=2}else t.pictureId=(0,i.getBit)(e[r],1,7),r++;return t.lBit&&r++,(t.lBit||t.kBit)&&(t.tBit,t.kBit,r++),t.payload=e.subarray(r),t.payloadHeaderExist&&(t.size0=(0,i.getBit)(e[r],0,3),t.hBit=(0,i.getBit)(e[r],3),t.ver=(0,i.getBit)(e[r],4,3),t.pBit=(0,i.getBit)(e[r],7),r++,t.size1=e[r],r++,t.size2=e[r]),t}static isDetectedFinalPacketInSequence(e){return e.marker}get isKeyframe(){return 0===this.pBit}get isPartitionHead(){return 1===this.sBit}get payloadHeaderExist(){return 1===this.sBit&&0===this.pid}get size(){if(this.payloadHeaderExist){return this.size0+8*this.size1+2048*this.size2}return 0}}t.Vp8RtpPayload=n},5776:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vp9RtpPayload=void 0;const i=r(680);class n{constructor(){this.pDiff=[],this.width=[],this.height=[],this.n_g=0,this.pgT=[],this.pgU=[],this.pgP_Diff=[]}static deSerialize(e){const{p:t,offset:r}=this.parseRtpPayload(e);return t.payload=e.subarray(r),t}static parseRtpPayload(e){const t=new n;let r=0;if(t.iBit=(0,i.getBit)(e[r],0),t.pBit=(0,i.getBit)(e[r],1),t.lBit=(0,i.getBit)(e[r],2),t.fBit=(0,i.getBit)(e[r],3),t.bBit=(0,i.getBit)(e[r],4),t.eBit=(0,i.getBit)(e[r],5),t.vBit=(0,i.getBit)(e[r],6),t.zBit=(0,i.getBit)(e[r],7),r++,t.iBit)if(t.m=(0,i.getBit)(e[r],0),t.m){const n=(0,i.paddingByte)((0,i.getBit)(e[r],1,7)),s=(0,i.paddingByte)(e[r+1]);t.pictureId=parseInt(n+s,2),r+=2}else t.pictureId=(0,i.getBit)(e[r],1,7),r++;if(t.lBit&&(t.tid=(0,i.getBit)(e[r],0,3),t.u=(0,i.getBit)(e[r],3),t.sid=(0,i.getBit)(e[r],4,3),t.d=(0,i.getBit)(e[r],7),r++,0===t.fBit&&(t.tl0PicIdx=e[r],r++)),t.fBit&&t.pBit)for(;;){t.pDiff=[...t.pDiff,(0,i.getBit)(e[r],0,7)];const n=(0,i.getBit)(e[r],7);if(r++,0===n)break}return t.vBit&&(t.n_s=(0,i.getBit)(e[r],0,3),t.y=(0,i.getBit)(e[r],3),t.g=(0,i.getBit)(e[r],4),r++,t.y&&[...Array(t.n_s+1)].forEach((()=>{t.width.push(e.readUInt16BE(r)),r+=2,t.height.push(e.readUInt16BE(r)),r+=2})),t.g&&(t.n_g=e[r],r++),t.n_g>0&&[...Array(t.n_g).keys()].forEach((n=>{t.pgT.push((0,i.getBit)(e[r],0,3)),t.pgU.push((0,i.getBit)(e[r],3));const s=(0,i.getBit)(e[r],4,2);r++,t.pgP_Diff[n]=[],s>0&&[...Array(s)].forEach((()=>{t.pgP_Diff[n].push(e[r]),r++}))}))),{offset:r,p:t}}static isDetectedFinalPacketInSequence(e){return e.marker}get isKeyframe(){return!(this.pBit||!this.bBit||this.sid&&this.lBit)}get isPartitionHead(){return this.bBit&&(!this.lBit||!this.d)}}t.Vp9RtpPayload=n},8680:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getSizeMask=t.vintEncode=t.UNKNOWN_SIZE=t.getEBMLByteLength=t.build=t.unknownSizeElement=t.element=t.string=t.vintEncodedNumber=t.float=t.number=t.bytes=t.Element=t.Value=void 0;const n=i(r(7510)),s=r(2097);class o{constructor(e){this.bytes=e}write(e,t){return e.set(this.bytes,t),t+this.bytes.length}countSize(){return this.bytes.length}}t.Value=o;class a{constructor(e,r,i){this.id=e,this.children=r;const n=this.children.reduce(((e,t)=>e+t.countSize()),0);this.sizeMetaData=i?t.UNKNOWN_SIZE:(0,t.vintEncode)((0,s.numberToByteArray)(n,(0,t.getEBMLByteLength)(n))),this.size=this.id.length+this.sizeMetaData.length+n}write(e,t){return e.set(this.id,t),e.set(this.sizeMetaData,t+this.id.length),this.children.reduce(((t,r)=>r.write(e,t)),t+this.id.length+this.sizeMetaData.length)}countSize(){return this.size}}t.Element=a,t.bytes=(0,n.default)((e=>new o(e))),t.number=(0,n.default)((e=>(0,t.bytes)((0,s.numberToByteArray)(e)))),t.float=(0,n.default)((e=>(0,t.bytes)((0,s.float32bit)(e)))),t.vintEncodedNumber=(0,n.default)((e=>(0,t.bytes)((0,t.vintEncode)((0,s.numberToByteArray)(e,(0,t.getEBMLByteLength)(e)))))),t.string=(0,n.default)((e=>(0,t.bytes)((0,s.stringToByteArray)(e))));t.element=(e,t)=>new a(e,Array.isArray(t)?t:[t],!1);t.unknownSizeElement=(e,t)=>new a(e,Array.isArray(t)?t:[t],!0);t.build=e=>{const t=new Uint8Array(e.countSize());return e.write(t,0),t};t.getEBMLByteLength=e=>{if(e<127)return 1;if(e<16383)return 2;if(e<2097151)return 3;if(e<268435455)return 4;if(e<34359738367)return 5;if(e<4398046511103)return 6;if(e<562949953421311)return 7;if(e<0x20000000000000n)return 8;throw e<0xffffffffffffffn?new Error("EBMLgetEBMLByteLength: number exceeds Number.MAX_SAFE_INTEGER"):new Error("EBMLgetEBMLByteLength: data size must be less than or equal to "+(Math.pow(2,56)-2))},t.UNKNOWN_SIZE=new Uint8Array([1,255,255,255,255,255,255,255]);t.vintEncode=e=>(e[0]=(0,t.getSizeMask)(e.length)|e[0],e);t.getSizeMask=e=>128>>e-1},4509:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ID=void 0,t.ID={EBML:Uint8Array.of(26,69,223,163),EBMLVersion:Uint8Array.of(66,134),EBMLReadVersion:Uint8Array.of(66,247),EBMLMaxIDLength:Uint8Array.of(66,242),EBMLMaxSizeLength:Uint8Array.of(66,243),DocType:Uint8Array.of(66,130),DocTypeVersion:Uint8Array.of(66,135),DocTypeReadVersion:Uint8Array.of(66,133),Void:Uint8Array.of(236),CRC32:Uint8Array.of(191),Segment:Uint8Array.of(24,83,128,103),SeekHead:Uint8Array.of(17,77,155,116),Seek:Uint8Array.of(77,187),SeekID:Uint8Array.of(83,171),SeekPosition:Uint8Array.of(83,172),Info:Uint8Array.of(21,73,169,102),SegmentUID:Uint8Array.of(115,164),SegmentFilename:Uint8Array.of(115,132),PrevUID:Uint8Array.of(60,185,35),PrevFilename:Uint8Array.of(60,131,171),NextUID:Uint8Array.of(62,185,35),NextFilename:Uint8Array.of(62,131,187),SegmentFamily:Uint8Array.of(68,68),ChapterTranslate:Uint8Array.of(105,36),ChapterTranslateEditionUID:Uint8Array.of(105,252),ChapterTranslateCodec:Uint8Array.of(105,191),ChapterTranslateID:Uint8Array.of(105,165),TimecodeScale:Uint8Array.of(42,215,177),Duration:Uint8Array.of(68,137),DateUTC:Uint8Array.of(68,97),Title:Uint8Array.of(123,169),MuxingApp:Uint8Array.of(77,128),WritingApp:Uint8Array.of(87,65),Cluster:Uint8Array.of(31,67,182,117),Timecode:Uint8Array.of(231),SilentTracks:Uint8Array.of(88,84),SilentTrackNumber:Uint8Array.of(88,215),Position:Uint8Array.of(167),PrevSize:Uint8Array.of(171),SimpleBlock:Uint8Array.of(163),BlockGroup:Uint8Array.of(160),Block:Uint8Array.of(161),BlockAdditions:Uint8Array.of(117,161),BlockMore:Uint8Array.of(166),BlockAddID:Uint8Array.of(238),BlockAdditional:Uint8Array.of(165),BlockDuration:Uint8Array.of(155),ReferencePriority:Uint8Array.of(250),ReferenceBlock:Uint8Array.of(251),CodecState:Uint8Array.of(164),DiscardPadding:Uint8Array.of(117,162),Slices:Uint8Array.of(142),TimeSlice:Uint8Array.of(232),LaceNumber:Uint8Array.of(204),Tracks:Uint8Array.of(22,84,174,107),TrackEntry:Uint8Array.of(174),TrackNumber:Uint8Array.of(215),TrackUID:Uint8Array.of(115,197),TrackType:Uint8Array.of(131),FlagEnabled:Uint8Array.of(185),FlagDefault:Uint8Array.of(136),FlagForced:Uint8Array.of(85,170),FlagLacing:Uint8Array.of(156),MinCache:Uint8Array.of(109,231),MaxCache:Uint8Array.of(109,248),DefaultDuration:Uint8Array.of(35,227,131),DefaultDecodedFieldDuration:Uint8Array.of(35,78,122),MaxBlockAdditionID:Uint8Array.of(85,238),Name:Uint8Array.of(83,110),Language:Uint8Array.of(34,181,156),CodecID:Uint8Array.of(134),CodecPrivate:Uint8Array.of(99,162),CodecName:Uint8Array.of(37,134,136),AttachmentLink:Uint8Array.of(116,70),CodecDecodeAll:Uint8Array.of(170),TrackOverlay:Uint8Array.of(111,171),CodecDelay:Uint8Array.of(86,170),SeekPreRoll:Uint8Array.of(86,187),TrackTranslate:Uint8Array.of(102,36),TrackTranslateEditionUID:Uint8Array.of(102,252),TrackTranslateCodec:Uint8Array.of(102,191),TrackTranslateTrackID:Uint8Array.of(102,165),Video:Uint8Array.of(224),FlagInterlaced:Uint8Array.of(154),FieldOrder:Uint8Array.of(157),StereoMode:Uint8Array.of(83,184),AlphaMode:Uint8Array.of(83,192),PixelWidth:Uint8Array.of(176),PixelHeight:Uint8Array.of(186),PixelCropBottom:Uint8Array.of(84,170),PixelCropTop:Uint8Array.of(84,187),PixelCropLeft:Uint8Array.of(84,204),PixelCropRight:Uint8Array.of(84,221),DisplayWidth:Uint8Array.of(84,176),DisplayHeight:Uint8Array.of(84,186),DisplayUnit:Uint8Array.of(84,178),AspectRatioType:Uint8Array.of(84,179),ColourSpace:Uint8Array.of(46,181,36),Colour:Uint8Array.of(85,176),MatrixCoefficients:Uint8Array.of(85,177),BitsPerChannel:Uint8Array.of(85,178),ChromaSubsamplingHorz:Uint8Array.of(85,179),ChromaSubsamplingVert:Uint8Array.of(85,180),CbSubsamplingHorz:Uint8Array.of(85,181),CbSubsamplingVert:Uint8Array.of(85,182),ChromaSitingHorz:Uint8Array.of(85,183),ChromaSitingVert:Uint8Array.of(85,184),Range:Uint8Array.of(85,185),TransferCharacteristics:Uint8Array.of(85,186),Primaries:Uint8Array.of(85,187),MaxCLL:Uint8Array.of(85,188),MaxFALL:Uint8Array.of(85,189),MasteringMetadata:Uint8Array.of(85,208),PrimaryRChromaticityX:Uint8Array.of(85,209),PrimaryRChromaticityY:Uint8Array.of(85,210),PrimaryGChromaticityX:Uint8Array.of(85,211),PrimaryGChromaticityY:Uint8Array.of(85,212),PrimaryBChromaticityX:Uint8Array.of(85,213),PrimaryBChromaticityY:Uint8Array.of(85,214),WhitePointChromaticityX:Uint8Array.of(85,215),WhitePointChromaticityY:Uint8Array.of(85,216),LuminanceMax:Uint8Array.of(85,217),LuminanceMin:Uint8Array.of(85,218),Audio:Uint8Array.of(225),SamplingFrequency:Uint8Array.of(181),OutputSamplingFrequency:Uint8Array.of(120,181),Channels:Uint8Array.of(159),BitDepth:Uint8Array.of(98,100),TrackOperation:Uint8Array.of(226),TrackCombinePlanes:Uint8Array.of(227),TrackPlane:Uint8Array.of(228),TrackPlaneUID:Uint8Array.of(229),TrackPlaneType:Uint8Array.of(230),TrackJoinBlocks:Uint8Array.of(233),TrackJoinUID:Uint8Array.of(237),ContentEncodings:Uint8Array.of(109,128),ContentEncoding:Uint8Array.of(98,64),ContentEncodingOrder:Uint8Array.of(80,49),ContentEncodingScope:Uint8Array.of(80,50),ContentEncodingType:Uint8Array.of(80,51),ContentCompression:Uint8Array.of(80,52),ContentCompAlgo:Uint8Array.of(66,84),ContentCompSettings:Uint8Array.of(66,85),ContentEncryption:Uint8Array.of(80,53),ContentEncAlgo:Uint8Array.of(71,225),ContentEncKeyID:Uint8Array.of(71,226),ContentSignature:Uint8Array.of(71,227),ContentSigKeyID:Uint8Array.of(71,228),ContentSigAlgo:Uint8Array.of(71,229),ContentSigHashAlgo:Uint8Array.of(71,230),Cues:Uint8Array.of(28,83,187,107),CuePoint:Uint8Array.of(187),CueTime:Uint8Array.of(179),CueTrackPositions:Uint8Array.of(183),CueTrack:Uint8Array.of(247),CueClusterPosition:Uint8Array.of(241),CueRelativePosition:Uint8Array.of(240),CueDuration:Uint8Array.of(178),CueBlockNumber:Uint8Array.of(83,120),CueCodecState:Uint8Array.of(234),CueReference:Uint8Array.of(219),CueRefTime:Uint8Array.of(150),Attachments:Uint8Array.of(25,65,164,105),AttachedFile:Uint8Array.of(97,167),FileDescription:Uint8Array.of(70,126),FileName:Uint8Array.of(70,110),FileMimeType:Uint8Array.of(70,96),FileData:Uint8Array.of(70,92),FileUID:Uint8Array.of(70,174),Chapters:Uint8Array.of(16,67,167,112),EditionEntry:Uint8Array.of(69,185),EditionUID:Uint8Array.of(69,188),EditionFlagHidden:Uint8Array.of(69,189),EditionFlagDefault:Uint8Array.of(69,219),EditionFlagOrdered:Uint8Array.of(69,221),EncryptionAlgorithm:Uint8Array.of(71,225),EncryptionKeyID:Uint8Array.of(71,226),ContentEncAESSettings:Uint8Array.of(71,231),AESSettingsCipherMode:Uint8Array.of(71,232),ChapterAtom:Uint8Array.of(182),ChapterUID:Uint8Array.of(115,196),ChapterStringUID:Uint8Array.of(86,84),ChapterTimeStart:Uint8Array.of(145),ChapterTimeEnd:Uint8Array.of(146),ChapterFlagHidden:Uint8Array.of(152),ChapterFlagEnabled:Uint8Array.of(69,152),ChapterSegmentUID:Uint8Array.of(110,103),ChapterSegmentEditionUID:Uint8Array.of(110,188),ChapterPhysicalEquiv:Uint8Array.of(99,195),ChapterTrack:Uint8Array.of(143),ChapterTrackNumber:Uint8Array.of(137),ChapterDisplay:Uint8Array.of(128),ChapString:Uint8Array.of(133),ChapLanguage:Uint8Array.of(67,124),ChapCountry:Uint8Array.of(67,126),ChapProcess:Uint8Array.of(105,68),ChapProcessCodecID:Uint8Array.of(105,85),ChapProcessPrivate:Uint8Array.of(69,13),ChapProcessCommand:Uint8Array.of(105,17),ChapProcessTime:Uint8Array.of(105,34),ChapProcessData:Uint8Array.of(105,51),Tags:Uint8Array.of(18,84,195,103),Tag:Uint8Array.of(115,115),Targets:Uint8Array.of(99,192),TargetTypeValue:Uint8Array.of(104,202),TargetType:Uint8Array.of(99,202),TagTrackUID:Uint8Array.of(99,197),TagEditionUID:Uint8Array.of(99,201),TagChapterUID:Uint8Array.of(99,196),TagAttachmentUID:Uint8Array.of(99,198),SimpleTag:Uint8Array.of(103,200),TagName:Uint8Array.of(69,163),TagLanguage:Uint8Array.of(68,122),TagDefault:Uint8Array.of(68,132),TagString:Uint8Array.of(68,135),TagBinary:Uint8Array.of(68,133)}},7825:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(8680),t),n(r(4509),t),n(r(2097),t)},2097:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.dumpBytes=t.float32bit=t.int16Bit=t.getNumberByteLength=t.stringToByteArray=t.numberToByteArray=void 0;const n=i(r(7510));function s(e){if(e<0)throw new Error("EBML.typedArrayUtils.getNumberByteLength: negative number not implemented");if(e<256)return 1;if(e<65536)return 2;if(e<16777216)return 3;if(e<4294967296)return 4;if(e<1099511627776)return 5;if(e<281474976710656)return 6;if(e<0x20000000000000n)return 7;throw new Error("EBML.typedArrayUtils.getNumberByteLength: number exceeds Number.MAX_SAFE_INTEGER")}t.numberToByteArray=(e,t=s(e))=>{let r;if(1===t)r=new DataView(new ArrayBuffer(1)),r.setUint8(0,e);else if(2===t)r=new DataView(new ArrayBuffer(2)),r.setUint16(0,e);else if(3===t)r=new DataView(new ArrayBuffer(3)),r.setUint8(0,e>>16),r.setUint16(1,65535&e);else if(4===t)r=new DataView(new ArrayBuffer(4)),r.setUint32(0,e);else if(e<4294967295)r=new DataView(new ArrayBuffer(5)),r.setUint32(1,e);else if(5===t)r=new DataView(new ArrayBuffer(5)),r.setUint8(0,e/4294967296|0),r.setUint32(1,e%4294967296);else if(6===t)r=new DataView(new ArrayBuffer(6)),r.setUint16(0,e/4294967296|0),r.setUint32(2,e%4294967296);else if(7===t)r=new DataView(new ArrayBuffer(7)),r.setUint8(0,e/281474976710656|0),r.setUint16(1,e/4294967296&65535),r.setUint32(3,e%4294967296);else{if(8!==t)throw new Error("EBML.typedArrayUtils.numberToByteArray: byte length must be less than or equal to 8");r=new DataView(new ArrayBuffer(8)),r.setUint32(0,e/4294967296|0),r.setUint32(4,e%4294967296)}return new Uint8Array(r.buffer)},t.stringToByteArray=(0,n.default)((e=>Uint8Array.from(Array.from(e).map((e=>e.codePointAt(0)))))),t.getNumberByteLength=s,t.int16Bit=(0,n.default)((e=>{const t=new ArrayBuffer(2);return new DataView(t).setInt16(0,e),new Uint8Array(t)})),t.float32bit=(0,n.default)((e=>{const t=new ArrayBuffer(4);return new DataView(t).setFloat32(0,e),new Uint8Array(t)}));t.dumpBytes=e=>Array.from(new Uint8Array(e)).map((e=>`0x${e.toString(16)}`)).join(", ")},9479:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.WEBMBuilder=void 0;const o=r(6113),a=r(680),c=r(3924),u=s(r(7825));t.WEBMBuilder=class{constructor(e,t){this.ebmlHeader=u.build(u.element(u.ID.EBML,[u.element(u.ID.EBMLVersion,u.number(1)),u.element(u.ID.EBMLReadVersion,u.number(1)),u.element(u.ID.EBMLMaxIDLength,u.number(4)),u.element(u.ID.EBMLMaxSizeLength,u.number(8)),u.element(u.ID.DocType,u.string("webm")),u.element(u.ID.DocTypeVersion,u.number(2)),u.element(u.ID.DocTypeReadVersion,u.number(2))])),this.trackEntries=[],this.trackIvs={},this.trackKeyIds={},this.encryptionKeyID=(0,o.randomBytes)(16),this.encryptionKey=t,this.trackEntries=e.map((({width:e,height:t,kind:r,codec:i,trackNumber:n})=>{const s=this.createTrackEntry(r,n,i,{width:e,height:t}),a=new Uint32Array(2);return(0,o.randomFillSync)(a),this.trackIvs[n]=a,s}))}createTrackEntry(e,t,r,{width:i,height:n}={}){const s=[];if("video"===e){if(!i||!n)throw new Error;s.push(u.element(u.ID.Video,[u.element(u.ID.PixelWidth,u.number(i)),u.element(u.ID.PixelHeight,u.number(n))]))}else s.push(u.element(u.ID.Audio,[u.element(u.ID.SamplingFrequency,u.float(48e3)),u.element(u.ID.Channels,u.number(2))])),s.push(u.element(u.ID.CodecPrivate,u.bytes(c.OpusRtpPayload.createCodecPrivate())));if(this.encryptionKey){const e=this.encryptionKeyID;this.trackKeyIds[t]=e,s.push(u.element(u.ID.ContentEncodings,u.element(u.ID.ContentEncoding,[u.element(u.ID.ContentEncodingOrder,u.number(0)),u.element(u.ID.ContentEncodingScope,u.number(1)),u.element(u.ID.ContentEncodingType,u.number(1)),u.element(u.ID.ContentEncryption,[u.element(u.ID.EncryptionAlgorithm,u.number(5)),u.element(u.ID.EncryptionKeyID,u.bytes(e)),u.element(u.ID.ContentEncAESSettings,u.element(u.ID.AESSettingsCipherMode,u.number(1)))])])))}return u.element(u.ID.TrackEntry,[u.element(u.ID.TrackNumber,u.number(t)),u.element(u.ID.TrackUID,u.number(t)),u.element(u.ID.CodecName,u.string(r)),u.element(u.ID.TrackType,u.number("video"===e?1:2)),u.element(u.ID.CodecID,u.string(`${"video"===e?"V":"A"}_${r}`)),...s])}createSegment(e){const t=[u.element(u.ID.TimecodeScale,u.number(h)),u.element(u.ID.MuxingApp,u.string("webrtc")),u.element(u.ID.WritingApp,u.string("webrtc"))];return null!=e&&t.push(u.element(u.ID.Duration,u.float(e))),u.build(u.unknownSizeElement(u.ID.Segment,[u.element(u.ID.SeekHead,[]),u.element(u.ID.Info,t),u.element(u.ID.Tracks,this.trackEntries)]))}createDuration(e){return u.build(u.element(u.ID.Duration,u.float(e)))}createCuePoint(e,t,r,i){return u.element(u.ID.CuePoint,[u.element(u.ID.CueTime,u.number(e)),u.element(u.ID.CueTrackPositions,[u.element(u.ID.CueTrack,u.number(t)),u.element(u.ID.CueClusterPosition,u.number(r)),u.element(u.ID.CueBlockNumber,u.number(i))])])}createCues(e){return u.build(u.element(u.ID.Cues,e))}createCluster(e){return u.build(u.unknownSizeElement(u.ID.Cluster,[u.element(u.ID.Timecode,u.number(e))]))}createSimpleBlock(e,t,r,i){const n=Buffer.from([163]);if(this.encryptionKey){const t=new a.BitWriter2(8).set(0).set(0,5).set(0).set(1),i=Buffer.alloc(16),n=this.trackIvs[r];i.writeUInt32BE(n[0],0),i.writeUInt32BE(n[1],4),n[1]++,0===n[1]&&n[0]++;const s=(0,o.createCipheriv)("AES-128-CTR",this.encryptionKey,i);e=Buffer.concat([t.buffer,i.subarray(0,8),s.update(e),s.final()])}const s=u.vintEncodedNumber(4+e.length).bytes,c=t?1:0,h=new a.BitWriter2(8).set(c).set(0,3).set(0).set(0,2).set(0);return Buffer.concat([n,s,u.vintEncodedNumber(r).bytes,new a.BufferChain(2).writeInt16BE(i).buffer,new a.BufferChain(1).writeUInt8(h.value).buffer,e])}};const h=1e6},253:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Int=t.growBufferSize=t.enumerate=void 0,t.enumerate=function(e){return e.map(((e,t)=>[t,e]))},t.growBufferSize=function(e,t){const r=Buffer.alloc(t);return e.copy(r),r},t.Int=function(e){return parseInt(e.toString(),10)}},3924:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),r(4300),n(r(680),t),n(r(8668),t),n(r(279),t),n(r(5252),t),n(r(7723),t),n(r(8195),t),n(r(6482),t),n(r(2855),t),n(r(3456),t),n(r(1589),t),n(r(9670),t),n(r(4937),t),n(r(6775),t),n(r(2203),t),n(r(6774),t),n(r(132),t),n(r(1787),t),n(r(5948),t),n(r(7777),t),n(r(9913),t)},1327:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DepacketizeBase=void 0;const n=i(r(5493)),s=i(r(5473)),o=r(3924),a=r(8668),c=r(253),u=(0,n.default)("werift-rtp : packages/rtp/src/processor/depacketizer.ts");t.DepacketizeBase=class{constructor(e,t={}){this.codec=e,this.options=t,this.buffering=[],this.frameBroken=!1,this.keyframeReceived=!1,this.sequence=0,this.onNeedKeyFrame=new s.default}processInput(e){const t=[];if(!e.rtp)return e.eol&&t.push({eol:!0}),t;if(this.options.isFinalPacketInSequence){if(this.checkFinalPacket(e))try{const{data:e,isKeyframe:r,sequence:i,timestamp:n}=(0,a.dePacketizeRtpPackets)(this.codec,this.buffering.map((e=>e.rtp)));if(r&&(this.keyframeReceived=!0),this.options.waitForKeyframe&&!1===this.keyframeReceived)return this.onNeedKeyFrame.execute(),[];if(!this.frameBroken){const s=this.buffering.at(-1)?.time??0;t.push({frame:{data:e,isKeyframe:r,time:s,sequence:this.sequence++,rtpSeq:i,timestamp:n}})}return this.frameBroken&&(this.frameBroken=!1),this.clearBuffer(),t}catch(t){u("error",t,e),this.clearBuffer()}}else try{const{data:r,isKeyframe:i,sequence:n,timestamp:s}=(0,a.dePacketizeRtpPackets)(this.codec,[e.rtp]);return t.push({frame:{data:r,isKeyframe:i,time:e.time,sequence:this.sequence++,rtpSeq:n,timestamp:s}}),t}catch(t){u("error",t,e)}return[]}clearBuffer(){this.buffering.forEach((e=>e.rtp.clear())),this.buffering=[]}checkFinalPacket({rtp:e,time:t}){if(!this.options.isFinalPacketInSequence)throw new Error("isFinalPacketInSequence not exist");const{sequenceNumber:r}=e.header;if(null!=this.lastSeqNum){const e=(0,o.uint16Add)(this.lastSeqNum,1);if((0,o.uint16Gt)(e,r))return u("unexpect",{expect:e,sequenceNumber:r}),!1;(0,o.uint16Gt)(r,e)&&(u("packet lost happened",{expect:e,sequenceNumber:r}),this.frameBroken=!0,this.clearBuffer())}let i;this.buffering.push({rtp:e,time:t}),this.lastSeqNum=r;for(const[e,{rtp:t}]of(0,c.enumerate)(this.buffering))if(this.options.isFinalPacketInSequence(t.header)){i=e;break}return null!=i}}},5317:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DepacketizeCallback=void 0;const i=r(1327);class n extends i.DepacketizeBase{constructor(e,t={}){super(e,t),this.pipe=e=>(this.cb=e,this),this.input=e=>{for(const t of this.processInput(e))this.cb(t)}}}t.DepacketizeCallback=n},6133:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.depacketizeTransformer=void 0;const i=r(5356),n=r(1327);t.depacketizeTransformer=(...e)=>new s(...e).transform;class s extends n.DepacketizeBase{constructor(e,t={}){super(e,t),this.transform=new i.TransformStream({transform:(e,t)=>{for(const r of this.processInput(e))t.enqueue(r)}})}}},279:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(1327),t),n(r(5317),t),n(r(6133),t),n(r(4763),t),n(r(936),t),n(r(7130),t),n(r(970),t),n(r(2813),t),n(r(7385),t),n(r(2903),t),n(r(2164),t),n(r(1549),t),n(r(7667),t),n(r(956),t),n(r(5696),t),n(r(9682),t)},4763:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.JitterBufferBase=void 0;const n=i(r(5493)),s=r(3924),o=(0,n.default)("werift-rtp : packages/rtp/src/processor/jitterBuffer.ts");t.JitterBufferBase=class{get expectNextSeqNum(){return(0,s.uint16Add)(this.presentSeqNum,1)}constructor(e,t={}){this.clockRate=e,this.rtpBuffer={},this.options={latency:t.latency??200,bufferSize:t.bufferSize??1e4}}processInput(e){const t=[];if(!e.rtp){if(e.eol){const e=this.sortAndClearBuffer(this.rtpBuffer);for(const r of e)t.push({rtp:r});t.push({eol:!0})}return t}const{packets:r,timeoutSeqNum:i}=this.processRtp(e.rtp);if(null!=i){const n={from:this.expectNextSeqNum,to:i};if(this.presentSeqNum=e.rtp.header.sequenceNumber,t.push({isPacketLost:n}),r)for(const i of[...r,e.rtp])t.push({rtp:i});return t}if(r){for(const e of r)t.push({rtp:e});return t}return[]}processRtp(e){const{sequenceNumber:t,timestamp:r}=e.header;if(null==this.presentSeqNum)return this.presentSeqNum=t,{packets:[e]};if((0,s.uint16Gte)(this.presentSeqNum,t))return o("duplicate",{sequenceNumber:t}),{nothing:void 0};if(t===this.expectNextSeqNum){this.presentSeqNum=t;const i=this.resolveBuffer((0,s.uint16Add)(t,1));return this.presentSeqNum=i.at(-1)?.header.sequenceNumber??this.presentSeqNum,this.disposeTimeoutPackets(r),{packets:[e,...i]}}this.pushRtpBuffer(e);const{latestTimeoutSeqNum:i,sorted:n}=this.disposeTimeoutPackets(r);return i?{timeoutSeqNum:i,packets:n}:{nothing:void 0}}pushRtpBuffer(e){Object.values(this.rtpBuffer).length>this.options.bufferSize?o("buffer over flow"):this.rtpBuffer[e.header.sequenceNumber]=e}resolveBuffer(e){const t=[];for(let r=e;;r=(0,s.uint16Add)(r,1)){const e=this.rtpBuffer[r];if(!e)break;t.push(e),delete this.rtpBuffer[r]}return t}sortAndClearBuffer(e){const t=[];for(let r=this.presentSeqNum??0;;r=(0,s.uint16Add)(r,1)){const i=e[r];if(i&&(t.push(i),delete e[r]),0===Object.values(e).length)break}return t}disposeTimeoutPackets(e){let t;const r=Object.values(this.rtpBuffer).map((r=>{const{timestamp:i,sequenceNumber:n}=r.header;if((0,s.uint32Gt)(i,e))return;const a=(0,s.uint32Add)(e,-i)/this.clockRate;if(1e3*a>this.options.latency){o("timeout packet",{sequenceNumber:n,elapsedSec:a,baseTimestamp:e,timestamp:i}),null==t&&(t=n),(0,s.uint16Add)(n,-this.presentSeqNum)>(0,s.uint16Add)(t,-this.presentSeqNum)&&(t=n);const r=this.rtpBuffer[n];return delete this.rtpBuffer[n],r}})).flatMap((e=>e)).filter((e=>e)),i=this.sortAndClearBuffer(r.reduce(((e,t)=>(e[t.header.sequenceNumber]=t,e)),{}));return{latestTimeoutSeqNum:t,sorted:i}}}},936:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JitterBufferCallback=void 0;const i=r(4763);class n extends i.JitterBufferBase{constructor(e,t={}){super(e,t),this.clockRate=e,this.pipe=e=>(this.cb=e,this),this.input=e=>{for(const t of this.processInput(e))this.cb(t)}}}t.JitterBufferCallback=n},7130:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JitterBufferTransformer=t.jitterBufferTransformer=void 0;const i=r(5356),n=r(4763);t.jitterBufferTransformer=(...e)=>new s(...e).transform;class s extends n.JitterBufferBase{constructor(e,t={}){super(e,t),this.clockRate=e,this.transform=new i.TransformStream({transform:(e,t)=>{for(const r of this.processInput(e))t.enqueue(r)}})}}t.JitterBufferTransformer=s},970:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LipsyncBase=void 0;const i=r(680);t.LipsyncBase=class{constructor(e,t,r={}){this.audioOutput=e,this.videoOutput=t,this.options=r,this.stopped=!1,this.started=!1,this.lastCommited=0,this.processAudioInput=({frame:e,eol:t})=>{if(!e)return this.stopped=!0,void this.audioOutput({eol:t});if(this.stopped)return;null==this.baseTime&&(this.baseTime=e.time);const r=e.time-this.baseTime;if(r<0||r<this.lastCommited)return;const n=(0,i.int)(r/this.interval)%this.bufferLength;this.audioBuffer[n].push({frame:e,elapsed:r,kind:"audio",seq:e.sequence}),this.start()},this.processVideoInput=({frame:e,eol:t})=>{if(!e)return this.stopped=!0,void this.videoOutput({eol:t});if(this.stopped)return;null==this.baseTime&&(this.baseTime=e.time);const r=e.time-this.baseTime;if(r<0||r<this.lastCommited)return;const n=(0,i.int)(r/this.interval)%this.bufferLength;this.videoBuffer[n].push({frame:e,elapsed:r,kind:"video",seq:e.sequence}),this.start()},this.bufferLength=this.options.bufferLength??50,this.audioBuffer=[...new Array(this.bufferLength)].map((()=>[])),this.videoBuffer=[...new Array(this.bufferLength)].map((()=>[])),this.interval=this.options.interval??500}start(){if(0===[...this.audioBuffer[1],...this.videoBuffer[1]].length)return;if(this.started)return;this.started=!0;let e=0;setInterval((()=>{const t=[...this.audioBuffer[e],...this.videoBuffer[e]].filter((e=>e.elapsed>=this.lastCommited)).sort(((e,t)=>e.frame.time-t.frame.time));this.audioBuffer[e]=[],this.videoBuffer[e]=[];for(const e of t)"audio"===e.kind?this.audioOutput(e):this.videoOutput(e),this.lastCommited=e.elapsed;e++,e===this.bufferLength&&(e=0)}),this.interval)}}},2813:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LipsyncCallback=void 0;const i=r(970);class n extends i.LipsyncBase{constructor(e={}){super((e=>{this.audioCb&&this.audioCb(e)}),(e=>{this.videoCb&&this.videoCb(e)}),e),this.pipeAudio=e=>{this.audioCb=e},this.pipeVideo=e=>{this.videoCb=e},this.inputAudio=this.processAudioInput,this.inputVideo=this.processVideoInput}}t.LipsyncCallback=n},7385:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ntpTime2Time=t.syncRtpBase=void 0;const n=i(r(5493)),s=r(3924),o=r(7288),a=(0,n.default)("werift-rtp : packages/rtp/src/processor/ntpTime.ts");t.syncRtpBase=class{constructor(e){this.clockRate=e,this.buffer=[]}processInput({rtcp:e,rtp:t,eol:r}){if(r)return[{eol:!0}];if(e&&e instanceof s.RtcpSrPacket&&!this.ntpTimestamp){const{ntpTimestamp:t,rtpTimestamp:r}=e.senderInfo;this.ntpTimestamp=t,this.rtpTimestamp=r}if(t){this.buffer.push(t);const e=[];return this.buffer=this.buffer.map((t=>{const r=this.calcNtp(t.header.timestamp);if(!r)return t;{const i=1e3*r;e.push({rtp:t,time:i})}})).filter((e=>null!=e)),e}return[]}calcNtp(e){if(null==this.rtpTimestamp||null==this.ntpTimestamp)return;e-this.rtpTimestamp>o.Max32bit-60*this.clockRate?(this.rtpTimestamp+=o.Max32bit,a("base rtpTimestamp is rollover")):e+(o.Max32bit-60*this.clockRate)-this.rtpTimestamp<0&&(e+=o.Max32bit,a("target rtpTimestamp is rollover"));const r=(e-this.rtpTimestamp)/this.clockRate;return(0,t.ntpTime2Time)(this.ntpTimestamp)+r}};t.ntpTime2Time=e=>{const[t,r]=(0,s.bufferReader)((0,s.bufferWriter)([8],[e]),[4,4]);return Number(`${t}.${r}`)}},2903:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NtpTimeCallback=void 0;const i=r(7385);class n extends i.syncRtpBase{constructor(e){super(e),this.pipe=e=>(this.cb=e,this),this.input=e=>{for(const t of this.processInput(e))this.cb(t)}}}t.NtpTimeCallback=n},2164:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RtpTimeBase=void 0;const i=r(3924);t.RtpTimeBase=class{constructor(e){this.clockRate=e,this.elapsed=0}processInput({rtp:e,eol:t}){if(t)return[{eol:!0}];if(e){return[{rtp:e,time:this.update(e.header.timestamp)}]}return[]}update(e){null==this.baseTimestamp&&(this.baseTimestamp=e);const t=Math.abs(e-this.baseTimestamp)>i.Max32Uint/4*3?e+i.Max32Uint-this.baseTimestamp:e-this.baseTimestamp;return this.elapsed=(0,i.int)(t/this.clockRate*1e3),this.elapsed}}},1549:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RtpTimeCallback=void 0;const i=r(2164);class n extends i.RtpTimeBase{constructor(e){super(e),this.pipe=e=>(this.cb=e,this),this.input=e=>{for(const t of this.processInput(e))this.cb(t)}}}t.RtpTimeCallback=n},7667:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(1299),t),n(r(1785),t),n(r(5405),t)},1299:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RtcpSourceCallback=void 0;const n=i(r(5473));t.RtcpSourceCallback=class{constructor(){this.onStopped=new n.default,this.input=e=>{this.cb&&this.cb({rtcp:e})}}pipe(e){this.cb=e}stop(){this.cb&&this.cb({eol:!0}),this.onStopped.execute()}}},1785:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RtpSourceCallback=void 0;const n=i(r(5473)),s=r(5948);t.RtpSourceCallback=class{constructor(e={}){this.options=e,this.onStopped=new n.default,this.input=e=>{const t=e instanceof s.RtpPacket?e:s.RtpPacket.deSerialize(e);null==this.options.payloadType||this.options.payloadType===t.header.payloadType?this.cb&&this.cb({rtp:t}):this.options.clearInvalidPTPacket&&t.clear()},e.clearInvalidPTPacket=e.clearInvalidPTPacket??!0}pipe(e){this.cb=e}stop(){this.cb&&this.cb({eol:!0}),this.onStopped.execute()}}},5405:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RtpSourceStream=void 0;const i=r(5356),n=r(5948);t.RtpSourceStream=class{constructor(e={}){this.options=e,this.push=e=>{const t=e instanceof n.RtpPacket?e:n.RtpPacket.deSerialize(e);null==this.options.payloadType||this.options.payloadType===t.header.payloadType?this.write({rtp:t}):this.options.clearInvalidPTPacket&&t.clear()},e.clearInvalidPTPacket=e.clearInvalidPTPacket??!0,this.readable=new i.ReadableStream({start:e=>{this.controller=e,this.write=t=>e.enqueue(t)}})}stop(){this.controller.enqueue({eol:!0})}}},956:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.replaceSegmentSize=t.SegmentSizePosition=t.DurationPosition=t.MaxSinged16Int=t.Max32Uint=t.WebmBase=void 0;const n=i(r(5493)),s=r(7825),o=r(9479),a=(0,n.default)("werift-rtp : packages/rtp/src/processor/webm.ts");t.WebmBase=class{constructor(e,t,r={}){this.tracks=e,this.output=t,this.options=r,this.relativeTimestamp=0,this.timestamps={},this.cuePoints=[],this.position=0,this.clusterCounts=0,this.audioStopped=!1,this.videoStopped=!1,this.stopped=!1,this.videoKeyframeReceived=!1,this.processAudioInput=e=>{const t=this.tracks.find((e=>"audio"===e.kind));t&&this.processInput(e,t.trackNumber)},this.processVideoInput=e=>{e.frame?.isKeyframe&&(this.videoKeyframeReceived=!0);const t=this.tracks.find((e=>"video"===e.kind));t&&this.processInput(e,t.trackNumber)},this.builder=new o.WEBMBuilder(e,r.encryptionKey),e.forEach((e=>{this.timestamps[e.trackNumber]=new c}))}processInput(e,t){if(this.stopped)return;const r=this.tracks.find((e=>e.trackNumber===t));if(!r)throw new Error("track not found");e.frame?("audio"===r.kind?this.audioStopped=!1:this.videoStopped=!1,this.onFrameReceived({...e.frame,trackNumber:t})):2===this.tracks.length?"audio"===r.kind?(this.audioStopped=!0,this.videoStopped&&this.stop()):(this.videoStopped=!0,this.audioStopped&&this.stop()):e.eol&&this.stop()}start(){const e=Buffer.concat([this.builder.ebmlHeader,this.builder.createSegment(this.options.duration)]);this.output({saveToFile:e,kind:"initial"}),this.position+=e.length;const t=this.tracks.find((e=>"video"===e.kind));t&&this.cuePoints.push(new u(this.builder,t.trackNumber,0,this.position))}onFrameReceived(e){const r=this.tracks.find((t=>t.trackNumber===e.trackNumber));if(!r)return;const i=this.timestamps[r.trackNumber];if(null==i.baseTime)for(const t of Object.values(this.timestamps))t.baseTime=e.time;let n=i.update(e.time);0===this.clusterCounts?this.createCluster(0,0):("video"===r.kind&&e.isKeyframe||n>t.MaxSinged16Int)&&(this.relativeTimestamp+=n,0!==n&&(this.cuePoints.push(new u(this.builder,r.trackNumber,this.relativeTimestamp,this.position)),this.createCluster(this.relativeTimestamp,n),Object.values(this.timestamps).forEach((e=>e.shift(n))),n=i.update(e.time))),n>=0?this.createSimpleBlock({frame:e,trackNumber:r.trackNumber,elapsed:n}):a("delayed frame",{elapsed:n})}createCluster(e,t){const r=this.builder.createCluster(e);this.clusterCounts++,this.output({saveToFile:Buffer.from(r),kind:"cluster",previousDuration:t}),this.position+=r.length,this.elapsed=void 0}createSimpleBlock({frame:e,trackNumber:t,elapsed:r}){if(null==this.elapsed&&(this.elapsed=r),r<this.elapsed&&this.options.strictTimestamp)return void a("previous timestamp",{elapsed:r,present:this.elapsed,trackNumber:t});this.elapsed=r;const i=this.builder.createSimpleBlock(e.data,e.isKeyframe,t,r);this.output({saveToFile:i,kind:"block"}),this.position+=i.length;const[n]=this.cuePoints.slice(-1);n&&n.blockNumber++}stop(){if(this.stopped)return;this.stopped=!0,a("stop");const e=Object.values(this.timestamps).sort(((e,t)=>e.elapsed-t.elapsed)).reverse()[0].elapsed,t=this.relativeTimestamp+e,r=this.builder.createCues(this.cuePoints.map((e=>e.build())));this.output({saveToFile:Buffer.from(r),kind:"cuePoints",previousDuration:t});const i=this.builder.createDuration(t),n=Buffer.concat([this.builder.ebmlHeader,this.builder.createSegment(t)]);this.output({eol:{duration:t,durationElement:i,header:n}})}};class c{constructor(){this.elapsed=0,this.offset=0}shift(e){this.offset+=e}update(e){if(null==this.baseTime)throw new Error("baseTime not exist");return this.elapsed=e-this.baseTime-this.offset,this.elapsed}}class u{constructor(e,t,r,i){this.builder=e,this.trackNumber=t,this.relativeTimestamp=r,this.position=i,this.cuesLength=0,this.blockNumber=0}build(){return this.builder.createCuePoint(this.relativeTimestamp,this.trackNumber,this.position-48+this.cuesLength,this.blockNumber)}}t.Max32Uint=Number(0x01n<<32n)-1,t.MaxSinged16Int=32767,t.DurationPosition=83,t.SegmentSizePosition=40,t.replaceSegmentSize=function(e){const r=e-t.SegmentSizePosition,i=[...(0,s.vintEncode)((0,s.numberToByteArray)(r,(0,s.getEBMLByteLength)(r)))],n=8-i.length-2;if(n>0&&(i.push(236),n>1)){[...(0,s.vintEncode)((0,s.numberToByteArray)(n,(0,s.getEBMLByteLength)(n)))].forEach((e=>i.push(e)))}return Buffer.from(i)}},5696:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.saveToFileSystem=t.WebmCallback=void 0;const i=r(3292),n=r(680),s=r(956);class o extends s.WebmBase{constructor(e,t={}){super(e,(e=>{this.cb&&this.queue.push((()=>this.cb(e)))}),t),this.queue=new n.PromiseQueue,this.pipe=e=>{this.cb=e,this.start()},this.inputAudio=this.processAudioInput,this.inputVideo=this.processVideoInput}}t.WebmCallback=o;t.saveToFileSystem=e=>async t=>{if(t.saveToFile)await(0,i.appendFile)(e,t.saveToFile);else if(t.eol){const{durationElement:r}=t.eol,n=await(0,i.open)(e,"r+");await n.write(r,0,r.length,s.DurationPosition);const o=await(0,i.stat)(e),a=(0,s.replaceSegmentSize)(o.size);await n.write(a,0,a.length,s.SegmentSizePosition),await n.close()}}},9682:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebmStream=void 0;const i=r(5356),n=r(956);class s extends n.WebmBase{constructor(e,t={}){super(e,(e=>{this.controller.enqueue(e)}),t);e.find((e=>"audio"===e.kind))&&(this.audioStream=new i.WritableStream({write:e=>{this.processAudioInput(e)}}));e.find((e=>"video"===e.kind))&&(this.videoStream=new i.WritableStream({write:e=>{this.processVideoInput(e)}})),this.webmStream=new i.ReadableStream({start:e=>{this.controller=e}}),this.start()}}t.WebmStream=s},6380:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Output=t.Pipeline=void 0;t.Pipeline=class{constructor(e){const t=[];{const{unSubscribe:r}=e?.rtpStream?.subscribe?.((e=>{this.pushRtpPackets([e])}))??{};t.push(r)}{const{unSubscribe:r}=e?.rtcpStream?.subscribe?.((e=>{this.pushRtcpPackets([e])}))??{};t.push(r)}this.disposer=()=>{t.forEach((e=>e?.()))}}pipe(e){return this.children=e,this}pushRtpPackets(e){}pushRtcpPackets(e){}stop(){this.disposer?.()}};t.Output=class{pushRtpPackets(e){}pushRtcpPackets(e){}}},7288:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Max32bit=t.ntpTime2Time=t.LipSync=void 0;const i=r(680),n=r(3924),s=r(6380);class o extends s.Pipeline{constructor(e,t,r){super(r),this.clockRate=e,this.mismatch=t,this.rtpPackets={}}pushRtcpPackets(e){e.forEach((e=>{e instanceof n.RtcpSrPacket&&this.srReceived(e)})),this.children?.pushRtcpPackets?.(e)}srReceived(e){const{ntpTimestamp:t,rtpTimestamp:r}=e.senderInfo;this.baseNtpTimestamp=t,this.baseRtpTimestamp=r}pushRtpPackets(e){if(e.forEach((e=>{this.rtpPackets[e.header.payloadType]=this.rtpPackets[e.header.payloadType]??[],this.rtpPackets[e.header.payloadType].push(e)})),2===Object.keys(this.rtpPackets).length){const[t,r]=Object.values(this.rtpPackets),i=this.calcNtpTime(t.at(-1).header.timestamp),n=this.calcNtpTime(r.at(-1).header.timestamp);null!=i&&null!=n||this.children?.pushRtpPackets?.(e)}}calcNtpTime(e){if(!this.baseRtpTimestamp||!this.baseNtpTimestamp)return;e-this.baseRtpTimestamp>t.Max32bit-60*this.clockRate?this.baseRtpTimestamp+=t.Max32bit:e+(t.Max32bit-60*this.clockRate)-this.baseRtpTimestamp<0&&(e+=t.Max32bit);const r=(e-this.baseRtpTimestamp)/this.clockRate;return(0,t.ntpTime2Time)(this.baseNtpTimestamp)+r}}t.LipSync=o;t.ntpTime2Time=e=>{const[t,r]=(0,i.bufferReader)((0,i.bufferWriter)([8],[e]),[4,4]);return Number(`${t}.${r}`)},t.Max32bit=Number((0x01n<<32n)-1n)},5252:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RtcpHeader=t.RTCP_HEADER_SIZE=void 0;const i=r(680);t.RTCP_HEADER_SIZE=4;class n{constructor(e={}){this.version=2,this.padding=!1,this.count=0,this.type=0,this.length=0,Object.assign(this,e)}serialize(){const e=new i.BitWriter(8);e.set(2,0,this.version),this.padding&&e.set(1,2,1),e.set(5,3,this.count);return(0,i.bufferWriter)([1,1,2],[e.value,this.type,this.length])}static deSerialize(e){const[t,r,s]=(0,i.bufferReader)(e,[1,1,2]),o=(0,i.getBit)(t,0,2),a=(0,i.getBit)(t,2,1)>0,c=(0,i.getBit)(t,3,5);return new n({version:o,padding:a,count:c,type:r,length:s})}}t.RtcpHeader=n},3468:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FullIntraRequest=void 0;const i=r(680);class n{constructor(e={}){this.count=n.count,this.fir=[],Object.assign(this,e)}get length(){return Math.floor(this.serialize().length/4-1)}static deSerialize(e){const[t,r]=(0,i.bufferReader)(e,[4,4]),s=[];for(let t=8;t<e.length;t+=8)s.push({ssrc:e.readUInt32BE(t),sequenceNumber:e[t+4]});return new n({senderSsrc:t,mediaSsrc:r,fir:s})}serialize(){const e=(0,i.bufferWriter)([4,4],[this.senderSsrc,this.mediaSsrc]),t=Buffer.alloc(8*this.fir.length);return this.fir.forEach((({ssrc:e,sequenceNumber:r},i)=>{t.writeUInt32BE(e,8*i),t[8*i+4]=r})),Buffer.concat([e,t])}}t.FullIntraRequest=n,n.count=4},7723:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RtcpPayloadSpecificFeedback=void 0;const n=i(r(5493)),s=r(3456),o=r(3468),a=r(8195),c=r(6482),u=(0,n.default)("werift/rtp/rtcp/psfb/index");class h{constructor(e={}){this.type=h.type,Object.assign(this,e)}serialize(){const e=this.feedback.serialize();return s.RtcpPacketConverter.serialize(this.type,this.feedback.count,e,this.feedback.length)}static deSerialize(e,t){let r;switch(t.count){case o.FullIntraRequest.count:r=o.FullIntraRequest.deSerialize(e);break;case a.PictureLossIndication.count:r=a.PictureLossIndication.deSerialize(e);break;case c.ReceiverEstimatedMaxBitrate.count:r=c.ReceiverEstimatedMaxBitrate.deSerialize(e);break;default:u("unknown psfb packet",t.count)}return new h({feedback:r})}}t.RtcpPayloadSpecificFeedback=h,h.type=206},8195:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PictureLossIndication=void 0;const i=r(680);class n{constructor(e={}){this.count=n.count,this.length=2,Object.assign(this,e)}static deSerialize(e){const[t,r]=(0,i.bufferReader)(e,[4,4]);return new n({senderSsrc:t,mediaSsrc:r})}serialize(){return(0,i.bufferWriter)([4,4],[this.senderSsrc,this.mediaSsrc])}}t.PictureLossIndication=n,n.count=1},6482:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReceiverEstimatedMaxBitrate=void 0;const i=r(680);class n{constructor(e={}){this.count=n.count,this.uniqueID="REMB",this.ssrcNum=0,this.ssrcFeedbacks=[],Object.assign(this,e)}static deSerialize(e){const[t,r,s,o,a]=(0,i.bufferReader)(e,[4,4,4,1,1]),c=(0,i.getBit)(a,0,6),u=((0,i.getBit)(a,6,2)<<16)+(e[14]<<8)+e[15],h=c>46?18446744073709551615n:BigInt(u)<<BigInt(c),d=[];for(let t=16;t<e.length;t+=4){const r=e.slice(t).readUIntBE(0,4);d.push(r)}return new n({senderSsrc:t,mediaSsrc:r,uniqueID:(0,i.bufferWriter)([4],[s]).toString(),ssrcNum:o,brExp:c,brMantissa:u,ssrcFeedbacks:d,bitrate:h})}serialize(){const e=Buffer.concat([(0,i.bufferWriter)([4,4],[this.senderSsrc,this.mediaSsrc]),Buffer.from(this.uniqueID),(0,i.bufferWriter)([1],[this.ssrcNum])]),t=new i.BitWriter(24);t.set(6,0,this.brExp).set(18,6,this.brMantissa);const r=Buffer.concat(this.ssrcFeedbacks.map((e=>(0,i.bufferWriter)([4],[e])))),n=Buffer.concat([e,(0,i.bufferWriter)([3],[t.value]),r]);return this.length=n.length/4,n}}t.ReceiverEstimatedMaxBitrate=n,n.count=15},2855:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RtcpReceiverInfo=t.RtcpRrPacket=void 0;const n=i(r(201)),s=r(680),o=r(3456);class a{constructor(e={}){this.ssrc=0,this.reports=[],this.type=a.type,Object.assign(this,e)}serialize(){let e=(0,s.bufferWriter)([4],[this.ssrc]);return e=Buffer.concat([e,...this.reports.map((e=>e.serialize()))]),o.RtcpPacketConverter.serialize(a.type,this.reports.length,e,Math.floor(e.length/4))}static deSerialize(e,t){const[r]=(0,s.bufferReader)(e,[4]);let i=4;const o=[];return(0,n.default)(t).forEach((()=>{o.push(c.deSerialize(e.slice(i,i+24))),i+=24})),new a({ssrc:r,reports:o})}}t.RtcpRrPacket=a,a.type=201;class c{constructor(e={}){Object.assign(this,e)}serialize(){return(0,s.bufferWriter)([4,1,3,4,4,4,4],[this.ssrc,this.fractionLost,this.packetsLost,this.highestSequence,this.jitter,this.lsr,this.dlsr])}static deSerialize(e){const[t,r,i,n,o,a,u]=(0,s.bufferReader)(e,[4,1,3,4,4,4,4]);return new c({ssrc:t,fractionLost:r,packetsLost:i,highestSequence:n,jitter:o,lsr:a,dlsr:u})}}t.RtcpReceiverInfo=c},3456:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isRtcp=t.RtcpPacketConverter=void 0;const n=i(r(5493)),s=r(5252),o=r(7723),a=r(2855),c=r(1589),u=r(6775),h=r(2203),d=(0,n.default)("werift-rtp:packages/rtp/src/rtcp/rtcp.ts");t.RtcpPacketConverter=class{static serialize(e,t,r,i){const n=new s.RtcpHeader({type:e,count:t,version:2,length:i}).serialize();return Buffer.concat([n,r])}static deSerialize(e){let t=0;const r=[];for(;t<e.length;){const i=s.RtcpHeader.deSerialize(e.subarray(t,t+s.RTCP_HEADER_SIZE));t+=s.RTCP_HEADER_SIZE;let n=e.subarray(t);t+=4*i.length,i.padding&&(n=n.subarray(0,n.length-n.subarray(-1)[0]));try{switch(i.type){case h.RtcpSrPacket.type:r.push(h.RtcpSrPacket.deSerialize(n,i.count));break;case a.RtcpRrPacket.type:r.push(a.RtcpRrPacket.deSerialize(n,i.count));break;case u.RtcpSourceDescriptionPacket.type:r.push(u.RtcpSourceDescriptionPacket.deSerialize(n,i));break;case c.RtcpTransportLayerFeedback.type:r.push(c.RtcpTransportLayerFeedback.deSerialize(n,i));break;case o.RtcpPayloadSpecificFeedback.type:r.push(o.RtcpPayloadSpecificFeedback.deSerialize(n,i))}}catch(e){d("deSerialize RTCP",e)}}return r}},t.isRtcp=function(e){return e.length>=2&&e[1]>=192&&e[1]<=208}},1589:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RtcpTransportLayerFeedback=void 0;const n=i(r(5493)),s=r(9670),o=r(4937),a=(0,n.default)("werift-rtp:packages/rtp/rtcp/rtpfb/index");class c{constructor(e={}){this.type=c.type,Object.assign(this,e)}serialize(){return this.feedback.serialize()}static deSerialize(e,t){let r;switch(t.count){case s.GenericNack.count:r=s.GenericNack.deSerialize(e,t);break;case o.TransportWideCC.count:r=o.TransportWideCC.deSerialize(e,t);break;default:a("unknown rtpfb packet",t.count)}return new c({feedback:r,header:t})}}t.RtcpTransportLayerFeedback=c,c.type=205},9670:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GenericNack=void 0;const n=i(r(201)),s=r(680),o=r(5252),a=r(1589);class c{toJSON(){return{lost:this.lost,senderSsrc:this.senderSsrc,mediaSourceSsrc:this.mediaSourceSsrc}}constructor(e={}){this.count=c.count,this.lost=[],Object.assign(this,e),this.header||(this.header=new o.RtcpHeader({type:a.RtcpTransportLayerFeedback.type,count:this.count,version:2}))}static deSerialize(e,t){const[r,i]=(0,s.bufferReader)(e,[4,4]),o=(0,n.default)(8,e.length,4).map((t=>{const r=[],[i,o]=(0,s.bufferReader)(e.subarray(t),[2,2]);return r.push(i),(0,n.default)(0,16).forEach((e=>{o>>e&1&&r.push(i+e+1)})),r})).flatMap((e=>e));return new c({header:t,senderSsrc:r,mediaSourceSsrc:i,lost:o})}serialize(){const e=(0,s.bufferWriter)([4,4],[this.senderSsrc,this.mediaSourceSsrc]),t=[];if(this.lost.length>0){let e=this.lost[0],r=0;this.lost.slice(1).forEach((i=>{const n=i-e-1;n>=0&&n<16?r|=1<<n:(t.push((0,s.bufferWriter)([2,2],[e,r])),e=i,r=0)})),t.push((0,s.bufferWriter)([2,2],[e,r]))}const r=Buffer.concat([e,Buffer.concat(t)]);return this.header.length=r.length/4,Buffer.concat([this.header.serialize(),r])}}t.GenericNack=c,c.count=1},4937:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PacketResult=t.PacketStatus=t.PacketChunk=t.RecvDelta=t.StatusVectorChunk=t.RunLengthChunk=t.TransportWideCC=void 0;const n=i(r(5493)),s=i(r(201)),o=r(680),a=r(5252),c=(0,n.default)("werift/rtp/rtcp/rtpfb/twcc");class u{constructor(e={}){this.count=u.count,this.length=2,this.packetChunks=[],this.recvDeltas=[],Object.assign(this,e),this.header||(this.header=new a.RtcpHeader({type:205,count:this.count,version:2}))}static deSerialize(e,t){const[r,i,n,a,c,y]=(0,o.bufferReader)(e,[4,4,2,2,3,1]),m=[],g=[];let b=16;for(let t=0;t<a;){let r;switch((0,o.getBit)(e.slice(b,b+1)[0],0,1)){case f.TypeTCCRunLengthChunk:{const i=h.deSerialize(e.slice(b,b+2));r=i;const n=Math.min(a-t,i.runLength);i.packetStatus!==p.TypeTCCPacketReceivedSmallDelta&&i.packetStatus!==p.TypeTCCPacketReceivedLargeDelta||(0,s.default)(n).forEach((()=>{g.push(new l({type:i.packetStatus}))})),t+=n}break;case f.TypeTCCStatusVectorChunk:{const i=d.deSerialize(e.slice(b,b+2));r=i,0===i.symbolSize&&i.symbolList.forEach((e=>{e===p.TypeTCCPacketReceivedSmallDelta&&g.push(new l({type:p.TypeTCCPacketReceivedSmallDelta}))})),1===i.symbolSize&&i.symbolList.forEach((e=>{e!==p.TypeTCCPacketReceivedSmallDelta&&e!==p.TypeTCCPacketReceivedLargeDelta||g.push(new l({type:e}))})),t+=i.symbolList.length}}if(!r)throw new Error;b+=2,m.push(r)}let v=b;return g.forEach((t=>{t.type===p.TypeTCCPacketReceivedSmallDelta&&(t.deSerialize(e.slice(v,v+1)),v++),t.type===p.TypeTCCPacketReceivedLargeDelta&&(t.deSerialize(e.slice(v,v+2)),v+=2)})),new u({senderSsrc:r,mediaSourceSsrc:i,baseSequenceNumber:n,packetStatusCount:a,referenceTime:c,fbPktCount:y,recvDeltas:g,packetChunks:m,header:t})}serialize(){const e=(0,o.bufferWriter)([4,4,2,2,3,1],[this.senderSsrc,this.mediaSourceSsrc,this.baseSequenceNumber,this.packetStatusCount,this.referenceTime,this.fbPktCount]),t=Buffer.concat(this.packetChunks.map((e=>e.serialize()))),r=Buffer.concat(this.recvDeltas.map((e=>{try{return e.serialize()}catch(e){return void c(e?.message)}})).filter((e=>e))),i=Buffer.concat([e,t,r]);if(this.header.padding&&i.length%4!=0){const e=4-i.length%4,t=Buffer.alloc(e);return t[t.length-1]=t.length,this.header.length=Math.floor((i.length+t.length)/4),Buffer.concat([this.header.serialize(),i,t])}return this.header.length=Math.floor(i.length/4),Buffer.concat([this.header.serialize(),i])}get packetResults(){const e=this.baseSequenceNumber-1,t=this.packetChunks.filter((e=>e instanceof h)).map((t=>t.results(e))).flatMap((e=>e));let r=0;let i=64n*BigInt(this.referenceTime);for(const e of t){const t=this.recvDeltas[r];e.received&&t&&(i+=BigInt(t.delta)/1000n,e.delta=t.delta,e.receivedAtMs=Number(i),r++)}return t}}t.TransportWideCC=u,u.count=15;class h{constructor(e={}){Object.assign(this,e),this.type=f.TypeTCCRunLengthChunk}static deSerialize(e){const t=(0,o.getBit)(e[0],1,2),r=((0,o.getBit)(e[0],3,5)<<8)+e[1];return new h({type:0,packetStatus:t,runLength:r})}serialize(){return new o.BitWriter2(16).set(0).set(this.packetStatus,2).set(this.runLength,13).buffer}results(e){const t=this.packetStatus===p.TypeTCCPacketReceivedSmallDelta||this.packetStatus===p.TypeTCCPacketReceivedLargeDelta,r=[];for(let i=0;i<=this.runLength;++i)r.push(new y({sequenceNumber:++e,received:t}));return r}}t.RunLengthChunk=h;class d{constructor(e={}){this.symbolList=[],Object.assign(this,e)}static deSerialize(e){const t=f.TypeTCCStatusVectorChunk;let r=(0,o.getBit)(e[0],1,1);const i=[];switch(r){case 0:(0,s.default)(6).forEach(((t,r)=>i.push((0,o.getBit)(e[0],2+r,1)))),(0,s.default)(8).forEach(((t,r)=>i.push((0,o.getBit)(e[1],r,1))));break;case 1:(0,s.default)(3).forEach((t=>i.push((0,o.getBit)(e[0],2+2*t,2)))),(0,s.default)(4).forEach((t=>i.push((0,o.getBit)(e[1],2*t,2))));break;default:r=((0,o.getBit)(e[0],2,6)<<8)+e[1]}return new d({type:t,symbolSize:r,symbolList:i})}serialize(){const e=Buffer.alloc(2),t=new o.BitWriter2(16).set(1).set(this.symbolSize),r=0===this.symbolSize?1:2;return this.symbolList.forEach((e=>{t.set(e,r)})),e.writeUInt16BE(t.value),e}}t.StatusVectorChunk=d;class l{constructor(e={}){this.parsed=!1,Object.assign(this,e)}static deSerialize(e){let t,r;if(1===e.length?(t=p.TypeTCCPacketReceivedSmallDelta,r=250*e[0]):2===e.length&&(t=p.TypeTCCPacketReceivedLargeDelta,r=250*e.readInt16BE()),void 0===t||void 0===r)throw new Error;return new l({type:t,delta:r})}deSerialize(e){const t=l.deSerialize(e);this.delta=t.delta}parseDelta(){this.delta=Math.floor(this.delta/250),this.delta<0||this.delta>255?(this.delta>32767&&(this.delta=32767),this.delta<-32768&&(this.delta=-32768),this.type||(this.type=p.TypeTCCPacketReceivedLargeDelta)):this.type||(this.type=p.TypeTCCPacketReceivedSmallDelta),this.parsed=!0}serialize(){if(this.parsed||this.parseDelta(),this.type===p.TypeTCCPacketReceivedSmallDelta){const e=Buffer.alloc(1);return e.writeUInt8(this.delta),e}if(this.type===p.TypeTCCPacketReceivedLargeDelta){const e=Buffer.alloc(2);return e.writeInt16BE(this.delta),e}throw new Error("errDeltaExceedLimit "+this.delta+" "+this.type)}}var f,p;t.RecvDelta=l,function(e){e[e.TypeTCCRunLengthChunk=0]="TypeTCCRunLengthChunk",e[e.TypeTCCStatusVectorChunk=1]="TypeTCCStatusVectorChunk",e[e.packetStatusChunkLength=2]="packetStatusChunkLength"}(f=t.PacketChunk||(t.PacketChunk={})),function(e){e[e.TypeTCCPacketNotReceived=0]="TypeTCCPacketNotReceived",e[e.TypeTCCPacketReceivedSmallDelta=1]="TypeTCCPacketReceivedSmallDelta",e[e.TypeTCCPacketReceivedLargeDelta=2]="TypeTCCPacketReceivedLargeDelta",e[e.TypeTCCPacketReceivedWithoutDelta=3]="TypeTCCPacketReceivedWithoutDelta"}(p=t.PacketStatus||(t.PacketStatus={}));class y{constructor(e){this.sequenceNumber=0,this.delta=0,this.received=!1,this.receivedAtMs=0,Object.assign(this,e)}}t.PacketResult=y},6775:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SourceDescriptionItem=t.SourceDescriptionChunk=t.RtcpSourceDescriptionPacket=void 0;const i=r(680),n=r(3456);class s{constructor(e){this.type=s.type,this.chunks=[],Object.assign(this,e)}get length(){let e=0;return this.chunks.forEach((t=>e+=t.length)),e}serialize(){let e=Buffer.concat(this.chunks.map((e=>e.serialize())));for(;e.length%4;)e=Buffer.concat([e,Buffer.from([0])]);return n.RtcpPacketConverter.serialize(this.type,this.chunks.length,e,e.length/4)}static deSerialize(e,t){const r=[];for(let t=0;t<e.length;){const i=o.deSerialize(e.slice(t));r.push(i),t+=i.length}return new s({chunks:r})}}t.RtcpSourceDescriptionPacket=s,s.type=202;class o{constructor(e={}){this.items=[],Object.assign(this,e)}get length(){let e=4;return this.items.forEach((t=>e+=t.length)),e+=1,e+=c(e),e}serialize(){const e=Buffer.concat([(0,i.bufferWriter)([4],[this.source]),Buffer.concat(this.items.map((e=>e.serialize())))]);return Buffer.concat([e,Buffer.alloc(c(e.length))])}static deSerialize(e){const t=e.readUInt32BE(),r=[];for(let t=4;t<e.length;){if(0===e[t])break;const i=a.deSerialize(e.slice(t));r.push(i),t+=i.length}return new o({source:t,items:r})}}t.SourceDescriptionChunk=o;class a{constructor(e){Object.assign(this,e)}get length(){return 2+Buffer.from(this.text).length}serialize(){const e=Buffer.from(this.text);return Buffer.concat([(0,i.bufferWriter)([1,1],[this.type,e.length]),e])}static deSerialize(e){const t=e[0],r=e[1],i=e.slice(2,2+r).toString();return new a({type:t,text:i})}}function c(e){return e%4==0?0:4-e%4}t.SourceDescriptionItem=a},2203:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RtcpSenderInfo=t.RtcpSrPacket=void 0;const n=i(r(201)),s=r(680),o=r(2855),a=r(3456);class c{constructor(e){this.ssrc=0,this.reports=[],this.type=c.type,Object.assign(this,e)}serialize(){let e=Buffer.alloc(4);return e.writeUInt32BE(this.ssrc),e=Buffer.concat([e,this.senderInfo.serialize()]),e=Buffer.concat([e,...this.reports.map((e=>e.serialize()))]),a.RtcpPacketConverter.serialize(c.type,this.reports.length,e,Math.floor(e.length/4))}static deSerialize(e,t){const r=e.readUInt32BE(),i=u.deSerialize(e.slice(4,24));let s=24;const a=[];for(const r of(0,n.default)(t))a.push(o.RtcpReceiverInfo.deSerialize(e.slice(s,s+24))),s+=24;return new c({ssrc:r,senderInfo:i,reports:a})}}t.RtcpSrPacket=c,c.type=200;class u{constructor(e={}){Object.assign(this,e)}serialize(){return(0,s.bufferWriter)([8,4,4,4],[this.ntpTimestamp,this.rtpTimestamp,this.packetCount,this.octetCount])}static deSerialize(e){const[t,r,i,n]=(0,s.bufferReader)(e,[8,4,4,4]);return new u({ntpTimestamp:t,rtpTimestamp:r,packetCount:i,octetCount:n})}}t.RtcpSenderInfo=u},6774:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RedEncoder=void 0;const i=r(680),n=r(1787);t.RedEncoder=class{constructor(e=1){this.distance=e,this.cache=[],this.cacheSize=10}push(e){this.cache.push(e),this.cache.length>this.cacheSize&&this.cache.shift()}build(){const e=new n.Red,t=this.cache.slice(-(this.distance+1)),r=t.pop();return r?(t.forEach((t=>{const n=(0,i.uint32Add)(r.timestamp,-t.timestamp);n>s||e.blocks.push({block:t.block,blockPT:t.blockPT,timestampOffset:n})})),e.blocks.push({block:r.block,blockPT:r.blockPT}),e):e}};const s=16383},132:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RedHandler=void 0;const i=r(3924);t.RedHandler=class{constructor(){this.size=150,this.sequenceNumbers=[]}push(e,t){const r=[];e.blocks.forEach((({blockPT:n,timestampOffset:s,block:o},a)=>{const c=(0,i.uint16Add)(t.header.sequenceNumber,-(e.blocks.length-(a+1)));s?r.push(new i.RtpPacket(new i.RtpHeader({timestamp:(0,i.uint32Add)(t.header.timestamp,-s),payloadType:n,ssrc:t.header.ssrc,sequenceNumber:c,marker:!0}),o)):r.push(new i.RtpPacket(new i.RtpHeader({timestamp:t.header.timestamp,payloadType:n,ssrc:t.header.ssrc,sequenceNumber:c,marker:!0}),o))}));return r.filter((e=>!this.sequenceNumbers.includes(e.header.sequenceNumber)&&(this.sequenceNumbers.length>this.size&&this.sequenceNumbers.shift(),this.sequenceNumbers.push(e.header.sequenceNumber),!0)))}}},1787:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RedHeader=t.Red=void 0;const i=r(5493),n=r(680),s=(0,i.debug)("packages/rtp/src/rtp/red/packet.ts");class o{constructor(){this.blocks=[]}static deSerialize(e){const t=e instanceof ArrayBuffer?Buffer.from(e):e,r=new o;let i=0;return[r.header,i]=a.deSerialize(t),r.header.fields.forEach((({blockLength:e,timestampOffset:n,blockPT:s})=>{if(e&&n){const o=t.subarray(i,i+e);r.blocks.push({block:o,blockPT:s,timestampOffset:n}),i+=e}else{const e=t.subarray(i);r.blocks.push({block:e,blockPT:s})}})),r}serialize(){this.header=new a;for(const{timestampOffset:e,blockPT:t,block:r}of this.blocks)e?this.header.fields.push({fBit:1,blockPT:t,blockLength:r.length,timestampOffset:e}):this.header.fields.push({fBit:0,blockPT:t});let e=this.header.serialize();for(const{block:t}of this.blocks)e=Buffer.concat([e,t]);return e}}t.Red=o;class a{constructor(){this.fields=[]}static deSerialize(e){let t=0;const r=new a;for(;;){const i={};r.fields.push(i);const s=new n.BitStream(e.subarray(t));if(i.fBit=s.readBits(1),i.blockPT=s.readBits(7),t++,0===i.fBit)break;i.timestampOffset=s.readBits(14),i.blockLength=s.readBits(10),t+=3}return[r,t]}serialize(){let e=Buffer.alloc(0);for(const t of this.fields)try{if(t.timestampOffset&&t.blockLength){const r=new n.BitStream(Buffer.alloc(4)).writeBits(1,t.fBit).writeBits(7,t.blockPT).writeBits(14,t.timestampOffset).writeBits(10,t.blockLength);e=Buffer.concat([e,r.uint8Array])}else{const r=new n.BitStream(Buffer.alloc(1)).writeBits(1,0).writeBits(7,t.blockPT);e=Buffer.concat([e,r.uint8Array])}}catch(e){s(e?.message);continue}return e}}t.RedHeader=a},5948:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RtpPacket=t.RtpHeader=t.ExtensionProfiles=void 0;const i=r(680);t.ExtensionProfiles={OneByte:48862,TwoByte:4096};class n{constructor(e={}){this.version=2,this.padding=!1,this.paddingSize=0,this.extension=!1,this.marker=!1,this.payloadOffset=0,this.payloadType=0,this.sequenceNumber=0,this.timestamp=0,this.ssrc=0,this.csrcLength=0,this.csrc=[],this.extensionProfile=t.ExtensionProfiles.OneByte,this.extensions=[],Object.assign(this,e)}static deSerialize(e){const r=new n;let s=0;const o=e[s++];r.version=(0,i.getBit)(o,0,2),r.padding=(0,i.getBit)(o,2)>0,r.extension=(0,i.getBit)(o,3)>0,r.csrcLength=(0,i.getBit)(o,4,4),r.csrc=[...Array(r.csrcLength)].map((()=>{const t=e.readUInt32BE(s);return s+=4,t})),s+=11;const a=e[1];r.marker=(0,i.getBit)(a,0)>0,r.payloadType=(0,i.getBit)(a,1,7),r.sequenceNumber=e.readUInt16BE(2),r.timestamp=e.readUInt32BE(4),r.ssrc=e.readUInt32BE(8);for(let t=0;t<r.csrc.length;t++){const i=12+4*t;r.csrc[t]=e.subarray(i).readUInt32BE()}if(r.extension){r.extensionProfile=e.subarray(s).readUInt16BE(),s+=2;const i=4*e.subarray(s).readUInt16BE();switch(r.extensionLength=i,s+=2,r.extensionProfile){case t.ExtensionProfiles.OneByte:{const t=s+i;for(;s<t;){if(0===e[s]){s++;continue}const t=e[s]>>4,i=1+(e[s]&(240^e[s]));if(s++,15===t)break;const n={id:t,payload:e.subarray(s,s+i)};r.extensions=[...r.extensions,n],s+=i}}break;case t.ExtensionProfiles.TwoByte:{const t=s+i;for(;s<t;){if(0===e[s]){s++;continue}const t=e[s];s++;const i=e[s];s++;const n={id:t,payload:e.subarray(s,s+i)};r.extensions=[...r.extensions,n],s+=i}}break;default:{const t={id:0,payload:e.subarray(s,s+i)};r.extensions=[...r.extensions,t],s+=r.extensions[0].payload.length}}}return r.payloadOffset=s,r.padding&&(r.paddingSize=e[e.length-1]),r}get serializeSize(){const{csrc:e,extensionProfile:r,extensions:i}=this;let n=12+4*e.length;if(i.length>0||!0===this.extension){let e=4;switch(r){case t.ExtensionProfiles.OneByte:for(const t of i)e+=1+t.payload.length;break;case t.ExtensionProfiles.TwoByte:for(const t of i)e+=2+t.payload.length;break;default:e+=i[0].payload.length}n+=4*Math.floor((e+3)/4)}return n}serialize(e){const r=Buffer.alloc(e);let n=0;const s=new i.BitWriter(8);s.set(2,0,this.version),this.padding&&s.set(1,2,1),this.extensions.length>0&&(this.extension=!0),this.extension&&s.set(1,3,1),s.set(4,4,this.csrc.length),r.writeUInt8(s.value,n++);const o=new i.BitWriter(8);this.marker&&o.set(1,0,1),o.set(7,1,this.payloadType),r.writeUInt8(o.value,n++),r.writeUInt16BE(this.sequenceNumber,2),n+=2,r.writeUInt32BE(this.timestamp,4),n+=4,r.writeUInt32BE(this.ssrc,8),n+=4;for(const e of this.csrc)r.writeUInt32BE(e,n),n+=4;if(this.extension){const e=n;r.writeUInt16BE(this.extensionProfile,n),n+=4;const i=n;switch(this.extensionProfile){case t.ExtensionProfiles.OneByte:for(const e of this.extensions)r.writeUInt8(e.id<<4|e.payload.length-1,n++),e.payload.copy(r,n),n+=e.payload.length;break;case t.ExtensionProfiles.TwoByte:for(const e of this.extensions)r.writeUInt8(e.id,n++),r.writeUInt8(e.payload.length,n++),e.payload.copy(r,n),n+=e.payload.length;break;default:const e=this.extensions[0].payload.length;if(e%4!=0)throw new Error;this.extensions[0].payload.copy(r,n),n+=e}const s=n-i,o=4*Math.trunc((s+3)/4);r.writeUInt16BE(Math.trunc(o/4),e+2);for(let e=0;e<o-s;e++)r.writeUInt8(0,n),n++}return this.payloadOffset=n,r}}t.RtpHeader=n;class s{constructor(e,t){this.header=e,this.payload=t}get serializeSize(){return this.header.serializeSize+this.payload.length}clone(){return new s(new n({...this.header}),this.payload)}serialize(){let e=this.header.serialize(this.header.serializeSize+this.payload.length);const{payloadOffset:t}=this.header;if(this.payload.copy(e,t),this.header.padding){const t=Buffer.alloc(this.header.paddingSize);t.writeUInt8(this.header.paddingSize,this.header.paddingSize-1),e=Buffer.concat([e,t])}return e}static deSerialize(e){const t=n.deSerialize(e);return new s(t,e.subarray(t.payloadOffset,e.length-t.paddingSize))}clear(){this.payload=null}}t.RtpPacket=s},1502:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CipherAesCtr=void 0;const i=r(6113),n=r(5252),s=r(5948),o=r(1231);class a extends o.CipherAesBase{constructor(e,t,r,i,n,s){super(e,t,r,i),this.srtpSessionAuthTag=n,this.srtcpSessionAuthTag=s,this.authTagLength=10}encryptRtp(e,t,r){const n=e.serialize(e.serializeSize),s=this.generateCounter(e.sequenceNumber,r,e.ssrc,this.srtpSessionSalt),o=(0,i.createCipheriv)("aes-128-ctr",this.srtpSessionKey,s).update(t),a=this.generateSrtpAuthTag(r,n,o);return Buffer.concat([n,o,a])}decryptRtp(e,t){const r=s.RtpHeader.deSerialize(e),n=e.length-this.authTagLength;e=e.subarray(0,e.length-this.authTagLength);const o=this.generateCounter(r.sequenceNumber,t,r.ssrc,this.srtpSessionSalt),a=(0,i.createDecipheriv)("aes-128-ctr",this.srtpSessionKey,o),c=e.subarray(r.payloadOffset),u=a.update(c);return[Buffer.concat([e.subarray(0,r.payloadOffset),u,Buffer.alloc(n-r.payloadOffset-u.length)]),r]}encryptRTCP(e,t){let r=Buffer.from(e);const n=r.readUInt32BE(4),s=this.generateCounter(65535&t,t>>16,n,this.srtcpSessionSalt);(0,i.createCipheriv)("aes-128-ctr",this.srtcpSessionKey,s).update(r.slice(8)).copy(r,8),r=Buffer.concat([r,Buffer.alloc(4)]),r.writeUInt32BE(t,r.length-4),r[r.length-4]|=128;const o=this.generateSrtcpAuthTag(r);return r=Buffer.concat([r,o]),r}decryptRTCP(e){const t=n.RtcpHeader.deSerialize(e),r=e.length-(this.authTagLength+c),s=Buffer.from(e).slice(0,r);if(0===e[r]>>7)return[s,t];let o=e.readUInt32BE(r);o&=~(1<<31);const a=e.readUInt32BE(4),u=(e.subarray(e.length-10),this.generateCounter(65535&o,o>>16,a,this.srtcpSessionSalt));return(0,i.createDecipheriv)("aes-128-ctr",this.srtcpSessionKey,u).update(s.subarray(8)).copy(s,8),[s,t]}generateSrtcpAuthTag(e){return(0,i.createHmac)("sha1",this.srtcpSessionAuthTag).update(e).digest().slice(0,10)}generateCounter(e,t,r,i){const n=Buffer.alloc(16);n.writeUInt32BE(r,4),n.writeUInt32BE(t,8),n.writeUInt32BE(Number(BigInt(e)<<16n),12);for(let e=0;e<i.length;e++)n[e]^=i[e];return n}generateSrtpAuthTag(e,...t){const r=(0,i.createHmac)("sha1",this.srtpSessionAuthTag),n=Buffer.alloc(4);n.writeUInt32BE(e);for(const e of t)r.update(e);return r.update(n).digest().subarray(0,10)}}t.CipherAesCtr=a;const c=4},5381:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CipherAesGcm=void 0;const i=r(6113),n=r(680),s=r(253),o=r(5252),a=r(5948),c=r(1231);class u extends c.CipherAesBase{constructor(e,t,r,i){super(e,t,r,i),this.aeadAuthTagLen=16,this.rtpIvWriter=(0,n.createBufferWriter)([2,4,4,2],!0),this.rtcpIvWriter=(0,n.createBufferWriter)([2,4,2,4],!0),this.aadWriter=(0,n.createBufferWriter)([4],!0)}encryptRtp(e,t,r){const n=e.serialize(e.serializeSize),s=this.rtpInitializationVector(e,r),o=(0,i.createCipheriv)("aes-128-gcm",this.srtpSessionKey,s);o.setAAD(n);const a=o.update(t);o.final();const c=o.getAuthTag();return Buffer.concat([n,a,c])}decryptRtp(e,t){const r=a.RtpHeader.deSerialize(e);let n=Buffer.from([]);n=(0,s.growBufferSize)(n,e.length-this.aeadAuthTagLen),e.slice(0,r.payloadOffset).copy(n);const o=this.rtpInitializationVector(r,t),c=e.slice(r.payloadOffset,e.length-this.aeadAuthTagLen);return(0,i.createDecipheriv)("aes-128-gcm",this.srtpSessionKey,o).update(c).copy(n,r.payloadOffset),[n,r]}encryptRTCP(e,t){const r=e.readUInt32BE(4),n=e.length+this.aeadAuthTagLen;let o=Buffer.from([]);o=(0,s.growBufferSize)(o,n+h),e.slice(0,8).copy(o);const a=this.rtcpInitializationVector(r,t),c=this.rtcpAdditionalAuthenticatedData(e,t),u=(0,i.createCipheriv)("aes-128-gcm",this.srtcpSessionKey,a);u.setAAD(c);const d=u.update(e.slice(8));u.final(),d.copy(o,8);return u.getAuthTag().copy(o,8+d.length),c.slice(8,12).copy(o,n),o}decryptRTCP(e){const t=o.RtcpHeader.deSerialize(e),r=e.length-h,n=Buffer.alloc(r-this.aeadAuthTagLen);e.slice(0,8).copy(n);const s=e.readUInt32BE(4);let a=e.readUInt32BE(e.length-4);a&=~(d<<24);const c=this.rtcpInitializationVector(s,a),u=this.rtcpAdditionalAuthenticatedData(e,a),l=(0,i.createDecipheriv)("aes-128-gcm",this.srtcpSessionKey,c);l.setAAD(u);return l.update(e.slice(8,r)).copy(n,8),[n,t]}rtpInitializationVector(e,t){const r=this.rtpIvWriter([0,e.ssrc,t,e.sequenceNumber]);for(let e=0;e<r.length;e++)r[e]^=this.srtpSessionSalt[e];return r}rtcpInitializationVector(e,t){const r=this.rtcpIvWriter([0,e,0,t]);for(let e=0;e<r.length;e++)r[e]^=this.srtcpSessionSalt[e];return r}rtcpAdditionalAuthenticatedData(e,t){const r=Buffer.concat([e.subarray(0,8),this.aadWriter([t])]);return r[8]|=d,r}}t.CipherAesGcm=u;const h=4,d=128},1231:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CipherAesBase=void 0;t.CipherAesBase=class{constructor(e,t,r,i){this.srtpSessionKey=e,this.srtpSessionSalt=t,this.srtcpSessionKey=r,this.srtcpSessionSalt=i}encryptRtp(e,t,r){return Buffer.from([])}decryptRtp(e,t){return[]}encryptRTCP(e,t){return Buffer.from([])}decryptRTCP(e){return[]}}},4692:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.saltLength=t.keyLength=t.ProtectionProfileAeadAes128Gcm=t.ProtectionProfileAes128CmHmacSha1_80=void 0,t.ProtectionProfileAes128CmHmacSha1_80=1,t.ProtectionProfileAeadAes128Gcm=7;t.keyLength=e=>{switch(e){case t.ProtectionProfileAes128CmHmacSha1_80:case t.ProtectionProfileAeadAes128Gcm:return 16}};t.saltLength=e=>{switch(e){case t.ProtectionProfileAes128CmHmacSha1_80:return 14;case t.ProtectionProfileAeadAes128Gcm:return 12}}},897:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Context=void 0;const i=r(3663),n=r(6113),s=r(1502),o=r(5381),a=r(4692);t.Context=class{constructor(e,t,r){this.masterKey=e,this.masterSalt=t,this.profile=r,this.srtpSSRCStates={},this.srtcpSSRCStates={};{const e=14-t.length;e>0&&(this.masterSalt=Buffer.concat([t,Buffer.alloc(e)]))}switch(this.srtpSessionKey=this.generateSessionKey(0),this.srtpSessionSalt=this.generateSessionSalt(2),this.srtpSessionAuthTag=this.generateSessionAuthTag(1),this.srtpSessionAuth=(0,n.createHmac)("sha1",this.srtpSessionAuthTag),this.srtcpSessionKey=this.generateSessionKey(3),this.srtcpSessionSalt=this.generateSessionSalt(5),this.srtcpSessionAuthTag=this.generateSessionAuthTag(4),this.srtcpSessionAuth=(0,n.createHmac)("sha1",this.srtcpSessionAuthTag),r){case a.ProtectionProfileAes128CmHmacSha1_80:this.cipher=new s.CipherAesCtr(this.srtpSessionKey,this.srtpSessionSalt,this.srtcpSessionKey,this.srtcpSessionSalt,this.srtpSessionAuthTag,this.srtcpSessionAuthTag);break;case a.ProtectionProfileAeadAes128Gcm:this.cipher=new o.CipherAesGcm(this.srtpSessionKey,this.srtpSessionSalt,this.srtcpSessionKey,this.srtcpSessionSalt)}}generateSessionKey(e){let t=Buffer.from(this.masterSalt);const r=Buffer.from([e,0,0,0,0,0,0]);for(let e=r.length-1,i=t.length-1;e>=0;e--,i--)t[i]=t[i]^r[e];t=Buffer.concat([t,Buffer.from([0,0])]);const n=new i.AES(this.masterKey);return Buffer.from(n.encrypt(t))}generateSessionSalt(e){let t=Buffer.from(this.masterSalt);const r=Buffer.from([e,0,0,0,0,0,0]);for(let e=r.length-1,i=t.length-1;e>=0;e--,i--)t[i]=t[i]^r[e];t=Buffer.concat([t,Buffer.from([0,0])]);const n=new i.AES(this.masterKey);return t=Buffer.from(n.encrypt(t)),t.slice(0,14)}generateSessionAuthTag(e){const t=Buffer.from(this.masterSalt),r=Buffer.from([e,0,0,0,0,0,0]);for(let e=r.length-1,i=t.length-1;e>=0;e--,i--)t[i]=t[i]^r[e];let n=Buffer.concat([t,Buffer.from([0,0])]),s=Buffer.concat([t,Buffer.from([0,1])]);const o=new i.AES(this.masterKey);return n=Buffer.from(o.encrypt(n)),s=Buffer.from(o.encrypt(s)),Buffer.concat([n,s.slice(0,4)])}getSrtpSsrcState(e){let t=this.srtpSSRCStates[e];return t||(t={ssrc:e,rolloverCounter:0,lastSequenceNumber:0},this.srtpSSRCStates[e]=t,t)}getSrtcpSsrcState(e){let t=this.srtcpSSRCStates[e];return t||(t={srtcpIndex:0,ssrc:e},this.srtcpSSRCStates[e]=t,t)}updateRolloverCount(e,t){t.rolloverHasProcessed?0===e?t.lastSequenceNumber>c&&t.rolloverCounter++:t.lastSequenceNumber<c&&e>u-c?t.rolloverCounter>0&&t.rolloverCounter--:e<c&&t.lastSequenceNumber>u-c&&t.rolloverCounter++:t.rolloverHasProcessed=!0,t.lastSequenceNumber=e}generateSrtpAuthTag(e,t){this.srtpSessionAuth=(0,n.createHmac)("sha1",this.srtpSessionAuthTag);const r=Buffer.alloc(4);return r.writeUInt32BE(t),this.srtpSessionAuth.update(e).update(r).digest().slice(0,10)}index(e){const t=this.srtcpSSRCStates[e];return t?t.srtcpIndex:0}setIndex(e,t){this.getSrtcpSsrcState(e).srtcpIndex=t%2147483647}};const c=100,u=65535},1162:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SrtcpContext=void 0;const i=r(897);class n extends i.Context{constructor(e,t,r){super(e,t,r)}encryptRTCP(e){const t=e.readUInt32BE(4),r=this.getSrtcpSsrcState(t);r.srtcpIndex++,r.srtcpIndex>>s&&(r.srtcpIndex=0);return this.cipher.encryptRTCP(e,r.srtcpIndex)}decryptRTCP(e){return this.cipher.decryptRTCP(e)}}t.SrtcpContext=n;const s=2147483647},3315:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SrtpContext=void 0;const i=r(5948),n=r(897);class s extends n.Context{constructor(e,t,r){super(e,t,r)}encryptRtp(e,t){const r=this.getSrtpSsrcState(t.ssrc);this.updateRolloverCount(t.sequenceNumber,r);return this.cipher.encryptRtp(t,e,r.rolloverCounter)}decryptRtp(e){const t=i.RtpHeader.deSerialize(e),r=this.getSrtpSsrcState(t.ssrc);this.updateRolloverCount(t.sequenceNumber,r);return this.cipher.decryptRtp(e,r.rolloverCounter)}}t.SrtpContext=s},9081:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Session=void 0;t.Session=class{constructor(e){this.ContextCls=e}start(e,t,r,i,n){this.localContext=new this.ContextCls(e,t,n),this.remoteContext=new this.ContextCls(r,i,n)}}},7777:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SrtcpSession=void 0;const i=r(1162),n=r(9081);class s extends n.Session{constructor(e){super(i.SrtcpContext),this.config=e,this.decrypt=e=>{const[t]=this.remoteContext.decryptRTCP(e);return t},this.start(e.keys.localMasterKey,e.keys.localMasterSalt,e.keys.remoteMasterKey,e.keys.remoteMasterSalt,e.profile)}encrypt(e){return this.localContext.encryptRTCP(e)}}t.SrtcpSession=s},9913:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SrtpSession=void 0;const i=r(3315),n=r(9081);class s extends n.Session{constructor(e){super(i.SrtpContext),this.config=e,this.decrypt=e=>{const[t]=this.remoteContext.decryptRtp(e);return t},this.start(e.keys.localMasterKey,e.keys.localMasterSalt,e.keys.remoteMasterKey,e.keys.remoteMasterSalt,e.profile)}encrypt(e,t){return this.localContext.encryptRtp(e,t)}}t.SrtpSession=s},9415:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.serializePacket=t.parsePacket=t.decodeParams=t.CHUNK_BY_TYPE=t.ShutdownCompleteChunk=t.ShutdownAckChunk=t.ShutdownChunk=t.SackChunk=t.ReconfigChunk=t.HeartbeatAckChunk=t.HeartbeatChunk=t.ErrorChunk=t.AbortChunk=t.BaseParamsChunk=t.CookieAckChunk=t.CookieEchoChunk=t.DataChunk=t.ForwardTsnChunk=t.ReConfigChunk=t.InitAckChunk=t.InitChunk=t.BaseInitChunk=t.Chunk=void 0;const i=r(239),n=r(4768);class s{get body(){return this._body}set body(e){this._body=e}constructor(e=0,t=Buffer.from("")){this.flags=e,this._body=t}get type(){return s.type}get bytes(){if(!this.body)throw new Error;return Buffer.concat([Buffer.from(i.jspack.Pack("!BBH",[this.type,this.flags,this.body.length+4])),this.body,...[...Array(C(this.body.length))].map((()=>Buffer.from("\0")))])}}t.Chunk=s,s.type=-1;class o extends s{constructor(e=0,t){super(e,t),this.flags=e,t?([this.initiateTag,this.advertisedRwnd,this.outboundStreams,this.inboundStreams,this.initialTsn]=i.jspack.Unpack("!LLHHL",t),this.params=T(t.slice(16))):(this.initiateTag=0,this.advertisedRwnd=0,this.outboundStreams=0,this.inboundStreams=0,this.initialTsn=0,this.params=[])}get body(){let e=Buffer.from(i.jspack.Pack("!LLHHL",[this.initiateTag,this.advertisedRwnd,this.outboundStreams,this.inboundStreams,this.initialTsn]));return e=Buffer.concat([e,k(this.params)]),e}}t.BaseInitChunk=o;class a extends o{get type(){return a.type}}t.InitChunk=a,a.type=1;class c extends o{get type(){return c.type}}t.InitAckChunk=c,c.type=2;class u extends o{get type(){return u.type}}t.ReConfigChunk=u,u.type=130;class h extends s{constructor(e=0,t){if(super(e,t),this.flags=e,this.streams=[],t){this.cumulativeTsn=i.jspack.Unpack("!L",t)[0];let e=4;for(;e<t.length;)this.streams.push(i.jspack.Unpack("!HH",t.slice(e))),e+=4}else this.cumulativeTsn=0}get type(){return h.type}set body(e){}get body(){const e=Buffer.from(i.jspack.Pack("!L",[this.cumulativeTsn]));return Buffer.concat([e,...this.streams.map((([e,t])=>Buffer.from(i.jspack.Pack("!HH",[e,t]))))])}}t.ForwardTsnChunk=h,h.type=192;class d extends s{get type(){return d.type}constructor(e=0,t){super(e,t),this.flags=e,this.tsn=0,this.streamId=0,this.streamSeqNum=0,this.protocol=0,this.userData=Buffer.from(""),this.abandoned=!1,this.acked=!1,this.misses=0,this.retransmit=!1,this.sentCount=0,this.bookSize=0,t&&([this.tsn,this.streamId,this.streamSeqNum,this.protocol]=i.jspack.Unpack("!LHHL",t),this.userData=t.slice(12))}get bytes(){const e=16+this.userData.length;let t=Buffer.concat([Buffer.from(i.jspack.Pack("!BBHLHHL",[this.type,this.flags,e,this.tsn,this.streamId,this.streamSeqNum,this.protocol])),this.userData]);return e%4&&(t=Buffer.concat([t,...[...Array(C(e))].map((()=>Buffer.from("\0")))])),t}}t.DataChunk=d,d.type=0;class l extends s{get type(){return l.type}}t.CookieEchoChunk=l,l.type=10;class f extends s{get type(){return f.type}}t.CookieAckChunk=f,f.type=11;class p extends s{constructor(e=0,t){super(e,t),this.flags=e,this.params=[],t&&(this.params=T(t))}get body(){return k(this.params)}}t.BaseParamsChunk=p;class y extends p{get type(){return y.type}}t.AbortChunk=y,y.type=6;class m extends p{get type(){return m.type}get descriptions(){return this.params.map((([e,t])=>({name:(Object.entries(m.CODE).find((([,t])=>t===e))||[])[0],body:t})))}}t.ErrorChunk=m,m.type=9,m.CODE={InvalidStreamIdentifier:1,MissingMandatoryParameter:2,StaleCookieError:3,OutofResource:4,UnresolvableAddress:5,UnrecognizedChunkType:6,InvalidMandatoryParameter:7,UnrecognizedParameters:8,NoUserData:9,CookieReceivedWhileShuttingDown:10,RestartofanAssociationwithNewAddresses:11,UserInitiatedAbort:12,ProtocolViolation:13};class g extends p{get type(){return g.type}}t.HeartbeatChunk=g,g.type=4;class b extends p{get type(){return b.type}}t.HeartbeatAckChunk=b,b.type=5;class v extends p{get type(){return v.type}}t.ReconfigChunk=v,v.type=130;class w extends s{get type(){return w.type}constructor(e=0,t){if(super(e,t),this.flags=e,this.gaps=[],this.duplicates=[],this.cumulativeTsn=0,this.advertisedRwnd=0,t){const[e,r,n,s]=i.jspack.Unpack("!LLHH",t);this.cumulativeTsn=e,this.advertisedRwnd=r;let o=12;[...Array(n)].forEach((()=>{this.gaps.push(i.jspack.Unpack("!HH",t.slice(o))),o+=4})),[...Array(s)].forEach((()=>{this.duplicates.push(i.jspack.Unpack("!L",t.slice(o))[0]),o+=4}))}}get bytes(){const e=16+4*(this.gaps.length+this.duplicates.length);let t=Buffer.from(i.jspack.Pack("!BBHLLHH",[this.type,this.flags,e,this.cumulativeTsn,this.advertisedRwnd,this.gaps.length,this.duplicates.length]));return t=Buffer.concat([t,...this.gaps.map((e=>Buffer.from(i.jspack.Pack("!HH",e))))]),t=Buffer.concat([t,...this.duplicates.map((e=>Buffer.from(i.jspack.Pack("!L",[e]))))]),t}}t.SackChunk=w,w.type=3;class S extends s{get type(){return S.type}constructor(e=0,t){super(e,t),this.flags=e,this.cumulativeTsn=0,t&&(this.cumulativeTsn=i.jspack.Unpack("!L",t)[0])}get body(){return Buffer.from(i.jspack.Pack("!L",[this.cumulativeTsn]))}}t.ShutdownChunk=S,S.type=7;class _ extends s{get type(){return _.type}}t.ShutdownAckChunk=_,_.type=8;class A extends s{get type(){return A.type}}t.ShutdownCompleteChunk=A,A.type=14;const E=[d,a,c,w,g,b,y,S,_,m,l,f,A,v,h];function C(e){const t=e%4;return t?4-t:0}function k(e){let t=Buffer.from(""),r=Buffer.from("");return e.forEach((([e,n])=>{const s=n.length+4;t=Buffer.concat([t,r,Buffer.from(i.jspack.Pack("!HH",[e,s])),n]),r=Buffer.concat([...Array(C(s))].map((()=>Buffer.from("\0"))))})),t}function T(e){const t=[];let r=0;for(;r<=e.length-4;){const[n,s]=i.jspack.Unpack("!HH",e.slice(r));t.push([n,e.slice(r+4,r+s)]),r+=s+C(s)}return t}t.CHUNK_BY_TYPE=E.reduce(((e,t)=>(e[t.type]=t,e)),{}),t.decodeParams=T,t.parsePacket=function(e){if(e.length<12)throw new Error("SCTP packet length is less than 12 bytes");const[r,s,o]=i.jspack.Unpack("!HHL",e);if(e.readUInt32LE(8)!==n(Buffer.concat([e.slice(0,8),Buffer.from("\0\0\0\0"),e.slice(12)])))throw new Error("SCTP packet has invalid checksum");const a=[];let c=12;for(;c+4<=e.length;){const[r,n,s]=i.jspack.Unpack("!BBH",e.slice(c)),o=e.slice(c+4,c+s),u=t.CHUNK_BY_TYPE[r.toString()];if(!u)throw new Error("unknown");a.push(new u(n,o)),c+=s+C(s)}return[r,s,o,a]},t.serializePacket=function(e,t,r,s){const o=Buffer.from(i.jspack.Pack("!HHL",[e,t,r])),a=s.bytes,c=n(Buffer.concat([o,Buffer.from("\0\0\0\0"),a])),u=Buffer.alloc(4);return u.writeUInt32LE(c,0),Buffer.concat([o,u,a])}},5788:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SCTP_STATE=t.WEBRTC_PPID=void 0,function(e){e[e.DCEP=50]="DCEP",e[e.STRING=51]="STRING",e[e.BINARY=53]="BINARY",e[e.STRING_EMPTY=56]="STRING_EMPTY",e[e.BINARY_EMPTY=57]="BINARY_EMPTY"}(t.WEBRTC_PPID||(t.WEBRTC_PPID={})),function(e){e[e.CLOSED=1]="CLOSED",e[e.COOKIE_WAIT=2]="COOKIE_WAIT",e[e.COOKIE_ECHOED=3]="COOKIE_ECHOED",e[e.ESTABLISHED=4]="ESTABLISHED",e[e.SHUTDOWN_PENDING=5]="SHUTDOWN_PENDING",e[e.SHUTDOWN_SENT=6]="SHUTDOWN_SENT",e[e.SHUTDOWN_RECEIVED=7]="SHUTDOWN_RECEIVED",e[e.SHUTDOWN_ACK_SENT=8]="SHUTDOWN_ACK_SENT"}(t.SCTP_STATE||(t.SCTP_STATE={}))},5453:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createEventsFromList=t.enumerate=void 0;const n=i(r(5473));t.enumerate=function(e){return e.map(((e,t)=>[t,e]))},t.createEventsFromList=function(e){return e.reduce(((e,t)=>(e[t]=new n.default,e)),{})}},8480:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SCTP=t.WEBRTC_PPID=t.SCTP_STATE=void 0;var i=r(5788);Object.defineProperty(t,"SCTP_STATE",{enumerable:!0,get:function(){return i.SCTP_STATE}}),Object.defineProperty(t,"WEBRTC_PPID",{enumerable:!0,get:function(){return i.WEBRTC_PPID}});var n=r(811);Object.defineProperty(t,"SCTP",{enumerable:!0,get:function(){return n.SCTP}})},3182:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RECONFIG_PARAM_BY_TYPES=t.ReconfigResponseParam=t.reconfigResult=t.StreamAddOutgoingParam=t.OutgoingSSNResetRequestParam=void 0;const n=r(239),s=i(r(201));class o{constructor(e,t,r,i){this.requestSequence=e,this.responseSequence=t,this.lastTsn=r,this.streams=i}get type(){return o.type}get bytes(){const e=Buffer.from(n.jspack.Pack("!LLL",[this.requestSequence,this.responseSequence,this.lastTsn]));return Buffer.concat([e,...this.streams.map((e=>Buffer.from(n.jspack.Pack("!H",[e]))))])}static parse(e){const[t,r,i]=n.jspack.Unpack("!LLL",e),a=(0,s.default)(12,e.length,2).map((t=>n.jspack.Unpack("!H",e.slice(t))[0]));return new o(t,r,i,a)}}t.OutgoingSSNResetRequestParam=o,o.type=13;class a{constructor(e,t){this.requestSequence=e,this.newStreams=t}get type(){return a.type}get bytes(){return Buffer.from(n.jspack.Pack("!LHH",[this.requestSequence,this.newStreams,0]))}static parse(e){const[t,r]=n.jspack.Unpack("!LHH",e);return new a(t,r)}}t.StreamAddOutgoingParam=a,a.type=17,t.reconfigResult={ReconfigResultSuccessPerformed:1,BadSequenceNumber:5};class c{constructor(e,t){this.responseSequence=e,this.result=t}get type(){return c.type}get bytes(){return Buffer.from(n.jspack.Pack("!LL",[this.responseSequence,this.result]))}static parse(e){const[t,r]=n.jspack.Unpack("!LL",e);return new c(t,r)}}t.ReconfigResponseParam=c,c.type=16,t.RECONFIG_PARAM_BY_TYPES={13:o,16:c,17:a}},811:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RTCSctpCapabilities=t.InboundStream=t.SCTP=void 0;const n=r(6113),s=i(r(5493)),o=r(239),a=i(r(201)),c=r(5473),u=r(680),h=r(9415),d=r(5788),l=r(5453),f=r(3182),p=(0,s.default)("werift/sctp/sctp"),y=1200,m=2**32,g=["new","closed","connected","connecting"];class b{constructor(e,t=5e3){this.transport=e,this.port=t,this.stateChanged=(0,l.createEventsFromList)(g),this.onReconfigStreams=new c.Event,this.onReceive=new c.Event,this.onSackReceived=async()=>{},this.associationState=d.SCTP_STATE.CLOSED,this.started=!1,this.state="new",this.isServer=!0,this.hmacKey=(0,n.randomBytes)(16),this.localPartialReliability=!0,this.localVerificationTag=(0,u.random32)(),this.remoteExtensions=[],this.remotePartialReliability=!0,this.remoteVerificationTag=0,this.advertisedRwnd=1048576,this.inboundStreams={},this._inboundStreamsCount=0,this._inboundStreamsMax=65535,this.sackDuplicates=[],this.sackMisOrdered=new Set,this.sackNeeded=!1,this.cwnd=3600,this.fastRecoveryTransmit=!1,this.flightSize=0,this.outboundQueue=[],this.outboundStreamSeq={},this._outboundStreamsCount=65535,this.localTsn=Number((0,u.random32)()),this.lastSackedTsn=S(this.localTsn),this.advancedPeerAckTsn=S(this.localTsn),this.partialBytesAcked=0,this.sentQueue=[],this.reconfigRequestSeq=this.localTsn,this.reconfigResponseSeq=0,this.reconfigQueue=[],this.rto=3,this.timer1Failures=0,this.timer2Failures=0,this.timerReconfigFailures=0,this.send=async(e,t,r,{expiry:i,maxRetransmits:n,ordered:s}={expiry:void 0,maxRetransmits:void 0,ordered:!0})=>{const o=s&&this.outboundStreamSeq[e]||0,c=Math.ceil(r.length/y);let d=0;const l=[];for(const u of(0,a.default)(0,c)){const a=new h.DataChunk(0,void 0);a.flags=0,s||(a.flags=4),0===u&&(a.flags|=2),u===c-1&&(a.flags|=1),a.tsn=this.localTsn,a.streamId=e,a.streamSeqNum=o,a.protocol=t,a.userData=r.slice(d,d+y),a.bookSize=a.userData.length,a.expiry=i,a.maxRetransmits=n,d+=y,this.localTsn=_(this.localTsn),l.push(a)}l.forEach((e=>{this.outboundQueue.push(e)})),s&&(this.outboundStreamSeq[e]=(0,u.uint16Add)(o,1)),this.timer3Handle?await new Promise((e=>setImmediate(e))):await this.transmit()},this.timer1Expired=()=>{this.timer1Failures++,this.timer1Handle=void 0,this.timer1Failures>8?this.setState(d.SCTP_STATE.CLOSED):(setImmediate((()=>{this.sendChunk(this.timer1Chunk).catch((e=>{p("send timer1 chunk failed",e.message)}))})),this.timer1Handle=setTimeout(this.timer1Expired,1e3*this.rto))},this.timer2Expired=()=>{this.timer2Failures++,this.timer2Handle=void 0,this.timer2Failures>10?this.setState(d.SCTP_STATE.CLOSED):(setImmediate((()=>{this.sendChunk(this.timer2Chunk).catch((e=>{p("send timer2Chunk failed",e.message)}))})),this.timer2Handle=setTimeout(this.timer2Expired,1e3*this.rto))},this.timer3Expired=()=>{this.timer3Handle=void 0,this.sentQueue.forEach((e=>{this.maybeAbandon(e)||(e.retransmit=!0)})),this.updateAdvancedPeerAckPoint(),this.fastRecoveryExit=void 0,this.flightSize=0,this.partialBytesAcked=0,this.ssthresh=Math.max(Math.floor(this.cwnd/2),4800),this.cwnd=y,this.transmit()},this.timerReconfigHandleExpired=async()=>{this.timerReconfigFailures++,this.rto=Math.ceil(1.5*this.rto),this.timerReconfigFailures>10?(p("timerReconfigFailures",this.timerReconfigFailures),this.setState(d.SCTP_STATE.CLOSED),this.timerReconfigHandle=void 0):this.reconfigRequest&&(p("timerReconfigHandleExpired",this.timerReconfigFailures,this.rto),await this.sendReconfigParam(this.reconfigRequest),this.timerReconfigHandle=setTimeout(this.timerReconfigHandleExpired,1e3*this.rto))},this.localPort=this.port,this.transport.onData=e=>{this.handleData(e)}}get maxChannels(){if(this._inboundStreamsCount>0)return Math.min(this._inboundStreamsCount,this._outboundStreamsCount)}static client(e,t=5e3){const r=new b(e,t);return r.isServer=!1,r}static server(e,t=5e3){const r=new b(e,t);return r.isServer=!0,r}async handleData(e){let t;const[,,r,i]=(0,h.parsePacket)(e);if(i.filter((e=>e.type===h.InitChunk.type)).length>0){if(1!=i.length)throw new Error;t=0}else t=this.localVerificationTag;if(r===t){for(const e of i)await this.receiveChunk(e);this.sackNeeded&&await this.sendSack()}}async sendSack(){const e=[];let t;[...this.sackMisOrdered].sort().forEach((r=>{const i=(r-this.lastReceivedTsn)%m;r===t?e[e.length-1][1]=i:e.push([i,i]),t=_(r)}));const r=new h.SackChunk(0,void 0);r.cumulativeTsn=this.lastReceivedTsn,r.advertisedRwnd=Math.max(0,this.advertisedRwnd),r.duplicates=[...this.sackDuplicates],r.gaps=e,await this.sendChunk(r).catch((e=>{p("send sack failed",e.message)})),this.sackDuplicates=[],this.sackNeeded=!1}async receiveChunk(e){switch(e.type){case h.DataChunk.type:this.receiveDataChunk(e);break;case h.InitChunk.type:{if(!this.isServer)return;const t=e;p("receive init",t),this.lastReceivedTsn=S(t.initialTsn),this.reconfigResponseSeq=S(t.initialTsn),this.remoteVerificationTag=t.initiateTag,this.ssthresh=t.advertisedRwnd,this.getExtensions(t.params),this._inboundStreamsCount=Math.min(t.outboundStreams,this._inboundStreamsMax),this._outboundStreamsCount=Math.min(this._outboundStreamsCount,t.inboundStreams);const r=new h.InitAckChunk;r.initiateTag=this.localVerificationTag,r.advertisedRwnd=this.advertisedRwnd,r.outboundStreams=this._outboundStreamsCount,r.inboundStreams=this._inboundStreamsCount,r.initialTsn=this.localTsn,this.setExtensions(r.params);const i=Date.now()/1e3;let s=Buffer.from(o.jspack.Pack("!L",[i]));s=Buffer.concat([s,(0,n.createHmac)("sha1",this.hmacKey).update(s).digest()]),r.params.push([7,s]),p("send initAck",r),await this.sendChunk(r).catch((e=>{p("send initAck failed",e.message)}))}break;case h.InitAckChunk.type:{if(this.associationState!=d.SCTP_STATE.COOKIE_WAIT)return;const t=e;this.timer1Cancel(),this.lastReceivedTsn=S(t.initialTsn),this.reconfigResponseSeq=S(t.initialTsn),this.remoteVerificationTag=t.initiateTag,this.ssthresh=t.advertisedRwnd,this.getExtensions(t.params),this._inboundStreamsCount=Math.min(t.outboundStreams,this._inboundStreamsMax),this._outboundStreamsCount=Math.min(this._outboundStreamsCount,t.inboundStreams);const r=new h.CookieEchoChunk;for(const[e,i]of t.params)if(7===e){r.body=i;break}await this.sendChunk(r).catch((e=>{p("send echo failed",e.message)})),this.timer1Start(r),this.setState(d.SCTP_STATE.COOKIE_ECHOED)}break;case h.SackChunk.type:await this.receiveSackChunk(e);break;case h.HeartbeatChunk.type:{const t=new h.HeartbeatAckChunk;t.params=e.params,await this.sendChunk(t).catch((e=>{p("send heartbeat ack failed",e.message)}))}break;case h.AbortChunk.type:this.setState(d.SCTP_STATE.CLOSED);break;case h.ShutdownChunk.type:{this.timer2Cancel(),this.setState(d.SCTP_STATE.SHUTDOWN_RECEIVED);const e=new h.ShutdownAckChunk;await this.sendChunk(e).catch((e=>{p("send shutdown ack failed",e.message)})),this.t2Start(e),this.setState(d.SCTP_STATE.SHUTDOWN_SENT)}break;case h.ErrorChunk.type:p("ErrorChunk",e.descriptions);break;case h.CookieEchoChunk.type:{if(!this.isServer)return;const t=e.body,r=(0,n.createHmac)("sha1",this.hmacKey).update(t.slice(0,4)).digest();if(24!=t?.length||!t.slice(4).equals(r))return void p("x State cookie is invalid");const i=Date.now()/1e3,s=o.jspack.Unpack("!L",t)[0];if(s<i-60||s>i){const e=new h.ErrorChunk(0,void 0);return e.params.push([h.ErrorChunk.CODE.StaleCookieError,Buffer.concat([...Array(8)].map((()=>Buffer.from("\0"))))]),void await this.sendChunk(e).catch((e=>{p("send errorChunk failed",e.message)}))}const a=new h.CookieAckChunk;await this.sendChunk(a).catch((e=>{p("send cookieAck failed",e.message)})),this.setState(d.SCTP_STATE.ESTABLISHED)}break;case h.CookieAckChunk.type:if(this.associationState!=d.SCTP_STATE.COOKIE_ECHOED)return;this.timer1Cancel(),this.setState(d.SCTP_STATE.ESTABLISHED);break;case h.ShutdownCompleteChunk.type:if(this.associationState!=d.SCTP_STATE.SHUTDOWN_ACK_SENT)return;this.timer2Cancel(),this.setState(d.SCTP_STATE.CLOSED);break;case h.ReconfigChunk.type:{if(this.associationState!=d.SCTP_STATE.ESTABLISHED)return;const t=e;for(const[e,r]of t.params){const t=f.RECONFIG_PARAM_BY_TYPES[e];t&&await this.receiveReconfigParam(t.parse(r))}}break;case h.ForwardTsnChunk.type:this.receiveForwardTsnChunk(e)}}getExtensions(e){for(const[t,r]of e)49152===t?this.remotePartialReliability=!0:32776===t&&(this.remoteExtensions=[...r])}async receiveReconfigParam(e){switch(p("receiveReconfigParam",f.RECONFIG_PARAM_BY_TYPES[e.type]),e.type){case f.OutgoingSSNResetRequestParam.type:{const t=e,r=new f.ReconfigResponseParam(t.requestSequence,f.reconfigResult.ReconfigResultSuccessPerformed);this.reconfigResponseSeq=t.requestSequence,await this.sendReconfigParam(r),await Promise.all(t.streams.map((async e=>{delete this.inboundStreams[e],this.outboundStreamSeq[e]&&this.reconfigQueue.push(e)}))),await this.transmitReconfigRequest(),this.onReconfigStreams.execute(t.streams)}break;case f.ReconfigResponseParam.type:{const t=e;if(t.result!==f.reconfigResult.ReconfigResultSuccessPerformed)p("OutgoingSSNResetRequestParam failed",Object.keys(f.reconfigResult).find((e=>f.reconfigResult[e]===t.result)));else if(t.responseSequence===this.reconfigRequest?.requestSequence){const e=this.reconfigRequest.streams.map((e=>(delete this.outboundStreamSeq[e],e)));this.onReconfigStreams.execute(e),this.reconfigRequest=void 0,this.timerReconfigCancel(),this.reconfigQueue.length>0&&await this.transmitReconfigRequest()}}break;case f.StreamAddOutgoingParam.type:{const t=e;this._inboundStreamsCount+=t.newStreams;const r=new f.ReconfigResponseParam(t.requestSequence,1);this.reconfigResponseSeq=t.requestSequence,await this.sendReconfigParam(r)}}}receiveDataChunk(e){if(this.sackNeeded=!0,this.markReceived(e.tsn))return;const t=this.getInboundStream(e.streamId);t.addChunk(e),this.advertisedRwnd-=e.userData.length;for(const e of t.popMessages())this.advertisedRwnd+=e[2].length,this.receive(...e)}async receiveSackChunk(e){if((0,u.uint32Gt)(this.lastSackedTsn,e.cumulativeTsn))return;const t=Date.now()/1e3;this.lastSackedTsn=e.cumulativeTsn;const r=this.flightSize>=this.cwnd;let i=0,n=0;for(;this.sentQueue.length>0&&(0,u.uint32Gte)(this.lastSackedTsn,this.sentQueue[0].tsn);){const e=this.sentQueue.shift();i++,e?.acked||(n+=e.bookSize,this.flightSizeDecrease(e)),1===i&&1===e.sentCount&&this.updateRto(t-e.sentTime)}let s=!1;if(e.gaps.length>0){const t=new Set;let r;e.gaps.forEach((i=>(0,a.default)(i[0],i[1]+1).forEach((i=>{r=(e.cumulativeTsn+i)%m,t.add(r)}))));let i=e.cumulativeTsn;for(const e of this.sentQueue){if((0,u.uint32Gt)(e.tsn,r))break;t.has(e.tsn)&&!e.acked&&(n+=e.bookSize,e.acked=!0,this.flightSizeDecrease(e),i=e.tsn)}for(const e of this.sentQueue){if((0,u.uint32Gt)(e.tsn,i))break;t.has(e.tsn)||(e.misses++,3===e.misses&&(e.misses=0,this.maybeAbandon(e)||(e.retransmit=!0),e.acked=!1,this.flightSizeDecrease(e),s=!0))}}void 0===this.fastRecoveryExit?(i&&r&&(this.cwnd<=this.ssthresh?this.cwnd+=Math.min(n,y):(this.partialBytesAcked+=n,this.partialBytesAcked>=this.cwnd&&(this.partialBytesAcked-=this.cwnd,this.cwnd+=y))),s&&(this.ssthresh=Math.max(Math.floor(this.cwnd/2),4800),this.cwnd=this.ssthresh,this.partialBytesAcked=0,this.fastRecoveryExit=this.sentQueue[this.sentQueue.length-1].tsn,this.fastRecoveryTransmit=!0)):(0,u.uint32Gte)(e.cumulativeTsn,this.fastRecoveryExit)&&(this.fastRecoveryExit=void 0),0===this.sentQueue.length?this.timer3Cancel():i>0&&this.timer3Restart(),this.updateAdvancedPeerAckPoint(),await this.onSackReceived(),await this.transmit()}receiveForwardTsnChunk(e){if(this.sackNeeded=!0,(0,u.uint32Gte)(this.lastReceivedTsn,e.cumulativeTsn))return;const t=e=>(0,u.uint32Gt)(e,this.lastReceivedTsn);this.lastReceivedTsn=e.cumulativeTsn,this.sackMisOrdered=new Set([...this.sackMisOrdered].filter(t));for(const e of[...this.sackMisOrdered].sort()){if(e!==_(this.lastReceivedTsn))break;this.lastReceivedTsn=e}this.sackDuplicates=this.sackDuplicates.filter(t),this.sackMisOrdered=new Set([...this.sackMisOrdered].filter(t));for(const[t,r]of e.streams){const e=this.getInboundStream(t);e.streamSequenceNumber=(0,u.uint16Add)(r,1);for(const t of e.popMessages())this.advertisedRwnd+=t[2].length,this.receive(...t)}Object.values(this.inboundStreams).forEach((e=>{this.advertisedRwnd+=e.pruneChunks(this.lastReceivedTsn)}))}updateRto(e){this.srtt?(this.rttvar=.75*this.rttvar+.25*Math.abs(this.srtt-e),this.srtt=.875*this.srtt+.125*e):(this.rttvar=e/2,this.srtt=e),this.rto=Math.max(1,Math.min(this.srtt+4*this.rttvar,60))}receive(e,t,r){this.onReceive.execute(e,t,r)}getInboundStream(e){return this.inboundStreams[e]||(this.inboundStreams[e]=new v),this.inboundStreams[e]}markReceived(e){if((0,u.uint32Gte)(this.lastReceivedTsn,e)||this.sackMisOrdered.has(e))return this.sackDuplicates.push(e),!0;this.sackMisOrdered.add(e);for(const e of[...this.sackMisOrdered].sort()){if(e!==_(this.lastReceivedTsn))break;this.lastReceivedTsn=e}const t=e=>(0,u.uint32Gt)(e,this.lastReceivedTsn);return this.sackDuplicates=this.sackDuplicates.filter(t),this.sackMisOrdered=new Set([...this.sackMisOrdered].filter(t)),!1}async transmit(){this.forwardTsnChunk&&(await this.sendChunk(this.forwardTsnChunk).catch((e=>{p("send forwardTsn failed",e.message)})),this.forwardTsnChunk=void 0,this.timer3Handle||this.timer3Start());const e=null!=this.fastRecoveryExit?2400:4800,t=Math.min(this.flightSize+e,this.cwnd);let r=!0;for(const e of this.sentQueue){if(e.retransmit){if(this.fastRecoveryTransmit)this.fastRecoveryTransmit=!1;else if(this.flightSize>=t)return;this.flightSizeIncrease(e),e.misses=0,e.retransmit=!1,e.sentCount++,await this.sendChunk(e).catch((e=>{p("send data failed",e.message)})),r&&this.timer3Restart()}r=!1}for(;this.outboundQueue.length>0;){const e=this.outboundQueue.shift();if(!e)return;this.sentQueue.push(e),this.flightSizeIncrease(e),e.sentCount++,e.sentTime=Date.now()/1e3,await this.sendChunk(e).catch((e=>{p("send data outboundQueue failed",e.message)})),this.timer3Handle||this.timer3Start()}}async transmitReconfigRequest(){if(this.reconfigQueue.length>0&&this.associationState===d.SCTP_STATE.ESTABLISHED&&!this.reconfigRequest){const e=this.reconfigQueue.slice(0,135);this.reconfigQueue=this.reconfigQueue.slice(135);const t=new f.OutgoingSSNResetRequestParam(this.reconfigRequestSeq,this.reconfigResponseSeq,S(this.localTsn),e);this.reconfigRequestSeq=_(this.reconfigRequestSeq),this.reconfigRequest=t,await this.sendReconfigParam(t),this.timerReconfigHandleStart()}}async sendReconfigParam(e){p("sendReconfigParam",e);const t=new h.ReconfigChunk;t.params.push([e.type,e.bytes]),await this.sendChunk(t).catch((e=>{p("send reconfig failed",e.message)}))}async sendResetRequest(e){p("sendResetRequest",e);const t=new h.DataChunk(0,void 0);t.streamId=e,this.outboundQueue.push(t),this.timer3Handle||await this.transmit()}flightSizeIncrease(e){this.flightSize+=e.bookSize}flightSizeDecrease(e){this.flightSize=Math.max(0,this.flightSize-e.bookSize)}timer1Start(e){if(this.timer1Handle)throw new Error;this.timer1Chunk=e,this.timer1Failures=0,this.timer1Handle=setTimeout(this.timer1Expired,1e3*this.rto)}timer1Cancel(){this.timer1Handle&&(clearTimeout(this.timer1Handle),this.timer1Handle=void 0,this.timer1Chunk=void 0)}t2Start(e){if(this.timer2Handle)throw new Error;this.timer2Chunk=e,this.timer2Failures=0,this.timer2Handle=setTimeout(this.timer2Expired,1e3*this.rto)}timer2Cancel(){this.timer2Handle&&(clearTimeout(this.timer2Handle),this.timer2Handle=void 0,this.timer2Chunk=void 0)}timer3Start(){if(this.timer3Handle)throw new Error;this.timer3Handle=setTimeout(this.timer3Expired,1e3*this.rto)}timer3Restart(){this.timer3Cancel(),this.timer3Handle=setTimeout(this.timer3Expired,this.rto)}timer3Cancel(){this.timer3Handle&&(clearTimeout(this.timer3Handle),this.timer3Handle=void 0)}timerReconfigHandleStart(){this.timerReconfigHandle||(p("timerReconfigHandleStart",{rto:this.rto}),this.timerReconfigFailures=0,this.timerReconfigHandle=setTimeout(this.timerReconfigHandleExpired,1e3*this.rto))}timerReconfigCancel(){this.timerReconfigHandle&&(p("timerReconfigCancel"),clearTimeout(this.timerReconfigHandle),this.timerReconfigHandle=void 0)}updateAdvancedPeerAckPoint(){(0,u.uint32Gt)(this.lastSackedTsn,this.advancedPeerAckTsn)&&(this.advancedPeerAckTsn=this.lastSackedTsn);let e=0;const t={};for(;this.sentQueue.length>0&&this.sentQueue[0].abandoned;){const r=this.sentQueue.shift();this.advancedPeerAckTsn=r.tsn,e++,4&r.flags||(t[r.streamId]=r.streamSeqNum)}e&&(this.forwardTsnChunk=new h.ForwardTsnChunk(0,void 0),this.forwardTsnChunk.cumulativeTsn=this.advancedPeerAckTsn,this.forwardTsnChunk.streams=Object.entries(t).map((([e,t])=>[Number(e),t])))}maybeAbandon(e){if(e.abandoned)return!0;if(!(!!e.maxRetransmits&&e.maxRetransmits<e.sentCount||!!e.expiry&&e.expiry<Date.now()/1e3))return!1;const t=this.sentQueue.findIndex((t=>t.type===e.type));for(const e of(0,a.default)(t,-1,-1)){const t=this.sentQueue[e];if(t.abandoned=!0,t.retransmit=!1,1&t.flags)break}for(const e of(0,a.default)(t,this.sentQueue.length)){const t=this.sentQueue[e];if(t.abandoned=!0,t.retransmit=!1,1&t.flags)break}return!0}static getCapabilities(){return new w(65536)}setRemotePort(e){this.remotePort=e}async start(e){this.started||(this.started=!0,this.setConnectionState("connecting"),e&&this.setRemotePort(e),this.isServer||await this.init())}async init(){const e=new h.InitChunk;e.initiateTag=this.localVerificationTag,e.advertisedRwnd=this.advertisedRwnd,e.outboundStreams=this._outboundStreamsCount,e.inboundStreams=this._inboundStreamsMax,e.initialTsn=this.localTsn,this.setExtensions(e.params),p("send init",e);try{await this.sendChunk(e),this.timer1Start(e),this.setState(d.SCTP_STATE.COOKIE_WAIT)}catch(e){p("send init failed",e.message)}}setExtensions(e){const t=[];this.localPartialReliability&&(e.push([49152,Buffer.from("")]),t.push(h.ForwardTsnChunk.type)),t.push(h.ReConfigChunk.type),e.push([32776,Buffer.from(t)])}async sendChunk(e){if("closed"===this.state)return;if(void 0===this.remotePort)throw new Error("invalid remote port");const t=(0,h.serializePacket)(this.localPort,this.remotePort,this.remoteVerificationTag,e);await this.transport.send(t)}setState(e){e!=this.associationState&&(this.associationState=e),e===d.SCTP_STATE.ESTABLISHED?this.setConnectionState("connected"):e===d.SCTP_STATE.CLOSED&&(this.timer1Cancel(),this.timer2Cancel(),this.timer3Cancel(),this.setConnectionState("closed"),this.removeAllListeners())}setConnectionState(e){this.state=e,p("setConnectionState",e),this.stateChanged[e].execute()}async stop(){this.associationState!==d.SCTP_STATE.CLOSED&&await this.abort(),this.setState(d.SCTP_STATE.CLOSED),clearTimeout(this.timer1Handle),clearTimeout(this.timer2Handle),clearTimeout(this.timer3Handle)}async abort(){const e=new h.AbortChunk;await this.sendChunk(e).catch((e=>{p("send abort failed",e.message)}))}removeAllListeners(){Object.values(this.stateChanged).forEach((e=>e.allUnsubscribe()))}}t.SCTP=b;class v{constructor(){this.reassembly=[],this.streamSequenceNumber=0}addChunk(e){if(0===this.reassembly.length||(0,u.uint32Gt)(e.tsn,this.reassembly[this.reassembly.length-1].tsn))this.reassembly.push(e);else for(const[t,r]of(0,l.enumerate)(this.reassembly)){if(r.tsn===e.tsn)throw new Error("duplicate chunk in reassembly");if((0,u.uint32Gt)(r.tsn,e.tsn)){this.reassembly.splice(t,0,e);break}}}*popMessages(){let e,t,r,i=0;for(;i<this.reassembly.length;){const n=this.reassembly[i];if(void 0===e){if(r=!(4&n.flags),!(2&n.flags)){if(r)break;i++;continue}if(r&&(0,u.uint16Gt)(n.streamSeqNum,this.streamSequenceNumber))break;t=n.tsn,e=i}else if(n.tsn!==t){if(r)break;e=void 0,i++;continue}if(1&n.flags){const t=this.reassembly.slice(e,i+1).map((e=>e.userData)).reduce(((e,t)=>(e.push(t),e.push(Buffer.from("")),e)),[]);t.pop();const s=Buffer.concat(t);this.reassembly=[...this.reassembly.slice(0,e),...this.reassembly.slice(i+1)],r&&n.streamSeqNum===this.streamSequenceNumber&&(this.streamSequenceNumber=(0,u.uint16Add)(this.streamSequenceNumber,1)),i=e,yield[n.streamId,n.protocol,s]}else i++;t=_(t)}}pruneChunks(e){let t=-1,r=0;for(const[i,n]of this.reassembly.entries()){if(!(0,u.uint32Gte)(e,n.tsn))break;t=i,r+=n.userData.length}return this.reassembly=this.reassembly.slice(t+1),r}}t.InboundStream=v;class w{constructor(e){this.maxMessageSize=e}}function S(e){return(e-1)%m}function _(e){return(e+1)%m}t.RTCSctpCapabilities=w},4536:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SignatureAlgorithm=t.ReceiverDirection=t.SenderDirections=t.SRTP_PROFILE=t.SSRC_INFO_ATTRS=t.FMTP_INT_PARAMETERS=t.DTLS_SETUP_ROLE=t.DTLS_ROLE_SETUP=t.DIRECTIONS=t.MEDIA_KINDS=t.DISCARD_PORT=t.DISCARD_HOST=t.WEBRTC_BINARY_EMPTY=t.WEBRTC_STRING_EMPTY=t.WEBRTC_BINARY=t.WEBRTC_STRING=t.WEBRTC_DCEP=t.DATA_CHANNEL_PARTIAL_RELIABLE_TIMED_UNORDERED=t.DATA_CHANNEL_PARTIAL_RELIABLE_REXMIT_UNORDERED=t.DATA_CHANNEL_RELIABLE_UNORDERED=t.DATA_CHANNEL_PARTIAL_RELIABLE_TIMED=t.DATA_CHANNEL_PARTIAL_RELIABLE_REXMIT=t.DATA_CHANNEL_RELIABLE=t.DATA_CHANNEL_OPEN=t.DATA_CHANNEL_ACK=void 0;const i=r(6759);Object.defineProperty(t,"SignatureAlgorithm",{enumerable:!0,get:function(){return i.SignatureAlgorithm}});const n=r(250);t.DATA_CHANNEL_ACK=2,t.DATA_CHANNEL_OPEN=3,t.DATA_CHANNEL_RELIABLE=0,t.DATA_CHANNEL_PARTIAL_RELIABLE_REXMIT=1,t.DATA_CHANNEL_PARTIAL_RELIABLE_TIMED=2,t.DATA_CHANNEL_RELIABLE_UNORDERED=128,t.DATA_CHANNEL_PARTIAL_RELIABLE_REXMIT_UNORDERED=129,t.DATA_CHANNEL_PARTIAL_RELIABLE_TIMED_UNORDERED=130,t.WEBRTC_DCEP=50,t.WEBRTC_STRING=51,t.WEBRTC_BINARY=53,t.WEBRTC_STRING_EMPTY=56,t.WEBRTC_BINARY_EMPTY=57,t.DISCARD_HOST="0.0.0.0",t.DISCARD_PORT=9,t.MEDIA_KINDS=["audio","video"],t.DIRECTIONS=["inactive","sendonly","recvonly","sendrecv"],t.DTLS_ROLE_SETUP={auto:"actpass",client:"active",server:"passive"},t.DTLS_SETUP_ROLE=Object.keys(t.DTLS_ROLE_SETUP).reduce(((e,r)=>(e[t.DTLS_ROLE_SETUP[r]]=r,e)),{}),t.FMTP_INT_PARAMETERS=["apt","max-fr","max-fs","maxplaybackrate","minptime","stereo","useinbandfec"],t.SSRC_INFO_ATTRS=["cname","msid","mslabel","label"],t.SRTP_PROFILE={SRTP_AES128_CM_HMAC_SHA1_80:n.ProtectionProfileAes128CmHmacSha1_80,SRTP_AEAD_AES_128_GCM:n.ProtectionProfileAeadAes128Gcm},t.SenderDirections=["sendonly","sendrecv"],t.ReceiverDirection=["sendrecv","recvonly"]},6639:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RTCDataChannelParameters=t.RTCDataChannel=void 0;const n=i(r(5493)),s=r(5473),o=r(3166),a=(0,n.default)("werift:packages/webrtc/src/dataChannel.ts");class c extends o.EventTarget{constructor(e,t,r=!0){if(super(),this.transport=e,this.parameters=t,this.sendOpen=r,this.stateChanged=new s.Event,this.message=new s.Event,this.error=new s.Event,this.bufferedAmountLow=new s.Event,this.isCreatedByRemote=!1,this.readyState="connecting",this.bufferedAmount=0,this._bufferedAmountLowThreshold=0,this.id=this.parameters.id,t.negotiated){if(null==this.id||this.id<0||this.id>65534)throw new Error("ID must be in range 0-65534 if data channel is negotiated out-of-band");this.transport.dataChannelAddNegotiated(this)}else r&&(this.sendOpen=!1,this.transport.dataChannelOpen(this))}get ordered(){return this.parameters.ordered}get maxRetransmits(){return this.parameters.maxRetransmits}get maxPacketLifeTime(){return this.parameters.maxPacketLifeTime}get label(){return this.parameters.label}get protocol(){return this.parameters.protocol}get negotiated(){return this.parameters.negotiated}get bufferedAmountLowThreshold(){return this._bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){if(e<0||e>4294967295)throw new Error("bufferedAmountLowThreshold must be in range 0 - 4294967295");this._bufferedAmountLowThreshold=e}setId(e){this.id=e}setReadyState(e){if(e!==this.readyState){switch(this.readyState=e,this.stateChanged.execute(e),e){case"open":this.onopen&&this.onopen(),this.emit("open");break;case"closed":this.onclose&&this.onclose(),this.emit("close");break;case"closing":this.onclosing&&this.onclosing()}a("change state",e)}}addBufferedAmount(e){const t=this.bufferedAmount>this.bufferedAmountLowThreshold&&this.bufferedAmount+e<=this.bufferedAmountLowThreshold;this.bufferedAmount+=e,t&&(this.bufferedAmountLow.execute(),this.emit("bufferedamountlow"))}send(e){this.transport.datachannelSend(this,e)}close(){this.transport.dataChannelClose(this)}}t.RTCDataChannel=c;t.RTCDataChannelParameters=class{constructor(e={}){this.label="",this.ordered=!0,this.protocol="",this.negotiated=!1,Object.assign(this,e)}}},3166:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EventTarget=t.PromiseQueue=t.divide=t.enumerate=void 0;const n=i(r(2361));t.enumerate=function(e){return e.map(((e,t)=>[t,e]))},t.divide=function(e,t){const r=e.split(t);return[r[0],r.slice(1).join(t)]};t.PromiseQueue=class{constructor(){this.queue=[],this.running=!1,this.push=e=>new Promise((t=>{this.queue.push({promise:e,done:t}),this.running||this.run()}))}async run(){const e=this.queue.shift();e?(this.running=!0,await e.promise(),e.done(),this.run()):this.running=!1}};class s extends n.default{constructor(){super(...arguments),this.addEventListener=(e,t)=>{this.addListener(e,t)},this.removeEventListener=(e,t)=>{this.removeListener(e,t)}}}t.EventTarget=s},4664:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(680),t),n(r(6759),t),n(r(3801),t),n(r(3924),t),n(r(6639),t),n(r(3752),t),n(r(9424),t),n(r(2751),t),n(r(5608),t),n(r(6730),t),n(r(8497),t),n(r(5923),t),n(r(8385),t),n(r(9661),t),n(r(4917),t),n(r(4849),t),n(r(4990),t),n(r(9524),t),n(r(5580),t)},3752:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useTWCC=t.useREMB=t.usePLI=t.useNACK=t.useFIR=void 0;t.useFIR=()=>({type:"ccm",parameter:"fir"});t.useNACK=()=>({type:"nack"});t.usePLI=()=>({type:"nack",parameter:"pli"});t.useREMB=()=>({type:"goog-remb"});t.useTWCC=()=>({type:"transport-cc"})},9424:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useDependencyDescriptor=t.useAbsSendTime=t.useTransportWideCC=t.useRepairedRtpStreamId=t.useSdesRTPStreamId=t.useSdesMid=t.RTP_EXTENSION_URI=void 0;const i=r(2751);t.RTP_EXTENSION_URI={sdesMid:"urn:ietf:params:rtp-hdrext:sdes:mid",sdesRTPStreamID:"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id",repairedRtpStreamId:"urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id",transportWideCC:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",absSendTime:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",dependencyDescriptor:"https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension"},t.useSdesMid=function(){return new i.RTCRtpHeaderExtensionParameters({uri:t.RTP_EXTENSION_URI.sdesMid})},t.useSdesRTPStreamId=function(){return new i.RTCRtpHeaderExtensionParameters({uri:t.RTP_EXTENSION_URI.sdesRTPStreamID})},t.useRepairedRtpStreamId=function(){return new i.RTCRtpHeaderExtensionParameters({uri:t.RTP_EXTENSION_URI.repairedRtpStreamId})},t.useTransportWideCC=function(){return new i.RTCRtpHeaderExtensionParameters({uri:t.RTP_EXTENSION_URI.transportWideCC})},t.useAbsSendTime=function(){return new i.RTCRtpHeaderExtensionParameters({uri:t.RTP_EXTENSION_URI.absSendTime})},t.useDependencyDescriptor=function(){return new i.RTCRtpHeaderExtensionParameters({uri:t.RTP_EXTENSION_URI.dependencyDescriptor})}},2751:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RTCRtpSimulcastParameters=t.RTCRtpCodingParameters=t.RTCRtpRtxParameters=t.RTCRtcpFeedback=t.RTCRtcpParameters=t.RTCRtpHeaderExtensionParameters=t.RTCRtpCodecParameters=void 0;t.RTCRtpCodecParameters=class{constructor(e){this.rtcpFeedback=[],this.direction="all",Object.assign(this,e)}get name(){return this.mimeType.split("/")[1]}get contentType(){return this.mimeType.split("/")[0]}get str(){let e=`${this.name}/${this.clockRate}`;return 2===this.channels&&(e+="/2"),e}};t.RTCRtpHeaderExtensionParameters=class{constructor(e){Object.assign(this,e)}};t.RTCRtcpParameters=class{constructor(e={}){this.mux=!1,Object.assign(this,e)}};t.RTCRtcpFeedback=class{constructor(e={}){Object.assign(this,e)}};t.RTCRtpRtxParameters=class{constructor(e={}){Object.assign(this,e)}};t.RTCRtpCodingParameters=class{constructor(e){Object.assign(this,e)}};t.RTCRtpSimulcastParameters=class{constructor(e){Object.assign(this,e)}}},5141:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.NackHandler=void 0;const n=i(r(5493)),s=i(r(201)),o=i(r(5473)),a=r(680),c=r(3924),u=(0,n.default)("werift:packages/webrtc/src/media/receiver/nack.ts");t.NackHandler=class{constructor(e){this.receiver=e,this.newEstSeqNum=0,this._lost={},this.onPacketLost=new o.default,this.retryCount=10,this.closed=!1,this.sendNack=()=>new Promise(((e,t)=>{if(this.lostSeqNumbers.length>0&&this.mediaSourceSsrc){const r=new c.GenericNack({senderSsrc:this.receiver.rtcpSsrc,mediaSourceSsrc:this.mediaSourceSsrc,lost:this.lostSeqNumbers}),i=new c.RtcpTransportLayerFeedback({feedback:r});this.receiver.dtlsTransport.sendRtcp([i]).then(e).catch(t),this.updateRetryCount(),this.onPacketLost.execute(r)}}))}get lostSeqNumbers(){return Object.keys(this._lost).map(Number).sort()}getLost(e){return this._lost[e]}setLost(e,t){this._lost[e]=t,this.nackLoop||this.closed||(this.nackLoop=setInterval((async()=>{try{await this.sendNack(),Object.keys(this._lost).length||(clearInterval(this.nackLoop),this.nackLoop=void 0)}catch(e){u("failed to send nack",e)}}),5))}removeLost(e){delete this._lost[e]}addPacket(e){const{sequenceNumber:t,ssrc:r}=e.header;this.mediaSourceSsrc=r,0!==this.newEstSeqNum?this.getLost(t)?this.removeLost(t):t===(0,a.uint16Add)(this.newEstSeqNum,1)?this.newEstSeqNum=t:t>(0,a.uint16Add)(this.newEstSeqNum,1)&&((0,s.default)((0,a.uint16Add)(this.newEstSeqNum,1),t).forEach((e=>{this.setLost(e,1)})),this.newEstSeqNum=t,this.pruneLost()):this.newEstSeqNum=t}pruneLost(){this.lostSeqNumbers.length>150&&(this._lost=Object.entries(this._lost).slice(-150).reduce(((e,[t,r])=>(e[t]=r,e)),{}))}close(){this.closed=!0,clearInterval(this.nackLoop),this._lost={}}updateRetryCount(){this.lostSeqNumbers.forEach((e=>{if(this._lost[e]++>this.retryCount)return this.removeLost(e),e}))}}},7355:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ReceiverTWCC=void 0;const n=i(r(5493)),s=r(8670),o=r(680),a=r(3924),c=r(5580),u=(0,n.default)("werift:packages/webrtc/media/receiver/receiverTwcc");t.ReceiverTWCC=class{constructor(e,t,r){this.dtlsTransport=e,this.rtcpSsrc=t,this.mediaSourceSsrc=r,this.extensionInfo={},this.twccRunning=!1,this.fbPktCount=0,this.runTWCC()}handleTWCC(e){this.extensionInfo[e]={tsn:e,timestamp:(0,c.microTime)()},Object.keys(this.extensionInfo).length>10&&this.sendTWCC()}async runTWCC(){for(;this.twccRunning;)this.sendTWCC(),await(0,s.setTimeout)(100)}sendTWCC(){if(0===Object.keys(this.extensionInfo).length)return;const e=Object.values(this.extensionInfo).sort(((e,t)=>e.tsn-t.tsn)),t=e[0].tsn,r=e.slice(-1)[0].tsn,i=[],n=e[0].tsn,s=(0,o.uint16Add)(r-t,1);let c,h;const d=[];for(let e=t;e<=r;e++){const t=this.extensionInfo[e]?.timestamp;if(t){this.lastTimestamp||(this.lastTimestamp=t),c||(c=this.lastTimestamp);const n=t-this.lastTimestamp;this.lastTimestamp=t;const s=new a.RecvDelta({delta:Number(n)});s.parseDelta(),d.push(s),null!=h&&h.status!==s.type&&(i.push(new a.RunLengthChunk({packetStatus:h.status,runLength:e-h.minTSN})),h={minTSN:e,status:s.type}),e===r&&(null!=h?i.push(new a.RunLengthChunk({packetStatus:h.status,runLength:e-h.minTSN+1})):i.push(new a.RunLengthChunk({packetStatus:s.type,runLength:1}))),null==h&&(h={minTSN:e,status:s.type})}}if(!c)return;const l=new a.RtcpTransportLayerFeedback({feedback:new a.TransportWideCC({senderSsrc:this.rtcpSsrc,mediaSourceSsrc:this.mediaSourceSsrc,baseSequenceNumber:n,packetStatusCount:s,referenceTime:(0,o.uint24)(Math.floor(c/1e3/64)),fbPktCount:this.fbPktCount,recvDeltas:d,packetChunks:i})});this.dtlsTransport.sendRtcp([l]).catch((e=>{u(e)})),this.extensionInfo={},this.fbPktCount=(0,o.uint8Add)(this.fbPktCount,1)}}},7273:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StreamStatistics=void 0;const i=r(680);t.StreamStatistics=class{constructor(e){this.cycles=0,this.packets_received=0,this.jitter_q4=0,this.expected_prior=0,this.received_prior=0,this.clockRate=e}add(e,t=Date.now()/1e3){const r=null==this.max_seq||(0,i.uint16Gt)(e.header.sequenceNumber,this.max_seq);if(this.packets_received++,null==this.base_seq&&(this.base_seq=e.header.sequenceNumber),r){const r=(0,i.int)(t*this.clockRate);if(null!=this.max_seq&&e.header.sequenceNumber<this.max_seq&&(this.cycles+=65536),this.max_seq=e.header.sequenceNumber,e.header.timestamp!==this.last_timestamp&&this.packets_received>1){const t=Math.abs(r-(this.last_arrival??0)-(e.header.timestamp-(this.last_timestamp??0)));this.jitter_q4+=t-(this.jitter_q4+8>>4)}this.last_arrival=r,this.last_timestamp=e.header.timestamp}}get fraction_lost(){const e=this.packets_expected-this.expected_prior;this.expected_prior=this.packets_expected;const t=this.packets_received-this.received_prior;this.received_prior=this.packets_received;const r=e-t;return 0==e||r<=0?0:Math.floor((r<<8)/e)}get jitter(){return this.jitter_q4>>4}get packets_expected(){return this.cycles+(this.max_seq??0)-(this.base_seq??0)+1}get packets_lost(){const e=this.packets_expected-this.packets_received;return e<0?0:e}}},9668:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RtpRouter=void 0;const n=i(r(5493)),s=r(680),o=r(3924),a=r(9424),c=r(8638),u=r(6730),h=(0,n.default)("werift:packages/webrtc/src/media/router.ts");class d{constructor(){this.ssrcTable={},this.ridTable={},this.extIdUriMap={},this.routeRtp=e=>{const t=d.rtpHeaderExtensionsParser(e.header.extensions,this.extIdUriMap);let r=this.ssrcTable[e.header.ssrc];const i=t[a.RTP_EXTENSION_URI.sdesRTPStreamID];if("string"==typeof i?(r=this.ridTable[i],r.latestRid=i,r.handleRtpByRid(e,i,t)):r?r.handleRtpBySsrc(e,t):(r=Object.values(this.ridTable).filter((e=>e instanceof c.RTCRtpReceiver)).find((t=>t.trackBySSRC[e.header.ssrc])),r&&(h("simulcast register receiver by ssrc",e.header.ssrc),this.registerRtpReceiver(r,e.header.ssrc),r.handleRtpBySsrc(e,t))),!r)return void h("ssrcReceiver not found");const n=t[a.RTP_EXTENSION_URI.sdesMid];"string"==typeof n&&(r.sdesMid=n);const s=t[a.RTP_EXTENSION_URI.repairedRtpStreamId];"string"==typeof s&&(r.latestRepairedRid=s)},this.routeRtcp=e=>{const t=[];switch(e.type){case o.RtcpSrPacket.type:t.push(this.ssrcTable[e.ssrc]);break;case o.RtcpRrPacket.type:e.reports.forEach((e=>{t.push(this.ssrcTable[e.ssrc])}));break;case o.RtcpSourceDescriptionPacket.type:break;case o.RtcpTransportLayerFeedback.type:{const r=e;r.feedback&&t.push(this.ssrcTable[r.feedback.mediaSourceSsrc])}break;case o.RtcpPayloadSpecificFeedback.type:{const r=e;if(r.feedback.count===o.ReceiverEstimatedMaxBitrate.count){const e=r.feedback;t.push(this.ssrcTable[e.ssrcFeedbacks[0]])}else t.push(this.ssrcTable[r.feedback.senderSsrc])}}t.filter((e=>e)).forEach((t=>t.handleRtcpPacket(e)))}}registerRtpSender(e){this.ssrcTable[e.ssrc]=e}registerRtpReceiver(e,t){h("registerRtpReceiver",t),this.ssrcTable[t]=e}registerRtpReceiverBySsrc(e,t){h("registerRtpReceiverBySsrc",t),t.encodings.filter((e=>null!=e.ssrc)).forEach(((r,i)=>{this.registerRtpReceiver(e.receiver,r.ssrc),e.addTrack(new u.MediaStreamTrack({ssrc:r.ssrc,kind:e.kind,id:e.sender.trackId,remote:!0,codec:t.codecs[i]})),r.rtx&&this.registerRtpReceiver(e.receiver,r.rtx.ssrc)})),t.headerExtensions.forEach((e=>{this.extIdUriMap[e.id]=e.uri}))}registerRtpReceiverByRid(e,t,r){const[i]=r.codecs;h("registerRtpReceiverByRid",t),e.addTrack(new u.MediaStreamTrack({rid:t.rid,kind:e.kind,id:e.sender.trackId,remote:!0,codec:i})),this.ridTable[t.rid]=e.receiver}static rtpHeaderExtensionsParser(e,t){return e.map((e=>{const r=t[e.id];switch(r){case a.RTP_EXTENSION_URI.sdesMid:case a.RTP_EXTENSION_URI.sdesRTPStreamID:case a.RTP_EXTENSION_URI.repairedRtpStreamId:return{uri:r,value:e.payload.toString()};case a.RTP_EXTENSION_URI.transportWideCC:return{uri:r,value:e.payload.readUInt16BE()};case a.RTP_EXTENSION_URI.absSendTime:return{uri:r,value:(0,s.bufferReader)(e.payload,[3])[0]};default:return{uri:r,value:0}}})).reduce(((e,t)=>(t&&(e[t.uri]=t.value),e)),{})}}t.RtpRouter=d},8638:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.unwrapRtx=t.RTCRtpReceiver=void 0;const n=r(5493),s=r(239),o=i(r(5473)),a=r(8670),c=r(2163),u=r(680),h=r(3924),d=r(4664),l=r(5580),f=r(9424),p=r(5141),y=r(7355),m=r(7273),g=(0,n.debug)("werift:packages/webrtc/src/media/rtpReceiver.ts");function b(e,t,r){return new h.RtpPacket(new h.RtpHeader({payloadType:t,marker:e.header.marker,sequenceNumber:s.jspack.Unpack("!H",e.payload.subarray(0,2))[0],timestamp:e.header.timestamp,ssrc:r}),e.payload.subarray(2))}t.RTCRtpReceiver=class{get codecArray(){return Object.values(this.codecs).sort(((e,t)=>e.payloadType-t.payloadType))}constructor(e,t,r){this.config=e,this.kind=t,this.rtcpSsrc=r,this.codecs={},this.ssrcByRtx={},this.nack=new p.NackHandler(this),this.audioRedHandler=new h.RedHandler,this.type="receiver",this.uuid=(0,c.v4)(),this.tracks=[],this.trackBySSRC={},this.trackByRID={},this.lastSRtimestamp={},this.receiveLastSRTimestamp={},this.onPacketLost=this.nack.onPacketLost,this.onRtcp=new o.default,this.stopped=!1,this.rtcpRunning=!1,this.rtcpCancel=new AbortController,this.remoteStreams={},this.handleRtpBySsrc=(e,t)=>{const r=this.trackBySSRC[e.header.ssrc];this.handleRTP(e,t,r)},this.handleRtpByRid=(e,t,r)=>{const i=this.trackByRID[t];this.trackBySSRC[e.header.ssrc]||(this.trackBySSRC[e.header.ssrc]=i),this.handleRTP(e,r,i)}}setDtlsTransport(e){this.dtlsTransport=e}get track(){return this.tracks[0]}get nackEnabled(){return this.codecArray[0]?.rtcpFeedback.find((e=>"nack"===e.type))}get twccEnabled(){return this.codecArray[0]?.rtcpFeedback.find((e=>e.type===(0,d.useTWCC)().type))}get pliEnabled(){return this.codecArray[0]?.rtcpFeedback.find((e=>e.type===(0,d.usePLI)().type))}prepareReceive(e){e.codecs.forEach((e=>{this.codecs[e.payloadType]=e})),e.encodings.forEach((e=>{e.rtx&&(this.ssrcByRtx[e.rtx.ssrc]=e.ssrc)}))}setupTWCC(e){this.twccEnabled&&!this.receiverTWCC&&(this.receiverTWCC=new y.ReceiverTWCC(this.dtlsTransport,this.rtcpSsrc,e))}addTrack(e){return!this.tracks.find((t=>t.rid?t.rid===e.rid:t.ssrc?t.ssrc===e.ssrc:void 0))&&(this.tracks.push(e),e.ssrc&&(this.trackBySSRC[e.ssrc]=e),e.rid&&(this.trackByRID[e.rid]=e),!0)}stop(){this.stopped=!0,this.rtcpRunning=!1,this.rtcpCancel.abort(),this.receiverTWCC&&(this.receiverTWCC.twccRunning=!1),this.nack.close()}async runRtcp(){if(!this.rtcpRunning&&!this.stopped){this.rtcpRunning=!0;try{for(;this.rtcpRunning;){await(0,a.setTimeout)(500+1e3*Math.random(),void 0,{signal:this.rtcpCancel.signal});const e=Object.entries(this.remoteStreams).map((([e,t])=>{let r=0,i=0;if(this.lastSRtimestamp[e]){r=this.lastSRtimestamp[e];const t=(0,l.timestampSeconds)()-this.receiveLastSRTimestamp[e];t>0&&t<65536&&(i=(0,u.int)(65536*t))}return new h.RtcpReceiverInfo({ssrc:Number(e),fractionLost:t.fraction_lost,packetsLost:t.packets_lost,highestSequence:t.max_seq,jitter:t.jitter,lsr:r,dlsr:i})})),t=new h.RtcpRrPacket({ssrc:this.rtcpSsrc,reports:e});try{this.config.debug.receiverReportDelay&&await(0,a.setTimeout)(this.config.debug.receiverReportDelay),await this.dtlsTransport.sendRtcp([t])}catch(e){g("sendRtcp failed",e),await(0,a.setTimeout)(500+1e3*Math.random())}}}catch(e){}}}getStats(){}async sendRtcpPLI(e){if(!this.pliEnabled)return void g("pli not supported",{mediaSsrc:e});if(this.stopped)return;g("sendRtcpPLI",{mediaSsrc:e});const t=new h.RtcpPayloadSpecificFeedback({feedback:new h.PictureLossIndication({senderSsrc:this.rtcpSsrc,mediaSsrc:e})});try{await this.dtlsTransport.sendRtcp([t])}catch(e){g(e)}}handleRtcpPacket(e){if(e.type===h.RtcpSrPacket.type){const t=e;this.lastSRtimestamp[t.ssrc]=(0,l.compactNtp)(t.senderInfo.ntpTimestamp),this.receiveLastSRTimestamp[t.ssrc]=(0,l.timestampSeconds)();const r=this.trackBySSRC[e.ssrc];r&&r.onReceiveRtcp.execute(e)}this.onRtcp.execute(e)}handleRTP(e,t,r){if(this.stopped)return;const i=this.codecs[e.header.payloadType];if(!i)return;if(this.remoteStreams[e.header.ssrc]=this.remoteStreams[e.header.ssrc]??new m.StreamStatistics(i.clockRate),this.remoteStreams[e.header.ssrc].add(e),this.receiverTWCC){const e=t[f.RTP_EXTENSION_URI.transportWideCC];if(null==!e)throw new Error("undefined");this.receiverTWCC.handleTWCC(e)}else this.twccEnabled&&this.setupTWCC(e.header.ssrc);if("rtx"===i.name.toLowerCase()){const t=this.ssrcByRtx[e.header.ssrc],n=(0,d.codecParametersFromString)(i.parameters??""),s=this.codecs[n.apt];if(e.payload.length<2)return;e=b(e,s.payloadType,t),r=this.trackBySSRC[t]}let n;if("red"!==i.name.toLowerCase()||(n=h.Red.deSerialize(e.payload),Object.keys(this.codecs).includes(n.header.fields[0].blockPT.toString()))){if("video"===r?.kind&&this.nackEnabled&&this.nack.addPacket(e),r)if(n){if("audio"===r.kind){const t=this.audioRedHandler.push(n,e);for(const e of t)r.onReceiveRtp.execute(e.clone())}}else r.onReceiveRtp.execute(e.clone());this.runRtcp()}}},t.unwrapRtx=b},3735:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.wrapRtx=t.RTCRtpSender=void 0;const a=r(6113),c=o(r(5493)),u=r(239),h=o(r(5473)),d=r(8670),l=s(r(2163)),f=r(680),p=r(3924),y=r(4664),m=r(5580),g=r(9424),b=r(3198),v=r(6730),w=(0,c.default)("werift:packages/webrtc/src/media/rtpSender.ts");function S(e,t,r,i){return new p.RtpPacket(new p.RtpHeader({payloadType:t,marker:e.header.marker,sequenceNumber:r,timestamp:e.header.timestamp,ssrc:i,csrc:e.header.csrc,extensions:e.header.extensions}),Buffer.concat([Buffer.from(u.jspack.Pack("!H",[e.header.sequenceNumber])),e.payload]))}t.RTCRtpSender=class{constructor(e){this.trackOrKind=e,this.type="sender",this.ssrc=u.jspack.Unpack("!L",(0,a.randomBytes)(4))[0],this.rtxSsrc=u.jspack.Unpack("!L",(0,a.randomBytes)(4))[0],this.streamId=l.v4(),this.trackId=l.v4(),this.onReady=new h.default,this.onRtcp=new h.default,this.onPictureLossIndication=new h.default,this.onGenericNack=new h.default,this.senderBWE=new b.SenderBandwidthEstimator,this.rtxSequenceNumber=(0,f.random16)(),this._redDistance=2,this.redEncoder=new p.RedEncoder(this._redDistance),this.headerExtensions=[],this.ntpTimestamp=0n,this.rtpTimestamp=0,this.octetCount=0,this.packetCount=0,this.receiverEstimatedMaxBitrate=0n,this.timestampOffset=0,this.seqOffset=0,this.rtpCache=[],this.dtlsDisposer=[],this.stopped=!1,this.rtcpRunning=!1,this.rtcpCancel=new AbortController,this.kind="string"==typeof this.trackOrKind?this.trackOrKind:this.trackOrKind.kind,e instanceof v.MediaStreamTrack&&(e.streamId&&(this.streamId=e.streamId),this.registerTrack(e))}setDtlsTransport(e){this.dtlsTransport&&this.dtlsDisposer.forEach((e=>e())),this.dtlsTransport=e,this.dtlsDisposer=[this.dtlsTransport.onStateChange.subscribe((e=>{"connected"===e&&this.onReady.execute()})).unSubscribe]}get redDistance(){return this._redDistance}set redDistance(e){this._redDistance=e,this.redEncoder.distance=e}prepareSend(e){this.cname=e.rtcp?.cname,this.mid=e.muxId,this.headerExtensions=e.headerExtensions,this.rtpStreamId=e.rtpStreamId,this.repairedRtpStreamId=e.repairedRtpStreamId,this.codec=e.codecs[0],this.track&&(this.track.codec=this.codec),e.codecs.forEach((e=>{const t=(0,y.codecParametersFromString)(e.parameters??"");"rtx"===e.name.toLowerCase()&&t.apt===this.codec?.payloadType&&(this.rtxPayloadType=e.payloadType),"red"===e.name.toLowerCase()&&(this.redRedundantPayloadType=Number((e.parameters??"").split("/")[0]))}))}registerTrack(e){if(e.stopped)throw new Error("track is ended");this.disposeTrack&&this.disposeTrack(),e.id=this.trackId;const{unSubscribe:t}=e.onReceiveRtp.subscribe((async e=>{await this.sendRtp(e)}));this.track=e,this.disposeTrack=t,this.codec&&(e.codec=this.codec),e.onSourceChanged.subscribe((e=>{this.replaceRTP(e)}))}async replaceTrack(e){if(null!==e){if(e.stopped)throw new Error("track is ended");if(null!=this.sequenceNumber){const t=e.header||(await e.onReceiveRtp.asPromise())[0].header;this.replaceRTP(t)}this.registerTrack(e),w("replaceTrack","ssrc",e.ssrc,"rid",e.rid)}}stop(){this.stopped=!0,this.rtcpRunning=!1,this.rtcpCancel.abort(),this.disposeTrack&&this.disposeTrack(),this.track=void 0}async runRtcp(){if(!this.rtcpRunning&&!this.stopped){this.rtcpRunning=!0;try{for(;this.rtcpRunning;){await(0,d.setTimeout)(500+1e3*Math.random(),void 0,{signal:this.rtcpCancel.signal});const e=[new p.RtcpSrPacket({ssrc:this.ssrc,senderInfo:new p.RtcpSenderInfo({ntpTimestamp:this.ntpTimestamp,rtpTimestamp:this.rtpTimestamp,packetCount:this.packetCount,octetCount:this.octetCount})})];this.lastSRtimestamp=(0,m.compactNtp)(this.ntpTimestamp),this.lastSentSRTimestamp=(0,m.timestampSeconds)(),this.cname&&e.push(new p.RtcpSourceDescriptionPacket({chunks:[new p.SourceDescriptionChunk({source:this.ssrc,items:[new p.SourceDescriptionItem({type:1,text:this.cname})]})]}));try{await this.dtlsTransport.sendRtcp(e)}catch(e){w("sendRtcp failed",e),await(0,d.setTimeout)(500+1e3*Math.random())}}}catch(e){}}}replaceRTP({sequenceNumber:e,timestamp:t},r=!1){null!=this.sequenceNumber&&(this.seqOffset=(0,f.uint16Add)(this.sequenceNumber,-e),r&&(this.seqOffset=(0,f.uint16Add)(this.seqOffset,2))),null!=this.timestamp&&(this.timestampOffset=(0,f.uint32Add)(this.timestamp,-t),r&&(this.timestampOffset=(0,f.uint16Add)(this.timestampOffset,1))),this.rtpCache=[],w("replaceRTP",this.sequenceNumber,e,this.seqOffset)}async sendRtp(e){if("connected"!==this.dtlsTransport.state||!this.codec)return;e=Buffer.isBuffer(e)?p.RtpPacket.deSerialize(e):e;const{header:t,payload:r}=e;t.ssrc=this.ssrc,t.payloadType=this.codec.payloadType,t.timestamp=(0,f.uint32Add)(t.timestamp,this.timestampOffset),t.sequenceNumber=(0,f.uint16Add)(t.sequenceNumber,this.seqOffset),this.timestamp=t.timestamp,this.sequenceNumber=t.sequenceNumber;const i=(0,m.ntpTime)();t.extensions=this.headerExtensions.map((e=>{const t=(()=>{switch(e.uri){case g.RTP_EXTENSION_URI.sdesMid:return this.mid?Buffer.from(this.mid):void 0;case g.RTP_EXTENSION_URI.sdesRTPStreamID:return this.rtpStreamId?Buffer.from(this.rtpStreamId):void 0;case g.RTP_EXTENSION_URI.repairedRtpStreamId:return this.repairedRtpStreamId?Buffer.from(this.repairedRtpStreamId):void 0;case g.RTP_EXTENSION_URI.transportWideCC:return this.dtlsTransport.transportSequenceNumber=(0,f.uint16Add)(this.dtlsTransport.transportSequenceNumber,1),(0,f.bufferWriter)([2],[this.dtlsTransport.transportSequenceNumber]);case g.RTP_EXTENSION_URI.absSendTime:const e=Buffer.alloc(3),t=i>>14n&0x00ffffffn;return e.writeUIntBE(Number(t),0,3),e}})();if(t)return{id:e.id,payload:t}})).filter((e=>e)),this.ntpTimestamp=i,this.rtpTimestamp=t.timestamp,this.octetCount+=r.length,this.packetCount=(0,f.uint32Add)(this.packetCount,1),this.rtpCache[t.sequenceNumber%128]=e;let n=r;if(this.redRedundantPayloadType){this.redEncoder.push({block:n,timestamp:t.timestamp,blockPT:this.redRedundantPayloadType});n=this.redEncoder.build().serialize()}const s=await this.dtlsTransport.sendRtp(n,t);this.runRtcp();const o=(0,m.milliTime)(),a={wideSeq:this.dtlsTransport.transportSequenceNumber,size:s,sendingAtMs:o,sentAtMs:o};this.senderBWE.rtpPacketSent(a)}handleRtcpPacket(e){switch(e.type){case p.RtcpSrPacket.type:case p.RtcpRrPacket.type:e.reports.filter((e=>e.ssrc===this.ssrc)).forEach((e=>{if(this.lastSRtimestamp===e.lsr&&e.dlsr&&this.lastSentSRTimestamp){const t=(0,m.timestampSeconds)()-this.lastSentSRTimestamp-e.dlsr/65536;void 0===this.rtt?this.rtt=t:this.rtt=.85*this.rtt+(1-.85)*t}}));break;case p.RtcpTransportLayerFeedback.type:{const t=e;switch(t.feedback.count){case p.TransportWideCC.count:{const e=t.feedback;this.senderBWE.receiveTWCC(e)}break;case p.GenericNack.count:{const e=t.feedback;e.lost.forEach((async e=>{let t=this.rtpCache[e%128];t&&t.header.sequenceNumber!==e&&(t=void 0),t&&(null!=this.rtxPayloadType&&(t=S(t,this.rtxPayloadType,this.rtxSequenceNumber,this.rtxSsrc),this.rtxSequenceNumber=(0,f.uint16Add)(this.rtxSequenceNumber,1)),await this.dtlsTransport.sendRtp(t.payload,t.header))})),this.onGenericNack.execute(e)}}}break;case p.RtcpPayloadSpecificFeedback.type:{const t=e;switch(t.feedback.count){case p.ReceiverEstimatedMaxBitrate.count:{const e=t.feedback;this.receiverEstimatedMaxBitrate=e.bitrate}break;case p.PictureLossIndication.count:this.onPictureLossIndication.execute()}}}this.onRtcp.execute(e)}},t.wrapRtx=S},5608:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Directions=t.Sendrecv=t.Recvonly=t.Sendonly=t.Inactive=t.RTCRtpTransceiver=void 0;const a=o(r(5473)),c=s(r(2163)),u=r(4536);t.RTCRtpTransceiver=class{set codecs(e){this._codecs=e}get codecs(){return this._codecs}constructor(e,t,r,i,n){this.kind=e,this.receiver=r,this.sender=i,this._direction=n,this.id=c.v4(),this.onTrack=new a.default,this.usedForSender=!1,this._codecs=[],this.headerExtensions=[],this.options={},this.stopping=!1,this.stopped=!1,this.setDtlsTransport(t)}get dtlsTransport(){return this.receiver.dtlsTransport}get direction(){return this._direction}setDirection(e){this._direction=e,u.SenderDirections.includes(this._currentDirection??"")&&(this.usedForSender=!0)}get currentDirection(){return this._currentDirection}setCurrentDirection(e){this._currentDirection=e}setDtlsTransport(e){this.receiver.setDtlsTransport(e),this.sender.setDtlsTransport(e)}get msid(){return`${this.sender.streamId} ${this.sender.trackId}`}addTrack(e){this.receiver.addTrack(e)&&this.onTrack.execute(e,this)}stop(){this.stopping||(this.stopping=!0)}getPayloadType(e){return this.codecs.find((t=>t.mimeType.toLowerCase().includes(e.toLowerCase())))?.payloadType}},t.Inactive="inactive",t.Sendonly="sendonly",t.Recvonly="recvonly",t.Sendrecv="sendrecv",t.Directions=[t.Inactive,t.Sendonly,t.Recvonly,t.Sendrecv]},383:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CumulativeResult=void 0;const i=r(253);t.CumulativeResult=class{constructor(){this.numPackets=0,this.totalSize=0,this.firstPacketSentAtMs=0,this.lastPacketSentAtMs=0,this.firstPacketReceivedAtMs=0,this.lastPacketReceivedAtMs=0}addPacket(e,t,r){0===this.numPackets?(this.firstPacketSentAtMs=t,this.firstPacketReceivedAtMs=r,this.lastPacketSentAtMs=t,this.lastPacketReceivedAtMs=r):(t<this.firstPacketSentAtMs&&(this.firstPacketSentAtMs=t),r<this.firstPacketReceivedAtMs&&(this.firstPacketReceivedAtMs=r),t>this.lastPacketSentAtMs&&(this.lastPacketSentAtMs=t),r>this.lastPacketReceivedAtMs&&(this.lastPacketReceivedAtMs=r)),this.numPackets++,this.totalSize+=e}reset(){this.numPackets=0,this.totalSize=0,this.firstPacketSentAtMs=0,this.lastPacketSentAtMs=0,this.firstPacketReceivedAtMs=0,this.lastPacketReceivedAtMs=0}get receiveBitrate(){const e=this.lastPacketReceivedAtMs-this.firstPacketReceivedAtMs,t=this.totalSize/e*8*1e3;return(0,i.Int)(t)}get sendBitrate(){const e=this.lastPacketSentAtMs-this.firstPacketSentAtMs,t=this.totalSize/e*8*1e3;return(0,i.Int)(t)}}},3198:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SenderBandwidthEstimator=void 0;const n=i(r(5473)),s=r(253),o=r(5580),a=r(383),c=20;t.SenderBandwidthEstimator=class{get congestionScore(){return this._congestionScore}set congestionScore(e){this._congestionScore=e,this.onCongestionScore.execute(e)}get availableBitrate(){return this._availableBitrate}set availableBitrate(e){this._availableBitrate=e,this.onAvailableBitrate.execute(e)}constructor(){this.congestion=!1,this.onAvailableBitrate=new n.default,this.onCongestion=new n.default,this.onCongestionScore=new n.default,this.congestionCounter=0,this.cumulativeResult=new a.CumulativeResult,this.sentInfos={},this._congestionScore=1,this._availableBitrate=0}receiveTWCC(e){const t=(0,o.milliTime)()-this.cumulativeResult.firstPacketSentAtMs;t>1e3&&(this.cumulativeResult.reset(),this.congestionCounter<c?this.congestionCounter++:this.congestionScore<10&&this.congestionScore++,this.congestionCounter>=c&&!this.congestion&&(this.congestion=!0,this.onCongestion.execute(this.congestion)));for(const t of e.packetResults){if(!t.received)continue;const e=t.sequenceNumber,r=this.sentInfos[e];r&&(t.receivedAtMs&&this.cumulativeResult.addPacket(r.size,r.sendingAtMs,t.receivedAtMs))}if(t>=100&&this.cumulativeResult.numPackets>=20){if(this.availableBitrate=Math.min(this.cumulativeResult.sendBitrate,this.cumulativeResult.receiveBitrate),this.cumulativeResult.reset(),this.congestionCounter>-20){const e=(0,s.Int)(10)+1,t=e-(e-((0,s.Int)(5)+1))/10*this.congestionScore;this.congestionCounter=this.congestionCounter-t}this.congestionCounter<=-20&&(this.congestionScore>1&&(this.congestionScore--,this.onCongestion.execute(!1)),this.congestionCounter=0),this.congestionCounter<=0&&this.congestion&&(this.congestion=!1,this.onCongestion.execute(this.congestion))}}rtpPacketSent(e){Object.keys(e).map((e=>Number(e))).sort().filter((t=>t<e.wideSeq)).forEach((e=>{delete this.sentInfos[e]})),this.sentInfos[e.wideSeq]=e}}},6730:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MediaStream=t.MediaStreamTrack=void 0;const n=i(r(5473)),s=r(2163),o=r(3924),a=r(3166);class c extends a.EventTarget{constructor(e){super(),this.uuid=(0,s.v4)(),this.remote=!1,this.enabled=!0,this.onReceiveRtp=new n.default,this.onReceiveRtcp=new n.default,this.onSourceChanged=new n.default,this.stopped=!1,this.muted=!0,this.stop=()=>{this.stopped=!0,this.muted=!0,this.onReceiveRtp.complete()},this.writeRtp=e=>{if(this.remote)throw new Error("this is remoteTrack");if(this.stopped)return;const t=Buffer.isBuffer(e)?o.RtpPacket.deSerialize(e):e;t.header.payloadType=this.codec?.payloadType??t.header.payloadType,this.onReceiveRtp.execute(t)},Object.assign(this,e),this.onReceiveRtp.subscribe((e=>{this.muted=!1,this.header=e.header})),this.label=`${this.remote?"remote":"local"} ${this.kind}`}}t.MediaStreamTrack=c;t.MediaStream=class{constructor(e){this.tracks=[],Object.assign(this,e)}addTrack(e){e.streamId=this.id,this.tracks.push(e)}getTracks(){return this.tracks}}},8497:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MediaRecorder=void 0;const n=i(r(5473)),s=r(9646);t.MediaRecorder=class{constructor(e,t=1,r={}){this.path=e,this.numOfTracks=t,this.options=r,this.tracks=[],this.started=!1,this.onError=new n.default,this.ext=e.split(".").slice(-1)[0],this.writer=(()=>{if("webm"===this.ext)return new s.WebmFactory(e,r);throw new Error})(),this.tracks=r.tracks??this.tracks,this.tracks.length===t&&this.start().catch((e=>{this.onError.execute(e)}))}async addTrack(e){this.tracks.push(e),await this.start()}async start(){this.tracks.length===this.numOfTracks&&!1===this.started&&(this.started=!0,await this.writer.start(this.tracks))}async stop(){await this.writer.stop()}}},8243:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaWriter=void 0;t.MediaWriter=class{constructor(e,t){this.path=e,this.options=t}async start(e){}async stop(){}}},9646:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebmFactory=void 0;const i=r(3292),n=r(5473),s=r(4664),o=r(8243);class a extends o.MediaWriter{constructor(){super(...arguments),this.rtpSources=[],this.unSubscribers=new n.EventDisposer}async start(e){await(0,i.unlink)(this.path).catch((e=>e));const t=e.map(((e,t)=>{const r=t+1,i=e.codec.payloadType;if("video"===e.kind){return{kind:"video",codec:(()=>{switch(e.codec?.name.toLowerCase()){case"vp8":return"VP8";case"vp9":return"VP9";case"h264":return"MPEG4/ISO/AVC";case"av1x":return"AV1";default:throw new s.WeriftError({message:"unsupported codec",payload:{track:e,path:"packages/webrtc/src/nonstandard/recorder/writer/webm.ts"}})}})(),clockRate:9e4,trackNumber:r,width:this.options.width,height:this.options.height,payloadType:i,track:e}}return{kind:"audio",codec:"OPUS",clockRate:48e3,trackNumber:r,payloadType:i,track:e}})),r=new s.WebmCallback(t,{duration:this.options.defaultDuration??864e5}),n=new s.LipsyncCallback;this.rtpSources=t.map((({track:e,clockRate:t,codec:i})=>{const o=new s.RtpSourceCallback,a=new s.RtcpSourceCallback;e.onReceiveRtp.subscribe((e=>{o.input(e.clone())})).disposer(this.unSubscribers),e.onReceiveRtcp.subscribe((e=>{a.input(e)})).disposer(this.unSubscribers);const c=new s.NtpTimeCallback(t);if("video"===e.kind){const e=new s.DepacketizeCallback(i,{isFinalPacketInSequence:e=>e.marker}),u=new s.JitterBufferCallback(t);o.pipe(u.input),a.pipe(c.input),u.pipe(c.input),c.pipe(e.input),e.pipe(n.inputVideo),n.pipeVideo(r.inputVideo)}else{const e=new s.DepacketizeCallback(i);o.pipe(c.input),a.pipe(c.input),c.pipe(e.input),e.pipe(n.inputAudio),n.pipeAudio(r.inputAudio)}return o})),r.pipe((0,s.saveToFileSystem)(this.path))}async stop(){await Promise.all(this.rtpSources.map((e=>e.stop()))),this.unSubscribers.dispose()}}t.WebmFactory=a},5923:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaPlayerWebm=t.MediaPlayerMp4=t.getUserMedia=void 0;const i=r(2081),n=r(1891),s=r(8670),o=r(2163),a=r(680),c=r(3924),u=r(6730);t.getUserMedia=async(e,t)=>{const r=await(0,a.randomPort)(),i=await(0,a.randomPort)();return e.endsWith(".mp4")?new h(r,i,e,t):new d(r,i,e,t)};class h{constructor(e,t,r,i){this.videoPort=e,this.audioPort=t,this.path=r,this.loop=i,this.streamId=(0,o.v4)(),this.audio=new u.MediaStreamTrack({kind:"audio",streamId:this.streamId}),this.video=new u.MediaStreamTrack({kind:"video",streamId:this.streamId}),this.stopped=!1,this.setupTrack=(e,t)=>{let r=0;const i=(0,n.createSocket)("udp4");i.bind(e),i.on("message",(async e=>{const i=c.RtpPacket.deSerialize(e);r||(r=i.header.payloadType),r!==i.header.payloadType&&(r=i.header.payloadType,t.onSourceChanged.execute(i.header)),t.writeRtp(e)}))},this.setupTrack(t,this.audio),this.setupTrack(e,this.video)}async start(){let e=96;const t=async()=>{e>100&&(e=96);const r=`gst-launch-1.0 filesrc location= ${this.path} ! qtdemux name=d ! queue ! h264parse ! rtph264pay config-interval=10 pt=${e++} ! udpsink host=127.0.0.1 port=${this.videoPort} d. ! queue ! aacparse ! avdec_aac ! audioresample ! audioconvert ! opusenc ! rtpopuspay pt=${e++} ! udpsink host=127.0.0.1 port=${this.audioPort}`;this.process=(0,i.exec)(r),this.loop&&(await new Promise((e=>this.process.on("close",e))),this.stopped||t())};await(0,s.setImmediate)(),t()}stop(){this.stopped=!0,this.process.kill("SIGINT")}}t.MediaPlayerMp4=h;class d{constructor(e,t,r,i){this.videoPort=e,this.audioPort=t,this.path=r,this.loop=i,this.streamId=(0,o.v4)(),this.audio=new u.MediaStreamTrack({kind:"audio",streamId:this.streamId}),this.video=new u.MediaStreamTrack({kind:"video",streamId:this.streamId}),this.stopped=!1,this.setupTrack=(e,t)=>{let r=0,i=0,s=0;const o=(0,n.createSocket)("udp4");o.bind(e),o.on("message",(async e=>{const n=c.RtpPacket.deSerialize(e);r||(r=n.header.payloadType),r!==n.header.payloadType&&(r=n.header.payloadType,t.onSourceChanged.execute(n.header),s=(0,a.uint32Add)(n.header.timestamp,-i),console.log({timestampDiff:s})),i=n.header.timestamp,n.header.timestamp=(0,a.uint32Add)(n.header.timestamp,-s),t.writeRtp(n.serialize())}))},this.setupTrack(t,this.audio),this.setupTrack(e,this.video)}async start(){let e=96;const t=async()=>{e>100&&(e=96);const r=`gst-launch-1.0 filesrc location=${this.path} ! matroskademux name=d d.video_0 ! queue ! rtpvp8pay pt=${e++} ! udpsink host=127.0.0.1 port=${this.videoPort} d.audio_0 ! queue ! rtpopuspay pt=${e++} ! udpsink host=127.0.0.1 port=${this.audioPort}`;this.process=(0,i.exec)(r),console.log(r),this.loop&&(await new Promise((e=>this.process.on("close",e))),this.stopped||t())};await(0,s.setImmediate)(),t()}stop(){this.stopped=!0,this.process.kill("SIGINT")}}t.MediaPlayerWebm=d},8385:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.defaultPeerConfig=t.findCodecByMimeType=t.allocateMid=t.addTransportDescription=t.createMediaDescriptionForSctp=t.createMediaDescriptionForTransceiver=t.RTCPeerConnection=void 0;const a=o(r(5493)),c=o(r(825)),u=o(r(271)),h=o(r(5473)),d=s(r(2163)),l=r(4664),f=r(4664),p=r(4536),y=r(6639),m=r(3166),g=r(2751),b=r(9668),v=r(8638),w=r(3735),S=r(5608),_=r(6730),A=r(9661),E=r(4917),C=r(4849),k=r(4990),T=r(5580),P=(0,a.default)("werift:packages/webrtc/src/peerConnection.ts");class I extends m.EventTarget{pushTransceiver(e){this.transceivers.push(e)}replaceTransceiver(e,t){this.transceivers[t]=e}get dtlsTransports(){const e=this.transceivers.map((e=>e.dtlsTransport));return this.sctpTransport&&e.push(this.sctpTransport.dtlsTransport),e.reduce(((e,t)=>(e.map((e=>e.id)).includes(t.id)||e.push(t),e)),[])}get iceTransports(){return this.dtlsTransports.map((e=>e.iceTransport))}constructor(e={}){if(super(),this.cname=d.v4(),this.transportEstablished=!1,this.config=(0,c.default)(t.defaultPeerConfig),this.connectionState="new",this.iceConnectionState="new",this.iceGatheringState="new",this.signalingState="stable",this.negotiationneeded=!1,this.transceivers=[],this.candidatesSent=new Set,this.iceGatheringStateChange=new h.default,this.iceConnectionStateChange=new h.default,this.signalingStateChange=new h.default,this.connectionStateChange=new h.default,this.onDataChannel=new h.default,this.onRemoteTransceiverAdded=new h.default,this.onTransceiverAdded=new h.default,this.onIceCandidate=new h.default,this.onNegotiationneeded=new h.default,this.onTrack=new h.default,this.router=new b.RtpRouter,this.certificates=[],this.seenMid=new Set,this.isClosed=!1,this.shouldNegotiationneeded=!1,this.needNegotiation=async()=>{this.shouldNegotiationneeded=!0,this.negotiationneeded||"stable"!==this.signalingState||(this.shouldNegotiationneeded=!1,setImmediate((()=>{this.negotiationneeded=!0,this.onNegotiationneeded.execute(),this.onnegotiationneeded&&this.onnegotiationneeded({})})))},(0,l.deepMerge)(this.config,e),this.config.icePortRange){const[e,t]=this.config.icePortRange;if(e===t)throw new Error("should not be same value");if(e>=t)throw new Error("The min must be less than max")}for(const[e,t]of(0,m.enumerate)([...this.config.codecs.audio||[],...this.config.codecs.video||[]]))if(null==t.payloadType)switch(t.payloadType=96+e,t.name.toLowerCase()){case"rtx":t.parameters="apt="+(t.payloadType-1);break;case"red":if("audio"===t.contentType){const e=t.payloadType+1;t.parameters=`${e}/${e}`,t.payloadType=63}}if([...this.config.headerExtensions.audio||[],...this.config.headerExtensions.video||[]].forEach(((e,t)=>{e.id=1+t})),this.config.dtls){const{keys:e}=this.config.dtls;e&&this.certificates.push(new E.RTCCertificate(e.keyPem,e.certPem,e.signatureHash))}this.iceConnectionStateChange.subscribe((e=>{switch(e){case"disconnected":this.setConnectionState("disconnected");break;case"closed":this.close()}}))}get localDescription(){if(this._localDescription)return this._localDescription.toJSON()}get remoteDescription(){if(this._remoteDescription)return this._remoteDescription.toJSON()}get _localDescription(){return this.pendingLocalDescription||this.currentLocalDescription}get _remoteDescription(){return this.pendingRemoteDescription||this.currentRemoteDescription}getTransceiverByMid(e){return this.transceivers.find((t=>t.mid===e))}getTransceiverByMLineIndex(e){return this.transceivers.find((t=>t.mLineIndex===e))}async createOffer(){await this.ensureCerts();return this.buildOfferSdp().toJSON()}assignTransceiverCodecs(e){const t=this.config.codecs[e.kind].filter((t=>{switch(t.direction){case"recvonly":return!!p.ReceiverDirection.includes(e.direction);case"sendonly":return!!p.SenderDirections.includes(e.direction);case"sendrecv":return!![l.Sendrecv,l.Recvonly,l.Sendonly].includes(e.direction);case"all":return!0;default:return!1}}));e.codecs=t}buildOfferSdp(){this.transceivers.forEach((e=>{0===e.codecs.length&&this.assignTransceiverCodecs(e),0===e.headerExtensions.length&&(e.headerExtensions=this.config.headerExtensions[e.kind]??[])}));const e=new A.SessionDescription;(0,A.addSDPHeader)("offer",e);if((this._localDescription?this._localDescription.media:[]).forEach(((t,r)=>{const i=t.rtp.muxId;if(i)if("application"===t.kind){if(!this.sctpTransport)throw new Error("sctpTransport not found");this.sctpTransport.mLineIndex=r,e.media.push(x(this.sctpTransport))}else{const n=this.getTransceiverByMid(i);if(!n){if("inactive"===t.direction)return void e.media.push(t);throw new Error("transceiver not found")}n.mLineIndex=r,e.media.push(R(n,this.cname,n.direction))}else P("mid missing",t)})),this.transceivers.filter((t=>!e.media.find((e=>e.rtp.muxId===t.mid)))).forEach((t=>{null==t.mid&&(t.mid=O(this.seenMid,"av"));const r=R(t,this.cname,t.direction);void 0===t.mLineIndex?(t.mLineIndex=e.media.length,e.media.push(r)):e.media[t.mLineIndex]=r})),this.sctpTransport&&!e.media.find((e=>"application"===e.kind))&&(this.sctpTransport.mLineIndex=e.media.length,null==this.sctpTransport.mid&&(this.sctpTransport.mid=O(this.seenMid,"dc")),e.media.push(x(this.sctpTransport))),"disable"!==this.config.bundlePolicy){const t=e.media.map((e=>"inactive"!==e.direction?e.rtp.muxId:void 0)).filter((e=>e));if(t.length){const r=new A.GroupDescription("BUNDLE",t);e.group.push(r)}}return e}createDataChannel(e,t={}){const r={protocol:"",ordered:!0,negotiated:!1,...t};if(r.maxPacketLifeTime&&r.maxRetransmits)throw new Error("can not select both");this.sctpTransport||(this.sctpTransport=this.createSctpTransport(),this.needNegotiation());const i=new y.RTCDataChannelParameters({id:r.id,label:e,maxPacketLifeTime:r.maxPacketLifeTime,maxRetransmits:r.maxRetransmits,negotiated:r.negotiated,ordered:r.ordered,protocol:r.protocol});return new y.RTCDataChannel(this.sctpTransport,i)}removeTrack(e){if(this.isClosed)throw new Error("peer closed");if(!this.getSenders().find((({ssrc:t})=>e.ssrc===t)))throw new Error("unExist");const t=this.transceivers.find((({sender:{ssrc:t}})=>e.ssrc===t));if(!t)throw new Error("unExist");e.stop(),"recvonly"!==t.currentDirection?(t.stopping||t.stopped?t.setDirection("inactive"):"sendrecv"===t.direction?t.setDirection("recvonly"):"sendonly"!==t.direction&&"recvonly"!==t.direction||t.setDirection("inactive"),this.needNegotiation()):this.needNegotiation()}createTransport(e=[]){const[t]=this.iceTransports;if("max-bundle"===this.config.bundlePolicy&&t)return this.dtlsTransports[0];const r=new C.RTCIceGatherer({...(0,T.parseIceServers)(this.config.iceServers),forceTurn:"relay"===this.config.iceTransportPolicy,portRange:this.config.icePortRange,interfaceAddresses:this.config.iceInterfaceAddresses,additionalHostAddresses:this.config.iceAdditionalHostAddresses,filterStunResponse:this.config.iceFilterStunResponse,useIpv4:this.config.iceUseIpv4,useIpv6:this.config.iceUseIpv6});t&&(r.connection.localUserName=t.connection.localUserName,r.connection.localPassword=t.connection.localPassword),r.onGatheringStateChange.subscribe((()=>{this.updateIceGatheringState()})),this.updateIceGatheringState();const i=new C.RTCIceTransport(r);i.onStateChange.subscribe((()=>{this.updateIceConnectionState()})),i.iceGather.onIceCandidate=e=>{if(this.localDescription){if("max-bundle"===this.config.bundlePolicy||this.remoteIsBundled){e.sdpMLineIndex=0;const t=this._localDescription?.media[0];t&&(e.sdpMid=t.rtp.muxId)}else{const t=this.transceivers.find((e=>e.dtlsTransport.iceTransport.id===i.id));t&&(e.sdpMLineIndex=t.mLineIndex,e.sdpMid=t.mid),this.sctpTransport?.dtlsTransport.iceTransport.id===i.id&&(e.sdpMLineIndex=this.sctpTransport.mLineIndex,e.sdpMid=this.sctpTransport.mid)}if(e.foundation="candidate:"+e.foundation,e.sdpMid){const t=`${e.foundation}:${e.sdpMid}`;if(this.candidatesSent.has(t))return;this.candidatesSent.add(t)}this.onIceCandidate.execute(e.toJSON()),this.onicecandidate&&this.onicecandidate({candidate:e.toJSON()}),this.emit("icecandidate",{candidate:e})}};return new E.RTCDtlsTransport(this.config,i,this.router,this.certificates,e)}createSctpTransport(){const e=this.createTransport([p.SRTP_PROFILE.SRTP_AEAD_AES_128_GCM,p.SRTP_PROFILE.SRTP_AES128_CM_HMAC_SHA1_80]),t=new k.RTCSctpTransport;return t.setDtlsTransport(e),t.mid=void 0,t.onDataChannel.subscribe((e=>{this.onDataChannel.execute(e);const t={channel:e};this.ondatachannel&&this.ondatachannel(t),this.emit("datachannel",t)})),this.sctpTransport=t,this.updateIceConnectionState(),t}async setLocalDescription(e){const t=A.SessionDescription.parse(e.sdp);t.type=e.type,this.validateDescription(t,!0),"offer"===t.type?this.setSignalingState("have-local-offer"):"answer"===t.type&&this.setSignalingState("stable"),t.media.forEach(((e,t)=>{const r=e.rtp.muxId;if(this.seenMid.add(r),["audio","video"].includes(e.kind)){const e=this.getTransceiverByMLineIndex(t);e&&(e.mid=r)}"application"===e.kind&&this.sctpTransport&&(this.sctpTransport.mid=r)}));this.dtlsTransports.forEach((e=>(e=>{const r=e.iceTransport;if("offer"===t.type?r.connection.iceControlling=!0:r.connection.iceControlling=!1,r.connection.remoteIsLite&&(r.connection.iceControlling=!0),"answer"===t.type){const r=t.media.find((e=>e.dtlsParams))?.dtlsParams?.role;r&&(e.role=r)}})(e))),["answer","pranswer"].includes(t.type)&&this.transceivers.forEach((e=>{const t=(0,T.andDirection)(e.direction,e.offerDirection);e.setCurrentDirection(t)})),this.setLocal(t),"answer"===t.type&&this.connect().catch((e=>{P("connect failed",e),this.setConnectionState("failed")}));const r=this.iceTransports.find((e=>"connected"===e.state));this.remoteIsBundled&&r?await r.iceGather.gather():await Promise.all(this.iceTransports.map((e=>e.iceGather.gather()))),t.media.filter((e=>["audio","video"].includes(e.kind))).forEach(((e,t)=>{B(e,this.transceivers[t].dtlsTransport)}));const i=t.media.find((e=>"application"===e.kind));return this.sctpTransport&&i&&B(i,this.sctpTransport.dtlsTransport),this.setLocal(t),this.shouldNegotiationneeded&&this.needNegotiation(),t}setLocal(e){"answer"===e.type?(this.currentLocalDescription=e,this.pendingLocalDescription=void 0):this.pendingLocalDescription=e}getTransportByMid(e){let t;const r=this.transceivers.find((t=>t.mid===e));return r?t=r.dtlsTransport.iceTransport:t||this.sctpTransport?.mid!==e||(t=this.sctpTransport?.dtlsTransport.iceTransport),t}getTransportByMLineIndex(e){const t=this.buildOfferSdp().media[e];if(!t)return;return this.getTransportByMid(t.rtp.muxId)}async addIceCandidate(e){const t=C.IceCandidate.fromJSON(e);if(!t)return;let r;"number"==typeof t.sdpMid&&(r=this.getTransportByMid(t.sdpMid)),r||"number"!=typeof t.sdpMLineIndex||(r=this.getTransportByMLineIndex(t.sdpMLineIndex)),r||(r=this.iceTransports[0]),r?await r.addRemoteCandidate(t):P("iceTransport not found",t)}async connect(){this.transportEstablished||(P("start connect"),this.setConnectionState("connecting"),await Promise.all(this.dtlsTransports.map((async e=>{const{iceTransport:t}=e;await t.start().catch((e=>{throw P("iceTransport.start failed",e),e})),await e.start().catch((e=>{throw P("dtlsTransport.start failed",e),e})),this.sctpTransport&&this.sctpRemotePort&&this.sctpTransport.dtlsTransport.id===e.id&&(await this.sctpTransport.start(this.sctpRemotePort),await this.sctpTransport.sctp.stateChanged.connected.asPromise(),P("sctp connected"))}))),this.transportEstablished=!0,this.setConnectionState("connected"))}getLocalRtpParams(e){if(null==e.mid)throw new Error("mid not assigned");return{codecs:e.codecs,muxId:e.mid,headerExtensions:e.headerExtensions,rtcp:{cname:this.cname,ssrc:e.sender.ssrc,mux:!0}}}getRemoteRtpParams(e,t){return{muxId:e.rtp.muxId,rtcp:e.rtp.rtcp,codecs:t.codecs,headerExtensions:t.headerExtensions,encodings:Object.values(t.codecs.reduce(((t,r)=>{if("rtx"===r.name.toLowerCase()){const i=t[(0,f.codecParametersFromString)(r.parameters??"").apt];return i&&2===e.ssrc.length&&(i.rtx=new g.RTCRtpRtxParameters({ssrc:e.ssrc[1].ssrc})),t}return t[r.payloadType]=new g.RTCRtpCodingParameters({ssrc:e.ssrc[0]?.ssrc,payloadType:r.payloadType}),t}),{}))}}get remoteIsBundled(){const e=this._remoteDescription;if(!e)return;return e.group.find((e=>"BUNDLE"===e.semantic&&"disable"!==this.config.bundlePolicy))}async setRemoteDescription(e){const t=A.SessionDescription.parse(e.sdp);let r;t.type=e.type,this.validateDescription(t,!1),"answer"===t.type?(this.currentRemoteDescription=t,this.pendingRemoteDescription=void 0):this.pendingRemoteDescription=t;const i=(e,t)=>e.kind===t.kind&&[void 0,t.rtp.muxId].includes(e.mid);let n=t.media.map(((n,s)=>{let o;if(["audio","video"].includes(n.kind)){let a=this.transceivers.find((e=>i(e,n)));if(a){if("inactive"===a.direction&&a.stopping)return a.stopped=!0,void("answer"===e.type&&a.setCurrentDirection("inactive"))}else a=this._addTransceiver(n.kind,{direction:"recvonly"}),a.mid=n.rtp.muxId,this.onRemoteTransceiverAdded.execute(a);this.remoteIsBundled&&(r?a.setDtlsTransport(r):r=a.dtlsTransport),o=a.dtlsTransport,this.setRemoteRTP(a,n,t.type,s)}else{if("application"!==n.kind)throw new Error("invalid media kind");this.sctpTransport||(this.sctpTransport=this.createSctpTransport(),this.sctpTransport.mid=n.rtp.muxId),this.remoteIsBundled&&(r?this.sctpTransport.setDtlsTransport(r):r=this.sctpTransport.dtlsTransport),o=this.sctpTransport.dtlsTransport,this.setRemoteSCTP(n,this.sctpTransport,s)}const a=o.iceTransport;return n.iceParams&&n.dtlsParams&&(a.setRemoteParams(n.iceParams),o.setRemoteParams(n.dtlsParams),n.iceParams?.iceLite&&(a.connection.iceControlling=!0)),n.iceCandidates.forEach(a.addRemoteCandidate),n.iceCandidatesComplete&&a.addRemoteCandidate(void 0),"answer"===t.type&&n.dtlsParams?.role&&(o.role="client"===n.dtlsParams.role?"server":"client"),a}));n=n.filter((e=>!!e));const s=this.transceivers.filter((e=>null==t.media.find((t=>i(e,t)))));if("answer"===e.type)for(const e of s)e.stop(),e.stopped=!0;"offer"===t.type?this.setSignalingState("have-remote-offer"):"answer"===t.type&&this.setSignalingState("stable"),"answer"===t.type&&(P("caller start connect"),this.connect().catch((e=>{P("connect failed",e),this.setConnectionState("failed")})));const o=this.iceTransports.find((e=>"connected"===e.state));this.remoteIsBundled&&o?await o.iceGather.gather():await Promise.all(n.map((e=>e.iceGather.gather()))),this.negotiationneeded=!1,this.shouldNegotiationneeded&&this.needNegotiation()}setRemoteRTP(e,r,i,n){if(e.mid||(e.mid=r.rtp.muxId),e.mLineIndex=n,e.codecs=r.rtp.codecs.filter((e=>{const i=this.config.codecs[r.kind]||[],n=(0,t.findCodecByMimeType)(i,e);if(!n)return!1;if("rtx"===n?.name.toLowerCase()){const e=(0,f.codecParametersFromString)(n.parameters??"").apt,s=r.rtp.codecs.find((t=>t.payloadType===e));return!!s&&!!(0,t.findCodecByMimeType)(i,s)}return!0})),P("negotiated codecs",e.codecs),0===e.codecs.length)throw new Error("negotiate codecs failed.");e.headerExtensions=r.rtp.headerExtensions.filter((e=>(this.config.headerExtensions[r.kind]||[]).find((t=>t.uri===e.uri))));const s=r.direction??"inactive",o=(0,T.reverseDirection)(s);["answer","pranswer"].includes(i)?e.setCurrentDirection(o):e.offerDirection=o;const a=this.getLocalRtpParams(e);if(e.sender.prepareSend(a),["recvonly","sendrecv"].includes(e.direction)){const t=this.getRemoteRtpParams(r,e);r.simulcastParameters.forEach((r=>{this.router.registerRtpReceiverByRid(e,r,t)})),e.receiver.prepareReceive(t),this.router.registerRtpReceiverBySsrc(e,t)}if(["sendonly","sendrecv"].includes(s)&&null!=r.msid){const[t,i]=r.msid.split(" ");e.receiver.remoteStreamId=t,e.receiver.remoteTrackId=i,this.fireOnTrack(e.receiver.track,e,new _.MediaStream({id:t,tracks:[e.receiver.track]}))}r.ssrc[0]?.ssrc&&e.receiver.setupTWCC(r.ssrc[0].ssrc)}setRemoteSCTP(e,t,r){if(this.sctpRemotePort=e.sctpPort,!this.sctpRemotePort)throw new Error("sctpRemotePort not exist");t.setRemotePort(this.sctpRemotePort),t.mLineIndex=r,t.mid||(t.mid=e.rtp.muxId)}validateDescription(e,t){if(t){if("offer"===e.type){if(!["stable","have-local-offer"].includes(this.signalingState))throw new Error("Cannot handle offer in signaling state")}else if("answer"===e.type&&!["have-remote-offer","have-local-pranswer"].includes(this.signalingState))throw new Error("Cannot handle answer in signaling state")}else if("offer"===e.type){if(!["stable","have-remote-offer"].includes(this.signalingState))throw new Error("Cannot handle offer in signaling state")}else if("answer"===e.type&&!["have-local-offer","have-remote-pranswer"].includes(this.signalingState))throw new Error("Cannot handle answer in signaling state");if(e.media.forEach((e=>{if(!("inactive"===e.direction||e.iceParams&&e.iceParams.usernameFragment&&e.iceParams.password))throw new Error("ICE username fragment or password is missing")})),["answer","pranswer"].includes(e.type||"")){const r=t?this._remoteDescription:this._localDescription;if(!r)throw new Error;const i=e.media.map(((e,t)=>[e.kind,t])),n=r.media.map(((e,t)=>[e.kind,t]));if(!(0,u.default)(n,i))throw new Error("Media sections in answer do not match offer")}}fireOnTrack(e,t,r){const i={track:e,streams:[r],transceiver:t,receiver:t.receiver};this.onTrack.execute(e),this.emit("track",i),this.ontrack&&this.ontrack(i)}addTransceiver(e,t={}){return this._addTransceiver(e,t)}_addTransceiver(e,t={}){const r="string"==typeof e?e:e.kind,i=t.direction||"sendrecv",n=this.createTransport([p.SRTP_PROFILE.SRTP_AEAD_AES_128_GCM,p.SRTP_PROFILE.SRTP_AES128_CM_HMAC_SHA1_80]),s=new w.RTCRtpSender(e),o=new v.RTCRtpReceiver(this.config,r,s.ssrc),a=new S.RTCRtpTransceiver(r,n,o,s,i);a.options=t,this.router.registerRtpSender(a.sender);const c=this.transceivers.findIndex((e=>"inactive"===e.currentDirection)),u=this.transceivers.find((e=>"inactive"===e.currentDirection));return c>-1&&u?(this.replaceTransceiver(a,c),a.mLineIndex=u.mLineIndex,u.setCurrentDirection(void 0)):this.pushTransceiver(a),this.onTransceiverAdded.execute(a),this.updateIceConnectionState(),this.needNegotiation(),a}getTransceivers(){return this.transceivers}getSenders(){return this.getTransceivers().map((e=>e.sender))}getReceivers(){return this.getTransceivers().map((e=>e.receiver))}addTrack(e,t){if(this.isClosed)throw new Error("is closed");if(this.getSenders().find((t=>t.track?.uuid===e.uuid)))throw new Error("track exist");const r=this.transceivers.find((t=>null==t.sender.track&&t.kind===e.kind&&!0===p.SenderDirections.includes(t.direction)));if(r){const t=r.sender;return t.registerTrack(e),this.needNegotiation(),t}const i=this.transceivers.find((t=>null==t.sender.track&&t.kind===e.kind&&!1===p.SenderDirections.includes(t.direction)&&!t.usedForSender));if(i){const t=i.sender;switch(t.registerTrack(e),i.direction){case"recvonly":i.setDirection("sendrecv");break;case"inactive":i.setDirection("sendonly")}return this.needNegotiation(),t}{const t=this._addTransceiver(e,{direction:"sendrecv"});return this.needNegotiation(),t.sender}}async ensureCerts(){const e=async e=>{if(0===this.certificates.length){const t=await e.setupCertificate();this.certificates.push(t)}else e.localCertificate=this.certificates[0]};for(const t of this.dtlsTransports)await e(t)}async createAnswer(){await this.ensureCerts();return this.buildAnswer().toJSON()}buildAnswer(){if(this.assertNotClosed(),!["have-remote-offer","have-local-pranswer"].includes(this.signalingState))throw new Error("createAnswer failed");if(!this._remoteDescription)throw new Error("wrong state");const e=new A.SessionDescription;if((0,A.addSDPHeader)("answer",e),this._remoteDescription.media.forEach((t=>{let r,i;if(["audio","video"].includes(t.kind)){const e=this.getTransceiverByMid(t.rtp.muxId);i=R(e,this.cname,(0,T.andDirection)(e.direction,e.offerDirection)),r=e.dtlsTransport}else{if("application"!==t.kind)throw new Error("invalid kind");if(!this.sctpTransport||!this.sctpTransport.mid)throw new Error("sctpTransport not found");i=x(this.sctpTransport),r=this.sctpTransport.dtlsTransport}i.dtlsParams&&("auto"===r.role?i.dtlsParams.role="client":i.dtlsParams.role=r.role),i.simulcastParameters=t.simulcastParameters.map((e=>({...e,direction:(0,T.reverseSimulcastDirection)(e.direction)}))),e.media.push(i)})),"disable"!==this.config.bundlePolicy){const t=new A.GroupDescription("BUNDLE",[]);e.media.forEach((e=>{t.items.push(e.rtp.muxId)})),e.group.push(t)}return e}async close(){if(!this.isClosed){this.isClosed=!0,this.setSignalingState("closed"),this.setConnectionState("closed"),this.transceivers.forEach((e=>{e.receiver.stop(),e.sender.stop()})),this.sctpTransport&&await this.sctpTransport.stop();for(const e of this.dtlsTransports)await e.stop(),await e.iceTransport.stop();this.dispose(),P("peerConnection closed")}}assertNotClosed(){if(this.isClosed)throw new Error("RTCPeerConnection is closed")}updateIceGatheringState(){const e=this.iceTransports;function t(...t){return e.filter((e=>t.includes(e.iceGather.gatheringState))).length===e.length}let r;r=e.length&&t("complete")?"complete":!e.length||t("new","complete")?"new":e.map((e=>e.iceGather.gatheringState)).includes("gathering")?"gathering":"new",this.iceGatheringState!==r&&(P("iceGatheringStateChange",r),this.iceGatheringState=r,this.iceGatheringStateChange.execute(r),this.emit("icegatheringstatechange",r))}updateIceConnectionState(){const e=this.iceTransports;let t;function r(...t){return e.filter((e=>t.includes(e.state))).length===e.length}t="closed"===this.connectionState?"closed":r("failed")?"failed":r("disconnected")?"disconnected":r("new","closed")?"new":r("new","checking")?"checking":r("completed","closed")?"completed":r("connected","completed","closed")?"connected":"new",this.iceConnectionState!==t&&(P("iceConnectionStateChange",t),this.iceConnectionState=t,this.iceConnectionStateChange.execute(t),this.emit("iceconnectionstatechange",t))}setSignalingState(e){P("signalingStateChange",e),this.signalingState=e,this.signalingStateChange.execute(e),this.onsignalingstatechange&&this.onsignalingstatechange({})}setConnectionState(e){P("connectionStateChange",e),this.connectionState=e,this.connectionStateChange.execute(e),this.onconnectionstatechange&&this.onconnectionstatechange(),this.emit("connectionstatechange")}dispose(){this.onDataChannel.allUnsubscribe(),this.iceGatheringStateChange.allUnsubscribe(),this.iceConnectionStateChange.allUnsubscribe(),this.signalingStateChange.allUnsubscribe(),this.onTransceiverAdded.allUnsubscribe(),this.onRemoteTransceiverAdded.allUnsubscribe(),this.onIceCandidate.allUnsubscribe()}}function R(e,t,r){const i=new A.MediaDescription(e.kind,9,"UDP/TLS/RTP/SAVPF",e.codecs.map((e=>e.payloadType)));return i.direction=r,i.msid=e.msid,i.rtp={codecs:e.codecs,headerExtensions:e.headerExtensions,muxId:e.mid},i.rtcpHost="0.0.0.0",i.rtcpPort=9,i.rtcpMux=!0,i.ssrc=[new A.SsrcDescription({ssrc:e.sender.ssrc,cname:t})],e.options.simulcast&&(i.simulcastParameters=e.options.simulcast.map((e=>new g.RTCRtpSimulcastParameters(e)))),i.rtp.codecs.find((e=>"rtx"===e.name.toLowerCase()))&&(i.ssrc.push(new A.SsrcDescription({ssrc:e.sender.rtxSsrc,cname:t})),i.ssrcGroup=[new A.GroupDescription("FID",[e.sender.ssrc.toString(),e.sender.rtxSsrc.toString()])]),B(i,e.dtlsTransport),i}function x(e){const t=new A.MediaDescription("application",p.DISCARD_PORT,"UDP/DTLS/SCTP",["webrtc-datachannel"]);return t.sctpPort=e.port,t.rtp.muxId=e.mid,t.sctpCapabilities=k.RTCSctpTransport.getCapabilities(),B(t,e.dtlsTransport),t}function B(e,t){const r=t.iceTransport.iceGather;e.iceCandidates=r.localCandidates,e.iceCandidatesComplete="complete"===r.gatheringState,e.iceParams=r.localParameters,e.iceOptions="trickle",e.host=p.DISCARD_HOST,e.port=p.DISCARD_PORT,"inactive"===e.direction&&(e.port=0,e.msid=void 0),e.dtlsParams||(e.dtlsParams=t.localParameters,e.dtlsParams.fingerprints||(e.dtlsParams.fingerprints=t.localParameters.fingerprints))}function O(e,t){let r="";for(let i=0;r=(i++).toString()+t,e.has(r););return e.add(r),r}t.RTCPeerConnection=I,t.createMediaDescriptionForTransceiver=R,t.createMediaDescriptionForSctp=x,t.addTransportDescription=B,t.allocateMid=O;t.findCodecByMimeType=(e,t)=>e.find((e=>e.mimeType.toLowerCase()===t.mimeType.toLowerCase()))?t:void 0,t.defaultPeerConfig={codecs:{audio:[new g.RTCRtpCodecParameters({mimeType:"audio/opus",clockRate:48e3,channels:2}),new g.RTCRtpCodecParameters({mimeType:"audio/PCMU",clockRate:8e3,channels:1,payloadType:0})],video:[new g.RTCRtpCodecParameters({mimeType:"video/VP8",clockRate:9e4,rtcpFeedback:[(0,f.useNACK)(),(0,f.usePLI)(),(0,f.useREMB)()]})]},headerExtensions:{audio:[],video:[]},iceTransportPolicy:"all",iceServers:[{urls:"stun:stun.l.google.com:19302"}],icePortRange:void 0,iceInterfaceAddresses:void 0,iceAdditionalHostAddresses:void 0,iceUseIpv4:!0,iceUseIpv6:!0,iceFilterStunResponse:void 0,dtls:{},bundlePolicy:"max-compat",debug:{}}},9661:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SsrcDescription=t.codecParametersToString=t.codecParametersFromString=t.addSDPHeader=t.RTCSessionDescription=t.candidateFromSdp=t.parseGroup=t.candidateToSdp=t.GroupDescription=t.MediaDescription=t.SessionDescription=void 0;const n=r(6113),s=r(3543),o=i(r(201)),a=r(1808),c=r(4536),u=r(3166),h=r(2751),d=r(4917),l=r(4849),f=r(4990);class p{constructor(){this.version=0,this.name="-",this.time="0 0",this.group=[],this.extMapAllowMixed=!0,this.msidSemantic=[],this.media=[],this.dtlsFingerprints=[]}static parse(e){const[t,r]=function(e){const t=[],r=[];let i=e.split("\r\n");1===i.length&&(i=e.split("\n"));return i.forEach((e=>{e.startsWith("m=")?r.push([e]):r.length>0?r[r.length-1].push(e):t.push(e)})),[t,r]}(e),i=new p;t.forEach((e=>{if(e.startsWith("v="))i.version=parseInt(e.slice(2),10);else if(e.startsWith("o="))i.origin=e.slice(2);else if(e.startsWith("s="))i.name=e.slice(2);else if(e.startsWith("c="))i.host=g(e.slice(2));else if(e.startsWith("t="))i.time=e.slice(2);else if(e.startsWith("a=")){const[t,r]=w(e);switch(t){case"fingerprint":const[e,t]=r?.split(" ")||[];i.dtlsFingerprints.push(new d.RTCDtlsFingerprint(e,t));break;case"ice-lite":i.iceLite=!0;break;case"ice-options":i.iceOptions=r;break;case"ice-pwd":i.icePassword=r;break;case"ice-ufrag":i.iceUsernameFragment=r;break;case"group":S(i.group,r);break;case"msid-semantic":S(i.msidSemantic,r);break;case"setup":i.dtlsRole=c.DTLS_SETUP_ROLE[r];break;case"extmap-allow-mixed":i.extMapAllowMixed=!0}}}));const n=i.group.find((e=>"BUNDLE"===e.semantic));return r.forEach((e=>{const t=e[0].match(/^m=([^ ]+) ([0-9]+) ([A-Z/]+) (.+)/);if(!t)throw new Error("m line not found");const r=t[1],s=t[4].split(" "),o=["audio","video"].includes(r)?s.map((e=>Number(e))):void 0,a=new y(r,parseInt(t[2]),t[3],o||s);if(a.dtlsParams=new d.RTCDtlsParameters([...i.dtlsFingerprints],i.dtlsRole),a.iceParams=new l.RTCIceParameters({iceLite:i.iceLite,usernameFragment:i.iceUsernameFragment,password:i.icePassword}),a.iceOptions=i.iceOptions,i.media.push(a),e.slice(1).forEach((e=>{if(e.startsWith("c="))a.host=g(e.slice(2));else if(e.startsWith("a=")){const[t,r]=w(e);switch(t){case"candidate":if(!r)throw new Error;a.iceCandidates.push(_(r));break;case"end-of-candidates":a.iceCandidatesComplete=!0;break;case"extmap":let[e,i]=r.split(" ");e.includes("/")&&([e]=e.split("/")),a.rtp.headerExtensions.push(new h.RTCRtpHeaderExtensionParameters({id:parseInt(e),uri:i}));break;case"fingerprint":if(!r)throw new Error;const[n,s]=r.split(" ");a.dtlsParams?.fingerprints.push(new d.RTCDtlsFingerprint(n,s));break;case"ice-options":a.iceOptions=r;break;case"ice-pwd":a.iceParams.password=r;break;case"ice-ufrag":a.iceParams.usernameFragment=r;break;case"ice-lite":a.iceParams.iceLite=!0;break;case"max-message-size":a.sctpCapabilities=new f.RTCSctpCapabilities(parseInt(r,10));break;case"mid":a.rtp.muxId=r;break;case"msid":a.msid=r;break;case"rtcp":const[o,l]=(0,u.divide)(r," ");a.rtcpPort=parseInt(o),a.rtcpHost=g(l);break;case"rtcp-mux":a.rtcpMux=!0;break;case"setup":a.dtlsParams.role=c.DTLS_SETUP_ROLE[r];break;case"recvonly":case"sendonly":case"sendrecv":case"inactive":a.direction=t;break;case"rtpmap":{const[e,t]=(0,u.divide)(r," "),[i,n,s]=t.split("/");let o;"audio"===a.kind&&(o=s?parseInt(s):1);const c=new h.RTCRtpCodecParameters({mimeType:a.kind+"/"+i,channels:o,clockRate:parseInt(n),payloadType:parseInt(e)});a.rtp.codecs.push(c)}break;case"sctpmap":if(!r)throw new Error;const[p,y]=(0,u.divide)(r," ");a.sctpMap[parseInt(p)]=y,a.sctpPort=parseInt(p);break;case"sctp-port":if(!r)throw new Error;a.sctpPort=parseInt(r);break;case"ssrc":const[m,b]=(0,u.divide)(r," "),v=parseInt(m),[w,A]=(0,u.divide)(b,":");let C=a.ssrc.find((e=>e.ssrc===v));C||(C=new E({ssrc:v}),a.ssrc.push(C)),c.SSRC_INFO_ATTRS.includes(w)&&(C[w]=A);break;case"ssrc-group":S(a.ssrcGroup,r);break;case"rid":{const[e,t]=(0,u.divide)(r," ");a.simulcastParameters.push(new h.RTCRtpSimulcastParameters({rid:e,direction:t}))}}}})),(!a.iceParams.usernameFragment||!a.iceParams.password)&&a.rtp.muxId&&n&&n.items.includes(a.rtp.muxId))for(let e=0;e<n.items.length;e++){if(!n.items.includes(e.toString()))continue;const t=i.media[e];if(t?.iceParams&&t.iceParams.usernameFragment&&t.iceParams.password){a.iceParams={...t.iceParams};break}}a.dtlsParams.role||(a.dtlsParams=void 0);e.slice(1).forEach((e=>{if(e.startsWith("a=")){const[r,i]=w(e);if("fmtp"===r){const[e,r]=(0,u.divide)(i," ");(t=Number(e),a.rtp.codecs.find((e=>e.payloadType===t))).parameters=r}else if("rtcp-fb"===r){const[e,t,r]=i.split(" ");a.rtp.codecs.forEach((i=>{["*",i.payloadType.toString()].includes(e)&&i.rtcpFeedback.push(new h.RTCRtcpFeedback({type:t,parameter:r}))}))}}var t}))})),i}webrtcTrackId(e){if(e.msid&&e.msid.includes(" ")){const t=e.msid.split(" ");for(const e of this.msidSemantic)if("WMS"===e.semantic&&(e.items.includes(t[0])||e.items.includes("*")))return t[1]}}get string(){const e=[`v=${this.version}`,`o=${this.origin}`,`s=${this.name}`];this.host&&e.push(`c=${b(this.host)}`),e.push(`t=${this.time}`),this.group.forEach((t=>e.push(`a=group:${t.str}`))),this.extMapAllowMixed&&e.push("a=extmap-allow-mixed"),this.msidSemantic.forEach((t=>e.push(`a=msid-semantic:${t.str}`)));const t=this.media.map((e=>e.toString())).join("");return e.join("\r\n")+"\r\n"+t}toJSON(){return new A(this.string,this.type)}}t.SessionDescription=p;class y{constructor(e,t,r,i){this.kind=e,this.port=t,this.profile=r,this.fmt=i,this.rtcpMux=!1,this.ssrc=[],this.ssrcGroup=[],this.rtp={codecs:[],headerExtensions:[]},this.sctpMap={},this.iceCandidates=[],this.iceCandidatesComplete=!1,this.simulcastParameters=[]}toString(){const e=[];if(e.push(`m=${this.kind} ${this.port} ${this.profile} ${this.fmt.map((e=>e.toString())).join(" ")}`),this.host&&e.push(`c=${b(this.host)}`),this.iceCandidates.forEach((t=>{e.push(`a=candidate:${v(t)}`)})),this.iceCandidatesComplete&&e.push("a=end-of-candidates"),this.iceParams?.usernameFragment&&e.push(`a=ice-ufrag:${this.iceParams.usernameFragment}`),this.iceParams?.password&&e.push(`a=ice-pwd:${this.iceParams.password}`),this.iceParams?.iceLite&&e.push("a=ice-lite"),this.iceOptions&&e.push(`a=ice-options:${this.iceOptions}`),this.dtlsParams&&(this.dtlsParams.fingerprints.forEach((t=>{e.push(`a=fingerprint:${t.algorithm} ${t.value}`)})),e.push(`a=setup:${c.DTLS_ROLE_SETUP[this.dtlsParams.role]}`)),this.direction&&e.push(`a=${this.direction}`),this.rtp.muxId&&e.push(`a=mid:${this.rtp.muxId}`),this.msid&&e.push(`a=msid:${this.msid}`),this.rtcpPort&&this.rtcpHost&&(e.push(`a=rtcp:${this.rtcpPort} ${b(this.rtcpHost)}`),this.rtcpMux&&e.push("a=rtcp-mux")),this.ssrcGroup.forEach((t=>{e.push(`a=ssrc-group:${t.str}`)})),this.ssrc.forEach((t=>{c.SSRC_INFO_ATTRS.forEach((r=>{const i=t[r];void 0!==i&&e.push(`a=ssrc:${t.ssrc} ${r}:${i}`)}))})),this.rtp.codecs.forEach((t=>{e.push(`a=rtpmap:${t.payloadType} ${t.str}`),t.rtcpFeedback.forEach((r=>{let i=r.type;r.parameter&&(i+=` ${r.parameter}`),e.push(`a=rtcp-fb:${t.payloadType} ${i}`)})),t.parameters&&e.push(`a=fmtp:${t.payloadType} ${t.parameters}`)})),Object.keys(this.sctpMap).forEach((t=>{const r=this.sctpMap[Number(t)];e.push(`a=sctpmap:${t} ${r}`)})),this.sctpPort&&e.push(`a=sctp-port:${this.sctpPort}`),this.sctpCapabilities&&e.push(`a=max-message-size:${this.sctpCapabilities.maxMessageSize}`),this.rtp.headerExtensions.forEach((t=>e.push(`a=extmap:${t.id} ${t.uri}`))),this.simulcastParameters.length){this.simulcastParameters.forEach((t=>{e.push(`a=rid:${t.rid} ${t.direction}`)}));let t="a=simulcast:";const r=this.simulcastParameters.filter((e=>"recv"===e.direction));r.length&&(t+=`recv ${r.map((e=>e.rid)).join(";")} `);const i=this.simulcastParameters.filter((e=>"send"===e.direction));i.length&&(t+=`send ${i.map((e=>e.rid)).join(";")}`),e.push(t)}return e.join("\r\n")+"\r\n"}}t.MediaDescription=y;class m{constructor(e,t){this.semantic=e,this.items=t}get str(){return`${this.semantic} ${this.items.join(" ")}`}}function g(e){const t=e.match(/^IN (IP4|IP6) ([^ ]+)$/);if(!t)throw new Error("exception");return t[2]}function b(e){return`IN IP${(0,a.isIPv4)(e)?4:6} ${e}`}function v(e){let t=`${e.foundation} ${e.component} ${e.protocol} ${e.priority} ${e.ip} ${e.port} typ ${e.type}`;return e.relatedAddress&&(t+=` raddr ${e.relatedAddress}`),e.relatedPort&&(t+=` rport ${e.relatedPort}`),e.tcpType&&(t+=` tcptype ${e.tcpType}`),t}function w(e){if(e.includes(":")){const t=(0,u.divide)(e.slice(2),":");return[t[0],t[1]]}return[e.slice(2),void 0]}function S(e,t,r=(e=>e.toString())){const i=t.split(" ");i.length>0&&e.push(new m(i[0],i.slice(1).map(r)))}function _(e){const t=e.split(" ");if(t.length<8)throw new Error;const r=new l.IceCandidate(parseInt(t[1],10),t[0],t[4],parseInt(t[5],10),parseInt(t[3],10),t[2],t[7]);return(0,o.default)(8,t.length-1,2).forEach((e=>{switch(t[e]){case"raddr":r.relatedAddress=t[e+1];break;case"rport":r.relatedPort=parseInt(t[e+1]);break;case"tcptype":r.tcpType=t[e+1]}})),r}t.GroupDescription=m,t.candidateToSdp=v,t.parseGroup=S,t.candidateFromSdp=_;class A{constructor(e,t){this.sdp=e,this.type=t}static isThis(e){if("string"==typeof e?.sdp)return!0}}t.RTCSessionDescription=A,t.addSDPHeader=function(e,t){const r=new s.Uint64BE((0,n.randomBytes)(64)).toString().slice(0,8);t.origin=`- ${r} 0 IN IP4 0.0.0.0`,t.msidSemantic.push(new m("WMS",["*"])),t.type=e},t.codecParametersFromString=function(e){const t={};return e.split(";").forEach((e=>{if(e.includes("=")){const[r,i]=(0,u.divide)(e,"=");c.FMTP_INT_PARAMETERS.includes(r)?t[r]=Number(i):t[r]=i}else t[e]=void 0})),t},t.codecParametersToString=function(e){const t=Object.entries(e).map((([e,t])=>t?`${e}=${t}`:e));if(t.length>0)return t.join(";")};class E{constructor(e){Object.assign(this,e)}}t.SsrcDescription=E},4917:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RTCDtlsParameters=t.RTCDtlsFingerprint=t.RTCCertificate=t.DtlsStates=t.RTCDtlsTransport=void 0;const n=r(8644),s=i(r(5493)),o=i(r(5473)),a=r(8670),c=r(2163),u=r(7498),h=r(6759),d=r(2692),l=r(3924),f=r(4692),p=r(5580),y=(0,s.default)("werift:packages/webrtc/src/transport/dtls.ts");t.RTCDtlsTransport=class{constructor(e,t,r,i,n=[]){this.config=e,this.iceTransport=t,this.router=r,this.certificates=i,this.srtpProfiles=n,this.id=(0,c.v4)(),this.state="new",this.role="auto",this.srtpStarted=!1,this.transportSequenceNumber=0,this.dataReceiver=()=>{},this.onStateChange=new o.default,this.sendData=async e=>{if(!(this.config.debug.outboundPacketLoss&&this.config.debug.outboundPacketLoss/100<Math.random())){if(!this.dtls)throw new Error("dtls not established");await this.dtls.send(e)}},this.localCertificate=this.certificates[0]}get localParameters(){return new b(this.localCertificate?this.localCertificate.getFingerprints():[],this.role)}async setupCertificate(){if(!this.localCertificate){const{certPem:e,keyPem:t,signatureHash:r}=await d.CipherContext.createSelfSignedCertificateWithKey({signature:h.SignatureAlgorithm.ecdsa_3,hash:h.HashAlgorithm.sha256_4},h.NamedCurveAlgorithm.secp256r1_23);this.localCertificate=new m(t,e,r)}return this.localCertificate}setRemoteParams(e){this.remoteParameters=e}async start(){if("new"!==this.state)throw new Error;if(0===this.remoteParameters?.fingerprints.length)throw new Error;"auto"===this.role&&("controlling"===this.iceTransport.role?this.role="server":this.role="client"),this.setState("connecting"),await new Promise((async e=>{"server"===this.role?this.dtls=new u.DtlsServer({cert:this.localCertificate?.certPem,key:this.localCertificate?.privateKey,signatureHash:this.localCertificate?.signatureHash,transport:w(this.iceTransport.connection),srtpProfiles:this.srtpProfiles,extendedMasterSecret:!0}):this.dtls=new u.DtlsClient({cert:this.localCertificate?.certPem,key:this.localCertificate?.privateKey,signatureHash:this.localCertificate?.signatureHash,transport:w(this.iceTransport.connection),srtpProfiles:this.srtpProfiles,extendedMasterSecret:!0}),this.dtls.onData.subscribe((e=>{this.config.debug.inboundPacketLoss&&this.config.debug.inboundPacketLoss/100<Math.random()||this.dataReceiver(e)})),this.dtls.onClose.subscribe((()=>{this.setState("closed")})),this.dtls.onConnect.once(e),this.dtls.onError.subscribe((e=>{this.setState("failed"),y("dtls failed",e)})),this.dtls instanceof u.DtlsClient&&(await(0,a.setTimeout)(100),this.dtls.connect().catch((e=>{this.setState("failed"),y("dtls connect failed",e)})))})),this.srtpProfiles.length>0&&this.startSrtp(),this.dtls.onConnect.subscribe((()=>{this.updateSrtpSession(),this.setState("connected")})),this.setState("connected"),y("dtls connected")}updateSrtpSession(){if(!this.dtls)throw new Error;const e=this.dtls.srtp.srtpProfile;if(!e)throw new Error("need srtpProfile");y("selected SRTP Profile",e);const{localKey:t,localSalt:r,remoteKey:i,remoteSalt:n}=this.dtls.extractSessionKeys((0,f.keyLength)(e),(0,f.saltLength)(e)),s={keys:{localMasterKey:t,localMasterSalt:r,remoteMasterKey:i,remoteMasterSalt:n},profile:e};this.srtp=new l.SrtpSession(s),this.srtcp=new l.SrtcpSession(s)}startSrtp(){this.srtpStarted||(this.srtpStarted=!0,this.updateSrtpSession(),this.iceTransport.connection.onData.subscribe((e=>{if(!(this.config.debug.inboundPacketLoss&&this.config.debug.inboundPacketLoss/100<Math.random())&&(0,p.isMedia)(e))if((0,l.isRtcp)(e)){const t=this.srtcp.decrypt(e);l.RtcpPacketConverter.deSerialize(t).forEach((e=>this.router.routeRtcp(e)))}else{const t=this.srtp.decrypt(e),r=l.RtpPacket.deSerialize(t);try{this.router.routeRtp(r)}catch(e){y("router error",e)}}})))}async sendRtp(e,t){const r=this.srtp.encrypt(e,t);return this.config.debug.outboundPacketLoss&&this.config.debug.outboundPacketLoss/100<Math.random()||await this.iceTransport.connection.send(r).catch((()=>{})),r.length}async sendRtcp(e){const t=Buffer.concat(e.map((e=>e.serialize()))),r=this.srtcp.encrypt(t);if(this.config.debug.outboundPacketLoss&&this.config.debug.outboundPacketLoss/100<Math.random())return r.length;await this.iceTransport.connection.send(r).catch((()=>{}))}setState(e){e!=this.state&&(this.state=e,this.onStateChange.execute(e))}async stop(){this.setState("closed")}},t.DtlsStates=["new","connecting","connected","closed","failed"];class m{constructor(e,t,r){this.certPem=t,this.signatureHash=r;const i=n.Certificate.fromPEM(Buffer.from(t));this.publicKey=i.publicKey.toPEM(),this.privateKey=n.PrivateKey.fromPEM(Buffer.from(e)).toPEM()}getFingerprints(){return[new g("sha-256",(0,p.fingerprint)(n.Certificate.fromPEM(Buffer.from(this.certPem)).raw,"sha256"))]}}t.RTCCertificate=m;class g{constructor(e,t){this.algorithm=e,this.value=t}}t.RTCDtlsFingerprint=g;class b{constructor(e=[],t){this.fingerprints=e,this.role=t}}t.RTCDtlsParameters=b;class v{constructor(e){this.ice=e,this.send=e=>this.ice.send(e),e.onData.subscribe((e=>{(0,p.isDtls)(e)&&this.onData&&this.onData(e)}))}close(){this.ice.close()}}const w=e=>new v(e)},4849:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RTCIceParameters=t.IceCandidate=t.RTCIceCandidate=t.candidateToIce=t.candidateFromIce=t.RTCIceGatherer=t.IceGathererStates=t.IceTransportStates=t.RTCIceTransport=void 0;const n=i(r(5493)),s=i(r(5473)),o=r(2163),a=r(3801),c=r(9661),u=(0,n.default)("werift:packages/webrtc/src/transport/ice.ts");t.RTCIceTransport=class{constructor(e){this.gather=e,this.id=(0,o.v4)(),this.state="new",this.onStateChange=new s.default,this.addRemoteCandidate=e=>{if(!this.connection.remoteCandidatesEnd)return e?this.connection.addRemoteCandidate(d(e)):this.connection.addRemoteCandidate(void 0)},this.connection=this.gather.connection,this.connection.stateChanged.subscribe((e=>{this.setState(e)}))}get iceGather(){return this.gather}get role(){return this.connection.iceControlling?"controlling":"controlled"}setState(e){if(e!==this.state){if(this.state=e,this.onStateChange.ended)return;"closed"===e?(this.onStateChange.execute(e),this.onStateChange.complete()):this.onStateChange.execute(e)}}setRemoteParams(e){this.connection.remoteUsername&&this.connection.remotePassword&&(this.connection.remoteUsername!==e.usernameFragment||this.connection.remotePassword!==e.password)&&(u("restartIce",e),this.connection.resetNominatedPair()),this.connection.setRemoteParams(e)}async start(){if("closed"===this.state)throw new Error("RTCIceTransport is closed");if(!this.connection.remotePassword||!this.connection.remoteUsername)throw new Error("remoteParams missing");this.waitStart&&await this.waitStart.asPromise(),this.waitStart=new s.default,this.setState("checking");try{await this.connection.connect()}catch(e){throw this.setState("failed"),e}this.waitStart.complete()}async stop(){"closed"!==this.state&&(this.setState("closed"),await this.connection.close())}},t.IceTransportStates=["new","checking","connected","completed","disconnected","failed","closed"],t.IceGathererStates=["new","gathering","complete"];function h(e){const t=new f(e.component,e.foundation,e.host,e.port,e.priority,e.transport,e.type);return t.relatedAddress=e.relatedAddress,t.relatedPort=e.relatedPort,t.tcpType=e.tcptype,t}function d(e){return new a.Candidate(e.foundation,e.component,e.protocol,e.priority,e.ip,e.port,e.type,e.relatedAddress,e.relatedPort,e.tcpType)}t.RTCIceGatherer=class{constructor(e={}){this.options=e,this.onIceCandidate=()=>{},this.gatheringState="new",this.onGatheringStateChange=new s.default,this.connection=new a.Connection(!1,this.options)}async gather(){"new"===this.gatheringState&&(this.setState("gathering"),await this.connection.gatherCandidates((e=>this.onIceCandidate(h(e)))),this.setState("complete"))}get localCandidates(){return this.connection.localCandidates.map(h)}get localParameters(){return new p({usernameFragment:this.connection.localUserName,password:this.connection.localPassword})}setState(e){e!==this.gatheringState&&(this.gatheringState=e,this.onGatheringStateChange.execute(e))}},t.candidateFromIce=h,t.candidateToIce=d;class l{constructor(e){Object.assign(this,e)}static isThis(e){if("string"==typeof e?.candidate)return!0}toJSON(){return{candidate:this.candidate,sdpMid:this.sdpMid,sdpMLineIndex:this.sdpMLineIndex}}}t.RTCIceCandidate=l;class f{constructor(e,t,r,i,n,s,o){this.component=e,this.foundation=t,this.ip=r,this.port=i,this.priority=n,this.protocol=s,this.type=o}toJSON(){return new l({candidate:(0,c.candidateToSdp)(this),sdpMLineIndex:this.sdpMLineIndex,sdpMid:this.sdpMid})}static fromJSON(e){try{const t=(0,c.candidateFromSdp)(e.candidate);return t.sdpMLineIndex=e.sdpMLineIndex,t.sdpMid=e.sdpMid,t}catch(e){}}}t.IceCandidate=f;class p{constructor(e={}){this.iceLite=!1,Object.assign(this,e)}}t.RTCIceParameters=p},4990:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RTCSctpCapabilities=t.RTCSctpTransport=void 0;const a=o(r(5493)),c=r(239),u=r(5473),h=s(r(2163)),d=r(8480),l=r(4536),f=r(6639),p=(0,a.default)("werift:packages/webrtc/src/transport/sctp.ts");t.RTCSctpTransport=class{constructor(e=5e3){this.port=e,this.onDataChannel=new u.Event,this.id=h.v4(),this.bundled=!1,this.dataChannels={},this.dataChannelQueue=[],this.eventDisposer=[],this.datachannelReceive=async(e,t,r)=>{if(t===l.WEBRTC_DCEP&&r.length>0)switch(p("DCEP",e,t,r),r[0]){case l.DATA_CHANNEL_OPEN:{if(r.length<12)return void p("DATA_CHANNEL_OPEN data.length not enough");if(Object.keys(this.dataChannels).includes(e.toString()))p("datachannel already opened","retransmit ack");else{const[,t,,i,n,s]=c.jspack.Unpack("!BBHLHH",r);let o=12;const a=r.slice(o,o+n).toString("utf8");o+=n;const u=r.slice(o,o+s).toString("utf8");p("DATA_CHANNEL_OPEN",{channelType:t,reliability:i,streamId:e,label:a,protocol:u});const h=1==(3&t)?i:void 0,d=2==(3&t)?i:void 0,l=new f.RTCDataChannelParameters({label:a,ordered:0==(128&t),maxPacketLifeTime:d,maxRetransmits:h,protocol:u,id:e}),y=new f.RTCDataChannel(this,l,!1);y.isCreatedByRemote=!0,this.dataChannels[e]=y,this.onDataChannel.execute(y),y.setReadyState("open")}const t=this.dataChannels[e];this.dataChannelQueue.push([t,l.WEBRTC_DCEP,Buffer.from(c.jspack.Pack("!B",[l.DATA_CHANNEL_ACK]))]),await this.dataChannelFlush()}break;case l.DATA_CHANNEL_ACK:p("DATA_CHANNEL_ACK",e,t);const i=this.dataChannels[e];if(!i)throw new Error("channel not found");i.setReadyState("open")}else{const i=this.dataChannels[e];if(i){const e=(()=>{switch(t){case l.WEBRTC_STRING:return r.toString("utf8");case l.WEBRTC_STRING_EMPTY:return"";case l.WEBRTC_BINARY:return r;case l.WEBRTC_BINARY_EMPTY:return Buffer.from([]);default:throw new Error}})();i.message.execute(e),i.emit("message",{data:e}),i.onmessage&&i.onmessage({data:e})}}},this.datachannelSend=(e,t)=>{e.addBufferedAmount(t.length),this.dataChannelQueue.push("string"==typeof t?[e,l.WEBRTC_STRING,Buffer.from(t)]:[e,l.WEBRTC_BINARY,t]),this.sctp.associationState!==d.SCTP_STATE.ESTABLISHED&&p("sctp not established",this.sctp.associationState),this.dataChannelFlush()}}setDtlsTransport(e){this.dtlsTransport&&this.dtlsTransport.id===e.id||(this.eventDisposer.forEach((e=>e())),this.dtlsTransport=e,this.sctp=new d.SCTP(new m(this.dtlsTransport),this.port),this.eventDisposer=[...[this.sctp.onReceive.subscribe(this.datachannelReceive),this.sctp.onReconfigStreams.subscribe((e=>{e.forEach((e=>{const t=this.dataChannels[e];t&&(t.setReadyState("closing"),t.setReadyState("closed"),delete this.dataChannels[e])}))})),this.sctp.stateChanged.connected.subscribe((()=>{Object.values(this.dataChannels).forEach((e=>{e.negotiated&&"open"!==e.readyState&&e.setReadyState("open")})),this.dataChannelFlush()})),this.sctp.stateChanged.closed.subscribe((()=>{Object.values(this.dataChannels).forEach((e=>{e.setReadyState("closed")})),this.dataChannels={}})),this.dtlsTransport.onStateChange.subscribe((e=>{"closed"===e&&this.sctp.setState(d.SCTP_STATE.CLOSED)}))].map((e=>e.unSubscribe)),()=>this.sctp.onSackReceived=async()=>{}],this.sctp.onSackReceived=async()=>{await this.dataChannelFlush()})}get isServer(){return"controlling"!==this.dtlsTransport.iceTransport.role}channelByLabel(e){return Object.values(this.dataChannels).find((t=>t.label===e))}dataChannelAddNegotiated(e){if(null==e.id)throw new Error;if(this.dataChannels[e.id])throw new Error;this.dataChannels[e.id]=e,this.sctp.associationState===d.SCTP_STATE.ESTABLISHED&&e.setReadyState("open")}dataChannelOpen(e){if(e.id){if(this.dataChannels[e.id])throw new Error(`Data channel with ID ${e.id} already registered`);this.dataChannels[e.id]=e}let t=l.DATA_CHANNEL_RELIABLE;let r=0;e.ordered||(t=128),e.maxRetransmits?(t=1,r=e.maxRetransmits):e.maxPacketLifeTime&&(t=2,r=e.maxPacketLifeTime);const i=c.jspack.Pack("!BBHLHH",[l.DATA_CHANNEL_OPEN,t,0,r,e.label.length,e.protocol.length]),n=Buffer.concat([Buffer.from(i),Buffer.from(e.label,"utf8"),Buffer.from(e.protocol,"utf8")]);this.dataChannelQueue.push([e,l.WEBRTC_DCEP,n]),this.dataChannelFlush()}async dataChannelFlush(){if(this.sctp.associationState==d.SCTP_STATE.ESTABLISHED&&!(this.sctp.outboundQueue.length>0))for(;this.dataChannelQueue.length>0;){const[e,t,r]=this.dataChannelQueue.shift();let i=e.id;if(void 0===i){for(i=this.dataChannelId;Object.keys(this.dataChannels).includes(i.toString());)i+=2;this.dataChannels[i]=e,e.setId(i)}if(t===l.WEBRTC_DCEP)await this.sctp.send(i,t,r,{ordered:!0});else{const n=e.maxPacketLifeTime?Date.now()+e.maxPacketLifeTime/1e3:void 0;await this.sctp.send(i,t,r,{expiry:n,maxRetransmits:e.maxRetransmits,ordered:e.ordered}),e.addBufferedAmount(-r.length)}}}static getCapabilities(){return new y(65536)}setRemotePort(e){this.sctp.setRemotePort(e)}async start(e){this.isServer?this.dataChannelId=0:this.dataChannelId=1,this.sctp.isServer=this.isServer,await this.sctp.start(e)}async stop(){this.dtlsTransport.dataReceiver=()=>{},await this.sctp.stop()}dataChannelClose(e){["closing","closed"].includes(e.readyState)||(e.setReadyState("closing"),this.sctp.associationState===d.SCTP_STATE.ESTABLISHED?(this.sctp.reconfigQueue.push(e.id),1===this.sctp.reconfigQueue.length&&this.sctp.transmitReconfigRequest()):(this.dataChannelQueue=this.dataChannelQueue.filter((t=>t[0].id!==e.id)),e.id&&delete this.dataChannels[e.id],e.setReadyState("closed")))}};class y{constructor(e){this.maxMessageSize=e}}t.RTCSctpCapabilities=y;class m{constructor(e){this.dtls=e,this.send=e=>this.dtls.sendData(e)}set onData(e){this.dtls.dataReceiver=e}close(){}}},9524:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionStates=t.SignalingStates=void 0,t.SignalingStates=["stable","have-local-offer","have-remote-offer","have-local-pranswer","have-remote-pranswer","closed"],t.ConnectionStates=["closed","failed","disconnected","new","connecting","connected"]},5580:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createSelfSignedCertificate=t.RtpBuilder=t.parseIceServers=t.compactNtp=t.ntpTime=t.timestampSeconds=t.milliTime=t.microTime=t.reverseDirection=t.andDirection=t.reverseSimulcastDirection=t.isMedia=t.isDtls=t.fingerprint=void 0;const n=r(6113),s=i(r(5493)),o=r(4074),a=r(680),c=r(2692),u=r(3924),h=r(5608),d=r(8955),l=(0,s.default)("werift:packages/webrtc/src/utils.ts");t.fingerprint=function(e,t){return(e=>e.match(/(.{2})/g).join(":"))((0,n.createHash)(t).update(e).digest("hex").toUpperCase())},t.isDtls=function(e){const t=e[0];return t>19&&t<64},t.isMedia=function(e){const t=e[0];return t>127&&t<192},t.reverseSimulcastDirection=function(e){return"recv"===e?"send":"recv"};t.andDirection=(e,t)=>h.Directions[h.Directions.indexOf(e)&h.Directions.indexOf(t)],t.reverseDirection=function(e){return"sendonly"===e?"recvonly":"recvonly"===e?"sendonly":e};t.microTime=()=>d.micro();t.milliTime=()=>(new Date).getTime();t.timestampSeconds=()=>Date.now()/1e3;t.ntpTime=()=>{const e=(o.performance.timeOrigin+o.performance.now()-Date.UTC(1900,0,1))/1e3,[t,r]=e.toString().split(".").map(Number);return(0,a.bufferWriter)([4,4],[t,r]).readBigUInt64BE()};t.compactNtp=e=>{const t=(0,a.bufferWriter)([8],[e]),[,r,i]=(0,a.bufferReader)(t,[2,2,2,2]);return(0,a.bufferWriter)([2,2],[r,i]).readUInt32BE()},t.parseIceServers=function(e){const t=e=>{if(!e)return;const[t,r]=e.split(":");return[t,parseInt(r)]},r=t(e.find((({urls:e})=>e.includes("stun:")))?.urls.slice(5)),i=t(e.find((({urls:e})=>e.includes("turn:")))?.urls.slice(5)),{credential:n,username:s}=e.find((({urls:e})=>e.includes("turn:")))||{},o={stunServer:r,turnServer:i,turnUsername:s,turnPassword:n};return l("iceOptions",o),o};t.RtpBuilder=class{constructor(){this.sequenceNumber=(0,a.random16)(),this.timestamp=(0,a.random32)()}create(e){this.sequenceNumber=(0,a.uint16Add)(this.sequenceNumber,1),this.timestamp=(0,a.uint32Add)(this.timestamp,960);const t=new u.RtpHeader({sequenceNumber:this.sequenceNumber,timestamp:Number(this.timestamp),payloadType:96,extension:!0,marker:!1,padding:!1});return new u.RtpPacket(t,e)}},t.createSelfSignedCertificate=c.CipherContext.createSelfSignedCertificateWithKey},6814:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.H264Repacketizer=t.splitH264NaluStartCode=t.NAL_TYPE_DELIMITER=t.NAL_TYPE_PPS=t.NAL_TYPE_SPS=t.NAL_TYPE_SEI=t.NAL_TYPE_IDR=t.NAL_TYPE_NON_IDR=t.NAL_TYPE_FU_A=t.NAL_TYPE_STAP_A=void 0;const i=r(3900);t.NAL_TYPE_STAP_A=24,t.NAL_TYPE_FU_A=28,t.NAL_TYPE_NON_IDR=1,t.NAL_TYPE_IDR=5,t.NAL_TYPE_SEI=6,t.NAL_TYPE_SPS=7,t.NAL_TYPE_PPS=8,t.NAL_TYPE_DELIMITER=9;function n(e){const t=[];let r=0,i=0;const n=()=>{const n=e.subarray(r,i);n.length&&t.push(n),i+=4,r=i};for(;i<e.length-4;){1===e.readUInt32BE(i)?n():i++}return i=e.length,n(),t}t.splitH264NaluStartCode=n;t.H264Repacketizer=class{constructor(e,t,r,n=new i.JitterBuffer(e,4)){this.console=e,this.maxPacketSize=t,this.codecInfo=r,this.jitterBuffer=n,this.extraPackets=0,this.seenStapASps=!1,this.fuaMax=t-2,this.fuaMin=Math.round(.8*t)}ensureCodecInfo(){this.codecInfo||(this.codecInfo={sps:void 0,pps:void 0})}updateSps(e){this.ensureCodecInfo(),this.codecInfo.sps=e}updatePps(e){this.ensureCodecInfo(),this.codecInfo.pps=e}shouldFilter(e){return!1}packetizeFuA(e,r,i){if((31&e[0])===t.NAL_TYPE_FU_A){const t=224&e[0],n=31&e[1],s=!!(128&e[1]),o=!!(64&e[1]),a=!s&&!o,c=Buffer.from([t|n]);e=Buffer.concat([c,e.subarray(2)]),s?i=!0:o?r=!0:a&&(r=!0,i=!0)}const n=224&e[0],s=31&e[0],o=n|t.NAL_TYPE_FU_A,a=Buffer.from([o,s]),c=r?a:Buffer.from([o,128|s]),u=i?a:Buffer.from([o,64|s]);let h=c;const d=[];let l=1;for(;l<e.length;){let t;const r=Math.min(this.fuaMax,e.length-l);t=e.subarray(l,l+r),l+=r,l===e.length&&(h=u),d.push(Buffer.concat([h,t])),h=a}return d}packetizeOneStapA(e){const r=[];if(!e.length)throw new Error("packetizeOneStapA requires at least one NAL");let i=0,n=this.maxPacketSize-3;const s=t.NAL_TYPE_STAP_A;for(;e.length&&e[0].length+2<=n&&i<9;){const t=e.shift();n-=2+t.length,i+=1;const s=Buffer.alloc(2);s.writeUInt16BE(t.length,0),r.push(s,t)}return 0===i?(this.console.warn("stap a packet is too large. this may be a bug."),e.shift()):(r.unshift(Buffer.from([s])),Buffer.concat(r))}packetizeStapA(e){const t=[];for(;e.length;)t.push(this.packetizeOneStapA(e));return t}createPacket(e,t,r){const i=e.clone();return i.header.sequenceNumber=(e.header.sequenceNumber+this.extraPackets+65536)%65536,i.header.marker=r,i.header.padding=!1,i.payload=t,t.length>this.maxPacketSize&&this.console.warn("packet exceeded max packet size. this may a bug."),i}flushPendingFuA(e){if(!this.pendingFuA)return;const r=this.pendingFuA[0],i=this.pendingFuA[this.pendingFuA.length-1],s=31&r.payload[1],o=!!(128&r.payload[1]),a=!!(64&i.payload[1]),c=224&r.payload[0],u=Buffer.from([c|s]),h=()=>{const e=this.pendingFuA.map((e=>e.payload.subarray(2)));e.unshift(u);return Buffer.concat(e)};if(s===t.NAL_TYPE_SPS){const s=n(h());for(;s.length;){const n=s.shift(),c=31&n[0];c===t.NAL_TYPE_SPS?this.updateSps(n):c===t.NAL_TYPE_PPS?this.updatePps(n):(c===t.NAL_TYPE_IDR&&this.maybeSendSpsPps(r,e),this.fragment(r,e,{payload:n,noStart:!o,noEnd:!a,marker:i.header.marker}))}}else{for(;this.pendingFuA.length;){const t=this.pendingFuA[0];if(t.payload.length>this.maxPacketSize||t.payload.length<this.fuaMin)break;this.pendingFuA.shift(),e.push(this.createPacket(t,t.payload,t.header.marker))}if(!this.pendingFuA.length)return void(this.pendingFuA=void 0);const t=this.pendingFuA[0],r=this.pendingFuA[this.pendingFuA.length-1],i=!!(128&t.payload[1]),n=!!(64&r.payload[1]),s=h();this.fragment(t,e,{payload:s,noStart:!i,noEnd:!n,marker:r.header.marker})}this.extraPackets-=this.pendingFuA.length-1,this.pendingFuA=void 0}createRtpPackets(e,t,r,i=e.header.marker){t.forEach(((n,s)=>{0!==s&&this.extraPackets++;const o=i&&s===t.length-1;r.push(this.createPacket(e,n,o))}))}maybeSendSpsPps(e,t){if(!this.codecInfo?.sps||!this.codecInfo?.pps)return;const r=this.packetizeStapA([this.codecInfo.sps,this.codecInfo.pps]);1===r.length?(this.createRtpPackets(e,r,t),this.extraPackets++):this.console.error("expected only 1 packet for sps/pps stapa")}fragment(e,t,r={payload:e.payload,noStart:!1,noEnd:!1,marker:e.header.marker}){const{payload:i,noStart:n,noEnd:s,marker:o}=r;if(i.length>this.maxPacketSize||n||s){const r=this.packetizeFuA(i,n,s);this.createRtpPackets(e,r,t,o)}else t.push(this.createPacket(e,i,o))}repacketize(e){const t=[];for(const r of this.jitterBuffer.queue(e))this.repacketizeOne(r,t);return t}repacketizeOne(e,r){if(!e.payload.length)return this.flushPendingFuA(r),void this.extraPackets--;const n=31&e.payload[0];if(this.pendingFuA&&this.pendingFuA[0].header.timestamp!==e.header.timestamp&&this.flushPendingFuA(r),n===t.NAL_TYPE_FU_A){const n=e.payload,s=31&n[1];if(this.shouldFilter(s))return void this.extraPackets--;const o=!!(128&n[1]),a=!!(64&e.payload[1]);if(o)this.pendingFuA&&this.console.error("fua restarted. skipping refragmentation of previous fua.",s),this.pendingFuA=void 0,s===t.NAL_TYPE_IDR&&(this.seenStapASps||this.maybeSendSpsPps(e,r),this.seenStapASps=!1);else if(this.pendingFuA){const t=this.pendingFuA[this.pendingFuA.length-1];if(!(0,i.isNextSequenceNumber)(t.header.sequenceNumber,e.header.sequenceNumber))return void this.console.error("fua packet missing. skipping refragmentation.",s)}if(this.pendingFuA||(this.pendingFuA=[]),this.pendingFuA.push(e),a)this.flushPendingFuA(r);else if(this.pendingFuA.reduce(((e,t)=>e+t.payload.length-2),1)>this.maxPacketSize){const e=this.pendingFuA[this.pendingFuA.length-1].clone(),t=[];this.flushPendingFuA(t);const i=t.pop();e.payload=i.payload,this.pendingFuA=[e],r.push(...t)}}else if(n===t.NAL_TYPE_STAP_A){this.flushPendingFuA(r);const i=function(e){const t=[];let r,i=1;for(;i<e.length;){void 0!==r&&t.push(e.subarray(r,i));const n=e.readUInt16BE(i);i+=2,r=i,i+=n}return t.push(e.subarray(r)),t}(e.payload).filter((e=>{const r=31&e[0];return this.seenStapASps=this.seenStapASps||r===t.NAL_TYPE_SPS,!this.shouldFilter(r)&&(r===t.NAL_TYPE_SPS&&this.updateSps(e),r===t.NAL_TYPE_PPS&&this.updatePps(e),!0)}));if(0===i.length)return void this.extraPackets--;const n=this.packetizeStapA(i);this.createRtpPackets(e,n,r)}else if(n>=1&&n<24){if(this.flushPendingFuA(r),this.shouldFilter(n))return void this.extraPackets--;if(n===t.NAL_TYPE_SPS)return this.extraPackets--,void this.updateSps(e.payload);if(n===t.NAL_TYPE_PPS)return this.extraPackets--,void this.updatePps(e.payload);if(this.shouldFilter(n))return void this.extraPackets--;n===t.NAL_TYPE_IDR&&(this.seenStapASps||this.maybeSendSpsPps(e,r),this.seenStapASps=!1),this.fragment(e,r)}else this.console.error("unknown nal unit type "+n),this.extraPackets--}}},3900:(e,t)=>{"use strict";function r(e,t){if(t===e)return 0;const r=t-e;let i;return i=t>e?e+65536-t:t+65536-e,Math.abs(r)<Math.abs(i)?r:i}function i(e,t=1){return(e+t+65536)%65536}Object.defineProperty(t,"__esModule",{value:!0}),t.JitterBuffer=t.isNextSequenceNumber=t.addRtpTimestamp=t.nextSequenceNumber=t.sequenceNumberDistance=void 0,t.sequenceNumberDistance=r,t.nextSequenceNumber=i;const n=BigInt(4294967295);function s(e,t){return i(e)===t}t.addRtpTimestamp=function(e,t){return Number(n&BigInt(e)+BigInt(t))},t.isNextSequenceNumber=s;t.JitterBuffer=class{constructor(e,t){this.console=e,this.jitterSize=t,this.pending=[]}flushPending(e,t){if(!this.pending)return t;const n=i(e);for(let e=0;e<this.jitterSize;e++){const i=(n+e)%this.jitterSize,s=this.pending[i];if(!s)continue;const{sequenceNumber:o}=s.header,a=r(this.lastSequenceNumber,o);a<=0?(this.console.log("jitter buffer purged packet:",o),this.pending[i]=void 0,t.push(s)):1===a&&(this.pending[i]=void 0,this.lastSequenceNumber=o,t.push(s))}return t}queue(e){if(void 0===this.lastSequenceNumber||s(this.lastSequenceNumber,e.header.sequenceNumber))return this.lastSequenceNumber=e.header.sequenceNumber,this.flushPending(this.lastSequenceNumber,[e]);const{sequenceNumber:t}=e.header,i=r(this.lastSequenceNumber,t);if(i<=0)return[];const n=[];if(i>this.jitterSize){this.console.log("jitter buffer skipped packets:",i);const{lastSequenceNumber:e}=this;this.lastSequenceNumber=t-this.jitterSize,this.flushPending(e,n)}return this.pending[e.header.sequenceNumber%this.jitterSize]=e,this.flushPending(this.lastSequenceNumber,n)}}},5299:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataChannelDebouncer=void 0;const r=65536;t.DataChannelDebouncer=class{constructor(e,t){this.dc=e,this.kill=t,this.maxWait=10}send(e){this.pending?.length+e.length>=r&&this.flush(),this.pending?this.pending=Buffer.concat([this.pending,e]):this.pending=e,clearTimeout(this.timeout),this.timeout=setTimeout((()=>this.flush()),this.maxWait),this.pending?.length+e.length>=r&&this.flush()}flush(){try{let e=0;for(;e<this.pending.length;)this.dc.send(this.pending.slice(e,e+r)),e+=r;this.pending=void 0,clearTimeout(this.timeout),this.timeout=void 0}catch(e){this.kill(e)}}}},7924:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.createRTCPeerConnectionSink=t.WebRTCConnectionManagement=t.parseOptions=t.createTrackForwarder=t.RTC_BRIDGE_NATIVE_ID=void 0;const o=r(4297),a=r(6405),c=s(r(7954)),u=r(8143),h=r(8676),d=r(3540),l=r(9934),f=r(566),p=r(1853),y=r(6814),m=r(6895),g=r(3915),b=r(8676),v=r(6908);async function w(e){const{timeStart:r,isPrivate:i,destinationId:n,requestMediaStream:s,videoTransceiver:a,audioTransceiver:u,maximumCompatibilityMode:h,clientOptions:d}=e,{sessionSupportsH264High:f,transcodeWidth:m,isMediumResolution:v,width:w,height:S}=_(d);let A=h;const E=!v&&!A;let C;A?C="medium-resolution":i||(C="remote");const k=await s({video:{codec:"h264",width:w,height:S},audio:{codec:"opus"},adaptive:E,destination:C,destinationId:n,tool:E?"scrypted":"ffmpeg"});if(!k)return;let T;try{T=await c.default.mediaManager.convertMediaObject(k,c.ScryptedMimeTypes.MediaStreamFeedback)}catch(e){}T&&a.sender.onRtcp.subscribe((e=>{T.onRtcp(e.serialize())}));const P=c.default.deviceManager.getMixinConsole(k.sourceId,t.RTC_BRIDGE_NATIVE_ID),I=await c.default.mediaManager.convertMediaObjectToJSON(k,c.ScryptedMimeTypes.FFmpegInput),{mediaStreamOptions:R}=I;if(v&&!A){const e=I?.mediaStreamOptions?.video?.width;A=!e||e>1280}if(P.log("Client Stream Profile",{transcodeBaseline:A,sessionSupportsH264High:f,maximumCompatibilityMode:h,...d}),!h){let e;"pcm_mulaw"===R?.audio?.codec?e=u.codecs.find((e=>"audio/PCMU"===e.mimeType)):"pcm_alaw"===R?.audio?.codec&&(e=u.codecs.find((e=>"audio/PCMA"===e.mimeType))),e&&(u.sender.codec=e)}const{name:x}=(0,b.getAudioCodec)(u.sender.codec);let B=h?void 0:x;const O=[],M=A||"h264"!==R?.video?.codec||I.h264EncoderArguments?.length||I.h264FilterArguments?.length;let N;if(!M&&(!R?.video?.h264Info?.reserved30&&!R?.video?.h264Info?.reserved31)&&(N="h264"),I.mediaStreamOptions?.oobCodecParameters&&O.push("-bsf:v","dump_extra"),O.push(...I.h264FilterArguments||[]),M){const e=i?1e6:5e5,t=h?e:I.destinationVideoBitrate||e;O.push("-b:v",t.toString(),"-bufsize",(2*t).toString(),"-maxrate",t.toString(),"-r","15");const r=`scale='min(${m},iw)':-2`;(0,l.addVideoFilterArguments)(O,r),A?O.push("-profile:v","baseline","-preset","ultrafast","-g","60","-c:v","libx264","-bf","0"):O.push(...I.h264EncoderArguments||["-profile:v","baseline","-preset","ultrafast","-g","60","-c:v","libx264","-bf","0"])}else O.push("-vcodec","copy");const D=(0,b.getFFmpegRtpAudioOutputArguments)(I.mediaStreamOptions?.audio?.codec,u.sender.codec,h);let L=!!N;if(M)try{const e=await c.default.mediaManager.convertMediaObject(k,c.ScryptedMimeTypes.FFmpegTranscodeStream);await e({videoDecoderArguments:I.videoDecoderArguments,videoTranscodeArguments:O,audioTranscodeArguments:D}),O.splice(0,O.length),N="copy",B="copy",L=!0}catch(e){}const U={codecCopy:B,onRtp:u.sender.sendRtp.bind(u.sender),encoderArguments:[...D],firstPacket:e=>{const t=o.RtpPacket.deSerialize(e);u.sender.replaceRTP(t.header,!0)}};let j,q;const K={codecCopy:N,packetSize:1378,onMSection:e=>q=(0,p.getSpsPps)(e),onRtp:e=>{let t;L?(j||(j=new y.H264Repacketizer(P,1366,{...q})),t=e=>{const t=j.repacketize(o.RtpPacket.deSerialize(e));for(const e of t)a.sender.sendRtp(e)}):t=e=>{a.sender.sendRtp(e)},K.onRtp=t,K.onRtp(e)},encoderArguments:[...O],firstPacket:e=>{P.log("first video packet",Date.now()-r);const t=o.RtpPacket.deSerialize(e);a.sender.replaceRTP(t.header,!0)}};let H;return H=null!==I.mediaStreamOptions?.audio&&u?null!==I.mediaStreamOptions?.video&&a?{video:K,audio:U}:{audio:U}:{video:K},(0,g.startRtpForwarderProcess)(P,I,H)}t.RTC_BRIDGE_NATIVE_ID="rtc-bridge",t.createTrackForwarder=w;const S=[100,110,122,244].map((e=>e.toString(16)));function _(e){let t=!!e?.capabilities?.video?.codecs?.filter((e=>"video/h264"===e.mimeType.toLowerCase()))?.find((e=>{let t=e.sdpFmtpLine.toLowerCase();for(const e of S)if(t.includes(`profile-level-id=${e}`))return!0;return!1}));e?.userAgent?.includes("Firefox/")&&(t=!0);const r=Math.max(640,Math.min(e?.screen?.width||960,1280)),i=e?.screen?.width,n=e?.screen?.height,s=Math.max(i,n)*e?.screen?.devicePixelRatio,o=!t||s&&s<1920;return{sessionSupportsH264High:t,transcodeWidth:r,isMediumResolution:o,width:o?1280:i,height:o?720:n}}t.parseOptions=_;class A{constructor(e,t,r,i){this.connectionManagement=e,this.video=t,this.audio=r,this.removed=new a.Deferred,this.control=new u.ScryptedSessionControl(i,r)}async onStop(){return this.removed.promise}attachForwarder(e){const t=this.removed;e.killPromise.then((()=>t.resolve(void 0))).catch((e=>t.reject(e)))}async replace(e){const{createTrackForwarder:t,intercom:r}=await this.connectionManagement.createTracks(e);this.cleanup(!0),this.removed=new a.Deferred,this.control=new u.ScryptedSessionControl(r,this.audio);const i=await t(this.video,this.audio);this.attachForwarder(i),(0,m.waitClosed)(this.connectionManagement.pc).finally((()=>i.kill())),this.removed.promise.finally((()=>i.kill()))}cleanup(e){this.removed.finished||(this.removed.resolve(void 0),this.control.killed.resolve(void 0),this.video.sender.onRtcp.allUnsubscribe(),e||(this.connectionManagement.activeTracks.delete(this),this.video.stop(),this.audio.stop(),this.connectionManagement.pc.removeTrack(this.video.sender),this.connectionManagement.pc.removeTrack(this.audio.sender)))}async stop(){return this.cleanup(!1)}setPlayback(e){return this.control.setPlayback(e)}}class E{constructor(e,t,r,i,n){this.console=e,this.clientSession=t,this.maximumCompatibilityMode=r,this.clientOptions=i,this.options=n,this.negotiationDeferred=new a.Deferred,this.activeTracks=new Set,this.closed=!1,this.pc=new o.RTCPeerConnection({codecs:{audio:[...h.requiredAudioCodecs],video:[h.requiredVideoCodec]},...n.weriftConfiguration}),(0,m.logConnectionState)(e,this.pc),(0,m.waitConnected)(this.pc).then((()=>(0,d.logIsPrivateIceTransport)(this.console,this.pc))).catch((()=>{})),this.weriftSignalingSession=new v.WeriftSignalingSession(e,this.pc)}async probe(){}async createTracks(e,t){let r;try{r=await c.default.mediaManager.convertMediaObject(e,c.ScryptedMimeTypes.RequestMediaStream)}catch(t){r=async()=>e}const i=c.default.systemManager.getDeviceById(t),n=new o.MediaStreamTrack({kind:"video",codec:h.requiredVideoCodec}),s=new o.MediaStreamTrack({kind:"audio"}),a=(c.default.deviceManager.getMixinConsole(e?.sourceId||t),Date.now());return{vtrack:n,atrack:s,intercom:i,createTrackForwarder:async(e,t)=>await w({timeStart:a,...(0,d.isPrivateIceTransport)(this.pc),requestMediaStream:r,videoTransceiver:e,audioTransceiver:t,maximumCompatibilityMode:this.maximumCompatibilityMode,clientOptions:this.clientOptions})}}get negotiation(){return this.negotiationDeferred.finished&&(this.negotiationDeferred=new a.Deferred),this.negotiationDeferred.promise}async negotiateRTCSignalingSession(){return this.negotiateRTCSignalingSessionInternal({configuration:this.options?.configuration})}async negotiateRTCSignalingSessionInternal(e,t){try{t?await(0,f.connectRTCSignalingClients)(this.console,this.clientSession,e,this.weriftSignalingSession,{}):await(0,f.connectRTCSignalingClients)(this.console,this.weriftSignalingSession,{},this.clientSession,e),this.negotiationDeferred.resolve(void 0)}catch(e){throw this.console.error("negotiation failed",e),this.negotiationDeferred.reject(e),e}}async addTrack(e,t){const{atrack:r,vtrack:i,createTrackForwarder:n,intercom:s}=await this.createTracks(e,t?.intercomId),o=this.pc.addTransceiver(i,{direction:"sendonly"});o.mid=t?.videoMid;const a=this.pc.addTransceiver(r,{direction:s?"sendrecv":"sendonly"});a.mid=t?.audioMid;const c=new A(this,o,a,s);return this.negotiation.then((async()=>{if(this.console.log("waiting ice connected"),this.pc.remoteIsBundled?await(0,m.waitConnected)(this.pc):await(0,m.waitIceConnected)(this.pc),c.removed.finished)return;this.console.log("done waiting ice connected");const e=await n(o,a);c.attachForwarder(e),(0,m.waitClosed)(this.pc).finally((()=>e?.kill())),c.removed.promise.finally((()=>e?.kill()))})),c}async close(){for(const e of this.activeTracks)e.cleanup(!0);this.activeTracks.clear(),this.pc.close()}async waitClosed(){await(0,m.waitClosed)(this.pc)}async waitConnected(){await(0,m.waitIceConnected)(this.pc),await(0,m.waitConnected)(this.pc)}}t.WebRTCConnectionManagement=E,t.createRTCPeerConnectionSink=async function(e,t,r,i,n,s,o,a=!0){const c=await e.getOptions(),u=new E(t,e,n,c,{configuration:s,weriftConfiguration:o}),h=await u.addTrack(i,{intercomId:r?.id});h.control.killed.promise.then((()=>{h.cleanup(!0),u.pc.close()}));const d={audio:{direction:r?"sendrecv":"recvonly"},video:{direction:"recvonly"},configuration:s};return u.negotiateRTCSignalingSessionInternal(d,a),h.control}},8186:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.weriftStunServer=t.weriftTurnServer=t.toWeriftConfiguration=t.stunIceServers=t.turnIceServers=t.stunServer=t.turnServer=void 0;const r="turn.scrypted.app:3478",i=`turn:${r}`,n=`stun:${r}`,s={username:"foo",credential:"bar"};t.turnServer={urls:[i],...s},t.stunServer={urls:[n],...s};const o={urls:["stun:stun.l.google.com:19302"]};function a(e){return{urls:"string"==typeof e.urls?e.urls:e.urls[0],username:e.username,credential:e.credential}}t.turnIceServers=[o,t.turnServer],t.stunIceServers=[o],t.toWeriftConfiguration=function(e){return{iceServers:e.iceServers.map(a)}},t.weriftTurnServer=a(t.turnServer),t.weriftStunServer=a(t.stunServer)},6360:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.fork=t.WebRTCPlugin=void 0;const a=r(7817),c=r(6405),u=r(400),h=r(281),d=r(6219),l=s(r(7954)),f=r(8202),p=o(r(6113)),y=o(r(413)),m=o(r(1808)),g=r(5299),b=r(7924),v=r(8186),w=r(6895),S=r(3525),_=r(4297),A=r(6908),E=r(4444),C=r(1645),{mediaManager:k,systemManager:T,deviceManager:P}=l.default;_.defaultPeerConfig.headerExtensions={video:[],audio:[]};const I=(0,C.createZygote)();class R extends d.SettingsMixinDeviceBase{constructor(e,t){super(t),this.plugin=e,this.storageSettings=new f.StorageSettings(this,{})}async startIntercom(e){if(this.webrtcIntercom){return(await this.webrtcIntercom).startIntercom(e)}if(this.mixinDeviceInterfaces.includes(l.ScryptedInterface.Intercom))return this.mixinDevice.startIntercom(e);if(!this.mixinDeviceInterfaces.includes(l.ScryptedInterface.RTCSignalingClient)){if((this.type===l.ScryptedDeviceType.Speaker||this.type===l.ScryptedDeviceType.SmartSpeaker)&&this.mixinDeviceInterfaces.includes(l.ScryptedInterface.RTCSignalingChannel)){this.console.log("starting webrtc speaker intercom");const t=new _.RTCPeerConnection,r=new _.MediaStreamTrack({kind:"audio"}),i=t.addTransceiver(r),n=new A.WeriftSignalingSession(this.console,t),s=await this.mixinDevice.startRTCSignalingSession(n),o=await(0,b.createTrackForwarder)({timeStart:Date.now(),videoTransceiver:void 0,audioTransceiver:i,isPrivate:void 0,destinationId:void 0,ipv4:void 0,requestMediaStream:async()=>e,maximumCompatibilityMode:!1,clientOptions:void 0});return(0,w.waitClosed)(t).finally((()=>o.kill())),o.killPromise.finally((()=>t.close())),void o.killPromise.finally((()=>s.endSession()))}throw new Error("webrtc session not connected.")}{const t=await this.mixinDevice.createRTCSignalingSession();await(0,b.createRTCPeerConnectionSink)(t,this.console,void 0,e,this.plugin.storageSettings.values.maximumCompatibilityMode,this.plugin.getRTCConfiguration(),await this.plugin.getWeriftConfiguration())}}async stopIntercom(){if(this.webrtcIntercom){return(await this.webrtcIntercom).stopIntercom()}if(this.mixinDeviceInterfaces.includes(l.ScryptedInterface.Intercom))return this.mixinDevice.stopIntercom();throw new Error("webrtc session not connected.")}async startRTCSignalingSession(e){const t=await e.getOptions();if(this.mixinDeviceInterfaces.includes(l.ScryptedInterface.RTCSignalingChannel)&&!t?.proxy)return this.mixinDevice.startRTCSignalingSession(e);const r=T.getDeviceById(this.id),i=this.mixinDeviceInterfaces.includes(l.ScryptedInterface.Intercom),n=await k.createMediaObject((async e=>r.getVideoStream(e)),l.ScryptedMimeTypes.RequestMediaStream,{sourceId:r.id});return(0,b.createRTCPeerConnectionSink)(e,this.console,i?r:void 0,n,this.plugin.storageSettings.values.maximumCompatibilityMode,this.plugin.getRTCConfiguration(),await this.plugin.getWeriftConfiguration(t?.disableTurn),!0!==t?.requiresAnswer)}getMixinSettings(){return this.storageSettings.getSettings()}putMixinSetting(e,t){return this.storageSettings.putSetting(e,t)}createVideoStreamOptions(){const e=(0,E.getRTCMediaStreamOptions)("webrtc","WebRTC");return e.source="cloud",e}async getVideoStream(e){if(this.mixinDeviceInterfaces.includes(l.ScryptedInterface.VideoCamera)&&"webrtc"!==e?.id)return this.mixinDevice.getVideoStream(e);const{intercom:t,mediaObject:r,pcClose:i}=await(0,E.createRTCPeerConnectionSource)({console:this.console,mediaStreamOptions:this.createVideoStreamOptions(),channel:this.mixinDevice,maximumCompatibilityMode:this.plugin.storageSettings.values.maximumCompatibilityMode});return this.webrtcIntercom=t,i.finally((()=>this.webrtcIntercom=void 0)),r}async getVideoStreamOptions(){let e=[];return this.mixinDeviceInterfaces.includes(l.ScryptedInterface.VideoCamera)&&(e=await this.mixinDevice.getVideoStreamOptions()),e.push(this.createVideoStreamOptions()),e}}class x extends a.AutoenableMixinProvider{constructor(){super(),this.storageSettings=new f.StorageSettings(this,{maximumCompatibilityMode:{title:"Maximum Compatibility Mode",description:"Enables maximum compatibility with WebRTC clients by using the most conservative transcode options.",defaultValue:!1,type:"boolean"},iceInterfaceAddresses:{title:"ICE Interface Addresses",description:"The ICE interface addresses to bind and share with the peer.",choices:["Default","Scrypted Server Address","All Addresses"],defaultValue:"Default"},useTurnServer:{title:"Use TURN Servers",description:"Use a intermediary server to send video streams. Reduces performance and should only be used with restrictive NATs.",type:"boolean",defaultValue:!0},useIPv6:{title:"Use IPv6",description:"Use IPv6 addresses when connecting. This is disabled by default due to commonly misconfigured IPv6 local networks.",type:"boolean",defaultValue:!1},activeConnections:{readonly:!0,title:"Current Open Connections",description:"The WebRTC connections that are currently open.",onGet:async()=>({defaultValue:this.activeConnections})},rtcConfiguration:{title:"Custom Client RTC Configuration",type:"textarea",description:"RTCConfiguration that can be used to specify custom TURN and STUN servers. https://gist.github.com/koush/f7dafec7dbca04982a76db8243abc57e"},weriftConfiguration:{title:"Custom Server RTC Configuration",type:"textarea",description:"RTCConfiguration that can be used to specify custom TURN and STUN servers. https://gist.github.com/koush/631d38ac8647a86baaac7b22d863f010"},debugLog:{title:"Debug Log",type:"boolean"}}),this.activeConnections=0,this.unshiftMixin=!0,this.fromMimeType="*/*",this.toMimeType=l.ScryptedMimeTypes.RTCSignalingChannel,P.onDeviceDiscovered({name:"RTC Connection Bridge",type:l.ScryptedDeviceType.API,nativeId:b.RTC_BRIDGE_NATIVE_ID,interfaces:[l.ScryptedInterface.BufferConverter]}).then((()=>this.bridge=new B(this,b.RTC_BRIDGE_NATIVE_ID)))}getSettings(){return this.storageSettings.getSettings()}putSetting(e,t){return this.storageSettings.putSetting(e,t)}async convert(e,t,r,i){const n=this,s=P.getMixinConsole(i?.sourceId,this.nativeId);if(t===l.ScryptedMimeTypes.FFmpegInput){const t=JSON.parse(e.toString()),r=await k.createFFmpegMediaObject(t);class i{async startRTCSignalingSession(e){return(0,b.createRTCPeerConnectionSink)(e,s,void 0,r,n.storageSettings.values.maximumCompatibilityMode,n.getRTCConfiguration(),await n.getWeriftConfiguration())}}return new i}if(t===l.ScryptedMimeTypes.RequestMediaStream){const t=e,r=await k.createMediaObject(t,l.ScryptedMimeTypes.RequestMediaStream);class i{async startRTCSignalingSession(e){return(0,b.createRTCPeerConnectionSink)(e,s,void 0,r,n.storageSettings.values.maximumCompatibilityMode,n.getRTCConfiguration(),await n.getWeriftConfiguration())}}return new i}throw new Error(`@scrypted/webrtc is unable to convert ${t} to ${l.ScryptedMimeTypes.RTCSignalingChannel}`)}async canMixin(e,t){if(t.includes(l.ScryptedInterface.RTCSignalingChannel)||t.includes(l.ScryptedInterface.RTCSignalingClient)){const t=[l.ScryptedInterface.RTCSignalingChannel,l.ScryptedInterface.Settings];if(e===l.ScryptedDeviceType.Speaker)t.push(l.ScryptedInterface.Intercom);else if(e===l.ScryptedDeviceType.SmartSpeaker)t.push(l.ScryptedInterface.Intercom,l.ScryptedInterface.Microphone);else if(e===l.ScryptedDeviceType.Camera||e===l.ScryptedDeviceType.Doorbell)t.push(l.ScryptedInterface.VideoCamera,l.ScryptedInterface.Intercom);else if(e===l.ScryptedDeviceType.Display)t.push(l.ScryptedInterface.Intercom,l.ScryptedInterface.Display);else{if(e!==l.ScryptedDeviceType.SmartDisplay)return;t.push(l.ScryptedInterface.Intercom,l.ScryptedInterface.Microphone,l.ScryptedInterface.Display,l.ScryptedInterface.VideoCamera)}return t}if([l.ScryptedDeviceType.Camera,l.ScryptedDeviceType.Doorbell].includes(e)&&t.includes(l.ScryptedInterface.VideoCamera))return[l.ScryptedInterface.RTCSignalingChannel]}async getMixin(e,t,r){return new R(this,{mixinDevice:e,mixinDeviceInterfaces:t,mixinDeviceState:r,group:"WebRTC",groupKey:"webrtc",mixinProviderNativeId:this.nativeId})}async releaseMixin(e,t){await t.release()}async getCreateDeviceSettings(){return[{key:"name",title:"Name",description:"The name of the browser connected camera."}]}async createDevice(e){const t=p.default.randomBytes(8).toString("hex");return await P.onDeviceDiscovered({name:e.name?.toString(),type:l.ScryptedDeviceType.Camera,nativeId:t,interfaces:[l.ScryptedInterface.RTCSignalingClient,l.ScryptedInterface.Display,l.ScryptedInterface.Intercom,l.ScryptedInterface.VideoCamera]}),t}async getDevice(e){return e===b.RTC_BRIDGE_NATIVE_ID?this.bridge:new S.WebRTCCamera(this,e)}async releaseDevice(e,t){}getRTCConfiguration(){if(this.storageSettings.values.rtcConfiguration)try{return JSON.parse(this.storageSettings.values.rtcConfiguration)}catch(e){this.console.error("Custom RTC configuration failed. Invalid JSON?",e)}return{iceServers:this.storageSettings.values.useTurnServer?[v.turnServer]:[v.stunServer]}}async getWeriftConfiguration(e){let t;if(this.storageSettings.values.weriftConfiguration)try{t=JSON.parse(this.storageSettings.values.weriftConfiguration)}catch(e){this.console.error("Custom Werift configuration failed. Invalid JSON?",e)}const r=this.storageSettings.values.useTurnServer&&!e?[v.weriftStunServer,v.weriftTurnServer]:[v.weriftStunServer];let i;if("All Addresses"!==this.storageSettings.values.iceInterfaceAddresses)try{for(const e of await l.default.endpointManager.getLocalAddresses())y.default.isV4Format(e)?(i||={},i.udp4=e):y.default.isV6Format(e)&&(i||={},i.udp6=e)}catch(e){}return{iceUseIpv6:!1,iceServers:r,iceInterfaceAddresses:i,...t}}async onConnection(e,t){const r=new c.Deferred;r.promise.catch((e=>this.console.log("cleaning up rtc connection:",e.message)));const i=new WebSocket(t);if(r.promise.finally((()=>i.close())),e.isPublicEndpoint)return void i.close();const n=await(0,u.listenZeroSingleClient)();r.promise.finally((()=>{n.clientPromise.then((e=>e.destroy()))}));const s=await new Promise(((e,t)=>{const n=()=>{const e="Connection closed while waiting for message";t(new Error(e)),r.resolve(e)};i.addEventListener("close",n),i.onmessage=t=>{i.removeEventListener("close",n),e(JSON.parse(t.data))}}));s.username=e.username;const{connectionManagementId:o,updateSessionId:a}=s;o&&r.promise.finally((async()=>{(await T.getComponent("plugins")).setHostParam("@scrypted/webrtc",o)})),a&&r.promise.finally((async()=>{(await T.getComponent("plugins")).setHostParam("@scrypted/webrtc",a)}));try{const e=await(0,h.createBrowserSignalingSession)(i,"@scrypted/webrtc","remote"),t=await e.getOptions(),o=I();this.activeConnections++,o.worker.on("exit",(()=>{this.activeConnections--,r.resolve("worker exited")})),r.promise.finally((()=>{o.worker.terminate()}));const{createConnection:a}=await o.result,c=await a(s,n.port,e,this.storageSettings.values.maximumCompatibilityMode,t,{configuration:this.getRTCConfiguration(),weriftConfiguration:await this.getWeriftConfiguration()});r.promise.finally((()=>c.close().catch((()=>{})))),c.waitClosed().finally((()=>r.resolve("peer connection closed"))),await c.negotiateRTCSignalingSession();const u=await n.clientPromise;u.on("close",(()=>r.resolve("socket client closed"))),l.default.connect?l.default.connect(u,s):process.send(s,u)}catch(e){throw console.error("error negotiating browser RTCC signaling",e),r.resolve("error"),e}}}t.WebRTCPlugin=x,t.fork=async function(){return{async createConnection(e,t,r,i,n,s){const o=new c.Deferred;o.promise.catch((e=>this.console.log("cleaning up rtc connection:",e.message))),o.promise.finally((()=>setTimeout((()=>process.exit()),1e4)));const a=new b.WebRTCConnectionManagement(console,r,i,n,s),{pc:u}=a;(0,w.waitClosed)(u).then((()=>o.resolve("peer connection closed")));const{connectionManagementId:h,updateSessionId:d}=e;if(h||d){const e=await T.getComponent("plugins");h&&e.setHostParam("@scrypted/webrtc",h,a),d&&await e.setHostParam("@scrypted/webrtc",d,(e=>a.clientSession=e))}if(t){const e=m.default.connect(t,"127.0.0.1");o.promise.finally((()=>e.destroy()));const r=u.createDataChannel("rpc");r.message.subscribe((t=>e.write(t)));const i=new g.DataChannelDebouncer({send:e=>r.send(Buffer.from(e))},(t=>{this.console.error("datachannel send error",t),e.destroy()}));e.on("data",(e=>i.send(e))),e.on("close",(()=>o.resolve("socket closed"))),e.on("error",(()=>o.resolve("socket error")))}else u.createDataChannel("dummy");return a}}};class B extends l.ScryptedDeviceBase{constructor(e,t){super(t),this.plugin=e,this.fromMimeType=l.ScryptedMimeTypes.RTCSignalingSession,this.toMimeType=l.ScryptedMimeTypes.RTCConnectionManagement}async convert(e,t,r,i){const n=e,s=!!this.plugin.storageSettings.values.maximumCompatibilityMode,o=await n.getOptions(),a=I(),u=new c.Deferred;this.plugin.activeConnections++,a.worker.on("exit",(()=>{this.plugin.activeConnections--,u.resolve("worker exited")})),u.promise.finally((()=>{a.worker.terminate()}));const{createConnection:h}=await a.result,d=await h({},void 0,n,s,o,{configuration:this.plugin.getRTCConfiguration(),weriftConfiguration:await this.plugin.getWeriftConfiguration()});return u.promise.finally((()=>d.close().catch((()=>{})))),d.waitClosed().finally((()=>u.resolve("peer connection closed"))),await d.negotiateRTCSignalingSession(),await d.waitConnected(),d}}t.default=x},6895:(e,t)=>{"use strict";async function r(e,t){if(!t())return new Promise(((r,i)=>{const n=e.subscribe((()=>{try{t()&&(n.unSubscribe(),r(void 0))}catch(e){n.unSubscribe(),i(e)}}))}))}function i(e){return"closed"===e.connectionState||"disconnected"===e.connectionState||"failed"===e.connectionState}function n(e){return"disconnected"===e.iceConnectionState||"failed"===e.iceConnectionState||"closed"===e.iceConnectionState}Object.defineProperty(t,"__esModule",{value:!0}),t.logConnectionState=t.waitClosed=t.waitIceConnected=t.waitConnected=void 0,t.waitConnected=function(e){return r(e.connectionStateChange,(()=>{if(i(e))throw new Error("peer connection closed");return"connected"===e.connectionState}))},t.waitIceConnected=function(e){return r(e.iceConnectionStateChange,(()=>{if(n(e))throw new Error("peer ice connection closed");return"connected"===e.iceConnectionState||"completed"===e.iceConnectionState}))},t.waitClosed=function(e){return r(e.connectionStateChange,(()=>i(e)||n(e)))},t.logConnectionState=function(e,t){t.iceConnectionStateChange.subscribe((()=>e.log("iceConnectionState",t.iceConnectionState))),t.iceGatheringStateChange.subscribe((()=>e.log("iceGatheringState",t.iceGatheringState))),t.signalingStateChange.subscribe((()=>e.log("signalingState",t.signalingState))),t.connectionStateChange.subscribe((()=>e.log("connectionState",t.connectionState)))}},3915:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.startRtpForwarderProcess=void 0;const n=r(5948),s=r(6405),o=r(400),a=r(4921),c=r(7030),u=r(1853),h=i(r(7954)),d=i(r(2081)),{mediaManager:l}=h.default;function f(e){const t=e.onRtp;return e.onRtp=r=>{e.onRtp=t,e.firstPacket?.(r),e.onRtp(r)},t=>e.onRtp(t)}function p(e,t){t?.on("message",f(e))}async function y(e,t,r,i,n,s){try{if(!n){const r=await t.setup({type:"udp",path:i.control,onRtp:(e,t)=>s(t)});return e.log("rtsp/udp",i.codec,r),!1}}catch(e){if(!(e instanceof c.RtspStatusError))throw e}return await t.setup({type:"tcp",port:r,path:i.control,onRtp:(e,t)=>s(t)}),e.log("rtsp/tcp",i.codec),!0}function m(e,t){return"copy"===e||e&&e===t}t.startRtpForwarderProcess=async function(e,t,r,i){r.audio||delete r.audio,r.video||delete r.video;const h=new s.Deferred,g=e=>{const t=e?.onRtp;t&&(e.onRtp=e=>{if(h.finished)return;const r=127&e.readUint8(1);r>=72&&r<=76||t(e)})};g(r.video),g(r.audio);let b,{inputArguments:v,videoDecoderArguments:w}=t;h.promise.finally((()=>b?.safeTeardown()));let S=!1;const{rtspMode:_,onRtspClient:A,rtspClientForceTcp:E}=i||{},{video:C,audio:k}=r;r=Object.assign({},r);const T=C?.codecCopy,P=k?.codecCopy,I=await l.getFFmpegPath(),R=t.container?.startsWith("rtsp");let x;const B=new s.Deferred,O=new s.Deferred,M=new s.Deferred;O.promise.then((e=>C?.onMSection?.(e))),M.promise.then((e=>k?.onMSection?.(e)));let N=!1;if(t.url&&R&&m(T,t.mediaStreamOptions?.video?.codec)){delete r.video,b=new c.RtspClient(t.url),b.requestTimeout=1e4;try{const t=await b.options();x=(await b.describe()).body.toString();const i=(0,u.parseSdp)(x),s=i.msections.find((e=>"video"===e.type&&(e.codec===T||"copy"===T)));if(!s)throw new Error(`advertised video codec ${T} not found in sdp.`);O.resolve(s);let l=0;await y(e,b,l,s,E,f(C)),l+=2;const p=i.msections.find((e=>"audio"===e.type&&(e.codec===P||"copy"===P)));if(e.log("a/v",T,P,"found",s.codec,p?.codec),k)if(p&&m(P,p?.codec))delete r.audio,M.resolve(p),await y(e,b,l,p,E,f(k)),l+=2;else{const t=(0,u.parseSdp)(x);let i=t.msections.find((e=>"audio"===e.type&&e.codec===P));if(i||(i=t.msections.find((e=>"audio"===e.type))),i){t.msections=t.msections.filter((e=>e===i));const r=(0,u.addTrackControls)((0,u.replaceSectionPort)(t.toSdp(),"audio",0)),s=(0,u.parseSdp)(r).msections.find((e=>"audio"===e.type)).control;let f=!0,p=!1;const m=await y(e,b,l,i,!1,(t=>{if(f&&(f=!1,"aac"===i.codec)){const r=n.RtpPacket.deSerialize(t).payload;if(255==r[0]&&240==(240&r[1])){p=!0,N=!0;const t=["-hide_banner","-f","aac","-i","pipe:3",...k.encoderArguments,...k.outputArguments];(0,a.safePrintFFmpegArguments)(e,t);const r=d.default.spawn(I,t,{stdio:["pipe","pipe","pipe","pipe","pipe"]});(0,a.ffmpegLogInitialOutput)(e,r),h.promise.finally((()=>(0,a.safeKillFFmpeg)(r))),r.on("exit",(()=>h.resolve(void 0))),w=r.stdio[3]}}if(p){const e=n.RtpPacket.deSerialize(t);w?.write(e.payload)}else S?.sendTrack(s,t,!1)})),g=await(0,o.listenZeroSingleClient)();let w,S;h.promise.finally((()=>g.clientPromise.then((e=>e.destroy())))),g.clientPromise.then((async e=>{const t=new c.RtspServer(e,r,!m);h.promise.finally((()=>S.destroy())),await t.handlePlayback(),S=t})),k.ffmpegDestination="127.0.0.1",k.srtp=void 0,v=["-i",`rtsp://${g.host}:${g.port}`]}else delete r.audio,e.warn("audio section not found in sdp."),M.resolve(void 0)}else M.resolve(void 0);S=await(A?.(b,t)),S||await b.play()}catch(e){throw b.client.destroy(),e}}else e.log("video codec/container not matched, transcoding:",T);const D=e=>{B.resolve(e);const t=(0,u.parseSdp)(e),r=t.msections.find((e=>"video"===e.type)),i=t.msections.find((e=>"audio"===e.type));return O.resolve(r),M.resolve(i),{videoSection:r,audioSection:i}};await async function(e,t,r){for(const e of Object.keys(r)){const i=r[e];i.bind=await(0,o.createBindZero)(),i.bind.server.setRecvBufferSize(1048576);const{server:n,port:s}=i.bind;t.promise.finally((()=>(0,o.closeQuiet)(n)));const a=i.outputArguments=[];i.payloadType&&a.push("-payload_type",i.payloadType.toString()),i.ssrc&&a.push("-ssrc",i.ssrc.toString()),p(i,n)}}(0,h,r),b?.client.on("close",(()=>h.resolve(void 0)));const L=!_,U=new s.Deferred;let j;if(Object.keys(r).length){if(L){U.resolve(void 0);for(const e of Object.keys(r)){const t=r[e];let i=t.ffmpegDestination||"127.0.0.1";"127.0.0.1"===i&&(i=`${i}:${t.bind.port}`);const n=new URLSearchParams;let s=`rtp://${i}`;t.rtcpPort&&n.set("rtcpport",t.rtcpPort.toString()),t.packetSize&&n.set("pkt_size",t.packetSize.toString()),t.srtp&&(s=`s${s}`,t.outputArguments.push("-srtp_out_suite",t.srtp.crytoSuite,"-srtp_out_params",t.srtp.key.toString("base64"))),s=`${s}?${n}`,t.outputArguments.push("-dn","-sn"),"video"!==e&&t.outputArguments.push("-vn"),"audio"!==e&&t.outputArguments.push("-an"),t.outputArguments.push("-f","rtp"),t.outputArguments.push(s)}}const t=[];for(const e of Object.keys(r)){const i=r[e];t.push(...i.encoderArguments,...i.outputArguments)}const i=["-hide_banner",...w||[],...v,...t];if(L)i.push("-sdp_file","pipe:4");else{const t="udp"===_,n=await(0,o.listenZeroSingleClient)();i.push("-rtsp_transport",t?"udp":"tcp","-f","rtsp",`rtsp://127.0.0.1:${n.port}`),n.clientPromise.then((async i=>{i.on("close",(()=>h.resolve(void 0))),h.promise.finally((()=>i.destroy()));const n=new c.RtspServer(i,void 0,t);await n.handleSetup(["announce"]);const{videoSection:s,audioSection:o}=D(n.sdp);if(await n.handleSetup(),p(C,n.setupTracks[s?.control]?.rtp),p(k,n.setupTracks[o?.control]?.rtp),U.resolve(n),"pull"!==_){let t=!0,i=!0;for await(const a of n.handleRecord())a.type===s.codec?(t&&(t=!1,C.firstPacket?.(a.packet)),C.onRtp(a.packet)):a.type===o?.codec?(i&&(i=!1,r.audio.firstPacket?.(a.packet)),k.onRtp(a.packet)):e.warn("unexpected rtsp sample",a.type)}}))}(0,a.safePrintFFmpegArguments)(e,i),j=d.default.spawn(I,i,{stdio:["pipe","pipe","pipe","pipe","pipe","pipe"]}),h.promise.finally((()=>(0,a.safeKillFFmpeg)(j))),j.on("exit",(()=>{N||h.resolve(void 0)})),(0,a.ffmpegLogInitialOutput)(e,j),L&&j.stdio[4].on("data",(e=>{const t=e.toString();D(t)}))}else e.log("bypassing ffmpeg, perfect codecs"),B.resolve(x);return S||process.nextTick((()=>{b?.readLoop().catch((()=>{})).finally((()=>h.resolve(void 0)))})),{cp:j,rtspServer:U.promise,sdpContents:B.promise,videoSection:O.promise,audioSection:M.promise,kill:()=>h.resolve(void 0),killPromise:h.promise,get killed(){return h.finished}}}},8143:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ScryptedSessionControl=void 0;const n=r(6405),s=r(400),o=r(7030),a=r(1853),c=i(r(7954)),{mediaManager:u}=c.default;t.ScryptedSessionControl=class{constructor(e,t){this.intercom=e,this.audioTransceiver=t,this.killed=new n.Deferred}async setPlayback(e){if(!this.intercom)return;this.audioTransceiver.receiver.track||await this.audioTransceiver.onTrack.asPromise();const t=this.audioTransceiver.receiver.track;if(t.onReceiveRtp.allUnsubscribe(),await this.intercom.stopIntercom(),!e.audio)return;this.rtspServer?.client.destroy();const r=await(0,s.listenZeroSingleClient)(),i=r.url.replace("tcp:","rtsp:"),n={url:i,mediaStreamOptions:{id:void 0,video:null},inputArguments:["-rtsp_transport","udp","-i",i]},c=await u.createFFmpegMediaObject(n);await this.intercom.startIntercom(c);const h=await r.clientPromise;let d=["v=0","o=- 0 0 IN IP4 127.0.0.1","s=WebRTC Audio Talkback","c=IN IP4 127.0.0.1","t=0 0","m=audio 0 RTP/AVP 110","b=AS:24","a=rtpmap:110 opus/48000/2","a=fmtp:101 minptime=10;useinbandfec=1"].join("\r\n");d=(0,a.createSdpInput)(0,0,d);const l=new o.RtspServer(h,d,!0);this.rtspServer=l,await l.handlePlayback();const f=(0,a.parseSdp)(l.sdp).msections.find((e=>"audio"===e.type)).control;t.onReceiveRtp.subscribe((e=>{e.header.payloadType=110,l.sendTrack(f,e.serialize(),!1)}))}async getRefreshAt(){}async extendSession(){}async endSession(){this.rtspServer?.client.destroy(),this.killed.resolve(void 0)}}},3525:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebRTCCamera=void 0;const i=r(7954),n=r(4444);class s extends i.ScryptedDeviceBase{constructor(e,t){super(t),this.plugin=e}async startIntercom(e){const t=await this.intercom;if(!t)throw new Error("no webrtc session");return t.startIntercom(e)}async stopIntercom(){const e=await this.intercom;if(!e)throw new Error("no webrtc session");return e.stopIntercom()}async getVideoStream(e){const t=(0,n.getRTCMediaStreamOptions)("webrtc","WebRTC"),{mediaObject:r,intercom:i}=await(0,n.createRTCPeerConnectionSource)({console:this.console,mediaStreamOptions:t,channel:this,maximumCompatibilityMode:this.plugin.storageSettings.values.maximumCompatibilityMode});return this.intercom?.then((e=>e.stopIntercom())),this.intercom=i,r}async getVideoStreamOptions(){return[(0,n.getRTCMediaStreamOptions)("webrtc","WebRTC")]}async startRTCSignalingSession(e){if(!this.pendingClient)throw new Error('Browser client is not connected. Click "Stream Web Camera".');this.pendingClient(new class{async getOptions(){}createLocalDescription(t,r,i){return e.createLocalDescription(t,r,i)}setRemoteDescription(t,r){return e.setRemoteDescription(t,r)}addIceCandidate(t){return e.addIceCandidate(t)}}),this.pendingClient=void 0}createRTCSignalingSession(){return new Promise((e=>{this.pendingClient=e}))}}t.WebRTCCamera=s},8676:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFFmpegRtpAudioOutputArguments=t.getAudioCodec=t.requiredAudioCodecs=t.requiredVideoCodec=void 0;const i=r(4297);function n(e){return"PCMA"===e.name?{name:"pcm_alaw",encoder:"pcm_alaw"}:"PCMU"===e.name?{name:"pcm_mulaw",encoder:"pcm_mulaw"}:{name:"opus",encoder:"libopus"}}t.requiredVideoCodec=new i.RTCRtpCodecParameters({mimeType:"video/H264",clockRate:9e4,rtcpFeedback:[{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"},{type:"goog-remb"}],parameters:"level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f"}),t.requiredAudioCodecs=[new i.RTCRtpCodecParameters({mimeType:"audio/opus",clockRate:48e3,channels:2,payloadType:111}),new i.RTCRtpCodecParameters({mimeType:"audio/PCMU",clockRate:8e3,channels:1,payloadType:0}),new i.RTCRtpCodecParameters({mimeType:"audio/PCMA",clockRate:8e3,channels:1,payloadType:8})],t.getAudioCodec=n,t.getFFmpegRtpAudioOutputArguments=function(e,t,r){const i=[],{encoder:s,name:o}=n(t);return e!==o||r?(i.push("-acodec",s,"-flags","+global_header","-ar","48k","-b:a","40k","-bufsize","96k","-ac",t.channels.toString()),"libopus"===s&&i.push("-application","lowdelay")):i.push("-acodec","copy"),i}},6908:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WeriftSignalingSession=void 0;const i=r(4297),n=r(3540),s=r(5045);t.WeriftSignalingSession=class{constructor(e,t){this.console=e,this.pc=t}async getOptions(){}async createLocalDescription(e,t,r){let i;if(this.pc.onIceCandidate.subscribe((e=>{r?.({candidate:e.candidate,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex})})),"offer"===e){const e=await this.pc.createOffer();r?this.pc.setLocalDescription(e):await this.pc.setLocalDescription(e),i=(0,n.createRawResponse)(e)}else{r||await this.remoteDescription;const e=await this.pc.createAnswer();r?this.pc.setLocalDescription(e):await this.pc.setLocalDescription(e),i=(0,n.createRawResponse)(e)}return i}async setRemoteDescription(e,t){this.remoteDescription=this.pc.setRemoteDescription(e)}async addIceCandidate(e){e.candidate?.includes("relay")?await(0,s.sleep)(500):e.candidate?.includes("srflx")&&await(0,s.sleep)(250),await this.pc.addIceCandidate(new i.RTCIceCandidate(e))}}},3540:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.logIsPrivateIceTransport=t.isPrivateIceTransport=t.getWeriftIceServers=t.isPeerConnectionAlive=t.createRawResponse=void 0;const n=i(r(413));function s(e){let t,r=!0;for(const i of e.iceTransports){const[e,s]=i.connection.nominated[1].remoteAddr;t||(t=e),r=r&&n.default.isPrivate(e)}console.log("Connection is local network:",r);return{ipv4:n.default.isV4Format(t),isPrivate:r,destinationId:t}}t.createRawResponse=function(e){return{type:e.type,sdp:e.sdp}},t.isPeerConnectionAlive=function(e){return"disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState&&"closed"!==e.iceConnectionState&&("closed"!==e.connectionState&&"disconnected"!==e.connectionState&&"failed"!==e.connectionState)},t.getWeriftIceServers=function(e){if(!e?.iceServers)return;const t=[];for(const r of e.iceServers)if("string"==typeof r.urls)t.push({...r});else for(const e of r.urls)t.push(Object.assign({},r,{urls:e}));return t},t.isPrivateIceTransport=s,t.logIsPrivateIceTransport=function(e,t){const r=s(t);return e.log("ice transport",r),e.log("Connection is local network:",r.isPrivate),r}},4297:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(4664),t)},4444:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.getRTCMediaStreamOptions=t.createRTCPeerConnectionSource=void 0;const o=r(4297),a=r(3468),c=r(6405),u=r(400),h=r(7030),d=r(1853),l=s(r(7954)),f=r(6895),p=r(3915),y=r(8676),m=r(3540),{mediaManager:g}=l.default;t.createRTCPeerConnectionSource=async function(e){const{mediaStreamOptions:t,channel:r,console:i,maximumCompatibilityMode:n}=e,{clientPromise:s,port:b}=await(0,u.listenZeroSingleClient)(),v=Date.now(),w=new c.Deferred,S=new c.Deferred,_=new c.Deferred,A=()=>{i.log("webrtc/rtsp cleaning up"),s.then((e=>e.destroy())),w.promise.then((e=>e.endSession())),S.promise.then((e=>e.close())),_.promise.then((e=>e.stopIntercom()))};s.then((e=>e.on("close",A))),(async()=>{const e=await s,t=new h.RtspServer(e,void 0,!0);let c,u,b;const A=async e=>{(e=>{if(S.finished)return;const t=new o.RTCPeerConnection({bundlePolicy:e.configuration?.bundlePolicy,codecs:{audio:[...y.requiredAudioCodecs],video:[y.requiredVideoCodec]},iceServers:(0,m.getWeriftIceServers)(e.configuration)});(0,f.logConnectionState)(i,t),S.resolve(t)})(e);let r=!1,n=!1;const s=await S.promise;s.iceConnectionStateChange.subscribe((()=>{i.log("iceConnectionState",s.iceConnectionState)})),s.connectionStateChange.subscribe((()=>{i.log("connectionState",s.connectionState)}));const d=e=>{b=e,b.setDirection("sendrecv"),b.mid="0",b.onTrack.subscribe((e=>{e.onReceiveRtp.subscribe((e=>{r||(r=!0,i.log("first audio packet",Date.now()-v)),t.sendTrack(c,e.serialize(),!1)})),e.onReceiveRtcp.subscribe((e=>t.sendTrack(c,e.serialize(),!0)))}))},l=e=>{const r=e;r.mid="1",r.onTrack.subscribe((e=>{i.log("received video track"),e.onReceiveRtp.subscribe((e=>{if(!n){n=!0,i.log("first video packet",Date.now()-v);const t=(0,h.getNaluTypesInNalu)(e.payload);i.log("video packet types",...t)}t.sendTrack(u,e.serialize(),!1)})),e.onReceiveRtcp.subscribe((e=>t.sendTrack(u,e.serialize(),!0))),e.onReceiveRtp.once((()=>{let t=0;const i=setInterval((()=>{const i=new a.FullIntraRequest({senderSsrc:r.receiver.rtcpSsrc,mediaSsrc:e.ssrc,fir:[{sequenceNumber:t++,ssrc:e.ssrc}]}),n=new o.RtcpPayloadSpecificFeedback({feedback:i});r.receiver.dtlsTransport.sendRtcp([n]),r.receiver.sendRtcpPLI(e.ssrc)}),4e3);(0,f.waitClosed)(s).then((()=>clearInterval(i)))}))}))};"answer"!==e.type?(d(s.addTransceiver("audio",e.audio)),l(s.addTransceiver("video",e.video))):s.onTransceiverAdded.subscribe((e=>{"audio"===e.kind?d(e):"video"===e.kind&&l(e)}))},E=async e=>{if("answer"!==e.type)throw new Error("rtsp setup needs answer sdp");t.sdp=(0,d.createSdpInput)(0,0,e.sdp);const r=(0,d.parseSdp)(t.sdp);c=r.msections.find((e=>"audio"===e.type)).control,u=r.msections.find((e=>"video"===e.type)).control,await t.handlePlayback(),i.log("rtsp server playback started")};const C=new class{getOptions(){}async createLocalDescription(e,t,r){"offer"===e&&await A(t);const n=await S.promise;t.datachannel&&n.createDataChannel(t.datachannel.label,t.datachannel.dict);const s="complete"===n.iceGatheringState?Promise.resolve(void 0):new Promise((e=>n.iceGatheringStateChange.subscribe((t=>{"complete"===t&&e(void 0)}))));if(r&&(n.onicecandidate=e=>{i.log("sendIceCandidate",e.candidate.sdpMLineIndex,e.candidate.candidate),r({...e.candidate})}),"answer"===e){let e=await n.createAnswer();i.log("createLocalDescription",e.sdp);const t=(0,m.createRawResponse)(e);await E(t);const o=n.setLocalDescription(e);return r?t:(await o,await s,e=n.localDescription||e,(0,m.createRawResponse)(e))}{let e=await n.createOffer();i.log("createLocalDescription",e.sdp);const t=n.setLocalDescription(e);return r||(await t,await s,e=await n.createOffer()),(0,m.createRawResponse)(e)}}async setRemoteDescription(e,t){i.log("setRemoteDescription",e.sdp),"offer"===e.type?await A(t):await E(e);const r=await S.promise;await r.setRemoteDescription(e)}async addIceCandidate(e){i.log("addIceCandidate",e.sdpMLineIndex,e.candidate);const t=await S.promise;await t.addIceCandidate(e)}},k=await r.startRTCSignalingSession(C);w.resolve(k),i.log("waiting for peer connection");const T=await S.promise;let P;i.log("waiting for ice connected"),await(0,f.waitIceConnected)(T);const I=b.sender.sendRtp,R={async startIntercom(e){if(!(0,m.isPeerConnectionAlive)(T))throw new Error("peer connection is closed");if(!I)throw new Error("peer connection does not support two way audio");const t=await g.convertMediaObjectToJSON(e,l.ScryptedMimeTypes.FFmpegInput),{kill:r}=await(0,p.startRtpForwarderProcess)(i,t,{audio:{encoderArguments:(0,y.getFFmpegRtpAudioOutputArguments)(t.mediaStreamOptions?.audio?.codec,b.sender.codec,n),onRtp:e=>b.sender.sendRtp(e)}});R.stopIntercom(),P=r;(await w.promise).setPlayback({audio:!0,video:!1})},async stopIntercom(){P?.(),k.setPlayback({audio:!1,video:!1})}};_.resolve(R)})().catch((e=>{i.error("session start failed",e),w.reject(e),S.reject(e),_.reject(e),A()}));const E=S.promise.then((e=>(0,f.waitClosed)(e)));E.finally(A),S.promise.catch((e=>{i.error("failed to create webrtc signaling session",e),A()}));const C={url:`rtsp://127.0.0.1:${b}`,container:"rtsp",mediaStreamOptions:t};return{mediaObject:await g.createMediaObject(C,l.ScryptedMimeTypes.MediaStreamUrl),intercom:_.promise,pcClose:E}},t.getRTCMediaStreamOptions=function(e,t){return{id:e,name:t,tool:"scrypted",container:"rtsp",video:{codec:"h264"},audio:{}}}},1645:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createZygote=void 0;const n=i(r(7954)),s=i(r(1267));t.createZygote=function(){if(!s.default.isMainThread)return;let e=n.default.fork();const t=function*(){for(;;){const t=e;e=n.default.fork(),yield t}}();return()=>t.next().value}},7189:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.listenZeroSingleClient=t.listenZero=t.ListenZeroSingleClientTimeoutError=void 0;const n=r(2361),s=i(r(1808));class o extends Error{constructor(){super("timeout waiting for client")}}async function a(e,t){return e.listen(0,t),await(0,n.once)(e,"listening"),e.address().port}t.ListenZeroSingleClientTimeoutError=o,t.listenZero=a,t.listenZeroSingleClient=async function(e){const t=new s.default.Server,r=await a(t,e),i=new Promise(((e,r)=>{const i=setTimeout((()=>{t.close(),r(new o)}),3e4);t.on("connection",(r=>{t.close(),clearTimeout(i),e(r)}))}));i.catch((()=>{}));let n=e;return n&&"0.0.0.0"!==n||(n="127.0.0.1"),{server:t,url:`tcp://${n}:${r}`,host:n,port:r,clientPromise:i}}},1795:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.safePrintFFmpegArguments=t.ffmpegLogInitialOutput=t.safeKillFFmpeg=void 0;const n=i(r(7282)),s=["decode_slice_header error","no frame!","non-existing PPS"];t.safeKillFFmpeg=function(e){if(e){try{e.stdin.write("q\n")}catch(e){}setTimeout((()=>{for(const t of e.stdio)try{t?.destroy()}catch(e){}e.kill(),setTimeout((()=>{e.kill("SIGKILL")}),2e3)}),2e3)}},t.ffmpegLogInitialOutput=function(e,t,r,i){if(!e)return;const o=!!n.default.env.SCRYPTED_FFMPEG_NOISY||!!i?.getItem("SCRYPTED_FFMPEG_NOISY");function a(e){const i=n=>{const a=n.toString();for(const e of s)if(-1!==a.indexOf(e))return;if(!(o||r||-1===a.indexOf("frame=")&&-1===a.indexOf("size=")))return e(a),e("video/audio detected, discarding further input"),t.stdout.removeListener("data",i),void t.stderr.removeListener("data",i);e(a)};return i}t.stdout?.on("data",a(e.log)),t.stderr?.on("data",a(e.error)),t.on("exit",(()=>e.log("ffmpeg exited")))},t.safePrintFFmpegArguments=function(e,t){if(!e)return;const r=[];let i=!1;for(const e of t){try{if(i){const t=new URL(e);r.push(`${t.protocol}[REDACTED]`)}else r.push(e)}catch(t){r.push(e)}i="-i"===e}e.log(r.join(" "))}},9125:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SidebandBufferSerializer=t.BufferSerializer=void 0;class r{serialize(e){return e.toString("base64")}deserialize(e){return Buffer.from(e,"base64")}}t.BufferSerializer=r;t.SidebandBufferSerializer=class{constructor(){this.bufferSerializer=new r}serialize(e,t){if(!t)return this.bufferSerializer.serialize(e);const r=t.buffers=t.buffers||[];return r.push(e),r.length-1}deserialize(e,t){if(!t?.buffers)return this.bufferSerializer.deserialize(e);return t.buffers[e]}}},5191:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createRpcDuplexSerializer=t.createRpcSerializer=t.createDuplexRpcPeer=void 0;const i=r(9125),n=r(7169);function s(e){let t;const{sendMessageBuffer:r,sendMessageFinish:n}=e;let s=!0;let o={};return{kill:e=>{t.kill(e)},sendMessage:(e,t,i)=>{if(!s)return void t?.(new Error("peer disconnected"));const o=i?.buffers;if(o)for(const e of o)r(e);n(e)},setupRpcPeer:e=>{t=e,t.addSerializer(Buffer,"Buffer",new i.SidebandBufferSerializer),t.constructorSerializerMap.set(Uint8Array,"Buffer")},onMessageBuffer:e=>{o=o||{buffers:[]};o.buffers.push(e)},onMessageFinish:e=>{const r=o;o=void 0,t.handleMessage(e,r)},onDisconnected:()=>{s=!1,t.kill("connection closed.")}}}function o(e){const t=t=>r=>((t,r)=>{const i=Buffer.alloc(5);i.writeUInt32BE(r.length+1,0),i.writeUInt8(t,4),e.write(Buffer.concat([i,r]))})(t,r),r=t(1),i=t(0),n=s({sendMessageBuffer:r,sendMessageFinish:e=>i(Buffer.from(JSON.stringify(e)))});let o,a;const c=e=>{if(!a||a.length<e)return;const t=a.slice(0,e);return a=a.slice(e),a.length||(a=void 0),t};return{onData:e=>{for(a=a?Buffer.concat([a,e]):e;;){if(!o&&(o=c(5),!o))return;const e=o.readUInt32BE(0),t=o.readUInt8(4),r=c(e-1);if(!r)return;if(o=void 0,0===t)try{const e=JSON.parse(r.toString());n.onMessageFinish(e)}catch(e){n.kill("message parse failure "+e.message)}else n.onMessageBuffer(r)}},setupRpcPeer:n.setupRpcPeer,sendMessage:n.sendMessage,onDisconnected:n.onDisconnected}}t.createDuplexRpcPeer=function(e,t,r,i){const s=o(i),a=new n.RpcPeer(e,t,((e,t,i)=>{try{s.sendMessage(e,t,i)}catch(e){t?.(e),r.destroy()}}));return s.setupRpcPeer(a),r.on("data",(e=>s.onData(e))),r.on("close",s.onDisconnected),r.on("error",s.onDisconnected),a},t.createRpcSerializer=s,t.createRpcDuplexSerializer=o},7169:(module,exports,__webpack_require__)=>{"use strict";function startPeriodicGarbageCollection(){let e;global.gc||console.warn("rpc peer garbage collection not available: global.gc is not exposed.");try{e=global}catch(e){}let t=0;return setInterval((()=>{const r=Date.now(),i=r-t,n=RpcPeer.remotesCreated;RpcPeer.remotesCreated=0;const s=RpcPeer.remotesCollected;RpcPeer.remotesCollected=0,(n||s||i>3e5)&&(t=r,e?.gc?.())}),1e4)}module=__webpack_require__.nmd(module),Object.defineProperty(exports,"__esModule",{value:!0}),exports.getEvalSource=exports.RpcPeer=exports.RPCResultError=exports.startPeriodicGarbageCollection=void 0,exports.startPeriodicGarbageCollection=startPeriodicGarbageCollection;class RpcProxy{constructor(e,t,r,i,n){this.peer=e,this.entry=t,this.constructorName=r,this.proxyProps=i,this.proxyOneWayMethods=n}toPrimitive(){const e=this.peer;return`RpcProxy-${e.selfName}:${e.peerName}: ${this.constructorName}`}get(e,t,r){if(t===Symbol.asyncIterator){if(!this.proxyProps?.[Symbol.asyncIterator.toString()])return;return()=>new Proxy((()=>{}),this)}if(RpcProxy.iteratorMethods.has(t?.toString())){const e=this.proxyProps?.[Symbol.asyncIterator.toString()]?.[t];if(e)return new Proxy((()=>e),this)}if(t===RpcPeer.PROPERTY_PROXY_ID)return this.entry.id;if("__proxy_constructor"===t)return this.constructorName;if("__proxy_peer"===t)return this.peer;if(t===RpcPeer.PROPERTY_PROXY_PROPERTIES)return this.proxyProps;if(t===RpcPeer.PROPERTY_PROXY_ONEWAY_METHODS)return this.proxyOneWayMethods;if(t===RpcPeer.PROPERTY_JSON_DISABLE_SERIALIZATION||t===RpcPeer.PROPERTY_JSON_COPY_SERIALIZE_CHILDREN)return;if("then"===t)return;if("constructor"===t)return;if(void 0!==this.proxyProps?.[t])return this.proxyProps?.[t];const i=RpcPeer.handleFunctionInvocations(this,e,t,r);return i||new Proxy((()=>t),this)}set(e,t,r,i){return t===RpcPeer.finalizerIdSymbol?this.entry.finalizerId=r:(this.proxyProps||={},this.proxyProps[t]=r),!0}apply(e,t,r){const i=e()||null,n=this.proxyOneWayMethods?.includes?.(i);if(Object.isFrozen(this.peer.pendingResults))return n?Promise.resolve():Promise.reject(new RPCResultError(this.peer,"RpcPeer has been killed (apply) "+e()));const s=[],o={};for(const e of r||[])s.push(this.peer.serialize(e,o));const a={type:"apply",id:void 0,proxyId:this.entry.id,args:s,method:i};if(n)return a.oneway=!0,null===i&&delete a.method,this.peer.send(a,void 0,o),Promise.resolve();const c=this.peer.createPendingResult(((e,t)=>{a.id=e,this.peer.send(a,t,o)})),u=this.proxyProps?.[Symbol.asyncIterator.toString()];return!u||i!==u.next&&i!==u.return?c:c.then((e=>i===u.return?{done:!0,value:void 0}:{value:e,done:!1})).catch((e=>{if("StopAsyncIteration"===e.name)return{done:!0,value:void 0};throw e}))}}RpcProxy.iteratorMethods=new Set(["next","throw","return"]);class RPCResultError extends Error{constructor(e,t,r,i){super(`${t}\n${e.selfName}:${e.peerName}`),this.cause=r,i?.name&&(this.name=i?.name),i?.stack&&(this.stack=`${r?.stack||i.stack}\n${e.peerName}:${e.selfName}`)}}function compileFunction(code,params,options){params=params||[];const f=`(function(${params.join(",")}) {;${code};})`;return eval(f)}exports.RPCResultError=RPCResultError;try{const e=FinalizationRegistry}catch(e){window.WeakRef=class{constructor(e){this.target=e}deref(){return this.target}},window.FinalizationRegistry=class{register(){}}}class RpcPeer{static isRpcProxy(e){return!!e?.[RpcPeer.PROPERTY_PROXY_ID]}static getDefaultTransportSafeArgumentTypes(){const e=new Set;return e.add(Number.name),e.add(String.name),e.add(Object.name),e.add(Boolean.name),e.add(Array.name),e}static handleFunctionInvocations(e,t,r,i){return"apply"===r?(r,i)=>e.apply(t,e,i):"call"===r?(r,...i)=>e.apply(t,e,i):"toString"===r||r===Symbol.toPrimitive?(t,...r)=>e.toPrimitive():void 0}static getIteratorNext(e){if(!e[Symbol.asyncIterator])return;const t=e[this.PROPERTY_PROXY_PROPERTIES]?.[Symbol.asyncIterator.toString()];return t?.next||"next"}static prepareProxyProperties(e){let t=e?.[RpcPeer.PROPERTY_PROXY_PROPERTIES];return e[Symbol.asyncIterator]?(t||={},t[Symbol.asyncIterator.toString()]||(t[Symbol.asyncIterator.toString()]={next:"next",throw:"throw",return:"return"}),t):t}constructor(e,t,r){this.selfName=e,this.peerName=t,this.send=r,this.idCounter=1,this.params={},this.pendingResults={},this.proxyCounter=1,this.localProxied=new Map,this.localProxyMap=new Map,this.remoteWeakProxies={},this.finalizers=new FinalizationRegistry((e=>this.finalize(e))),this.nameDeserializerMap=new Map,this.onProxyTypeSerialization=new Map,this.constructorSerializerMap=new Map,this.transportSafeArgumentTypes=RpcPeer.getDefaultTransportSafeArgumentTypes(),this.tags={},this.killed=new Promise(((e,t)=>{this.killedDeferred={resolve:e,reject:t}})).catch((e=>e.message||"Unknown Error"))}static isTransportSafe(e){return!e||!e[RpcPeer.PROPERTY_JSON_DISABLE_SERIALIZATION]&&this.getDefaultTransportSafeArgumentTypes().has(e.constructor?.name)}isTransportSafe(e){return!e||!e[RpcPeer.PROPERTY_JSON_DISABLE_SERIALIZATION]&&this.transportSafeArgumentTypes.has(e.constructor?.name)}createPendingResult(e){if(Object.isFrozen(this.pendingResults))return Promise.reject(new RPCResultError(this,"RpcPeer has been killed (createPendingResult)"));const t=new Promise(((t,r)=>{const i=(this.idCounter++).toString();this.pendingResults[i]={resolve:t,reject:r},e(i,(e=>r(new RPCResultError(this,e.message,e))))}));return t.catch((()=>{})),t}kill(e){if(Object.isFrozen(this.pendingResults))return;const t=new RPCResultError(this,e||"peer was killed");this.killedDeferred.reject(t);for(const e of Object.values(this.pendingResults))e.reject(t);this.pendingResults=Object.freeze({}),this.params=Object.freeze({}),this.remoteWeakProxies=Object.freeze({}),this.localProxyMap.clear(),this.localProxied.clear()}addSerializer(e,t,r){this.nameDeserializerMap.set(t,r),this.constructorSerializerMap.set(e,t)}finalize(e){RpcPeer.remotesCollected++,delete this.remoteWeakProxies[e.id];const t={__local_proxy_id:e.id,__local_proxy_finalizer_id:e.finalizerId,type:"finalize"};this.send(t)}async getParam(e){return this.createPendingResult(((t,r)=>{const i={id:t,type:"param",param:e};this.send(i,r)}))}evalLocal(e,t,r){const i=Object.assign({},this.params,r);let n;try{n=module.require("vm").compileFunction}catch(e){n=compileFunction}return n(e,Object.keys(i),{filename:t})(...Object.values(i))}createErrorResult(e,t){e.result=this.serializeError(t),e.throw=!0,e.message=t.message||"no message",e.stack=t.stack||"no stack"}deserialize(e,t){if(!e)return e;if(e[RpcPeer.PROPERTY_JSON_COPY_SERIALIZE_CHILDREN]){const r={};for(const[i,n]of Object.entries(e))r[i]=this.deserialize(n,t);return r}const{__remote_proxy_id:r,__remote_proxy_finalizer_id:i,__local_proxy_id:n,__remote_constructor_name:s,__serialized_value:o,__remote_proxy_props:a,__remote_proxy_oneway_methods:c}=e;if(s===RpcPeer.RPC_RESULT_ERROR_NAME)return this.deserializeError(o);if(r){let e=this.remoteWeakProxies[r]?.deref();e||(e=this.newProxy(r,s,a,c)),e[RpcPeer.finalizerIdSymbol]=i;const n=this.nameDeserializerMap.get(s);return n?n.deserialize(e,t):e}if(n){const e=this.localProxyMap.get(n);if(!e)throw new RPCResultError(this,`invalid local proxy id ${n}`);return e}const u=this.nameDeserializerMap.get(s);return u?u.deserialize(o,t):e}deserializeError(e){const{name:t,stack:r,message:i}=e;return new RPCResultError(this,i,void 0,{name:t,stack:r})}serializeError(e){const t={stack:e.stack||"[no stack]",name:e.name||"[no name]",message:e.message||"[no message]"};return{__remote_constructor_name:RpcPeer.RPC_RESULT_ERROR_NAME,__remote_proxy_id:void 0,__remote_proxy_finalizer_id:void 0,__remote_proxy_oneway_methods:void 0,__remote_proxy_props:void 0,__serialized_value:t}}serialize(e,t){if(!0===e?.[RpcPeer.PROPERTY_JSON_COPY_SERIALIZE_CHILDREN]){const r={};for(const[i,n]of Object.entries(e))r[i]=this.serialize(n,t);return r}if(this.isTransportSafe(e))return e;let r=e.__proxy_constructor||e.constructor?.name?.toString();if(e instanceof Error)return this.serializeError(e);const i=this.constructorSerializerMap.get(e.constructor);if(i){r=i;const n=this.nameDeserializerMap.get(i);if(!n)throw new Error("serializer not found for "+i);const s=n.serialize(e,t);return{__remote_proxy_id:void 0,__remote_proxy_finalizer_id:void 0,__remote_constructor_name:r,__remote_proxy_props:RpcPeer.prepareProxyProperties(e),__remote_proxy_oneway_methods:e?.[RpcPeer.PROPERTY_PROXY_ONEWAY_METHODS],__serialized_value:s}}let n=this.localProxied.get(e);if(n){const t=(this.proxyCounter++).toString();n.finalizerId=t;return{__remote_proxy_id:n.id,__remote_proxy_finalizer_id:t,__remote_constructor_name:r,__remote_proxy_props:RpcPeer.prepareProxyProperties(e),__remote_proxy_oneway_methods:e?.[RpcPeer.PROPERTY_PROXY_ONEWAY_METHODS]}}const{__proxy_id:s,__proxy_peer:o}=e;if(s&&o===this){return{__local_proxy_id:s}}this.onProxyTypeSerialization.get(r)?.(e);const a=(this.proxyCounter++).toString();n={id:a,finalizerId:a},this.localProxied.set(e,n),this.localProxyMap.set(a,e);return{__remote_proxy_id:a,__remote_proxy_finalizer_id:a,__remote_constructor_name:r,__remote_proxy_props:this.onProxySerialization?this.onProxySerialization(e,a):RpcPeer.prepareProxyProperties(e),__remote_proxy_oneway_methods:e?.[RpcPeer.PROPERTY_PROXY_ONEWAY_METHODS]}}newProxy(e,t,r,i){RpcPeer.remotesCreated++;const n={id:e,finalizerId:void 0},s=new RpcProxy(this,n,t,r,i),o=new Proxy("Function"===t||"AsyncFunction"===t?function(){}:s,s),a=new WeakRef(o);return this.remoteWeakProxies[e]=a,this.finalizers.register(s,n),o}handleMessage(e,t){try{RpcPeer.activeRpcPeer=this,this.handleMessageInternal(e,t)}finally{RpcPeer.activeRpcPeer=void 0}}async handleMessageInternal(e,t){if(!Object.isFrozen(this.pendingResults))try{switch(e.type){case"param":{const t=e,r={};let i;try{i={type:"result",id:t.id,result:this.serialize(this.params[t.param],r)}}catch(e){this.createErrorResult(i,e)}this.send(i,void 0,r);break}case"apply":{const r=e,i={type:"result",id:r.id||""},n={};try{const e=this.localProxyMap.get(r.proxyId);if(!e)throw new Error(`proxy id ${r.proxyId} not found`);const s=[];for(const e of r.args||[])s.push(this.deserialize(e,t));let o;if(r.method){if(!e[r.method])throw new Error(`target ${e?.constructor?.name} does not have method ${r.method}`);if(o=await e[r.method](...s),RpcPeer.getIteratorNext(e)===r.method){if(o.done){throw{name:"StopAsyncIteration",message:void 0}}o=o.value}}else o=await e(...s);i.result=this.serialize(o,n)}catch(e){this.createErrorResult(i,e)}r.oneway||this.send(i,void 0,n);break}case"result":{const r=e,i=this.pendingResults[r.id];if(delete this.pendingResults[r.id],!i)throw new Error(`unknown result ${r.id}`);if((r.message||r.stack)&&!r.throw){const e=new RPCResultError(this,r.message||"no message",void 0,{name:r.result,stack:r.stack});return void i.reject(e)}const n=this.deserialize(r.result,t);r.throw?i.reject(n):i.resolve(n);break}case"finalize":{const t=e,r=this.localProxyMap.get(t.__local_proxy_id);if(r){const e=this.localProxied.get(r);if(t.__local_proxy_finalizer_id&&t.__local_proxy_finalizer_id!==e?.finalizerId)break;this.localProxyMap.delete(t.__local_proxy_id),this.localProxied.delete(r)}break}default:throw new Error(`unknown rpc message type ${e.type}`)}}catch(e){return void console.error("unhandled rpc error",this.peerName,e)}}}function getEvalSource(){return`\n    (() => {\n        ${RpcProxy}\n\n        ${RpcPeer}\n\n        ${startPeriodicGarbageCollection}\n    \n        return {\n            startPeriodicGarbageCollection,\n            RpcPeer,\n            RpcProxy,\n        };\n    })();\n    `}exports.RpcPeer=RpcPeer,RpcPeer.finalizerIdSymbol=Symbol("rpcFinalizerId"),RpcPeer.remotesCollected=0,RpcPeer.remotesCreated=0,RpcPeer.RPC_RESULT_ERROR_NAME="RPCResultError",RpcPeer.PROPERTY_PROXY_ID="__proxy_id",RpcPeer.PROPERTY_PROXY_ONEWAY_METHODS="__proxy_oneway_methods",RpcPeer.PROPERTY_JSON_DISABLE_SERIALIZATION="__json_disable_serialization",RpcPeer.PROPERTY_PROXY_PROPERTIES="__proxy_props",RpcPeer.PROPERTY_JSON_COPY_SERIALIZE_CHILDREN="__json_copy_serialize_children",RpcPeer.PROBED_PROPERTIES=new Set(["then","constructor","__proxy_id","__proxy_constructor","__proxy_peer",RpcPeer.PROPERTY_PROXY_ONEWAY_METHODS,RpcPeer.PROPERTY_JSON_DISABLE_SERIALIZATION,RpcPeer.PROPERTY_PROXY_PROPERTIES,RpcPeer.PROPERTY_JSON_COPY_SERIALIZE_CHILDREN]),exports.getEvalSource=getEvalSource},9413:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sleep=void 0,t.sleep=async function(e){await new Promise((t=>setTimeout(t,e)))}},4300:e=>{"use strict";e.exports=require("buffer")},2081:e=>{"use strict";e.exports=require("child_process")},6113:e=>{"use strict";e.exports=require("crypto")},1891:e=>{"use strict";e.exports=require("dgram")},2361:e=>{"use strict";e.exports=require("events")},3292:e=>{"use strict";e.exports=require("fs/promises")},1808:e=>{"use strict";e.exports=require("net")},2037:e=>{"use strict";e.exports=require("os")},4074:e=>{"use strict";e.exports=require("perf_hooks")},7282:e=>{"use strict";e.exports=require("process")},2781:e=>{"use strict";e.exports=require("stream")},5356:e=>{"use strict";e.exports=require("stream/web")},8670:e=>{"use strict";e.exports=require("timers/promises")},4404:e=>{"use strict";e.exports=require("tls")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},1267:e=>{"use strict";e.exports=require("worker_threads")},8257:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p});var i=r(2037);function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function o(e){var t="function"==typeof Map?new Map:void 0;return o=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return a(e,arguments,h(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),u(i,e)},o(e)}function a(e,t,r){return a=c()?Reflect.construct:function(e,t,r){var i=[null];i.push.apply(i,t);var n=new(Function.bind.apply(e,i));return r&&u(n,r.prototype),n},a.apply(null,arguments)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}let d=function(e){function t(e,r,...i){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e instanceof Array||(i=(void 0===r?[]:[r]).concat(i),r=e,e=[]),(n=function(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?s(e):t}(this,h(t).call(this,r))).code=r||"E_UNEXPECTED",n.params=i,n.wrappedErrors=e,n.name=n.toString(),Error.captureStackTrace&&Error.captureStackTrace(s(n),n.constructor),n}var r,o,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,e),r=t,(o=[{key:"toString",value:function(){return(this.wrappedErrors.length?this.wrappedErrors[this.wrappedErrors.length-1].stack+i.EOL:"")+this.constructor.name+": "+this.code+" ("+this.params.join(", ")+")"}}])&&n(r.prototype,o),a&&n(r,a),t}(o(Error));function l(e){return e instanceof d||e.constructor&&e.constructor.name&&e.constructor.name.endsWith("Error")&&"string"==typeof e.code&&f(e.code)&&e.params&&e.params instanceof Array}function f(e){return/^([A-Z0-9_]+)$/.test(e)}d.wrap=function(e,t,...r){let i=null;const n=f(e.message),s=(e.wrappedErrors||[]).concat(e);return t||(t=n?e.message:"E_UNEXPECTED"),e.message&&!n&&r.push(e.message),i=new d(s,t,...r),i},d.cast=function(e,...t){return l(e)?e:d.wrap.apply(d,[e].concat(t))},d.bump=function(e,...t){return l(e)?d.wrap.apply(d,[e,e.code].concat(e.params)):d.wrap.apply(d,[e].concat(t))};const p=d},9813:e=>{"use strict";e.exports={i8:"6.5.4"}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e].call(r.exports,r,r.exports,__webpack_require__),r.loaded=!0,r.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var __webpack_exports__=__webpack_require__(6360),__webpack_export_target__=exports="undefined"==typeof exports?{}:exports;for(var i in __webpack_exports__)__webpack_export_target__[i]=__webpack_exports__[i];__webpack_exports__.__esModule&&Object.defineProperty(__webpack_export_target__,"__esModule",{value:!0})})();
//# sourceMappingURL=main.nodejs.js.map