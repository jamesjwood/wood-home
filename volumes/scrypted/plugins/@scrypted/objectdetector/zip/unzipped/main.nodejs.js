(()=>{var e={1017:e=>{"use strict";function t(e,t,i,r,n,s){return(e<=n||i<=n)&&(n<=e||n<=i)&&(t<=s||r<=s)&&(s<=t||s<=r)}function i(e,t,i,r,n,s){var o=(n-e)*(r-t),a=(i-e)*(s-t);return o<a?-1:o>a?1:0}e.exports&&(e.exports=function(e,r,n,s,o,a,c,l){var h=i(o,a,c,l,e,r),p=i(o,a,c,l,n,s),u=i(e,r,n,s,o,a),d=i(e,r,n,s,c,l);return(h>0&&p<0||h<0&&p>0)&&(u>0&&d<0||u<0&&d>0)||0===h&&t(o,a,c,l,e,r)||0===p&&t(o,a,c,l,n,s)||0===u&&t(e,r,n,s,o,a)||0===d&&t(e,r,n,s,c,l)})},9593:(e,t,i)=>{"use strict";const r=i(4411),n=Symbol("max"),s=Symbol("length"),o=Symbol("lengthCalculator"),a=Symbol("allowStale"),c=Symbol("maxAge"),l=Symbol("dispose"),h=Symbol("noDisposeOnSet"),p=Symbol("lruList"),u=Symbol("cache"),d=Symbol("updateAgeOnGet"),m=()=>1;const g=(e,t,i)=>{const r=e[u].get(t);if(r){const t=r.value;if(f(e,t)){if(S(e,r),!e[a])return}else i&&(e[d]&&(r.value.now=Date.now()),e[p].unshiftNode(r));return t.value}},f=(e,t)=>{if(!t||!t.maxAge&&!e[c])return!1;const i=Date.now()-t.now;return t.maxAge?i>t.maxAge:e[c]&&i>e[c]},v=e=>{if(e[s]>e[n])for(let t=e[p].tail;e[s]>e[n]&&null!==t;){const i=t.prev;S(e,t),t=i}},S=(e,t)=>{if(t){const i=t.value;e[l]&&e[l](i.key,i.value),e[s]-=i.length,e[u].delete(i.key),e[p].removeNode(t)}};class y{constructor(e,t,i,r,n){this.key=e,this.value=t,this.length=i,this.now=r,this.maxAge=n||0}}const E=(e,t,i,r)=>{let n=i.value;f(e,n)&&(S(e,i),e[a]||(n=void 0)),n&&t.call(r,n.value,n.key,e)};e.exports=class{constructor(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw new TypeError("max must be a non-negative number");this[n]=e.max||1/0;const t=e.length||m;if(this[o]="function"!=typeof t?m:t,this[a]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw new TypeError("maxAge must be a number");this[c]=e.maxAge||0,this[l]=e.dispose,this[h]=e.noDisposeOnSet||!1,this[d]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[n]=e||1/0,v(this)}get max(){return this[n]}set allowStale(e){this[a]=!!e}get allowStale(){return this[a]}set maxAge(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[c]=e,v(this)}get maxAge(){return this[c]}set lengthCalculator(e){"function"!=typeof e&&(e=m),e!==this[o]&&(this[o]=e,this[s]=0,this[p].forEach((e=>{e.length=this[o](e.value,e.key),this[s]+=e.length}))),v(this)}get lengthCalculator(){return this[o]}get length(){return this[s]}get itemCount(){return this[p].length}rforEach(e,t){t=t||this;for(let i=this[p].tail;null!==i;){const r=i.prev;E(this,e,i,t),i=r}}forEach(e,t){t=t||this;for(let i=this[p].head;null!==i;){const r=i.next;E(this,e,i,t),i=r}}keys(){return this[p].toArray().map((e=>e.key))}values(){return this[p].toArray().map((e=>e.value))}reset(){this[l]&&this[p]&&this[p].length&&this[p].forEach((e=>this[l](e.key,e.value))),this[u]=new Map,this[p]=new r,this[s]=0}dump(){return this[p].map((e=>!f(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)})).toArray().filter((e=>e))}dumpLru(){return this[p]}set(e,t,i){if((i=i||this[c])&&"number"!=typeof i)throw new TypeError("maxAge must be a number");const r=i?Date.now():0,a=this[o](t,e);if(this[u].has(e)){if(a>this[n])return S(this,this[u].get(e)),!1;const o=this[u].get(e).value;return this[l]&&(this[h]||this[l](e,o.value)),o.now=r,o.maxAge=i,o.value=t,this[s]+=a-o.length,o.length=a,this.get(e),v(this),!0}const d=new y(e,t,a,r,i);return d.length>this[n]?(this[l]&&this[l](e,t),!1):(this[s]+=d.length,this[p].unshift(d),this[u].set(e,this[p].head),v(this),!0)}has(e){if(!this[u].has(e))return!1;const t=this[u].get(e).value;return!f(this,t)}get(e){return g(this,e,!0)}peek(e){return g(this,e,!1)}pop(){const e=this[p].tail;return e?(S(this,e),e.value):null}del(e){S(this,this[u].get(e))}load(e){this.reset();const t=Date.now();for(let i=e.length-1;i>=0;i--){const r=e[i],n=r.e||0;if(0===n)this.set(r.k,r.v);else{const e=n-t;e>0&&this.set(r.k,r.v,e)}}}prune(){this[u].forEach(((e,t)=>g(this,t,!1)))}}},88:e=>{"use strict";e.exports&&(e.exports=function(e,t){var i,r,n=!1,s=t.length;for(i=0,r=s-1;i<s;r=i++)t[i][1]>e[1]!=t[r][1]>e[1]&&e[0]<(t[r][0]-t[i][0])*(e[1]-t[i][1])/(t[r][1]-t[i][1])+t[i][0]&&(n=!n);return n})},8098:(e,t,i)=>{"use strict";var r=i(1017),n=i(1118);e.exports&&(e.exports=function(e,t){return!!function(e,t){var i;for(i=0;i<e.length;i+=1)if(n(e[i],t))return!0;for(i=0;i<t.length;i+=1)if(n(t[i],e))return!0;return!1}(e,t)||!!function(e,t){for(var i=0;i<e.length-1;i+=1)for(var n=0;n<t.length-1;n+=1)if(r(e[i][0],e[i][1],e[i+1][0],e[i+1][1],t[n][0],t[n][1],t[n+1][0],t[n+1][1]))return!0;return!1}(e,t)})},1118:e=>{"use strict";e.exports&&(e.exports=function(e,t){var i,r,n=!1,s=t.length;for(i=0,r=s-1;i<s;r=i++)t[i][1]>e[1]!=t[r][1]>e[1]&&e[0]<(t[r][0]-t[i][0])*(e[1]-t[i][1])/(t[r][1]-t[i][1])+t[i][0]&&(n=!n);return n})},2257:(e,t,i)=>{const r=Symbol("SemVer ANY");class n{static get ANY(){return r}constructor(e,t){if(t=s(t),e instanceof n){if(e.loose===!!t.loose)return e;e=e.value}l("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===r?this.value="":this.value=this.operator+this.semver.version,l("comp",this)}parse(e){const t=this.options.loose?o[a.COMPARATORLOOSE]:o[a.COMPARATOR],i=e.match(t);if(!i)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==i[1]?i[1]:"","="===this.operator&&(this.operator=""),i[2]?this.semver=new h(i[2],this.options.loose):this.semver=r}toString(){return this.value}test(e){if(l("Comparator.test",e,this.options.loose),this.semver===r||e===r)return!0;if("string"==typeof e)try{e=new h(e,this.options)}catch(e){return!1}return c(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof n))throw new TypeError("a Comparator is required");if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return""===this.value||new p(e.value,t).test(this.value);if(""===e.operator)return""===e.value||new p(this.value,t).test(e.semver);const i=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),r=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),s=this.semver.version===e.semver.version,o=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),a=c(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),l=c(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return i||r||s&&o||a||l}}e.exports=n;const s=i(2893),{re:o,t:a}=i(5765),c=i(7539),l=i(4225),h=i(6376),p=i(6902)},6902:(e,t,i)=>{class r{constructor(e,t){if(t=s(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof o)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split("||").map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!m(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&g(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map((e=>e.join(" ").trim())).join("||").trim(),this.range}toString(){return this.range}parseRange(e){e=e.trim();const t=`parseRange:${Object.keys(this.options).join(",")}:${e}`,i=n.get(t);if(i)return i;const r=this.options.loose,s=r?l[h.HYPHENRANGELOOSE]:l[h.HYPHENRANGE];e=e.replace(s,T(this.options.includePrerelease)),a("hyphen replace",e),e=e.replace(l[h.COMPARATORTRIM],p),a("comparator trim",e);let c=(e=(e=(e=e.replace(l[h.TILDETRIM],u)).replace(l[h.CARETTRIM],d)).split(/\s+/).join(" ")).split(" ").map((e=>v(e,this.options))).join(" ").split(/\s+/).map((e=>x(e,this.options)));r&&(c=c.filter((e=>(a("loose invalid filter",e,this.options),!!e.match(l[h.COMPARATORLOOSE]))))),a("range list",c);const g=new Map,f=c.map((e=>new o(e,this.options)));for(const e of f){if(m(e))return[e];g.set(e.value,e)}g.size>1&&g.has("")&&g.delete("");const S=[...g.values()];return n.set(t,S),S}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some((i=>f(i,t)&&e.set.some((e=>f(e,t)&&i.every((i=>e.every((e=>i.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new c(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(R(this.set[t],e,this.options))return!0;return!1}}e.exports=r;const n=new(i(9593))({max:1e3}),s=i(2893),o=i(2257),a=i(4225),c=i(6376),{re:l,t:h,comparatorTrimReplace:p,tildeTrimReplace:u,caretTrimReplace:d}=i(5765),m=e=>"<0.0.0-0"===e.value,g=e=>""===e.value,f=(e,t)=>{let i=!0;const r=e.slice();let n=r.pop();for(;i&&r.length;)i=r.every((e=>n.intersects(e,t))),n=r.pop();return i},v=(e,t)=>(a("comp",e,t),e=I(e,t),a("caret",e),e=y(e,t),a("tildes",e),e=O(e,t),a("xrange",e),e=b(e,t),a("stars",e),e),S=e=>!e||"x"===e.toLowerCase()||"*"===e,y=(e,t)=>e.trim().split(/\s+/).map((e=>E(e,t))).join(" "),E=(e,t)=>{const i=t.loose?l[h.TILDELOOSE]:l[h.TILDE];return e.replace(i,((t,i,r,n,s)=>{let o;return a("tilde",e,t,i,r,n,s),S(i)?o="":S(r)?o=`>=${i}.0.0 <${+i+1}.0.0-0`:S(n)?o=`>=${i}.${r}.0 <${i}.${+r+1}.0-0`:s?(a("replaceTilde pr",s),o=`>=${i}.${r}.${n}-${s} <${i}.${+r+1}.0-0`):o=`>=${i}.${r}.${n} <${i}.${+r+1}.0-0`,a("tilde return",o),o}))},I=(e,t)=>e.trim().split(/\s+/).map((e=>D(e,t))).join(" "),D=(e,t)=>{a("caret",e,t);const i=t.loose?l[h.CARETLOOSE]:l[h.CARET],r=t.includePrerelease?"-0":"";return e.replace(i,((t,i,n,s,o)=>{let c;return a("caret",e,t,i,n,s,o),S(i)?c="":S(n)?c=`>=${i}.0.0${r} <${+i+1}.0.0-0`:S(s)?c="0"===i?`>=${i}.${n}.0${r} <${i}.${+n+1}.0-0`:`>=${i}.${n}.0${r} <${+i+1}.0.0-0`:o?(a("replaceCaret pr",o),c="0"===i?"0"===n?`>=${i}.${n}.${s}-${o} <${i}.${n}.${+s+1}-0`:`>=${i}.${n}.${s}-${o} <${i}.${+n+1}.0-0`:`>=${i}.${n}.${s}-${o} <${+i+1}.0.0-0`):(a("no pr"),c="0"===i?"0"===n?`>=${i}.${n}.${s}${r} <${i}.${n}.${+s+1}-0`:`>=${i}.${n}.${s}${r} <${i}.${+n+1}.0-0`:`>=${i}.${n}.${s} <${+i+1}.0.0-0`),a("caret return",c),c}))},O=(e,t)=>(a("replaceXRanges",e,t),e.split(/\s+/).map((e=>M(e,t))).join(" ")),M=(e,t)=>{e=e.trim();const i=t.loose?l[h.XRANGELOOSE]:l[h.XRANGE];return e.replace(i,((i,r,n,s,o,c)=>{a("xRange",e,i,r,n,s,o,c);const l=S(n),h=l||S(s),p=h||S(o),u=p;return"="===r&&u&&(r=""),c=t.includePrerelease?"-0":"",l?i=">"===r||"<"===r?"<0.0.0-0":"*":r&&u?(h&&(s=0),o=0,">"===r?(r=">=",h?(n=+n+1,s=0,o=0):(s=+s+1,o=0)):"<="===r&&(r="<",h?n=+n+1:s=+s+1),"<"===r&&(c="-0"),i=`${r+n}.${s}.${o}${c}`):h?i=`>=${n}.0.0${c} <${+n+1}.0.0-0`:p&&(i=`>=${n}.${s}.0${c} <${n}.${+s+1}.0-0`),a("xRange return",i),i}))},b=(e,t)=>(a("replaceStars",e,t),e.trim().replace(l[h.STAR],"")),x=(e,t)=>(a("replaceGTE0",e,t),e.trim().replace(l[t.includePrerelease?h.GTE0PRE:h.GTE0],"")),T=e=>(t,i,r,n,s,o,a,c,l,h,p,u,d)=>`${i=S(r)?"":S(n)?`>=${r}.0.0${e?"-0":""}`:S(s)?`>=${r}.${n}.0${e?"-0":""}`:o?`>=${i}`:`>=${i}${e?"-0":""}`} ${c=S(l)?"":S(h)?`<${+l+1}.0.0-0`:S(p)?`<${l}.${+h+1}.0-0`:u?`<=${l}.${h}.${p}-${u}`:e?`<${l}.${h}.${+p+1}-0`:`<=${c}`}`.trim(),R=(e,t,i)=>{for(let i=0;i<e.length;i++)if(!e[i].test(t))return!1;if(t.prerelease.length&&!i.includePrerelease){for(let i=0;i<e.length;i++)if(a(e[i].semver),e[i].semver!==o.ANY&&e[i].semver.prerelease.length>0){const r=e[i].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0}},6376:(e,t,i)=>{const r=i(4225),{MAX_LENGTH:n,MAX_SAFE_INTEGER:s}=i(3295),{re:o,t:a}=i(5765),c=i(2893),{compareIdentifiers:l}=i(6742);class h{constructor(e,t){if(t=c(t),e instanceof h){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid Version: ${e}`);if(e.length>n)throw new TypeError(`version is longer than ${n} characters`);r("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const i=e.trim().match(t.loose?o[a.LOOSE]:o[a.FULL]);if(!i)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>s||this.major<0)throw new TypeError("Invalid major version");if(this.minor>s||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>s||this.patch<0)throw new TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<s)return t}return e})):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(r("SemVer.compare",this.version,this.options,e),!(e instanceof h)){if("string"==typeof e&&e===this.version)return 0;e=new h(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof h||(e=new h(e,this.options)),l(this.major,e.major)||l(this.minor,e.minor)||l(this.patch,e.patch)}comparePre(e){if(e instanceof h||(e=new h(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const i=this.prerelease[t],n=e.prerelease[t];if(r("prerelease compare",t,i,n),void 0===i&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===i)return-1;if(i!==n)return l(i,n)}while(++t)}compareBuild(e){e instanceof h||(e=new h(e,this.options));let t=0;do{const i=this.build[t],n=e.build[t];if(r("prerelease compare",t,i,n),void 0===i&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===i)return-1;if(i!==n)return l(i,n)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let e=this.prerelease.length;for(;--e>=0;)"number"==typeof this.prerelease[e]&&(this.prerelease[e]++,e=-2);-1===e&&this.prerelease.push(0)}t&&(0===l(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}e.exports=h},3507:(e,t,i)=>{const r=i(3959);e.exports=(e,t)=>{const i=r(e.trim().replace(/^[=v]+/,""),t);return i?i.version:null}},7539:(e,t,i)=>{const r=i(8718),n=i(1194),s=i(1312),o=i(5903),a=i(1544),c=i(2056);e.exports=(e,t,i,l)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof i&&(i=i.version),e===i;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof i&&(i=i.version),e!==i;case"":case"=":case"==":return r(e,i,l);case"!=":return n(e,i,l);case">":return s(e,i,l);case">=":return o(e,i,l);case"<":return a(e,i,l);case"<=":return c(e,i,l);default:throw new TypeError(`Invalid operator: ${t}`)}}},9038:(e,t,i)=>{const r=i(6376),n=i(3959),{re:s,t:o}=i(5765);e.exports=(e,t)=>{if(e instanceof r)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let i=null;if((t=t||{}).rtl){let t;for(;(t=s[o.COERCERTL].exec(e))&&(!i||i.index+i[0].length!==e.length);)i&&t.index+t[0].length===i.index+i[0].length||(i=t),s[o.COERCERTL].lastIndex=t.index+t[1].length+t[2].length;s[o.COERCERTL].lastIndex=-1}else i=e.match(s[o.COERCE]);return null===i?null:n(`${i[2]}.${i[3]||"0"}.${i[4]||"0"}`,t)}},8880:(e,t,i)=>{const r=i(6376);e.exports=(e,t,i)=>{const n=new r(e,i),s=new r(t,i);return n.compare(s)||n.compareBuild(s)}},7880:(e,t,i)=>{const r=i(6269);e.exports=(e,t)=>r(e,t,!0)},6269:(e,t,i)=>{const r=i(6376);e.exports=(e,t,i)=>new r(e,i).compare(new r(t,i))},2378:(e,t,i)=>{const r=i(3959),n=i(8718);e.exports=(e,t)=>{if(n(e,t))return null;{const i=r(e),n=r(t),s=i.prerelease.length||n.prerelease.length,o=s?"pre":"",a=s?"prerelease":"";for(const e in i)if(("major"===e||"minor"===e||"patch"===e)&&i[e]!==n[e])return o+e;return a}}},8718:(e,t,i)=>{const r=i(6269);e.exports=(e,t,i)=>0===r(e,t,i)},1312:(e,t,i)=>{const r=i(6269);e.exports=(e,t,i)=>r(e,t,i)>0},5903:(e,t,i)=>{const r=i(6269);e.exports=(e,t,i)=>r(e,t,i)>=0},253:(e,t,i)=>{const r=i(6376);e.exports=(e,t,i,n)=>{"string"==typeof i&&(n=i,i=void 0);try{return new r(e instanceof r?e.version:e,i).inc(t,n).version}catch(e){return null}}},1544:(e,t,i)=>{const r=i(6269);e.exports=(e,t,i)=>r(e,t,i)<0},2056:(e,t,i)=>{const r=i(6269);e.exports=(e,t,i)=>r(e,t,i)<=0},8679:(e,t,i)=>{const r=i(6376);e.exports=(e,t)=>new r(e,t).major},7789:(e,t,i)=>{const r=i(6376);e.exports=(e,t)=>new r(e,t).minor},1194:(e,t,i)=>{const r=i(6269);e.exports=(e,t,i)=>0!==r(e,t,i)},3959:(e,t,i)=>{const{MAX_LENGTH:r}=i(3295),{re:n,t:s}=i(5765),o=i(6376),a=i(2893);e.exports=(e,t)=>{if(t=a(t),e instanceof o)return e;if("string"!=typeof e)return null;if(e.length>r)return null;if(!(t.loose?n[s.LOOSE]:n[s.FULL]).test(e))return null;try{return new o(e,t)}catch(e){return null}}},2358:(e,t,i)=>{const r=i(6376);e.exports=(e,t)=>new r(e,t).patch},7559:(e,t,i)=>{const r=i(3959);e.exports=(e,t)=>{const i=r(e,t);return i&&i.prerelease.length?i.prerelease:null}},9795:(e,t,i)=>{const r=i(6269);e.exports=(e,t,i)=>r(t,e,i)},3657:(e,t,i)=>{const r=i(8880);e.exports=(e,t)=>e.sort(((e,i)=>r(i,e,t)))},5712:(e,t,i)=>{const r=i(6902);e.exports=(e,t,i)=>{try{t=new r(t,i)}catch(e){return!1}return t.test(e)}},1100:(e,t,i)=>{const r=i(8880);e.exports=(e,t)=>e.sort(((e,i)=>r(e,i,t)))},6397:(e,t,i)=>{const r=i(3959);e.exports=(e,t)=>{const i=r(e,t);return i?i.version:null}},1249:(e,t,i)=>{const r=i(5765),n=i(3295),s=i(6376),o=i(6742),a=i(3959),c=i(6397),l=i(3507),h=i(253),p=i(2378),u=i(8679),d=i(7789),m=i(2358),g=i(7559),f=i(6269),v=i(9795),S=i(7880),y=i(8880),E=i(1100),I=i(3657),D=i(1312),O=i(1544),M=i(8718),b=i(1194),x=i(5903),T=i(2056),R=i(7539),w=i(9038),P=i(2257),C=i(6902),$=i(5712),A=i(1042),N=i(5775),j=i(1657),L=i(5316),_=i(9042),k=i(6826),V=i(7606),F=i(32),G=i(2937),z=i(7908),B=i(799);e.exports={parse:a,valid:c,clean:l,inc:h,diff:p,major:u,minor:d,patch:m,prerelease:g,compare:f,rcompare:v,compareLoose:S,compareBuild:y,sort:E,rsort:I,gt:D,lt:O,eq:M,neq:b,gte:x,lte:T,cmp:R,coerce:w,Comparator:P,Range:C,satisfies:$,toComparators:A,maxSatisfying:N,minSatisfying:j,minVersion:L,validRange:_,outside:k,gtr:V,ltr:F,intersects:G,simplifyRange:z,subset:B,SemVer:s,re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:n.SEMVER_SPEC_VERSION,compareIdentifiers:o.compareIdentifiers,rcompareIdentifiers:o.rcompareIdentifiers}},3295:e=>{const t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:t,MAX_SAFE_COMPONENT_LENGTH:16}},4225:e=>{const t="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=t},6742:e=>{const t=/^[0-9]+$/,i=(e,i)=>{const r=t.test(e),n=t.test(i);return r&&n&&(e=+e,i=+i),e===i?0:r&&!n?-1:n&&!r?1:e<i?-1:1};e.exports={compareIdentifiers:i,rcompareIdentifiers:(e,t)=>i(t,e)}},2893:e=>{const t=["includePrerelease","loose","rtl"];e.exports=e=>e?"object"!=typeof e?{loose:!0}:t.filter((t=>e[t])).reduce(((e,t)=>(e[t]=!0,e)),{}):{}},5765:(e,t,i)=>{const{MAX_SAFE_COMPONENT_LENGTH:r}=i(3295),n=i(4225),s=(t=e.exports={}).re=[],o=t.src=[],a=t.t={};let c=0;const l=(e,t,i)=>{const r=c++;n(e,r,t),a[e]=r,o[r]=t,s[r]=new RegExp(t,i?"g":void 0)};l("NUMERICIDENTIFIER","0|[1-9]\\d*"),l("NUMERICIDENTIFIERLOOSE","[0-9]+"),l("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),l("MAINVERSION",`(${o[a.NUMERICIDENTIFIER]})\\.(${o[a.NUMERICIDENTIFIER]})\\.(${o[a.NUMERICIDENTIFIER]})`),l("MAINVERSIONLOOSE",`(${o[a.NUMERICIDENTIFIERLOOSE]})\\.(${o[a.NUMERICIDENTIFIERLOOSE]})\\.(${o[a.NUMERICIDENTIFIERLOOSE]})`),l("PRERELEASEIDENTIFIER",`(?:${o[a.NUMERICIDENTIFIER]}|${o[a.NONNUMERICIDENTIFIER]})`),l("PRERELEASEIDENTIFIERLOOSE",`(?:${o[a.NUMERICIDENTIFIERLOOSE]}|${o[a.NONNUMERICIDENTIFIER]})`),l("PRERELEASE",`(?:-(${o[a.PRERELEASEIDENTIFIER]}(?:\\.${o[a.PRERELEASEIDENTIFIER]})*))`),l("PRERELEASELOOSE",`(?:-?(${o[a.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${o[a.PRERELEASEIDENTIFIERLOOSE]})*))`),l("BUILDIDENTIFIER","[0-9A-Za-z-]+"),l("BUILD",`(?:\\+(${o[a.BUILDIDENTIFIER]}(?:\\.${o[a.BUILDIDENTIFIER]})*))`),l("FULLPLAIN",`v?${o[a.MAINVERSION]}${o[a.PRERELEASE]}?${o[a.BUILD]}?`),l("FULL",`^${o[a.FULLPLAIN]}$`),l("LOOSEPLAIN",`[v=\\s]*${o[a.MAINVERSIONLOOSE]}${o[a.PRERELEASELOOSE]}?${o[a.BUILD]}?`),l("LOOSE",`^${o[a.LOOSEPLAIN]}$`),l("GTLT","((?:<|>)?=?)"),l("XRANGEIDENTIFIERLOOSE",`${o[a.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),l("XRANGEIDENTIFIER",`${o[a.NUMERICIDENTIFIER]}|x|X|\\*`),l("XRANGEPLAIN",`[v=\\s]*(${o[a.XRANGEIDENTIFIER]})(?:\\.(${o[a.XRANGEIDENTIFIER]})(?:\\.(${o[a.XRANGEIDENTIFIER]})(?:${o[a.PRERELEASE]})?${o[a.BUILD]}?)?)?`),l("XRANGEPLAINLOOSE",`[v=\\s]*(${o[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[a.XRANGEIDENTIFIERLOOSE]})(?:${o[a.PRERELEASELOOSE]})?${o[a.BUILD]}?)?)?`),l("XRANGE",`^${o[a.GTLT]}\\s*${o[a.XRANGEPLAIN]}$`),l("XRANGELOOSE",`^${o[a.GTLT]}\\s*${o[a.XRANGEPLAINLOOSE]}$`),l("COERCE",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?(?:$|[^\\d])`),l("COERCERTL",o[a.COERCE],!0),l("LONETILDE","(?:~>?)"),l("TILDETRIM",`(\\s*)${o[a.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",l("TILDE",`^${o[a.LONETILDE]}${o[a.XRANGEPLAIN]}$`),l("TILDELOOSE",`^${o[a.LONETILDE]}${o[a.XRANGEPLAINLOOSE]}$`),l("LONECARET","(?:\\^)"),l("CARETTRIM",`(\\s*)${o[a.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",l("CARET",`^${o[a.LONECARET]}${o[a.XRANGEPLAIN]}$`),l("CARETLOOSE",`^${o[a.LONECARET]}${o[a.XRANGEPLAINLOOSE]}$`),l("COMPARATORLOOSE",`^${o[a.GTLT]}\\s*(${o[a.LOOSEPLAIN]})$|^$`),l("COMPARATOR",`^${o[a.GTLT]}\\s*(${o[a.FULLPLAIN]})$|^$`),l("COMPARATORTRIM",`(\\s*)${o[a.GTLT]}\\s*(${o[a.LOOSEPLAIN]}|${o[a.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",l("HYPHENRANGE",`^\\s*(${o[a.XRANGEPLAIN]})\\s+-\\s+(${o[a.XRANGEPLAIN]})\\s*$`),l("HYPHENRANGELOOSE",`^\\s*(${o[a.XRANGEPLAINLOOSE]})\\s+-\\s+(${o[a.XRANGEPLAINLOOSE]})\\s*$`),l("STAR","(<|>)?=?\\s*\\*"),l("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),l("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},7606:(e,t,i)=>{const r=i(6826);e.exports=(e,t,i)=>r(e,t,">",i)},2937:(e,t,i)=>{const r=i(6902);e.exports=(e,t,i)=>(e=new r(e,i),t=new r(t,i),e.intersects(t))},32:(e,t,i)=>{const r=i(6826);e.exports=(e,t,i)=>r(e,t,"<",i)},5775:(e,t,i)=>{const r=i(6376),n=i(6902);e.exports=(e,t,i)=>{let s=null,o=null,a=null;try{a=new n(t,i)}catch(e){return null}return e.forEach((e=>{a.test(e)&&(s&&-1!==o.compare(e)||(s=e,o=new r(s,i)))})),s}},1657:(e,t,i)=>{const r=i(6376),n=i(6902);e.exports=(e,t,i)=>{let s=null,o=null,a=null;try{a=new n(t,i)}catch(e){return null}return e.forEach((e=>{a.test(e)&&(s&&1!==o.compare(e)||(s=e,o=new r(s,i)))})),s}},5316:(e,t,i)=>{const r=i(6376),n=i(6902),s=i(1312);e.exports=(e,t)=>{e=new n(e,t);let i=new r("0.0.0");if(e.test(i))return i;if(i=new r("0.0.0-0"),e.test(i))return i;i=null;for(let t=0;t<e.set.length;++t){const n=e.set[t];let o=null;n.forEach((e=>{const t=new r(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":o&&!s(t,o)||(o=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!o||i&&!s(i,o)||(i=o)}return i&&e.test(i)?i:null}},6826:(e,t,i)=>{const r=i(6376),n=i(2257),{ANY:s}=n,o=i(6902),a=i(5712),c=i(1312),l=i(1544),h=i(2056),p=i(5903);e.exports=(e,t,i,u)=>{let d,m,g,f,v;switch(e=new r(e,u),t=new o(t,u),i){case">":d=c,m=h,g=l,f=">",v=">=";break;case"<":d=l,m=p,g=c,f="<",v="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(a(e,t,u))return!1;for(let i=0;i<t.set.length;++i){const r=t.set[i];let o=null,a=null;if(r.forEach((e=>{e.semver===s&&(e=new n(">=0.0.0")),o=o||e,a=a||e,d(e.semver,o.semver,u)?o=e:g(e.semver,a.semver,u)&&(a=e)})),o.operator===f||o.operator===v)return!1;if((!a.operator||a.operator===f)&&m(e,a.semver))return!1;if(a.operator===v&&g(e,a.semver))return!1}return!0}},7908:(e,t,i)=>{const r=i(5712),n=i(6269);e.exports=(e,t,i)=>{const s=[];let o=null,a=null;const c=e.sort(((e,t)=>n(e,t,i)));for(const e of c){r(e,t,i)?(a=e,o||(o=e)):(a&&s.push([o,a]),a=null,o=null)}o&&s.push([o,null]);const l=[];for(const[e,t]of s)e===t?l.push(e):t||e!==c[0]?t?e===c[0]?l.push(`<=${t}`):l.push(`${e} - ${t}`):l.push(`>=${e}`):l.push("*");const h=l.join(" || "),p="string"==typeof t.raw?t.raw:String(t);return h.length<p.length?h:t}},799:(e,t,i)=>{const r=i(6902),n=i(2257),{ANY:s}=n,o=i(5712),a=i(6269),c=(e,t,i)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===s){if(1===t.length&&t[0].semver===s)return!0;e=i.includePrerelease?[new n(">=0.0.0-0")]:[new n(">=0.0.0")]}if(1===t.length&&t[0].semver===s){if(i.includePrerelease)return!0;t=[new n(">=0.0.0")]}const r=new Set;let c,p,u,d,m,g,f;for(const t of e)">"===t.operator||">="===t.operator?c=l(c,t,i):"<"===t.operator||"<="===t.operator?p=h(p,t,i):r.add(t.semver);if(r.size>1)return null;if(c&&p){if(u=a(c.semver,p.semver,i),u>0)return null;if(0===u&&(">="!==c.operator||"<="!==p.operator))return null}for(const e of r){if(c&&!o(e,String(c),i))return null;if(p&&!o(e,String(p),i))return null;for(const r of t)if(!o(e,String(r),i))return!1;return!0}let v=!(!p||i.includePrerelease||!p.semver.prerelease.length)&&p.semver,S=!(!c||i.includePrerelease||!c.semver.prerelease.length)&&c.semver;v&&1===v.prerelease.length&&"<"===p.operator&&0===v.prerelease[0]&&(v=!1);for(const e of t){if(f=f||">"===e.operator||">="===e.operator,g=g||"<"===e.operator||"<="===e.operator,c)if(S&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===S.major&&e.semver.minor===S.minor&&e.semver.patch===S.patch&&(S=!1),">"===e.operator||">="===e.operator){if(d=l(c,e,i),d===e&&d!==c)return!1}else if(">="===c.operator&&!o(c.semver,String(e),i))return!1;if(p)if(v&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===v.major&&e.semver.minor===v.minor&&e.semver.patch===v.patch&&(v=!1),"<"===e.operator||"<="===e.operator){if(m=h(p,e,i),m===e&&m!==p)return!1}else if("<="===p.operator&&!o(p.semver,String(e),i))return!1;if(!e.operator&&(p||c)&&0!==u)return!1}return!(c&&g&&!p&&0!==u)&&(!(p&&f&&!c&&0!==u)&&(!S&&!v))},l=(e,t,i)=>{if(!e)return t;const r=a(e.semver,t.semver,i);return r>0?e:r<0||">"===t.operator&&">="===e.operator?t:e},h=(e,t,i)=>{if(!e)return t;const r=a(e.semver,t.semver,i);return r<0?e:r>0||"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,i={})=>{if(e===t)return!0;e=new r(e,i),t=new r(t,i);let n=!1;e:for(const r of e.set){for(const e of t.set){const t=c(r,e,i);if(n=n||null!==t,t)continue e}if(n)return!1}return!0}},1042:(e,t,i)=>{const r=i(6902);e.exports=(e,t)=>new r(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")))},9042:(e,t,i)=>{const r=i(6902);e.exports=(e,t)=>{try{return new r(e,t).range||"*"}catch(e){return null}}},9602:e=>{"use strict";e.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}},4411:(e,t,i)=>{"use strict";function r(e){var t=this;if(t instanceof r||(t=new r),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach((function(e){t.push(e)}));else if(arguments.length>0)for(var i=0,n=arguments.length;i<n;i++)t.push(arguments[i]);return t}function n(e,t,i){var r=t===e.head?new a(i,null,t,e):new a(i,t,t.next,e);return null===r.next&&(e.tail=r),null===r.prev&&(e.head=r),e.length++,r}function s(e,t){e.tail=new a(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function o(e,t){e.head=new a(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function a(e,t,i,r){if(!(this instanceof a))return new a(e,t,i,r);this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,i?(i.prev=this,this.next=i):this.next=null}e.exports=r,r.Node=a,r.create=r,r.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,i=e.prev;return t&&(t.prev=i),i&&(i.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=i),e.list.length--,e.next=null,e.prev=null,e.list=null,t},r.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},r.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},r.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)s(this,arguments[e]);return this.length},r.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)o(this,arguments[e]);return this.length},r.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},r.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},r.prototype.forEach=function(e,t){t=t||this;for(var i=this.head,r=0;null!==i;r++)e.call(t,i.value,r,this),i=i.next},r.prototype.forEachReverse=function(e,t){t=t||this;for(var i=this.tail,r=this.length-1;null!==i;r--)e.call(t,i.value,r,this),i=i.prev},r.prototype.get=function(e){for(var t=0,i=this.head;null!==i&&t<e;t++)i=i.next;if(t===e&&null!==i)return i.value},r.prototype.getReverse=function(e){for(var t=0,i=this.tail;null!==i&&t<e;t++)i=i.prev;if(t===e&&null!==i)return i.value},r.prototype.map=function(e,t){t=t||this;for(var i=new r,n=this.head;null!==n;)i.push(e.call(t,n.value,this)),n=n.next;return i},r.prototype.mapReverse=function(e,t){t=t||this;for(var i=new r,n=this.tail;null!==n;)i.push(e.call(t,n.value,this)),n=n.prev;return i},r.prototype.reduce=function(e,t){var i,r=this.head;if(arguments.length>1)i=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");r=this.head.next,i=this.head.value}for(var n=0;null!==r;n++)i=e(i,r.value,n),r=r.next;return i},r.prototype.reduceReverse=function(e,t){var i,r=this.tail;if(arguments.length>1)i=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");r=this.tail.prev,i=this.tail.value}for(var n=this.length-1;null!==r;n--)i=e(i,r.value,n),r=r.prev;return i},r.prototype.toArray=function(){for(var e=new Array(this.length),t=0,i=this.head;null!==i;t++)e[t]=i.value,i=i.next;return e},r.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,i=this.tail;null!==i;t++)e[t]=i.value,i=i.prev;return e},r.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var i=new r;if(t<e||t<0)return i;e<0&&(e=0),t>this.length&&(t=this.length);for(var n=0,s=this.head;null!==s&&n<e;n++)s=s.next;for(;null!==s&&n<t;n++,s=s.next)i.push(s.value);return i},r.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var i=new r;if(t<e||t<0)return i;e<0&&(e=0),t>this.length&&(t=this.length);for(var n=this.length,s=this.tail;null!==s&&n>t;n--)s=s.prev;for(;null!==s&&n>e;n--,s=s.prev)i.push(s.value);return i},r.prototype.splice=function(e,t,...i){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var r=0,s=this.head;null!==s&&r<e;r++)s=s.next;var o=[];for(r=0;s&&r<t;r++)o.push(s.value),s=this.removeNode(s);null===s&&(s=this.tail),s!==this.head&&s!==this.tail&&(s=s.prev);for(r=0;r<i.length;r++)s=n(this,s,i[r]);return o},r.prototype.reverse=function(){for(var e=this.head,t=this.tail,i=e;null!==i;i=i.prev){var r=i.prev;i.prev=i.next,i.next=r}return this.head=t,this.tail=e,this};try{i(9602)(r)}catch(e){}},7954:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,n)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.MixinDeviceBase=t.ScryptedDeviceBase=void 0,n(i(5492),t);const s=i(5492);class o extends s.DeviceBase{constructor(e){super(),this.nativeId=e}get storage(){return this._storage||(this._storage=deviceManager.getDeviceStorage(this.nativeId)),this._storage}get log(){return this._log||(this._log=deviceManager.getDeviceLogger(this.nativeId)),this._log}get console(){return this._console||(this._console=deviceManager.getDeviceConsole(this.nativeId)),this._console}async createMediaObject(e,t){return mediaManager.createMediaObject(e,t,{sourceId:this.id})}getMediaObjectConsole(e){return"string"!=typeof e.sourceId?this.console:deviceManager.getMixinConsole(e.sourceId,this.nativeId)}_lazyLoadDeviceState(){this._deviceState||(this.nativeId?this._deviceState=deviceManager.getDeviceState(this.nativeId):this._deviceState=deviceManager.getDeviceState())}onDeviceEvent(e,t){return deviceManager.onDeviceEvent(this.nativeId,e,t)}}t.ScryptedDeviceBase=o;class a extends s.DeviceBase{constructor(e){super(),this._listeners=new Set,this.nativeId=systemManager.getDeviceById(this.id)?.nativeId,this.mixinDevice=e.mixinDevice,this.mixinDeviceInterfaces=e.mixinDeviceInterfaces,this.mixinStorageSuffix=e.mixinStorageSuffix,this._deviceState=e.mixinDeviceState,this._deviceState.__rpcproxy_traps_all_properties&&deviceManager.createDeviceState&&"string"==typeof this._deviceState.id&&(this._deviceState=deviceManager.createDeviceState(this._deviceState.id,this._deviceState.setState)),this.mixinProviderNativeId=e.mixinProviderNativeId}get storage(){if(!this._storage){const e=this.mixinStorageSuffix,t=this.id+(e?":"+e:"");this._storage=deviceManager.getMixinStorage(t,this.mixinProviderNativeId)}return this._storage}get console(){return this._console||(deviceManager.getMixinConsole?this._console=deviceManager.getMixinConsole(this.id,this.mixinProviderNativeId):this._console=deviceManager.getDeviceConsole(this.mixinProviderNativeId)),this._console}async createMediaObject(e,t){return mediaManager.createMediaObject(e,t,{sourceId:this.id})}getMediaObjectConsole(e){return"string"!=typeof e.sourceId?this.console:deviceManager.getMixinConsole(e.sourceId,this.mixinProviderNativeId)}onDeviceEvent(e,t){return deviceManager.onMixinEvent(this.id,this,e,t)}_lazyLoadDeviceState(){}manageListener(e){this._listeners.add(e)}release(){for(const e of this._listeners)e.removeListener()}}t.MixinDeviceBase=a,function(){function e(e){return function(){return this._lazyLoadDeviceState(),this._deviceState?.[e]}}function t(e){return function(t){this._lazyLoadDeviceState(),this._deviceState?this._deviceState[e]=t:console.warn("device state is unavailable. the device must be discovered with deviceManager.onDeviceDiscovered or deviceManager.onDevicesChanged before the state can be set.")}}for(const i of Object.values(s.ScryptedInterfaceProperty))i!==s.ScryptedInterfaceProperty.nativeId&&(Object.defineProperty(o.prototype,i,{set:t(i),get:e(i)}),Object.defineProperty(a.prototype,i,{set:t(i),get:e(i)}))}();let c={};try{let e;try{e=pluginRuntimeAPI}catch(e){}c=Object.assign(c,{log:deviceManager.getDeviceLogger(void 0),deviceManager,endpointManager,mediaManager,systemManager,pluginHostAPI,...e});try{systemManager.setScryptedInterfaceDescriptors?.(s.TYPES_VERSION,s.ScryptedInterfaceDescriptors)?.catch((()=>{}))}catch(e){}}catch(e){console.error("sdk initialization error, import @scrypted/types or use @scrypted/client instead",e)}t.default=c},8202:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,n)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&r(t,e,i);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.StorageSettings=void 0;const o=s(i(7954)),{systemManager:a}=o.default;t.StorageSettings=class{constructor(e,t){this.device=e,this.settings=t,this.values={},this.hasValue={};for(const e of Object.keys(t)){const i=t[e],r=()=>this.getItem(e);let n;n="clippath"!==i.type?r:()=>{try{return JSON.parse(r())}catch(e){}},Object.defineProperty(this.values,e,{get:n,set:t=>this.putSetting(e,t),enumerable:!0}),Object.defineProperty(this.hasValue,e,{get:()=>null!=this.device.storage.getItem(e),enumerable:!0})}}get keys(){const e={};for(const t of Object.keys(this.settings))e[t]=t;return e}async getSettings(){const e=await(this.options?.onGet?.()),t=[];for(const[i,r]of Object.entries(this.settings)){let n=Object.assign({},r);e?.[i]&&(n=Object.assign(n,e[i])),n.onGet&&(n=Object.assign(n,await n.onGet())),n.hide||await(this.options?.hide?.[i]?.())||(n.key=i,n.value=this.getItemInternal(i,n,!0),t.push(n),delete n.onPut,delete n.onGet,delete n.mapPut,delete n.mapGet)}return t}async putSetting(e,t){const i=this.settings[e];let r;return i&&(r=this.getItemInternal(e,i)),this.putSettingInternal(i,r,e,t)}putSettingInternal(e,t,i,r){e?.noStore||(e?.mapPut&&(r=e.mapPut(t,r)),"object"==typeof r?this.device.storage.setItem(i,JSON.stringify(r)):null==r?this.device.storage.removeItem(i):this.device.storage.setItem(i,r?.toString())),e?.onPut?.(t,r),this.device.onDeviceEvent(o.ScryptedInterface.Settings,void 0)}getItemInternal(e,t,i){if(!t)return this.device.storage.getItem(e);const r=function(e,t,i,r){const n=t.multiple?"array":t.type;if("boolean"===n)return"true"===e||"false"!==e&&(i()||!1);if("number"===n)return parseFloat(e)||i()||0;if("integer"===n)return parseInt(e)||i()||0;if("array"===n)try{return JSON.parse(e)}catch(e){return i()||[]}if("device"===n)return r?e:a.getDeviceById(e)||a.getDeviceById(i());if(e&&t.json)try{return JSON.parse(e)}catch(e){return i()}return e||i()}(this.device.storage.getItem(e),t,(()=>t.persistedDefaultValue?(this.putSettingInternal(t,void 0,e,t.persistedDefaultValue),t.persistedDefaultValue):t.defaultValue),i);return t.mapGet?t.mapGet(r):r}getItem(e){return this.getItemInternal(e,this.settings[e])}}},5492:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScryptedMimeTypes=t.ScryptedInterface=t.MediaPlayerState=t.SecuritySystemObstruction=t.SecuritySystemMode=t.AirQuality=t.ChargeState=t.LockState=t.PanTiltZoomMovement=t.ThermostatMode=t.TemperatureUnit=t.FanMode=t.HumidityMode=t.ScryptedDeviceType=t.ScryptedInterfaceDescriptors=t.ScryptedInterfaceMethod=t.ScryptedInterfaceProperty=t.DeviceBase=t.TYPES_VERSION=void 0,t.TYPES_VERSION="0.2.85";t.DeviceBase=class{},function(e){e.id="id",e.info="info",e.interfaces="interfaces",e.mixins="mixins",e.name="name",e.nativeId="nativeId",e.pluginId="pluginId",e.providedInterfaces="providedInterfaces",e.providedName="providedName",e.providedRoom="providedRoom",e.providedType="providedType",e.providerId="providerId",e.room="room",e.type="type",e.on="on",e.brightness="brightness",e.colorTemperature="colorTemperature",e.rgb="rgb",e.hsv="hsv",e.running="running",e.paused="paused",e.docked="docked",e.temperatureSetting="temperatureSetting",e.thermostatActiveMode="thermostatActiveMode",e.thermostatAvailableModes="thermostatAvailableModes",e.thermostatMode="thermostatMode",e.thermostatSetpoint="thermostatSetpoint",e.thermostatSetpointHigh="thermostatSetpointHigh",e.thermostatSetpointLow="thermostatSetpointLow",e.temperature="temperature",e.temperatureUnit="temperatureUnit",e.humidity="humidity",e.ptzCapabilities="ptzCapabilities",e.lockState="lockState",e.entryOpen="entryOpen",e.batteryLevel="batteryLevel",e.chargeState="chargeState",e.online="online",e.fromMimeType="fromMimeType",e.toMimeType="toMimeType",e.binaryState="binaryState",e.tampered="tampered",e.powerDetected="powerDetected",e.audioDetected="audioDetected",e.motionDetected="motionDetected",e.ambientLight="ambientLight",e.occupied="occupied",e.flooded="flooded",e.ultraviolet="ultraviolet",e.luminance="luminance",e.position="position",e.securitySystemState="securitySystemState",e.pm10Density="pm10Density",e.pm25Density="pm25Density",e.vocDensity="vocDensity",e.noxDensity="noxDensity",e.co2ppm="co2ppm",e.airQuality="airQuality",e.humiditySetting="humiditySetting",e.fan="fan",e.applicationInfo="applicationInfo"}(t.ScryptedInterfaceProperty||(t.ScryptedInterfaceProperty={})),function(e){e.listen="listen",e.probe="probe",e.setMixins="setMixins",e.setName="setName",e.setRoom="setRoom",e.setType="setType",e.getPluginJson="getPluginJson",e.turnOff="turnOff",e.turnOn="turnOn",e.setBrightness="setBrightness",e.getTemperatureMaxK="getTemperatureMaxK",e.getTemperatureMinK="getTemperatureMinK",e.setColorTemperature="setColorTemperature",e.setRgb="setRgb",e.setHsv="setHsv",e.sendNotification="sendNotification",e.start="start",e.stop="stop",e.pause="pause",e.resume="resume",e.dock="dock",e.setTemperature="setTemperature",e.setThermostatMode="setThermostatMode",e.setThermostatSetpoint="setThermostatSetpoint",e.setThermostatSetpointHigh="setThermostatSetpointHigh",e.setThermostatSetpointLow="setThermostatSetpointLow",e.setTemperatureUnit="setTemperatureUnit",e.getPictureOptions="getPictureOptions",e.takePicture="takePicture",e.getAudioStream="getAudioStream",e.startDisplay="startDisplay",e.stopDisplay="stopDisplay",e.getVideoStream="getVideoStream",e.getVideoStreamOptions="getVideoStreamOptions",e.getRecordingStream="getRecordingStream",e.getRecordingStreamCurrentTime="getRecordingStreamCurrentTime",e.getRecordingStreamOptions="getRecordingStreamOptions",e.getRecordingStreamThumbnail="getRecordingStreamThumbnail",e.ptzCommand="ptzCommand",e.getRecordedEvents="getRecordedEvents",e.getVideoClip="getVideoClip",e.getVideoClipThumbnail="getVideoClipThumbnail",e.getVideoClips="getVideoClips",e.removeVideoClips="removeVideoClips",e.setVideoStreamOptions="setVideoStreamOptions",e.startIntercom="startIntercom",e.stopIntercom="stopIntercom",e.lock="lock",e.unlock="unlock",e.addPassword="addPassword",e.getPasswords="getPasswords",e.removePassword="removePassword",e.activate="activate",e.deactivate="deactivate",e.isReversible="isReversible",e.closeEntry="closeEntry",e.openEntry="openEntry",e.getDevice="getDevice",e.releaseDevice="releaseDevice",e.adoptDevice="adoptDevice",e.discoverDevices="discoverDevices",e.createDevice="createDevice",e.getCreateDeviceSettings="getCreateDeviceSettings",e.getRefreshFrequency="getRefreshFrequency",e.refresh="refresh",e.getMediaStatus="getMediaStatus",e.load="load",e.seek="seek",e.skipNext="skipNext",e.skipPrevious="skipPrevious",e.convert="convert",e.getSettings="getSettings",e.putSetting="putSetting",e.armSecuritySystem="armSecuritySystem",e.disarmSecuritySystem="disarmSecuritySystem",e.getReadmeMarkdown="getReadmeMarkdown",e.getOauthUrl="getOauthUrl",e.onOauthCallback="onOauthCallback",e.canMixin="canMixin",e.getMixin="getMixin",e.releaseMixin="releaseMixin",e.onRequest="onRequest",e.onConnection="onConnection",e.onPush="onPush",e.run="run",e.eval="eval",e.loadScripts="loadScripts",e.saveScript="saveScript",e.trackObjects="trackObjects",e.getDetectionInput="getDetectionInput",e.getObjectTypes="getObjectTypes",e.detectObjects="detectObjects",e.generateObjectDetections="generateObjectDetections",e.getDetectionModel="getDetectionModel",e.setHumidity="setHumidity",e.setFan="setFan",e.startRTCSignalingSession="startRTCSignalingSession",e.createRTCSignalingSession="createRTCSignalingSession",e.getScryptedUserAccessControl="getScryptedUserAccessControl",e.generateVideoFrames="generateVideoFrames"}(t.ScryptedInterfaceMethod||(t.ScryptedInterfaceMethod={})),t.ScryptedInterfaceDescriptors={ScryptedDevice:{name:"ScryptedDevice",methods:["listen","probe","setMixins","setName","setRoom","setType"],properties:["id","info","interfaces","mixins","name","nativeId","pluginId","providedInterfaces","providedName","providedRoom","providedType","providerId","room","type"]},ScryptedPlugin:{name:"ScryptedPlugin",methods:["getPluginJson"],properties:[]},OnOff:{name:"OnOff",methods:["turnOff","turnOn"],properties:["on"]},Brightness:{name:"Brightness",methods:["setBrightness"],properties:["brightness"]},ColorSettingTemperature:{name:"ColorSettingTemperature",methods:["getTemperatureMaxK","getTemperatureMinK","setColorTemperature"],properties:["colorTemperature"]},ColorSettingRgb:{name:"ColorSettingRgb",methods:["setRgb"],properties:["rgb"]},ColorSettingHsv:{name:"ColorSettingHsv",methods:["setHsv"],properties:["hsv"]},Notifier:{name:"Notifier",methods:["sendNotification"],properties:[]},StartStop:{name:"StartStop",methods:["start","stop"],properties:["running"]},Pause:{name:"Pause",methods:["pause","resume"],properties:["paused"]},Dock:{name:"Dock",methods:["dock"],properties:["docked"]},TemperatureSetting:{name:"TemperatureSetting",methods:["setTemperature","setThermostatMode","setThermostatSetpoint","setThermostatSetpointHigh","setThermostatSetpointLow"],properties:["temperatureSetting","thermostatActiveMode","thermostatAvailableModes","thermostatMode","thermostatSetpoint","thermostatSetpointHigh","thermostatSetpointLow"]},Thermometer:{name:"Thermometer",methods:["setTemperatureUnit"],properties:["temperature","temperatureUnit"]},HumiditySensor:{name:"HumiditySensor",methods:[],properties:["humidity"]},Camera:{name:"Camera",methods:["getPictureOptions","takePicture"],properties:[]},Microphone:{name:"Microphone",methods:["getAudioStream"],properties:[]},Display:{name:"Display",methods:["startDisplay","stopDisplay"],properties:[]},VideoCamera:{name:"VideoCamera",methods:["getVideoStream","getVideoStreamOptions"],properties:[]},VideoRecorder:{name:"VideoRecorder",methods:["getRecordingStream","getRecordingStreamCurrentTime","getRecordingStreamOptions","getRecordingStreamThumbnail"],properties:[]},PanTiltZoom:{name:"PanTiltZoom",methods:["ptzCommand"],properties:["ptzCapabilities"]},EventRecorder:{name:"EventRecorder",methods:["getRecordedEvents"],properties:[]},VideoClips:{name:"VideoClips",methods:["getVideoClip","getVideoClipThumbnail","getVideoClips","removeVideoClips"],properties:[]},VideoCameraConfiguration:{name:"VideoCameraConfiguration",methods:["setVideoStreamOptions"],properties:[]},Intercom:{name:"Intercom",methods:["startIntercom","stopIntercom"],properties:[]},Lock:{name:"Lock",methods:["lock","unlock"],properties:["lockState"]},PasswordStore:{name:"PasswordStore",methods:["addPassword","getPasswords","removePassword"],properties:[]},Scene:{name:"Scene",methods:["activate","deactivate","isReversible"],properties:[]},Entry:{name:"Entry",methods:["closeEntry","openEntry"],properties:[]},EntrySensor:{name:"EntrySensor",methods:[],properties:["entryOpen"]},DeviceProvider:{name:"DeviceProvider",methods:["getDevice","releaseDevice"],properties:[]},DeviceDiscovery:{name:"DeviceDiscovery",methods:["adoptDevice","discoverDevices"],properties:[]},DeviceCreator:{name:"DeviceCreator",methods:["createDevice","getCreateDeviceSettings"],properties:[]},Battery:{name:"Battery",methods:[],properties:["batteryLevel"]},Charger:{name:"Charger",methods:[],properties:["chargeState"]},Refresh:{name:"Refresh",methods:["getRefreshFrequency","refresh"],properties:[]},MediaPlayer:{name:"MediaPlayer",methods:["getMediaStatus","load","seek","skipNext","skipPrevious"],properties:[]},Online:{name:"Online",methods:[],properties:["online"]},BufferConverter:{name:"BufferConverter",methods:["convert"],properties:["fromMimeType","toMimeType"]},Settings:{name:"Settings",methods:["getSettings","putSetting"],properties:[]},BinarySensor:{name:"BinarySensor",methods:[],properties:["binaryState"]},TamperSensor:{name:"TamperSensor",methods:[],properties:["tampered"]},PowerSensor:{name:"PowerSensor",methods:[],properties:["powerDetected"]},AudioSensor:{name:"AudioSensor",methods:[],properties:["audioDetected"]},MotionSensor:{name:"MotionSensor",methods:[],properties:["motionDetected"]},AmbientLightSensor:{name:"AmbientLightSensor",methods:[],properties:["ambientLight"]},OccupancySensor:{name:"OccupancySensor",methods:[],properties:["occupied"]},FloodSensor:{name:"FloodSensor",methods:[],properties:["flooded"]},UltravioletSensor:{name:"UltravioletSensor",methods:[],properties:["ultraviolet"]},LuminanceSensor:{name:"LuminanceSensor",methods:[],properties:["luminance"]},PositionSensor:{name:"PositionSensor",methods:[],properties:["position"]},SecuritySystem:{name:"SecuritySystem",methods:["armSecuritySystem","disarmSecuritySystem"],properties:["securitySystemState"]},PM10Sensor:{name:"PM10Sensor",methods:[],properties:["pm10Density"]},PM25Sensor:{name:"PM25Sensor",methods:[],properties:["pm25Density"]},VOCSensor:{name:"VOCSensor",methods:[],properties:["vocDensity"]},NOXSensor:{name:"NOXSensor",methods:[],properties:["noxDensity"]},CO2Sensor:{name:"CO2Sensor",methods:[],properties:["co2ppm"]},AirQualitySensor:{name:"AirQualitySensor",methods:[],properties:["airQuality"]},Readme:{name:"Readme",methods:["getReadmeMarkdown"],properties:[]},OauthClient:{name:"OauthClient",methods:["getOauthUrl","onOauthCallback"],properties:[]},MixinProvider:{name:"MixinProvider",methods:["canMixin","getMixin","releaseMixin"],properties:[]},HttpRequestHandler:{name:"HttpRequestHandler",methods:["onRequest"],properties:[]},EngineIOHandler:{name:"EngineIOHandler",methods:["onConnection"],properties:[]},PushHandler:{name:"PushHandler",methods:["onPush"],properties:[]},Program:{name:"Program",methods:["run"],properties:[]},Scriptable:{name:"Scriptable",methods:["eval","loadScripts","saveScript"],properties:[]},ObjectTracker:{name:"ObjectTracker",methods:["trackObjects"],properties:[]},ObjectDetector:{name:"ObjectDetector",methods:["getDetectionInput","getObjectTypes"],properties:[]},ObjectDetection:{name:"ObjectDetection",methods:["detectObjects","generateObjectDetections","getDetectionModel"],properties:[]},HumiditySetting:{name:"HumiditySetting",methods:["setHumidity"],properties:["humiditySetting"]},Fan:{name:"Fan",methods:["setFan"],properties:["fan"]},RTCSignalingChannel:{name:"RTCSignalingChannel",methods:["startRTCSignalingSession"],properties:[]},RTCSignalingClient:{name:"RTCSignalingClient",methods:["createRTCSignalingSession"],properties:[]},LauncherApplication:{name:"LauncherApplication",methods:[],properties:["applicationInfo"]},ScryptedUser:{name:"ScryptedUser",methods:["getScryptedUserAccessControl"],properties:[]},VideoFrameGenerator:{name:"VideoFrameGenerator",methods:["generateVideoFrames"],properties:[]}},function(e){e.Builtin="Builtin",e.Camera="Camera",e.Fan="Fan",e.Light="Light",e.Switch="Switch",e.Outlet="Outlet",e.Sensor="Sensor",e.Scene="Scene",e.Program="Program",e.Automation="Automation",e.Vacuum="Vacuum",e.Notifier="Notifier",e.Thermostat="Thermostat",e.Lock="Lock",e.PasswordControl="PasswordControl",e.Display="Display",e.SmartDisplay="SmartDisplay",e.Speaker="Speaker",e.SmartSpeaker="SmartSpeaker",e.Event="Event",e.Entry="Entry",e.Garage="Garage",e.DeviceProvider="DeviceProvider",e.DataSource="DataSource",e.API="API",e.Doorbell="Doorbell",e.Irrigation="Irrigation",e.Valve="Valve",e.Person="Person",e.SecuritySystem="SecuritySystem",e.WindowCovering="WindowCovering",e.Siren="Siren",e.Unknown="Unknown"}(t.ScryptedDeviceType||(t.ScryptedDeviceType={})),function(e){e.Humidify="Humidify",e.Dehumidify="Dehumidify",e.Auto="Auto",e.Off="Off"}(t.HumidityMode||(t.HumidityMode={})),function(e){e.Auto="Auto",e.Manual="Manual"}(t.FanMode||(t.FanMode={})),function(e){e.C="C",e.F="F"}(t.TemperatureUnit||(t.TemperatureUnit={})),function(e){e.Off="Off",e.Cool="Cool",e.Heat="Heat",e.HeatCool="HeatCool",e.Auto="Auto",e.FanOnly="FanOnly",e.Purifier="Purifier",e.Eco="Eco",e.Dry="Dry",e.On="On"}(t.ThermostatMode||(t.ThermostatMode={})),function(e){e.Absolute="Absolute",e.Relative="Relative"}(t.PanTiltZoomMovement||(t.PanTiltZoomMovement={})),function(e){e.Locked="Locked",e.Unlocked="Unlocked",e.Jammed="Jammed"}(t.LockState||(t.LockState={})),function(e){e.Trickle="trickle",e.Charging="charging",e.NotCharging="not-charging"}(t.ChargeState||(t.ChargeState={})),function(e){e.Unknown="Unknown",e.Excellent="Excellent",e.Good="Good",e.Fair="Fair",e.Inferior="Inferior",e.Poor="Poor"}(t.AirQuality||(t.AirQuality={})),function(e){e.Disarmed="Disarmed",e.HomeArmed="HomeArmed",e.AwayArmed="AwayArmed",e.NightArmed="NightArmed"}(t.SecuritySystemMode||(t.SecuritySystemMode={})),function(e){e.Sensor="Sensor",e.Occupied="Occupied",e.Time="Time",e.Error="Error"}(t.SecuritySystemObstruction||(t.SecuritySystemObstruction={})),function(e){e.Idle="Idle",e.Playing="Playing",e.Paused="Paused",e.Buffering="Buffering"}(t.MediaPlayerState||(t.MediaPlayerState={})),function(e){e.ScryptedDevice="ScryptedDevice",e.ScryptedPlugin="ScryptedPlugin",e.OnOff="OnOff",e.Brightness="Brightness",e.ColorSettingTemperature="ColorSettingTemperature",e.ColorSettingRgb="ColorSettingRgb",e.ColorSettingHsv="ColorSettingHsv",e.Notifier="Notifier",e.StartStop="StartStop",e.Pause="Pause",e.Dock="Dock",e.TemperatureSetting="TemperatureSetting",e.Thermometer="Thermometer",e.HumiditySensor="HumiditySensor",e.Camera="Camera",e.Microphone="Microphone",e.Display="Display",e.VideoCamera="VideoCamera",e.VideoRecorder="VideoRecorder",e.PanTiltZoom="PanTiltZoom",e.EventRecorder="EventRecorder",e.VideoClips="VideoClips",e.VideoCameraConfiguration="VideoCameraConfiguration",e.Intercom="Intercom",e.Lock="Lock",e.PasswordStore="PasswordStore",e.Scene="Scene",e.Entry="Entry",e.EntrySensor="EntrySensor",e.DeviceProvider="DeviceProvider",e.DeviceDiscovery="DeviceDiscovery",e.DeviceCreator="DeviceCreator",e.Battery="Battery",e.Charger="Charger",e.Refresh="Refresh",e.MediaPlayer="MediaPlayer",e.Online="Online",e.BufferConverter="BufferConverter",e.Settings="Settings",e.BinarySensor="BinarySensor",e.TamperSensor="TamperSensor",e.PowerSensor="PowerSensor",e.AudioSensor="AudioSensor",e.MotionSensor="MotionSensor",e.AmbientLightSensor="AmbientLightSensor",e.OccupancySensor="OccupancySensor",e.FloodSensor="FloodSensor",e.UltravioletSensor="UltravioletSensor",e.LuminanceSensor="LuminanceSensor",e.PositionSensor="PositionSensor",e.SecuritySystem="SecuritySystem",e.PM10Sensor="PM10Sensor",e.PM25Sensor="PM25Sensor",e.VOCSensor="VOCSensor",e.NOXSensor="NOXSensor",e.CO2Sensor="CO2Sensor",e.AirQualitySensor="AirQualitySensor",e.Readme="Readme",e.OauthClient="OauthClient",e.MixinProvider="MixinProvider",e.HttpRequestHandler="HttpRequestHandler",e.EngineIOHandler="EngineIOHandler",e.PushHandler="PushHandler",e.Program="Program",e.Scriptable="Scriptable",e.ObjectTracker="ObjectTracker",e.ObjectDetector="ObjectDetector",e.ObjectDetection="ObjectDetection",e.HumiditySetting="HumiditySetting",e.Fan="Fan",e.RTCSignalingChannel="RTCSignalingChannel",e.RTCSignalingClient="RTCSignalingClient",e.LauncherApplication="LauncherApplication",e.ScryptedUser="ScryptedUser",e.VideoFrameGenerator="VideoFrameGenerator"}(t.ScryptedInterface||(t.ScryptedInterface={})),function(e){e.Url="text/x-uri",e.InsecureLocalUrl="text/x-insecure-local-uri",e.LocalUrl="text/x-local-uri",e.PushEndpoint="text/x-push-endpoint",e.SchemePrefix="x-scrypted/x-scrypted-scheme-",e.MediaStreamUrl="text/x-media-url",e.MediaObject="x-scrypted/x-scrypted-media-object",e.RequestMediaObject="x-scrypted/x-scrypted-request-media-object",e.RequestMediaStream="x-scrypted/x-scrypted-request-stream",e.MediaStreamFeedback="x-scrypted/x-media-stream-feedback",e.FFmpegInput="x-scrypted/x-ffmpeg-input",e.FFmpegTranscodeStream="x-scrypted/x-ffmpeg-transcode-stream",e.RTCSignalingChannel="x-scrypted/x-scrypted-rtc-signaling-channel",e.RTCSignalingSession="x-scrypted/x-scrypted-rtc-signaling-session",e.RTCConnectionManagement="x-scrypted/x-scrypted-rtc-connection-management",e.Image="x-scrypted/x-scrypted-image"}(t.ScryptedMimeTypes||(t.ScryptedMimeTypes={}))},7817:function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AutoenableMixinProvider=void 0;const n=i(7954),s=r(i(7954)),{systemManager:o}=s.default,a="v4";class c extends n.ScryptedDeviceBase{constructor(e){super(e),this.hasEnabledMixin={},this.unshiftMixin=!1;try{this.hasEnabledMixin=JSON.parse(this.storage.getItem("hasEnabledMixin"))}catch(e){this.hasEnabledMixin={}}this.pluginsComponent=o.getComponent("plugins"),o.listen((async(e,t,i)=>{t.eventInterface!==n.ScryptedInterface.ScryptedDevice||t.property||this.maybeEnableMixin(e)}));for(const e of Object.keys(o.getSystemState())){const t=o.getDeviceById(e);this.maybeEnableMixin(t)}}async shouldEnableMixin(e){return!0}async maybeEnableMixin(e){if(!e||e.mixins?.includes(this.id))return;if(this.hasEnabledMixin[e.id]===a)return;if(!await this.canMixin(e.type,e.interfaces))return;if(!await this.shouldEnableMixin(e))return;this.log.i("auto enabling mixin for "+e.name);const t=(e.mixins||[]).slice();this.unshiftMixin?t.unshift(this.id):t.push(this.id);const i=await this.pluginsComponent;await i.setMixins(e.id,t),this.setHasEnabledMixin(e.id)}setHasEnabledMixin(e){this.hasEnabledMixin[e]!==a&&(this.hasEnabledMixin[e]=a,this.storage.setItem("hasEnabledMixin",JSON.stringify(this.hasEnabledMixin)))}}t.AutoenableMixinProvider=c},6405:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Deferred=void 0;t.Deferred=class{constructor(){this.finished=!1,this.promise=new Promise(((e,t)=>{this.resolve=t=>(this.finished=!0,e(t),this),this.reject=e=>(this.finished=!0,t(e),this)}))}}},6219:function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SettingsMixinDeviceBase=void 0;const n=i(7954),s=r(i(7954)),{deviceManager:o}=s.default;class a extends n.MixinDeviceBase{constructor(e){super(e),this.settingsGroup=e.group,this.settingsGroupKey=e.groupKey,process.nextTick((()=>o.onMixinEvent(this.id,this,n.ScryptedInterface.Settings,null)))}async getSettings(){const e=this.mixinDeviceInterfaces.includes(n.ScryptedInterface.Settings)?this.mixinDevice.getSettings():void 0,t=this.getMixinSettings(),i=[];try{const t=await e||[];i.push(...t)}catch(e){const t=this.name,r=`${t} Extension settings failed to load.`;this.console.error(r,e),i.push({key:Math.random().toString(),title:t,value:"Settings Error",group:"Errors",description:r,readonly:!0})}try{const e=await t||[];for(const t of e)t.group=t.group||this.settingsGroup,t.key=this.settingsGroupKey+":"+t.key;i.push(...e)}catch(e){const t=o.getDeviceState(this.mixinProviderNativeId).name,r=`${t} Extension settings failed to load.`;this.console.error(r,e),i.push({key:Math.random().toString(),title:t,value:"Settings Error",group:"Errors",description:r,readonly:!0})}return i}async putSetting(e,t){const i=this.settingsGroupKey+":";if(!e?.startsWith(i))return this.mixinDevice.putSetting(e,t);await this.putMixinSetting(e.substring(i.length),t)||o.onMixinEvent(this.id,this,n.ScryptedInterface.Settings,null)}async release(){await o.onMixinEvent(this.id,this,n.ScryptedInterface.Settings,null)}}t.SettingsMixinDeviceBase=a},5045:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,n)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(9413),t)},6360:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,n)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&r(t,e,i);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(6405),c=i(5045),l=s(i(7954)),h=i(8202),p=o(i(6113)),u=i(7817),d=i(6219),m=i(9633),g=i(195),f=i(8098),v=i(88),{systemManager:S}=l.default,y="Assist",E="Replace",I=`${l.ScryptedInterface.ObjectDetection}:`;class D extends d.SettingsMixinDeviceBase{get detectorRunning(){return!this.detectorSignal.finished}constructor(e,t,i,r,n,s,o,c,p,u){super({mixinDevice:t,mixinDeviceState:r,mixinProviderNativeId:n,mixinDeviceInterfaces:i,group:c,groupKey:"objectdetectionplugin:"+s.id,mixinStorageSuffix:s.id}),this.plugin=e,this.objectDetection=s,this.model=o,this.hasMotionType=p,this.settings=u,this.detections=new Map,this.storageSettings=new h.StorageSettings(this,{newPipeline:{title:"Video Pipeline",description:"Configure how frames are provided to the video analysis pipeline.",onGet:async()=>{const e=["Default",...(0,g.getAllDevices)().filter((e=>e.interfaces.includes(l.ScryptedInterface.VideoFrameGenerator))).map((e=>e.name))];return this.hasMotionType||e.push("Snapshot"),{choices:e}},onPut:()=>{this.endObjectDetection(),this.maybeStartMotionDetection()},defaultValue:"Default"},motionSensorSupplementation:{title:"Built-In Motion Sensor",description:`This camera has a built in motion sensor. Using ${this.objectDetection.name} may be unnecessary and will use additional CPU. Replace will ignore the built in motion sensor. Filter will verify the motion sent by built in motion sensor. The Default is Replace.`,choices:["Default",y,E],defaultValue:"Default",onPut:()=>{this.endObjectDetection(),this.maybeStartMotionDetection()}},detectionDuration:{title:"Detection Duration",subgroup:"Advanced",description:"The duration in seconds to analyze video when motion occurs.",type:"number",defaultValue:20},detectionTimeout:{title:"Detection Timeout",subgroup:"Advanced",description:"Timeout in seconds before removing an object that is no longer detected.",type:"number",defaultValue:60},motionDuration:{title:"Motion Duration",description:"The duration in seconds to wait to reset the motion sensor.",type:"number",defaultValue:10},motionAsObjects:{title:"Motion Detection Objects",description:"Report motion detections as objects (useful for debugging).",type:"boolean"},detectionInterval:{type:"number",defaultValue:60,hide:!0}}),this.zones=this.getZones(),this.zoneInfos=this.getZoneInfos(),this.analyzeStop=0,this.detectorSignal=(new a.Deferred).resolve(),this.cameraDevice=S.getDeviceById(this.id),this.bindObjectDetection(),this.register(),this.resetDetectionTimeout()}clearDetectionTimeout(){clearTimeout(this.detectionIntervalTimeout),this.detectionIntervalTimeout=void 0}resetDetectionTimeout(){this.clearDetectionTimeout(),this.detectionIntervalTimeout=setInterval((async()=>{this.hasMotionType&&this.motionSensorSupplementation===E&&this.startPipelineAnalysis()}),1e3*this.storageSettings.values.detectionInterval)}clearMotionTimeout(){clearTimeout(this.motionTimeout),this.motionTimeout=void 0}resetMotionTimeout(){this.clearMotionTimeout(),this.motionTimeout=setTimeout((()=>{this.motionDetected=!1}),1e3*this.storageSettings.values.motionDuration)}getCurrentSettings(){if(!this.settings)return;const e={};for(const t of this.settings)e[t.key]=(t.multiple?(0,g.safeParseJson)(this.storage.getItem(t.key)):this.storage.getItem(t.key))||t.value;return this.hasMotionType&&(e.motionAsObjects=this.storageSettings.values.motionAsObjects),e}async maybeStartMotionDetection(){this.hasMotionType&&this.motionSensorSupplementation===E&&this.startPipelineAnalysis()}endObjectDetection(){this.detectorSignal.resolve()}bindObjectDetection(){this.hasMotionType&&(this.motionDetected=!1),this.endObjectDetection(),this.maybeStartMotionDetection()}async register(){await this.objectDetection.getDetectionModel();this.hasMotionType?this.hasMotionType&&(this.motionMixinListener=this.cameraDevice.listen({event:l.ScryptedInterface.MotionSensor,mixinId:this.id},(async(e,t,i)=>{if(this.motionSensorSupplementation===y){if(i){if(this.motionDetected)return;return this.detectorRunning||this.console.log("built in motion sensor started motion, starting video detection."),void this.startPipelineAnalysis()}this.clearMotionTimeout(),this.detectorRunning&&(this.console.log("built in motion sensor ended motion, stopping video detection."),this.endObjectDetection()),this.motionDetected&&(this.motionDetected=!1)}}))):this.motionListener=this.cameraDevice.listen(l.ScryptedInterface.MotionSensor,(async()=>{if(this.cameraDevice.motionDetected)this.startPipelineAnalysis();else if(this.detectorRunning){if(this.analyzeStop>Date.now())return;this.console.log("motion stopped, cancelling ongoing detection"),this.endObjectDetection()}}))}startPipelineAnalysis(){if(!this.detectorSignal.finished)return;const e=this.detectorSignal=new a.Deferred;this.hasMotionType||this.plugin.objectDetectionStarted(this.console);const t={snapshotPipeline:this.plugin.shouldUseSnapshotPipeline()};this.runPipelineAnalysis(e,t).catch((e=>{this.console.error("Video Analysis ended with error",e)})).finally((()=>{this.hasMotionType?this.console.log("Video Analysis motion detection ended."):this.plugin.objectDetectionEnded(this.console,t.snapshotPipeline),e.resolve()}))}async runPipelineAnalysis(e,t){const i=Date.now();this.analyzeStop=i+this.getDetectionDuration();let r=Date.now(),n="starting";const s=e=>{n=e,r=Date.now()};let o,a;const h=setInterval((()=>{Date.now()-r>3e4&&(e.resolve(),this.console.error("VideoAnalysis is hung and will terminate:",n))}),3e4);e.promise.finally((()=>clearInterval(h)));let p=this.newPipeline;if(this.hasMotionType||p&&"Default"!==p||t.snapshotPipeline&&(p="Snapshot",this.console.warn(`Due to limited performance, Snapshot mode is being used with ${this.plugin.statsSnapshotConcurrent} actively detecting cameras.`)),"Snapshot"!==p||this.hasMotionType){const e=this.hasMotionType?"low-resolution":"local-recorder",t=S.getDeviceById(p);if(!t)throw new Error("invalid VideoFrameGenerator");this.console.log(t.name,"+",this.objectDetection.name),s("getVideoStream");const i=await this.cameraDevice.getVideoStream({destination:e,audio:null});o=await t.generateVideoFrames(i,{resize:this.model?.inputSize?{width:this.model.inputSize[0],height:this.model.inputSize[1]}:void 0,format:this.model?.inputFormat})}else{t.snapshotPipeline=!0,this.console.log("decoder:","Snapshot +",this.objectDetection.name);const i=this;o=async function*(){try{for(;!e.finished;){const e=Date.now(),t=async()=>{const t=e+1100-Date.now();t>0&&await(0,c.sleep)(t)};let r;try{s("takePicture");const e=await i.cameraDevice.takePicture({reason:"event"});s("converting image"),r=await l.default.mediaManager.convertMediaObject(e,l.ScryptedMimeTypes.Image)}catch(e){i.console.error("Video analysis snapshot failed. Will retry in a moment."),await t();continue}s("processing image"),yield r,await t()}}finally{i.console.log("Snapshot generation finished.")}}()}const u=new Set;let d=0;a=await l.default.connectRPCObject(await this.objectDetection.generateObjectDetections(o,{settings:this.getCurrentSettings(),sourceId:this.id})),s("waiting result");for await(const t of a){if(e.finished)break;if(!this.hasMotionType&&Date.now()>this.analyzeStop)break;const r=this.applyZones(t.detected);if(t.detected.detections=r,!this.hasMotionType){this.plugin.trackDetection();for(const e of t.detected.detections)u.add(e.className);const e=Date.now();if(e>d+1e4){const t=[...u.values()];t.length||t.push("[no detections]"),this.console.log(`[${Math.round((e-i)/100)/10}s] Detected:`,...t),u.clear(),d=e}}if(t.detected.detectionId){s("creating jpeg");const e=await t.videoFrame.toBuffer({format:"jpg"});s("converting jpeg");const i=await l.default.mediaManager.createMediaObject(e,"image/jpeg");this.setDetection(t.detected,i)}this.reportObjectDetections(t.detected),this.hasMotionType&&await(0,c.sleep)(250),s("waiting result")}}normalizeBox(e,t){let[i,r,n,s]=e,o=i+n,a=r+s;i=100*i/t[0],r=100*r/t[1],o=100*o/t[0],a=100*a/t[1];return[[i,r],[o,r],[o,a],[i,a]]}getDetectionDuration(){return this.hasMotionType?1e3*this.storageSettings.values.detectionInterval*5:1e3*this.storageSettings.values.detectionDuration}applyZones(e){if(!e.detections)return[];let t=e.detections.slice();for(const i of e.detections){if(!i.boundingBox)continue;i.zones=[];const r=this.normalizeBox(i.boundingBox,e.inputDimensions);let n;for(const[e,s]of Object.entries(this.zones)){if(s.length<3)continue;const o=this.zoneInfos[e];o?.exclusion||n||(n=!1);let a=!1;if(a="Contain"===o?.type?v(r[0],s)&&v(r[1],s)&&v(r[2],s)&&v(r[3],s):f(r,s),a&&o?.classes?.length&&(a=o.classes.includes(i.className)),a){if(i.zones.push(e),o?.exclusion&&a){t=t.filter((e=>e!==i));break}n=!0}}if(this.hasMotionType&&void 0===n){n=f(r,[[0,10],[100,10],[100,90],[0,90]])}!1===n&&(t=t.filter((e=>e!==i)))}return t}reportObjectDetections(e){if(this.hasMotionType){const t=e.detections?.find((e=>"motion"===e.className));if(t){this.motionDetected||(this.motionDetected=!0),this.resetMotionTimeout();const t=e.detections.filter((e=>"motion"===e.className&&1!==e.score)).map((e=>e.score));t.length&&this.console.log("detection areas",t)}}this.hasMotionType&&!this.storageSettings.values.motionAsObjects||this.onDeviceEvent(l.ScryptedInterface.ObjectDetector,e)}setDetection(e,t){e.detectionId||(e.detectionId=p.default.randomBytes(4).toString("hex")),this.console.log("retaining detection image",...e.detections);const{detectionId:i}=e;this.detections.set(i,t),setTimeout((()=>{this.detections.delete(i)}),2e3)}async getNativeObjectTypes(){return this.mixinDeviceInterfaces.includes(l.ScryptedInterface.ObjectDetector)?this.mixinDevice.getObjectTypes():{}}async getObjectTypes(){const e=await this.getNativeObjectTypes();return e.classes||(e.classes=[]),e.classes.push(...(await this.objectDetection.getDetectionModel()).classes),e}async getDetectionInput(e){const t=this.detections.get(e);if(t)return t;if(this.mixinDeviceInterfaces.includes(l.ScryptedInterface.ObjectDetector))return this.mixinDevice.getDetectionInput(e);throw new Error("Detection not found. It may have expired.")}get motionSensorSupplementation(){if(!(0,m.serverSupportsMixinEventMasking)()||!this.interfaces.includes(l.ScryptedInterface.MotionSensor))return E;switch(this.storage.getItem("motionSensorSupplementation")){case E:return E;case y:return y}return E}get newPipeline(){const e=this.storageSettings.values.newPipeline;if(!e)return e;if("Snapshot"===e)return e;const t=(0,g.getAllDevices)().filter((e=>e.interfaces.includes(l.ScryptedInterface.VideoFrameGenerator))),i=t.find((e=>"webcodec"===e.nativeId)),r=t.find((e=>"gstreamer"===e.nativeId)),n=t.find((e=>"libav"===e.nativeId)),s=t.find((e=>"ffmpeg"===e.nativeId));return(t.find((t=>t.name===e))||i||r||n||s).id}async getMixinSettings(){const e=[];try{this.settings=(await this.objectDetection.getDetectionModel(this.getCurrentSettings())).settings}catch(e){}this.settings&&e.push(...this.settings.map((e=>Object.assign({},e,{placeholder:e.placeholder?.toString(),value:(e.multiple?(0,g.safeParseJson)(this.storage.getItem(e.key)):this.storage.getItem(e.key))||e.value})))),this.storageSettings.settings.motionSensorSupplementation.hide=!this.hasMotionType||!this.mixinDeviceInterfaces.includes(l.ScryptedInterface.MotionSensor),this.storageSettings.settings.detectionDuration.hide=this.hasMotionType,this.storageSettings.settings.detectionTimeout.hide=this.hasMotionType,this.storageSettings.settings.motionDuration.hide=!this.hasMotionType,this.storageSettings.settings.motionAsObjects.hide=!this.hasMotionType,e.push(...await this.storageSettings.getSettings()),e.push({key:"zones",title:"Zones",type:"string",description:"Enter the name of a new zone or delete an existing zone.",multiple:!0,value:Object.keys(this.zones),choices:Object.keys(this.zones),combobox:!0});for(const[t,i]of Object.entries(this.zones)){const r=this.zoneInfos[t],n=`Zone: ${t}`;e.push({subgroup:n,key:`zone-${t}`,title:"Open Zone Editor",type:"clippath",value:JSON.stringify(i)}),e.push({subgroup:n,key:`zoneinfo-exclusion-${t}`,title:"Exclusion Zone",description:"Detections in this zone will be excluded.",type:"boolean",value:r?.exclusion}),e.push({subgroup:n,key:`zoneinfo-type-${t}`,title:"Zone Type",description:"An Intersect zone will match objects that are partially or fully inside the zone. A Contain zone will only match objects that are fully inside the zone.",choices:["Intersect","Contain"],value:r?.type||"Intersect"})}return this.hasMotionType||e.push({title:"Analyze",description:"Analyzes the video stream for 1 minute. Results will be shown in the Console.",key:"analyzeButton",type:"button"}),e}getZones(){try{return JSON.parse(this.storage.getItem("zones"))}catch(e){return{}}}getZoneInfos(){try{return JSON.parse(this.storage.getItem("zoneInfos"))}catch(e){return{}}}async putMixinSetting(e,t){let i=t?.toString();if("zones"===e){const e={},i={};for(const r of t)e[r]=this.zones[r]||[],i[r]=this.zoneInfos[r];return this.zones=e,this.zoneInfos=i,this.storage.setItem("zones",JSON.stringify(e)),void this.storage.setItem("zoneInfos",JSON.stringify(i))}if(e.startsWith("zone-")){const t=e.substring("zone-".length);this.zones[t]&&(this.zones[t]=JSON.parse(i),this.storage.setItem("zones",JSON.stringify(this.zones)))}else{if(e.startsWith("zoneinfo-")){const[i,r]=e.substring("zoneinfo-".length).split("-");return this.zoneInfos[r]||={},this.zoneInfos[r][i]=t,void this.storage.setItem("zoneInfos",JSON.stringify(this.zoneInfos))}if(this.storageSettings.settings[e])return this.storageSettings.putSetting(e,t);if(t&&this.settings?.find((t=>t.key===e))?.multiple&&(i=JSON.stringify(t)),"analyzeButton"===e)this.startPipelineAnalysis(),this.analyzeStop=Date.now()+6e4;else{const r=this.getCurrentSettings();r&&r[e]&&(this.storage.setItem(e,i),r[e]=t),this.bindObjectDetection()}}}async release(){super.release(),this.clearDetectionTimeout(),this.clearMotionTimeout(),this.motionListener?.removeListener(),this.motionMixinListener?.removeListener(),this.endObjectDetection()}}class O extends l.MixinDeviceBase{constructor(e,t,i,r,n){super({mixinDevice:e,mixinDeviceInterfaces:t,mixinDeviceState:i,mixinProviderNativeId:r.nativeId}),this.plugin=r,this.model=n,this.currentMixins=new Set;for(const e of Object.keys(S.getSystemState())){const t=S.getDeviceById(e);t.mixins?.includes(this.id)&&t.probe()}}async canMixin(e,t){const i=this.model.classes.includes("motion"),r=`${I}${i}`,n=`${r}:${this.id}`;if(!t.find((e=>e.startsWith(r)&&e!==n))&&(e===l.ScryptedDeviceType.Camera||e===l.ScryptedDeviceType.Doorbell)&&(t.includes(l.ScryptedInterface.VideoCamera)||t.includes(l.ScryptedInterface.Camera))){const e=[l.ScryptedInterface.ObjectDetector,l.ScryptedInterface.Settings,n];return(await this.mixinDevice.getDetectionModel()).classes?.includes("motion")&&e.push(l.ScryptedInterface.MotionSensor),e}}async getMixin(e,t,i){let r=S.getDeviceById(this.id);const n=this.model.classes.includes("motion"),s=n?"Motion Detection":"Object Detection",o=this.model.settings,a=new D(this.plugin,e,t,i,this.mixinProviderNativeId,r,this.model,s,n,o);return this.currentMixins.add(a),a}async releaseMixin(e,t){return this.currentMixins.delete(t),t.release()}}class M extends u.AutoenableMixinProvider{shouldUseSnapshotPipeline(){this.pruneOldStatistics();for(const[e,t]of this.objectDetectionStatistics.entries())if(t.dps<2&&e<=this.statsSnapshotConcurrent)return!0;return!1}pruneOldStatistics(){Date.now();for(const[e,t]of this.objectDetectionStatistics.entries())Date.now()-t.sampleTime>36e5&&this.objectDetectionStatistics.delete(e)}trackDetection(){this.statsSnapshotDetections++}objectDetectionStarted(e){this.resetStats(e),this.statsSnapshotConcurrent++}objectDetectionEnded(e,t){this.resetStats(e,t),this.statsSnapshotConcurrent--}resetStats(e,t){const i=Date.now(),r=this.statsSnapshotConcurrent;if(r){const n=i-this.statsSnapshotTime,s={sampleTime:i,dps:this.statsSnapshotDetections/(n/1e3)};n>1e4&&this.statsSnapshotDetections&&!t&&this.objectDetectionStatistics.set(r,s),this.pruneOldStatistics();const o=`video analysis, ${r} camera(s), dps: ${Math.round(10*s.dps)/10} (${this.statsSnapshotDetections}/${Math.round(n/1e3)})`;this.console.log(o),e?.log(o)}this.statsSnapshotDetections=0,this.statsSnapshotTime=i}constructor(e){super(e),this.currentMixins=new Set,this.objectDetectionStatistics=new Map,this.statsSnapshotConcurrent=0,this.storageSettings=new h.StorageSettings(this,{activeMotionDetections:{title:"Active Motion Detection Sessions",readonly:!0,mapGet:()=>[...this.currentMixins.values()].reduce(((e,t)=>e+[...t.currentMixins.values()].reduce(((e,t)=>e+(t.hasMotionType&&t.detectorRunning?1:0)),0)),0)},activeObjectDetections:{title:"Active Object Detection Sessions",readonly:!0,mapGet:()=>[...this.currentMixins.values()].reduce(((e,t)=>e+[...t.currentMixins.values()].reduce(((e,t)=>e+(!t.hasMotionType&&t.detectorRunning?1:0)),0)),0)}})}async getDevice(e){}async releaseDevice(e,t){}getSettings(){return this.storageSettings.getSettings()}putSetting(e,t){return this.storageSettings.putSetting(e,t)}async canMixin(e,t){if(t.includes(l.ScryptedInterface.ObjectDetection))return[l.ScryptedInterface.MixinProvider]}async getMixin(e,t,i){const r=await e.getDetectionModel(),n=new O(e,t,i,this,r);return this.currentMixins.add(n),n}async releaseMixin(e,t){this.currentMixins.delete(t)}}t.default=M},9633:function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.serverSupportsMixinEventMasking=void 0;const n=r(i(1249)),s=r(i(7954));t.serverSupportsMixinEventMasking=function(){try{return!!s.default.serverVersion&&n.default.gte(s.default.serverVersion,"0.5.0")}catch(e){}return!1}},195:function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getAllDevices=t.safeParseJson=void 0;const n=r(i(7954));t.safeParseJson=function(e){try{return JSON.parse(e)}catch(e){}},t.getAllDevices=function(){return Object.keys(n.default.systemManager.getSystemState()).map((e=>n.default.systemManager.getDeviceById(e)))}},9413:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sleep=void 0,t.sleep=async function(e){await new Promise((t=>setTimeout(t,e)))}},6113:e=>{"use strict";e.exports=require("crypto")}},t={};var i=function i(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,i),s.exports}(6360),r=exports="undefined"==typeof exports?{}:exports;for(var n in i)r[n]=i[n];i.__esModule&&Object.defineProperty(r,"__esModule",{value:!0})})();
//# sourceMappingURL=main.nodejs.js.map